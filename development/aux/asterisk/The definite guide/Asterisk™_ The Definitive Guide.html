<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0080)http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Asterisk™: The Definitive Guide</title><link rel="stylesheet" type="text/css" href="./Asterisk™_ The Definitive Guide_files/styles.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="preload" href="./Asterisk™_ The Definitive Guide_files/f(5).txt" as="script"><script type="text/javascript" async="" src="./Asterisk™_ The Definitive Guide_files/ga.js"></script><script src="./Asterisk™_ The Definitive Guide_files/osd.js"></script><script src="./Asterisk™_ The Definitive Guide_files/ca-pub-8316482144448761.js"></script><script type="text/javascript" src="./Asterisk™_ The Definitive Guide_files/f(5).txt"></script><link rel="preload" href="./Asterisk™_ The Definitive Guide_files/f(6).txt" as="script"><script type="text/javascript" src="./Asterisk™_ The Definitive Guide_files/f(6).txt"></script><link rel="preload" href="http://pagead2.googlesyndication.com/pagead/js/r20190522/r20190131/show_ads_impl.js" as="script"></head><body>
<div id="adsense_left">
<script type="text/javascript"><!--
// Text Ad: Skyscraper (120x600)
google_ad_client = "pub-8316482144448761";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_ad_channel = "";
google_color_border = "ffffff";
google_color_bg = "ffffff";
google_color_link = "0000ff";
google_color_url = "008000";
google_color_text = "000000";
//--></script>
<script type="text/javascript" src="./Asterisk™_ The Definitive Guide_files/f(7).txt">
</script><ins id="aswift_0_expand" style="display:inline-table;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:120px;background-color:transparent;"><ins id="aswift_0_anchor" style="display:block;border:none;height:600px;margin:0;padding:0;position:relative;visibility:visible;width:120px;background-color:transparent;"><iframe width="120" height="600" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;border:0px;width:120px;height:600px;" src="./Asterisk™_ The Definitive Guide_files/saved_resource(1).html"></iframe></ins></ins>
</div>

<div class="book" title="Asterisk™: The Definitive Guide"><div class="titlepage"><div><div><h1 class="title"><a id="asterisk-BOOK"></a>Asterisk™: The Definitive Guide</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Leif</span> <span class="surname">Madsen</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Jim</span> <span class="surname">Van Meggelen</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Russell</span> <span class="surname">Bryant</span></h3></div></div><div><p class="copyright">Copyright © 2011 Leif Madsen, Jim Van Meggelen, and Russell Bryant</p></div><div><div class="legalnotice" title="Legal Notice"><a id="id492099"></a><p>Printed in the United States of America.</p></div></div></div><hr></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="preface"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#foreword">Foreword</a></span></dt><dt><span class="preface"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE">Preface</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-1">Audience</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-2">Organization</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-3">Software</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-4">Conventions Used in This Book</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-5">Using Code Examples</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect1_tt2">Safari Books Online</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-7">How to Contact Us</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-8">Acknowledgments</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id505296">Leif Madsen</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#preface2_id269249">Jim Van Meggelen</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#preface2_id269241">Russell Bryant</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution">1. A Telephony Revolution</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1">Asterisk and VoIP: Bridging the Gap Between Traditional and Network
    Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1.1">The Zapata Telephony Project</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-2">Massive Change Requires Flexible Technology</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-3">Asterisk: The Hacker’s PBX</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-4">Asterisk: The Professional’s PBX</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5">The Asterisk Community</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.2">Asterisk Wiki Sites</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.3">The IRC Channels</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.4">Asterisk User Groups</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-6">The Business Case</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-7">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">2. Asterisk Architecture</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5-SECT-1">Modules</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293876">Resource Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#file_structure">File Structure</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294638">Configuration Files</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294666">Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294732">Logging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294754">The Dialplan</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294803">Hardware</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning">Asterisk Versioning</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id348242">Previous Release Methodologies</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id348349">The New Release Methodology</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294832">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install">3. Installing Asterisk</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291070">Distribution Installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291082">CentOS Server</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291135">Base system installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291582">Base system update</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291827">Ubuntu Server</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291868">Base system installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292090">Base system update</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_subversion">Getting the Source via Subversion</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_wget">Getting the Source via wget</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it">How to Install It</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423812">LibPRI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870">DAHDI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id424034">Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292785">Setting File Permissions</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_base_configuration">Base Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293578">Disable SELinux</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293688">Initial Configuration</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294211">modules.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994">make menuselect</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293020">Uses for menuselect</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293213">Using menuselect</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294543">Common Issues</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294571">-bash: wget: command not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294625">configure: error: no acceptable C compiler found in $PATH</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294679">make: gcc: command not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294733">configure: error: C++ preprocessor “/lib/cpp” fails sanity
      check</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294786">configure: error: *** Please install GNU make. It is required to
      build Asterisk!</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294844">configure: *** XML documentation will not be available because
      the ‘libxml2’ development package is missing.</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294901">configure: error: *** termcap support not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294955">You do not appear to have the sources for the 2.6.18-164.6.1.el5
      kernel installed.</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295010">E: Unable to lock the administration directory (/var/lib/dpkg/),
      are you root?</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295025">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Initial">4. Initial Configuration Tasks</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file">asterisk.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id291715">indications.conf</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241164">CentOS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241193">Ubuntu</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241229">Completing file conversion</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260414">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig">5. User Device Configuration</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id216341">Configuring Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291909">Loading Your New Channel Configurations</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291920">The Asterisk CLI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292132">Under the Hood: Your First Call</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292192">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics">6. Dialplan Basics</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2">Extensions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.3">Priorities</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id261938">Unnumbered priorities</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262049">The 'same =&gt;' operator</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262089">Priority labels</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2">A Simple Dialplan</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.3">Hello World</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3">Building an Interactive Dialplan</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2">Handling Invalid Entries and Timeouts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.3">Using the Dial() Application</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292362">Argument 1: Destination</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292588">Argument 2: Timeout</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292662">Argument 3: Option</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292716">Argument 4: URI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292738">Updating the dialplan</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292773">Blank arguments</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.1">Global variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.2">Channel variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.3">Environment variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.4">Adding variables to our dialplan</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6">Pattern Matching</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8">Includes</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-4">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn">7. Outside Connectivity</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn-SECT-1">The Basics of Trunking</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271202">PSTN Circuits</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271212">Traditional PSTN Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240837">Digital telephony</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240851">Installing PSTN Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291235">VoIP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291257">VoIP to VoIP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291268">Configuring VoIP Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291281">Configuring SIP trunks between Asterisk systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291291">Configuring IAX trunks between Asterisk systems</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291322">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail">8. Voicemail</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id263499">Comedian Mail</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292544">Dialplan Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292842">Storage Backends</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292932">ODBC</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293070">Using Asterisk As a Standalone Voicemail Server</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      <span class="keep-together">Voicemail Server</span></a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293304">sip.conf requirements</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293431">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization">9. Internationalization</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id373863">Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305757">Caller ID</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper">10. Deeper into the Dialplan</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1">Expressions and Variable Manipulation</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2">Dialplan Functions</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.1">Syntax</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.2">Examples of Dialplan Functions</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3">Conditional Branching</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5">Macros</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.1">Defining Macros</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub">GoSub()</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060368">Defining Subroutines</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060490">Calling Subroutines from the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060548">Using Arguments in Subroutines</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.1">Storing Data in the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.2">Retrieving Data from the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7">Handy Asterisk Features</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-8">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin">11. Parking and Paging</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265355">Places to Send Your Pages</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257823">VoIP paging adaptors</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257873">Bringing it all together</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247965">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR">12. Internet Call Routing</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR-SECT-1">DNS and SIP URIs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id268880">The SIP URI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289964">Modifying sip.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288167">File parsing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288915">ENUM and E.164</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289026">ENUM</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289190">ISN, ITAD, and freenum.org</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289278">ITAD Subscriber Numbers (ISNs)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247800">IP Telephony Administrative Domains (ITADs)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248004">Testing Your ITAD</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579341">Receiving calls to your ITAD</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248274">Security and Identity</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248402">Spam over Internet Telephony (SPIT)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248457">Phishing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248492">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">13. Automatic Call Distribution (ACD) Queues</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289508">Queue Members</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288626">Automatically Logging Into and Out of Multiple Queues</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288932">Advanced Queues</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288963">Overflow</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289208">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates">14. Device States</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id262632">Checking Device States</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265377">Extension States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265385">Hints</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#usingCustomDeviceStates">Using Custom Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025906">An Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265044">Distributed Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052">Using OpenAIS</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025793">Installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025485">OpenAIS configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025387">Asterisk configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060344">Creating XMPP accounts</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060384">Asterisk configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#SLA">Shared Line Appearances</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289480">Configuration Overview</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061103">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061311">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289498">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA">15. The Automated Attendant</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA-SECT-1">An Auto Attendant Is Not an IVR</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id272753">Designing Your Auto Attendant</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id289543">The Greeting</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287786">The Main Menu</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287827">Selection 1</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287846">Selection 2</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287860">Selection #</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287873">Selection 3</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287887">Selection 9</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287906">Selection 0</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287920">Timeout</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287934">Invalid</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287946">Dial by Extension</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287976">Building Your Auto Attendant</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288137">The Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288192">Delivering Incoming Calls to the Auto Attendant</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288230">IVR</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id36001995">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB">16. Relational Database Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#managing_databases">Installing and Configuring PostgreSQL and MySQL</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database">Installing PostgreSQL for CentOS</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id254247">Installing PostgreSQL for Ubuntu</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id262627">Installing MySQL for CentOS</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id253003">Installing MySQL for Ubuntu</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql">Configuring PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc">Installing and Configuring ODBC</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#test">Configuring ODBC for PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246760">Configuring ODBC for MySQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247345">Managing Databases</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287575">Troubleshooting Database Issues</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287624">A Gentle Introduction to func_odbc</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578">ODBC Voicemail</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#psql_large_object_support">Creating the Large Object Type for PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276920">ODBC Voicemail Storage Table Layout</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1610">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR">17. Interactive Voice Response</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR-SECT-1">What Is IVR?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289181">IVR Design Considerations</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289193">Do</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289222">Don’t</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246875">Asterisk Modules for Building IVRs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246881">CURL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246897">func_odbc</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246909">AGI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246930">AMI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246940">A Simple IVR Using CURL</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247025">The Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247054">A Prompt-Recording Application</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247100">Speech Recognition and Text-to-Speech</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247129">Text-to-Speech</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247154">Speech Recognition</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247197">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices">18. External Services</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices-SECT-1">Calendar Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id266014">Compiling Calendaring Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id259378">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262604">Ubuntu dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254192">Triggering a wakeup call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration">VoiceMail IMAP Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246986">Compiling IMAP VoiceMail Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247003">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247032">Ubuntu dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247065">Compiling the IMAP library</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#compiling-asterisk-imap-support">Compiling Asterisk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286256">Configuring Asterisk</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286789">Using XMPP (Jabber) with Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286804">Compiling Jabber Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286815">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286850">Ubuntu dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#accepting_calls_from_google_talk">Accepting calls from Google Talk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285352">Accepting calls from Google Voice</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285398">Outgoing calls via Google Talk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291565">Skype Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057654">Installation of Skype for Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057688">Using Skype for Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#placing_and_receiving_calls_via_skype">Placing and receiving calls via Skype</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291590">LDAP Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189890">Compiling LDAP Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36041022">Ubuntu dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040950">CentOS dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189907">Configuring Asterisk for LDAP Support</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040839">Configuring res_ldap.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040635">Configuring extconfig.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291618">Text-to-Speech Utilities</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055967">Installing Festival on CentOS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055989">Installing Festival on Ubuntu</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291644">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax">19. Fax</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax-SECT-1">What Is a Fax?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id290275">Ways to Handle Faxes in Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id253868">spandsp</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329066">Obtaining spandsp</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id323352">Compiling and Installing spandsp</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337783">Adding the spandsp Library to Your libpath</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id345391">Recompiling Asterisk with spandsp Support</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337600">Disabling spandsp (Should You Want to Test Digium Fax)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id260129">Digium Fax For Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id307516">Obtaining Digium FFA</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id319736">Disabling Digium FFA (Should You Want to Test spandsp)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id263810">Incoming Fax Handling</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259374">Fax to TIFF</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id265396">Outgoing Fax Handling</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36043799">Fax Pass-Through</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id405211">Using Fax Buffers in chan_dahdi.conf</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id245657">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI">20. Asterisk Manager Interface (AMI)</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart">Quick Start</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-TCP">AMI over TCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-configuration">Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248378">Protocol Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248495">Message Encoding</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248511">Events</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-HTTP">AMI over HTTP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248633">Authentication and session handling</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248689">/rawman encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248704">/manager encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248743">/mxml encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248859">Development Frameworks</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283296">CSTA</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-applications">Interesting Applications</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283341">AsteriskGUI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283424">Flash Operator Panel</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283482">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI">21. Asterisk Gateway Interface (AGI)</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart">Quick Start</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-variants">AGI Variants</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262615">Process-Based AGI</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262406">EAGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id265035">DeadAGI Is Dead</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI">FastAGI—AGI over TCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-communication">AGI Communication Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254321">Setting Up an AGI Session</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id268960">Async AGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242019">Ending an AGI Session</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242030">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254220">Async AGI</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id263225">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering">22. Clustering</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering-SECT-1">Traditional Call Centers</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282177">Hybrid Systems</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id258940">Pure Asterisk, Nondistributed</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282554">Asterisk and Database Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061021">Single Database</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060921">Asterisk and Distributed Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060610">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5">23. Distributed Universal Number Discovery (DUNDi)</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-14-SECT-6">How Does DUNDi Work?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id417246">Configuring Asterisk for Use with DUNDi</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id378872">General Configuration</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id399131">Initial DUNDi Peer Definition</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses">Controlling Responses</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id337604">Using pattern matches</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36002807">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring">24. System Monitoring and Logging</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262409">Reviewing Asterisk Logs</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262478">Logging to the Linux syslog Daemon</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id265067">Verifying Logging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin-SECT-1">Call Detail Records</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263137">Backends</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249846">cdr_manager</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249944">cdr_mysql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249958">cdr_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249972">cdr_pgsql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250127">cdr_sqlite</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250164">cdr_sqlite3_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250217">cdr_syslog</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_examples">Example Call Detail Records</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246856">Single-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246891">Two-party call</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246945">CEL (Channel Event Logging)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255966">Backends</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291820">cel_manager</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291890">cel_pgsql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292007">cel_sqlite3_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292095">Example Channel Events</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292126">Single-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292161">Two-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241628">SNMP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241664">Installing the SNMP Module for Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241674">CentOS dependency</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241703">Ubuntu dependency</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#recompile-ast-with-snmp">Recompiling Asterisk with the res_snmp module</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241824">Installing OpenNMS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241885">Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS
        server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#editing-snmpd-conf">Editing /etc/snmp/snmpd.conf to work with your OpenNMS
        server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id252037">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface">25. Web Interfaces</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id285574">Flash Operator Panel</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id281371">Queue Status and Reporting</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36038569">Queue Status Display</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36041966">Queue Reporting</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36036769">Call Detail Records</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042327">A2Billing</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id247202">Conclusion</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security">26. Security</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security-SECT-1">Scanning for Valid Accounts</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001183">Fail2ban</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001218">Installation</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001274">iptables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001330">Sending email</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001503">Encrypted Media</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001664">Securing Asterisk Network APIs</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001703">Other Risk Mitigation</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001714">Resources</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id260063">Conclusion—A Better Idiot</a></span></dt></dl></dd><dt><span class="chapter"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11">27. Asterisk: A Future for Telephony</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1">The Problems with Traditional Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.1">Closed Thinking</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.2">Limited Standards Compliancy</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.3">Slow Release Cycles</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.4">Refusing to Let Go of the Past and Embrace the Future</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-2">Paradigm Shift</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3">The Promise of Open Source Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.1">The Itch That Asterisk Scratches</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.2">Open Architecture</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.3">Standards Compliance</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.4">Lightning-Fast Response to New Technologies</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.5">Passionate Community</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6">Some Things That Are Now Possible</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.1">Legacy PBX migration gateway</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.3">Conference rooms</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4">The Future of Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1">Speech Processing</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.1">Festival</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.2">Speech recognition</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.2">High-Fidelity Voice</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3">Video</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.1">The challenge of videoconferencing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.2">Why we love videoconferencing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.3">Why videoconferencing may never totally replace voice</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4">Wireless</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.1">WiFi</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.2">WiMAX</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.5">Unified Messaging</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6">Peering</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.1">E.164</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.2">ENUM</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.3">e164.org</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7">Challenges</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.1">Too much change, too few standards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FutureTelephony_id337974">Toll fraud</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.2">VoIP spam</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.3">Fear, uncertainty, and doubt</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.4">Bottleneck engineering</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.6">Quality of service</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.7">Complexity</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8">Opportunities</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.1">Tailor-made private telecommunications networks</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.2">Low barrier to entry</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.3">Hosted solutions of similar complexity to corporate
        websites</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="appendix"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony">A. Understanding Telephony</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1">Analog Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1">Parts of an Analog Telephone</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.1">Ringer</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.2">Dialpad</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3">Hybrid (or network)</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2">Digital Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1">Pulse-Code Modulation</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.1">Digitally encoding an analog waveform</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.2">Increasing the sampling resolution and rate</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.3">Nyquist’s Theorem</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.4">Logarithmic companding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.5">Aliasing</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3">The Digital Circuit-Switched Telephone Network</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1">Circuit Types</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.1">The humble DS-0―The foundation of it all</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.2">T-carrier circuits</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.3">SONET and OC circuits</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2">Digital Signaling Protocols</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.1">Channel Associated Signaling (CAS)</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.2">ISDN</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-4">Packet-Switched Networks</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-5">Conclusion</a></span></dt></dl></dd><dt><span class="appendix"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP">B. Protocols for VoIP</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-1">The Need for VoIP Protocols</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2">VoIP Protocols</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1">IAX (The “Inter-Asterisk eXchange” Protocol)</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.4">IAX and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2">SIP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.4">SIP and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3">H.323</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.4">H.323 and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.4">MGCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5">Proprietary Protocols</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.1">Skinny/SCCP</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.2">UNISTIM</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.1">G.711</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.2">G.726</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.4">G.729A</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.5">GSM</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.6">iLBC</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.7">Speex</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id318733">G.722</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.8">MP3</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4">Quality of Service</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1">TCP, UDP, and SCTP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.1">Transmission Control Protocol</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.2">User Datagram Protocol</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.3">Stream Control Transmission Protocol</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.2">Differentiated Service</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3">Guaranteed Service</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.1">MPLS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.2">RSVP</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.4">Best Effort</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5">Echo</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.1">Why Echo Occurs</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.2">Managing Echo on DAHDI Channels</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6">Asterisk and VoIP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1">Users and Peers and Friends—Oh My!</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.1">Users</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.2">Peers</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.3">Friends</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.2">register Statements</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect18_tt1164">VoIP Security</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241778">Spam over Internet Telephony (SPIT)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241852">Spoofing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241868">What Can Be Done?</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241880">Basic network security</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252454">Encryption</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-7">Conclusion</a></span></dt></dl></dd><dt><span class="appendix"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning">C. Preparing a System for Asterisk</a></span></dt><dd><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1">Server Hardware Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2">Choosing a Processor</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.1">Small systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.2">Medium systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.3">Large systems</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.3">Choosing a Motherboard</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4">Power Supply Requirements</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.1">Computer power supplies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.2">Redundant power supplies</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2">Environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1">Power Conditioning and Uninterruptible Power Supplies</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1.1">Power-conditioned UPSs</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.2">Grounding</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.3">Electrical Circuits</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4">The Equipment Room</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.1">Humidity</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.2">Temperature</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.3">Dust</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3">Telephony Hardware</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1">Connecting to the PSTN</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.1">Analog interface cards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.2">Digital interface cards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.3">Channel banks</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.4">Other types of PSTN interfaces</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.2">Connecting Exclusively to a Packet-Based Telephone
      Network</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.3">Echo Cancellation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4">Types of Phones</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1">Physical Telephones</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.1">Analog telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.2">Proprietary digital telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.3">ISDN telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.4">IP telephones</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.2">Softphones</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.3">Telephony Adaptors</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.4">Communications Terminals</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-5">Linux Considerations</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-6">Conclusion</a></span></dt></dl></dd><dt><span class="index"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#book_id192672">Index</a></span></dt></dl></div><div class="list-of-figures"><p><strong>List of Figures</strong></p><dl><dt>2.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id264520">Asterisk vs. PBX architecture</a></dt><dt>2.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-1.6-release-process">The Asterisk 1.6.<span class="emphasis"><em>x</em></span> release process</a></dt><dt>3.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_newt">menuselect using the newt interface</a></dt><dt>3.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_curses">menuselect using the curses interface</a></dt><dt>5.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291038">Relationship of sip.conf to extensions.conf</a></dt><dt>5.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292168">SIP dialogs</a></dt><dt>6.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id36055184">Relation between channel configuration files and contexts in
        the dialplan</a></dt><dt>8.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293125">Simplified SIP enterprise environment</a></dt><dt>9.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#smart_network">The old days: dumb devices connect to a smart network</a></dt><dt>9.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dumb_network">The situation today: smart devices connect through a dumb
      network</a></dt><dt>9.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#balun-connection">A balun</a></dt><dt>9.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#bt-plug-diagram">The BT plug used for analog PSTN connections in the UK (note only
      pins 2–5 are present)</a></dt><dt>9.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-dahdi-relationship">The relationship between Linux, DAHDI, and Asterisk</a></dt><dt>10.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#TimeDelayedLocalChannels">Time delayed dialing with local channels</a></dt><dt>12.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#requestforassign">Request for Assignments form</a></dt><dt>14.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265356">Device state mappings</a></dt><dt>14.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265402">Extension state mappings</a></dt><dt>16.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB-FIG-1">Relationships between func_odbc.conf, res_odbc.conf,
      /etc/odbc.ini (unixODBC), and the database connection</a></dt><dt>18.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286334">Enabling Gmail IMAP</a></dt><dt>19.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36038507">Typical fax pass-through</a></dt><dt>20.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-events">Manager events</a></dt><dt>20.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-actions">Manager actions</a></dt><dt>20.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-actions2">Manager actions that return a list of data</a></dt><dt>20.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-AsteriskGUI">AsteriskGUI</a></dt><dt>20.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-FOP">Flash Operator Panel</a></dt><dt>22.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061191">Traditional call center</a></dt><dt>22.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061070">Remote hybrid system</a></dt><dt>22.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061143">Nondistributed Asterisk</a></dt><dt>22.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060940">Asterisk database integration, single server</a></dt><dt>22.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060872">Asterisk database integration, distributed database</a></dt><dt>22.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060787">Device state distribution with OpenAIS</a></dt><dt>22.7. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060551">Device state distribution with XMPP</a></dt><dt>22.8. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060591">Distributed queue infrastructure</a></dt><dt>23.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36000936">DUNDi peer-to-peer request system</a></dt><dt>24.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-channels">Graph of active Asterisk channels</a></dt><dt>24.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-DAHDI">Graph of active DAHDI channels</a></dt><dt>24.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-traffic">Graph of traffic on a network interface</a></dt><dt>25.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042163">FOP2</a></dt><dt>27.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-1">Asterisk as a PBX gateway</a></dt><dt>27.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-2">Find-me-follow-me</a></dt><dt>27.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-3">VoIP-enabling a legacy PBX</a></dt><dt>A.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-1">Tip and Ring</a></dt><dt>A.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-2">A simple sinusoidal (sine) wave</a></dt><dt>A.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-3">Sampling our sine wave using four bits</a></dt><dt>A.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-4">PCM encoded waveform</a></dt><dt>A.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-5">Plotted PCM signal</a></dt><dt>A.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-6">Delineated signal</a></dt><dt>A.7. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-7">The same waveform, on a higher-resolution overlay</a></dt><dt>A.8. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-8">The same waveform at double the resolution</a></dt><dt>A.9. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-9">Five-bit plotted PCM signal</a></dt><dt>A.10. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-10">Waveform delineated from five-bit PCM</a></dt><dt>A.11. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-11">Five-bit companding</a></dt><dt>A.12. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-12">Quantized and companded at 5-bit resolution</a></dt><dt>B.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FIG-1">The SIP trapezoid</a></dt><dt>B.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FIG-2">Call origination relationships of users, peers, and friends
          to Asterisk</a></dt><dt>C.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FIG-1">Visual identification of PCI slots</a></dt><dt>C.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FIG-2">One way you might connect a channel bank</a></dt></dl></div><div class="list-of-tables"><p><strong>List of Tables</strong></p><dl><dt>2.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241441">Dialplan applications</a></dt><dt>2.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291798">Bridging modules</a></dt><dt>2.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291914">Call detail recording modules</a></dt><dt>2.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292113">Channel event logging modules</a></dt><dt>2.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292254">Channel drivers</a></dt><dt>2.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292600">Codec translators</a></dt><dt>2.7. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292825">Format interpreters</a></dt><dt>2.8. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293094">Dialplan functions</a></dt><dt>2.9. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293725">PBX modules</a></dt><dt>2.10. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293886">Resource modules</a></dt><dt>2.11. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294470">Addon modules</a></dt><dt>3.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292315">Software dependencies for Asterisk on Ubuntu Server and CentOS
      Server</a></dt><dt>4.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259222">asterisk.conf [directories] section</a></dt><dt>4.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259444">asterisk.conf [options] section</a></dt><dt>4.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260157">asterisk.conf [files] section</a></dt><dt>4.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260275">asterisk.conf [compat] section</a></dt><dt>4.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id258884">modules.conf [modules] section</a></dt><dt>8.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272012">[general] section options for voicemail.conf</a></dt><dt>8.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id291550">Advanced options for voicemail.conf</a></dt><dt>8.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292277">[zonemessages] section options for voicemail.conf</a></dt><dt>8.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292600">VoiceMail() optional arguments</a></dt><dt>8.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292757">VoiceMailMain() optional arguments</a></dt><dt>9.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#internationalization_cheat">Internationalization cheat sheet</a></dt><dt>10.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#delayed_dialing">Delayed dialing using Local channels</a></dt><dt>11.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id244340">features.conf [general] section</a></dt><dt>11.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243783">features.conf [featuremap] section</a></dt><dt>11.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257235">Page() options</a></dt><dt>12.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#components_sipsrv">Components of a SIP SRV record</a></dt><dt>12.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288640">NameMapping table</a></dt><dt>13.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general_queues_id001">Available options for [general] section of queues.conf</a></dt><dt>13.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_defined_queues">Available options for defined queues in queues.conf</a></dt><dt>13.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general_header">Options available under the [general] header in
      agents.conf</a></dt><dt>13.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_agents_header">Options available under the [agents] header in agents.conf</a></dt><dt>13.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_prompt_control_timing_id001">Options related to prompt control timing within a queue</a></dt><dt>13.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_controlling_playback_prompts">Options for controlling the playback of prompts within a queue</a></dt><dt>13.7. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_joinempty">Options that can be set for joinempty or
          leavewhenempty</a></dt><dt>13.8. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#mapping_old_new_id001">Mapping between old and new values for controlling when
          callers join and leave queues</a></dt><dt>13.9. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289031">Events in the Asterisk queue log</a></dt><dt>14.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#table-virtualDevices">Virtual devices in Asterisk</a></dt><dt>15.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id259349">A basic automated attendant</a></dt><dt>16.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id288022">Summary of ast_hotdesk table</a></dt><dt>16.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id243292">Table layout and description of ast_config</a></dt><dt>16.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id243940">Minimal sippeers/sipusers realtime table</a></dt><dt>16.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276054">Example information used to populate the ast_sipfriends
        table</a></dt><dt>16.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276166">Realtime options in sip.conf</a></dt><dt>16.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276938">ODBC voicemail storage table layout</a></dt><dt>17.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id245719">The Read() application</a></dt><dt>18.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247120">IMAP library compile time options</a></dt><dt>18.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286503">Additional IMAP voicemail options</a></dt><dt>18.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255450">jabber.conf options</a></dt><dt>19.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dahdi_faxdetect">Possible values for the faxdetect option in
        chan_dahdi.conf</a></dt><dt>19.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sip_faxdetect">Possible values for the faxdetect option in sip.conf</a></dt><dt>20.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265404">Options in the manager.conf [general] section</a></dt><dt>20.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id286564">Options for [username] sections</a></dt><dt>20.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-readwriteopts">Available values for AMI user account read/write
        options</a></dt><dt>20.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273652">Options in the http.conf [general] section</a></dt><dt>20.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-frameworks">AMI development frameworks</a></dt><dt>21.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-variables">AGI environment variables</a></dt><dt>21.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-commands-table">AGI commands</a></dt><dt>21.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-frameworks">AGI development frameworks</a></dt><dt>23.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general">Options available in the [general] section</a></dt><dt>23.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_mappings">Options available in the [mappings] section</a></dt><dt>23.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_peerdef">Options available for peer definitions in dundi.conf</a></dt><dt>24.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id269148">logger.conf types</a></dt><dt>24.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#default_cdr_fields">Default CDR fields</a></dt><dt>24.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250739">cdr.conf [general] section</a></dt><dt>24.4. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263326">cdr_adaptive_odbc.conf table configuration options</a></dt><dt>24.5. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263534">cdr.conf [csv] section options</a></dt><dt>24.6. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250007">cdr.conf [radius] section options</a></dt><dt>24.7. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246970">CEL event types</a></dt><dt>24.8. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id247217">Defined but unused CEL event types</a></dt><dt>24.9. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255410">CEL event fields</a></dt><dt>24.10. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255818">cel.conf [general] section options</a></dt><dt>24.11. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id261215">Event type to integer value mappings for the eventtype
          column</a></dt><dt>24.12. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id261530">cel_odbc.conf table configuration</a></dt><dt>24.13. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291696">CEL variables available for use in [mappings]</a></dt><dt>24.14. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291925">Available options in the cel.conf [radius] section</a></dt><dt>A.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-1">DTMF digits</a></dt><dt>A.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-2">T-carrier circuits</a></dt><dt>A.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-3">OC circuits</a></dt><dt>B.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-TABLE-1">Codec quick reference</a></dt><dt>C.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-TABLE-1">System requirement guidelines</a></dt></dl></div><div class="list-of-examples"><p><strong>List of Examples</strong></p><dl><dt>14.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#custom-devstate-example">Custom “do not disturb” functionality using custom device
        states</a></dt><dt>14.2. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#jabberconf-server1">jabber.conf for server1</a></dt><dt>14.3. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#jabberconf-server2">jabber.conf for server2</a></dt><dt>19.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#email-to-fax-python">Proof of concept email to fax gateway, fax.py</a></dt><dt>21.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-hello-world-example">A sample AGI script, hello-world.sh</a></dt><dt>26.1. <a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#example-accountscan">Log excerpts from account scanning</a></dt></dl></div><div class="preface" title="Foreword"><div class="titlepage"><div><div><h2 class="title"><a id="foreword"></a>Foreword</h2></div><div><div class="author"><h3 class="author"><span class="surname">John Todd</span></h3></div></div></div></div><p>“There’s more than one way to do it.” I’ve been working with Asterisk
  for nine years, and this motto becomes more true with each release, each
  added feature, and each clever person who attacks a telecommunications
  problem with this incredibly flexible toolkit. I had the fantastic
  opportunity to work as the community manager for the Asterisk project at
  Digium for two years, which gave me one of the best vantage points for
  seeing the scope and imagination of the worldwide development effort pushing
  Asterisk forward. The depth and breadth of Asterisk is
  staggering—installations with hundreds of thousands of users are now
  commonplace. I see Asterisk making deep inroads into the financial,
  military, hospital, Fortune 100 enterprise, service provider, calling card,
  and mobile environments. In fact, there really aren’t any areas that I can
  think of where Asterisk isn’t now entrenched as the default choice when
  there is a need for a generalized voice tool to do “stuff.”</p><p>Asterisk has been emblematic of the way that open source software has
  changed business—and changed the world. My favorite part of any Asterisk
  project overview or conference talk is answering questions from someone new
  to Asterisk. As I continue to answer “Yes, it can do that,” I watch as the
  person’s eyes grow wide. The person starts to smile when he
  <span class="emphasis"><em>really</em></span> starts to think about new things to do that his
  old phone or communication system couldn’t possibly have done. Radio
  integration? Sure. Streaming MP3s into or out of phone calls? OK. Emailing
  recorded conference calls to the participants? No problem. Integration of
  voice services into existing Java apps? Easy. Fax? Instant messages? IVRs?
  Video? Yes, yes, yes, yes.</p><p>The affirmative answers just keep flowing, and at that point, the best
  thing to do is to sit the person down and start showing him quick
  demonstrations of how Asterisk can be quickly deployed and developed. Then,
  I typically point the person toward the first edition of this book, <a class="ulink" href="http://oreilly.com/catalog/9780596009625" target="_top"><span class="emphasis"><em>Asterisk: The
  Future of Telephony</em></span></a>, and set him loose. In just a few
  hours of development (or longer, of course), companies can change the way
  they deliver products to customers, nonprofits can overhaul how their users
  interact with the services they offer, and individuals can learn to build a
  perfectly customized call-handling system for their mobile and home phones.
  Asterisk scales up and down from individual lines to vast multiserver
  installations across multiple continents, but the way to start is to install
  the package, open up some of the configuration files, and start looking at
  examples.</p><p>From the basic beginnings of a PBX that Mark Spencer coded in 1999,
  the Asterisk project, with the help of thousands of developers, has moved
  from simply connecting phone calls and has matured into a platform that can
  handle voice, video, and text across dozens of virtual and physical
  interface types. The creation and growth of <span class="keep-together">Asterisk</span> were the inescapable results of the
  convergence of the four horsemen of the proprietary hardware apocalypse:
  open source development ideas, the Internet, Moore’s Law, and the plummeting
  costs of telecommunications. Even hardware vendors who may be frightened of
  Asterisk from a competitive standpoint are using it in their labs and core
  networks: almost all devices in the Voice-over-IP world are tested with
  <span class="keep-together">Asterisk</span>, making it the most
  compatible system across vendors.</p><p>At a recent communications conference I attended, the question “Who
  uses Asterisk?” was posed to the 1000-plus crowd. Nearly 75 percent raised
  their hands. Asterisk is a mature, robust software platform that permeates
  nearly every area of the telecommunications industry and has firmly cemented
  itself as one of the basic elements in any open source service delivery
  system. I tell people that it’s reasonable for anyone delivering services
  both via phone and web to want to add an “A” for Asterisk to the LAMP
  (Linux, Apache, MySQL, [Perl/Python/PHP]) acronym, making it LAAMP. (LAMA-P
  was another option, but for some reason nobody seems to like that version…I
  don’t know why.)</p><p>The expansion of this book to include more examples is something I’ve
  been looking forward to for some time. Asterisk is accessible because of the
  ease with which a novice can understand basic concepts. Then it continues to
  succeed as the novice becomes a pro and starts tapping the “other ways to do
  it” with more sophisticated implementations, using AGI with Java, Perl, or
  Python (or one of the other dozen or so supported languages), or even
  writing her own custom apps that work as compile-time options in Asterisk.
  But the first step for anyone, no matter what his or her skill level, is to
  look at examples of basic apps others have written. Leif, Jim, and Russell
  have not only put together a fantastic compendium of Asterisk methods, but
  they have also provided an excellent list of examples that will let the
  novice or expert quickly learn new techniques and “more than one way to do
  it.”</p><p>Asterisk 1.<span class="emphasis"><em>x</em></span> is fantastically powerful and can
  solve nearly any voice problem you might have. For those of you building the
  most complex installations, there is even more interesting work—which will
  be realized quite soon—in development. The currently-in-development Asterisk
  SCF (Scalable Communications Framework) is being built as an adjunct open
  source project to allow Asterisk 1.<span class="emphasis"><em>x</em></span> systems to scale
  in even more powerful ways—stay tuned, or better yet, get involved with the
  project as a developer.</p><p>If you’re an experienced Asterisk developer or integrator, I’m sure
  this book will have a few “Hey, that’s a neat way to do it!” moments for
  you, which is one of the joys of Asterisk. If this is your first project
  with Asterisk, I’d like to welcome you to the huge community of users and
  developers dedicated to making Asterisk better. This book will take you from
  a vague idea of doing something with computers and voice communication to
  the point where you’re able to stun everyone you know with your phone
  system’s sophisticated tricks.</p><p>You’re encouraged to participate in the online mailing lists, IRC
  chatrooms, and yearly AstriCon conference that provide up-to-the-second news
  and discussion surrounding the project. Without your interest, input, and
  code, Asterisk wouldn’t exist. Open source projects are hungry for new ideas
  and excellent contributions: I encourage you to be a participant in the
  Asterisk community, and I look forward to seeing your questions and examples
  in the next edition of this book.</p></div><div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-PREFACE"></a>Preface</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-1">Audience</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-2">Organization</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-3">Software</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-4">Conventions Used in This Book</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-5">Using Code Examples</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect1_tt2">Safari Books Online</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-7">How to Contact Us</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-PREFACE-SECT-8">Acknowledgments</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id505296">Leif Madsen</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#preface2_id269249">Jim Van Meggelen</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#preface2_id269241">Russell Bryant</a></span></dt></dl></dd></dl></div><p><a id="preface2_id319167"></a>This is a book for anyone who uses
  Asterisk.</p><p><a id="preface2_id303170"></a>Asterisk is an open source, converged telephony
  platform, which is designed primarily to run on Linux. Asterisk combines
  more than 100 years of telephony knowledge into a robust suite of tightly
  integrated telecommunications applications. The power of <span class="keep-together">Asterisk</span> lies in its customizable nature,
  complemented by unmatched standards compliance. No other PBX can be deployed
  in so many creative ways.</p><p><a id="preface2_id315952"></a>Applications such as voicemail, hosted
  conferencing, call queuing and agents, music on hold, and call parking are
  all standard features built right into the software. Moreover, Asterisk can
  integrate with other business technologies in ways that closed, proprietary
  PBXs can scarcely dream of.</p><p><a id="preface2_id301794"></a>Asterisk can appear quite daunting and complex
  to a new user, which is why documentation is so important to its growth.
  Documentation lowers the barrier to entry and helps people contemplate the
  possibilities.</p><p><a id="preface2_id301025"></a>Produced with the generous support of O’Reilly
  Media, <a class="ulink" href="http://oreilly.com/catalog/9780596517342/" target="_top"><span class="emphasis"><em>Asterisk:</em></span>
  <span class="emphasis"><em>The Definitive Guide</em></span></a> is the third edition of
  what was formerly called <span class="emphasis"><em><a class="ulink" href="http://oreilly.com/catalog/9780596009625/" target="_top">Asterisk: The Future of
  <span class="keep-together">Telephony</span></a></em></span>. We
  decided to change the name because Asterisk has been so wildly successful
  that it is no longer an up-and-coming technology. Asterisk has
  arrived.</p><p><a id="preface2_id325935"></a>This book was written for, and by, members of
  the Asterisk community.</p><div class="sect1" title="Audience"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-1"></a>Audience</h2></div></div></div><p><a id="preface2_id321193"></a>This book is intended to be gentle toward
    those new to Asterisk, but we assume that you’re familiar with basic Linux
    administration, networking, and other IT disciplines. If not, we encourage
    you to explore the vast and wonderful library of books that <span class="keep-together">O’Reilly</span> publishes on these subjects. We
    also assume you’re fairly new to telecommunications (both traditional
    switched telephony and the new world of Voice over IP).</p><p><a id="preface2_id323716"></a>However, this book will also be useful for
    the more experienced Asterisk administrator. We ourselves use the book as
    a reference for features that we haven’t used for a while.</p></div><div class="sect1" title="Organization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-2"></a>Organization</h2></div></div></div><p><a id="preface2_id314706"></a>The book is organized into these
    chapters:</p><div class="variablelist"><dl><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution" title="Chapter 1. A Telephony Revolution">Chapter&nbsp;1, <em>A Telephony Revolution</em></a>
        </span></dt><dd><p><a id="preface2_id334650"></a><a id="preface2_id334652"></a>This is where we chop up the kindling
          and light the fire. Welcome to Asterisk!</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch" title="Chapter 2. Asterisk Architecture">Chapter&nbsp;2, <em>Asterisk Architecture</em></a>
        </span></dt><dd><p><a id="preface2_id305820"></a><a id="preface2_id305822"></a>Discusses the file structure of an
          Asterisk system.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>
        </span></dt><dd><p><a id="preface2_id305839"></a><a id="preface2_id305841"></a>Covers obtaining, compiling, and
          installing Asterisk.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Initial" title="Chapter 4. Initial Configuration Tasks">Chapter&nbsp;4, <em>Initial Configuration Tasks</em></a>
        </span></dt><dd><p><a id="preface2_id305858"></a><a id="preface2_id269310"></a>Describes some initial configuration
          tasks for your new Asterisk system. This chapter goes over some of
          the configuration files required for all Asterisk <span class="keep-together">installations</span>.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a>
        </span></dt><dd><p><a id="preface2_id269328"></a><a id="preface2_id269331"></a>Provides guidance on configuring
          Asterisk to allow devices such as telephones to connect and make
          calls.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics" title="Chapter 6. Dialplan Basics">Chapter&nbsp;6, <em>Dialplan Basics</em></a>
        </span></dt><dd><p><a id="preface2_id269348"></a><a id="preface2_id269350"></a>Introduces the heart of Asterisk, the
          dialplan.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>
        </span></dt><dd><p><a id="preface2_id269367"></a><a id="preface2_id269369"></a>Discusses how to configure Asterisk to
          connect to other systems, such as other Asterisk servers, Internet
          telephony service providers, or the plain old telephone
          network.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail" title="Chapter 8. Voicemail">Chapter&nbsp;8, <em>Voicemail</em></a>
        </span></dt><dd><p><a id="preface2_id269388"></a><a id="preface2_id305443"></a>Covers the usage of one of the most
          popular applications included with Asterisk, the voicemail
          system.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization" title="Chapter 9. Internationalization">Chapter&nbsp;9, <em>Internationalization</em></a>
        </span></dt><dd><p><a id="preface2_id305461"></a><a id="preface2_id305463"></a>Focuses on issues that an Asterisk
          administrator should be aware of when deploying a system outside of
          North America.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper" title="Chapter 10. Deeper into the Dialplan">Chapter&nbsp;10, <em>Deeper into the Dialplan</em></a>
        </span></dt><dd><p><a id="preface2_id305481"></a><a id="preface2_id305483"></a>Goes over some more advanced dialplan
          concepts.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin" title="Chapter 11. Parking and Paging">Chapter&nbsp;11, <em>Parking and Paging</em></a>
        </span></dt><dd><p><a id="preface2_id305499"></a><a id="preface2_id305501"></a>Describes the usage of two popular
          telephony features included with Asterisk, call parking and
          paging.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR" title="Chapter 12. Internet Call Routing">Chapter&nbsp;12, <em>Internet Call Routing</em></a>
        </span></dt><dd><p><a id="preface2_id305519"></a><a id="preface2_id305125"></a>Covers techniques for routing calls
          between different administrative domains on the Internet.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD" title="Chapter 13. Automatic Call Distribution (ACD) Queues">Chapter&nbsp;13, <em>Automatic Call Distribution (ACD) Queues</em></a>
        </span></dt><dd><p><a id="preface2_id305141"></a><a id="preface2_id305144"></a>Discusses how to build call queues in
          Asterisk.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates" title="Chapter 14. Device States">Chapter&nbsp;14, <em>Device States</em></a>
        </span></dt><dd><p><a id="preface2_id305160"></a><a id="preface2_id305162"></a>Introduces the concept of device states
          and how they can be used as presence indicators.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a>
        </span></dt><dd><p><a id="preface2_id305180"></a><a id="preface2_id305182"></a>Covers how to build a menuing system
          using the Asterisk dialplan.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>
        </span></dt><dd><p><a id="preface2_id305199"></a><a id="preface2_id305201"></a>Discusses various ways that Asterisk
          can be integrated with a database.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR" title="Chapter 17. Interactive Voice Response">Chapter&nbsp;17, <em>Interactive Voice Response</em></a>
        </span></dt><dd><p><a id="preface2_id305217"></a><a id="preface2_id305219"></a>Goes over how Asterisk can be used to
          build applications that act on input provided by a caller.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>
        </span></dt><dd><p><a id="preface2_id343837"></a><a id="preface2_id343839"></a>Provides instructions on how to connect
          to external services including LDAP, calendars, IMAP for voicemail,
          XMPP, Skype, and text-to-speech.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax" title="Chapter 19. Fax">Chapter&nbsp;19, <em>Fax</em></a>
        </span></dt><dd><p><a id="preface2_id343855"></a><a id="preface2_id343857"></a>Discusses the various options for
          integrating sending and receiving faxes with an Asterisk
          system.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>
        </span></dt><dd><p><a id="preface2_id343873"></a><a id="preface2_id343875"></a>Introduces a network API for monitoring
          and controlling an Asterisk system.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI" title="Chapter 21. Asterisk Gateway Interface (AGI)">Chapter&nbsp;21, <em>Asterisk Gateway Interface (AGI)</em></a>
        </span></dt><dd><p><a id="preface2_id343890"></a><a id="preface2_id343892"></a>Introduces the Asterisk API that allows
          call control to be implemented in any programming language.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering" title="Chapter 22. Clustering">Chapter&nbsp;22, <em>Clustering</em></a>
        </span></dt><dd><p><a id="preface2_id343908"></a><a id="preface2_id343910"></a>Discusses a number of approaches for
          clustering multiple Asterisk servers together once the demands of a
          deployment exceed the capabilities of a single server.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5" title="Chapter 23. Distributed Universal Number Discovery (DUNDi)">Chapter&nbsp;23, <em>Distributed Universal Number Discovery (DUNDi)</em></a>
        </span></dt><dd><p><a id="preface2_id343926"></a><a id="preface2_id343928"></a>Covers a peer-to-peer protocol native
          to Asterisk that can be used for call routing.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring" title="Chapter 24. System Monitoring and Logging">Chapter&nbsp;24, <em>System Monitoring and Logging</em></a>
        </span></dt><dd><p><a id="preface2_id343944"></a><a id="preface2_id343946"></a>Introduces some of the interfaces
          available for logging and monitoring an Asterisk system.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface" title="Chapter 25. Web Interfaces">Chapter&nbsp;25, <em>Web Interfaces</em></a>
        </span></dt><dd><p><a id="preface2_id343961"></a><a id="preface2_id343963"></a>A survey of some of the web interfaces
          that complement an Asterisk installation.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a>
        </span></dt><dd><p><a id="preface2_id343978"></a><a id="preface2_id343980"></a>Discusses some common security issues
          that Asterisk administrators should be aware of.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11" title="Chapter 27. Asterisk: A Future for Telephony">Chapter&nbsp;27, <em>Asterisk: A Future for Telephony</em></a>
        </span></dt><dd><p><a id="preface2_id343995"></a><a id="preface2_id343997"></a>In conclusion, we discuss some of the
          things we expect to see from open source telephony in the near
          future.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>
        </span></dt><dd><p><a id="preface2_id344014"></a><a id="preface2_id344016"></a>Explores the technologies in use in
          traditional telecom networks. This used to be a chapter in old
          versions of this book. Although not directly relevant to Asterisk we
          felt that it might still be useful to some readers, so we’ve left it
          in the book as an appendix.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>
        </span></dt><dd><p><a id="preface2_id344031"></a><a id="preface2_id344033"></a>Delves into all the particularities of
          Voice over IP. This was also a chapter in old versions of this
          book.</p></dd><dt><span class="term">
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning" title="Appendix C. Preparing a System for Asterisk">Appendix&nbsp;C, <em>Preparing a System for Asterisk</em></a>
        </span></dt><dd><p><a id="preface2_id344047"></a><a id="preface2_id344050"></a>Contains information you should be
          aware of and take into consideration when planning an Asterisk
          deployment.</p></dd></dl></div></div><div class="sect1" title="Software"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-3"></a>Software</h2></div></div></div><p><a id="preface2_id344063"></a>This book is focused on documenting Asterisk
    version 1.8; however, many of the conventions and much of the information
    in this book is version-agnostic. Linux is the operating system we have
    run and tested Asterisk on, and we have documented installation
    instructions for both CentOS (Red Hat Enterprise Linux–based) and Ubuntu
    (Debian-based) where they differ from each other.</p></div><div class="sect1" title="Conventions Used in This Book"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-4"></a>Conventions Used in This Book</h2></div></div></div><p><a id="preface2_id344083"></a>The following typographical conventions are
    used in this book:</p><div class="variablelist"><dl><dt><span class="term">
          <span class="emphasis"><em>Italic</em></span>
        </span></dt><dd><p><a id="preface2_id344094"></a><a id="preface2_id344097"></a>Indicates new terms, URLs, email
          addresses, filenames, file extensions, pathnames, directories, and
          package names, as well as Unix utilities, commands, options, <span class="keep-together">parameters</span>, and arguments.</p></dd><dt><span class="term">
          <code class="literal">Constant
        width</code>
        </span></dt><dd><p><a id="preface2_id344114"></a><a id="preface2_id344116"></a>Used to display code samples, file
          contents, command-line interactions, library names, and database
          commands.</p></dd><dt><span class="term">
          <strong class="userinput"><code>Constant width
        bold</code></strong>
        </span></dt><dd><p><a id="preface2_id344132"></a><a id="preface2_id344135"></a>Indicates commands or other text that
          should be typed literally by the user. Also used for emphasis in
          code.</p></dd><dt><span class="term">
          <em class="replaceable"><code>Constant width italic</code></em>
        </span></dt><dd><p><a id="preface2_id344147"></a><a id="preface2_id344150"></a>Shows text that should be replaced with
          user-supplied values.</p></dd><dt><span class="term">
          <em class="replaceable"><code>[ Keywords and other stuff
        ]</code></em>
        </span></dt><dd><p><a id="preface2_id344167"></a><a id="preface2_id344169"></a>Indicates optional keywords and
          arguments.</p></dd><dt><span class="term">
          <em class="replaceable"><code>{ choice-1 | choice-2
        }</code></em>
        </span></dt><dd><p><a id="preface2_id344185"></a><a id="preface2_id344187"></a>Signifies either
          <em class="replaceable"><code>choice-1</code></em> or
          <em class="replaceable"><code>choice-2</code></em>.</p></dd></dl></div><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-PREFACE-NOTE-1"></a>Tip</h3><p><a id="preface2_id344206"></a>This icon signifies a tip, suggestion, or
      general note.</p></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-PREFACE-NOTE-2"></a>Warning</h3><p><a id="preface2_id344217"></a>This icon indicates a warning or
      caution.</p></div></div><div class="sect1" title="Using Code Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-5"></a>Using Code Examples</h2></div></div></div><p><a id="preface2_id344229"></a>This book is here to help you get your job
    done. In general, you may use the code in this book in your programs and
    documentation. You do not need to contact us for permission unless you’re
    reproducing a significant portion of the code. For example, writing a
    program that uses several chunks of code from this book does not require
    permission. Selling or distributing a CD-ROM of examples from O’Reilly
    books does require permission. Answering a question by citing this book
    and quoting example code does not require permission. Incorporating a
    significant amount of example code from this book into your product’s
    documentation does require permission.</p><p><a id="preface2_id344241"></a>We appreciate, but do not require,
    attribution. An attribution usually includes the title, author, publisher,
    and ISBN. For example: “<span class="emphasis"><em>Asterisk: The Definitive
    Guide</em></span>, Third Edition, by Leif Madsen, Jim Van Meggelen, and
    Russell Bryant (O’Reilly). Copyright 2011 Leif Madsen, Jim Van Meggelen,
    and Russell Bryant, 978-0-596-51734-2.”</p><p><a id="preface2_id344252"></a>If you feel your use of code examples falls
    outside fair use or the permission given above, feel free to contact us at
    <code class="email">&lt;<a class="email" href="mailto:permissions@oreilly.com">permissions@oreilly.com</a>&gt;</code>.</p></div><div class="sect1" title="Safari Books Online"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="I_sect1_tt2"></a>Safari Books Online</h2></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="preface2_id344272"></a>When you see a Safari Books Online icon on
      the cover of your favorite technology book, that means the book is
      available online through the O’Reilly Network Safari Bookshelf.</p></div><p><a id="preface2_id344280"></a>Safari offers a solution that’s better than
    ebooks. It’s a virtual library that lets you easily search thousands of
    top tech books, cut and paste code samples, download chapters, and find
    quick answers when you need the most accurate, current information. Try it
    for free at <a class="ulink" href="http://safari.oreilly.com/" target="_top">http://safari.oreilly.com</a>.</p></div><div class="sect1" title="How to Contact Us"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-7"></a>How to Contact Us</h2></div></div></div><p><a id="preface2_id344304"></a>Please address comments and questions
    concerning this book to the publisher:</p><a id="preface2_id344308"></a><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a id="preface2_id344312"></a>O’Reilly Media, Inc.</td></tr><tr><td><a id="preface2_id344315"></a>1005 Gravenstein Highway North</td></tr><tr><td><a id="preface2_id344318"></a>Sebastopol, CA 95472</td></tr><tr><td><a id="preface2_id344322"></a>(800) 998-9938 (in the United States or
      Canada)</td></tr><tr><td><a id="preface2_id344325"></a>(707) 829-0515 (international or
      local)</td></tr><tr><td><a id="preface2_id344328"></a>(707) 829-0104 (fax)</td></tr></tbody></table><p><a id="preface2_id344332"></a>We have a web page for this book, where we
    list errata, examples, and any additional information. You can access this
    page at:</p><a id="preface2_id344337"></a><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a id="preface2_id344341"></a>
        <a class="ulink" href="http://oreilly.com/catalog/9780596517342" target="_top">http://oreilly.com/catalog/9780596517342</a>
      </td></tr></tbody></table><p><a id="preface2_id344348"></a>To comment or ask technical questions about
    this book, send email to:</p><a id="preface2_id344352"></a><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a id="preface2_id344356"></a>
        <code class="email">&lt;<a class="email" href="mailto:bookquestions@oreilly.com">bookquestions@oreilly.com</a>&gt;</code>
      </td></tr></tbody></table><p><a id="preface2_id344362"></a>For more information about our books,
    conferences, Resource Centers, and the <span class="keep-together">O’Reilly</span> Network, see our website at:</p><a id="preface2_id344367"></a><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><a id="preface2_id344371"></a>
        <a class="ulink" href="http://www.oreilly.com/" target="_top">http://www.oreilly.com</a>
      </td></tr></tbody></table><p>Find us on Facebook: <a class="ulink" href="http://facebook.com/oreilly" target="_top">http://facebook.com/oreilly</a></p><p>Follow us on Twitter: <a class="ulink" href="http://twitter.com/oreillymedia" target="_top">http://twitter.com/oreillymedia</a></p><p>Watch us on YouTube: <a class="ulink" href="http://www.youtube.com/oreillymedia" target="_top">http://www.youtube.com/oreillymedia</a></p></div><div class="sect1" title="Acknowledgments"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-PREFACE-SECT-8"></a>Acknowledgments</h2></div></div></div><p>To David Duffett, thanks for the excellent chapter on
    internationalization, which would not have been served well by being
    written by us North Americans.</p><p><a id="preface2_id344387"></a>Next, we want to thank our fantastic editor,
    Michael Loukides, for your patience with this third edition, which took
    too long to get off the ground, and many long months to finally get
    written. Mike offered invaluable feedback and found incredibly tactful
    ways to tell us to rewrite a section (or chapter) when it was needed, and
    make us think it was our idea. Mike built us up when we were down, and
    brought us back to earth when we got uppity. You are a master, Mike, and
    seeing how many books have received your editorial oversight contributes
    to an understanding of why O’Reilly Media is the success that it
    is.</p><p><a id="preface2_id344399"></a>Thanks also to Rachel Head (nee Rachel
    Wheeler), our copyeditor, who fixes all our silly grammar, spelling, and
    style mistakes (and the many Canadianisms that Leif and Jim feel compelled
    to include), and somehow leaves the result reading as if it was what we
    wrote in the first place. Copyeditors are the unsung heroes of publishing,
    and Rachel is one of the very best.</p><p>Also thanks to Teresa Elsey, our production editor, and the rest of
    the unsung heroes in O’Reilly’s production department.</p><p>These are the folks that take our book and make it an
    <span class="emphasis"><em>O’Reilly book</em></span>.</p><p>During the course of writing this book, we had the pleasure of being
    able to consult with many people with specific experience in various
    areas. Their generous contributions of time and expertise were
    instrumental in our research. Thanks to Randy Resnick, organizer of the
    VoIP User Group; Kevin Fleming of Digium; Lee Howard, author of iaxmodem
    and hylafax; Joshua Colp of Digium; Phillip Mullis of the Toronto Asterisk
    Users Group; Allison Smith, the Voice of Asterisk; Flavio E. Goncalves,
    author of books on Asterisk, OpenSER, and OpenSIPS; J. Oquendo, Security
    Guru; Tzafrir Cohen, font of knowledge about security and lots of other
    stuff; Jeff Gehlbach, for SNMP; Ovidiu Sas, for your encyclopedic knowlege
    of SIP; Tomo Takebe, for some SMDI help; Steve Underwood, for help with
    fax and <code class="literal">spandsp</code>; and Richard Genthner and John Covert,
    for helping with LDAP.</p><p>A special thanks should also go to John Todd for being one of the
    first to write comprehensive Asterisk how-tos, all those years ago, and
    for all the many other things you do (and have done) for the Asterisk
    community.</p><div class="sidebar" title="Open Feedback Publishing System (OFPS)"><a id="I_sidebar_d1e609"></a><div class="titlepage"><div><div><p class="title"><strong>Open Feedback Publishing System (OFPS)</strong></p></div></div></div><p>While we were writing this book, O’Reilly introduced its Open
      Feedback Publishing System (OFPS), which allowed our book to appear on
      the Web as we were writing it. Community members were able to submit
      feedback and comments, which was of enormous help to us. The following
      is a list of their names or handles<sup>[<a id="id505214" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id505214" class="footnote">1</a>]</sup>:</p><div class="blockquote"><blockquote class="blockquote"><p>Matthew McAughan, Matt Pusateri, David Van Ginneken, Asterisk
        Mania, <span class="keep-together">Giovanni</span> Vallesi, Mark
        Petersen, thp4, David Row, tvc123, Frederic Jean, John Todd, Steven
        Sokol, Laurent Steffan, Robert Dailey, Howard Harper, Joseph Rensin,
        Howard White, Jay Eames, Vincent Thomasset, Dave Barnow, Sebastien
        Dionne, Igor Nikolaev, Arend van der Kolk, Anwar Hossain, craigesmith,
        nkabir, anest, Nicholas Barnes, Alex Neuman, Justin Korkiner, Stefan
        Schmidt, pabelanger, jfinstrom, roderickmontgomery, Shae Erisson,
        Gaston Draque, Richard <span class="keep-together">Genthner</span>,
        Michael S Collins, and Jeff Peeler</p></blockquote></div><p>Thanks to all of you for your valuable contribution to this
      book.</p></div><p>Thanks to Sean Bright, Ed Guy, Simon Ditner, and Paul Belanger for
    assisting us with clarifying best practices for user and group policies
    for Asterisk installation. In the past it was common to just install
    Asterisk with <span class="emphasis"><em>root</em></span> permissions, but we have elected
    to describe an installation process that is more in keeping with Linux
    best practices,<sup>[<a id="id505259" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id505259" class="footnote">2</a>]</sup> and these fine gents contributed to our discussions on
    that.</p><p><a id="preface2_id269298"></a>Kudos to all the folks working on the
    FreeSWITCH, YATE, SER, Kamailio, OpenSIPS, SER, sipXecs, Woomera, and any
    other open source telecom projects, for stimulating new thoughts, and for
    pushing the envelope.</p><p><a id="preface2_id344411"></a>Everyone in the Asterisk community also needs
    to thank Jim Dixon for creating the first open source telephony hardware
    interfaces, starting the revolution, and giving his creations to the
    community at large.</p><p><a id="preface2_id269304"></a>Finally, and most importantly, thanks go to
    Mark Spencer, the original author of <span class="keep-together">Asterisk</span> and founder of Digium, for
    Asterisk, for Pidgin (<a class="ulink" href="http://www.pidgin.im/" target="_top">http://www.pidgin.im</a>), and for
    contributing his creations to the open source community. Asterisk is your
    legacy!</p><div class="sect2" title="Leif Madsen"><div class="titlepage"><div><div><h3 class="title"><a id="id505296"></a>Leif Madsen</h3></div></div></div><p>It sort of amazes me where I started with Asterisk, and where I’ve
      gone with Asterisk. In 2002, while attending school, a bunch of my
      friends and myself were experimenting with voice over the Internet using
      Microsoft’s MSN product. It worked quite well, and allowed us to play
      video games while conversing with each other—at least, until we wanted
      to add a third participant. So, I went out searching for some software
      that could handle multiple voices (the word was conferencing, but I
      didn’t even know that at the time, having had little exposure to PBX
      platforms). I searched the Internet but didn’t find anything in
      particular I liked (or that was free). I turned to IRC and explained
      what I was looking for. Someone (I wish I knew who) mentioned that I
      should check out some software called Asterisk (he presumably must have
      thought I was looking for <code class="literal">MeetMe()</code>, which I
      was).</p><p>Having the name, I grabbed the software and started looking at
      what it could do. Incredibly, the functionality I was looking for, which
      I thought would be the entirety of the software, was only one component
      in a sea of functionality. And having run a BBS for years prior to going
      to college, the fact that I could install a PCI card and connect it to
      the phone network was not lost on me. After a couple of hours of looking
      at the software and getting it compiled, I started telling one of my
      teachers about the PCI cards and how maybe we could get some for the
      classroom for labs and such (our classroom had 30 computers at 10 tables
      of 3). He liked the idea and started talking to the program coordinator,
      and within about 30 minutes an order had been placed for 20 cards.
      Pretty amazing considering they were TDM400Ps decked out with four
      daughter cards, and they had only heard about them an hour prior to
      that.</p><p>Then the obsession began. I spent every extra moment of that
      semester with a couple of computers dedicated to Asterisk use. In those
      two months, I learned a lot. Then we had a co-op break. I didn’t find
      any work immediately, so I moved home and continued working on Asterisk,
      spending time on IRC, reading through examples posted by John Todd, and
      just trying to wrap my head around how the software worked. Luckily I
      had a lot of help on IRC (for these were the days prior to any
      documentation on Asterisk), and I learned a lot more during that
      semester.</p><p>Seeing that the people who took a great interest in Asterisk at
      the time had a strong sense of community and wanted to contribute back,
      I wanted to do the same. Having no practical level of coding knowledge,
      I decided documentation would be something useful to start doing.
      Besides, I had been writing a lot of papers at school, so I was getting
      better at it. One night I put up a website called The Asterisk
      Documentation Assigned (TADA) and started writing down any documentation
      I could. A couple of weeks later Jared Smith and I started talking, and
      started the Asterisk Documentation Project (<a class="ulink" href="http://www.asteriskdocs.org/" target="_top">http://www.asteriskdocs.org</a>), with the goal of writing an
      Asterisk book for the community. That project became the basis of the
      first edition of this book, <span class="emphasis"><em>Asterisk: The Future of
      Telephony</em></span>.</p><p>Nine years later, I’m still writing Asterisk documentation and
      have become the primary bug marshal and release manager for the Asterisk
      project, spoken at every single <span class="keep-together">AstriCon</span> since 2004 (at which Jared and I
      spoke about the Asterisk Documentation Project; I still have the
      AsteriskDocs magnet his wife made), and become a consultant specializing
      in database integration (thanks Tilghman for
      <code class="literal">func_odbc</code>) and clustering (thanks Mark Spencer for
      DUNDi). I really love Asterisk, and all that it’s allowed me to
      do.</p><p>First, thanks to my parents Rick and Carol, for the understanding
      and support in everything I’ve done in my life. From the first computer
      they purchased for far too much money when I was in grade 6 (I started
      taking an interest in computers in grade 2 using a Commodore 64, and
      they got me a computer after a parent-teacher interview a few years
      later) to letting me use the home phone line for my BBS endeavors (and
      eventually getting me my own phone line), and everything else they have
      ever done for me, I can never thank them enough. I love you both more
      than you’ll ever imagine.</p><p>Thanks to my Grandma T for letting me use her 286 during the years
      when I didn’t have a computer at home, and for taking me shopping every
      year on my birthday for 15 years. Love lots!</p><p>To my beautiful wife, Danielle, for setting the alarm every
      morning before she left for work, letting me sleep those extra 10
      minutes before starting on this book, and understanding when I had to
      work late because I went past my 9 A.M. stop-writing time, thank you and
      I love you so much.</p><p>There are so many people who help me and teach me new things every
      day, but the most influential on my life in Asterisk are the following:
      Mark Spencer for writing software that has given me a fantastic career,
      John Todd for his early examples, Brian K. West for his early help and
      enthusiasm on IRC, Steve Sokol and Olle Johansson for flying me to my
      first AstriCon (and subsequent ones!) and letting me be part of the
      first Asterisk training classes, Jared Smith for helping start the
      documentation project and doing all the infrastructure that I could
      never have done, Jim Van Meggelen for joining in early on the project
      and teaching me new ways to look at life, and Russell Bryant for being
      an amazing project leader and easy to work with every day, and for not
      holding a grudge about the bush.</p></div><div class="sect2" title="Jim Van Meggelen"><div class="titlepage"><div><div><h3 class="title"><a id="preface2_id269249"></a>Jim Van Meggelen</h3></div></div></div><p><a id="preface2_id269254"></a>When we set out to write the very first
      edition of this book over five years ago, we were confident that
      Asterisk was going to be a huge success. Now, a half-decade later, we’ve
      written this third edition of what the worldwide Asterisk community
      calls “The Asterisk Book,” and we’ve matured from revolutionaries into
      Asterisk professionals.</p><p>Asterisk has proven that open source telecom is a lasting idea,
      and the open source telecom landscape is nowadays complemented by more
      than just Asterisk. Projects like Freeswitch, sipXecs (from SipFoundry),
      OpenSER/Kamailio/OpenSIPS, and many, many more (and more to come) help
      to round out the ecosystem.</p><p>I want to take this opportunity to thank my very good friend Leif
      Madsen, who has been with me through all three editions. In our daily
      lives we don’t always have many opportunities to work with each other
      (or even grab a pint, these days!), and it’s always a delight to work
      with you. I also want to thank Russell Bryant, who joined us for this
      edition, and whose dedication to this project and the Asterisk project
      in general is an inspiration to me. You’re a Renaissance man, Russell.
      To Jared Smith, who helped found the Asterisk Documentation Project and
      coauthored the first two editions with Leif and me (but has since moved
      on to the Fedora project), I can only say: Asterisk’s loss is Fedora’s
      gain.</p><p>I would like to thank my business partners at Core Telecom
      Innovations and iConverged LLC, without whom I could not do all the cool
      things I get to do in my professional career.</p><p>I would like to thank all my friends in the improv community, for
      helping me to keep laughing at all the challenges that life
      presents.</p><p>Thanks to all my family, who bring love into my life.</p><p>Finally, thanks to you, the Asterisk community. This book is our
      gift to you. We hope you enjoy reading it as much as we’ve enjoyed
      writing it.</p></div><div class="sect2" title="Russell Bryant"><div class="titlepage"><div><div><h3 class="title"><a id="preface2_id269241"></a>Russell Bryant</h3></div></div></div><p><a id="preface2_id269246"></a>I started working on Asterisk in 2004. I
      was a student at Clemson University and was working as a co-op engineer
      at ADTRAN in Huntsville, Alabama. My first job at <span class="keep-together">ADTRAN</span> was working in the Product
      Qualification department. I remember working with Keith Morgan to use
      Asterisk as a VoIP traffic generator for testing QoS across a router
      test network. Meanwhile, a fellow co-op and friend, Adam Schreiber,
      introduced me to Mark Spencer. Over the next six months, I immersed
      myself in Asterisk. I learned as much as I could about Asterisk,
      telephony, and C programming. When Asterisk 1.0 was released in the fall
      of 2004, I was named the release maintainer.</p><p>At the beginning of 2005, I was hired by Digium to continue my
      work on Asterisk professionally. I have spent the past six amazing years
      working with Digium to improve Asterisk. I have worked as a software
      developer, a software team lead, and now as the engineering manager of
      the Asterisk development team. I am extremely grateful for the
      opportunity to contribute to so many areas of the Asterisk project.
      There are many people that deserve thanks for the support they have
      provided along the way.</p><p>To my wife, Julie, I cannot thank you enough for all the love and
      support you have given me. Thank you for keeping my life balanced and
      happy. You are the best. I love you!</p><p>To my parents, thank you for giving me so many great opportunities
      in my life to explore different things and find what I really enjoy. You
      taught me to work hard and never give up.</p><p>To Leif and Jim, thank you for your invitation to contribute to
      this book. It has been a fun project, largely due to the pleasure of
      working with the two of you. Thanks for the laughs and for your
      dedication to this book as a team effort.</p><p>I have learned a lot from many people at Digium. There are three
      people who stand out the most as my mentors: Mark Spencer, Kevin P.
      Fleming, and David Deaton. Thank you all for going the extra mile to
      teach me along the way. I am extremely grateful.</p><p>To the software development team at Digium, thank you for being
      such an amazing team to work with. Your dedication and brilliance play a
      huge part in the success of Asterisk and make Digium a great place to
      work.</p><p>To Travis Axtell, thank you for your help in my early days of
      learning about Linux and for being a good friend.</p><p>To my dogs, Chloe and Baxter, thanks for keeping me company while
      I worked on the book every morning.</p><p>To all of my friends and family, thank you for your love, support,
      and fun times.</p><p>To the entire Asterisk community, thank you for using, enjoying,
      and contributing to Asterisk. We hope you enjoy the book!</p><p>
        <a id="I_indexterm_d1e732" class="indexterm"></a>
        <a id="I_indexterm_d1e737" class="indexterm"></a>
        <a id="I_indexterm_d1e742" class="indexterm"></a>
        <a id="I_indexterm_d1e747" class="indexterm"></a>
        <a id="I_indexterm_d1e752" class="indexterm"></a>
        <a id="I_indexterm_d1e757" class="indexterm"></a>
        <a id="I_indexterm_d1e762" class="indexterm"></a>
        <a id="I_indexterm_d1e767" class="indexterm"></a>
        <a id="I_indexterm_d1e772" class="indexterm"></a>
        <a id="I_indexterm_d1e777" class="indexterm"></a>
        <a id="I_indexterm_d1e782" class="indexterm"></a>
        <a id="I_indexterm_d1e788" class="indexterm"></a>
        <a id="I_indexterm_d1e793" class="indexterm"></a>
        <a id="I_indexterm_d1e798" class="indexterm"></a>
        <a id="I_indexterm_d1e803" class="indexterm"></a>
        <a id="I_indexterm_d1e808" class="indexterm"></a>
        <a id="I_indexterm_d1e813" class="indexterm"></a>
        <a id="I_indexterm_d1e818" class="indexterm"></a>
        <a id="I_indexterm_d1e823" class="indexterm"></a>
        <a id="I_indexterm_d1e828" class="indexterm"></a>
        <a id="I_indexterm_d1e833" class="indexterm"></a>
        <a id="I_indexterm_d1e838" class="indexterm"></a>
        <a id="I_indexterm_d1e844" class="indexterm"></a>
        <a id="I_indexterm_d1e849" class="indexterm"></a>
        <a id="I_indexterm_d1e854" class="indexterm"></a>
      </p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id505214" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id505214" class="para">1</a>] </sup>We tried wherever possible to include the contributors’ names,
          but in some cases could not, and therefore included their handles
          instead.</p></div><div class="footnote"><p><sup>[<a id="ftn.id505259" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id505259" class="para">2</a>] </sup>Without starting a holy war!</p></div></div></div><div class="chapter" title="Chapter 1. A Telephony Revolution"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Revolution"></a>Chapter&nbsp;1.&nbsp;A Telephony Revolution</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1">Asterisk and VoIP: Bridging the Gap Between Traditional and Network
    Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1.1">The Zapata Telephony Project</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-2">Massive Change Requires Flexible Technology</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-3">Asterisk: The Hacker’s PBX</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-4">Asterisk: The Professional’s PBX</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5">The Asterisk Community</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.2">Asterisk Wiki Sites</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.3">The IRC Channels</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.4">Asterisk User Groups</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-6">The Business Case</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-7">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Revolution_id339543"></a>First they ignore you, then they laugh at
    you, <span class="keep-together">then they fight you</span>, then you
    win.</p><div class="attribution"><span>—<span class="attribution">Mahatma Gandhi</span></span></div></div><p><a id="Revolution_id338102"></a><a id="index-407M164QH1I" class="indexterm"></a><a id="index-735K885MP1A" class="indexterm"></a>When we first set out—nearly five years ago—to write a book
  about Asterisk, we confidently predicted that Asterisk would fundamentally
  change the telecommunications industry. Today, the revolution we predicted
  is all but complete. Asterisk is now the most successful private branch
  exchange (PBX) in the world, and is an accepted (albeit perhaps not always
  loved) technology in the telecom industry.</p><p><a id="Revolution_id301612"></a>Unfortunately, over the past five years the
  telecom industry has continued to lose its way. The methods by which we
  communicate have changed. Whereas 20 years ago phone calls were the
  preferred way to converse across distances, the current trend is to message
  via text (email, IM, etc.). The phone call is seen as a bit of a dead thing,
  especially by up-and-coming generations.</p><p><a id="Revolution_id316895"></a>Asterisk remains pretty awesome technology,
  and we believe it is still one of the best hopes for any sort of sensible
  integration between telecom and all the other technologies businesses might
  want to interconnect with.</p><p><a id="Revolution_id314099"></a>With Asterisk, no one is telling you how your
  phone system should work, or what technologies you are limited to. If you
  want it, you can have it. Asterisk lovingly embraces the concept of
  standards compliance, while also enjoying the freedom to develop its own
  innovations. What you choose to implement is up to you—Asterisk imposes no
  limits.</p><p><a id="Revolution_id308633"></a>Naturally, this incredible flexibility comes
  with a price: Asterisk is not a simple system to configure. This is not
  because it’s illogical, confusing, or cryptic; on the contrary, it is very
  sensible and practical. People’s eyes light up when they first see an
  Asterisk dialplan and begin to contemplate the possibilities. But when there
  are literally thousands of ways to achieve a result, the process naturally
  requires extra effort. Perhaps it can be compared to building a house: the
  components are relatively easy to understand, but a person contemplating
  such a task must either a) enlist competent help or <span class="keep-together">b) develop</span> the required skills through
  instruction, practice, and a good book on <span class="keep-together">the
  <span class="keep-together">subject.</span></span></p><div class="sect1" title="Asterisk and VoIP: Bridging the Gap Between Traditional and Network Telephony"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-1"></a>Asterisk and VoIP: Bridging the Gap Between Traditional and Network
    Telephony</h2></div></div></div><p><a id="Revolution_id301746"></a><a id="I_indexterm1_d1e899" class="indexterm"></a><a id="I_indexterm1_d1e904" class="indexterm"></a>Voice over IP (VoIP) is often thought of as little more than
    a method of obtaining free long-distance calling. The real value
    (and—let’s be honest—challenge as well) of VoIP is that it allows voice to
    become nothing more than another application in the data network.</p><p><a id="Revolution_id322445"></a>It sometimes seems that we’ve forgotten
    that the purpose of the telephone is to allow people to communicate. It is
    a simple goal, really, and it should be possible for us to make it happen
    in far more flexible and creative ways than are currently available to us.
    Technologies such as Asterisk lower the barriers to entry.</p><div class="sect2" title="The Zapata Telephony Project"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-1.1"></a>The Zapata Telephony Project</h3></div></div></div><p><a id="Revolution_id317533"></a><a id="I_indexterm1_d1e916" class="indexterm"></a>When the Asterisk project was started (in 1999), there
      were other open-source <span class="keep-together">telephony</span>
      projects in existence. However, Asterisk, in combination with the Zapata
      Telephony Project, was able to provide public switched telephone network
      (PSTN) interfaces, which represented an important milestone in
      transitioning the software from something purely network-based to
      something more practical in the world of telecom at that time, which was
      PSTN-centric.</p><p><a id="Revolution_id303055"></a>The Zapata Telephony Project was
      conceived of by Jim Dixon, a telecommunications consulting engineer who
      was inspired by the incredible advances in CPU speeds that the computer
      industry has now come to take for granted. Dixon’s belief was that far
      more economical telephony systems could be created if a card existed
      that had nothing more on it than the basic electronic components
      required to interface with a telephone circuit. Rather than having
      expensive components on the card, digital signal processing
      (DSP)<sup>[<a id="asterisk-Revolution-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-Revolution-FN-1" class="footnote">3</a>]</sup> would be handled in the CPU by software. While this would
      impose a tremendous load on the CPU, Dixon was certain that the low cost
      of CPUs relative to their performance made them far more attractive than
      expensive DSPs, and, more importantly, that this price/performance ratio
      would continue to improve as CPUs continued to increase in power.</p><p><a id="Revolution_id268801"></a>Like so many visionaries, Dixon believed
      that many others would see this opportunity, and that he merely had to
      wait for someone else to create what to him was an obvious improvement.
      After a few years, he noticed that not only had no one created these
      cards, but it seemed unlikely that anyone was ever going to. At that
      point it was clear that if he wanted a revolution, he was going to have
      to start it himself. And so the Zapata Telephony Project was
      born:</p><div class="blockquote"><a id="Revolution_id268809"></a><blockquote class="blockquote"><p>Since this concept was so
        revolutionary, and was certain to make a lot of waves in the industry,
        I decided on the Mexican revolutionary motif, and named the technology
        and organization after the famous Mexican revolutionary Emiliano
        Zapata. I decided to call the card the “tormenta” which, in Spanish,
        means “storm,” but contextually is usually used to imply a big storm,
        like a hurricane or such.<sup>[<a id="asterisk-Revolution-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-Revolution-FN-2" class="footnote">4</a>]</sup></p></blockquote></div><p><a id="Revolution_id305210"></a>Perhaps we should be calling ourselves
      Asteristas. Regardless, we owe Jim Dixon a debt of thanks, partly for
      thinking this up and partly for seeing it through, but mostly for giving
      the results of his efforts to the open source community. As a result of
      Jim’s contribution, Asterisk’s PSTN engine came to be.</p><p><a id="Revolution_id305220"></a>Over the years, the Zapata Telephony
      interface in Asterisk has been modified and improved. The Digium
      Asterisk Hardware Device Interface (DAHDI) Telephony interface in use
      today is the offspring of Jim Dixon’s contribution.</p></div></div><div class="sect1" title="Massive Change Requires Flexible Technology"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-2"></a>Massive Change Requires Flexible Technology</h2></div></div></div><p><a id="Revolution_id305235"></a><a id="I_indexterm1_d1e947" class="indexterm"></a>Every PBX in existence suffers from shortcomings. No matter
    how fully featured it is, something will always be left out, because even
    the most feature-rich PBX will always fail to anticipate the creativity of
    the customer. A small group of users will desire an odd little feature
    that the design team either did not think of or could not justify the cost
    of building, and, since the system is closed, the users will not be able
    to build it themselves.</p><p><a id="Revolution_id305242"></a>If the Internet had been thusly hampered by
    regulation and commercial interests, it is doubtful that it would have
    developed the wide acceptance it currently enjoys. The openness of the
    Internet meant that anyone could afford to get involved. So, everyone did.
    The tens of thousands of minds that collaborated on the creation of the
    Internet delivered something that no corporation ever could have.<sup>[<a id="id506243" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506243" class="footnote">5</a>]</sup></p><p><a id="Revolution_id305257"></a>As with many other open source projects,
    such as Linux and so much of the critical software running the Internet,
    the development of Asterisk was fueled by the dreams of folks who knew
    that there had to be something more than what traditional industries were
    producing. These people knew that if one could take the best parts of
    various PBXs and separate them into interconnecting components—akin to a
    boxful of LEGO bricks—one could begin to conceive of things that would not
    survive a traditional corporate risk-analysis process. While no one can
    seriously claim to have a complete picture of what this thing should look
    like, there is no shortage of opinions and ideas.<sup>[<a id="id506267" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506267" class="footnote">6</a>]</sup></p><p><a id="Revolution_id305038"></a>Many people new to Asterisk see it as
    unfinished. Perhaps these people can be likened to visitors to an art
    studio, looking to obtain a signed, numbered print. They often leave
    disappointed, because they discover that Asterisk is the blank canvas, the
    tubes of paint, the unused brushes waiting.<sup>[<a id="id506282" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506282" class="footnote">7</a>]</sup></p><p><a id="Revolution_id305060"></a>Even at this early stage in its success,
    Asterisk is nurtured by a greater number of artists than any other PBX.
    Most manufacturers dedicate no more than a few developers to any one
    product; Asterisk has scores. Most proprietary PBXs have a worldwide
    support team comprising a few dozen real experts; Asterisk has
    hundreds.</p><p><a id="Revolution_id305066"></a>The depth and breadth of the expertise that
    surrounds this product is unmatched in the telecom industry. Asterisk
    enjoys the loving attention of old telco guys who <span class="keep-together">remember</span> when rotary dial mattered,
    enterprise telecom people who recall when <span class="keep-together">voicemail</span> was the hottest new technology,
    and data communications geeks and coders who helped build the Internet.
    These people all share a common belief—that the <span class="keep-together">telecommunications</span> industry needs a
    <span class="emphasis"><em>proper</em></span> revolution.<sup>[<a id="asterisk-Revolution-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-Revolution-FN-3" class="footnote">8</a>]</sup></p><p><a id="Revolution_id339625"></a>Asterisk is the catalyst.</p></div><div class="sect1" title="Asterisk: The Hacker’s PBX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-3"></a>Asterisk: The Hacker’s PBX</h2></div></div></div><p><a id="Revolution_id339638"></a><a id="I_indexterm1_d1e999" class="indexterm"></a>Telecommunications companies that choose to ignore Asterisk
    do so at their peril. The flexibility it delivers creates possibilities
    that the best proprietary systems can scarcely dream of. This is because
    Asterisk is the ultimate hacker’s PBX.</p><p><a id="Revolution_id339646"></a>The term <span class="emphasis"><em>hacker</em></span> has,
    of course, been twisted by the mass media into meaning “malicious
    cracker.” This is unfortunate, because the term actually existed long
    before the media corrupted its meaning. Hackers built the networking
    engine that is the Internet. Hackers built the Apple Macintosh and the
    Unix operating system. Hackers are also building your next telecom system.
    Do not fear; these are the good guys, and they’ll be able to build a
    system that’s far more secure than anything that exists today. Rather than
    being constricted by the dubious and easily cracked security of closed
    systems, the hackers will be able to quickly respond to changing trends in
    security and fine-tune the telephone system in response to both corporate
    policy and industry best practices.</p><p><a id="Revolution_id339667"></a>Like other open source systems, Asterisk
    will be able to evolve into a far more secure platform than any
    proprietary system, not in spite of its hacker roots, but rather because
    of them.</p></div><div class="sect1" title="Asterisk: The Professional’s PBX"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-4"></a>Asterisk: The Professional’s PBX</h2></div></div></div><p><a id="Revolution_id339681"></a><a id="I_indexterm1_d1e1016" class="indexterm"></a>Never in the history of telecommunications has a system so
    suited to the needs of business been available, at any price. Asterisk is
    an enabling technology, and as with Linux, it will become increasingly
    rare to find an enterprise that is not running some version of Asterisk,
    in some capacity, somewhere in the network, solving a problem as only
    Asterisk can.</p><p><a id="Revolution_id339688"></a>This acceptance is likely to happen much
    faster than it did with Linux, though, for several reasons:</p><div class="itemizedlist"><a id="Revolution_id339692"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Revolution_id339694"></a><a id="Revolution_id305366"></a>Linux has already blazed the trail that
        led to open source acceptance. Asterisk is following that lead.</p></li><li class="listitem"><p><a id="Revolution_id305372"></a><a id="Revolution_id305374"></a>The telecom industry is crippled, with
        no leadership being provided by the giant industry players. Asterisk
        has a compelling, realistic, and exciting vision.</p></li><li class="listitem"><p><a id="Revolution_id305380"></a><a id="Revolution_id305382"></a>End users are fed up with incompatible
        and limited functionality, and horrible support. Asterisk solves the
        first two problems; entrepreneurs and the community are addressing the
        latter.</p></li></ul></div></div><div class="sect1" title="The Asterisk Community"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-5"></a>The Asterisk Community</h2></div></div></div><p><a id="Revolution_id305399"></a><a id="index-872N108NK3R" class="indexterm"></a><a id="index-218I100ES7G" class="indexterm"></a>One of the compelling strengths of Asterisk is the
    passionate community that developed and supports it. This community, led
    by the fine folks at Digium, is keenly aware of the cultural significance
    of Asterisk and has an optimistic view of the future.</p><p><a id="Revolution_id305404"></a>One of the more powerful side effects of
    the Asterisk community’s energy is the cooperation it has spawned among
    telecommunications, networking, and information technology professionals
    who share a love for this phenomenon. While these cadres have
    traditionally been at odds with each other, in the Asterisk community they
    delight in each others’ skills. The significance of this cooperation
    cannot be underestimated.</p><p><a id="Revolution_id305416"></a>If the dream of Asterisk is to be realized,
    the community must continue to grow—yet one of the key challenges that the
    community currently faces is a rapid influx of new users. The members of
    the existing community, having birthed this thing called <span class="keep-together">Asterisk</span>, are generally welcoming of new
    users, but they’ve grown impatient with being asked the kinds of questions
    whose answers can often be obtained independently, if one is willing to
    devote some time to research and experimentation.</p><p><a id="Revolution_id305425"></a>Obviously, new users do not fit any
    particular kind of mold. While some will happily spend hours experimenting
    and reading various blogs describing the trials and tribulations of
    others, many people who have become enthusiastic about this technology are
    completely uninterested in such pursuits. They want a simple,
    straightforward, step-by-step guide that’ll get them up and running,
    followed by some sensible examples describing the best methods of
    implementing common functionality (such as voicemail, auto attendants, and
    the like).</p><p><a id="Revolution_id305438"></a>To the members of the expert community, who
    (correctly) perceive that Asterisk is like a web development language,
    this approach doesn’t make any sense. To them, it’s clear that you have to
    immerse yourself in Asterisk to appreciate its subtleties. Would one ask
    for a step-by-step guide to programming and expect to learn from it all
    that a language has to offer?</p><p><a id="Revolution_id305441"></a>Clearly, there’s no one approach that’s
    right for everyone. Asterisk is a different animal altogether, and it
    requires a totally different mind-set. As you explore the community,
    though, be aware that it includes people with many different skill sets
    and attitudes. Some of these folks do not display much patience with new
    users, but that’s often due to their passion for the subject, not because
    they don’t welcome your participation.</p><div class="sect2" title="The Asterisk Mailing Lists"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-5.1"></a>The Asterisk Mailing Lists</h3></div></div></div><p><a id="Revolution_id335452"></a><a id="I_indexterm1_d1e1065" class="indexterm"></a><a id="I_indexterm1_d1e1072" class="indexterm"></a><a id="I_indexterm1_d1e1077" class="indexterm"></a>As with any community, there are places where members of
      the Asterisk community meet to discuss matters of mutual interest. Of
      the mailing lists you will find at <a class="ulink" href="http://lists.digium.com/" target="_top">http://lists.digium.com</a>, these three are currently the
      most important:</p><div class="variablelist"><dl><dt><span class="term"><span class="emphasis"><em>Asterisk-Biz</em></span></span></dt><dd><p><a id="Revolution_id335471"></a><a id="Revolution_id335473"></a><a id="I_indexterm1_d1e1090" class="indexterm"></a>Anything commercial with respect to Asterisk belongs
            in this list. If you’re selling something Asterisk-related, sell
            it here. If you want to buy an Asterisk service or product, post
            here.</p></dd><dt><span class="term"><span class="emphasis"><em>Asterisk-Dev</em></span></span></dt><dd><p><a id="Revolution_id335489"></a><a id="Revolution_id335491"></a><a id="I_indexterm1_d1e1100" class="indexterm"></a>The Asterisk developers hang out here. The purpose
            of this list is the discussion of the development of the software
            that is Asterisk, and its participants vigorously defend that
            purpose. Expect a lot of heat if you post anything to this list
            not specifically relating to programming or development of the
            Asterisk code base. General coding questions (such as queries on
            interfacing with AGI or AMI) should be directed to the
            <span class="emphasis"><em>Asterisk-Users</em></span> list.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Revolution_id335501"></a>The Asterisk-Dev list is not
              second-level support! If you scroll through the mailing list
              archives, you’ll see this is a strict rule. The Asterisk-Dev
              mailing list is about discussion of core Asterisk development,
              and questions about interfacing your external programs via AGI
              or AMI should be posted on the
              <span class="emphasis"><em>Asterisk-Users</em></span> list.</p></div></dd><dt><span class="term"><span class="emphasis"><em>Asterisk-Users</em></span></span></dt><dd><p><a id="Revolution_id335518"></a><a id="Revolution_id335520"></a><a id="I_indexterm1_d1e1119" class="indexterm"></a>This is where most Asterisk users hang out. This
            list generates several hundred messages per day and has over ten
            thousand subscribers. While you can go here for help, you are
            expected to have done some reading on your own before you post a
            query.</p></dd></dl></div></div><div class="sect2" title="Asterisk Wiki Sites"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-5.2"></a>Asterisk Wiki Sites</h3></div></div></div><p><a id="Revolution_id335540"></a><a id="I_indexterm1_d1e1127" class="indexterm"></a><a id="I_indexterm1_d1e1134" class="indexterm"></a><a id="I_indexterm1_d1e1139" class="indexterm"></a>The Asterisk Wiki (which exists in large part due to the
      tireless efforts of James <span class="keep-together">Thompson</span>—<span class="emphasis"><em>thanks
      James!</em></span>) is a source of much enlightenment and confusion.
      Another important resource is the community-maintained repository of
      VoIP knowledge at <a class="ulink" href="http://www.voip-info.org/" target="_top">http://www.voip-info.org</a>, which
      contains a truly inspiring cornucopia of fascinating, informative, and
      frequently contradictory information about many subjects, just one of
      which is Asterisk. Since Asterisk documentation forms by far the bulk of
      the information on this website,<sup>[<a id="id506846" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506846" class="footnote">9</a>]</sup> and it probably contains more Asterisk knowledge than all
      other sources put <span class="keep-together">together</span> (with
      the exception of the mailing list archives), it is a popular place to go
      for Asterisk knowledge.</p><p><a id="Revolution_id335573"></a>An important new wiki project is the
      official Asterisk Wiki, found at <a class="ulink" href="http://wiki.asterisk.org/" target="_top">http://wiki.asterisk.org</a>. While not yet as full of
      content as <a class="ulink" href="http://www.voip-info.org/" target="_top">voip-info.org</a>, this wiki will be
      more formally supported and is therefore more likely to contain
      information that is kept current and accurate.</p></div><div class="sect2" title="The IRC Channels"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-5.3"></a>The IRC Channels</h3></div></div></div><p><a id="Revolution_id335589"></a><a id="I_indexterm1_d1e1170" class="indexterm"></a><a id="I_indexterm1_d1e1177" class="indexterm"></a><a id="I_indexterm1_d1e1182" class="indexterm"></a>The Asterisk community maintains Internet Relay Chat (IRC)
      channels on <span class="emphasis"><em>irc.freenode.net</em></span>. The two most active
      channels are <span class="emphasis"><em>#asterisk</em></span> and
      <span class="emphasis"><em>#asterisk-dev.</em></span><sup>[<a id="id506939" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506939" class="footnote">10</a>]</sup> To cut down on spam-bot intrusions, both of these channels
      now require registration to join.<sup>[<a id="id506955" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id506955" class="footnote">11</a>]</sup></p></div><div class="sect2" title="Asterisk User Groups"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-5.4"></a>Asterisk User Groups</h3></div></div></div><p><a id="Revolution_id335638"></a><a id="I_indexterm1_d1e1215" class="indexterm"></a><a id="I_indexterm1_d1e1222" class="indexterm"></a><a id="I_indexterm1_d1e1227" class="indexterm"></a>Over the past decade, in many cites around the world,
      lonely Asterisk users began to realize that there were other like-minded
      people in their towns. Asterisk User Groups (AUGs) began to spring up
      all over the place. While these groups don’t have any official
      affiliation with each other, they generally link to one anothers’
      websites and welcome members from anywhere. Type “Asterisk User Group”
      into Google to track down one in your area.</p></div><div class="sect2" title="The Asterisk Documentation Project"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-Revolution-SECT-5.5"></a>The Asterisk Documentation Project</h3></div></div></div><p><a id="Revolution_id335659"></a><a id="I_indexterm1_d1e1236" class="indexterm"></a><a id="I_indexterm1_d1e1243" class="indexterm"></a><a id="I_indexterm1_d1e1248" class="indexterm"></a>The Asterisk Documentation Project was started by Leif
      Madsen and Jared Smith, but several people in the community have
      contributed.</p><p><a id="Revolution_id335664"></a>The goal of the documentation project is
      to provide a structured repository of written work on Asterisk. In
      contrast with the flexible and ad hoc nature of the Wiki, the <span class="keep-together">Docs project</span> is passionate about building
      a more focused approach to various <span class="keep-together">Asterisk-related</span> subjects.</p><p><a id="Revolution_id335675"></a>As part of the efforts of the Asterisk
      Docs project to make documentation available online, this book is
      available at the <a class="ulink" href="http://www.asteriskdocs.org/" target="_top">http://www.asteriskdocs.org</a>
      website, under a Creative Commons license.<a id="I_indexterm1_d1e1264" class="indexterm"></a><a id="I_indexterm1_d1e1265" class="indexterm"></a></p></div></div><div class="sect1" title="The Business Case"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-6"></a>The Business Case</h2></div></div></div><p><a id="Revolution_id335696"></a><a id="I_indexterm1_d1e1270" class="indexterm"></a>It is very rare to find businesses these days that do not
    have to reinvent themselves every few years. It is equally rare to find a
    business that can afford to replace its communications infrastructure each
    time it goes in a new direction. Today’s businesses need extreme
    flexibility in all of their technology, including telecom.</p><p><a id="Revolution_id335705"></a>In his book <span class="emphasis"><em>Crossing the
    Chasm</em></span> (HarperBusiness), Geoffrey Moore opines, “The idea that
    the value of the system will be discovered rather than known at the time
    of installation implies, in turn, that product flexibility and
    adaptability, as well as ongoing account service, should be critical
    components of any buyer’s evaluation checklist.” What this means, in part,
    is that the true value of a technology is often not known until it has
    been deployed.</p><p><a id="Revolution_id335721"></a>How compelling, then, to have a system that
    holds at its very heart the concept of openness and the value of
    continuous innovation.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Revolution-SECT-7"></a>Conclusion</h2></div></div></div><p><a id="Revolution_id335734"></a>So where to begin? Well, when it comes to
    Asterisk, there is far more to talk about than we can fit into one book.
    This book can only lay down the basics, but from this foundation you will
    be able to come to an understanding of the concept of Asterisk—and from
    that, who knows what you will build?<a id="I_indexterm1_d1e1288" class="indexterm"></a><a id="I_indexterm1_d1e1289" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-Revolution-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-FN-1" class="para">3</a>] </sup>The term DSP also means digital signal processor, which is a
          device (usually a chip) that is capable of interpreting and
          modifying signals of various sorts. In a voice network, DSPs are
          primarily responsible for encoding, decoding, and transcoding audio
          information. This can require a lot of computational effort.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-Revolution-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-FN-2" class="para">4</a>] </sup>Jim Dixon, “The History of Zapata Telephony and How It
            Relates to the Asterisk PBX” (<a class="ulink" href="http://www.asteriskdocs.org/modules/tinycontent/index.php?id=10" target="_top">http://www.asteriskdocs.org/modules/tinycontent/index.php?id=10</a>).</p></div><div class="footnote"><p><sup>[<a id="ftn.id506243" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506243" class="para">5</a>] </sup>We realize that the technology of the Internet formed out of
        government and academic institutions, but what we’re talking about
        here is not the technology of the Internet so much as the cultural
        phenomenon of it, which exploded in the early ’90s.</p></div><div class="footnote"><p><sup>[<a id="ftn.id506267" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506267" class="para">6</a>] </sup>Between the releases of Asterisk 1.2 and Asterisk 1.4, over
        4,000 updates were made to the code in the SVN repository. Between the
        releases of Asterisk 1.4 and 1.8, over 10,000 updates were
        made.</p></div><div class="footnote"><p><sup>[<a id="ftn.id506282" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506282" class="para">7</a>] </sup>It should be noted that these folks need not leave disappointed.
        Several projects have arisen to lower the barriers to entry for
        Asterisk. By far the most popular and well known is the FreePBX
        interface (and the multitude of projects based on it). These
        interfaces (check out <a class="ulink" href="http://www.voip-info.org/wiki/view/Asterisk+GUI" target="_top">http://www.voip-info.org/wiki/view/Asterisk+GUI</a> for an
        idea of how many there are) do not make it easier to learn Asterisk,
        because they separate you from the platform or dialplan configuration,
        but many of them will deliver a working PBX to you much faster than
        the more hands-on approach we employ in this book.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-Revolution-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-FN-3" class="para">8</a>] </sup>The telecom industry has been predicting a revolution since
        before the crash; time will tell how well it responds to the
        <span class="emphasis"><em><span class="emphasis"><em>open source</em></span></em></span>
        revolution.</p></div><div class="footnote"><p><sup>[<a id="ftn.id506846" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506846" class="para">9</a>] </sup>More than 30%, at last count.</p></div><div class="footnote"><p><sup>[<a id="ftn.id506939" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506939" class="para">10</a>] </sup>The <span class="emphasis"><em>#asterisk-dev</em></span> channel is for the
          discussion of changes to the underlying code base of Asterisk and is
          also not second-tier support. Discussions related to programming
          external applications that interface with Asterisk via AGI or AMI
          are meant to be in <span class="emphasis"><em>#asterisk</em></span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id506955" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id506955" class="para">11</a>] </sup>To register, run <span class="command"><strong>/msg nickserv
          help</strong></span> when you connect to the service via your favorite IRC
          client.</p></div></div></div><div class="chapter" title="Chapter 2. Asterisk Architecture"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Arch"></a>Chapter&nbsp;2.&nbsp;Asterisk Architecture</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5-SECT-1">Modules</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293876">Resource Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#file_structure">File Structure</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294638">Configuration Files</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294666">Modules</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294732">Logging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294754">The Dialplan</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294803">Hardware</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning">Asterisk Versioning</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id348242">Previous Release Methodologies</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id348349">The New Release Methodology</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294832">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Architecture_id254997"></a>First things first, but not necessarily
    in that order.</p><div class="attribution"><span>—<span class="attribution">Doctor Who</span></span></div></div><p><a id="Architecture_id265856"></a><a id="index-426C553LT0A" class="indexterm"></a><a id="index-887I273AO6R" class="indexterm"></a>Asterisk is very different from other, more traditional PBXs,
  in that the dialplan in Asterisk treats all incoming channels in essentially
  the same manner.</p><p><a id="Architecture_id258322"></a>In a traditional PBX, there is a logical
  difference between stations <a id="I_indexterm2_d1e1310" class="indexterm"></a>(telephone sets) and trunks <a id="I_indexterm2_d1e1314" class="indexterm"></a>(resources that connect to the outside world). This means, for
  example, that you can’t install an external gateway on a station port and
  route external calls to it without requiring your users to dial the
  extension number first. Also, the concept of an off-site resource (such as a
  reception desk) is much more difficult to implement on a traditional PBX,
  because the system will not allow external resources any access to internal
  features.<sup>[<a id="id507297" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id507297" class="footnote">12</a>]</sup></p><p><a id="Architecture_id264837"></a>Asterisk, on the other hand, does not have
  an internal concept of trunks or stations. In Asterisk, everything that
  comes into or goes out of the system passes through a channel <a id="I_indexterm2_d1e1325" class="indexterm"></a>of some sort. There are many different kinds of channels;
  however, the Asterisk dialplan <a id="I_indexterm2_d1e1331" class="indexterm"></a>handles all channels in a similar manner, which means that,
  for example, an internal user can exist on the end of an external trunk
  (e.g., a cell phone) and be treated by the dialplan in exactly the same
  manner as that user would be if she were on an internal extension. Unless
  you have worked with a traditional PBX, it may not be immediately obvious
  how powerful and liberating this is. Figure 2-1 illustrates the differences
  between the two architectures.</p><div class="figure-float"><div class="figure"><a id="Architecture_id264520"></a><p class="title"><strong>Figure&nbsp;2.1.&nbsp;Asterisk vs. PBX architecture</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject2_d1e1340"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0201.png" alt="Asterisk vs. PBX architecture"></div></div></div><br class="figure-break"></div><div class="sect1" title="Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-5-SECT-1"></a>Modules</h2></div></div></div><p><a id="Architecture_id261626"></a><a id="index-432A688QP3P" class="indexterm"></a><a id="index-510I111FN1J" class="indexterm"></a>Asterisk is built on <span class="emphasis"><em>modules</em></span>. A module
    is a loadable component that provides a specific functionality, such as a
    channel driver (for example, <code class="filename">chan_sip.so</code>), or a
    resource that allows connection to an external technology (such as
    <code class="filename">func_odbc.so</code>). Asterisk modules are loaded based on
    the <code class="filename">/etc/asterisk/modules.conf</code> file. We will discuss
    the use of many modules in this book. At this point we just want to
    introduce the concept of modules, and give you a feel for the types of
    modules that are available.</p><p>It is actually possible to start Asterisk without any modules at
    all, although in this state it will not be capable of doing anything. It
    is useful to understand the modular nature of Asterisk in order to
    appreciate the architecture.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Architecture_id281789"></a>You can start Asterisk with no modules
      loaded by default <a id="I_indexterm2_d1e1375" class="indexterm"></a>and load each desired module manually from the console,
      but this is not something that you’d want to put into production; it
      would only be useful if you were performance-tuning a system where you
      wanted to eliminate everything not required by your specific application
      of Asterisk.</p></div><p><a id="Architecture_id307562"></a>The types of modules in Asterisk include
    the following:</p><div class="itemizedlist"><a id="Architecture_id307566"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Architecture_id307568"></a><a id="Architecture_id307570"></a>Applications</p></li><li class="listitem"><p><a id="Architecture_id307575"></a><a id="Architecture_id307540"></a>Bridging modules</p></li><li class="listitem"><p><a id="Architecture_id268788"></a><a id="Architecture_id268790"></a>Call detail recording (CDR)
        modules</p></li><li class="listitem"><p><a id="Architecture_id268795"></a><a id="Architecture_id268797"></a>Channel event logging (CEL)
        modules</p></li><li class="listitem"><p><a id="Architecture_id268802"></a><a id="Architecture_id268804"></a>Channel drivers</p></li><li class="listitem"><p><a id="Architecture_id268808"></a><a id="Architecture_id268810"></a>Codec translators</p></li><li class="listitem"><p><a id="Architecture_id268815"></a><a id="Architecture_id268817"></a>Format interpreters</p></li><li class="listitem"><p><a id="Architecture_id335587"></a><a id="Architecture_id335589"></a>Dialplan functions</p></li><li class="listitem"><p><a id="Architecture_id335593"></a><a id="Architecture_id335596"></a>PBX modules</p></li><li class="listitem"><p><a id="Architecture_id335600"></a><a id="Architecture_id335602"></a>Resource modules</p></li><li class="listitem"><p><a id="Architecture_id335606"></a><a id="Architecture_id335609"></a>Addons modules</p></li><li class="listitem"><p><a id="Architecture_id335613"></a><a id="Architecture_id335615"></a>Test modules</p></li></ul></div><p><a id="Architecture_id216469"></a>In the following sections we will list
    each module available within these categories, briefly identify its
    purpose, and give our opinion on its relative popularity and/or importance
    (while some modules are proven and deservedly popular, others are quite
    old, are barely ever used anymore, and are only maintained for the purpose
    of backward-compatibility). The details of how specific modules work will
    be covered in various chapters throughout the book, depending on what the
    module is and what it does. Some modules will be covered thoroughly;
    others may not be covered at all.</p><p><a id="Architecture_id216475"></a>Regarding the Popularity/Status column in
    the tables that follow, the following list contains our opinions with
    respect to the meanings we have chosen (your mileage may vary):</p><div class="variablelist"><dl><dt><span class="term">Insignificant</span></dt><dd><p>This module is ancient history. If you use it, be aware that
          you are mostly on your own when it comes to any sort of community
          support.</p></dd><dt><span class="term">Unreliable</span></dt><dd><p>This module is new or experimental, and is not suitable for
          production.</p></dd><dt><span class="term">Useful</span></dt><dd><p>This module is current, maintained, popular, and
          recommended.</p></dd><dt><span class="term">Usable</span></dt><dd><p>This module works but may be incomplete or unpopular, and/or
          is not recommended by the authors.</p></dd><dt><span class="term">New</span></dt><dd><p>This module is quite new, and its completeness and popularity
          are difficult to gauge at this time.</p></dd><dt><span class="term">Deprecated</span></dt><dd><p>This module has been replaced by something that is considered
          superior.</p></dd><dt><span class="term">Limited</span></dt><dd><p>This module has limitations that may make it unsuitable to
          your requirements.</p></dd><dt><span class="term">Essential</span></dt><dd><p>This module is one you’ll never want to be without.</p></dd></dl></div><p><a id="Architecture_id305339"></a>And now, without further ado, let’s take
    a look at the modules, grouped by module type.</p><div class="sect2" title="Applications"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id241422"></a>Applications</h3></div></div></div><p><a id="Architecture_id241427"></a><a id="index-027N441BJ2F" class="indexterm"></a><a id="index-717P463PO5F" class="indexterm"></a><a id="index-716K482MR7L" class="indexterm"></a>Dialplan applications are used in
      <code class="filename">extensions.conf</code> to define the various actions that
      can be applied to a call. The
      <span class="application"><code class="literal">Dial()</code></span> application, for
      example, is responsible for making outgoing connections to external
      resources and is arguably the most important dialplan application. The
      available applications are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241441" title="Table 2.1. Dialplan applications">Table&nbsp;2.1, “Dialplan applications”</a>.</p><div class="table"><a id="Architecture_id241441"></a><p class="title"><strong>Table&nbsp;2.1.&nbsp;Dialplan applications</strong></p><div class="table-contents"><table summary="Dialplan applications" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">app_adsiprog</code>
              </td><td><a id="index-163A312RC6I" class="indexterm"></a>Loads Analog Display Services Interface (ADSI)
              scripts into compatible analog phones</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_alarmreceiver</code>
              </td><td>Supports receipt of reports from alarm equipment</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_amd</code>
              </td><td>Detects answering machines</td><td>Unreliable</td></tr><tr><td>
                <code class="literal">app_authenticate</code>
              </td><td>Compares dual-tone multi-frequency (DTMF) input against a
              provided string (password)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_cdr</code>
              </td><td>Writes ad hoc record to CDR</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_celgenuserevent</code>
              </td><td>Generates user-defined events for CEL</td><td>New</td></tr><tr><td>
                <code class="literal">app_chanisavail</code>
              </td><td>Checks the status of a channel</td><td>Unreliable</td></tr><tr><td>
                <code class="literal">app_channelredirect</code>
              </td><td>Forces another channel into a different part of the
              <span class="keep-together">dialplan</span></td><td>Useful</td></tr><tr><td>
                <code class="literal">app_chanspy</code>
              </td><td>Allows a channel to listen to audio on another
              channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_confbridge</code>
              </td><td>Provides conferencing (new version)</td><td>New—not fully featured yet</td></tr><tr><td>
                <code class="literal">app_controlplayback</code>
              </td><td>Plays back a prompt and offers fast forward and rewind
              functions</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_dahdibarge</code>
              </td><td>Allows barging in on a DAHDI channel</td><td>Deprecated—see <code class="literal">app_chanspy</code></td></tr><tr><td>
                <code class="literal">app_dahdiras</code>
              </td><td>Creates a RAS server over a DAHDI channel (no modem
              emulation)</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_db</code>
              </td><td>Used to add/change/delete records in Asterisk’s built-in
              Berkeley database</td><td>Deprecated—see
              <span class="application"><code class="literal">func_db</code></span></td></tr><tr><td>
                <code class="literal">app_dial</code>
              </td><td>Used to connect channels together (i.e., make phone
              calls)</td><td>Essential</td></tr><tr><td>
                <code class="literal">app_dictate</code>
              </td><td>Plays back a recording and offers start/stop
              functions</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_directed_pickup</code>
              </td><td>Answers a call for another extension</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_directory</code>
              </td><td>Presents the list of names from
              <code class="filename">voicemail.conf</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">app_disa</code>
              </td><td>Provides dialtone and accepts DTMF input</td><td>Useful<sup>[<a id="id508219" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id508219" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">app_dumpchan</code>
              </td><td>Dumps channel variables to Asterisk command-line <span class="keep-together">interface</span> (CLI)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_echo</code>
              </td><td>Loops received audio back to source channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_exec</code>
              </td><td>Contains
              <code class="literal"><span class="application">Exec()</span></code>,
              <span class="application"><code class="literal">TryExec()</code></span>, and
              <span class="application"><code class="literal">ExecIf()</code></span>; executes
              a dialplan application based on conditions</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_externalivr</code>
              </td><td>Controls Asterisk as with an AGI, only
              asynchronously</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_fax</code>
              </td><td>Provides <code class="literal">SendFax()</code> and
              <code class="literal">ReceiveFax()</code></td><td>Useful<sup>[<a id="id508354" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id508354" class="footnote">b</a>]</sup></td></tr><tr><td>
                <code class="literal">app_festival</code>
              </td><td>Enables basic text to speech using Festival TTS
              engine</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_flash</code>
              </td><td>Performs a hook-switch flash on channels (primarily
              <span class="keep-together">analog</span>)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_followme</code>
              </td><td>Performs find me/follow me functionality based on
              <code class="filename">followme.conf</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">app_forkcdr</code>
              </td><td>Starts new CDR record on current call</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_getcpeid</code>
              </td><td>Gets the ADSI CPE ID</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_ices</code>
              </td><td>Sends audio to an Icecast server</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_image</code>
              </td><td>Transmits an image to supported devices</td><td>Limited</td></tr><tr><td>
                <code class="literal">app_ivrdemo</code>
              </td><td>Sample application for developers</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_jack</code>
              </td><td>Works with JACK Audio Connection Kit to share audio
              between compatible applications</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_macro</code>
              </td><td>Triggers dialplan macros</td><td>Deprecated—see
              <span class="application"><code class="literal">GoSub()</code></span></td></tr><tr><td>
                <code class="literal">app_meetme</code>
              </td><td>Provides multiparty conferencing</td><td>Useful—fully featured</td></tr><tr><td>
                <code class="literal">app_milliwatt</code>
              </td><td>Generates 1004-Hz tone for testing loss on analog <span class="keep-together">circuits</span></td><td>Useful</td></tr><tr><td>
                <code class="literal">app_minivm</code>
              </td><td>Provides primitive functions to allow you to build your
              own voicemail application in dialplan</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_mixmonitor</code>
              </td><td>Records both sides of a call and mixes them
              together</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_morsecode</code>
              </td><td>Generates Morse code</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_mp3</code>
              </td><td>Uses <span class="emphasis"><em>mpg123</em></span> to play an MP3</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_nbscat</code>
              </td><td>Streams audio from Network Broadcast Stream (NBS)</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_originate</code>
              </td><td>Allows origination of a call</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_osplookup</code>
              </td><td>Performs Open Settlement Protocol (OSP) lookup</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_page</code>
              </td><td>Creates multiple audio connections to specified devices
              for public address (paging)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_parkandannounce</code>
              </td><td>Enables automated announcing of parked calls</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_playback</code>
              </td><td>Plays a file to the channel (does not accept
              input)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_playtones</code>
              </td><td>Plays pairs of tones of specified frequencies</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_privacy</code>
              </td><td>Requests input of caller’s phone number if no CallerID is
              received</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_queue</code>
              </td><td>Provides Automatic Call Distribution (ACD)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_read</code>
              </td><td>Requests input of digits from callers and assigns input
              to a variable</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_readexten</code>
              </td><td>Requests input of digits from callers and passes call to
              a designated extension and context</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_readfile</code>
              </td><td>Loads contents of a text file into a channel
              variable</td><td>Deprecated—see the <code class="literal">FILE()</code> function in
              <code class="literal">func_env</code></td></tr><tr><td>
                <code class="literal">app_record</code>
              </td><td>Records received audio to a file</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_rpt</code>
              </td><td>Provides a method to interface with an audio board for
              the <code class="literal">app_rpt</code> project</td><td>Limited</td></tr><tr><td>
                <code class="literal">app_sayunixtime</code>
              </td><td>Plays back time in specified format</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_senddtmf</code>
              </td><td>Transmits DTMF to calling party</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_sendtext</code>
              </td><td>Sends a text string to compatible channels</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_setcallerid</code>
              </td><td>Sets CallerID on a channel</td><td>Deprecated—see
              <span class="application"><code class="literal">func_callerid</code></span></td></tr><tr><td>
                <code class="literal">app_skel</code>
              </td><td>Sample application for developers</td><td>Useful<sup>[<a id="id509054" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id509054" class="footnote">c</a>]</sup></td></tr><tr><td>
                <code class="literal">app_sms</code>
              </td><td>Sends SMS message in compatible countries</td><td>Limited</td></tr><tr><td>
                <code class="literal">app_softhangup</code>
              </td><td>Requests hangup of channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_speech_utils</code>
              </td><td>Provides utilities relating to speech recognition</td><td>Useful<sup>[<a id="id509111" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id509111" class="footnote">d</a>]</sup></td></tr><tr><td>
                <code class="literal">app_stack</code>
              </td><td>Provides <code class="literal">Gosub()</code>,
              <code class="literal">GoSubIf()</code>, <code class="literal">Return()</code>,
              <code class="literal">StackPop()</code>, <code class="literal">LOCAL()</code>, and
              <code class="literal">LOCAL_PEEK()</code></td><td>Essential</td></tr><tr><td>
                <code class="literal">app_system</code>
              </td><td>Executes commands in a Linux shell</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_talkdetect</code>
              </td><td>Similar to <code class="literal">app_background</code>, but allows
              for any received audio to interrupt playback</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_test</code>
              </td><td>Client/server testing application</td><td>Usable</td></tr><tr><td>
                <code class="literal">app_transfer</code>
              </td><td>Performs a transfer on the current channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_url</code>
              </td><td>Passes a URI to the called channel</td><td>Limited</td></tr><tr><td>
                <code class="literal">app_userevent</code>
              </td><td>Generates a custom event in the Asterisk Manager <span class="keep-together">Interface</span> (AMI)</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_verbose</code>
              </td><td>Generates a custom event in the Asterisk CLI</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_voicemail</code>
              </td><td>Provides voicemail</td><td>Essential</td></tr><tr><td>
                <code class="literal">app_waitforring</code>
              </td><td>Waits for a RING signaling event (not to be confused with
              RINGING); most likely unnecessary, as only
              <code class="literal">chan_dahdi</code> with analog channels where ringing
              is received (such as an FXO port) generates the RING <span class="keep-together">signaling</span> event</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">app_waitforsilence</code>
              </td><td>Includes <code class="literal">WaitForSilence()</code> and
              <code class="literal">WaitForNoise()</code>; listens to the incoming
              channel for a specified number of milliseconds of
              noise/silence</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_waituntil</code>
              </td><td>Waits until current Linux epoch matches specified <span class="keep-together">epoch</span></td><td>Useful</td></tr><tr><td>
                <code class="literal">app_while</code>
              </td><td>Includes <code class="literal">While()</code>,
              <code class="literal">EndWhile()</code>, <code class="literal">ExitWhile()</code>,
              and <code class="literal">ContinueWhile()</code>; provides while-loop
              <span class="keep-together">functionality</span> in the
              dialplan</td><td>Useful</td></tr><tr><td>
                <code class="literal">app_zapateller</code>
              </td><td>Generates SIT tone to discourage telemarketers</td><td>Usable<a id="I_indexterm2_d1e2257" class="indexterm"></a><a id="I_indexterm2_d1e2258" class="indexterm"></a><a id="I_indexterm2_d1e2259" class="indexterm"></a><a id="I_indexterm2_d1e2260" class="indexterm"></a></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id508219" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id508219" class="para">a</a>] </sup>The use of (DISA) is considered to be a security
                  risk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id508354" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id508354" class="para">b</a>] </sup>Requires a suitable DSP engine to handle
                  encoding/decoding of fax signaling (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax" title="Chapter 19. Fax">Chapter&nbsp;19, <em>Fax</em></a>).</p></div><div class="footnote"><p><sup>[<a id="ftn.id509054" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id509054" class="para">c</a>] </sup>If you are a developer.</p></div><div class="footnote"><p><sup>[<a id="ftn.id509111" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id509111" class="para">d</a>] </sup>Requires an external speech recognition
                  application.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Bridging Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id291787"></a>Bridging Modules</h3></div></div></div><p><a id="Architecture_id291793"></a><a id="I_indexterm2_d1e2266" class="indexterm"></a><a id="I_indexterm2_d1e2271" class="indexterm"></a><a id="I_indexterm2_d1e2274" class="indexterm"></a>Bridging modules are new in Asterisk 1.8: they perform the
      actual bridging of channels in the new bridging API. Each provides
      different features, which get used in different situations depending on
      what a bridge needs. These modules, listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291798" title="Table 2.2. Bridging modules">Table&nbsp;2.2, “Bridging modules”</a>, are currently only used for (and are
      essential to) <code class="literal">app_confbridge</code>.</p><div class="table"><a id="Architecture_id291798"></a><p class="title"><strong>Table&nbsp;2.2.&nbsp;Bridging modules</strong></p><div class="table-contents"><table summary="Bridging modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">
                <span class="keep-together">Popularity/Status</span>
              </th></tr></thead><tbody><tr><td>
                <code class="literal">bridge_builtin_features</code>
              </td><td><a id="I_indexterm2_d1e2306" class="indexterm"></a>Performs bridging when utilizing built-in user
              features (such as those found in
              <code class="filename">features.conf</code>).</td><td>New</td></tr><tr><td>
                <code class="literal">bridge_multiplexed</code>
              </td><td><a id="I_indexterm2_d1e2320" class="indexterm"></a>Performs complex multiplexing, as would be
              required in a large conference room (multiple participants).
              Currently only used by
              <code class="literal">app_confbridge</code>.</td><td>New</td></tr><tr><td>
                <code class="literal">bridge_simple</code>
              </td><td><a id="I_indexterm2_d1e2334" class="indexterm"></a>Performs simple channel-to-channel
              bridging.</td><td>New</td></tr><tr><td>
                <code class="literal">bridge_softmix</code>
              </td><td><a id="I_indexterm2_d1e2345" class="indexterm"></a>Performs simple multiplexing, as would be required
              in a large conference room (multiple participants). Currently
              only used by <code class="literal">app_confbridge</code>.</td><td>New</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Call Detail Recording Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id291894"></a>Call Detail Recording Modules</h3></div></div></div><p><a id="Architecture_id291899"></a><a id="I_indexterm2_d1e2359" class="indexterm"></a><a id="I_indexterm2_d1e2364" class="indexterm"></a><a id="I_indexterm2_d1e2367" class="indexterm"></a>The CDR modules, listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291914" title="Table 2.3. Call detail recording modules">Table&nbsp;2.3, “Call detail recording modules”</a>, are designed to facilitate as many
      methods of storing call detail records as possible. You can store CDRs
      to a file (default), a database, RADIUS, or
      <span class="emphasis"><em>syslog</em></span>.</p><p><a id="Architecture_id291904"></a>
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Architecture_id291907"></a>Call detail records are not
          intended to be used in complex billing applications.<a id="I_indexterm2_d1e2384" class="indexterm"></a> If you require more control over billing and call
          reporting, you will want to look at channel event logging, discussed
          next. The advantage of CDR is that it just works.</p></div><p>
      </p><div class="table"><a id="Architecture_id291914"></a><p class="title"><strong>Table&nbsp;2.3.&nbsp;Call detail recording modules</strong></p><div class="table-contents"><table summary="Call detail recording modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">cdr_adaptive_odbc</code>
              </td><td><a id="I_indexterm2_d1e2406" class="indexterm"></a>Allows writing of CDRs through ODBC framework with
              ability to add custom fields</td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_csv</code>
              </td><td><a id="I_indexterm2_d1e2417" class="indexterm"></a>Writes CDRs to disk as a comma-separated <span class="keep-together">values file</span></td><td>Usable</td></tr><tr><td>
                <code class="literal">cdr_custom</code>
              </td><td><a id="I_indexterm2_d1e2430" class="indexterm"></a>As above, but allows for the addition of custom
              fields</td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_manager</code>
              </td><td><a id="I_indexterm2_d1e2441" class="indexterm"></a>Outputs CDRs to Asterisk Manager Interface
              (AMI)</td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_odbc</code>
              </td><td><a id="I_indexterm2_d1e2452" class="indexterm"></a>Writes CDRs through ODBC framework</td><td>Usable</td></tr><tr><td>
                <code class="literal">cdr_pgsql</code>
              </td><td><a id="I_indexterm2_d1e2463" class="indexterm"></a>Writes CDRs to PostgreSQL</td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_radius</code>
              </td><td><a id="I_indexterm2_d1e2474" class="indexterm"></a>Writes CDRs to RADIUS</td><td>Usable—does not support custom fields</td></tr><tr><td>
                <code class="literal">cdr_sqlite</code>
              </td><td><a id="I_indexterm2_d1e2485" class="indexterm"></a>Writes CDRs to SQLite2 database</td><td>Deprecated—use <code class="literal">sqlite3_custom</code></td></tr><tr><td>
                <code class="literal">cdr_sqlite3_custom</code>
              </td><td><a id="I_indexterm2_d1e2498" class="indexterm"></a>Writes CDRs to SQLite3 with custom fields</td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_syslog</code>
              </td><td><a id="I_indexterm2_d1e2509" class="indexterm"></a>Writes CDRs to <span class="command"><strong>syslog</strong></span></td><td>Useful</td></tr><tr><td>
                <code class="literal">cdr_tds</code>
              </td><td><a id="I_indexterm2_d1e2522" class="indexterm"></a>Writes CDRs to Microsoft SQL or Sybase</td><td>Usable—requires an old version of
              <code class="literal">libtds</code></td></tr></tbody></table></div></div><br class="table-break"><p><a id="Architecture_id292094"></a>We will discuss some reporting packages
      that you may wish to use with CDR in <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface" title="Chapter 25. Web Interfaces">Chapter&nbsp;25, <em>Web Interfaces</em></a>.</span></p></div><div class="sect2" title="Channel Event Logging Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id292103"></a>Channel Event Logging Modules</h3></div></div></div><p><a id="Architecture_id292108"></a><a id="I_indexterm2_d1e2540" class="indexterm"></a><a id="I_indexterm2_d1e2545" class="indexterm"></a><a id="I_indexterm2_d1e2548" class="indexterm"></a>Channel event logging provides much more powerful control
      over reporting of call activity. By the same token, it requires more
      careful planning of your dialplan, and by no means will it work
      automatically. Asterisk’s CEL modules are listed in <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292113" title="Table 2.4. Channel event logging modules">Table&nbsp;2.4, “Channel event logging modules”</a>.</span></p><div class="table"><a id="Architecture_id292113"></a><p class="title"><strong>Table&nbsp;2.4.&nbsp;Channel event logging modules</strong></p><div class="table-contents"><table summary="Channel event logging modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">cel_custom</code>
              </td><td><a id="I_indexterm2_d1e2577" class="indexterm"></a>CEL to disk/file</td><td>Useful</td></tr><tr><td>
                <code class="literal">cel_manager</code>
              </td><td><a id="I_indexterm2_d1e2588" class="indexterm"></a>CEL to AMI</td><td>Useful</td></tr><tr><td>
                <code class="literal">cel_odbc</code>
              </td><td><a id="I_indexterm2_d1e2599" class="indexterm"></a>CEL to ODBC</td><td>Useful</td></tr><tr><td>
                <code class="literal">cel_pgsql</code>
              </td><td><a id="I_indexterm2_d1e2610" class="indexterm"></a>CEL to PostgreSQL</td><td>Useful</td></tr><tr><td>
                <code class="literal">cel_radius</code>
              </td><td><a id="I_indexterm2_d1e2621" class="indexterm"></a>CEL to RADIUS</td><td>Usable—does not support custom fields</td></tr><tr><td>
                <code class="literal">cel_sqlite3_custom</code>
              </td><td><a id="I_indexterm2_d1e2632" class="indexterm"></a>CEL to Sqlite3</td><td>Useful</td></tr><tr><td>
                <code class="literal">cel_tds</code>
              </td><td><a id="I_indexterm2_d1e2643" class="indexterm"></a>CEL to Microsoft SQL or Sybase</td><td>Usable—requires an old version of
              <code class="literal">libtds</code></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Channel Drivers"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id292243"></a>Channel Drivers</h3></div></div></div><p><a id="Architecture_id292248"></a><a id="I_indexterm2_d1e2655" class="indexterm"></a><a id="I_indexterm2_d1e2660" class="indexterm"></a><a id="I_indexterm2_d1e2663" class="indexterm"></a><a id="I_indexterm2_d1e2668" class="indexterm"></a>Without channel drivers, Asterisk would have no way to
      make calls. Each channel driver is specific to the protocol or channel
      type it supports (SIP, ISDN, etc.). The channel module acts as a gateway
      to the Asterisk core. Asterisk’s channel drivers are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292254" title="Table 2.5. Channel drivers">Table&nbsp;2.5, “Channel drivers”</a>.</p><div class="table"><a id="Architecture_id292254"></a><p class="title"><strong>Table&nbsp;2.5.&nbsp;Channel drivers</strong></p><div class="table-contents"><table summary="Channel drivers" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">
                <span class="keep-together">Popularity/Status</span>
              </th></tr></thead><tbody><tr><td>
                <code class="literal">chan_agent</code>
              </td><td><a id="I_indexterm2_d1e2697" class="indexterm"></a>Provides agent channel for
              <code class="literal">Queue()</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">|chan_alsa</code>
              </td><td><a id="I_indexterm2_d1e2710" class="indexterm"></a>Provides connection to Advanced Linux Sound
              <span class="keep-together">Architecture</span></td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_bridge</code>
              </td><td><a id="I_indexterm2_d1e2723" class="indexterm"></a>Used internally by the
              <code class="literal">ConfBridge()</code> application; should not be used
              directly</td><td>Essential <sup>[<a id="id510616" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id510616" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">chan_console</code>
              </td><td><a id="I_indexterm2_d1e2743" class="indexterm"></a>Provides connection to portaudio</td><td>New</td></tr><tr><td>
                <code class="literal">chan_dahdi</code>
              </td><td><a id="I_indexterm2_d1e2754" class="indexterm"></a>Provides connection to PSTN cards that use DAHDI
              channel drivers</td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_gtalk</code>
              </td><td><a id="I_indexterm2_d1e2765" class="indexterm"></a>Provides connection to Google Talk</td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_h323</code>
              </td><td><a id="I_indexterm2_d1e2776" class="indexterm"></a>Provides connection to H.323 endpoints</td><td>Deprecated—see <code class="literal">chan_ooh323</code> in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294470" title="Table 2.11. Addon modules">Table&nbsp;2.11, “Addon modules”</a></td></tr><tr><td>
                <code class="literal">chan_iax2</code>
              </td><td><a id="I_indexterm2_d1e2791" class="indexterm"></a>Provides connection to IAX2 endpoints</td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_jingle</code>
              </td><td><a id="I_indexterm2_d1e2802" class="indexterm"></a>Provides connection to Jingle-enabled
              endpoints</td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_local</code>
              </td><td><a id="I_indexterm2_d1e2813" class="indexterm"></a>Provides a mechanism to treat a portion of the
              dialplan as a channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_mgcp</code>
              </td><td><a id="I_indexterm2_d1e2824" class="indexterm"></a>Media Gateway Control Protocol channel
              driver</td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_misdn</code>
              </td><td><a id="I_indexterm2_d1e2836" class="indexterm"></a>Provides connection to mISDN supported <span class="keep-together">ISDN cards</span></td><td>Limited</td></tr><tr><td>
                <code class="literal">chan_multicast_rtp</code>
              </td><td><a id="I_indexterm2_d1e2849" class="indexterm"></a>Provides connection to multicast RTP
              streams</td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_nbs</code>
              </td><td><a id="I_indexterm2_d1e2860" class="indexterm"></a>Network Broadcast Sound channel driver</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">chan_oss</code>
              </td><td><a id="I_indexterm2_d1e2871" class="indexterm"></a>Open Sound System driver</td><td>Useful</td></tr><tr><td>
                <code class="literal">chan_phone</code>
              </td><td><a id="I_indexterm2_d1e2882" class="indexterm"></a>Linux telephony interface driver (very
              old)</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">chan_sip</code>
              </td><td><a id="I_indexterm2_d1e2893" class="indexterm"></a>Session Initiation Protocol channel driver</td><td>Essential</td></tr><tr><td>
                <code class="literal">chan_skinny</code>
              </td><td><a id="I_indexterm2_d1e2904" class="indexterm"></a>Cisco Skinny Client Control Protocol (SCCP)
              channel driver</td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_unistim</code>
              </td><td><a id="I_indexterm2_d1e2915" class="indexterm"></a>Nortel Unistim protocol channel driver</td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_usbradio</code>
              </td><td><a id="I_indexterm2_d1e2926" class="indexterm"></a>Channel driver for CM108 USB cards with <span class="keep-together">radio interface</span></td><td>Usable</td></tr><tr><td>
                <code class="literal">chan_vpb</code>
              </td><td><a id="I_indexterm2_d1e2939" class="indexterm"></a>Voicetronix channel driver</td><td>Insignificant<sup>[<a id="id511102" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id511102" class="footnote">b</a>]</sup></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id510616" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id510616" class="para">a</a>] </sup>If you are using the <code class="literal">ConfBridge()</code>
                  application.</p></div><div class="footnote"><p><sup>[<a id="ftn.id511102" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id511102" class="para">b</a>] </sup>Some Voicetronix hardware is supported by Zaptel using
                  an addon Zaptel module distributed by Voicetronix. However,
                  Zaptel is no longer supported by Asterisk and this driver
                  has not been ported to DAHDI.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Codec Translators"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id292581"></a>Codec Translators</h3></div></div></div><p><a id="Architecture_id292586"></a><a id="I_indexterm2_d1e2952" class="indexterm"></a><a id="I_indexterm2_d1e2957" class="indexterm"></a><a id="I_indexterm2_d1e2962" class="indexterm"></a><a id="I_indexterm2_d1e2965" class="indexterm"></a>The codec translators (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292600" title="Table 2.6. Codec translators">Table&nbsp;2.6, “Codec translators”</a>) allow Asterisk to convert audio
      stream formats <a id="I_indexterm2_d1e2975" class="indexterm"></a>between calls. So if a call comes in on a PRI circuit
      (using G.711) and needs to be passed out a compressed SIP channel (e.g.,
      using G.729, one of many codecs that SIP can handle), the relevant codec
      translator would perform the conversion.<sup>[<a id="id511179" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id511179" class="footnote">13</a>]</sup></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Architecture_id292594"></a>If a codec (such as G.729) uses a
        complex encoding algorithm, heavy use of transcoding <a id="I_indexterm2_d1e2989" class="indexterm"></a><a id="I_indexterm2_d1e2994" class="indexterm"></a>can place a massive burden on the CPU. Specialized
        hardware for the decoding/encoding of G.729 is available from hardware
        manufacturers such as Sangoma and Digium (and likely others).</p></div><div class="table"><a id="Architecture_id292600"></a><p class="title"><strong>Table&nbsp;2.6.&nbsp;Codec translators</strong></p><div class="table-contents"><table summary="Codec translators" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">codec_adpcm</code>
              </td><td><a id="I_indexterm2_d1e3019" class="indexterm"></a>Adaptive Differential Pulse Coded Modulation
              codec</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">codec_alaw</code>
              </td><td><a id="I_indexterm2_d1e3030" class="indexterm"></a>A-law PCM codec used all over the world (except
              Canada/USA) on the PSTN</td><td>Essential</td></tr><tr><td>
                <code class="literal">codec_a_mu</code>
              </td><td><a id="I_indexterm2_d1e3041" class="indexterm"></a>A-law to mu-law direct converter</td><td>Useful</td></tr><tr><td>
                <code class="literal">codec_dahdi</code>
              </td><td><a id="I_indexterm2_d1e3052" class="indexterm"></a>Utilizes proprietary Digium hardware transcoding
              card</td><td>Essential<sup>[<a id="id511358" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id511358" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">codec_g722</code>
              </td><td><a id="I_indexterm2_d1e3066" class="indexterm"></a>Wideband audio codec</td><td>Useful</td></tr><tr><td>
                <code class="literal">codec_g726</code>
              </td><td><a id="I_indexterm2_d1e3077" class="indexterm"></a>Flavor of ADPCM</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">codec_gsm</code>
              </td><td><a id="I_indexterm2_d1e3088" class="indexterm"></a>Global System for Mobile Communications (GSM)
              codec</td><td>Useful</td></tr><tr><td>
                <code class="literal">codec_ilbc</code>
              </td><td><a id="I_indexterm2_d1e3099" class="indexterm"></a>Internet Low Bitrate Codec</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">codec_lpc10</code>
              </td><td><a id="I_indexterm2_d1e3110" class="indexterm"></a>Linear Predictive Coding vocoder (extremely low
              bandwidth)</td><td>Insignificant</td></tr><tr><td>
                <code class="literal">codec_resample</code>
              </td><td><a id="I_indexterm2_d1e3121" class="indexterm"></a>Resamples between 8-bit and 16-bit signed
              linear</td><td>Usable</td></tr><tr><td>
                <code class="literal">codec_speex</code>
              </td><td><a id="I_indexterm2_d1e3132" class="indexterm"></a>Speex codec</td><td>Usable</td></tr><tr><td>
                <code class="literal">codec_ulaw</code>
              </td><td><a id="I_indexterm2_d1e3144" class="indexterm"></a>Mu-law PCM codec used in Canada/USA on
              PSTN</td><td>Essential</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id511358" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id511358" class="para">a</a>] </sup>If you are using a Digium codec transcoder
                  card.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Format Interpreters"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id292796"></a>Format Interpreters</h3></div></div></div><p><a id="Architecture_id292801"></a><a id="I_indexterm2_d1e3154" class="indexterm"></a><a id="I_indexterm2_d1e3159" class="indexterm"></a><a id="I_indexterm2_d1e3164" class="indexterm"></a><a id="I_indexterm2_d1e3167" class="indexterm"></a>Format interpreters (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292825" title="Table 2.7. Format interpreters">Table&nbsp;2.7, “Format interpreters”</a>) perform the function of codec
      translators, but they do their work on files rather than channels. If
      you have a recording on a menu that has been stored as GSM, a format
      interpreter would need to be used to play that recording to any channels
      not using the GSM codec.<sup>[<a id="id511628" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id511628" class="footnote">14</a>]</sup></p><p>If you store a recording in several formats (such as WAV, GSM,
      etc.), Asterisk will determine the least costly format<sup>[<a id="id511640" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id511640" class="footnote">15</a>]</sup> to use when a channel requires that recording.</p><div class="table"><a id="Architecture_id292825"></a><p class="title"><strong>Table&nbsp;2.7.&nbsp;Format interpreters</strong></p><div class="table-contents"><table summary="Format interpreters" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Plays files stored in</th><th align="center">
                <span class="keep-together">Popularity/Status</span>
              </th></tr></thead><tbody><tr><td>
                <code class="literal">format_g723</code>
              </td><td><a id="I_indexterm2_d1e3206" class="indexterm"></a>G.723 <code class="filename">.g723</code></td><td>Insignificant</td></tr><tr><td>
                <code class="literal">format_g726</code>
              </td><td><a id="I_indexterm2_d1e3219" class="indexterm"></a>G.726 <code class="filename">.g726</code></td><td>Insignificant</td></tr><tr><td>
                <code class="literal">format_g729</code>
              </td><td><a id="I_indexterm2_d1e3232" class="indexterm"></a>G.729 <code class="filename">.g729</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">format_gsm</code>
              </td><td><a id="I_indexterm2_d1e3245" class="indexterm"></a>RPE-LTP (original GSM codec)
              <code class="filename">.gsm</code></td><td>Usable</td></tr><tr><td>
                <code class="literal">format_h263</code>
              </td><td><a id="I_indexterm2_d1e3258" class="indexterm"></a>H.263—video <code class="filename">.h263</code></td><td>Usable</td></tr><tr><td>
                <code class="literal">format_h264</code>
              </td><td><a id="I_indexterm2_d1e3271" class="indexterm"></a>H.264—video <code class="filename">.h264</code></td><td>Usable</td></tr><tr><td>
                <code class="literal">format_ilbc</code>
              </td><td><a id="I_indexterm2_d1e3284" class="indexterm"></a>Internet Low Bitrate Codec
              <code class="filename">.ilbc</code></td><td>Insignificant</td></tr><tr><td>
                <code class="literal">format_jpeg</code>
              </td><td><a id="I_indexterm2_d1e3297" class="indexterm"></a>Graphic file <code class="filename">.jpeg</code>
              <code class="filename">.jpg</code></td><td>Insignificant</td></tr><tr><td>
                <code class="literal">format</code>
                <code class="literal">_ogg_</code>
                <code class="literal">vorbis</code>
              </td><td><a id="I_indexterm2_d1e3317" class="indexterm"></a>Ogg container <code class="filename">.ogg</code></td><td>Usable</td></tr><tr><td>
                <code class="literal">format_pcm</code>
              </td><td><a id="I_indexterm2_d1e3330" class="indexterm"></a>Various Pulse-Coded Modulation <span class="keep-together">formats</span>:
              <code class="filename">.alaw</code>, <code class="filename">.al</code>,
              <code class="filename">.alw</code>, <code class="filename">.pcm</code>,
              <code class="filename">.ulaw</code>, <code class="filename">.ul</code>,
              <code class="filename">.mu</code>, <code class="filename">.ulw</code>,
              <code class="filename">.g722</code>, <code class="filename">.au</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">format_siren14</code>
              </td><td><a id="I_indexterm2_d1e3374" class="indexterm"></a>G.722.1 Annex C (14 kHz)
              <code class="filename">.siren14</code></td><td>New</td></tr><tr><td>
                <code class="literal">format_siren7</code>
              </td><td><a id="I_indexterm2_d1e3388" class="indexterm"></a>G.722.1 (7 kHz)
              <code class="filename">.siren7</code></td><td>New</td></tr><tr><td>
                <code class="literal">format_sln16</code>
              </td><td><a id="I_indexterm2_d1e3401" class="indexterm"></a>16-bit signed linear
              <code class="filename">.sln16</code></td><td>New</td></tr><tr><td>
                <code class="literal">format_sln</code>
              </td><td><a id="I_indexterm2_d1e3414" class="indexterm"></a>8-bit signed linear <code class="filename">.sln</code>
              <code class="filename">.raw</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">format_vox</code>
              </td><td>
                <code class="filename"><a id="I_indexterm2_d1e3431" class="indexterm"></a>.vox</code>
              </td><td>Insignificant</td></tr><tr><td>
                <code class="literal">format_wav</code>
              </td><td>
                <code class="filename"><a id="I_indexterm2_d1e3443" class="indexterm"></a>.wav</code>
              </td><td>Useful</td></tr><tr><td>
                <code class="literal">format_wav_gsm</code>
              </td><td><a id="I_indexterm2_d1e3454" class="indexterm"></a>GSM audio in a WAV container
              <code class="filename">.WAV</code>, <code class="filename">.wav49</code></td><td>Usable</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Dialplan Functions"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id293084"></a>Dialplan Functions</h3></div></div></div><p><a id="Architecture_id293089"></a><a id="I_indexterm2_d1e3469" class="indexterm"></a><a id="I_indexterm2_d1e3474" class="indexterm"></a><a id="I_indexterm2_d1e3479" class="indexterm"></a><a id="I_indexterm2_d1e3484" class="indexterm"></a>Dialplan functions, listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293094" title="Table 2.8. Dialplan functions">Table&nbsp;2.8, “Dialplan functions”</a>, complement the dialplan applications
      (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422" title="Applications">the section called “Applications”</a>). They provide many useful
      enhancements to things like string handling, time and date wrangling,
      and ODBC connectivity.</p><div class="table"><a id="Architecture_id293094"></a><p class="title"><strong>Table&nbsp;2.8.&nbsp;Dialplan functions</strong></p><div class="table-contents"><table summary="Dialplan functions" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">func_aes</code>
              </td><td><a id="index-221S304LT3N" class="indexterm"></a>Encrypts/decrypts an AES string</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_audiohookinherit</code>
              </td><td>Allows calls to be recorded after transfer</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_base64</code>
              </td><td>Encodes/decodes a base-64 string</td><td>Usable</td></tr><tr><td>
                <code class="literal">func_blacklist</code>
              </td><td>Writes/reads blacklist in
              <code class="filename">astdb</code></td><td>Useful</td></tr><tr><td>
                <code class="literal">func_callcompletion</code>
              </td><td>Gets/sets call completion configuration parameters for
              the channel</td><td>New</td></tr><tr><td>
                <code class="literal">func_callerid</code>
              </td><td>Gets/sets CallerID</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_cdr</code>
              </td><td>Gets/sets CDR variable</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_channel</code>
              </td><td>Gets/sets channel information</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_config</code>
              </td><td>Includes <code class="literal">AST_CONFIG()</code>; reads variables
              from config file</td><td>Usable</td></tr><tr><td>
                <code class="literal">func_connectedline</code>
              </td><td>Changes connected line information on supported
              handsets</td><td>New</td></tr><tr><td>
                <code class="literal">func_curl</code>
              </td><td>Uses cURL to obtain data from a URI</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_cut</code>
              </td><td>Slices and dices strings</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_db</code>
              </td><td>Provides <code class="filename">astdb</code> functions</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_devstate</code>
              </td><td>Gets state of device</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_dialgroup</code>
              </td><td>Creates a group for simultaneous dialing</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_dialplan</code>
              </td><td>Validates that designated target exists in
              dialplan</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_enum</code>
              </td><td>Performs ENUM lookup</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_env</code>
              </td><td>Includes <code class="literal">FILE()</code>,
              <code class="literal">STAT()</code>, and <code class="literal">ENV()</code>;
              performs operating system actions</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_extstate</code>
              </td><td>Returns status of a hinted extension</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_global</code>
              </td><td>Gets/sets global variables</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_groupcount</code>
              </td><td>Gets/sets channel count for members of a group</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_iconv</code>
              </td><td>Converts between character sets</td><td>Usable</td></tr><tr><td>
                <code class="literal">func_lock</code>
              </td><td>Includes <code class="literal">LOCK()</code>,
              <code class="literal">UNLOCK()</code>, and <code class="literal">TRYLOCK()</code>;
              sets a lock that can be used to avoid race conditions in the
              dialplan</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_logic</code>
              </td><td>Includes <code class="literal">ISNULL()</code>,
              <code class="literal">SET()</code>, <code class="literal">EXISTS()</code>,
              <code class="literal">IF()</code>, <code class="literal">IFTIME()</code>, and
              <code class="literal">IMPORT()</code>; performs various logical
              functions</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_math</code>
              </td><td>Includes <code class="literal">MATH()</code>,
              <code class="literal">INC()</code>, and <code class="literal">DEC()</code>; performs
              mathematical <span class="keep-together">functions</span></td><td>Useful</td></tr><tr><td>
                <code class="literal">func_md5</code>
              </td><td>Converts supplied string to an MD5 hash</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_module</code>
              </td><td>Checks to see if supplied module is loaded into
              memory</td><td>Usable</td></tr><tr><td>
                <code class="literal">func_odbc</code>
              </td><td>Allows dialplan integration with ODBC resources</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_pitchshift</code>
              </td><td>Shifts the pitch of an audio stream</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_rand</code>
              </td><td>Returns a random number within a given range</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_realtime</code>
              </td><td>Performs lookups within the Asterisk Realtime
              Architecture (ARA)</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_redirecting</code>
              </td><td>Provides access to information about where this call was
              redirected from</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_sha1</code>
              </td><td>Converts supplied string to an SHA1 hash</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_shell</code>
              </td><td>Performs Linux shell operations and returns
              results</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_speex</code>
              </td><td>Reduces noise and performs dB gain/loss on an audio
              stream</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_sprintf</code>
              </td><td>Performs string format functions similar to C function of
              same name</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_srv</code>
              </td><td>Perform SRV lookups in the dialplan</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_strings</code>
              </td><td>Includes over a dozen string manipulation
              functions</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_sysinfo</code>
              </td><td>Gets system information such as RAM, swap, load average,
              etc.</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_timeout</code>
              </td><td>Gets/sets timeouts on channel</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_uri</code>
              </td><td>Converts strings to URI-safe encoding</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_version</code>
              </td><td>Returns Asterisk version information</td><td>Usable</td></tr><tr><td>
                <code class="literal">func_vmcount</code>
              </td><td>Returns count of messages in a voicemail folder for a
              particular user</td><td>Useful</td></tr><tr><td>
                <code class="literal">func_volume</code>
              </td><td>Sets volume on a channel<a id="I_indexterm2_d1e3921" class="indexterm"></a></td><td>Useful</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="PBX Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id293711"></a>PBX Modules</h3></div></div></div><p><a id="Architecture_id293716"></a><a id="I_indexterm2_d1e3929" class="indexterm"></a><a id="I_indexterm2_d1e3934" class="indexterm"></a><a id="I_indexterm2_d1e3937" class="indexterm"></a>The PBX modules are peripheral modules that provide
      enhanced control and configuration mechanisms. For example,
      <code class="literal">pbx_config</code> is the module that loads the traditional
      Asterisk dialplan. The currently available PBX modules are listed in
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293725" title="Table 2.9. PBX modules">Table&nbsp;2.9, “PBX modules”</a>.</p><div class="table"><a id="Architecture_id293725"></a><p class="title"><strong>Table&nbsp;2.9.&nbsp;PBX modules</strong></p><div class="table-contents"><table summary="PBX modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">pbx_ael</code>
              </td><td><a id="I_indexterm2_d1e3968" class="indexterm"></a>Asterisk Extension Logic (AEL) offers a dialplan
              scripting language that looks like a modern programming
              language.</td><td>Usable<sup>[<a id="id513407" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id513407" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">pbx_config</code>
              </td><td><a id="I_indexterm2_d1e3982" class="indexterm"></a>This is the traditional, and most popular,
              dialplan language for Asterisk. Without this module, Asterisk
              cannot read <code class="filename">extensions.conf</code>.</td><td>Useful</td></tr><tr><td>
                <code class="literal">pbx_dundi</code>
              </td><td><a id="I_indexterm2_d1e3996" class="indexterm"></a>Performs data lookups on remote Asterisk
              systems.</td><td>Useful</td></tr><tr><td>
                <code class="literal">pbx_loopback</code>
              </td><td><a id="I_indexterm2_d1e4007" class="indexterm"></a>Performs something similar to a dialplan include,
              but in a deprecated manner.</td><td>Insignificant<sup>[<a id="id513496" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id513496" class="footnote">b</a>]</sup></td></tr><tr><td>
                <code class="literal">pbx_lua</code>
              </td><td><a id="I_indexterm2_d1e4021" class="indexterm"></a>Allows creation of a dialplan using the Lua
              scripting language.</td><td>Useful</td></tr><tr><td>
                <code class="literal">pbx_realtime</code>
              </td><td><a id="I_indexterm2_d1e4032" class="indexterm"></a>Provides functionality related to the Asterisk
              Realtime Architecture.</td><td>Useful</td></tr><tr><td>
                <code class="literal">pbx_spool</code>
              </td><td><a id="I_indexterm2_d1e4043" class="indexterm"></a>Provides outgoing spool support relating to
              Asterisk call files.</td><td>Useful</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id513407" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id513407" class="para">a</a>] </sup>We have not found too many people using AEL. We
                  suspect this is because most developers will tend to use
                  AGI/AMI if they do not want to use traditional
                  dialplans.</p></div><div class="footnote"><p><sup>[<a id="ftn.id513496" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id513496" class="para">b</a>] </sup>We’ve never heard of this being used in
                  production.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Resource Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id293876"></a>Resource Modules</h3></div></div></div><p><a id="Architecture_id293882"></a><a id="I_indexterm2_d1e4054" class="indexterm"></a><a id="I_indexterm2_d1e4059" class="indexterm"></a><a id="I_indexterm2_d1e4062" class="indexterm"></a>Resource modules integrate Asterisk with external
      resources. For example, <code class="literal">res_odbc</code> allows Asterisk to
      interoperate with ODBC database connections. The currently available
      resource modules are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293886" title="Table 2.10. Resource modules">Table&nbsp;2.10, “Resource modules”</a>.</p><div class="table"><a id="Architecture_id293886"></a><p class="title"><strong>Table&nbsp;2.10.&nbsp;Resource modules</strong></p><div class="table-contents"><table summary="Resource modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">res_adsi</code>
              </td><td>Provides ADSI</td><td>Essential<sup>[<a id="id513688" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id513688" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">res_ael_share</code>
              </td><td>Provides shared routines for use with
              <code class="literal">pbx_ael</code></td><td>Essential if you’re using AEL</td></tr><tr><td>
                <code class="literal">res_agi</code>
              </td><td>Provides Asterisk Gateway Interface</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_ais</code>
              </td><td>Provides distributed message waiting indication (MWI) and
              device state notifications via an implementation of the AIS
              standard, such as OpenAIS</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_calendar</code>
              </td><td>Enables base integration to calendaring systems</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_calendar_caldav</code>
              </td><td>Provides CalDAV-specific capabilities</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_calendar_exchange</code>
              </td><td>Provides MS Exchange capabilities</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_calendar_icalendar</code>
              </td><td>Provides Apple/Google iCalendar capabilities</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_clialiases</code>
              </td><td>Creates CLI aliases</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_clioriginate</code>
              </td><td>Originates a call from the CLI</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_config_curl</code>
              </td><td>Pulls configuration information using cURL</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_config_ldap</code>
              </td><td>Pulls configuration information using LDAP</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_config_odbc</code>
              </td><td>Pulls configuration information using ODBC</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_config_pgsql</code>
              </td><td>Pulls configuration information using PostgreSQL</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_config_sqlite</code>
              </td><td>Pulls configuration information using SQLite</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_convert</code>
              </td><td>Uses the CLI to perform file conversions</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_crypto</code>
              </td><td>Provides cryptographic capabilities</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_curl</code>
              </td><td>Provides common subroutines for other cURL
              modules</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_fax</code>
              </td><td>Provides common subroutines for other fax modules</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_fax_spandsp</code>
              </td><td>Plug-in for fax using the <code class="literal">spandsp</code>
              package</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_http_post</code>
              </td><td>Provides POST upload support for the Asterisk HTTP
              server</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_jabber</code>
              </td><td>Provides Jabber/XMPP resources</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_limit</code>
              </td><td>Enables adjusting of system limits on the Asterisk
              process</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_monitor</code>
              </td><td>Provides call recording resources</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_musiconhold</code>
              </td><td>Provides music on hold (MOH) resources</td><td>Essential</td></tr><tr><td>
                <code class="literal">res_mutestream</code>
              </td><td>Allows muting/unmuting of audio streams</td><td>New</td></tr><tr><td>
                <code class="literal">res_odbc</code>
              </td><td>Provides common subroutines for other ODBC
              modules</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_phoneprov</code>
              </td><td>Provisions phones from Asterisk HTTP server</td><td>New</td></tr><tr><td>
                <code class="literal">res_pktccops</code>
              </td><td>Provides PacketCable COPS resources</td><td>New</td></tr><tr><td>
                <code class="literal">res_realtime</code>
              </td><td>Provides CLI commands for the Asterisk Realtime <span class="keep-together">Architecture</span> (ARA)</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_rtp_asterisk</code>
              </td><td>Provides RTP</td><td>Essential</td></tr><tr><td>
                <code class="literal">res_rtp_multicast</code>
              </td><td>Provides multicast-RTP</td><td>New</td></tr><tr><td>
                <code class="literal">res_security_log</code>
              </td><td>Enables security logging</td><td>New</td></tr><tr><td>
                <code class="literal">res_smdi</code>
              </td><td>Provides voicemail notification using the SMDI
              protocol</td><td>Limited</td></tr><tr><td>
                <code class="literal">res_snmp</code>
              </td><td>Provides system status information to an SNMP-managed
              network</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_speech</code>
              </td><td>Generic speech recognition API</td><td>Limited<sup>[<a id="id514343" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id514343" class="footnote">b</a>]</sup></td></tr><tr><td>
                <code class="literal">res_timing_dahdi</code>
              </td><td>Provides timing using the DAHDI kernel interface</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_timing_kqueue</code>
              </td><td>Provides timing using a kernel feature in some BSDs,
              including Mac OS X</td><td>New</td></tr><tr><td>
                <code class="literal">res_timing_pthread</code>
              </td><td>Provides timing using only parts of the standard
              <code class="literal">pthread</code> API; less efficient but more portable
              than other timing modules.</td><td>Useful</td></tr><tr><td>
                <code class="literal">res_timing_timerfd</code>
              </td><td>Provides timing using the <code class="literal">timerfd</code> API
              provided by newer versions of the Linux kernel</td><td>Useful</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id513688" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id513688" class="para">a</a>] </sup>While most of the ADSI functionality in Asterisk is
                  never used, the voicemail application uses this
                  resource.</p></div><div class="footnote"><p><sup>[<a id="ftn.id514343" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id514343" class="para">b</a>] </sup>Requires a separately licensed product in order to be
                  used.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Addon Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294456"></a>Addon Modules</h3></div></div></div><p><a id="Architecture_id294462"></a><a id="I_indexterm2_d1e4435" class="indexterm"></a><a id="I_indexterm2_d1e4440" class="indexterm"></a><a id="I_indexterm2_d1e4443" class="indexterm"></a>Addon modules are community-developed modules with
      different usage or distribution rights from those of the main code. They
      are kept in a separate directory and are not compiled and installed by
      default. To enable these modules, use the <span class="command"><strong>menuselect</strong></span>
      build configuration utility. Currently available addon modules are
      listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294470" title="Table 2.11. Addon modules">Table&nbsp;2.11, “Addon modules”</a>.</p><div class="table"><a id="Architecture_id294470"></a><p class="title"><strong>Table&nbsp;2.11.&nbsp;Addon modules</strong></p><div class="table-contents"><table summary="Addon modules" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Purpose</th><th align="center">Popularity/Status</th></tr></thead><tbody><tr><td>
                <code class="literal">app_mysql</code>
              </td><td><a id="I_indexterm2_d1e4474" class="indexterm"></a>Executes MySQL queries with a <span class="keep-together">dialplan</span> application</td><td>Deprecated—see <code class="literal">func_odbc</code></td></tr><tr><td>
                <code class="literal">app_saycountpl</code>
              </td><td><a id="I_indexterm2_d1e4490" class="indexterm"></a>Says Polish counting words</td><td>Deprecated—now integrated in
              <code class="filename">say.conf</code></td></tr><tr><td>
                <code class="literal">cdr_mysql</code>
              </td><td><a id="I_indexterm2_d1e4503" class="indexterm"></a>Logs call detail records to a MySQL
              database</td><td>Usable—we recommend <code class="literal">cdr_adaptive_odbc</code>
              instead</td></tr><tr><td>
                <code class="literal">chan_mobile</code>
              </td><td><a id="I_indexterm2_d1e4517" class="indexterm"></a>Enables making and receiving phone calls using
              cell phones over Bluetooth</td><td>Limited<sup>[<a id="id514648" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id514648" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">chan_ooh323</code>
              </td><td><a id="I_indexterm2_d1e4534" class="indexterm"></a>Enables making and receiving VoIP calls using the
              H.323 protocol</td><td>Usable</td></tr><tr><td>
                <code class="literal">format_mp3</code>
              </td><td><a id="I_indexterm2_d1e4545" class="indexterm"></a>Allows Asterisk to play MP3 files</td><td>Usable</td></tr><tr><td>
                <code class="literal">res_config_mysql</code>
              </td><td><a id="I_indexterm2_d1e4556" class="indexterm"></a>Uses a MySQL database as a real-time configuration
              backend</td><td>Useful</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id514648" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id514648" class="para">a</a>] </sup>While <code class="literal">chan_mobile</code> works great with
                  many phones, problems have been reported with some models.
                  When a problem does occur, it is very difficult for
                  developers to solve unless they have a phone of the same
                  model to test with.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Test Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294611"></a>Test Modules</h3></div></div></div><p><a id="Architecture_id294617"></a><a id="I_indexterm2_d1e4566" class="indexterm"></a><a id="I_indexterm2_d1e4571" class="indexterm"></a><a id="I_indexterm2_d1e4574" class="indexterm"></a>Test modules are used by the Asterisk development team to
      validate new code. They are constantly changing and being added to, and
      are not useful unless you are developing Asterisk software.</p><p><a id="Architecture_id347917"></a>If you are an Asterisk developer,
      however, the Asterisk Test Suite <a id="I_indexterm2_d1e4584" class="indexterm"></a>may be of interest to you as you can build automated tests
      for Asterisk and submit those back to the project, which runs on several
      different operating systems and types of machines. By expanding the
      number of tests constantly, the Asterisk project avoids the creation of
      regressions in code. By submitting your own tests to the project, you
      can feel more confident in future upgrades.</p><p><a id="Architecture_id347924"></a>More information about installing the
      Asterisk Test Suite is available in this blog post: <a class="ulink" href="http://blogs.asterisk.org/2010/04/29/installing-the-asterisk-test-suite/" target="_top">http://blogs.asterisk.org/2010/04/29/installing-the-asterisk-test-suite/</a>.
      More information about building tests is available in this document:
      <a class="ulink" href="http://svn.asterisk.org/svn/testsuite/asterisk/trunk/README.txt" target="_top">http://svn.asterisk.org/svn/testsuite/asterisk/trunk/README.txt</a>
      or you can join the <span class="emphasis"><em>#asterisk-testing</em></span> channel on
      the Freenode IRC network.<a id="I_indexterm2_d1e4597" class="indexterm"></a><a id="I_indexterm2_d1e4598" class="indexterm"></a></p></div></div><div class="sect1" title="File Structure"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="file_structure"></a>File Structure</h2></div></div></div><p><a id="Architecture_id294631"></a><a id="index-617W713QB0H" class="indexterm"></a><a id="index-781H656GU5U" class="indexterm"></a>Asterisk is a complex system, composed of many resources.
    These resources make use of the filesystem in several ways. Since Linux is
    so flexible in this regard, it is helpful to understand what data is being
    stored, so that you can understand where you are likely to find a
    particular bit of stored data (such as voicemail messages or log
    files).</p><div class="sect2" title="Configuration Files"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294638"></a>Configuration Files</h3></div></div></div><p><a id="Architecture_id294643"></a><a id="I_indexterm2_d1e4616" class="indexterm"></a><a id="I_indexterm2_d1e4621" class="indexterm"></a><a id="I_indexterm2_d1e4628" class="indexterm"></a>The Asterisk configuration files include
      <code class="filename">extensions.conf</code>, <code class="filename">sip.conf</code>,
      <code class="filename">modules.conf</code>, and dozens of other files that define
      parameters for the various channels, resources, modules, and functions
      that may be in use.</p><p><a id="Architecture_id294657"></a>These files will be found in
      <code class="filename">/etc/asterisk</code>. You will be working in this folder a
      lot as you configure and administer your Asterisk system.</p></div><div class="sect2" title="Modules"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294666"></a>Modules</h3></div></div></div><p><a id="Architecture_id294671"></a><a id="I_indexterm2_d1e4652" class="indexterm"></a><a id="I_indexterm2_d1e4657" class="indexterm"></a><a id="I_indexterm2_d1e4664" class="indexterm"></a>Asterisk modules are usually installed to the
      <code class="filename">/usr/lib/asterisk/modules</code> folder. You will not
      normally have to interact with this folder; however, it will be
      occasionally useful to know where the modules are located. For example,
      if you upgrade Asterisk and select different modules during the
      <span class="command"><strong>menuselect</strong></span> phase of the install, the old
      (incompatible) modules from the previous Asterisk version will not be
      deleted, and you will get a warning from the install script. Those old
      files will need to be deleted from the <code class="filename">modules
      </code>folder. This can be done either manually or with the
      “uninstall” make (<span class="command"><strong>make uninstall</strong></span>) target.</p></div><div class="sect2" title="The Resource Library"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294686"></a>The Resource Library</h3></div></div></div><p><a id="Architecture_id294692"></a><a id="I_indexterm2_d1e4686" class="indexterm"></a><a id="I_indexterm2_d1e4689" class="indexterm"></a><a id="I_indexterm2_d1e4694" class="indexterm"></a><a id="I_indexterm2_d1e4701" class="indexterm"></a>There are several resources that require external data
      sources. For example, music on hold (MOH) can’t happen unless you have
      some music to play. System prompts also need to be stored somewhere on
      the hard drive. The <code class="filename">/var/lib/asterisk</code> folder is
      where system prompts, AGI scripts, music on hold, and other resource
      files are stored.</p></div><div class="sect2" title="The Spool"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294702"></a>The Spool</h3></div></div></div><p><a id="Architecture_id294708"></a><a id="I_indexterm2_d1e4714" class="indexterm"></a><a id="I_indexterm2_d1e4719" class="indexterm"></a><a id="I_indexterm2_d1e4722" class="indexterm"></a>The <span class="command"><strong>spool</strong></span> is where Linux stores files
      that are going to change frequently, or will be processed by other
      processes at a later time. For example, under Linux print jobs and
      pending emails are normally written to the spool until they are
      processed.</p><p><a id="Architecture_id294713"></a>For Asterisk, the spool is used to
      store transient items such as voice messages, call recordings,<sup>[<a id="id515137" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id515137" class="footnote">16</a>]</sup> call files, and so forth.</p><p><a id="Architecture_id294725"></a>The Asterisk spool will be found under
      the <code class="filename">/var/spool/asterisk</code> directory.<a id="I_indexterm2_d1e4747" class="indexterm"></a><a id="I_indexterm2_d1e4748" class="indexterm"></a></p></div><div class="sect2" title="Logging"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id294732"></a>Logging</h3></div></div></div><p><a id="Architecture_id294738"></a><a id="I_indexterm2_d1e4753" class="indexterm"></a><a id="I_indexterm2_d1e4758" class="indexterm"></a><a id="I_indexterm2_d1e4761" class="indexterm"></a>Asterisk is capable of generating several different kinds
      of log files. The <code class="filename">/var/log/asterisk</code> folder is where
      things such as call detail records (CDRs), channel events from CEL,
      debug logs, queue logs, messages, errors, and other output are
      written.</p><p><a id="Architecture_id294746"></a>This folder will be extremely important
      for any troubleshooting efforts you undertake. We will talk more about
      how to make use of Asterisk logs in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring" title="Chapter 24. System Monitoring and Logging">Chapter&nbsp;24, <em>System Monitoring and Logging</em></a>.</p></div></div><div class="sect1" title="The Dialplan"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Architecture_id294754"></a>The Dialplan</h2></div></div></div><p><a id="Architecture_id294759"></a><a id="I_indexterm2_d1e4780" class="indexterm"></a><a id="I_indexterm2_d1e4785" class="indexterm"></a>The dialplan is the heart of Asterisk. All channels that
    arrive in the system will be passed through the dialplan, which contains
    the call-flow script that determines how the incoming calls are
    handled.</p><p><a id="Architecture_id294764"></a>A dialplan can be written in one of three
    ways:</p><div class="itemizedlist"><a id="Architecture_id294767"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Architecture_id294769"></a><a id="Architecture_id294771"></a>Using traditional Asterisk dialplan
        syntax in <code class="filename">/etc/asterisk/extensions.conf</code></p></li><li class="listitem"><p><a id="Architecture_id294778"></a><a id="Architecture_id294780"></a>Using asterisk Extension Logic (AEL)
        in <code class="filename">/etc/asterisk/extensions.ael</code></p></li><li class="listitem"><p><a id="Architecture_id294786"></a><a id="Architecture_id294788"></a>Using LUA in
        <code class="filename">/etc/asterisk/extensions.lua</code></p></li></ul></div><p><a id="Architecture_id294796"></a>Later in this book, we’ll have devoted
    several chapters to the subject of how to write a dialplan using
    traditional dialplan syntax (by far the most popular choice). Once you
    learn this language, it should be fairly easy to transition to AEL or LUA,
    should you desire.</p></div><div class="sect1" title="Hardware"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Architecture_id294803"></a>Hardware</h2></div></div></div><p><a id="Architecture_id294808"></a><a id="I_indexterm2_d1e4815" class="indexterm"></a><a id="I_indexterm2_d1e4820" class="indexterm"></a>Asterisk is capable of communicating with a vast number of
    different technologies. In general, these connections are made across a
    network connection; however, connections to more traditional telecom
    technologies, such as the PSTN, require specific hardware.</p><p><a id="Architecture_id294814"></a>Many companies produce this hardware,
    such as Digium (the sponsor, owner, and primary developer of Asterisk),
    Sangoma, Rhino, OpenVox, Pika, Voicetronix, <span class="keep-together">Junghanns</span>, Dialogic, Xorcom, beroNet, and
    many others. The authors prefer cards from Digium and Sangoma; however,
    the products offered by other Asterisk hardware manufacturers may be more
    suitable to your requirements.</p><p><a id="Architecture_id294820"></a>The most popular hardware for Asterisk is
    generally designed to work through the Digium Asterisk Hardware Device
    Interface (known as DAHDI)<a id="I_indexterm2_d1e4833" class="indexterm"></a>. These cards will all have different installation
    requirements and different file locations.</p><p><a id="Architecture_id294826"></a>In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>, we will discuss DAHDI in more detail;
    however, we will limit our discussion to DAHDI only. You will need to
    refer to the specific documentation provided by the manufacturers of any
    cards you install for details on those cards.</p></div><div class="sect1" title="Asterisk Versioning"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-versioning"></a>Asterisk Versioning</h2></div></div></div><p><a id="Architecture_id348236"></a><a id="I_indexterm2_d1e4847" class="indexterm"></a><a id="I_indexterm2_d1e4852" class="indexterm"></a><a id="I_indexterm2_d1e4857" class="indexterm"></a>The Asterisk release methodology has gone through a couple
    of iterations over the last few years, and this section is designed to
    help you understand what the version numbers mean. Of particular relevance
    is the change in versioning that happened with the
    1.6.<span class="emphasis"><em>x</em></span> series of releases, which followed a different
    numbering logic than all other <span class="keep-together">Asterisk</span> releases (1.0 to 1.8 and onward for
    the foreseeable future).</p><div class="sect2" title="Previous Release Methodologies"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id348242"></a>Previous Release Methodologies</h3></div></div></div><p><a id="Architecture_id348247"></a>When we had just Asterisk 1.2 and 1.4,
      all new development was carried out in trunk (it still is), and only bug
      fixes went into the 1.2 and 1.4 branches. The Asterisk 1.2 branch has
      been marked as EOL (End of Life), and is no longer receiving bug fixes
      or security updates. Prior to the 1.6.<span class="emphasis"><em>x</em></span> branches,
      bug fixes were carried out only in trunk and in the 1.4 branch.</p><p><a id="Architecture_id348254"></a>Because all new development was done in
      trunk, until the 1.6 branch was created people were unable to get access
      to the new features and functionality. This isn’t to say the new
      functionality wasn’t available, but with all the changes that can happen
      in trunk, running a production server based on it requires a very
      Asterisk-savvy (and C code–savvy) administrator.</p><p><a id="Architecture_id348265"></a>To try to relieve the pressure on
      administrators, and to enable faster access to new features (in the time
      frame of months, and not years), a new methodology was created. Branches
      in 1.6 would actually be marked as 1.6.0, 1.6.1, 1.6.2, etc., with the
      third number increasing by one each time a new feature release was
      created. The goal was to provide new feature releases every 3–4 months
      (which would be branched from trunk), providing a shorter and clearer
      upgrade path for administrators. If you needed a new feature, you’d only
      have to wait a few months and could then upgrade to the next
      branch.</p><p><a id="Architecture_id348273"></a>Tags from these branches look like
      this:</p><div class="itemizedlist"><a id="Architecture_id348277"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Architecture_id348279"></a><a id="Architecture_id348281"></a>1.6.0.1 -- 1.6.0.2 -- 1.6.0.3 --
          1.6.0.4 -- etc.</p></li><li class="listitem"><p><a id="Architecture_id348285"></a><a id="Architecture_id348287"></a>1.6.1.1 -- 1.6.1.2 -- 1.6.1.3 --
          1.6.1.4 -- etc.</p></li><li class="listitem"><p><a id="Architecture_id348292"></a><a id="Architecture_id348294"></a>1.6.2.1 -- 1.6.2.2 -- 1.6.2.3 --
          1.6.2.4 -- etc.</p></li></ul></div><p><a id="Architecture_id348299"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-1.6-release-process" title="Figure 2.2. The Asterisk 1.6.x release process">Figure&nbsp;2.2, “The Asterisk 1.6.<span class="emphasis"><em>x</em></span> release process”</a> gives a visual representation
      of the branching and tagging process in relation to Asterisk
      trunk.</p><div class="figure-float"><div class="figure"><a id="asterisk-1.6-release-process"></a><p class="title"><strong>Figure&nbsp;2.2.&nbsp;The Asterisk 1.6.<span class="emphasis"><em>x</em></span> release process</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject2_d1e4900"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0202.png" alt="The Asterisk 1.6.x release process"></div></div></div><br class="figure-break"></div><p><a id="Architecture_id348328"></a>So, so far we have branches, which are
      1.2, 1.4, 1.6.0, 1.6.1, and 1.6.2 (there is no 1.6 branch). Within each
      of those branches, we create <span class="emphasis"><em>tags</em></span> (releases), which
      look like 1.2.14, 1.4.30, 1.6.0.12, 1.6.1.12, and 1.6.2.15.</p><p><a id="Architecture_id348334"></a>Unfortunately, it ended up not working
      out that 1.6.<span class="emphasis"><em>x</em></span> branches were created from trunk
      every 3–4 months: the development process has led to a minimum release
      time of 6–8 months. Not only that, but the 1.6.<span class="emphasis"><em>x</em></span>
      numbering methodology adds problems of its own. People got confused as
      to what version to run, and that the 1.6.0, 1.6.1, and 1.6.2 branches
      were all separate major version upgrades. When you increase the number
      from 1.2 to 1.4, and then to 1.8, it is obvious that those are distinct
      branches and major version changes. With 1.6.0, 1.6.1, and 1.6.2, it is
      less obvious.</p></div><div class="sect2" title="The New Release Methodology"><div class="titlepage"><div><div><h3 class="title"><a id="Architecture_id348349"></a>The New Release Methodology</h3></div></div></div><p><a id="Architecture_id348354"></a>The development team learned a lot of
      things during the 1.6.<span class="emphasis"><em>x</em></span> releases. The idea
      surrounding the releases was noble, but the implementation ended up
      being flawed when put into real use. So, with Asterisk 1.8, the
      methodology has changed again, and will look a lot more like that used
      in the 1.2 and 1.4 releases.</p><p><a id="Architecture_id348360"></a>While the development team still wants
      to provide access to new features and core changes on a more regular
      basis (every 12 months being the goal), there is recognition that it is
      also good to provide long-term support to a stable, popular version of
      Asterisk. You can think of the Asterisk 1.4 branch as being a long-term
      support (LTS) version. The 1.6.0, 1.6.1, and 1.6.2 branches can be
      thought of as feature releases that continue to receive bug fixes after
      release, but are supported for a shorter period of time (about a year).
      The new LTS version is Asterisk 1.8 (what this book is based on); it
      will receive bug fixes for four years and an additional year of security
      releases after that, providing five years of support from the Digium
      development team.</p><p><a id="Architecture_id348370"></a>During the long-term support phase of
      Asterisk 1.8, additional branches will be created on a semi-regular
      basis as feature releases. These will be tagged as versions 1.10, 1.12,
      and 1.14, respectively. Each of these branches will receive bug fixes
      for a period of one year, and security releases will continue to be made
      for an additional year before the branches are marked as EOL.</p><p><a id="Architecture_id348377"></a>The current statuses of all Asterisk
      branches, their release dates, when they will go into security
      release–only mode, and when they will reach EOL status are all
      documented on the Asterisk wiki at <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+Versions" target="_top">https://wiki.asterisk.org/wiki/display/AST/Asterisk+Versions</a>.</p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Architecture_id294832"></a>Conclusion</h2></div></div></div><p><a id="Architecture_id294838"></a>Asterisk is composed of many different
    technologies, most of which are complicated in their own right. As such,
    the understanding of Asterisk architecture can be overwhelming. Still, the
    reality is that Asterisk is well-designed for what it does and, in our
    opinion, has achieved remarkable balance between flexibility and
    complexity.<a id="I_indexterm2_d1e4940" class="indexterm"></a><a id="I_indexterm2_d1e4941" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id507297" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id507297" class="para">12</a>] </sup>To be fair, many traditional PBXs do offer this sort of
      functionality. However, it is generally kludgy, limited in features, and
      requires complex, proprietary software to be installed in the PBX (such
      as vendor-specific protocol extensions).</p></div><div class="footnote"><p><sup>[<a id="ftn.id511179" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id511179" class="para">13</a>] </sup>More information about what codecs are and how they work is
          available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3" title="Codecs">the section called “Codecs”</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id511628" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id511628" class="para">14</a>] </sup>It is partly for this reason that we do not recommend the
          default GSM format for system recordings. WAV recordings will sound
          better and use less CPU.</p></div><div class="footnote"><p><sup>[<a id="ftn.id511640" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id511640" class="para">15</a>] </sup>Some codecs can impose a significant load on the CPU, such
          that a system that could support several hundred channels without
          transcoding might only be able to handle a few dozen when
          transcoding is in use.</p></div><div class="footnote"><p><sup>[<a id="ftn.id515137" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id515137" class="para">16</a>] </sup>Not call detail records (CDRs), but rather audio recordings of
          calls generated by the <code class="literal">MixMonitor()</code> and related
          applications.</p></div></div></div><div class="chapter" title="Chapter 3. Installing Asterisk"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Install"></a>Chapter&nbsp;3.&nbsp;Installing Asterisk</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291070">Distribution Installation</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291082">CentOS Server</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291135">Base system installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291582">Base system update</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291827">Ubuntu Server</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291868">Base system installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292090">Base system update</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_subversion">Getting the Source via Subversion</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_wget">Getting the Source via wget</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it">How to Install It</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423812">LibPRI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870">DAHDI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id424034">Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292785">Setting File Permissions</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_base_configuration">Base Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293578">Disable SELinux</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293688">Initial Configuration</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294211">modules.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994">make menuselect</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293020">Uses for menuselect</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293213">Using menuselect</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294543">Common Issues</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294571">-bash: wget: command not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294625">configure: error: no acceptable C compiler found in $PATH</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294679">make: gcc: command not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294733">configure: error: C++ preprocessor “/lib/cpp” fails sanity
      check</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294786">configure: error: *** Please install GNU make. It is required to
      build Asterisk!</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294844">configure: *** XML documentation will not be available because
      the ‘libxml2’ development package is missing.</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294901">configure: error: *** termcap support not found</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294955">You do not appear to have the sources for the 2.6.18-164.6.1.el5
      kernel installed.</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295010">E: Unable to lock the administration directory (/var/lib/dpkg/),
      are you root?</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295025">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Installing_id245664"></a>I long to accomplish great and noble tasks,
    but it is my chief duty to accomplish humble tasks as though they were
    great and noble. The world is moved along, not only by the mighty shoves
    of its heroes, but also by the aggregate of the tiny pushes of each honest
    worker.</p><div class="attribution"><span>—<span class="attribution">Helen Keller</span></span></div></div><p><a id="Installing_id246065"></a><a id="index-720A872JV6G" class="indexterm"></a><a id="index-470Q862PA1N" class="indexterm"></a>In this chapter we’re going to walk through the installation
  of Asterisk from the source code. Many people shy away from this method,
  claiming that it is too difficult and time-consuming. Our goal here is to
  demonstrate that installing Asterisk from source is not actually that
  difficult to do. More importantly, we want to provide you with the best
  Asterisk platform on which to learn.</p><p><a id="Installing_id247926"></a>In this book we will be helping you build a
  functioning Asterisk system from scratch. In this chapter you will build a
  base platform for your Asterisk system. Given that we are installing from
  source, there is potentially a lot of variation in how you can do this. The
  process we discuss here is one that we’ve used for many years, and following
  it will provide you with a suitable foundation for Asterisk.</p><p><a id="Installing_id248396"></a>As part of this process we will also explain
  installation of some of the software dependencies on the Linux platform that
  will be needed for topics covered later in this book (such as database
  integration). We will show instructions for installing Asterisk on both
  <a class="ulink" href="http://www.centos.org/" target="_top">CentOS</a> (a Red Hat–based
  distribution) and <a class="ulink" href="http://www.ubuntu.com/" target="_top">Ubuntu</a> (a
  Debian-based distribution), which we believe covers the vast majority of
  Linux distributions being installed today. We’ll try to keep the
  instructions general enough that they should be useful on any distribution
  of your choice.<sup>[<a id="id515960" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id515960" class="footnote">17</a>]</sup></p><p><a id="Installing_id246428"></a>We have chosen to install on CentOS and
  Ubuntu because they are the most popular options, but Asterisk is generally
  distribution-agnostic. Asterisk will even install on Solaris, BSD, or OS
  X<sup>[<a id="id515977" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id515977" class="footnote">18</a>]</sup> if you like. We won’t be covering them in this book, though,
  as Asterisk is most heavily developed on the Linux platform.</p><div class="sidebar" title="Asterisk Packages"><a id="Installing_id265658"></a><div class="titlepage"><div><div><p class="title"><strong>Asterisk Packages</strong></p></div></div></div><p><a id="Installing_id252224"></a>There are also packages <a id="I_indexterm3_d1e4985" class="indexterm"></a>that exist for Asterisk that can be installed using popular
    <span class="keep-together">package</span>-<span class="keep-together">management</span> programs such as
    <span class="command"><strong>yum</strong></span> or <span class="command"><strong>apt-get</strong></span>. You are welcome to
    experiment with them. Prebuilt packages may not always be kept up-to-date,
    though, so for the latest version we always recommend installing from
    source.</p><p><a id="Installing_id243652"></a>You can find package instructions at <a class="ulink" href="http://www.asterisk.org/downloads/yum" target="_top">http://www.asterisk.org/downloads/yum</a>.</p></div><p><a id="Installing_id281805"></a>Some commands you see in this chapter will be
  split into separate rows, each labeled for the distribution on which the
  command should be performed. Commands for which distributions are not
  specified are for common commands that can be run on both
  distributions.</p><div class="sidebar" title="Asterisk-Based Projects"><a id="Installing_id281811"></a><div class="titlepage"><div><div><p class="title"><strong>Asterisk-Based Projects</strong></p></div></div></div><p><a id="Installing_id281816"></a>Many projects <a id="I_indexterm3_d1e5012" class="indexterm"></a>have been created that use Asterisk as their underlying
    platform. Some of these, such as Trixbox, have become so popular that many
    people mistake them for the Asterisk product itself. These projects
    generally will take the base Asterisk product and add a web-based
    administration interface, a complex database, and a rigid set of
    constraints on how changes can be made to the configuration.</p><p><a id="Installing_id216473"></a>We have chosen not to cover these projects
    in this book, for several reasons:</p><div class="orderedlist"><a id="Installing_id216476"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Installing_id216478"></a><a id="Installing_id216480"></a>This book tries, as much as possible,
        to focus on Asterisk and only Asterisk.</p></li><li class="listitem"><p><a id="Installing_id216485"></a><a id="Installing_id216488"></a>Books have already been written about
        some of these Asterisk-based projects.</p></li><li class="listitem"><p><a id="Installing_id216493"></a><a id="Installing_id216495"></a>We believe that if you learn Asterisk
        in the way that we will teach you, the knowledge will serve you well,
        regardless of whether you eventually choose to use one of these
        prepackaged versions of Asterisk.</p></li><li class="listitem"><p><a id="Installing_id216499"></a><a id="Installing_id216501"></a>For us, the power of Asterisk is that
        it does not attempt to solve your problems for you. These projects are
        an excellent example of what can be built with Asterisk. They are
        truly amazing. However, if you are looking to build your own Asterisk
        application (which is really what Asterisk is all about), these
        projects will impose limitations on you, because they are focused on
        simplifying the process of building a business PBX, not on making it
        easier to access the full potential of the Asterisk platform.</p></li></ol></div><p><a id="Installing_id241370"></a>Some of the most popular Asterisk-based
    projects include:</p><div class="informaltable"><a id="Installing_id241373"></a><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>AsteriskNOW</td><td>
              <a class="ulink" href="http://www.asterisk.org/asterisknow" target="_top">http://www.asterisk.org/asterisknow</a>
            </td></tr><tr><td>Trixbox</td><td>
              <a class="ulink" href="http://www.trixbox.org/" target="_top">http://www.trixbox.org</a>
            </td></tr><tr><td>Elastix</td><td>
              <a class="ulink" href="http://www.elastix.org/" target="_top">http://www.elastix.org</a>
            </td></tr><tr><td>PBX in a Flash</td><td>
              <a class="ulink" href="http://www.pbxinaflash.net/" target="_top">http://www.pbxinaflash.net</a>
            </td></tr></tbody></table></div><p><a id="Installing_id241438"></a>We recommend that you check them
    out.<sup>[<a id="id516270" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id516270" class="footnote">19</a>]</sup></p></div><div class="sect1" title="Installation Cheat Sheet"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id240883"></a>Installation Cheat Sheet</h2></div></div></div><p><a id="Installing_id240889"></a><a id="index-522B507FN1Q" class="indexterm"></a>If you just want the nitty-gritty on how to get Asterisk up
    and running quickly, perform the following at the shell prompt. We
    encourage you to read through the entire chapter at least once, though, in
    order to better understand the full process.<sup>[<a id="id516312" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id516312" class="footnote">20</a>]</sup></p><p><a id="Installing_id387055"></a>The instructions provided here assume
    you’ve already installed either CentOS<a id="I_indexterm3_d1e5077" class="indexterm"></a> or Ubuntu <a id="I_indexterm3_d1e5083" class="indexterm"></a>using the steps outlined in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291070" title="Distribution Installation">the section called “Distribution Installation”</a>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id240916"></a>Remember that Ubuntu requires commands to
      be prefixed with <span class="command"><strong>sudo</strong></span>.</p></div><div class="orderedlist"><a id="Installing_id240905"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Installing_id240925"></a><a id="Installing_id240927"></a>Perform a system update and
        reboot:</p><div class="informaltable"><a id="Installing_id240930"></a><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>CentOS</td><td>
                  <p>
                    <strong class="userinput"><code>yum update -y &amp;&amp;
                reboot</code></strong>
                  </p>
                </td></tr><tr><td>CentOS 64-bit</td><td>
                  <p>
                    <strong class="userinput"><code>yum remove *.i386 &amp;&amp; yum
                update -y &amp;&amp; reboot</code></strong>
                  </p>
                </td></tr><tr><td>Ubuntu</td><td>
                  <p>
                    <strong class="userinput"><code>sudo apt-get update &amp;&amp; sudo
                apt-get upgrade &amp;&amp; sudo
                reboot</code></strong>
                  </p>
                </td></tr></tbody></table></div></li><li class="listitem"><p><a id="Installing_id421340"></a><a id="Installing_id421342"></a>Synchronize time and install the NTP
        (Network Time Protocol) daemon:</p><div class="informaltable"><a id="Installing_id421356"></a><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>CentOS</td><td>
                  <p>
                    <strong class="userinput"><code>yum install -y ntp &amp;&amp; ntpdate
                pool.ntp.org &amp;&amp; chkconfig ntpd
                \</code></strong>
                  </p>
                  <p>
                    <strong class="userinput"><code>on &amp;&amp; service
                ntpd start</code></strong>
                  </p>
                </td></tr><tr><td>CentOS 64-bit</td><td>
                  <p>
                    <strong class="userinput"><code>yum install -y ntp &amp;&amp; ntpdate
                pool.ntp.org &amp;&amp; chkconfig ntpd
                \</code></strong>
                  </p>
                  <p>
                    <strong class="userinput"><code>on &amp;&amp; service
                ntpd start</code></strong>
                  </p>
                </td></tr><tr><td>Ubuntu</td><td>
                  <p>
                    <strong class="userinput"><code>sudo apt-get install
                ntp</code></strong>
                  </p>
                </td></tr></tbody></table></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id421347"></a>Some additional configuration of text
          files is required on Ubuntu. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150" title="Enable NTP for accurate system time">the section called “Enable NTP for accurate system time”</a>.</p></div></li><li class="listitem"><p><a id="Installing_id421403"></a><a id="Installing_id421405"></a>On CentOS, add a new system
        user:</p><div class="informaltable"><a id="Installing_id421419"></a><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>CentOS (32 and 64 bit)</td><td>
                  <p>
                    <strong class="userinput"><code>adduser asteriskpbx &amp;&amp; passwd
                asteriskpbx &amp;&amp; yum install
                \</code></strong>
                  </p>
                  <p>
                    <strong class="userinput"><code>sudo &amp;&amp;
                visudo</code></strong>
                  </p>
                </td></tr></tbody></table></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id421411"></a>See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699" title="Adding a system user">the section called “Adding a system user”</a> for specific information.</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id326710"></a>For an Ubuntu install, we are
          assuming that the user created during the installation process is
          <code class="filename">asteriskpbx</code>.</p></div></li><li class="listitem"><p><a id="Installing_id240979"></a><a id="Installing_id240982"></a>Install software dependencies:</p><div class="informaltable"><a id="Installing_id240985"></a><table border="1"><colgroup><col><col></colgroup><tbody><tr><td>CentOS</td><td>
                  <p>
                    <strong class="userinput"><code>sudo yum install gcc gcc-c++ make wget
                subversion \</code></strong>
                  </p>
                  <p><a id="Installing_id241007"></a>
                    <strong class="userinput"><code>libxml2-devel
                ncurses-devel openssl-devel \</code></strong>
                  </p>
                  <p><a id="Installing_id241010"></a>
                    <strong class="userinput"><code>vim-enhanced</code></strong>
                  </p>
                </td></tr><tr><td>CentOS 64-bit</td><td>
                  <p><a id="Installing_id269434"></a>
                    <strong class="userinput"><code>sudo yum
                install gcc.x86_64 gcc-c++.x86_64 \</code></strong>
                  </p>
                  <p><a id="Installing_id269437"></a>
                    <strong class="userinput"><code>make.x86_64 wget.x86_64
                subversion.x86_64 \</code></strong>
                  </p>
                  <p><a id="Installing_id269440"></a>
                    <strong class="userinput"><code>libxml2-devel.x86_64
                ncurses-devel.x86_64 \</code></strong>
                  </p>
                  <p><a id="Installing_id269444"></a>
                    <strong class="userinput"><code>openssl-devel.x86_64
                vim-enhanced.x86_64</code></strong>
                  </p>
                </td></tr><tr><td>Ubuntu</td><td>
                  <p><a id="Installing_id269456"></a>
                    <strong class="userinput"><code>sudo apt-get
                install build-essential subversion \</code></strong>
                  </p>
                  <p><a id="Installing_id269459"></a>
                    <strong class="userinput"><code>libncurses5-dev libssl-dev
                libxml2-dev vim-nox</code></strong>
                  </p>
                </td></tr></tbody></table></div></li><li class="listitem"><p><a id="Installing_id269469"></a><a id="Installing_id269471"></a>Create your directory structure:</p><a id="Installing_id269474"></a><pre class="screen">$ <strong class="userinput"><code>mkdir -p ~/src/asterisk-complete/asterisk</code></strong>
$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk</code></strong></pre></li><li class="listitem"><p><a id="Installing_id269491"></a><a id="Installing_id269493"></a>Get the latest source code via
        Subversion:</p><a id="Installing_id269497"></a><pre class="screen">$ <strong class="userinput"><code>svn co http://svn.asterisk.org/svn/asterisk/branches/1.8</code></strong></pre><p><a id="Installing_id36054295"></a>Or alternatively, you could check out
        a specific tag:</p><p><a id="Installing_id36054299"></a>
          <a id="Installing_id36054300"></a></p><pre class="screen">$ <strong class="userinput"><code>svn co http://svn.asterisk.org/svn/asterisk/tags/1.8.1</code></strong></pre><p>
        </p></li><li class="listitem"><p><a id="Installing_id269510"></a><a id="Installing_id269513"></a>Build and install the software:</p><p><a id="Installing_id269516"></a>
          <a id="Installing_id269517"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8/</code></strong>
$ <strong class="userinput"><code>./configure</code></strong>
$ <strong class="userinput"><code>make</code></strong>
$ <strong class="userinput"><code>sudo make install</code></strong>
$ <strong class="userinput"><code>sudo make config</code></strong></pre><p>
        </p></li><li class="listitem"><p><a id="Installing_id269540"></a><a id="Installing_id269542"></a>Install additional sound prompts from
        <span class="emphasis"><em>menuselect</em></span>:</p><p><a id="Installing_id269546"></a>
          <a id="Installing_id269547"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8/</code></strong>
$ <strong class="userinput"><code>make menuselect</code></strong>
$ <strong class="userinput"><code>sudo make install</code></strong></pre><p>
        </p></li><li class="listitem"><p><a id="Installing_id36054367"></a><a id="Installing_id36054369"></a>Modify the file permissions of the
        directories Asterisk was installed to:</p><a id="Installing_id36054373"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /usr/lib/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/lib/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/spool/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/log/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/run/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown asteriskpbx:asteriskpbx /usr/sbin/asterisk</code></strong></pre></li><li class="listitem"><p><a id="Installing_id269560"></a><a id="Installing_id269562"></a>On CentOS, disable SELinux:</p><a id="Installing_id269565"></a><pre class="screen">$ <strong class="userinput"><code>sudo vim /etc/selinux/config</code></strong></pre><p><a id="Installing_id269571"></a>Change the value of
        <code class="varname">SELINUX</code> from <code class="literal">enforcing</code> to
        <code class="literal">disabled</code>, then <span class="command"><strong>reboot</strong></span>.</p></li><li class="listitem"><p><a id="Installing_id290992"></a><a id="Installing_id290994"></a>Create the
        <code class="filename">/etc/asterisk/</code> directory and copy the
        <code class="filename">indications.conf</code> sample file into it:</p><p><a id="Installing_id291004"></a>
          <a id="Installing_id291005"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo mkdir -p /etc/asterisk</code></strong>
$ <strong class="userinput"><code>sudo chown asteriskpbx:asteriskpbx /etc/asterisk</code></strong>
$ <strong class="userinput"><code>cd /etc/asterisk/</code></strong>
$ <strong class="userinput"><code>cp ~/src/asterisk-complete/asterisk/1.8/configs/indications.conf.sample \
./indications.conf</code></strong></pre><p>
        </p></li><li class="listitem"><p><a id="Installing_id421768"></a><a id="Installing_id421770"></a>Copy the sample
        <code class="filename">asterisk.conf</code> file into
        <code class="filename">/etc/asterisk</code> and change
        <code class="literal">runuser</code> and <code class="literal">rungroup</code> to have
        values of <em class="replaceable"><code>asteriskpbx</code></em>:</p><p><a id="Installing_id421789"></a>
          <a id="Installing_id421790"></a></p><pre class="screen">$ <strong class="userinput"><code>cp ~/src/asterisk-complete/asterisk/1.8/configs/asterisk.conf.sample \
/etc/asterisk/asterisk.conf</code></strong></pre><p>
          <a id="Installing_id421795"></a></p><pre class="screen">$ <strong class="userinput"><code>vim /etc/asterisk/asterisk.conf</code></strong></pre><p>
        </p><p><a id="Installing_id344492"></a>See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806" title="indications.conf and asterisk.conf">the section called “indications.conf and asterisk.conf”</a> for more information.</p></li><li class="listitem"><p><a id="Installing_id291019"></a><a id="Installing_id291021"></a>Create the
        <code class="filename">modules.conf</code> file. Enable loading of modules
        automatically, and disable extra modules:</p><a id="Installing_id291028"></a><pre class="screen">$ <strong class="userinput"><code>cat &gt;&gt; /etc/asterisk/modules.conf

; The modules.conf file, used to define which modules Asterisk should load (or 
; not load).
;
[modules]
autoload=yes

; Resource modules currently not needed
noload =&gt; res_speech.so
noload =&gt; res_phoneprov.so
noload =&gt; res_ael_share.so
noload =&gt; res_clialiases.so
noload =&gt; res_adsi.so

; PBX modules currently not needed
noload =&gt; pbx_ael.so
noload =&gt; pbx_dundi.so

; Channel modules currently not needed
noload =&gt; chan_oss.so
noload =&gt; chan_mgcp.so
noload =&gt; chan_skinny.so
noload =&gt; chan_phone.so
noload =&gt; chan_agent.so
noload =&gt; chan_unistim.so
noload =&gt; chan_alsa.so

; Application modules currently not needed
noload =&gt; app_nbscat.so
noload =&gt; app_amd.so
noload =&gt; app_minivm.so
noload =&gt; app_zapateller.so
noload =&gt; app_ices.so
noload =&gt; app_sendtext.so
noload =&gt; app_speech_utils.so
noload =&gt; app_mp3.so
noload =&gt; app_flash.so
noload =&gt; app_getcpeid.so
noload =&gt; app_setcallerid.so
noload =&gt; app_adsiprog.so
noload =&gt; app_forkcdr.so
noload =&gt; app_sms.so
noload =&gt; app_morsecode.so
noload =&gt; app_followme.so
noload =&gt; app_url.so
noload =&gt; app_alarmreceiver.so
noload =&gt; app_disa.so
noload =&gt; app_dahdiras.so
noload =&gt; app_senddtmf.so
noload =&gt; app_sayunixtime.so
noload =&gt; app_test.so
noload =&gt; app_externalivr.so
noload =&gt; app_image.so
noload =&gt; app_dictate.so
noload =&gt; app_festival.so</code></strong>

<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre></li><li class="listitem"><p><a id="Installing_id421850"></a><a id="Installing_id421852"></a>Configure
        <code class="filename">musiconhold.conf</code>:</p><a id="Installing_id421858"></a><pre class="screen">$ <strong class="userinput"><code>cat &gt;&gt; musiconhold.conf</code></strong>

<strong class="userinput"><code>; musiconhold.conf
[default]
mode=files
directory=moh</code></strong>

<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre></li><li class="listitem"><p><a id="Installing_id291061"></a><a id="Installing_id291063"></a>Save your changes and your module
        configuration is done. Your system is ready to configure your dialplan
        and channels.<a id="I_indexterm3_d1e5450" class="indexterm"></a></p></li></ol></div></div><div class="sect1" title="Distribution Installation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id291070"></a>Distribution Installation</h2></div></div></div><p><a id="Installing_id291076"></a><a id="index-850H001WV5N" class="indexterm"></a><a id="index-484L418AC7S" class="indexterm"></a>Because Asterisk relies so heavily on having priority access
    to the CPU, it is essential that you install Asterisk onto a server
    without any graphical interface, such as the X Windowing system (Gnome,
    KDE, etc.). Both CentOS and Ubuntu ship a GUI-free distribution designed
    for server usage. We will cover instructions for both
    distributions.</p><div class="sect2" title="CentOS Server"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id291082"></a>CentOS Server</h3></div></div></div><p><a id="Installing_id291087"></a><a id="index-146F407GP1H" class="indexterm"></a><a id="index-374E025JJ8T" class="indexterm"></a><a id="index-025P517TI8P" class="indexterm"></a>CentOS means “Community Enterprise Operating System,” and
      it is based on Red Hat Enterprise Linux (RHEL). For more information
      about what CentOS is and its history, see <a class="ulink" href="http://www.centos.org/" target="_top">http://www.centos.org</a>.</p><p><a id="Installing_id291097"></a>You will need to download an ISO from the
      CentOS website, located at <a class="ulink" href="http://mirror.centos.org/centos/5/isos/" target="_top">http://mirror.centos.org/centos/5/isos/</a>. Select either
      the <code class="filename">i386</code> or <code class="filename">x86_64</code> directory
      for 32-bit or 64-bit hardware, respectively. You will then be presented
      with a list of mirrors that appear to be close to you physically. Choose
      one of the mirrors, and you will be presented with a list of files to
      download. Likely you will want the first available selection, which is
      the first ISO file of a set. You will only need the first ISO file of
      the set as we’ll be installing additional software with
      <span class="command"><strong>yum</strong></span>.</p><p><a id="Installing_id291120"></a>Once you’ve downloaded the ISO file, burn
      it to a CD or DVD and start the installation process. If you’re
      installing into a virtual machine (which we don’t recommend for
      production use,<sup>[<a id="id517693" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id517693" class="footnote">21</a>]</sup> but can be a great way to test out Asterisk), you should
      be able to mount the ISO file directly and install from there.</p><div class="sect3" title="Base system installation"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id291135"></a>Base system installation</h4></div></div></div><p><a id="Installing_id291140"></a><a id="I_indexterm3_d1e5510" class="indexterm"></a><a id="I_indexterm3_d1e5517" class="indexterm"></a>Upon booting from the CD, type <span class="emphasis"><em>linux
        text</em></span> and then press <span class="keycap"><strong>Enter</strong></span>.<sup>[<a id="id517753" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id517753" class="footnote">22</a>]</sup></p><p><a id="Installing_id291157"></a>At this point the text installation
        interface will start. You will be asked whether you want to test the
        media. These instructions assume you’ve already done so, and therefore
        can skip that step.</p><p><a id="Installing_id291165"></a>CentOS will then welcome you to the
        installation. Press <span class="keycap"><strong>Enter</strong></span> to continue.</p><p><a id="Installing_id291172"></a>Choose your language and make a
        keyboard selection.<sup>[<a id="id517790" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id517790" class="footnote">23</a>]</sup> If you’re in North America, you will probably just
        select the defaults.</p><p><a id="Installing_id291184"></a>If you’ve previously formatted your
        hard drive, you will be asked to initialize the drive, which will
        erase all data. Select <span class="keycap"><strong>Yes</strong></span>.</p><p><a id="Installing_id291192"></a>The installer will ask if you want to
        remove the existing partitioning scheme and create a new one. Select
        <span class="emphasis"><em>Remove all partitions on selected drives and create default
        layout</em></span>. If a more appropriate option exists, select that
        instead. In the drive window, verify that the correct disk drive is
        selected. (Pressing <span class="keycap"><strong>Tab</strong></span> will cycle through the
        selections on the screen.) Once the drive window is selected, you can
        scroll up and down (presuming you have multiple drives) and select
        which hard drive you wish to install to. Toggle the selections by
        pressing <span class="keycap"><strong>space bar</strong></span>. Verify that the correct drive is
        selected, press <span class="keycap"><strong>Tab</strong></span> until the <span class="keycap"><strong>OK</strong></span>
        button is highlighted, and press <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291215"></a>A message confirming that you want to
        remove all Linux partitions and create the new partition scheme will
        be presented. Select <span class="keycap"><strong>Yes</strong></span>.</p><p><a id="Installing_id291222"></a>You will be asked to review the
        partitioning layout. Feel free to modify the partition scheme if you
        prefer something different (see the following sidebar for some advice
        on this); however, the default answer <span class="keycap"><strong>No</strong></span> is fine for
        light production use where storage requirements will be low.<sup>[<a id="id517888" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id517888" class="footnote">24</a>]</sup></p><div class="sidebar" title="Separating the /var Mount Point to Its Own Partition"><a id="separating-var-sidebar"></a><div class="titlepage"><div><div><p class="title"><strong>Separating the /var Mount Point to Its Own Partition</strong></p></div></div></div><p><a id="Installing_id291357"></a><a id="I_indexterm3_d1e5591" class="indexterm"></a>On a system dedicated to Asterisk, the directory with
          the largest storage requirement is <code class="filename">/var</code>. This
          is where Asterisk will store recordings, voicemails, log files,
          prompts, and a myriad of constantly growing information. In normal
          operation, it is unlikely that Asterisk will fill the hard disk.
          However, if you have extensive logging turned on or are recording
          all calls, this could, in theory, occur. (This is likely to happen
          several months after you’ve completed the install and to take your
          entire staff by surprise.)</p><p><a id="Installing_id216298"></a>If the drive the operating system is
          mounted on fills up, there is the potential for a kernel panic. By
          separating <code class="filename">/var</code> from the rest of the hard
          drive, you significantly lower the risk of a system failure.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id216309"></a>Having a full volume is still a
            major problem; however, you will at least be able to log into the
            system to rectify the situation.</p></div><p><a id="Installing_id216315"></a>At the <span class="emphasis"><em>Review and modify
          the partitioning layout</em></span> screen, you can create a separate
          volume for <code class="filename">/var</code>. Selecting <span class="keycap"><strong>Yes</strong></span>
          will bring up the <span class="emphasis"><em>Partitioning</em></span> tool. To
          partition the drive accurately, you need to know what the hard drive
          size is; this may not jibe with what is stamped on the outside of
          the drive because you have to tell the tool how to chop up the
          drive. A limitation of the tool is that there is no option to say
          “use all available space”; that is, you can’t simply could use 500
          MB on the <code class="filename">/</code> partition and then say “use the
          rest for <code class="filename">/var</code>”. The workaround is to make a
          note of the size it has selected for
          <code class="literal"><code class="filename">/</code></code> currently, as that is the
          full space, subtract 500 MB from that, and make that the size for
          the <code class="literal"><code class="filename">/</code></code> partition. The
          subtracted amount will then be reserved for
          <code class="filename">/var</code>.</p></div><p><a id="Installing_id216357"></a>A message will appear asking if you’d
        like to configure the <code class="filename">eth0</code> network interface on
        your system. Select <span class="keycap"><strong>Yes</strong></span>. Be sure the
        <span class="emphasis"><em>Activate on boot</em></span> and <span class="emphasis"><em>Enable IPv4
        support</em></span> options are enabled, then select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id422209"></a>If your network provides automatic IP
        provisioning via DHCP, you can just select <span class="keycap"><strong>OK</strong></span>.
        Otherwise, select <span class="emphasis"><em>Manual address configuration</em></span>,
        enter the appropriate information, and then select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id422224"></a>Next, you’ll be asked to provide a
        hostname. You can either allow the DHCP server to provide one for you
        (if your network assigns hostnames automatically) or enter one
        manually, then select <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id291530"></a>You will be presented with a list of
        time zones. Highlight your local time zone and select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id291538"></a>At this point, you will be asked for a
        root password. Enter a secure password and type it again to confirm.
        After entering your secure password, select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id291546"></a>Next up will be the package selection.
        Several packages that you don’t need to install (and that require
        additional ISO files you probably haven’t downloaded) are selected by
        default. Deselect all options in the list using the <span class="keycap"><strong>space
        bar</strong></span>, then select the <span class="emphasis"><em>Customize software
        selection</em></span> option. Once you’ve done that, select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id422269"></a>You will then be presented with the
        <span class="emphasis"><em>Package Group Selection</em></span> screen. Scroll through
        the whole list, deselecting each item. If any packages are selected,
        you’ll be prompted for additional CDs that you have not downloaded.
        We’ll be installing additional packages with the
        <span class="command"><strong>yum</strong></span> application after the operating system is
        installed. Once you’ve deselected all packages, select
        <span class="keycap"><strong>OK</strong></span>.</p><p><a id="Installing_id291571"></a>A dependency check will then be
        performed and a confirmation that installation is ready to begin will
        be presented. Select <span class="keycap"><strong>OK</strong></span> to start the installation.
        The filesystem will then be formatted, the installation image
        transferred to the hard drive, and installation of the system packages
        performed. Upon installation, you will be asked to reboot. Remove any
        media in the drives and select the <span class="keycap"><strong>Reboot</strong></span>
        button.</p></div><div class="sect3" title="Base system update"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id291582"></a>Base system update</h4></div></div></div><p><a id="Installing_id291588"></a><a id="I_indexterm3_d1e5717" class="indexterm"></a><a id="I_indexterm3_d1e5724" class="indexterm"></a>Once you’ve rebooted your system, you need to run the
        <span class="command"><strong>yum update</strong></span> command to make sure you have the latest
        base packages. To do this, log in using the username
        <span class="emphasis"><em>root</em></span> and the password you created during
        installation. Once logged in, run the following:</p><a id="Installing_id291600"></a><pre class="screen"># <strong class="userinput"><code>yum update</code></strong></pre><a id="Installing_id291606"></a><pre class="screen">Is this ok [y/N]: <strong class="userinput"><code>y</code></strong></pre><p><a id="Installing_id291612"></a>When prompted to install the latest
        packages, press <span class="keycap"><strong>y</strong></span> and wait for the packages to
        update. If you’re asked to accept a GPG key, press <span class="keycap"><strong>y</strong></span>.
        When complete, reboot the system as it is likely the kernel will have
        been updated<sup>[<a id="id518326" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id518326" class="footnote">25</a>]</sup>:</p><a id="Installing_id291631"></a><pre class="screen"># <strong class="userinput"><code>reboot</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id291638"></a>If you’re running CentOS Server
          64-bit, you’ll need to remove all the 32-bit libraries manually.
          Once you’ve rebooted, or just prior to reboot, run the following
          command:</p><a id="Installing_id291643"></a><pre class="screen"># <strong class="userinput"><code>yum remove *.i386 -y</code></strong></pre><p><a id="Installing_id291649"></a>This will remove all the 32-bit
          libraries on your 64-bit system, which can otherwise cause conflicts
          and issues when compiling Asterisk and other software.</p></div><p><a id="Installing_id291654"></a>Congratulations! You’ve successfully
        installed and updated the base CentOS system.</p></div><div class="sect3" title="Enabling NTP for accurate system time"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id291661"></a>Enabling NTP for accurate system time</h4></div></div></div><p><a id="Installing_id291666"></a><a id="I_indexterm3_d1e5775" class="indexterm"></a><a id="I_indexterm3_d1e5782" class="indexterm"></a><a id="I_indexterm3_d1e5787" class="indexterm"></a><a id="I_indexterm3_d1e5792" class="indexterm"></a><a id="I_indexterm3_d1e5797" class="indexterm"></a>Keeping accurate time is essential on your Asterisk
        system, both for maintaining accurate call detail records and for
        synchronization with your other programs. You don’t want the times of
        your voicemail notifications to be off by 10 or 20 minutes, as this
        can lead to confusion and panic from those who might think their
        voicemail notifications are taking took too long to be delivered. The
        <span class="command"><strong>ntpd</strong></span> command <a id="I_indexterm3_d1e5804" class="indexterm"></a><a id="I_indexterm3_d1e5807" class="indexterm"></a>can be used to ensure that the time on your Asterisk
        server remains in sync with the rest of the world:</p><p><a id="Installing_id291678"></a>
          <a id="Installing_id291679"></a></p><pre class="screen"># <strong class="userinput"><code>yum install ntp</code></strong>
...
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong>
...
# <strong class="userinput"><code>ntpdate pool.ntp.org</code></strong>
# <strong class="userinput"><code>chkconfig ntpd on</code></strong>
# <strong class="userinput"><code>service ntpd start</code></strong></pre><p>
        </p><p><a id="Installing_id291694"></a>The defaults shipped with CentOS are
        sufficient to synchronize the time and keep the machine’s time in sync
        with the rest of the world.</p></div><div class="sect3" title="Adding a system user"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id291699"></a>Adding a system user</h4></div></div></div><p><a id="Installing_id291705"></a><a id="I_indexterm3_d1e5836" class="indexterm"></a><a id="I_indexterm3_d1e5843" class="indexterm"></a><a id="I_indexterm3_d1e5846" class="indexterm"></a><a id="I_indexterm3_d1e5851" class="indexterm"></a>The Ubuntu server install process asks you to add a
        system user other than root, but CentOS does not. In order to be
        consistent in the book and to be more secure, we’re going to add
        another system user and provide it <span class="emphasis"><em>sudo</em></span>
        access.<sup>[<a id="id518633" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id518633" class="footnote">26</a>]</sup> To add the new user, execute the
        <span class="command"><strong>adduser</strong></span> command:</p><p><a id="Installing_id291723"></a><a id="Installing_id291724"></a></p><pre class="screen"># <strong class="userinput"><code>adduser asteriskpbx</code></strong>
# <strong class="userinput"><code>passwd asteriskpbx</code></strong>
Changing password for user asteriskpbx.
New UNIX password:
Retype new UNIX password:</pre><p>Now we need to provide the
        <span class="emphasis"><em>asteriskpbx</em></span> user <span class="command"><strong>sudo</strong></span> access.
        We do this by modifying the <code class="filename">sudoers</code> file with the
        <span class="command"><strong>visudo</strong></span> command. You’ll need to install
        <span class="command"><strong>visudo</strong></span> the first time you use it:</p><p><a id="Installing_id291752"></a><a id="Installing_id291753"></a></p><pre class="screen"># <strong class="userinput"><code>yum install sudo</code></strong></pre><p>With
        the <span class="command"><strong>sudo</strong></span>-related applications and file installed,
        we can modify the <code class="filename">sudoers</code> file. Execute the
        <span class="command"><strong>visudo</strong></span> command and look for the lines shown
        below:</p><p><a id="Installing_id291769"></a><a id="Installing_id291770"></a></p><pre class="screen"># <strong class="userinput"><code>visudo</code></strong>

## Allows people in group wheel to run all commands
<span class="emphasis"><em>%wheel  ALL=(ALL)       ALL</em></span></pre><p>With the
        <code class="literal">%wheel</code> line uncommented as shown in our example,
        save the file by pressing <span class="keycap"><strong>Esc</strong></span>, then typing
        <code class="literal">:wq</code> and pressing <span class="keycap"><strong>Enter</strong></span>. Now open
        the <code class="filename">/etc/group</code> file in your favorite editor
        (<span class="emphasis"><em>nano</em></span> is easy to use) and find the line that
        starts with the word <code class="literal">wheel</code>. Modify it like
        so:</p><p><a id="Installing_id291801"></a><a id="Installing_id291802"></a></p><pre class="programlisting">wheel:x:10:root,asteriskpbx</pre><p>Save
        the file, log out from <span class="emphasis"><em>root</em></span> by typing
        <code class="literal">exit</code>, and log in as the
        <span class="emphasis"><em>asteriskpbx</em></span> user you created. Test your
        <span class="command"><strong>sudo</strong></span> access by running the following
        command:</p><p><a id="Installing_id291808"></a><a id="Installing_id291809"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo ls /root/</code></strong>
[sudo] password for asteriskpbx:</pre><p>After typing your password, you
        should get the output of the <code class="filename">/root/</code> directory. If
        you don’t, go back and verify the steps to make sure you didn’t skip
        or mistype anything. The rest of the instructions in this chapter will
        assume that you’re the <span class="emphasis"><em>asteriskpbx</em></span> user and that
        you have <span class="command"><strong>sudo</strong></span> access.</p><p><a id="Installing_id422617"></a>One last thing needs to done, which
        will allow you to enter commands without having to enter the full
        path. By default only <span class="emphasis"><em>root</em></span> has
        <code class="filename">/sbin/</code> and <code class="filename">/usr/sbin/</code> in the
        default system <code class="literal">PATH</code>, but we’ll add it to our
        <span class="emphasis"><em>asteriskpbx</em></span> user as well since we’ll be running
        many applications located in those directories.</p><p><a id="Installing_id422638"></a>Start by opening the hidden file
        <code class="filename">.bash_profile</code> located within the
        <span class="emphasis"><em>asteriskpbx</em></span> home directory with an editor. We’re
        then going to append <code class="literal">:/usr/sbin:/sbin</code> to the end of
        the line starting with <code class="literal">PATH</code>:</p><p><a id="Installing_id422655"></a>
          <a id="Installing_id422656"></a></p><pre class="screen">$ <strong class="userinput"><code>vim ~/.bash_profile</code></strong>
PATH=$PATH:$HOME/bin<em class="replaceable"><code>:/usr/sbin:/sbin</code></em></pre><p>
        </p><p><a id="Installing_id422664"></a>As previously, save the file by
        pressing <span class="keycap"><strong>Esc</strong></span> and then typing <code class="literal">:wq</code>
        and pressing <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id422677"></a>With the operating system installed,
        you’re ready to install the dependencies required for Asterisk. The
        next section deals with Ubuntu, so you can skip ahead to the section
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies" title="Software Dependencies">the section called “Software Dependencies”</a>, which provides an in-depth
        review of the installation process. Alternatively, if you’ve already
        reviewed the information in that section, you may want to refer back
        to the <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883" title="Installation Cheat Sheet">the section called “Installation Cheat Sheet”</a> for a high-level review
        of how to install Asterisk.<a id="I_indexterm3_d1e6030" class="indexterm"></a><a id="I_indexterm3_d1e6031" class="indexterm"></a><a id="I_indexterm3_d1e6032" class="indexterm"></a></p></div></div><div class="sect2" title="Ubuntu Server"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id291827"></a>Ubuntu Server</h3></div></div></div><p><a id="Installing_id291833"></a><a id="index-187K430MB0B" class="indexterm"></a><a id="index-631N486KP4N" class="indexterm"></a><a id="index-645R632AO6Q" class="indexterm"></a>Ubuntu Server is a popular Linux distribution loosely
      based on Debian. There is also a popular desktop version of the
      software. The Ubuntu Server package contains no GUI and is ideal for
      Asterisk installations.</p><p><a id="Installing_id291838"></a>To get the latest version of Ubuntu
      Server,<sup>[<a id="id519147" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id519147" class="footnote">27</a>]</sup> visit <a class="ulink" href="http://www.ubuntu.com/" target="_top">http://www.ubuntu.com</a> and
      select the <span class="emphasis"><em>Server</em></span> tab at the top of the page. You
      will be provided with a page that contains information about Ubuntu
      Server Edition. Clicking the orange <span class="emphasis"><em>Download</em></span> button
      in the upper-right corner will take you to a page where you can select
      either the 32-bit or 64-bit version of Ubuntu Server. After selecting
      one of the options, you can press the <span class="emphasis"><em>Start
      download</em></span> button.</p><p><a id="Installing_id291862"></a>Once you’ve downloaded the ISO file, burn
      it to a CD and start the installation process. If you’re installing into
      a virtual machine (which we don’t recommend for production use, but can
      be a great way to test out Asterisk), you should be able to mount the
      ISO file directly and install from there.</p><div class="sect3" title="Base system installation"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id291868"></a>Base system installation</h4></div></div></div><p><a id="Installing_id291873"></a><a id="I_indexterm3_d1e6076" class="indexterm"></a><a id="I_indexterm3_d1e6083" class="indexterm"></a>Upon booting from the CD, you will be presented with a
        screen where you can select your language of choice. By default
        English is the selected language, and after a timeout period, it will
        be automatically selected. After selecting your language, press
        <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291878"></a>The next screen will give you several
        options, the first of which is <span class="emphasis"><em>Install Ubuntu
        Server</em></span>. Select it by pressing
        <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291889"></a>You will then be asked which language
        to use for the installation (yes, this is slightly redundant). Select
        your language of choice (the default is English), and press
        <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291897"></a>You will be presented with a list of
        countries. Once you’ve found your country and highlighted it, press
        <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291904"></a>You will then be asked if you would
        like to use the keyboard layout detector. If you know which keyboard
        type you have, you can select <span class="keycap"><strong>No</strong></span> and then pick it
        from a list of formats.</p><p><a id="Installing_id291920"></a>If you are utilizing the keyboard
        layout detector, you will be prompted to press a series of keys. If
        you use the keyboard detector and it does not detect your keyboard
        correctly (typical when installing into a virtual machine via a remote
        console), you can go back and select from a list manually.</p><p><a id="Installing_id291927"></a>Once you’ve picked your keyboard, the
        installation will continue by attempting to set up your network
        automatically. If all goes well, you will be prompted to enter a
        hostname for your system. You can pick anything you want here, unless
        your network requires your system to a have a specific hostname. Input
        it now and then press <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id291937"></a>The installer will attempt to contact a
        Network Time Protocol (NTP) server to synchronize your clock. Ubuntu
        will then try to autodetect your time zone and present you with its
        choice. If correct, select <span class="keycap"><strong>Yes</strong></span>, otherwise, select
        <span class="keycap"><strong>No</strong></span> and you’ll be presented with a list of time zones
        to select from. Select your time zone, or select from the worldwide
        list if your time zone is not shown. Once you’ve selected your time
        zone, press <span class="keycap"><strong>Enter</strong></span> to continue.</p><p><a id="Installing_id291954"></a>The installer will then ask you some
        questions about partitioning your system. Typically the default is
        fine, which is to use the guided system, utilizing the entire disk,
        and to set up the Logical Volume Manager (LVM). Press
        <span class="keycap"><strong>Enter</strong></span> once you’ve made your selection. Then you’ll be
        asked which partition to install to, which likely is the only one on
        your system. Press <span class="keycap"><strong>Enter</strong></span> to continue, at which point
        you’ll be asked to confirm the changes to the partition table. Select
        <span class="keycap"><strong>Yes</strong></span> and press <span class="keycap"><strong>Enter</strong></span> to
        continue.</p><p><a id="Installing_id422873"></a>You will now be asked how much space to
        use (the default value will be to use the entire disk). Press
        <span class="keycap"><strong>Enter</strong></span> once you’ve entered and confirmed the amount of
        space you want to use. The installer will then request one last
        confirmation before making the changes to the disk. Select
        <span class="keycap"><strong>Yes</strong></span> to write the changes to disk. The installer will
        now format the hard disk, write the partitioning scheme to disk, copy
        the files, and perform the file installation.</p><p><a id="Installing_id291986"></a>When the file installation is complete,
        you’ll be asked to enter the <span class="emphasis"><em>Full name of the new
        user</em></span>, from which a username will be generated. The system
        will suggest a username, but you are free to change the username to
        whatever you like.</p><p><a id="Installing_id291991"></a>After
        entering your username, you’ll be asked to supply a password, and then
        asked to confirm the password you’ve entered. Ubuntu does a good job
        of providing a secure system by not providing direct access to root,
        but rather using the <span class="command"><strong>sudo</strong></span> application, which allows
        you to run commands as root without being the root user. Enter a
        username,<sup>[<a id="id519457" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id519457" class="footnote">28</a>]</sup> such as <span class="emphasis"><em>asteriskpbx</em></span>, and a secure
        password to continue. You’ll use these to log into the system once the
        installer ends. The installer will then ask you if you want to encrypt
        your home directory. This is not necessary and will add CPU
        overhead.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id345747"></a>The rest of the installation
          instructions will assume that <span class="emphasis"><em>asteriskpbx</em></span> was
          chosen as the username.</p></div><p><a id="Installing_id292016"></a>If your system is behind a web proxy,
        enter the proxy information now. If you’re not behind a proxy, or
        don’t know if you are, simply press <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id292024"></a>You will then be asked if you want to
        install updates automatically. The default is to perform no automatic
        updates, which is what we recommend. Should a system reboot occur, an
        update to the kernel will render Asterisk nonstartable until you
        recompile it<sup>[<a id="id519514" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id519514" class="footnote">29</a>]</sup> (which won’t make you popular). It is better practice to
        identify updates on a regular basis and perform them manually in a
        controlled manner. Normally, you would want to advise your users of
        the expected downtime and schedule the downtime to happen after
        business hours (or while a redundant system is running). Select
        <span class="emphasis"><em>No automatic updates</em></span> and press
        <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id292038"></a>Since we’ll be installing our
        dependencies with <span class="command"><strong>apt-get</strong></span>, we only need to select
        one package during the install: OpenSSH server. SSH is essential if
        you wish to perform remote work on the system. However, if your local
        policy states that your server needs to be managed directly, you may
        not want to install the OpenSSH server.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Installing_id292050"></a>Pressing the <span class="keycap"><strong>Enter</strong></span>
          key will accept the current selections and move on with the install.
          You need to use <span class="keycap"><strong>space bar</strong></span> to toggle your
          selections.</p></div><p><a id="Installing_id292062"></a>After you’ve selected OpenSSH server,
        press <span class="keycap"><strong>Enter</strong></span>.</p><p><a id="Installing_id292068"></a>If this is the only operating system on
        the machine (which it likely is), Ubuntu will give you the option to
        install the GRUB bootloader on your system. It provides this prompt in
        order to give you the option of skipping the GRUB installation, as it
        will modify the master boot record (MBR) on your system. If there is
        another operating system it has failed to detect that has information
        loaded into the MBR, it’s nice to be able to skip modifying it. If
        this is the only operating system installed on your server, select
        <span class="keycap"><strong>Yes</strong></span>.</p><p><a id="Installing_id292080"></a>When the system has finished the
        install, you’ll be asked to remove any media in the drives and to
        reboot the system by selecting <span class="command"><strong>Continue</strong></span>, at which
        point the installation will be complete and the system will
        reboot.</p></div><div class="sect3" title="Base system update"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id292090"></a>Base system update</h4></div></div></div><p><a id="Installing_id292095"></a><a id="I_indexterm3_d1e6233" class="indexterm"></a><a id="I_indexterm3_d1e6240" class="indexterm"></a>Now that we’ve completed installing Ubuntu Server, we
        need to perform a system update with <span class="command"><strong>apt-get</strong></span> to
        make sure we have the latest packages installed. You’ll be presented
        with a login prompt where you’ll log in with the username and password
        you created in the installer (e.g., <span class="emphasis"><em>asteriskpbx</em></span>).
        Once logged in, run the following command:</p><a id="Installing_id292118"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get update</code></strong>
[sudo] password for asteriskpbx:
...
Reading package lists... Done

<code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get upgrade</code></strong>
Reading state information... Done
...
Do you want to continue [Y/n]? <strong class="userinput"><code>y</code></strong></pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id292109"></a>The password that
          <span class="command"><strong>sudo</strong></span> wants is the password you just logged in
          with.</p></div><p><a id="Installing_id292131"></a>Press <span class="keycap"><strong>Enter</strong></span> when
        prompted to continue, at which point the latest package updates will
        be installed. When complete, reboot the system for the changes to take
        effect as the kernel has probably been updated.</p><a id="Installing_id292139"></a><pre class="screen">$ <strong class="userinput"><code>sudo reboot</code></strong></pre><p><a id="Installing_id292144"></a>Congratulations! You’ve successfully
        installed and updated the base Ubuntu Server system.</p></div><div class="sect3" title="Enable NTP for accurate system time"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id292150"></a>Enable NTP for accurate system time</h4></div></div></div><p><a id="Installing_id292156"></a><a id="I_indexterm3_d1e6288" class="indexterm"></a><a id="I_indexterm3_d1e6295" class="indexterm"></a><a id="I_indexterm3_d1e6300" class="indexterm"></a><a id="I_indexterm3_d1e6305" class="indexterm"></a><a id="I_indexterm3_d1e6308" class="indexterm"></a>Keeping accurate time is essential on your Asterisk
        system, both for maintaining accurate call detail records as well as
        for synchronization with your other programs. You don’t want the times
        of your voicemail notifications to be off by 10 or 20 minutes, as this
        can lead to confusion and panic from those who might think their
        voicemail notification took too long to be delivered:</p><p><a id="Installing_id292167"></a>
          <a id="Installing_id292168"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo apt-get install ntp</code></strong></pre><p>
        </p><p><a id="Installing_id292173"></a>The default on Ubuntu is to run a time
        sync server without ever changing the time on your own machine. This
        won’t work for our needs, so we’ll need to change the <span class="keep-together">configuration</span> file slightly. Because of
        this, we need to guide you through using a command line editor. The
        <span class="command"><strong>nano</strong></span> editor is already installed on your Ubuntu
        machine and is remarkably easy to use<sup>[<a id="id519913" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id519913" class="footnote">30</a>]</sup>:</p><p><a id="Installing_id292202"></a>
          <a id="Installing_id292204"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo nano <code class="filename">/etc/ntp.conf</code></code></strong></pre><p>
        </p><p><a id="Installing_id292211"></a>Your terminal will switch to
        full-screen output.</p><p><a id="Installing_id292214"></a>Use your arrow keys to move down to the
        section that looks like<a id="Installing_id292235"></a></p><pre class="screen"># By default, exchange time with everybody, but don't allow configuration.
restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery</pre><p><a id="Installing_id292240"></a>Add two new lines after this section,
        to allow <code class="filename">ntpd</code> to synchronize your time with the
        outside world, such that the above section now looks like</p><p><a id="Installing_id292244"></a><a id="Installing_id292246"></a></p><pre class="screen"># By default, exchange time with everybody, but don't allow configuration.
restrict -4 default kod notrap nomodify nopeer noquery
restrict -6 default kod notrap nomodify nopeer noquery

<strong class="userinput"><code>restrict -4 127.0.0.1
restrict -6 ::1</code></strong></pre><p>That’s everything we need to change, so
        exit the editor by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>X</strong></span>. When prompted whether to save the modifications, press
        <span class="keycap"><strong>Y</strong></span>; <span class="emphasis"><em>nano</em></span> will additionally ask
        you for the filename. Just hit <span class="keycap"><strong>Enter</strong></span> to confirm the
        default <code class="filename">/etc/ntp.conf</code>.</p><p><a id="Installing_id423241"></a>Now restart the NTP daemon:</p><p><a id="Installing_id423244"></a><a id="Installing_id423245"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo /etc/init.d/ntp restart</code></strong></pre><p>With
        the operating system installed, you’re ready to install the
        dependencies required for Asterisk. The next section provides an
        in-depth review of the installation process. If you’ve already
        reviewed the information in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies" title="Software Dependencies">the section called “Software Dependencies”</a>,
        you may want to refer back to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883" title="Installation Cheat Sheet">the section called “Installation Cheat Sheet”</a>
        for a high-level review of how to install Asterisk.<a id="I_indexterm3_d1e6394" class="indexterm"></a><a id="I_indexterm3_d1e6395" class="indexterm"></a><a id="I_indexterm3_d1e6396" class="indexterm"></a><a id="I_indexterm3_d1e6397" class="indexterm"></a><a id="I_indexterm3_d1e6398" class="indexterm"></a></p></div></div></div><div class="sect1" title="Software Dependencies"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="software-dependencies"></a>Software Dependencies</h2></div></div></div><p><a id="Installing_id292286"></a><a id="I_indexterm3_d1e6403" class="indexterm"></a><a id="I_indexterm3_d1e6408" class="indexterm"></a><a id="I_indexterm3_d1e6411" class="indexterm"></a>The first thing you need to do once you’ve completed the
    installation of your operating system is to install the software
    dependencies required by Asterisk. The commands listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292315" title="Table 3.1. Software dependencies for Asterisk on Ubuntu Server and CentOS Server">Table&nbsp;3.1, “Software dependencies for Asterisk on Ubuntu Server and CentOS
      Server”</a> have been split into two columns, for
    Ubuntu Server and CentOS Server. These packages will allow you to build a
    basic Asterisk system, along with DAHDI and LibPRI. Not every module will
    be available at compile time with these dependencies; only the most
    commonly used modules will be built. If additional <span class="keep-together">dependencies</span> are required for other modules
    used later in the book, instructions will be provided as necessary.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Installing_id292297"></a>Please be aware that the dependency
      information <a id="I_indexterm3_d1e6425" class="indexterm"></a><a id="I_indexterm3_d1e6430" class="indexterm"></a><a id="I_indexterm3_d1e6433" class="indexterm"></a>on CentOS 64-bit does not take into account that 32-bit
      libraries should not be installed. If such libraries are installed, you
      will end up with additional packages that use disk space and can cause
      conflicts if the system attempts to compile against a 32-bit library
      instead of its 64-bit counterpart. In order to resolve this problem, add
      <span class="emphasis"><em>.x86_64</em></span> to the end of each package name when
      installing it. So, for example, instead of executing <span class="command"><strong>yum
      install ncurses-devel</strong></span>, you will execute <span class="command"><strong>yum install
      ncurses-devel.x86_64</strong></span>. This is not necessary on a 32-bit
      platform.</p></div><div class="table"><a id="Installing_id292315"></a><p class="title"><strong>Table&nbsp;3.1.&nbsp;Software dependencies for Asterisk on Ubuntu Server and CentOS
      Server</strong></p><div class="table-contents"><table summary="Software dependencies for Asterisk on Ubuntu Server and CentOS
      Server" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS</th></tr></thead><tbody><tr><td>
              <p><a id="Installing_id292359"></a>
                <code class="literal">sudo apt-get
            install build-essential \</code>
              </p>
              <p><a id="Installing_id292362"></a>
                <code class="literal">subversion libncurses5-dev
            libssl-dev \</code>
              </p>
              <p><a id="Installing_id292366"></a>
                <code class="literal">libxml2-dev
            vim-nox</code>
              </p>
            </td><td>
              <p><a id="Installing_id292348"></a>
                <code class="literal">sudo yum install
            gcc gcc-c++ make wget \</code>
              </p>
              <p><a id="Installing_id292351"></a>
                <code class="literal">subversion libxml2-devel
            ncurses-devel \</code>
              </p>
              <p><a id="Installing_id292354"></a>
                <code class="literal">openssl-devel
            vim-enhanced</code>
              </p>
            </td></tr></tbody></table></div></div><br class="table-break"><p><a id="Installing_id292375"></a>These packages will get you most of what
    you’ll need to get started with installing Asterisk, DAHDI, and LibPRI.
    Note that you will also require the software dependencies for each package
    that we indicate needs to be installed. These will be resolved
    automatically for you when you use either <span class="command"><strong>yum</strong></span> or
    <span class="command"><strong>apt-get</strong></span>.</p><p><a id="Installing_id292387"></a>We have also included the OpenSSL
    development libraries, which are not strictly necessary to compile
    Asterisk, but are good to have: they enable key support and other
    encryption functionality.</p><p><a id="Installing_id292393"></a>We have installed <span class="command"><strong>vim</strong></span> as
    our editor, but you can choose anything you want, such as
    <span class="command"><strong>nano</strong></span>, <span class="command"><strong>joe</strong></span>, or
    <span class="command"><strong>emacs</strong></span>.</p><p><a id="Installing_id346289"></a>Asterisk contains a script that will
    install the dependencies for all features in Asterisk. At this time it is
    complete for Ubuntu but does not list all required packages for CentOS.
    Once you have downloaded Asterisk using the instructions in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446" title="Downloading What You Need">the section called “Downloading What You Need”</a>, use the following commands if you would
    like to run it:</p><a id="Installing_id346302"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo ./contrib/scripts/install_prereq install</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo ./contrib/scripts/install_prereq install-unpackaged</code></strong></pre><div class="sidebar" title="Third-Party Repositories"><a id="third-party-repos"></a><div class="titlepage"><div><div><p class="title"><strong>Third-Party Repositories</strong></p></div></div></div><p><a id="Installing_id292420"></a>For certain software dependencies, a
      third-party repository <a id="I_indexterm3_d1e6532" class="indexterm"></a><a id="I_indexterm3_d1e6535" class="indexterm"></a>may be necessary. This appears to be most often the case
      when using CentOS. A couple of repositories that seem to be able to
      provide all the extra dependencies required are RPMforge (<a class="ulink" href="http://dag.wieers.com/rpm/" target="_top">http://dag.wieers.com/rpm/</a>) and EPEL (Extra Packages for
      Enterprise Linux, <a class="ulink" href="http://fedoraproject.org/wiki/EPEL" target="_top">http://fedoraproject.org/wiki/EPEL</a>).</p><p><a id="Installing_id292437"></a>We may occasionally refer to these
      third-party repositories when they are required to obtain a dependency
      for a module we are trying to build and use.</p></div></div><div class="sect1" title="Downloading What You Need"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id292446"></a>Downloading What You Need</h2></div></div></div><p><a id="Installing_id292451"></a><a id="I_indexterm3_d1e6549" class="indexterm"></a><a id="I_indexterm3_d1e6554" class="indexterm"></a>There are several methods of getting Asterisk: via the
    Subversion code repository, via <span class="emphasis"><em>wget</em></span> from the
    downloads site, or via a package-management system such as
    <span class="command"><strong>apt-get</strong></span> or <span class="command"><strong>yum</strong></span>. We’re only going to
    cover the first two methods, since we’re interested in building the latest
    version of Asterisk from source. Typically, package-management systems
    will have versions that are older than those available from Subversion or
    the downloads site, and we want to make sure we have the most recent fixes
    available to us, so we tend to avoid them.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id423490"></a>The official packages from Digium
      <a id="I_indexterm3_d1e6572" class="indexterm"></a>do tend to stay up to date. There are currently packages
      for CentOS/RHEL available at <a class="ulink" href="http://www.asterisk.org/downloads/yum" target="_top">http://www.asterisk.org/downloads/yum</a>.</p></div><p><a id="Installing_id292466"></a>Before we start getting the source files,
    let’s create a directory structure to house the downloaded code. We’re
    going to create the directory structure within the home directory for the
    <span class="emphasis"><em>asteriskpbx</em></span> user on the system. Once everything is
    built, it will be installed with the <span class="command"><strong>sudo</strong></span> command.
    We’ll then go back and change the permissions and ownership of the
    installed files in order to build a secure system. To begin, issue the
    following command:</p><a id="Installing_id292488"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>mkdir -p ~/src</code></strong><strong class="userinput"><code>/asterisk-complete/asterisk</code></strong></pre><p><a id="Installing_id292509"></a>Now that we’ve created a directory
    structure to hold everything, let’s get the source code. Choose one of the
    following two methods to get your files:</p><div class="orderedlist"><a id="Installing_id292514"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Installing_id292516"></a><a id="Installing_id292518"></a>
          <a class="link" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_subversion" title="Getting the Source via Subversion">Subversion</a>
        </p></li><li class="listitem"><p><a id="Installing_id292525"></a><a id="Installing_id292527"></a>
          <span class="emphasis"><em>
            <a class="link" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_wget" title="Getting the Source via wget">wget</a>
          </em></span>
        </p></li></ol></div><div class="sidebar" title="Getting the Latest Version"><a id="I_sidebar3_d1e6609"></a><div class="titlepage"><div><div><p class="title"><strong>Getting the Latest Version</strong></p></div></div></div><p><a id="Installing_id292541"></a>Asterisk is a constantly evolving
      project, and there are many different versions of the software that you
      can implement.</p><p><a id="Installing_id292547"></a>In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch" title="Chapter 2. Asterisk Architecture">Chapter&nbsp;2, <em>Asterisk Architecture</em></a>, we
      talked about Asterisk versioning.<a id="I_indexterm3_d1e6618" class="indexterm"></a> The concept of how Asterisk is versioned is important to
      understand because the versioning system for Asterisk has undergone a
      few changes of methodology over the years. So, if you’re not up to speed
      on Asterisk versioning, we strongly recommend that you go back and read
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning" title="Asterisk Versioning">the section called “Asterisk Versioning”</a>.</p><p><a id="Installing_id292557"></a>Having said all that, in most cases all
      you need to do is grab the latest version from the <a class="ulink" href="http://www.asterisk.org/downloads" target="_top">http://www.asterisk.org/downloads</a> website. We will be
      installing and using Asterisk 1.8 throughout this book.</p></div><div class="sect2" title="Getting the Source via Subversion"><div class="titlepage"><div><div><h3 class="title"><a id="get_source_via_subversion"></a>Getting the Source via Subversion</h3></div></div></div><p><a id="Installing_id292576"></a>Subversion <a id="I_indexterm3_d1e6635" class="indexterm"></a>is a version control system that is used by developers to
      track changes to code over a period of time. Each time the code is
      modified, it must first be checked out of the repository; then it must
      be checked back in, at which point the changes are logged. Thus, if a
      change creates a regression, the developers can go back to that change
      and remove it if necessary. This is a powerful and robust system for
      development work. It also happens to be useful for Asterisk
      administrators seeking to retrieve the software. To download the source
      code to the latest version of Asterisk 1.8, use these commands:</p><a id="Installing_id292600"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk</code></strong>
$ <strong class="userinput"><code>svn co http://svn.asterisk.org/svn/asterisk/branches/1.8</code></strong></pre><p><a id="Installing_id292612"></a>You can now skip directly to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it" title="How to Install It">the section called “How to Install It”</a>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id292590"></a>The preceding commands will retrieve
        the latest changes to the source in that particular branch, which are
        changes that have been made after the latest release. If you would
        prefer to use a released version, please refer to the next
        section.</p></div></div><div class="sect2" title="Getting the Source via wget"><div class="titlepage"><div><div><h3 class="title"><a id="get_source_via_wget"></a>Getting the Source via wget</h3></div></div></div><p><a id="Installing_id292629"></a><a id="I_indexterm3_d1e6657" class="indexterm"></a>To obtain the latest released versions of DAHDI, LibPRI,
      and Asterisk using the <span class="command"><strong>wget</strong></span> application, issue the
      following commands:</p><a id="Installing_id292636"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk</code></strong>
$ <strong class="userinput"><code>wget \
http://downloads.asterisk.org/pub/telephony/asterisk/asterisk-1.8-current.tar.gz</code></strong>
$ <strong class="userinput"><code>tar zxvf asterisk-1.8-current.tar.gz</code></strong></pre><p><a id="Installing_id292653"></a>The next step is to compile and install
      the software, so onward to the next section.</p></div></div><div class="sect1" title="How to Install It"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="installing_how_to_install_it"></a>How to Install It</h2></div></div></div><p><a id="Installing_id292671"></a><a id="index-012B015KR8K" class="indexterm"></a>With the source files downloaded you can compile the
    software and install it. The order for installing is:</p><p><a id="Installing_id292676"></a>
      </p><div class="orderedlist"><a id="Installing_id292677"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Installing_id292679"></a><a id="Installing_id292681"></a>LibPRI<sup>[<a id="id521113" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id521113" class="footnote">31</a>]</sup></p></li><li class="listitem"><p><a id="Installing_id292693"></a><a id="Installing_id292695"></a>DAHDI<sup>[<a id="id521133" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id521133" class="footnote">32</a>]</sup></p></li><li class="listitem"><p><a id="Installing_id292710"></a><a id="Installing_id292712"></a>Asterisk<sup>[<a id="id521158" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id521158" class="footnote">33</a>]</sup></p></li></ol></div><p>
    </p><p><a id="Installing_id292724"></a>Installing in this order ensures that any
    dependencies for DAHDI and Asterisk are installed prior to running the
    configuration scripts, which will subsequently ensure that any modules
    dependent on LibPRI or DAHDI will be built.</p><p><a id="Installing_id292730"></a>So, let’s get started.</p><div class="sect2" title="LibPRI"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id423812"></a>LibPRI</h3></div></div></div><p><a id="Installing_id423818"></a><a id="I_indexterm3_d1e6717" class="indexterm"></a><a id="I_indexterm3_d1e6720" class="indexterm"></a>LibPRI is a library that adds support for ISDN (PRI and
      BRI). The use of LibPRI is optional, but since it takes very little time
      to install, doesn’t interfere with anything, and will come in handy if
      you ever want to add cards to a system at a later point, we recommend
      that you install it now.</p><p><a id="Installing_id423824"></a>Check out the latest version of LibPRI
      and compile it like so:</p><p><a id="Installing_id423841"></a><a id="Installing_id423842"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>mkdir libpri</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd libpri/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>svn co http://svn.asterisk.org/svn/libpri/tags/1.4.<em class="replaceable"><code>&lt;your version number&gt;</code></em></code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd 1.4.<em class="replaceable"><code>&lt;your version number&gt;</code></em></code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id423830"></a>You can also download the source via
          <span class="command"><strong>wget</strong></span> from <a class="ulink" href="http://downloads.asterisk.org/pub/telephony/libpri/" target="_top">http://downloads.asterisk.org/pub/telephony/libpri/</a>.</p></div><p>With LibPRI installed, we can now install DAHDI.</p></div><div class="sect2" title="DAHDI"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id423870"></a>DAHDI</h3></div></div></div><p><a id="Installing_id423875"></a><a id="I_indexterm3_d1e6790" class="indexterm"></a>The <span class="emphasis"><em>Digium Asterisk Hardware Device
      Interface</em></span>, or DAHDI (formerly known as Zaptel), is the
      software Asterisk uses to interface with telephony hardware. We
      recommend that you install it even if you have no hardware installed,
      because DAHDI is a dependency required for building the timing module
      <code class="literal">res_timing_dahdi</code> and is used for Asterisk <span class="keep-together">dialplan</span> applications such as
      <code class="literal">MeetMe()</code>.</p><div class="sidebar" title="DAHDI-tools and DAHDI-linux"><a id="Installing_id423892"></a><div class="titlepage"><div><div><p class="title"><strong>DAHDI-tools and DAHDI-linux</strong></p></div></div></div><p><a id="Installing_id423897"></a>DAHDI is actually a combination of two
        separate code bases: <span class="emphasis"><em>DAHDI-tools</em></span><a id="I_indexterm3_d1e6815" class="indexterm"></a>, which provides various administrator tools such as
        <span class="emphasis"><em>dahdi_cfg</em></span>, <span class="emphasis"><em>dahdi_scan</em></span>, etc.;
        and <span class="emphasis"><em>DAHDI-linux</em></span><a id="I_indexterm3_d1e6827" class="indexterm"></a>, which provides the kernel drivers. Unless you’re only
        updating one or the other, you’ll be installing both at the same time,
        which is referred to as <span class="emphasis"><em>DAHDI-linux-complete</em></span>. The
        version numbering for <span class="emphasis"><em>DAHDI-linux-complete</em></span> will
        look something like <code class="literal">2.4.0+2.4.0</code>, where the number
        to the left of the plus sign is the version of
        <span class="emphasis"><em>DAHDI-linux</em></span> included, and the version number to
        the right of the plus sign is the <span class="emphasis"><em>DAHDI-tools</em></span>
        version included.</p><p><a id="Installing_id423922"></a>There are also FreeBSD drivers for
        DAHDI, which are maintained by the community. These drivers are
        available at <a class="ulink" href="http://downloads.asterisk.org/pub/telephony/dahdi-freebsd-complete/" target="_top">http://downloads.asterisk.org/pub/telephony/dahdi-freebsd-complete/</a>.</p></div><p><a id="Installing_id423932"></a>Another dependency is required for
      installing DAHDI, and that is the kernel source. It is important that
      the kernel version being used match exactly that of the kernel source
      being installed. You can use <span class="command"><strong>uname -a</strong></span> to verify the
      currently running kernel version:</p><div class="itemizedlist"><a id="Installing_id423941"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installing_id423943"></a><a id="Installing_id423945"></a>CentOS: <code class="literal">sudo yum install
          kernel-devel-`uname -r`</code></p></li><li class="listitem"><p><a id="Installing_id423952"></a><a id="Installing_id423954"></a>Ubuntu: <code class="literal">sudo apt-get install
          linux-headers-`uname -r`</code></p></li></ul></div><p><a id="Installing_id423961"></a>The use of <span class="command"><strong>uname -r</strong></span>
      surrounded by backticks (<code class="literal">`</code>) is for filling in the
      currently running kernel version so the appropriate package is
      installed.</p><p><a id="Installing_id347012"></a>The following commands show how to
      install <span class="emphasis"><em>DAHDI-linux-complete 2.4.0+2.4.0</em></span>. There may
      be a newer version available by the time you are reading this, so check
      <span class="emphasis"><em>downloads.asterisk.org</em></span> first. If there is a newer
      version available, just replace the version number in the
      commands:</p><a id="Installing_id423996"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/</code></strong>
$ <strong class="userinput"><code>mkdir dahdi</code></strong>
$ <strong class="userinput"><code>cd dahdi/</code></strong>
$ <strong class="userinput"><code>svn co http://svn.asterisk.org/svn/dahdi/linux-complete/tags/<em class="replaceable"><code>2.4.0+2.4.0</code></em></code></strong>
$ <strong class="userinput"><code>cd <em class="replaceable"><code>2.4.0+2.4.0</code></em></code></strong>
$ <strong class="userinput"><code>make</code></strong>
$ <strong class="userinput"><code>sudo make install</code></strong>
$ <strong class="userinput"><code>sudo make config</code></strong></pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Installing_id423989"></a>You will need to have Internet access
        when running the <span class="emphasis"><em>make all</em></span> command, as it will
        attempt to download the latest hardware firmware from the Digium
        servers.</p></div><p><a id="Installing_id424029"></a>After installing DAHDI, we can move on to
      installing Asterisk.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id423974"></a>You can also download the source via
        <span class="command"><strong>wget</strong></span> from <a class="ulink" href="http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/" target="_top">http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/</a>.</p></div></div><div class="sect2" title="Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id424034"></a>Asterisk</h3></div></div></div><p><a id="Installing_id424039"></a>With both DAHDI and LibPRI installed, we
      can now install Asterisk:</p><a id="Installing_id292741"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make config</code></strong></pre><p><a id="Installing_id292765"></a>With the files now installed in their
      default locations, we need to modify the permissions of the directories
      and their contents.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id292774"></a>There is an additional step that is
          not strictly required, but is quite common (and arguably important):
          the <span class="command"><strong>make menuselect</strong></span> command,<a id="I_indexterm3_d1e6973" class="indexterm"></a><a id="I_indexterm3_d1e6976" class="indexterm"></a> which provides a graphical interface that allows
          detailed selection of which modules and features will be compiled.
          We will discuss this in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994" title="make menuselect">the section called “make menuselect”</a>.</p></div></div><div class="sect2" title="Setting File Permissions"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id292785"></a>Setting File Permissions</h3></div></div></div><p><a id="Installing_id292790"></a><a id="I_indexterm3_d1e6988" class="indexterm"></a>In order to run our system more securely, we’ll be
      installing Asterisk and then running it as the
      <span class="emphasis"><em>asteriskpbx</em></span> user. After installing the files into
      their default locations, we need to change the file permissions to match
      those of the user we’re going to be running as. Execute the following
      commands after running <span class="command"><strong>make install</strong></span> (which we did
      previously):</p><p><a id="Installing_id292796"></a>
        <a id="Installing_id292797"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /usr/lib/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/lib/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/spool/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/log/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/run/asterisk</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo chown asteriskpbx:asteriskpbx /usr/sbin/asterisk</code></strong></pre><p>
      </p><p>In order to use <code class="literal">MeetMe()</code> and DAHDI with
      Asterisk as non-root, you must change the
      <code class="filename">/etc/udev/rules.d/dahdi.rules</code> so that the
      <code class="literal">OWNER</code> and <code class="literal">GROUP</code> fields match the
      non-root user Asterisk will be running as. In this case, we’re using the
      <span class="emphasis"><em>asteriskpbx</em></span> user.</p><p>Change the last line of the <code class="filename">dahdi.rules</code> file
      to the following:</p><a id="I_programlisting3_d1e7061"></a><pre class="programlisting">SUBSYSTEM=="dahdi", OWNER="asteriskpbx", GROUP="asteriskpbx", MODE="0660"</pre><p>With that out of the way, we can move on to performing the base
      configuration that should be done after all installations.<a id="I_indexterm3_d1e7065" class="indexterm"></a></p></div></div><div class="sect1" title="Base Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="installing_base_configuration"></a>Base Configuration</h2></div></div></div><p><a id="Installing_id292985"></a><a id="index-321Q053BW0S" class="indexterm"></a><a id="index-838F345EN5K" class="indexterm"></a>Now that we’ve got Asterisk installed, we can get our system
    up and running. The purpose here is to get Asterisk loaded up and ready to
    go, as it isn’t doing anything useful yet. These are the steps that all
    system administrators will need to start out with when installing a new
    system. If the commands that need to be run differ on CentOS and Ubuntu,
    you will see a table with rows labeled for each distribution; otherwise,
    you will see a single command that should be run regardless of which Linux
    distribution you have chosen.</p><div class="sect2" title="Disable SELinux"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id293578"></a>Disable SELinux</h3></div></div></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id293586"></a>This section applies only to CentOS
        users, so if you’re using Ubuntu, you can skip to the next
        section.</p></div><p><a id="Installing_id293609"></a><a id="I_indexterm3_d1e7086" class="indexterm"></a><a id="I_indexterm3_d1e7091" class="indexterm"></a>In CentOS, the<a id="I_indexterm3_d1e7099" class="indexterm"></a> Security-Enhanced Linux (SELinux) system is enabled by
      default, and it often gets in the way of Asterisk. Sometimes the issues
      are quite subtle, and at least one of the authors has spent a good
      number of hours debugging issues in Asterisk that turned out to be
      resolved by disabling SELinux. There are many articles on the Internet
      that describe the correct configuration of SELinux, but we’re going to
      disable it for the sake of simplicity.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id386243"></a>While disabling SELinux is not the
        ideal situation, the configuration of SELinux is beyond the scope of
        this book, and frankly, we just don’t have enough experience with it
        to configure it correctly.</p></div><p><a id="Installing_id293616"></a>To temporarily switch off SELinux,
      perhaps in order to verify whether an issue you’re having is being
      caused by SELinux, run the following command as root:</p><a id="Installing_id293621"></a><pre class="screen">$ <strong class="userinput"><code>sudo echo 0 &gt; /selinux/enforce</code></strong></pre><p><a id="Installing_id293627"></a>You can reenable SELinux by doing the
      same thing, but replacing the <span class="emphasis"><em>0</em></span> with a
      <span class="emphasis"><em>1</em></span>:</p><a id="Installing_id293631"></a><pre class="screen">$ <strong class="userinput"><code>sudo echo 1 &gt; /selinux/enforce</code></strong></pre><p><a id="Installing_id293637"></a>To disable SELinux permanently, modify
      the <code class="filename">/etc/selinux/config</code> file:</p><a id="Installing_id293653"></a><pre class="screen">$ <strong class="userinput"><code>cd /etc/selinux/</code></strong>
$ <strong class="userinput"><code>sudo vim config</code></strong></pre><p>Change the <code class="option">SELINUX</code> option from
      <code class="literal">enforcing</code> to <code class="literal">disabled</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id424317"></a>Alternatively, you can change the value
        of <code class="literal">enforcing</code> to <code class="literal">permissive</code>,
        which simply logs the errors instead of enforcing the policy.</p></div><p><a id="Installing_id293662"></a>When you’re done modifying the
      configuration file, you’ll have the following:</p><a id="Installing_id293666"></a><pre class="screen"># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - SELinux is fully disabled.
<span class="emphasis"><em><strong class="userinput"><code>SELINUX=disabled</code></strong></em></span>
# SELINUXTYPE= type of policy in use. Possible values are:
#       targeted - Only targeted network daemons are protected.
#       strict - Full SELinux protection.
SELINUXTYPE=targeted

# SETLOCALDEFS= Check local definition changes
SETLOCALDEFS=0</pre><p><a id="Installing_id293678"></a>Since you can’t disable SELinux without
      rebooting, you’ll need to do that now:</p><a id="Installing_id293682"></a><pre class="screen">$ <strong class="userinput"><code>sudo reboot</code></strong></pre></div><div class="sect2" title="Initial Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id293688"></a>Initial Configuration</h3></div></div></div><p><a id="Installing_id293694"></a><a id="index-051F020II7P" class="indexterm"></a><a id="index-371G421FA6N" class="indexterm"></a>In order to get Asterisk up and running cleanly, we need
      to create some configuration files. We could potentially install the
      sample files that come with Asterisk (by executing the <span class="command"><strong>make
      samples</strong></span> command in our Asterisk source) and then modify those
      files to suit our needs, but the <span class="command"><strong>make samples</strong></span> command
      installs many sample files, most of them for modules that you will never
      use. We want to limit which modules we are loading, and we also believe
      that it’s easier to understand Asterisk configuration if you build your
      config files from scratch, so we’re going to create our own minimal set
      of configuration files.<sup>[<a id="id523106" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id523106" class="footnote">34</a>]</sup></p><p><a id="Installing_id293720"></a>The first thing we need to do (assuming
      it does not already exist) is create the
      <code class="filename">/etc/asterisk/</code> directory where our configuration
      files will live:</p><a id="Installing_id293728"></a><pre class="screen">$ <strong class="userinput"><code>sudo mkdir /etc/asterisk/</code></strong>
$ <strong class="userinput"><code>sudo chown asteriskpbx:asteriskpbx /etc/asterisk/</code></strong></pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Installing_id293742"></a>Running <span class="command"><strong>make samples</strong></span>
        on a system that already has configuration files will overwrite the
        existing files.</p></div><div class="sidebar" title="Using make samples to Create Sample Configuration Files for Future Reference"><a id="Installing_id293750"></a><div class="titlepage"><div><div><p class="title"><strong>Using make samples to Create Sample <span class="keep-together">Configuration Files <span class="keep-together">for <span class="keep-together">Future
        Reference</span></span></span></strong></p></div></div></div><p><a id="Installing_id293759"></a>Even though we are not going to use the
        sample configuration files that come with Asterisk, the fact is that
        they are an excellent reference. If there is a module that you are not
        currently using but wish to put into production, the sample file will
        show you exactly what syntax to use, and what options are available
        for that module.</p><p><a id="Installing_id293766"></a>Running the <span class="command"><strong>sudo make
        samples</strong></span> command in your Asterisk source directory<sup>[<a id="id523210" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id523210" class="footnote">35</a>]</sup> is harmless on a new system that has just been built,
        but it is very dangerous to run on a system that already has
        configuration files, as this command will overwrite any existing files
        (which would be a disaster for you if you do not have a current
        backup).</p><p><a id="Installing_id293785"></a>If you’ve run the <span class="command"><strong>sudo make
        samples</strong></span> command, you will want to move the files that it has
        created in <code class="filename">/etc/asterisk/</code> to another folder. We
        like to create a folder called
        <code class="filename">/etc/asterisk/unused/</code> and put any sample/unused
        configuration files in there, but feel free to store them wherever you
        like.</p></div><p><a id="Installing_id293801"></a>We’re now going to step through all the
      files that are required to get a simple Asterisk system up and
      running.</p><div class="sect3" title="indications.conf and asterisk.conf"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id293806"></a>indications.conf and asterisk.conf</h4></div></div></div><p><a id="Installing_id293811"></a><a id="I_indexterm3_d1e7257" class="indexterm"></a><a id="I_indexterm3_d1e7260" class="indexterm"></a><a id="I_indexterm3_d1e7263" class="indexterm"></a>The first file needed is
        <code class="filename">indications.conf</code>, a file that contains
        information about how to detect different telephony tones for
        different countries. There is a perfectly good sample file that we can
        use in the Asterisk source, so let’s copy it into our
        <code class="filename">/etc/asterisk/</code> directory:</p><a id="Installing_id293823"></a><pre class="screen">$ <strong class="userinput"><code><strong class="userinput"><code>cp ~/src/asterisk-complete/asterisk/1.8/configs/indications.conf.sample \
/etc/asterisk/indications.conf</code></strong></code></strong></pre><p><a id="Installing_id293830"></a>Because we’re running Asterisk as
        non-root, we need to tell Asterisk which user to run as. This is done
        with the <code class="filename">asterisk.conf</code> file. We can copy a sample
        version of it from the Asterisk source to
        <code class="filename">/etc/asterisk</code>:</p><p><a id="Installing_id293835"></a>
          <a id="Installing_id293836"></a></p><pre class="screen">$ <strong class="userinput"><code>cp ~/src/asterisk-complete/asterisk/1.8/configs/asterisk.conf.sample \
/etc/asterisk/asterisk.conf</code></strong></pre><p>
        </p><p><a id="Installing_id424570"></a>The <code class="filename">asterisk.conf</code>
        file contains many options that we won’t go over here (they are
        covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file" title="asterisk.conf">the section called “asterisk.conf”</a>), but
        we do need to make an adjustment. Near the end of the
        <code class="literal">[options]</code> section, there are two options we need to
        enable: <code class="literal">runuser</code> and
        <code class="literal">rungroup</code>.</p><p><a id="Installing_id424592"></a>Open the
        <code class="filename">asterisk.conf</code> file with an editor such as
        <span class="command"><strong>nano</strong></span> or <span class="command"><strong>vim</strong></span>: Uncomment the
        <code class="literal">runuser</code> and <code class="literal">rungroup</code> lines, and
        modify them so that they each contain
        <em class="replaceable"><code>asteriskpbx</code></em> as the assigned value. Open the
        <code class="filename">/etc/asterisk/asterisk.conf</code> file with vim:</p><a id="I_programlisting3_d1e7333"></a><pre class="programlisting">$ <strong class="userinput"><code>vim /etc/asterisk/asterisk.conf</code></strong></pre><p>Then modify the file by uncommenting the two lines starting with
        <code class="literal">runuser</code> and <code class="literal">rungroup</code> and
        modifying the value to
        <strong class="userinput"><code><em class="replaceable"><code>asteriskpbx</code></em></code></strong>.</p><p><a id="Installing_id424615"></a><a id="Installing_id424616"></a></p><pre class="screen"><strong class="userinput"><code>runuser=<em class="replaceable"><code>asteriskpbx</code></em>
rungroup=<em class="replaceable"><code>asteriskpbx</code></em></code></strong></pre><p>We now
        have all the configuration files required to start a very minimal
        version of Asterisk.<sup>[<a id="id523516" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id523516" class="footnote">36</a>]</sup> Give it a shot by starting Asterisk up in the
        foreground:</p><a id="Installing_id293864"></a><pre class="screen">$ <strong class="userinput"><code>/usr/sbin/asterisk -cvvv</code></strong></pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id293871"></a>We are specifying the full path to
          the <span class="command"><strong>asterisk</strong></span> binary, but if you modify your
          <code class="literal">PATH</code> system variable to include the
          <code class="filename">/usr/sbin/</code> directory you don’t need to specify
          the full path. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699" title="Adding a system user">the section called “Adding a system user”</a> for
          information about modifying the <code class="literal">$PATH</code> environment
          variable.</p></div><p><a id="Installing_id293886"></a>Asterisk will start successfully
        without any errors or warnings (although it does warn you that some
        files are missing), and present to you the Asterisk command-line
        interface (CLI). At this point there are no modules, minimal core
        functionality, and no channel modules with which to communicate, but
        Asterisk is up and running.</p><p><a id="Installing_id424675"></a>Executing the <span class="command"><strong>module
        show</strong></span> command at the Asterisk CLI shows that there are no
        external modules loaded:</p><a id="Installing_id293898"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>module show</code></strong></pre><a id="Installing_id293903"></a><pre class="screen">Module                         Description                              Use Count 
0 modules loaded</pre><p><a id="Installing_id293907"></a>We’ve done this simply to demonstrate
        that Asterisk can be run in a very minimal state, and doesn’t require
        the dozens of modules that a default install will enable. Let’s stop
        Asterisk with the <span class="command"><strong>core stop now</strong></span> CLI command:</p><a id="Installing_id293914"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>core stop now</code></strong></pre><div class="sidebar" title="The Asterisk Shell Command"><a id="Installing_id293919"></a><div class="titlepage"><div><div><p class="title"><strong>The Asterisk Shell Command</strong></p></div></div></div><p><a id="Installing_id293924"></a><a id="I_indexterm3_d1e7412" class="indexterm"></a><a id="I_indexterm3_d1e7415" class="indexterm"></a>Asterisk can be run either as a daemon or as an
          application. In general, you will want to run it as an application
          when you are building, testing, and troubleshooting, and as a daemon
          when you put it into production.</p><p><a id="Installing_id293930"></a>The command to start Asterisk is the
          same regardless of whether you’re running it as a daemon or an
          application:</p><p><a id="Installing_id293934"></a>
            <span class="command"><strong>asterisk</strong></span>
          </p><p><a id="Installing_id293938"></a>However, without any arguments, this
          command will assume certain defaults and start Asterisk as a
          background application. In other words, you never want to run the
          command <code class="filename">asterisk</code> on its own, but rather will
          want to pass some options to it to better define the behavior you
          are looking for. The following list provides some examples of common
          usages.</p><div class="variablelist"><dl><dt><span class="term">
                <code class="literal">-h</code>
              </span></dt><dd><p>This command displays a helpful list of the options you
                can use. For a complete list of all the options and their
                descriptions, run the command <span class="command"><strong>man
                asterisk</strong></span>.</p></dd><dt><span class="term">
                <code class="literal">-c</code>
              </span></dt><dd><p>This option starts Asterisk as an application (in the
                foreground). This means that Asterisk is tied to your user
                session. In other words, if you close your user session by
                logging out or losing the connection, Asterisk dies. This is
                the option you will typically use when building, testing, and
                debugging, but you would not want to use this option in
                production. If you started Asterisk in this manner, type
                <span class="command"><strong>core stop now</strong></span> at the CLI prompt to stop
                Asterisk and exit.</p></dd><dt><span class="term"><code class="literal">-v</code>, <code class="literal">-vv</code>,
              <code class="literal">-vvv</code>, <code class="literal">-vvvv</code>, etc.</span></dt><dd><p>This option can be used with other options (e.g.,
                <em class="replaceable"><code>-cvvv</code></em>) in order to increase the
                verbosity of the console output. It does exactly the same
                thing as the CLI command <span class="command"><strong>core set verbose n</strong></span>
                where <span class="emphasis"><em>n</em></span> is any integer between 0 and 5
                (any integer greater than 5 will work, but will not provide
                any more verbosity). Sometimes it’s useful to not set the
                verbosity at all. For example, if you are looking to see only
                startup errors, notices, and warnings, leaving verbosity off
                will prevent all the other startup messages from being
                displayed.</p></dd><dt><span class="term"><code class="literal">-d</code>, <code class="literal">-dd</code>,
              <code class="literal">-ddd</code>, <code class="literal">-dddd</code>, etc.</span></dt><dd><p>This option can be used in the same way as
                <em class="replaceable"><code>-v</code></em>, but instead of normal output,
                this will specify the level of debug output (which is
                primarily useful for developers who wish to troubleshoot
                problems with the code). You will also need to enable output
                of debugging information in the
                <code class="filename">logger.conf</code> file (which we will cover in
                more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring" title="Chapter 24. System Monitoring and Logging">Chapter&nbsp;24, <em>System Monitoring and Logging</em></a>).</p></dd><dt><span class="term">
                <code class="literal">-r</code>
              </span></dt><dd><p>This command is essential if you want to connect to the
                CLI of an Asterisk process running as a daemon. You will
                probably use this option more than any other for Asterisk
                systems that are in production. This option will only work if
                you have a daemonized instance of Asterisk already running. To
                exit the CLI when this option has been used, type
                <span class="command"><strong>exit</strong></span>.</p></dd><dt><span class="term">
                <code class="literal">-T</code>
              </span></dt><dd><p>This option will add a timestamp to CLI output.</p></dd><dt><span class="term">
                <code class="literal">-x</code>
              </span></dt><dd><p>This command allows you to pass a string to Asterisk
                that will be executed as if it had been typed at the CLI. As
                an example, to get a quick listing of all the channels in use
                without having to start the Asterisk console, simply type
                <span class="command"><strong>asterisk -rx 'core show channels'</strong></span> from the
                shell, and you’ll get the output you are looking for.</p></dd><dt><span class="term">
                <code class="literal">-g</code>
              </span></dt><dd><p>This option instructs Asterisk to dump a core file if it
                crashes.</p></dd></dl></div><p><a id="Installing_id294144"></a>We recommend you try out a few
          combinations of these commands to see what they do.</p></div><div class="sidebar" title="safe_asterisk"><a id="Installing_id294149"></a><div class="titlepage"><div><div><p class="title"><strong>safe_asterisk</strong></p></div></div></div><p><a id="Installing_id294154"></a>When you install Asterisk using the
          <span class="command"><strong>make config</strong></span> directive it will create a script
          called <code class="filename">safe_asterisk</code>, which is run during the
          <span class="emphasis"><em>init</em></span> process of Linux each time you
          boot.</p><p><a id="Installing_id294164"></a>The
          <code class="filename">safe_asterisk</code> script <a id="I_indexterm3_d1e7558" class="indexterm"></a><a id="I_indexterm3_d1e7561" class="indexterm"></a>provides the following benefits:</p><div class="itemizedlist"><a id="Installing_id294171"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installing_id294173"></a><a id="Installing_id294175"></a>Restarts Asterisk automatically
              after a crash</p></li><li class="listitem"><p><a id="Installing_id294179"></a><a id="Installing_id294182"></a>Can be configured to email the
              administrator if a crash has occurred</p></li><li class="listitem"><p><a id="Installing_id294187"></a><a id="Installing_id294189"></a>Defines where crash files are
              stored (<code class="filename">/tmp</code> by default)</p></li><li class="listitem"><p><a id="Installing_id294196"></a><a id="Installing_id294198"></a>Executes a script if a crash has
              occurred</p></li></ul></div><p><a id="Installing_id294204"></a>You don’t need to know too much about
          this script, other than to understand that it should normally be
          running. In most environments this script works fine in its default
          format.</p></div></div><div class="sect3" title="modules.conf"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id294211"></a>modules.conf</h4></div></div></div><p><a id="Installing_id294216"></a><a id="I_indexterm3_d1e7589" class="indexterm"></a><a id="I_indexterm3_d1e7592" class="indexterm"></a>So, we’ve managed to get Asterisk running, but it’s not
        able to do anything useful for us yet. To tell Asterisk what modules
        we expect it to load, we’ll need a <code class="filename">modules.conf</code>
        file.</p><p><a id="Installing_id294224"></a>Create the file
        <code class="filename">modules.conf</code> in your
        <code class="filename">/etc/asterisk/</code> directory with the following
        command (replace the &gt;&gt; with &gt; if you instead want to
        overwrite an existing file):</p><a id="Installing_id294300"></a><pre class="screen">$ <strong class="userinput"><code>cat &gt;&gt; /etc/asterisk/modules.conf</code></strong></pre><p><a id="Installing_id294309"></a>Type (or paste) the following lines,
        and press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span> on a new line when you’re <span class="keep-together">finished</span>:</p><a id="Installing_id294321"></a><pre class="screen">          <strong class="userinput"><code>; The modules.conf file, used to define which modules Asterisk should load (or
; not load).
;
[modules]
autoload=yes
</code></strong>
        </pre><div class="sidebar" title="Using cat to Quickly Create Files and Add Content to Them"><a id="Installing_id294234"></a><div class="titlepage"><div><div><p class="title"><strong>Using cat to Quickly Create Files and Add Content to
          Them</strong></p></div></div></div><p><a id="Installing_id294243"></a>There are many cases in a Linux
          system where it is necessary to create a file, and then add some
          content to it. This is commonly done by using the
          <span class="command"><strong>touch</strong></span> command to create the file, and then
          opening it with an editor to add the content. However, there is a
          less-known way of doing this that lets you create the file and add
          the content all at once:</p><div class="itemizedlist"><a id="Installing_id294253"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installing_id294255"></a><a id="Installing_id294257"></a>Use the <span class="command"><strong>cat</strong></span>
              program to redirect output to the file you want (use
              <span class="command"><strong>&gt;&gt;</strong></span> to append, or
              <span class="command"><strong>&gt;</strong></span> to overwrite).</p></li><li class="listitem"><p><a id="Installing_id294272"></a><a id="Installing_id294274"></a>Paste or type the content you
              want to add to the file.</p></li><li class="listitem"><p><a id="Installing_id294279"></a><a id="Installing_id294281"></a>Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span> to complete your changes.</p></li></ul></div><p><a id="Installing_id294296"></a>Presto! File created and content
          added.</p></div><p><a id="Installing_id294327"></a>The <code class="literal">autoload=yes</code>
        line will tell Asterisk to automatically load all modules located in
        the <code class="filename">/usr/lib/asterisk/modules/</code> directory. If you
        wanted to, you could leave the file like this, and Asterisk would
        simply load any modules it found in the <span class="emphasis"><em>modules</em></span>
        folder.</p><p><a id="Installing_id294339"></a>With your new
        <code class="filename">modules.conf</code> file in place, starting Asterisk
        will cause a whole slew of modules to be loaded. You can verify this
        by starting Asterisk and running the <span class="command"><strong>module show</strong></span>
        command:</p><a id="Installing_id294350"></a><pre class="screen">$ <strong class="userinput"><code>asterisk -c</code></strong>
*CLI&gt; <strong class="userinput"><code>module show</code></strong></pre><a id="Installing_id294358"></a><pre class="screen">Module                         Description                              Use Count 
res_speech.so                  Generic Speech Recognition API           0
res_monitor.so                 Call Monitoring Resource                 0
...
func_math.so                   Mathematical dialplan function           0         
171 modules loaded</pre><p><a id="Installing_id294364"></a>We now have many modules loaded, and
        many additional dialplan applications and functions at our disposal.
        We don’t need all these resources loaded, though, so let’s filter out
        some of the more obscure modules that we don’t need at the moment.
        Modify your <code class="filename">modules.conf</code> file to contain the
        following <code class="literal">noload</code> lines, which will tell Asterisk to
        skip loading the identified modules:</p><a id="Installing_id294377"></a><pre class="programlisting">; Resource modules
noload =&gt; res_speech.so
noload =&gt; res_phoneprov.so
noload =&gt; res_ael_share.so
noload =&gt; res_clialiases.so
noload =&gt; res_adsi.so

; PBX modules
noload =&gt; pbx_ael.so
noload =&gt; pbx_dundi.so

; Channel modules
noload =&gt; chan_oss.so
noload =&gt; chan_mgcp.so
noload =&gt; chan_skinny.so
noload =&gt; chan_phone.so
noload =&gt; chan_agent.so
noload =&gt; chan_unistim.so
noload =&gt; chan_alsa.so

; Application modules
noload =&gt; app_nbscat.so
noload =&gt; app_amd.so
noload =&gt; app_minivm.so
noload =&gt; app_zapateller.so
noload =&gt; app_ices.so
noload =&gt; app_sendtext.so
noload =&gt; app_speech_utils.so
noload =&gt; app_mp3.so
noload =&gt; app_flash.so
noload =&gt; app_getcpeid.so
noload =&gt; app_setcallerid.so
noload =&gt; app_adsiprog.so
noload =&gt; app_forkcdr.so
noload =&gt; app_sms.so
noload =&gt; app_morsecode.so
noload =&gt; app_followme.so
noload =&gt; app_url.so
noload =&gt; app_alarmreceiver.so
noload =&gt; app_disa.so
noload =&gt; app_dahdiras.so
noload =&gt; app_senddtmf.so
noload =&gt; app_sayunixtime.so
noload =&gt; app_test.so
noload =&gt; app_externalivr.so
noload =&gt; app_image.so
noload =&gt; app_dictate.so
noload =&gt; app_festival.so</pre><p><a id="Installing_id294396"></a>There are, of course, other modules
        that you could remove, and others that you may find extremely useful,
        so feel free to tweak this file as you wish. Ideally, you should be
        loading only the modules that you need for the system you are running.
        The examples in this book assume that your
        <code class="filename">modules.conf</code> file looks like our example
        here.</p><p><a id="Installing_id294405"></a>Additional information about the
        <code class="filename">modules.conf</code> file can be found in the section
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file" title="modules.conf">the section called “modules.conf”</a>.</p></div><div class="sect3" title="musiconhold.conf"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id294479"></a>musiconhold.conf</h4></div></div></div><p><a id="Installing_id294484"></a><a id="I_indexterm3_d1e7720" class="indexterm"></a>The <code class="filename">musiconhold.conf</code> file defines
        the classes for music on hold in your Asterisk system. By defining
        different classes, you can specify different hold music to be used in
        various situations, such as different announcements to be played while
        holding in a queue, or different hold music if you have multiple PBXs
        hosted on the same system. For now, we’ll just create a default music
        on hold class so that we have at a minimum some hold music when
        placing callers on hold:</p><a id="Installing_id294495"></a><pre class="screen">$ <strong class="userinput"><code>cd /etc/asterisk/</code></strong>
$ <strong class="userinput"><code>cat &gt;&gt; musiconhold.conf</code></strong></pre><a id="Installing_id294504"></a><pre class="programlisting">; musiconhold.conf
[default]
mode=files
directory=moh

<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p><a id="Installing_id294517"></a>We’ve created a
        <code class="filename">musiconhold.conf</code> file and defined our
        <code class="literal">[default]</code> hold music class. We’re also assuming you
        installed the hold music from the <span class="command"><strong>menuselect</strong></span>
        system;<a id="I_indexterm3_d1e7752" class="indexterm"></a> by default there is at least one music on hold package
        installed, so unless you disabled it, you should have music in at
        least one format.</p><p><a id="Installing_id294529"></a>Additional information about
        <code class="filename">musiconhold.conf</code> can be found in the section
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file" title="musiconhold.conf">the section called “musiconhold.conf”</a>.<a id="I_indexterm3_d1e7763" class="indexterm"></a><a id="I_indexterm3_d1e7764" class="indexterm"></a></p></div></div><div class="sect2" title="make menuselect"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id292994"></a>make menuselect</h3></div></div></div><p><a id="Installing_id293000"></a><span class="command"><strong>menuselect</strong></span> <a id="index-330S760AT0J" class="indexterm"></a><a id="index-586T440CT5G" class="indexterm"></a><a id="index-465E024KW2W" class="indexterm"></a>is a text-based menu system in Asterisk used to configure
      which modules to compile and install. The modules are what give Asterisk
      its power and functionality. New modules are constantly being
      created.</p><p><a id="Installing_id293006"></a>In the installation sections, we
      conveniently skipped over using the <span class="command"><strong>menuselect</strong></span> system
      in order to keep the instructions simple and straightforward. However,
      it is important enough that we have given <span class="command"><strong>menuselect</strong></span>
      its own section.</p><p><a id="Installing_id293011"></a>In addition to specifying which modules
      to install, <span class="command"><strong>menuselect</strong></span> also allows you to set flags
      that can aid in debugging issues (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch" title="Chapter 2. Asterisk Architecture">Chapter&nbsp;2, <em>Asterisk Architecture</em></a>),
      set optimization flags, choose different sound prompt files and formats,
      and do various other nifty things.</p><div class="sect3" title="Uses for menuselect"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id293020"></a>Uses for menuselect</h4></div></div></div><p><a id="Installing_id293026"></a><a id="I_indexterm3_d1e7807" class="indexterm"></a><a id="I_indexterm3_d1e7814" class="indexterm"></a>We would need a whole chapter in order to fully explore
        <span class="command"><strong>menuselect</strong></span>, and for the most part you won’t need to
        make many changes to it. However, the following example will give you
        an idea of how <span class="command"><strong>menuselect</strong></span> works, and is recommend
        for any installation.</p><p><a id="Installing_id293031"></a>By default <a id="I_indexterm3_d1e7828" class="indexterm"></a>Asterisk only installs the core sound prompt files, and
        only in GSM format. Also, the three <a class="ulink" href="http://www.opsound.org/" target="_top">OpSound</a> music on hold files
        available for download are only selected in <code class="filename">.wav</code>
        format.<sup>[<a id="id524730" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id524730" class="footnote">37</a>]</sup></p><p><a id="Installing_id293058"></a>We’re going to want extra sound prompts
        installed instead of just the default core sound prompts, and in a
        better-sounding format than GSM. We can do this with the
        <span class="command"><strong>menuselect</strong></span> system by running <span class="command"><strong>make
        menuselect</strong></span> in the Asterisk source directory. Before
        exploring that, though, let’s talk about the different
        <span class="command"><strong>menuselect</strong></span> interfaces.</p></div><div class="sect3" title="menuselect interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id293069"></a>menuselect interfaces</h4></div></div></div><p><a id="Installing_id293074"></a><a id="I_indexterm3_d1e7861" class="indexterm"></a><a id="I_indexterm3_d1e7868" class="indexterm"></a>There are two interfaces available for
        <span class="command"><strong>menuselect</strong></span>: curses and newt. If the
        <code class="literal">libnewt</code> libraries are installed, you will get the
        blue and red interface shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_newt" title="Figure 3.1. menuselect using the newt interface">Figure&nbsp;3.1, “menuselect using the newt interface”</a>.
        Otherwise, by default <span class="command"><strong>menuselect</strong></span> will use the
        curses (black and white) interface shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_curses" title="Figure 3.2. menuselect using the curses interface">Figure&nbsp;3.2, “menuselect using the curses interface”</a>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id293093"></a>The minimum screen size <a id="I_indexterm3_d1e7891" class="indexterm"></a>for the curses interface is 80x27, which means it may
          not load if you’re using the default terminal size for a simple
          distribution installation. This is not a problem when you’re using
          SSH to reach the server remotely, as typically your terminal can be
          resized, but if you’re working at the terminal directly you may need
          to have screen buffers installed to enable a higher resolution,
          which is not recommended for a system running Asterisk. The solution
          is to use the newt-based <span class="command"><strong>menuselect</strong></span>
          system.</p></div><div class="figure-float"><div class="figure"><a id="menuselect_newt"></a><p class="title"><strong>Figure&nbsp;3.1.&nbsp;menuselect using the newt interface</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject3_d1e7901"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0301.png" alt="menuselect using the newt interface"></div></div></div><br class="figure-break"></div><div class="figure-float"><div class="figure"><a id="menuselect_curses"></a><p class="title"><strong>Figure&nbsp;3.2.&nbsp;menuselect using the curses interface</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject3_d1e7909"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0302.png" alt="menuselect using the curses interface"></div></div></div><br class="figure-break"></div><div class="sidebar" title="Installing Dependencies for newt-Based menuselect"><a id="Installing_id293155"></a><div class="titlepage"><div><div><p class="title"><strong>Installing Dependencies for newt-Based menuselect</strong></p></div></div></div><p><a id="Installing_id293160"></a><a id="I_indexterm3_d1e7919" class="indexterm"></a>To get the newt-based <span class="command"><strong>menuselect</strong></span>
          working, you need to have the <code class="literal">libnewt</code> development
          libraries installed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>CentOS: <code class="literal">sudo yum install
              libnewt-devel</code></p></li><li class="listitem"><p>Ubuntu: <code class="literal">sudo apt-get install
              libnewt-dev</code></p></li></ul></div><p><a id="Installing_id293178"></a>If you’ve previously used
          <span class="command"><strong>menuselect</strong></span> with the curses interface, you need to
          rebuild. You can do this with the following commands:</p><p><a id="Installing_id293183"></a><a id="Installing_id293184"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8.<em class="replaceable"><code>&lt;your version&gt;</code></em>/</code></strong>
$ <strong class="userinput"><code>cd menuselect</code></strong>
$ <strong class="userinput"><code>make clean</code></strong>
$ <strong class="userinput"><code>./configure</code></strong>
$ <strong class="userinput"><code>cd ..</code></strong>
$ <strong class="userinput"><code>make menuselect</code></strong></pre><p>After that you should have
          the newt-based interface available to you.</p></div></div><div class="sect3" title="Using menuselect"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id293213"></a>Using menuselect</h4></div></div></div><p><a id="Installing_id293218"></a><a id="I_indexterm3_d1e7976" class="indexterm"></a><a id="I_indexterm3_d1e7983" class="indexterm"></a>Run the following commands to start
        <span class="command"><strong>menuselect</strong></span>:</p><a id="Installing_id293221"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8.<em class="replaceable"><code>&lt;your version&gt;</code></em>/</code></strong>
$ <strong class="userinput"><code>make menuselect</code></strong></pre><p><a id="Installing_id293233"></a>You will be presented with a screen
        such as that in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_newt" title="Figure 3.1. menuselect using the newt interface">Figure&nbsp;3.1, “menuselect using the newt interface”</a> or <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#menuselect_curses" title="Figure 3.2. menuselect using the curses interface">Figure&nbsp;3.2, “menuselect using the curses interface”</a>. You can use the arrow keys on your
        keyboard to move up and down. The <span class="keycap"><strong>right arrow</strong></span> key
        will take you into a submenu, and the <span class="keycap"><strong>left arrow</strong></span> key
        will take you back. You can use the <span class="keycap"><strong>space bar</strong></span> or
        <span class="keycap"><strong>Enter</strong></span> key to select and deselect modules. Pressing
        the <span class="keycap"><strong>q</strong></span> key will quit without saving, while the
        <span class="keycap"><strong>x</strong></span> key will save your selections and then quit.</p><div class="sidebar" title="Module Dependencies"><a id="Installing_id293265"></a><div class="titlepage"><div><div><p class="title"><strong>Module Dependencies</strong></p></div></div></div><p><a id="Installing_id293270"></a><a id="I_indexterm3_d1e8032" class="indexterm"></a>Modules that have <code class="literal">XXX</code> in front of
          them are modules that cannot be compiled because the
          <span class="command"><strong>configure</strong></span> script was not able to find the
          dependencies required (for example, if you don’t have the
          <span class="emphasis"><em>unixODBC</em></span> development package installed, you
          will not be able to compile <code class="literal">func_odbc</code><sup>[<a id="id525285" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id525285" class="footnote">38</a>]</sup>). Whenever you install a dependency, you will always
          need to rerun <span class="command"><strong>configure</strong></span> before you run
          <span class="command"><strong>menuselect</strong></span>, so that the new dependency will be
          properly located. The dependant module will at that point be
          available in <span class="command"><strong>menuselect</strong></span>. If the module selection
          still contains <code class="literal">XXX</code>, either the
          <span class="command"><strong>configure</strong></span> script is still unable to find the
          dependency or not all dependencies have been satisfied.</p></div><p><a id="Installing_id293318"></a>Once you’ve started
        <span class="command"><strong>menuselect</strong></span>, scroll down to <code class="literal">Core Sound
        Packages</code> and press the <span class="keycap"><strong>right arrow</strong></span> key (or
        <span class="keycap"><strong>Enter</strong></span>) to open the menu. You will be presented with a
        list of available options. These options represent the core sound
        files in various languages and formats. By default, the only set of
        files selected is <code class="literal">CORE-SOUNDS-EN-GSM</code>, which is the
        English-language Core Sounds package in GSM format.</p><p><a id="Installing_id293337"></a>Select
        <code class="literal">CORE-SOUNDS-EN-WAV</code> and
        <code class="literal">CORE-SOUNDS-EN-ULAW</code> (or <code class="literal">ALAW</code> if
        you’re outside of North America or Japan<sup>[<a id="id525395" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id525395" class="footnote">39</a>]</sup>), and any other sound files that may be applicable in
        your network.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id293365"></a>The reason we have multiple formats
          for the same files is that Asterisk can play back the appropriate
          format depending on which codec is negotiated by an endpoint. This
          can lower the CPU load on a system significantly.</p></div><p><a id="Installing_id293376"></a>After selecting the appropriate sound
        files, press the <span class="keycap"><strong>left arrow</strong></span> key to go back to the
        main menu. Then scroll down two lines to the <code class="literal">Extra Sound
        Packages</code> menu and press the <span class="keycap"><strong>right arrow</strong></span> key
        (or <span class="keycap"><strong>Enter</strong></span>). You will notice that by default there are
        no packages selected. As with the core sound files, select the
        appropriate language and format to be installed. A good option is
        probably to install the English sound files in the
        <code class="literal">WAV</code>, <code class="literal">ULAW</code>, and
        <code class="literal">ALAW</code> formats.</p><p><a id="Installing_id293405"></a>Once you’ve completed selecting the
        sound files, press the <span class="keycap"><strong>x</strong></span> key to save and exit
        <span class="command"><strong>menuselect</strong></span>. You then need to install your new
        prompts by downloading them from the Asterisk downloads site. This is
        done simply by running <span class="command"><strong>make install</strong></span> again:</p><a id="Installing_id293417"></a><pre class="screen">$ <strong class="userinput"><code>sudo make install</code></strong>
$ <strong class="userinput"><code>sudo chown -R asteriskpbx:asteriskpbx /var/lib/asterisk/sounds/</code></strong></pre><p><a id="Installing_id293426"></a>The files will be downloaded,
        extracted, and installed into the appropriate location (<code class="filename">/var/lib/asterisk/sounds/&lt;language&gt;/</code>
        by default). Your Asterisk server will need to have a working Internet
        connection in order to retrieve the files.</p></div><div class="sect3" title="Scripting menuselect"><div class="titlepage"><div><div><h4 class="title"><a id="Installing_id293439"></a>Scripting menuselect</h4></div></div></div><p><a id="Installing_id293444"></a><a id="I_indexterm3_d1e8160" class="indexterm"></a><a id="I_indexterm3_d1e8167" class="indexterm"></a><a id="I_indexterm3_d1e8172" class="indexterm"></a>Administrators often build tools when performing
        installations on several machines, and Asterisk is no exception. If
        you need to install Asterisk onto several machines, you may wish to
        build a set of scripts to help automate this process. The
        <span class="command"><strong>menuselect</strong></span> system contains command-line options
        that you can use to enable or disable the modules that are built and
        installed by Asterisk.</p><p><a id="Installing_id293451"></a>If you are starting with a fresh
        checkout of Asterisk, you must first execute the
        <span class="command"><strong>configure</strong></span> script <a id="I_indexterm3_d1e8186" class="indexterm"></a><a id="I_indexterm3_d1e8189" class="indexterm"></a>in order to determine what dependencies are installed on
        the system. Then you need to build the <span class="command"><strong>menuselect</strong></span>
        application and run the <span class="command"><strong>make menuselect-tree</strong></span>
        command to build the initial tree structure:</p><p><a id="Installing_id293463"></a><a id="Installing_id293464"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8.<em class="replaceable"><code>&lt;your version&gt;</code></em>/</code></strong>
$ <strong class="userinput"><code>./configure</code></strong>
$ <strong class="userinput"><code>cd menuselect</code></strong>
$ <strong class="userinput"><code>make menuselect</code></strong>
$ <strong class="userinput"><code>cd ..</code></strong>
$ <strong class="userinput"><code>make menuselect-tree</code></strong>
<code class="computeroutput">Generating input for menuselect ...</code></pre><p>For
        details about the options available, run
        <span class="command"><strong>menuselect/menuselect --help</strong></span> from the top level of
        your Asterisk source directory. You will be returned output like the
        following:</p><p><a id="Installing_id293498"></a><a id="Installing_id293499"></a></p><pre class="screen">Usage: menuselect/menuselect [--enable &lt;option&gt;] [--disable &lt;option&gt;]
   [--enable-category &lt;category&gt;] [--enable-all]
   [--disable-category &lt;category&gt;] [--disable-all] [...]
   [&lt;config-file&gt; [...]]
Usage: menuselect/menuselect { --check-deps | --list-options
   | --list-category &lt;category&gt; | --category-list | --help }
   [&lt;config-file&gt; [...]]</pre><p>The options displayed can then be used
        to control which modules are installed via the
        <span class="command"><strong>menuselect</strong></span> application. For example, if you wanted
        to disable all modules and install a base system (which wouldn’t be of
        much use) you could use the command:</p><p><a id="Installing_id293511"></a><a id="Installing_id293512"></a></p><pre class="screen">$ <strong class="userinput"><code>menuselect/menuselect --disable-all menuselect.makeopts</code></strong></pre><p>If
        you then look at the <code class="filename">menuselect.makeopts</code> file,
        you will see a large amount of text that displays all the modules and
        categories that have been disabled. Let’s say you now want to enable
        the SIP channel and the <code class="literal">Dial()</code> application.
        Enabling those modules can be done with the following command, but
        before doing that look at the current
        <code class="filename">menuselect.makeopts</code> (after disabling all the
        modules) and locate <code class="literal">app_dial</code> in the
        <code class="literal">MENUSELECT_APPS</code> category and
        <code class="literal">chan_sip</code> in the
        <code class="literal">MENUSELECT_CHANNELS</code> category. After executing the
        following command, look at the
        <code class="filename">menuselect.makeopts</code> file again, and you will see
        that those modules are no longer listed:</p><p><a id="Installing_id293563"></a><a id="Installing_id293564"></a></p><pre class="screen">$ <strong class="userinput"><code>menuselect/menuselect --disable-all --enable chan_sip \
--enable app_dial menuselect.makeopts</code></strong></pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id293551"></a>The modules listed in the
            <code class="filename">menuselect.makeopts</code><a id="I_indexterm3_d1e8280" class="indexterm"></a> file are those that will not be built—modules that
            are not listed will be built when the <span class="command"><strong>make</strong></span>
            application is executed.</p></div><p>You can then build the
        <code class="filename">menuselect.makeopts</code> file in any way you want by
        utilizing the other commands, which will allow you to build custom
        installation scripts for your system using any scripting language you
        prefer.<a id="I_indexterm3_d1e8291" class="indexterm"></a><a id="I_indexterm3_d1e8292" class="indexterm"></a><a id="I_indexterm3_d1e8293" class="indexterm"></a><a id="I_indexterm3_d1e8294" class="indexterm"></a><a id="I_indexterm3_d1e8295" class="indexterm"></a></p></div></div></div><div class="sect1" title="Updating Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id292827"></a>Updating Asterisk</h2></div></div></div><p><a id="Installing_id292832"></a><a id="I_indexterm3_d1e8300" class="indexterm"></a><a id="I_indexterm3_d1e8305" class="indexterm"></a>If this is your first installation, you can skip ahead to
    the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_base_configuration" title="Base Configuration">the section called “Base Configuration”</a>. If you’re in
    the process of updating your system, however, there are a couple of things
    you should be aware of.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id292844"></a>When we say <span class="emphasis"><em>updating</em></span>
      your system, that is quite different from
      <span class="emphasis"><em>upgrading</em></span><a id="I_indexterm3_d1e8321" class="indexterm"></a> your system. Updating your system is the process of
      installing new minor versions of the same branch. For example, if your
      system is running Asterisk 1.8.2 and you need to upgrade to the latest
      bug fix version for the 1.8 branch, which was version 1.8.3, you’d be
      <span class="emphasis"><em>updating</em></span> your system to 1.8.3. In contrast, we use
      the term <span class="emphasis"><em>upgrade</em></span> to refer to changes between
      Asterisk branches (major version number increases). So, for example, an
      upgrade would be going from Asterisk 1.4.34 to Asterisk 1.8.0.</p></div><p><a id="Installing_id292853"></a>When performing an update, you follow the
    same instructions outlined in the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it" title="How to Install It">the section called “How to Install It”</a>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id426104"></a>Additionally, if you’ve checked out a
        new directory for this version of Asterisk (versus running
        <span class="command"><strong>svn up</strong></span> on a checked-out branch), and previously
        used <span class="emphasis"><em>menuselect</em></span> to tweak the modules to be
        compiled, you can copy the <code class="filename">menuselect.makeopts</code>
        file from one directory to another prior to running
        <span class="emphasis"><em>./configure</em></span>. By copying
        <code class="filename">menuselect.makeopts</code> from the old version to the
        new version, you save the step of having to (de)select all your
        modules again.</p></div><p> The basic steps are:</p><a id="Installing_id292862"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8.<em class="replaceable"><code>&lt;your version number&gt;</code></em>/</code></strong>
$ <strong class="userinput"><code>./configure</code></strong>
$ <strong class="userinput"><code>make</code></strong>
$ <strong class="userinput"><code><strong class="userinput"><code>make install</code></strong></code></strong></pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installing_id292883"></a>You don’t need to run <span class="command"><strong>sudo make
      install</strong></span> because we’ve already set the directory ownership to
      the <span class="emphasis"><em>asteriskpbx</em></span> user. You should be able to install
      new files directly into the appropriate directories.</p></div><p><a id="Installing_id292896"></a>Upon installation, however, you may get a
    message like the following:</p><a id="Installing_id292900"></a><pre class="screen"> WARNING WARNING WARNING

 Your Asterisk modules directory, located at
 /usr/lib/asterisk/modules
 contains modules that were not installed by this
 version of Asterisk. Please ensure that these
 modules are compatible with this version before
 attempting to run Asterisk.

    chan_mgcp.so
    chan_oss.so
    chan_phone.so
    chan_skinny.so
    chan_skype.so
    codec_g729a.so
    res_skypeforasterisk.so

 WARNING WARNING WARNING</pre><p><a id="Installing_id292910"></a>This warning message <a id="I_indexterm3_d1e8386" class="indexterm"></a>is indicating that modules installed in the
    <code class="filename">/usr/lib/asterisk/modules/</code> directory are not
    compatible with the version you’ve just installed. This most often occurs
    when you have installed modules in one version of Asterisk, and then
    installed a new version of Asterisk without compiling those modules (as
    the installation process will overwrite any modules that existed
    previously, replacing them with their upgraded versions).</p><p><a id="Installing_id292920"></a>To get around the warning message, you can
    clear out the <code class="filename">/usr/lib/asterisk/modules/</code> directory
    prior to running <span class="emphasis"><em>make install</em></span>. There is a caveat
    here, though: if you’ve installed third-party modules, such as commercial
    modules from Digium (including <code class="literal">chan_skype</code>,
    <code class="literal">codec_g729a</code>, etc.), you will need to reinstall those if
    you’ve cleared out your modules directory.</p><p><a id="Installing_id292937"></a>It is recommended that you keep a directory
    with your third-party modules in it that you can reinstall from upon
    update of your Asterisk system. So, for example, you might create the
    <code class="filename">/usr/src/asterisk-complete/thirdparty/1.8</code> directory
    as follows:</p><a id="Installing_id292945"></a><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/</code></strong>
$ <strong class="userinput"><code>mkdir thirdparty/</code></strong>
$ <strong class="userinput"><code>mkdir thirdparty/1.8/</code></strong></pre><p><a id="Installing_id292956"></a>Downloading third-party modules into this
    directory allows you to easily reinstall those modules when you upgrade.
    Just follow the installation instructions for your module, many of which
    will be as simple as rerunning <span class="command"><strong>make install</strong></span> from the
    <span class="emphasis"><em>modules</em></span> source directory or copying the precompiled
    binary to the <code class="filename">/usr/lib/asterisk/modules/</code>
    directory.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Installing_id292972"></a>Be sure to change the file permissions to
      match those of the user running Asterisk!</p></div></div><div class="sect1" title="Common Issues"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id294543"></a>Common Issues</h2></div></div></div><p><a id="Installing_id294548"></a><a id="index-656W741VF7U" class="indexterm"></a>In this section we’re going to cover some common issues you
    may run into while compiling Asterisk, DAHDI, or LibPRI. Most of the
    issues you’ll run into have to do with missing dependencies. If that is
    the case, please review <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies" title="Software Dependencies">the section called “Software Dependencies”</a> to make
    sure you’ve installed everything you need.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installing_id294560"></a>Any time you install additional packages,
      you will need to run the <span class="command"><strong>./configure</strong></span> script in your Asterisk
      source in order for the new package to be detected.</p></div><div class="sect2" title="-bash: wget: command not found"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294571"></a>-bash: wget: command not found</h3></div></div></div><p><a id="Installing_id294576"></a><a id="I_indexterm3_d1e8459" class="indexterm"></a>This message means you have not installed the
      <span class="command"><strong>wget</strong></span> application, which is required for you to
      download packages from the Asterisk downloads site, for Asterisk to
      download sound files, or for DAHDI to download firmware for
      hardware.</p><div class="informaltable"><a id="Installing_id294582"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu&nbsp;</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install
              wget</code></strong></td><td>$ <strong class="userinput"><code>sudo yum -y install wget</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="configure: error: no acceptable C compiler found in $PATH"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294625"></a>configure: error: no acceptable C compiler found in $PATH</h3></div></div></div><p><a id="Installing_id294631"></a>This means that the Asterisk
      <span class="command"><strong>configure</strong></span> script is unable to find your C compiler,
      which typically means you have not yet installed one. Be sure to install
      the <span class="command"><strong>gcc</strong></span> package for your system.</p><div class="informaltable"><a id="Installing_id294636"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install gcc</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install gcc</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="make: gcc: command not found"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294679"></a>make: gcc: command not found</h3></div></div></div><p><a id="Installing_id294684"></a>This means that the Asterisk
      <span class="command"><strong>configure</strong></span> script is unable to find your C compiler,
      which typically means you have not yet installed one. Be sure to install
      the <span class="command"><strong>gcc</strong></span> package for your system.</p><div class="informaltable"><a id="Installing_id294689"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install gcc</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install gcc</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="configure: error: C++ preprocessor “/lib/cpp” fails sanity check"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294733"></a>configure: error: C++ preprocessor “/lib/cpp” fails sanity
      check</h3></div></div></div><p><a id="Installing_id294739"></a>This error is presented by the Asterisk
      <span class="command"><strong>configure</strong></span> script when you have not installed the GCC
      C++ preprocessor.</p><div class="informaltable"><a id="Installing_id294743"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install g++</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install gcc-c++</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="configure: error: *** Please install GNU make. It is required to build Asterisk!"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294786"></a>configure: error: *** Please install GNU make. It is required to
      build Asterisk!</h3></div></div></div><p><a id="Installing_id294792"></a>This error is encountered when you have
      not installed the <span class="command"><strong>make</strong></span> application, which is required
      to build Asterisk.</p><div class="informaltable"><a id="Installing_id294800"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install
              make</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install make</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="configure: *** XML documentation will not be available because the ‘libxml2’ development package is missing."><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294844"></a>configure: *** XML documentation will not be available because
      the ‘libxml2’ development package is missing.</h3></div></div></div><p><a id="Installing_id294850"></a>You will encounter this error when the
      XML parser libraries are not installed. These are required by Asterisk
      1.8 and later, since console documentation (e.g., when you run
      <span class="command"><strong>core show application dial</strong></span> on the Asterisk CLI) is
      generated from XML.</p><div class="informaltable"><a id="Installing_id294858"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install
              libxml2-dev</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install
              libxml2-devel</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="configure: error: *** termcap support not found"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294901"></a>configure: error: *** termcap support not found</h3></div></div></div><p><a id="Installing_id294907"></a>This error happens when you don’t have
      the <code class="literal">ncurses</code> development library installed, which is
      required by <span class="command"><strong>menuselect</strong></span> and for other console output
      in Asterisk.</p><div class="informaltable"><a id="Installing_id294911"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install
              ncurses-dev</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install
              ncurses-devel</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="You do not appear to have the sources for the 2.6.18-164.6.1.el5 kernel installed."><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id294955"></a>You do not appear to have the sources for the 2.6.18-164.6.1.el5
      kernel installed.</h3></div></div></div><p><a id="Installing_id294961"></a>You will get this error when attempting
      to build DAHDI without having installed the Linux headers, which are
      required for building Linux drivers.</p><div class="informaltable"><a id="Installing_id294966"></a><table border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Ubuntu</th><th align="center">CentOS&nbsp;</th></tr></thead><tbody><tr><td>$ <strong class="userinput"><code>sudo apt-get install linux-headers-`uname
              -r`</code></strong></td><td>$ <strong class="userinput"><code>sudo yum install
              kernel-devel</code></strong></td></tr></tbody></table></div></div><div class="sect2" title="E: Unable to lock the administration directory (/var/lib/dpkg/), are you root?"><div class="titlepage"><div><div><h3 class="title"><a id="Installing_id295010"></a>E: Unable to lock the administration directory (/var/lib/dpkg/),
      are you root?</h3></div></div></div><p><a id="Installing_id295016"></a>If you encounter this error it’s likely
      that you forgot to prepend <span class="command"><strong>sudo</strong></span> to the start of the
      command you were running, which requires root permissions.<a id="I_indexterm3_d1e8681" class="indexterm"></a></p></div></div><div class="sect1" title="Upgrading Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id36058887"></a>Upgrading Asterisk</h2></div></div></div><p><a id="Installing_id426812"></a><a id="I_indexterm3_d1e8686" class="indexterm"></a>Upgrading Asterisk between major versions, such as from 1.2
    to 1.4 or from 1.6.2 to 1.8 is akin to upgrading an operating system. Once
    a phone switch is in production, it is terribly disruptive for that system
    to be unavailable for nearly any length of time, and the upgrade of that
    phone system needs to be well thought-out, planned, and tested as much as
    possible prior to deployment. And because every deployment is different,
    it is difficult, if not impossible, for us to walk you through a real
    system upgrade. However, we can certainly point you in the right direction
    for the information you require in order to perform such an upgrade,
    thereby giving you the tools you need to be successful.</p><p><a id="Installing_id426822"></a>A production Asterisk system should never
    be upgraded between major versions without first deploying it into a
    development environment where the existing configuration files can be
    tested and reviewed against new features and syntax changes between
    versions. For example, it may be that your dialplan relies on a deprecated
    command and should be updated to use a new command that contains more
    functionality, has a better code base, and will be updated on a more
    regular basis. Commands that are deprecated are typically left in the code
    for backward-compatibility, but issues reported about these deprecated
    commands will be given lower priority than issues to do with the newer
    preferred methods.</p><p><a id="Installing_id426831"></a>There exist two files that should be read
    prior to any system upgrade: <code class="filename">CHANGES</code><a id="I_indexterm3_d1e8698" class="indexterm"></a> and <code class="filename">UPGRADE.txt</code><a id="I_indexterm3_d1e8704" class="indexterm"></a>, which are shipped with the Asterisk source code. These
    files contain details on changes to syntax and other things to be aware of
    when upgrading between major versions. The files are broken into different
    sections that reference things such as dialplan syntax changes, channel
    driver syntax changes, functionality changes, and deprecation of
    functionality, with suggestions that you update your configuration files
    to use the new methods.</p><p><a id="Installing_id426845"></a>Another thing to consider when performing
    an upgrade is whether you really need to perform the upgrade in the first
    place. If you’re using a long-term support (LTS)<sup>[<a id="id527165" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id527165" class="footnote">40</a>]</sup> version of Asterisk and that version is happily working
    along for you, perhaps there is no reason to upgrade your existing
    production system. An alternative to upgrading the entire system is simply
    to add functionality to your system by running two versions simultaneously
    on separate systems. By running separate boxes, you can access the
    functionality added to a later version of Asterisk without having to
    disrupt your existing production system. You can then perform the
    migration more gradually, rather than doing a complete system upgrade
    instantly.</p><p><a id="Installing_id426868"></a><a id="I_indexterm3_d1e8718" class="indexterm"></a>Two parts of Asterisk should be thoroughly tested when
    performing an upgrade between major versions: the <a id="I_indexterm3_d1e8724" class="indexterm"></a>Asterisk Manager Interface (AMI) and the Asterisk Gateway
    Interface (AGI)<a id="I_indexterm3_d1e8728" class="indexterm"></a>.</p><p><a id="Installing_id350078"></a>These two parts of Asterisk rely on testing
    your code to make sure any cleanup of syntax changes in either the AMI or
    the AGI, or added functionality, does not interfere with your existing
    code. By performing a code audit on what your program is expecting to send
    or receive against what actually happens, you can save yourself a headache
    down the road.</p><p><a id="Installing_id426875"></a>The testing of <a id="I_indexterm3_d1e8736" class="indexterm"></a><a id="I_indexterm3_d1e8741" class="indexterm"></a>call detail records (CDRs) is also quite important,
    especially if they are relied upon for billing. The entire CDR structure
    is really designed for simple call flows, but it is often employed in
    complex call flows, and when someone reports an issue to the tracker and
    it is fixed, it can sometimes have an effect on others who are relying on
    the same functionality for different purposes. Asterisk 1.8 now includes
    channel event logging (CEL), which is a system designed to get around some
    of the limitations of CDR in more complex call flows (such as those that
    involve transfers, etc.). More information about CEL is available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246945" title="CEL (Channel Event Logging)">the section called “CEL (Channel Event Logging)”</a>.</p><p><a id="Installing_id426889"></a>Upgrading Asterisk can be a successful
    endeavor as long as sufficient planning and testing are carried out prior
    to the full rollout. In some cases migrating to a separate physical
    machine on which you’ve performed testing is preferred, as it can give you
    a system to roll back to in case of some failure that can’t be resolved
    immediately. It’s the planning, and particularly having a backup plan,
    that is the most important aspect of an Asterisk upgrade.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Installing_id295025"></a>Conclusion</h2></div></div></div><p><a id="Installing_id295030"></a>In this chapter we looked at how to install
    an operating system (one of Ubuntu or CentOS) and Asterisk itself. We did
    this securely by installing via <span class="command"><strong>sudo</strong></span> and running
    Asterisk as the non-root user <span class="emphasis"><em>asteriskpbx</em></span>. We are
    well on our way to building a functional Asterisk system that will serve
    us well. In the following chapters we will explore how to connect devices
    to our Asterisk system in order to start placing calls internally and how
    to connect Asterisk to outside services in order to place phone calls to
    endpoints connected to the PSTN and accept calls from those
    endpoints.<a id="I_indexterm3_d1e8762" class="indexterm"></a><a id="I_indexterm3_d1e8763" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id515960" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id515960" class="para">17</a>] </sup>If you are using another distribution, we’re willing to bet you
      are quite comfortable with Linux and should have no trouble installing
      Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id515977" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id515977" class="para">18</a>] </sup>Leif calls this “Oh-Eh-Sex,” but Jim thinks it should be
      pronounced “OS Ten.” We wasted several precious minutes arguing about
      this.</p></div><div class="footnote"><p><sup>[<a id="ftn.id516270" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id516270" class="para">19</a>] </sup>After you read our book, of course.</p></div><div class="footnote"><p><sup>[<a id="ftn.id516312" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id516312" class="para">20</a>] </sup>Once you have experience with several Asterisk installations,
        you’ll agree that it’s a quick and painless process. Nevertheless,
        this chapter may make the process look complex. This is simply because
        we have an obligation to ensure you are provided with all the
        information you need to accomplish a successful install.</p></div><div class="footnote"><p><sup>[<a id="ftn.id517693" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id517693" class="para">21</a>] </sup>Actually, some people have great success running Asterisk
          inside virtual machines. It does depend what you’re planning on
          using it for though, as you’ll have limited access to hardware, for
          example.</p></div><div class="footnote"><p><sup>[<a id="ftn.id517753" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id517753" class="para">22</a>] </sup>You should test the media the first time you are using that
            particular CD/DVD.</p></div><div class="footnote"><p><sup>[<a id="ftn.id517790" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id517790" class="para">23</a>] </sup>Bear in mind that Asterisk is developed using the US
            keyboard and language, and we’re not aware of any testing having
            been done on anything other than US English.</p></div><div class="footnote"><p><sup>[<a id="ftn.id517888" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id517888" class="para">24</a>] </sup>Due to the ever-increasing size of hard drives, capacity is
            becoming less of a problem. A system with a <span class="keep-together">1 terabyte</span> drive can store somewhere
            in the range of 2 million minutes of telephony-quality
            recordings.</p></div><div class="footnote"><p><sup>[<a id="ftn.id518326" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id518326" class="para">25</a>] </sup>This reboot step is essential prior to installing
            Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id518633" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id518633" class="para">26</a>] </sup><span class="command"><strong>sudo</strong></span> is an application that allows a user
            to execute commands as another user, such as root, or the
            superuser.</p></div><div class="footnote"><p><sup>[<a id="ftn.id519147" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id519147" class="para">27</a>] </sup>Of course, projects can change their websites whenever they
          want. Hopefully the instructions we’ve provided here are accurate
          enough to help guide you through the site even in the event of
          changes.</p></div><div class="footnote"><p><sup>[<a id="ftn.id519457" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id519457" class="para">28</a>] </sup>Ubuntu has reserved the username
            <span class="emphasis"><em>asterisk</em></span> internally.</p></div><div class="footnote"><p><sup>[<a id="ftn.id519514" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id519514" class="para">29</a>] </sup>While we say Asterisk here, specifically it is DAHDI that is
            the problem. DAHDI is a set of Linux kernel modules used with
            Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id519913" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id519913" class="para">30</a>] </sup>If you’re already familiar with another editor, go ahead and
            use it. The <span class="command"><strong>nano</strong></span> editor has been selected for
            its ease of use and its handy on-screen instructions. We even know
            a developer at Digium who uses it while writing code for Asterisk,
            though most people tend to use more complex editors such as
            <span class="command"><strong>emacs</strong></span> or <span class="command"><strong>vim</strong></span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id521113" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id521113" class="para">31</a>] </sup>Strictly speaking, if you are not going to be using any
              ISDN connections (BRI and PRI), you can install Asterisk without
              LibPRI. However, we are going to install it for the sake of
              completeness.</p></div><div class="footnote"><p><sup>[<a id="ftn.id521133" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id521133" class="para">32</a>] </sup>This package contains the kernel drivers to allow Asterisk
              to connect to traditional PSTN circuits. It is also required for
              the <code class="literal">MeetMe()</code> conferencing application. Again,
              we will install this for completeness.</p></div><div class="footnote"><p><sup>[<a id="ftn.id521158" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id521158" class="para">33</a>] </sup>If you don’t install this, none of the examples in this
              book will work, but it could still make a great bathroom reader.
              Just sayin’.</p></div><div class="footnote"><p><sup>[<a id="ftn.id523106" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id523106" class="para">34</a>] </sup>If your <code class="filename">/etc/asterisk/</code> folder has files
          in it already, move those files to another directory, or delete them
          if you are sure you don’t need what is there.</p></div><div class="footnote"><p><sup>[<a id="ftn.id523210" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id523210" class="para">35</a>] </sup><code class="filename">/usr/src/asterisk-complete/asterisk/asterisk-1.8.&lt;your
            version&gt;/</code></p></div><div class="footnote"><p><sup>[<a id="ftn.id523516" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id523516" class="para">36</a>] </sup>So minimal, in fact, that it’s completely useless at this
            point. But we digress.</p></div><div class="footnote"><p><sup>[<a id="ftn.id524730" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id524730" class="para">37</a>] </sup>A good way to put the final touches on your new system is to
            install some appropriate sound files to be used as music on hold.
            There are only three songs installed by default, and callers will
            quickly tire of listening to the same three songs over and over
            again. We’ll discuss this more in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file" title="musiconhold.conf">the section called “musiconhold.conf”</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id525285" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id525285" class="para">38</a>] </sup>Which we will cover in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>,
              along with many other cool things.</p></div><div class="footnote"><p><sup>[<a id="ftn.id525395" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id525395" class="para">39</a>] </sup>If you want to understand all about mu-law and A-law, you
            can read the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.4" title="Logarithmic companding">the section called “Logarithmic companding”</a>. All you
            need to know here is that outside of North America and Japan,
            A-law is used.</p></div><div class="footnote"><p><sup>[<a id="ftn.id527165" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id527165" class="para">40</a>] </sup>More information about Asterisk releases and their support
        schedule is available at <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+Versions" target="_top">https://wiki.asterisk.org/wiki/display/AST/Asterisk+Versions</a>.</p></div></div></div><div class="chapter" title="Chapter 4. Initial Configuration Tasks"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Initial"></a>Chapter&nbsp;4.&nbsp;Initial Configuration Tasks</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file">asterisk.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id291715">indications.conf</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241164">CentOS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241193">Ubuntu</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241229">Completing file conversion</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260414">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="InitialConfig_id292365"></a>Careful. We don’t want to learn from
    this.</p><div class="attribution"><span>—<span class="attribution">Calvin &amp; Hobbes</span></span></div></div><p><a id="InitialConfig_id290041"></a><a id="index-818T185TL1T" class="indexterm"></a><a id="index-228J405GC3H" class="indexterm"></a>In the last chapter, we covered how to install Asterisk. But
  where should you get started with configuration? That is the question this
  chapter answers. There are a few common configuration files that are
  relevant regardless of what you are using Asterisk to accomplish. In some
  cases they may not require any modification, but you need to be aware of
  them.</p><div class="sect1" title="asterisk.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="additional_configuration_tasks-asterisk-conf-file"></a>asterisk.conf</h2></div></div></div><p><a id="InitialConfig_id259056"></a><a id="I_indexterm4_d1e8786" class="indexterm"></a><a id="I_indexterm4_d1e8791" class="indexterm"></a>The <code class="filename">asterisk.conf</code>
    configuration file allows you to tweak various settings that can affect
    how Asterisk runs as a whole.</p><p><a id="InitialConfig_id259061"></a>There is a sample <code class="filename">asterisk.conf</code> file included with the Asterisk
    source. It is not necessary to have this file in your <code class="filename">/etc/asterisk</code> folder in order to have a working
    system, but you may find that some of the possible options will be of use
    to you.</p><p><a id="InitialConfig_id259066"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InitialConfig_id259069"></a><a id="I_indexterm4_d1e8809" class="indexterm"></a>Asterisk will look for <code class="filename">asterisk.conf</code> in the default configuration
        location, which is usually <code class="filename">/etc/asterisk</code>. To specify a different
        location for <code class="filename">asterisk.conf</code>, use
        the <span class="command"><strong>-C</strong></span> command-line option:</p><a id="I_programlisting4_d1e8827"></a><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo asterisk -C /custom/path/to/asterisk.conf</code></strong></pre></div><div class="sect2" title="The [directories] Section"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id259095"></a>The [directories] Section</h3></div></div></div><p><a id="InitialConfig_id259104"></a><a id="I_indexterm4_d1e8837" class="indexterm"></a>For most installations of Asterisk, changing the
      directories is not necessary. However, this can be useful for running
      more than one instance of Asterisk at the same time, or if you would
      like files stored in nonstandard locations.</p><p><a id="InitialConfig_id259109"></a>The default directory locations and
      the options you can use to modify them are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259222" title="Table 4.1. asterisk.conf [directories] section">Table&nbsp;4.1, “asterisk.conf [directories] section”</a>. For additional information about
      the usage of these directories, see the <a class="link" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#file_structure" title="File Structure">File Structure</a> section of <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch" title="Chapter 2. Asterisk Architecture">Chapter&nbsp;2, <em>Asterisk Architecture</em></a>.</p><div class="table"><a id="InitialConfig_id259222"></a><p class="title"><strong>Table&nbsp;4.1.&nbsp;asterisk.conf [directories] section</strong></p><div class="table-contents"><table summary="asterisk.conf [directories] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td>astetcdir</td><td><code class="literal"><a id="I_indexterm4_d1e8868" class="indexterm"></a>/etc/asterisk</code></td><td>The location where the Asterisk configuration files are
              stored.</td></tr><tr><td>astmoddir</td><td><code class="literal"><a id="I_indexterm4_d1e8879" class="indexterm"></a>/usr/lib/asterisk/modules</code></td><td>The location where loadable modules are stored.</td></tr><tr><td>astvarlibdir</td><td><code class="literal"><a id="I_indexterm4_d1e8890" class="indexterm"></a>/var/lib/asterisk</code></td><td>The base location for variable state information used by
              various parts of Asterisk. This includes items that are written
              out by Asterisk at <span class="keep-together">runtime</span>.</td></tr><tr><td>astdbdir</td><td><code class="literal"><a id="I_indexterm4_d1e8904" class="indexterm"></a>/var/lib/asterisk</code></td><td>Asterisk will store its internal database in this
              directory as a file called <code class="filename">astdb</code>.</td></tr><tr><td>astkeydir</td><td><code class="literal"><a id="I_indexterm4_d1e8918" class="indexterm"></a>/var/lib/asterisk</code></td><td>Asterisk will use a subdirectory called <code class="filename">keys</code> in this directory as the default
              location for loading keys for encryption.</td></tr><tr><td>astdatadir</td><td><code class="literal"><a id="I_indexterm4_d1e8932" class="indexterm"></a>/var/lib/asterisk</code></td><td>This is the base directory for system-provided data, such
              as the sound files that come with Asterisk.</td></tr><tr><td>astagidir</td><td><a id="I_indexterm4_d1e8942" class="indexterm"></a> <code class="literal">/var/lib/asterisk/</code> <code class="literal">agi-bin</code></td><td>Asterisk will use a subdirectory called <code class="filename">agi-bin</code> in this directory as the
              default location for loading AGI scripts.</td></tr><tr><td>astspooldir</td><td><code class="literal"><a id="I_indexterm4_d1e8959" class="indexterm"></a>/var/spool/asterisk</code></td><td>The Asterisk spool directory, where voicemail, call
              recordings, and the call origination spool are stored.</td></tr><tr><td>astrundir</td><td><code class="literal"><a id="I_indexterm4_d1e8970" class="indexterm"></a>/var/run/asterisk</code></td><td>The location where Asterisk will write out its UNIX
              control socket as well as its process ID (PID) file.</td></tr><tr><td>astlogdir</td><td><code class="literal"><a id="I_indexterm4_d1e8981" class="indexterm"></a>/var/log/asterisk</code></td><td>The directory where Asterisk will store its log
              files.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="The [options] Section"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id259425"></a>The [options] Section</h3></div></div></div><p><a id="InitialConfig_id259434"></a><a id="I_indexterm4_d1e8991" class="indexterm"></a>This section of the <code class="filename">asterisk.conf</code> file configures defaults for
      global runtime options. The available options are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259444" title="Table 4.2. asterisk.conf [options] section">Table&nbsp;4.2, “asterisk.conf [options] section”</a>. Most of these are also controllable
      via <span class="keep-together">command</span>-line parameters to the
      <span class="application"><span class="emphasis"><em>asterisk</em></span></span>
      application. For a complete list of the <span class="keep-together">command</span>-line options that relate to these
      options, see the Asterisk manpage:</p><a id="InitialConfig_id326938"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>man asterisk</code></strong></pre><div class="table"><a id="InitialConfig_id259444"></a><p class="title"><strong>Table&nbsp;4.2.&nbsp;asterisk.conf [options] section</strong></p><div class="table-contents"><table summary="asterisk.conf [options] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td>verbose</td><td><code class="literal"><a id="I_indexterm4_d1e9035" class="indexterm"></a>3</code></td><td>Sets the default verbose setting for the Asterisk logger.
              This value is also set by the <span class="command"><strong>-v</strong></span> command-line option. The verbose
              level is <code class="literal">0</code> by
              default.</td></tr><tr><td>debug</td><td><code class="literal"><a id="I_indexterm4_d1e9052" class="indexterm"></a>3</code></td><td>Sets the default debug setting for the Asterisk logger.
              This value is also set by the <span class="command"><strong>-d</strong></span> command-line option. The debug
              level is <code class="literal">0</code> by
              default.</td></tr><tr><td>alwaysfork</td><td><code class="literal"><a id="I_indexterm4_d1e9069" class="indexterm"></a>yes</code></td><td>Forking forces Asterisk to always run in the background.
              This option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>nofork</td><td><code class="literal"><a id="I_indexterm4_d1e9083" class="indexterm"></a>yes</code></td><td>Forces Asterisk to always run in the foreground. This
              option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>quiet</td><td><code class="literal"><a id="I_indexterm4_d1e9097" class="indexterm"></a>yes</code></td><td>Quiet mode reduces the amount of output seen at the
              console when Asterisk is run in the foreground. This option is
              set to <code class="literal">no</code> by default.</td></tr><tr><td>timestamp</td><td><code class="literal"><a id="I_indexterm4_d1e9111" class="indexterm"></a>yes</code></td><td>Adds timestamps to all output except output from a CLI
              command. This option is set to <code class="literal">no</code> by default.</td></tr><tr><td>execincludes</td><td><code class="literal"><a id="I_indexterm4_d1e9125" class="indexterm"></a>yes</code></td><td>Enables the use of <code class="literal">#exec</code> in Asterisk configuration files.
              This option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>console</td><td><code class="literal"><a id="I_indexterm4_d1e9142" class="indexterm"></a>yes</code></td><td>Runs Asterisk in console mode. Asterisk will run in the
              foreground and will present a prompt for CLI commands. This
              option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>highpriority</td><td><code class="literal"><a id="I_indexterm4_d1e9156" class="indexterm"></a>yes</code></td><td>Runs the Asterisk application with real-time priority.
              This option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>initcrypto</td><td><code class="literal"><a id="I_indexterm4_d1e9170" class="indexterm"></a>yes</code></td><td>Loads keys from the <code class="literal">astkeydir</code> at startup. This option is
              set to <code class="literal">no</code> by
              default.<sup>[<a id="id528492" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id528492" class="footnote">a</a>]</sup></td></tr><tr><td>nocolor</td><td><code class="literal"><a id="I_indexterm4_d1e9193" class="indexterm"></a>yes</code></td><td>Suppresses color output from the Asterisk console. This
              is useful when saving console output to a file. This option is
              set to <code class="literal">no</code> by default.</td></tr><tr><td>dontwarn</td><td><code class="literal"><a id="I_indexterm4_d1e9208" class="indexterm"></a>yes</code></td><td>Disables a few warning messages. This option was put in
              place to silence warnings that are generally correct, but may be
              considered to be so obvious that they become an annoyance. This
              option is set to <code class="literal">no</code> by
              default.</td></tr><tr><td>dumpcore</td><td><code class="literal"><a id="I_indexterm4_d1e9222" class="indexterm"></a>yes</code></td><td>Tells Asterisk to generate a core dump in the case of a
              crash. This option is set to <code class="literal">no</code> by default.<sup>[<a id="id528614" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id528614" class="footnote">b</a>]</sup></td></tr><tr><td>languageprefix</td><td><code class="literal"><a id="I_indexterm4_d1e9245" class="indexterm"></a>yes</code></td><td>Configures how the prompt language is used in building
              the path for a sound file. By default, this is <code class="literal">yes</code>, which places the language before
              any subdirectories, such as <code class="filename">en/digits/1.gsm</code>. Setting this option
              to <code class="literal">no</code> causes Asterisk to
              behave as it did in previous versions, placing the language as
              the last directory in the path, (e.g. <code class="filename">digits/en/1.gsm</code>).</td></tr><tr><td>internal_timing</td><td><code class="literal"><a id="I_indexterm4_d1e9268" class="indexterm"></a>yes</code></td><td>Uses a timing source to synchronize audio that will be
              sent out to a channel in cases such as file playback or music on
              hold. This option is set to <code class="literal">yes</code> by default and should be left that
              way; its usefulness has greatly diminished over the last few
              major versions of Asterisk.</td></tr><tr><td>systemname</td><td><a id="I_indexterm4_d1e9281" class="indexterm"></a> <code class="literal">my_</code> <code class="literal">system</code> <code class="literal">_name</code></td><td>Gives this instance of Asterisk a unique name. When this
              has been set, the system name will be used as part of the
              <code class="literal">uniqueid</code> field for channels.
              This is incredibly useful if more than one system will be
              logging CDRs to the same database table. By default, this option
              is not set.</td></tr><tr><td>autosystemname</td><td><code class="literal"><a id="I_indexterm4_d1e9300" class="indexterm"></a>yes</code></td><td>Automatically sets the system name by using the hostname
              of the system. This option is set to <code class="literal">no</code> by default.</td></tr><tr><td>maxcalls</td><td><code class="literal"><a id="I_indexterm4_d1e9314" class="indexterm"></a>100</code></td><td>Sets a maximum number of simultaneous inbound channels.
              No limit is set by default.</td></tr><tr><td>maxload</td><td><code class="literal"><a id="I_indexterm4_d1e9325" class="indexterm"></a>0.9</code></td><td>Sets a maximum load average. If the load average is at or
              above this threshold, Asterisk will not accept new calls. No
              threshold is set by default.</td></tr><tr><td>maxfiles</td><td><code class="literal"><a id="I_indexterm4_d1e9336" class="indexterm"></a>1000</code></td><td>Set the maximum number of file descriptors that Asterisk
              is allowed to have open. The default limit imposed by the system
              is commonly 1024, which is not enough for heavily loaded
              systems. It is common to set this limit to a very high number.
              The default system-imposed limit is used by default.</td></tr><tr><td>minmemfree</td><td><code class="literal"><a id="I_indexterm4_d1e9347" class="indexterm"></a>1</code></td><td>Sets the minimum number of megabytes of free memory
              required for Asterisk to continue accepting calls. If Asterisk
              detects that there is less free memory available than this
              threshold, new calls will not be accepted. This option is not
              set by default.</td></tr><tr><td>cache_record_files</td><td><code class="literal"><a id="I_indexterm4_d1e9358" class="indexterm"></a>yes</code></td><td>When doing recording, stores the file in the <code class="literal">record_cache_dir</code> until recording is
              complete. Once complete, it will be moved into the originally
              specified destination. The default for this option is <code class="literal">no</code>.</td></tr><tr><td><span class="keep-together">record_cache_dir</span></td><td><code class="literal"><a id="I_indexterm4_d1e9377" class="indexterm"></a>/tmp</code></td><td>Sets the directory to be used when <code class="literal">cache_record_files</code> is set to <code class="literal">yes</code>. The default location is a
              directory called <code class="filename">tmp</code> within
              the <code class="literal">astspooldir</code>.</td></tr><tr><td>transmit_silence</td><td><code class="literal"><a id="I_indexterm4_d1e9400" class="indexterm"></a>yes</code></td><td>Transmits silence to the caller in cases where there is
              no other audio source. This includes call recording and the
              <code class="literal">Wait()</code> family of dialplan
              applications, among other things. The default for this option is
              <code class="literal">no</code>.<sup>[<a id="id529076" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id529076" class="footnote">c</a>]</sup></td></tr><tr><td>transcode_via_sln</td><td><code class="literal"><a id="I_indexterm4_d1e9420" class="indexterm"></a>yes</code></td><td>When building a codec translation path, forces signed
              linear to be one of the steps in the path. The default for this
              option is <code class="literal">yes</code>.</td></tr><tr><td>runuser</td><td><code class="literal"><a id="I_indexterm4_d1e9434" class="indexterm"></a>asterisk</code></td><td>Sets the system user that the Asterisk application should
              run as. This option is not set by default, meaning that the
              application will continue to run as the user that executed the
              application.</td></tr><tr><td>rungroup</td><td><code class="literal"><a id="I_indexterm4_d1e9445" class="indexterm"></a>asterisk</code></td><td>Sets the system group that the Asterisk application
              should run as. This option is not set by default.</td></tr><tr><td>lightbackground</td><td><code class="literal"><a id="I_indexterm4_d1e9456" class="indexterm"></a>yes</code></td><td>When using colors in the Asterisk console, it will output
              colors that are compatible with a light-colored background. This
              option is set to <code class="literal">no</code> by
              default, in which case Asterisk uses colors that look best on a
              black background.</td></tr><tr><td>documentation_language</td><td><code class="literal"><a id="I_indexterm4_d1e9470" class="indexterm"></a>en_US</code></td><td>The built-in documentation for Asterisk applications,
              functions, and other things is included in an external XML
              document. This option specifies the preferred language for
              documentation. If it is not available, the default of <code class="literal">en_US</code> will be used.</td></tr><tr><td>hideconnect</td><td><code class="literal"><a id="I_indexterm4_d1e9484" class="indexterm"></a>yes</code></td><td>Setting this option to <code class="literal">yes</code> causes Asterisk to not display
              notifications of remote console connections and disconnections
              at the Asterisk CLI. This is useful on systems where there are
              scripts that use remote consoles heavily. The default setting is
              <code class="literal">no</code>.</td></tr><tr><td>lockconfdir</td><td><code class="literal"><a id="I_indexterm4_d1e9501" class="indexterm"></a>no</code></td><td>When this option is enabled, the Asterisk configuration
              directory will be protected with a lock. This helps protect
              against having more than one application attempting to write to
              the same file at the same time. The default value is <code class="literal">no</code>.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id528492" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id528492" class="para">a</a>] </sup>If any of the keys require
                  a passphrase, this will block the startup process of
                  Asterisk. An alternative is to run <span class="command"><strong>keys init</strong></span> at the Asterisk command
                  line.</p></div><div class="footnote"><p><sup>[<a id="ftn.id528614" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id528614" class="para">b</a>] </sup>This is critical for
                  debugging crashes. However, Asterisk must be compiled with
                  the <code class="literal">DONT_OPTIMIZE</code> option
                  enabled in <span class="command"><strong>menuselect</strong></span> for
                  the core dump to be useful.</p></div><div class="footnote"><p><sup>[<a id="ftn.id529076" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id529076" class="para">c</a>] </sup>There is an important
                  caveat to note when this option is enabled. The silence is
                  generated in uncompressed signed linear format, which means
                  that it will have to be transcoded into the format that the
                  caller’s channel expects. The result may be that transcoding
                  is required for a call that would not normally require
                  it.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="The [files] Section"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id260138"></a>The [files] Section</h3></div></div></div><p><a id="InitialConfig_id260146"></a>This section of <code class="filename">asterisk.conf</code> includes options related to the
      Asterisk control socket. It is primarily used by remote consoles
      (<span class="command"><strong>asterisk -r</strong></span>). The available options
      are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260157" title="Table 4.3. asterisk.conf [files] section">Table&nbsp;4.3, “asterisk.conf [files] section”</a>.</p><div class="table"><a id="InitialConfig_id260157"></a><p class="title"><strong>Table&nbsp;4.3.&nbsp;asterisk.conf [files] section</strong></p><div class="table-contents"><table summary="asterisk.conf [files] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td>astctlpermissions</td><td><code class="literal"><a id="I_indexterm4_d1e9541" class="indexterm"></a>0660</code></td><td>Sets the permissions for the Asterisk control
              socket.</td></tr><tr><td>astctlowner</td><td><code class="literal"><a id="I_indexterm4_d1e9552" class="indexterm"></a>root</code></td><td>Sets the owner for the Asterisk control socket.</td></tr><tr><td>astctlgroup</td><td><code class="literal"><a id="I_indexterm4_d1e9563" class="indexterm"></a>apache</code></td><td>Sets the group for the Asterisk control socket.</td></tr><tr><td>astctl</td><td><code class="literal"><a id="I_indexterm4_d1e9574" class="indexterm"></a>asterisk.ctl</code></td><td>Sets the filename for the Asterisk control socket. The
              default is <code class="filename">asterisk.ctl</code>.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="The [compat] Section"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id260261"></a>The [compat] Section</h3></div></div></div><p><a id="InitialConfig_id260269"></a><a id="I_indexterm4_d1e9587" class="indexterm"></a>Occasionally the Asterisk development team decides that
      the best way forward involves making a change that is not
      backward-compatible. This section contains some options (listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260275" title="Table 4.4. asterisk.conf [compat] section">Table&nbsp;4.4, “asterisk.conf [compat] section”</a>) that allow reverting behavior of
      certain modules back to previous behavior.</p><div class="table"><a id="InitialConfig_id260275"></a><p class="title"><strong>Table&nbsp;4.4.&nbsp;asterisk.conf [compat] section</strong></p><div class="table-contents"><table summary="asterisk.conf [compat] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><span class="keep-together">pbx_realtime</span></td><td><code class="literal"><a id="I_indexterm4_d1e9613" class="indexterm"></a>1.6</code></td><td>In versions earlier than Asterisk
              1.6.<span class="emphasis"><em>x</em></span>, the <code class="literal">pbx_realtime</code> module would
              automatically convert pipe characters into commas for arguments
              to Asterisk applications. This is no longer done by default. To
              enable this previous behavior, set this option to <code class="literal">1.4</code>.</td></tr><tr><td>res_agi</td><td><code class="literal"><a id="I_indexterm4_d1e9633" class="indexterm"></a>1.6</code></td><td>In versions earlier than Asterisk
              1.6.<span class="emphasis"><em>x</em></span>, the <code class="literal">EXEC</code> AGI command would automatically
              convert pipe characters into commas for arguments to Asterisk
              applications. This is no longer done by default. To enable this
              previous behavior, set this option to <code class="literal">1.4</code>.</td></tr><tr><td>app_set</td><td><code class="literal"><a id="I_indexterm4_d1e9653" class="indexterm"></a>1.6</code></td><td>Starting with the Asterisk 1.6.<span class="emphasis"><em>x</em></span>
              releases, the <code class="literal">Set()</code>
              application only allows setting the value of a single variable.
              Previously, <code class="literal">Set()</code> would allow
              setting more than one variable by separating them with a
              <code class="literal">&amp;</code>. This was done to allow
              any characters in the value of a variable, including the
              <code class="literal">&amp;</code> character, which was
              previously used as a separator. <code class="literal">MSet()</code> is a new application that
              behaves like <code class="literal">Set()</code> used to.
              However, setting this option to <code class="literal">1.4</code> makes <code class="literal">Set()</code> behave like <code class="literal">MSet()</code>.</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="modules.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="additional_configuration_tasks-modules-conf-file"></a>modules.conf</h2></div></div></div><p><a id="InitialConfig_id216374"></a><a id="I_indexterm4_d1e9694" class="indexterm"></a><a id="I_indexterm4_d1e9699" class="indexterm"></a>This file is not strictly required in an Asterisk
    installation; however, without any modules Asterisk won’t really be able
    to do anything, so for all practical purposes, you need a <code class="filename">modules.conf</code> file in your <code class="filename">/etc/asterisk</code> folder. If you simply define
    <code class="literal">autoload=yes</code> in your <code class="filename">modules.conf</code> file, Asterisk will search for all
    modules in the <code class="filename">/usr/lib/asterisk/modules</code> folder and load them
    at startup.</p><p><a id="InitialConfig_id216397"></a>Although most modules do not use much in
    the way of resources, and they all load very quickly, it just seems
    cleaner to our minds to load only those modules that you are planning on
    using in your system. Additionally, there are security benefits to not
    loading modules that accept connections over a network.</p><p><a id="InitialConfig_id216403"></a>In the past we felt that explicitly
    loading each desired module was the best way to handle this, but we have
    since found that this practice creates extra work. After every upgrade we
    found ourselves having to edit the <code class="filename">modules.conf</code> file to correct all the module
    differences between releases, and the whole process ended up being
    needlessly complicated. What we prefer to do these days is to allow
    Asterisk to automatically load the modules that it finds, but to
    explicitly tell Asterisk not to load any modules we do not want loaded by
    use of the <code class="literal">noload</code> directive.<a id="I_indexterm4_d1e9729" class="indexterm"></a> A sample <code class="filename">modules.conf</code>
    file can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294211" title="modules.conf">the section called “modules.conf”</a>.</p><div class="sidebar" title="Using menuselect to Control Which Modules Are Compiled and Installed"><a id="InitialConfig_id216418"></a><div class="titlepage"><div><div><p class="title"><strong>Using menuselect to Control Which Modules Are Compiled and
      Installed</strong></p></div></div></div><p><a id="InitialConfig_id216424"></a><a id="I_indexterm4_d1e9742" class="indexterm"></a><a id="I_indexterm4_d1e9745" class="indexterm"></a>One other way that you can control which modules Asterisk
      loads is to simply not compile and install them in the first place.
      During the Asterisk installation process, the <span class="command"><strong>make menuselect</strong></span> command provides you with a
      menu interface that allows you to specify many different directives to
      the compiler, including which modules to compile and install. If you
      never compile and install a module, the effect of this at load time is
      that it won’t exist, and therefore won’t be loaded. If you are new to
      Linux and Asterisk, this may create confusion for you if you later want
      to use a module and discover that it doesn’t exist on your
      system.</p><p><a id="InitialConfig_id336061"></a>More information about <span class="command"><strong>menuselect</strong></span> is available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994" title="make menuselect">the section called “make menuselect”</a>.</p></div><div class="sect2" title="The [modules] Section"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id216438"></a>The [modules] Section</h3></div></div></div><p><a id="InitialConfig_id258874"></a><a id="I_indexterm4_d1e9765" class="indexterm"></a>The <code class="filename">modules.conf</code> file
      contains a single section. The options available in this section are
      listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id258884" title="Table 4.5. modules.conf [modules] section">Table&nbsp;4.5, “modules.conf [modules] section”</a>. With the exception
      of <code class="literal">autoload</code>, all of the options may
      be specified more than once.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InitialConfig_id336098"></a>A list of all loadable modules is
        available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch" title="Chapter 2. Asterisk Architecture">Chapter&nbsp;2, <em>Asterisk Architecture</em></a>, with notes on our
        opinion regarding the popularity/status of each of them.</p></div><div class="table"><a id="InitialConfig_id258884"></a><p class="title"><strong>Table&nbsp;4.5.&nbsp;modules.conf [modules] section</strong></p><div class="table-contents"><table summary="modules.conf [modules] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td>autoload</td><td><code class="literal"><a id="I_indexterm4_d1e9801" class="indexterm"></a>yes</code></td><td>Instead of explicitly listing which modules to load, you
              can use this directive to tell Asterisk to load all modules that
              it finds in the modules directory, with the exception of modules
              listed as not to be loaded using the <code class="literal">noload</code> directive. The default, and our
              recommendation, is to set this option to <code class="literal">yes</code>.</td></tr><tr><td>preload</td><td><code class="literal"><a id="I_indexterm4_d1e9818" class="indexterm"></a>res_odbc.so</code></td><td>Indicates that a module should be loaded at the beginning
              of the module load order. This directive is much less relevant
              than it used to be; modules now have a load priority built into
              them that solves the problems that this directive was previously
              used to solve.</td></tr><tr><td>load</td><td><code class="literal"><a id="I_indexterm4_d1e9829" class="indexterm"></a>chan_sip.so</code></td><td>Defines a module that should be loaded. This directive is
              only relevant if <code class="literal">autoload</code> is
              set to <code class="literal">no</code>.</td></tr><tr><td>noload</td><td><code class="literal"><a id="I_indexterm4_d1e9846" class="indexterm"></a>chan_alsa.so</code></td><td>Defines a module that should not be loaded. This
              directive is only relevant if <code class="literal">autoload</code> is set to <code class="literal">yes</code>.</td></tr><tr><td>require</td><td><code class="literal"><a id="I_indexterm4_d1e9863" class="indexterm"></a>chan_sip.so</code></td><td>Does the same thing as <code class="literal">load</code>; additionally, Asterisk will exit
              if this module fails to load for some reason.</td></tr><tr><td>preload-require</td><td><code class="literal"><a id="I_indexterm4_d1e9877" class="indexterm"></a>res_odbc.so</code></td><td>Does the same thing as <code class="literal">preload</code>; additionally, Asterisk will
              exit if this module fails to load for some reason.</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="indications.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InitialConfig_id291715"></a>indications.conf</h2></div></div></div><p><a id="InitialConfig_id291517"></a><a id="I_indexterm4_d1e9890" class="indexterm"></a>The sounds that people expect from the telephone network
    vary in different parts of the world. Different countries or regions
    present different sounds for events such as dialtone, busy signal,
    ringback, congestion, and so forth.</p><p><a id="InitialConfig_id282572"></a>The <code class="filename">indications.conf</code> file defines the parameters
    for the various sounds that a telephone system might be expected to
    produce, and allows you to customize them. In the early days of Asterisk
    this file only contained sounds for a limited number of countries, but it
    is now quite comprehensive.</p><p><a id="InitialConfig_id263548"></a>To assign the tones common for your
    region to channels, you can simply assign the tonezone using the <code class="literal">CHANNEL()</code> function,<a id="I_indexterm4_d1e9906" class="indexterm"></a><a id="I_indexterm4_d1e9909" class="indexterm"></a> and that tonezone will apply for the duration of the call
    (unless changed later):</p><p><a id="InitialConfig_id282154"></a><a id="InitialConfig_id282168"></a></p><pre class="programlisting">Set(CHANNEL(tonezone)=[yourcountry]) ; i.e., uk, de, etc.</pre><p><a id="InitialConfig_id249119"></a>However, since signaling from a call
    could come from various places (from the carrier, from Asterisk, or even
    from the set itself), you should note that simply setting the tonezone in
    your dialplan does not guarantee that those tones will be presented in all
    situations.</p><div class="sidebar" title="Hacking indications.conf for Fun and Profit"><a id="InitialConfig_id283596"></a><div class="titlepage"><div><div><p class="title"><strong>Hacking indications.conf for Fun and Profit</strong></p></div></div></div><p><a id="InitialConfig_id283248"></a>If you have too much time on your
      hands, you can do all sorts of pointless but entertaining things with
      your indications. For example, fans of <span class="emphasis"><em>Star Wars</em></span>
      can make the following change to the end of their <code class="filename">indications.conf</code> files:</p><p><a id="InitialConfig_id264201"></a><a id="InitialConfig_id294235"></a></p><pre class="programlisting">[starwars](us)
description = Star Wars Theme Song
ring = 262/400,392/500,0/100,349/400,330/400,294/400,524/400,392/500,0/100,349/400, \
       330/400,294/400,524/400,392/500,0/100,349/400,330/400,349/400,294/500,0/2000
</pre><p>If you then use the country named '<code class="literal">starwars</code>' in your configuration files or
      dialplan, any ringing you pass back will sound quite different from the
      standard ring you are used to. Try the following dialplan code to test
      out your new ringing sound:</p><p><a id="InitialConfig_id249787"></a><a id="InitialConfig_id292042"></a></p><pre class="programlisting">exten =&gt; 500,1,Answer()
    same =&gt; n,Set(CHANNEL(tonezone)=starwars)
    same =&gt; n,Dial(SIP/0000FFFF0002) ; or whatever your channel is named in sip.conf
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InitialConfig_id187292"></a>Depending on the type of device used
        to call into this example, you may wonder if it will actually work.
        SIP phones, for example, typically generate their own tones instead of
        having Asterisk generate them. This example was carefully crafted to
        ensure that Asterisk will generate a ringback tone to the caller. The
        key is the <code class="literal">Answer()</code> that is
        executed first. Later, when an outbound call is made to another
        device, the only method <span class="application">Asterisk</span> has available to pass back a
        ringing indication to the caller is by generating inband audio, since
        as far as the caller’s phone is concerned, this call has already been
        answered.</p></div></div><p><a id="InitialConfig_id293808"></a>While Asterisk will run without an
    <code class="filename">indications.conf</code> file, it is strongly
    recommended that you include one: copy the sample over with
    <strong class="userinput"><code>sudo cp <code class="filename">~/src/asterisk-complete/1.8/configs/indications.conf.sample</code></code></strong>,
    modify the <code class="literal">country</code> parameter in the
    <code class="literal">[general]</code> section to match your region,
    and restart Asterisk.</p><div class="sidebar" title="chan_dahdi Ignores indications.conf"><a id="InitialConfig_id284879"></a><div class="titlepage"><div><div><p class="title"><strong>chan_dahdi Ignores indications.conf</strong></p></div></div></div><p><a id="InitialConfig_id284887"></a>DAHDI does not use the <code class="filename">indications.conf</code> file from Asterisk, but
      rather has the tones compiled in. For more information, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p></div><p><a id="InitialConfig_id215995"></a>If your system supports multiple
    countries (for example, if you have a centralized <span class="keep-together">Asterisk</span> system that has users from
    different regions), you may not be able to simply define the default
    country. In this case, you have a couple of options:</p><div class="orderedlist"><a id="InitialConfig_id336471"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="InitialConfig_id336473"></a><a id="InitialConfig_id336476"></a>Define the country in the channel
        definition file for the user.</p></li><li class="listitem"><p><a id="InitialConfig_id336480"></a><a id="InitialConfig_id336483"></a>Define the country in the dialplan
        using the <code class="literal">CHANNEL(tonezone)</code>
        function.</p></li></ol></div><p><a id="InitialConfig_id336491"></a>For more information about using
    Asterisk in different countries, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization" title="Chapter 9. Internationalization">Chapter&nbsp;9, <em>Internationalization</em></a>.</p></div><div class="sect1" title="musiconhold.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="additional_configuration_tasks-musiconhold-conf-file"></a>musiconhold.conf</h2></div></div></div><p><a id="InitialConfig_id216013"></a><a id="I_indexterm4_d1e9999" class="indexterm"></a><a id="I_indexterm4_d1e10004" class="indexterm"></a>If you plan on selling Asterisk-based telephone systems and
    you do not change the default music on hold that ships with Asterisk, you
    are sending the message, loud and clear, that you don’t really know what
    you are doing.<sup>[<a id="id530763" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id530763" class="footnote">41</a>]</sup></p><p><a id="InitialConfig_id266220"></a>Part of the problem with music on hold
    is that while in the past it was common to just plug a radio or CD player
    into the phone system, the legal reality is that most music licenses do
    not actually allow you to do this. That’s right: if you want to play music
    on hold, somebody, somewhere, typically wants you to pay them for the
    privilege.</p><p><a id="InitialConfig_id266226"></a>So how to deal with this? There are two
    legal ways: 1) pay for a music on hold license from the copyright holder,
    or 2) find a source of music that is released under a license suitable for
    Asterisk.</p><p><a id="InitialConfig_id266231"></a>We’re not here to give you legal advice;
    you are responsible for understanding what is required of you in order to
    use a particular piece of music as your music on hold source. What we will
    do, however, is show you how to take the music you have and make it work
    with Asterisk.</p><div class="sidebar" title="Getting Free Music"><a id="I_sidebar4_d1e10017"></a><div class="titlepage"><div><div><p class="title"><strong>Getting Free Music</strong></p></div></div></div><p><a id="InitialConfig_id266242"></a>There are several websites that offer
      music that has been released under Creative Commons or other licenses.
      Lately, we’ve been enjoying music from <a class="ulink" href="http://www.jamendo.com/" target="_top">Jamendo</a>. Each song may have its own
      licensing requirements, and just because you can download a song for
      free does not mean you have permission to use it as music on
      hold.<a id="I_indexterm4_d1e10025" class="indexterm"></a><a id="I_indexterm4_d1e10028" class="indexterm"></a> Be aware of the licensing terms for the music you are
      planning to use for your music on hold.</p></div><div class="sect2" title="Converting Music to a Format That Works Best with Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="InitialConfig_id266259"></a>Converting Music to a Format That Works Best with
      Asterisk</h3></div></div></div><p><a id="InitialConfig_id266264"></a><a id="I_indexterm4_d1e10036" class="indexterm"></a><a id="I_indexterm4_d1e10039" class="indexterm"></a><a id="I_indexterm4_d1e10044" class="indexterm"></a>It’s quite common to have music in MP3 format <a id="I_indexterm4_d1e10048" class="indexterm"></a>these days. While Asterisk can use MP3s as a music source,
      this method is not at all ideal. MP3s are heavily compressed, and in
      order to play them the CPU has to do some serious work to decompress
      them in real time. This is fine when you are only playing one song and
      want to save space on your iPod, but for music on hold, the proper thing
      to do is convert the MP3 to a format that is easier on the CPU.</p><div class="sidebar" title="CentOS Prerequisite"><a id="InitialConfig_id266272"></a><div class="titlepage"><div><div><p class="title"><strong>CentOS Prerequisite</strong></p></div></div></div><p><a id="InitialConfig_id266278"></a><a id="I_indexterm4_d1e10057" class="indexterm"></a>Since CentOS does not have MP3 capability installed with
        <span class="emphasis"><em>sox</em></span>, you will have to install
        <span class="emphasis"><em>mpg123</em></span> before you can convert MP3 files for use
        with Asterisk.</p><p><a id="InitialConfig_id266288"></a>First you will need to install the
        <span class="emphasis"><em>rpmforge</em></span> repository. To find out which version
        you need, open your web browser and go to <a class="ulink" href="http://dag.wieers.com/rpm/FAQ.php#B" target="_top">http://dag.wieers.com/rpm/FAQ.php#B</a>. Select the text
        for the version/architecture you want to install and paste it into
        your shell:</p><a id="InitialConfig_id266299"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>rpm -Uhv http://apt.sw.be/redhat ...</code></strong></pre><p><a id="InitialConfig_id241111"></a>You need to make sure this new
        repository is used correctly, so run the following:</p><a id="InitialConfig_id241115"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>yum install yum-priorities</code></strong></pre><p><a id="InitialConfig_id241123"></a>(If you want to know more about
        <span class="emphasis"><em>yum</em></span> priorities, see this site: <a class="ulink" href="http://wiki.centos.org/PackageManagement/Yum/Priorities" target="_top">http://wiki.centos.org/PackageManagement/Yum/Priorities</a>.)</p><p><a id="InitialConfig_id241131"></a>Once the repository has been added,
        you can proceed to get <span class="emphasis"><em>mpg123</em></span>:</p><a id="InitialConfig_id241134"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>yum install mpg123</code></strong></pre><p><a id="InitialConfig_id241142"></a>Once that’s done, your CentOS system
        is ready to convert MP3 files for use with <span class="keep-together">Asterisk</span>.</p></div><p><a id="InitialConfig_id241147"></a>If you are familiar with the file
      formats and have some experience working with audio engineering software
      such as Audacity, you can convert the files on your PC and upload them
      to Asterisk. We find it is simpler to upload the source MP3 files to the
      Asterisk server (say, to the <code class="filename">/tmp</code>
      folder), and then convert them from the command line.</p><p><a id="InitialConfig_id241156"></a>To convert your MP3 files to a format
      that Asterisk understands, you need to run the commands outlined here
      (in this example we are using a file named <code class="filename">SilentCity.mp3</code>).</p><div class="sect3" title="CentOS"><div class="titlepage"><div><div><h4 class="title"><a id="InitialConfig_id241164"></a>CentOS</h4></div></div></div><p><a id="InitialConfig_id241170"></a>First, convert the MP3 file to a WAV
        file:</p><a id="InitialConfig_id241173"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>mpg123 -w SilentCity.wav SilentCity.mp3</code></strong></pre><p><a id="InitialConfig_id241181"></a>Then, downsample the resulting WAV
        file to a sampling rate that Asterisk understands:</p><a id="InitialConfig_id241185"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>sox SilentCity.wav -t raw -r 8000 -s -w -c 1 SilentCity.sln</code></strong></pre></div><div class="sect3" title="Ubuntu"><div class="titlepage"><div><div><h4 class="title"><a id="InitialConfig_id241193"></a>Ubuntu</h4></div></div></div><p><a id="InitialConfig_id241199"></a><a id="I_indexterm4_d1e10147" class="indexterm"></a>If you have not done so already, install <span class="command"><strong>sox</strong></span>, and the <code class="literal">libsox-fmt-all</code> package:</p><p><a id="InitialConfig_id241209"></a><a id="InitialConfig_id241210"></a></p><pre class="screen"># <strong class="userinput"><code>sudo apt-get install sox libsox-fmt-all</code></strong></pre><p><a id="InitialConfig_id241216"></a>Then, convert your MP3 file directly
        to the uncompressed SLN format:</p><a id="InitialConfig_id241220"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>sox SilentCity.mp3 -t raw -r 8000 -s -w -c 1 SilentCity.sln</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InitialConfig_id320859"></a>In newer versions of
          <span class="emphasis"><em>sox</em></span> (e.g., version 14.3.0, which shipped with
          Ubuntu 10.10), the <span class="emphasis"><em>-w</em></span> option has changed to
          <span class="emphasis"><em>-2</em></span>.</p></div></div><div class="sect3" title="Completing file conversion"><div class="titlepage"><div><div><h4 class="title"><a id="InitialConfig_id241229"></a>Completing file conversion</h4></div></div></div><p><a id="InitialConfig_id241234"></a>The resulting file will exist in the
        <code class="filename">/tmp</code> folder (or wherever you
        uploaded to) and needs to be copied to the <code class="filename">/var/lib/asterisk/moh</code> folder:</p><a id="InitialConfig_id216298"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>cp *.sln /var/lib/asterisk/moh</code></strong></pre><p><a id="InitialConfig_id216306"></a>You now need to reload <span class="command"><strong>musiconhold</strong></span> in Asterisk in order to have it
        recognize your new files:</p><a id="InitialConfig_id216310"></a><pre class="programlisting"><code class="computeroutput">$</code> <strong class="userinput"><code>asterisk -rx "module unload res_musiconhold.so"</code></strong>
<code class="computeroutput">$</code> <strong class="userinput"><code>asterisk -rx "module load res_musiconhold.so"</code></strong></pre><p><a id="InitialConfig_id216324"></a>To test that your music is working
        correctly, add the following to the <code class="literal">[UserServices]</code> context in your
        dialplan:</p><p><a id="InitialConfig_id216332"></a><a id="InitialConfig_id216333"></a></p><pre class="programlisting">exten =&gt; 664,1,NoOp()
    same =&gt; n,Progress()
    same =&gt; n,MusicOnHold()
</pre><p>Dialing <code class="literal">664</code> from one of
        your sets should play a random file from your <code class="filename">moh</code> directory.</p></div></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InitialConfig_id260414"></a>Conclusion</h2></div></div></div><p><a id="InitialConfig_id260420"></a>This chapter helped you complete some
    initial configuration of Asterisk. From here you can move on to setting up
    some phones and taking advantage of the many features Asterisk has to
    offer.<a id="I_indexterm4_d1e10239" class="indexterm"></a><a id="I_indexterm4_d1e10240" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id530763" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id530763" class="para">41</a>] </sup>Note that Leif uses the default music, but his excuse is that
        he’s lazy and wants to go and play Forza on his Xbox. The cobbler’s
        kids have no shoes.</p></div></div></div><div class="chapter" title="Chapter 5. User Device Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-DeviceConfig"></a>Chapter&nbsp;5.&nbsp;User Device Configuration</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id216341">Configuring Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291909">Loading Your New Channel Configurations</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291920">The Asterisk CLI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292132">Under the Hood: Your First Call</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292192">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="DeviceConfig_id285448"></a>I don’t always know what I’m talking
    about, <span class="keep-together">but I know I’m right</span>.</p><div class="attribution"><span>—<span class="attribution">Muhammad Ali</span></span></div></div><p><a id="DeviceConfig_id269390"></a><a id="index-670C134RG6E" class="indexterm"></a><a id="index-566V325JO0N" class="indexterm"></a>In this chapter we’ll delve into the user devices that you
  might want to connect to Asterisk, typically VoIP telephones of some sort.
  Configuring a channel in Asterisk for the device to connect through is
  relatively straightforward, but you also need to configure the device itself
  so it knows where to send its calls.<sup>[<a id="id531555" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id531555" class="footnote">42</a>]</sup> In other words, there are two parts to configuring a device on
  Asterisk: 1) telling Asterisk about the device, and <span class="keep-together">2) telling</span> the device about Asterisk.</p><div class="sidebar" title="How Asterisk Relates to the SIP Protocol"><a id="DeviceConfig_id249474"></a><div class="titlepage"><div><div><p class="title"><strong>How Asterisk Relates to the SIP Protocol</strong></p></div></div></div><p><a id="DeviceConfig_id250907"></a>SIP <a id="I_indexterm5_d1e10274" class="indexterm"></a>is a peer-to-peer protocol, and while it is common to have a
    setup where endpoints act as clients and some sort of gateway acts as a
    server, the protocol still thinks in terms of peer-to-peer relationships.
    What this means is that a SIP telephone expects to make a direct
    connection to another SIP telephone, without a PBX in between.</p><p><a id="DeviceConfig_id282694"></a>The reality is that many SIP transactions
    happen through a server, and in the case of Asterisk, it is common to have
    the PBX in the middle of all connections. When a SIP call is made from a
    telephone to another telephone through Asterisk, there are actually two
    calls happening: one from the originating set to Asterisk, and another
    separate call from Asterisk to the destination set. Asterisk bridges the
    two channels together.</p><p><a id="DeviceConfig_id250890"></a>From the perspective of the SIP
    telephone, therefore, you need to configure it to send all its calls to
    Asterisk, even though the device is quite capable of directly connecting
    to another SIP endpoint without the Asterisk server. The SIP protocol is
    complex and very flexible, and configuring endpoints can seem difficult
    because they have much more flexibility than we require of them for an
    Asterisk implementation.</p></div><p><a id="DeviceConfig_id263943"></a>While most devices will have a web-based
  interface for defining parameters, if you’re putting more than one or two
  phones into production we recommend using a server-based configuration
  process, wherein the set is only told the location of a file server. The set
  will identify itself and download customized files that define the required
  parameters for that telephone. As an example, these could be XML files on an
  FTP server. The exact download process and syntax of these files will differ
  from manufacturer to manufacturer. In this chapter we will only talk about
  the configuration of sets from the perspective of Asterisk.</p><div class="sect1" title="Telephone Naming Concepts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id283201"></a>Telephone Naming Concepts</h2></div></div></div><p><a id="DeviceConfig_id251240"></a><a id="I_indexterm5_d1e10290" class="indexterm"></a><a id="I_indexterm5_d1e10295" class="indexterm"></a>Before we get started with configuring Asterisk for our
    telephones, we are going to recommend some best practices regarding
    telephone naming, abstracting the concepts of users, extension numbers,
    and telephones from each other.</p><p><a id="DeviceConfig_id250307"></a>In Asterisk, all the system cares about
    is the channel name. There is really no concept of a user at all,<sup>[<a id="id531687" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id531687" class="footnote">43</a>]</sup> and extensions are simply ways of directing call flow
    through the system. For example, your dialplan might inform Asterisk that
    when extension number 100 is requested it should call the phone on my
    desk, but extension 100 could just as easily call a company voicemail box,
    play back a prompt, or join a conference room. We can even specify that
    extension 100 should ring the device on my desk from Monday to Friday
    between 9 A.M. and 5 P.M., but ring a device on someone else’s desk the
    rest of the time. Inversely, when a call is made from a device during
    business hours, the callerID could show a daytime number, and the rest of
    the time could show an after-hours number (many reception desks become
    security desks at night).</p><div class="sidebar" title="Asterisk Extensions"><a id="DeviceConfig_id216013"></a><div class="titlepage"><div><div><p class="title"><strong>Asterisk Extensions</strong></p></div></div></div><p><a id="DeviceConfig_id216018"></a>The concept of an extension <a id="I_indexterm5_d1e10321" class="indexterm"></a>in Asterisk is crucial. In most PBXs, an extension is a
      number that you dial to cause a phone or service to ring. In Asterisk,
      an extension is the name of a grouping of instructions in the dialplan.
      Think of an Asterisk extension as a script name, and you’re on the right
      track. Yes, an Asterisk extension could be a number (such as
      <code class="literal">100</code>) that rings a phone, but it could just as easily
      be a name (such as <code class="literal">voicemail</code>) that runs a sequence of
      dialplan applications.</p><p><a id="DeviceConfig_id216031"></a>We’ll be going into Asterisk extensions
      in far more detail throughout this book, but before we do that we want
      to get some phones set up.</p></div><p><a id="DeviceConfig_id216037"></a>The abstraction between the name of an
    extension and what that extension does is a powerful concept in Asterisk,
    as extension 100 could do a number of things depending on any number of
    variables that are programmed into the system. This is especially relevant
    in the context of features such as hot-desking.</p><p><a id="DeviceConfig_id266238"></a>Hot-desking <a id="I_indexterm5_d1e10339" class="indexterm"></a>is a feature that allows someone to log into a device and
    receive his calls at that device. Let’s say we have three sales agents who
    typically work outside of the office, but spend a couple of days each
    month in the office to do paperwork. Since they are unlikely to be on-site
    at the same time, instead of having a separate telephone for each of those
    three sales agents, they could share a single office phone (or on a larger
    scale, a dozen folks could share a pool of, say, three phones). This
    scenario illustrates the convenience (and necessity) of allowing the
    system to separate the concept of a user and extension from the physical
    phone.</p><p><a id="DeviceConfig_id246292"></a>So what are some examples of bad names
    for telephone devices? Something like a person’s name, such as
    <code class="literal">[SimonLeBon]</code>, would be a poor name for a telephone as
    the phone may also be used by Joan Jett and Rick Astley. The same
    reasoning can be applied to why you would not want to name a phone based
    on an extension number: a phone name of <code class="literal">[100]</code> would be
    a poor choice since you might want to reprovision the device for extension
    <code class="literal">160</code> in the future, or it might be used by several
    people with different extensions in a hot-desking solution. Using numeric
    account names is also very bad from a security perspective and is
    discussed in more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a>.</p><p><a id="DeviceConfig_id246309"></a>A popular way to name <a id="I_indexterm5_d1e10360" class="indexterm"></a><a id="I_indexterm5_d1e10365" class="indexterm"></a>a phone is using the MAC address of the device. This is a
    unique identifier specific to the phone that follows it where it goes and
    doesn’t directly relate to the user operating the phone or the extension
    number currently associated with it. Some corporations have stickers they
    place on their equipment with a bar code and other information that allows
    them to keep stock of provisioned equipment; these unique codes would also
    be an acceptable choice to use for phone names as they don’t provide any
    logical relation to a particular person, but do provide specific
    information about the devices themselves.</p><p><a id="DeviceConfig_id246318"></a>The choice is yours as to how you want to
    name your phones, but we primarily want to abstract any concept of the
    telephone being owned by a person, or even its location in the network,
    since these concepts are outside the realm of Asterisk and can change at
    any time.</p><p><a id="DeviceConfig_id246324"></a>Throughout this book, you’ll see us using
    phone names that look like MAC addresses (such as
    <code class="literal">0000FFFF0001</code> and <code class="literal">0000FFFF0002</code>) to
    differentiate between devices. You will want to use phone names that match
    the hardware you are using (or some other string that is unique to the
    device you are registering).</p><p><a id="DeviceConfig_id246336"></a>As a final consideration, we should make
    it clear that what we are suggesting regarding device names is not a
    technical requirement. You are free to name your devices anything you
    want, as long as they meet the requirements of Asterisk’s naming
    conventions for devices (stay with alphanumeric characters with no spaces
    and you’ll be fine).</p></div><div class="sect1" title="Hardphones, Softphones, and ATAs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id246359"></a>Hardphones, Softphones, and ATAs</h2></div></div></div><p><a id="DeviceConfig_id266251"></a><a id="I_indexterm5_d1e10387" class="indexterm"></a><a id="I_indexterm5_d1e10392" class="indexterm"></a><a id="I_indexterm5_d1e10395" class="indexterm"></a><a id="I_indexterm5_d1e10400" class="indexterm"></a>There are three types of endpoints you would typically
    provide your users with that could serve as a telephone set. They are
    popularly referred to as hardphones, softphones, and Analog Terminal
    Adaptors (ATAs).</p><p><a id="DeviceConfig_id266256"></a>A <span class="emphasis"><em>hardphone</em></span> is a
    physical device. It looks just like an office telephone: it has a handset,
    numbered buttons, etc. It connects directly to the network, and it’s what
    people are referring to when they talk about a VoIP telephone (or a SIP
    telephone).</p><p><a id="DeviceConfig_id266262"></a>A <span class="emphasis"><em>softphone</em></span> is a
    software application that runs on a laptop or desktop. The audio must pass
    through the PC’s sound system, so you normally need a headset that will
    work well with telephony applications. More recently, softphone
    applications have been written for smart phones that allow you to connect
    to other networks other than just the cellular network. The interface of
    the softphone is often styled to look like a physical telephone, but this
    is not necessary.</p><p><a id="DeviceConfig_id266274"></a>An <span class="emphasis"><em>ATA</em></span> is designed
    to allow traditional analog telephones (and other analog devices, such as
    fax machines, cordless phones, paging amplifiers, and such) to connect to
    a SIP network,<sup>[<a id="id532060" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id532060" class="footnote">44</a>]</sup> and will typically be a sandwich-sized box that contains an
    RJ-11 connector for the phone (commonly referred to as an FXS port), an
    RJ-45 connector for the network, and a power connector. Some ATAs may
    support more than one phone.</p><p><a id="DeviceConfig_id266289"></a>Hardphones have the advantage that the
    handsets have good acoustic properties for voice communications. Any
    decent-quality telephone is engineered to pick up the frequencies of the
    human voice, filter out unwanted background noise, and normalize the
    resulting waveform. People have been using telephones for as long as the
    telephone network has existed, and we tend to like what is familiar, so
    having a device that communicates with Asterisk using a familiar interface
    will be attractive to many users. Also, a hardphone does not require your
    computer to be running all the time.</p><p><a id="DeviceConfig_id266298"></a>Disadvantages to hardphones include that
    they are nonportable and expensive, relative to the many quality
    softphones on the market today that are available for free. Also, the
    extra clutter on your desk may not be desirable if you have limited work
    space, and if you move around a lot and are not generally at the same
    location, a hardphone is not likely to suit your needs (although, one at
    each location you frequent might be a valid solution).</p><p><a id="DeviceConfig_id266305"></a>Softphones solve the portability issue by
    being installed on a device that is likely already moving with you, such
    as your laptop or smart phone. Also, their minimal cost (typically free,
    or around the $30 price range for a fully featured one) is attractive.
    Because many softphones are free, it is likely that the first telephone
    set you connect to Asterisk will be a softphone. Also, because softphones
    are just software, they are easy to install and upgrade, and they commonly
    have other features that utilize other peripherals, like a webcam for
    video calling, or perhaps an ability to load files from your desktop for
    faxing.</p><p><a id="DeviceConfig_id266314"></a>Some of the disadvantages of softphones
    are the not-always-on nature of the devices, the necessity to put on a
    headset each time you take a call, and the fact that many PCs will at
    random times during the day choose to do something other than what the
    user wants them to do, which might cause the softphone to stop working
    while some background task hogs the CPU.</p><p><a id="DeviceConfig_id216302"></a>ATAs have the advantage of allowing you
    to connect to your SIP network analog devices,<sup>[<a id="id532127" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id532127" class="footnote">45</a>]</sup> such as cordless phones (which are still superior in many
    cases to more advanced types of wireless phones<sup>[<a id="id532134" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id532134" class="footnote">46</a>]</sup>), paging amplifiers, and ringers. ATAs can also sometimes be
    used to connect to old wiring, where a network connection might not
    function <span class="keep-together">correctly</span>.</p><p><a id="DeviceConfig_id216316"></a>The main disadvantage of an ATA is that
    you will not get the same features through <span class="keep-together">an
    analog</span> line as you would from a SIP telephone. This is technology
    that is over a <span class="keep-together">century old</span>.</p><p><a id="DeviceConfig_id216321"></a>With Asterisk, we don’t necessarily need
    to make the choice between having a softphone, a hardphone, or an ATA;
    it’s entirely possible and quite common to have a single extension number
    that rings multiple devices at the same time, such as a desk phone, the
    softphone on a laptop, a cell phone, and perhaps a strobe light in the
    back of the factory (where there is too much noise for a ringer to be
    heard).</p><p><a id="DeviceConfig_id216328"></a>Asterisk will happily allow you to
    interact with the outside world in ways that were scarcely dreamed of only
    a few years ago. As we see more unification of communications applications
    with the popularity of social networks, communities such as Skype, and
    more focus on network-based services such as those provided by Google, the
    flexibility and popularity of software-based endpoints will continue to
    grow. The blurring of the lines between voice and applications is
    constantly evolving, and softphones are well positioned to rapidly respond
    to these changes.</p><p><a id="DeviceConfig_id216336"></a>We still like a desk phone,
    though.</p></div><div class="sect1" title="Configuring Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id216341"></a>Configuring Asterisk</h2></div></div></div><p><a id="DeviceConfig_id216346"></a><a id="index-864O152IM5B" class="indexterm"></a>In this section we’ll cover how to create the
    <code class="filename">sip.conf</code> and <code class="filename">iax.conf</code>
    configuration files in the <code class="filename">/etc/asterisk/</code> directory,
    which are used for defining the parameters by which SIP and IAX2 devices
    can communicate with your system.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id216363"></a>Asterisk allows devices using many
      different protocols to speak to it (and therefore to each other).
      However, the SIP and IAX2 protocols are the most popular and mature VoIP
      modules, so we will focus our attention on them. For your first Asterisk
      build, you might be best off not bothering with the other protocols
      (such as Skinny/SCCP, Unistim, <span class="keep-together">H.323</span>, and MGCP), and getting comfortable
      working with SIP and IAX2 first. The configuration for the other
      protocols is similar, and the sample configuration files are full of
      information and examples, so once you have the basics down, other
      protocols should be fairly easy to <span class="keep-together">work
      with</span>.</p></div><p><a id="DeviceConfig_id216373"></a>The channel configuration
    files,<a id="I_indexterm5_d1e10491" class="indexterm"></a> such as <code class="filename">sip.conf</code> and
    <code class="filename">iax.conf</code>, contain the configuration for the channel
    driver, such as <code class="filename">chan_iax2.so</code> or
    <code class="filename">chan_sip.so</code>, along with the information and
    credentials required for a telephony device to contact and interact with
    Asterisk.</p><p><a id="DeviceConfig_id216390"></a>Common information about the channel
    driver is contained at the top of the configuration file, in the
    <code class="literal">[general]</code> section. All section names are encased in
    square brackets, including device names. Anything that follows a section
    name (or device definition, which for our purposes is essentially the same
    thing) is applied to that section. The <code class="literal">[general]</code>
    section can also contain information to define defaults for device
    configurations, which are overridden in the section for each device, or in
    a template. Asterisk also comes with defaults that are hardcoded, so while
    some settings are mandatory, many other settings can be ignored as long as
    you are happy with the defaults.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id216407"></a>Asterisk will check for parameters
        <a id="I_indexterm5_d1e10518" class="indexterm"></a>in the following order:</p><div class="orderedlist"><a id="DeviceConfig_id216411"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="DeviceConfig_id216413"></a><a id="DeviceConfig_id216415"></a>Check the specific section for
            the relevant channel.</p></li><li class="listitem"><p><a id="DeviceConfig_id216419"></a><a id="DeviceConfig_id216421"></a>Check the template for the
            section.</p></li><li class="listitem"><p><a id="DeviceConfig_id216426"></a><a id="DeviceConfig_id216428"></a>Check the
            <code class="literal">[general]</code> section.</p></li><li class="listitem"><p><a id="DeviceConfig_id216436"></a><a id="DeviceConfig_id216438"></a>Use the hardcoded
            defaults.</p></li></ol></div><p><a id="DeviceConfig_id216443"></a>This means that just because you
        didn’t specify a setting for a particular parameter doesn’t mean your
        device isn’t going to have a setting for that parameter. If you are
        not sure, set the parameter explicitly in the section of the
        configuration file that deals with that specific channel, or in the
        relevant template.</p><p><a id="DeviceConfig_id290989"></a>This concept should make more sense
        as you read on.</p></div><div class="sect2" title="How Channel Configuration Files Work with the Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="id532453"></a>How Channel Configuration Files Work with the Dialplan</h3></div></div></div><p><a id="DeviceConfig_id290999"></a><a id="I_indexterm5_d1e10546" class="indexterm"></a><a id="I_indexterm5_d1e10553" class="indexterm"></a><a id="I_indexterm5_d1e10558" class="indexterm"></a>While we haven’t discussed Asterisk dialplans yet, it is
      useful to be able to visualize the relationship between the channel
      configuration files (<code class="filename">sip.conf</code>,
      <code class="filename">iax.conf</code>) and the dialplan
      (<code class="filename">extensions.conf</code>). The dialplan is the heart of an
      Asterisk system: it controls how call logic is applied to any connection
      from any channel, such as what happens when a device dials extension
      <code class="literal">101</code> or an incoming call from an external provider is
      routed. Both the relevant channel configuration file and the
      <code class="filename">extensions.conf</code><a id="I_indexterm5_d1e10579" class="indexterm"></a><a id="I_indexterm5_d1e10582" class="indexterm"></a> file play a role in most calls routed through the system.
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291038" title="Figure 5.1. Relationship of sip.conf to extensions.conf">Figure&nbsp;5.1, “Relationship of sip.conf to extensions.conf”</a> provides a graphical
      representation of the relationship between the
      <code class="filename">sip.conf</code> and <code class="filename">extensions.conf</code>
      files.</p><p><a id="DeviceConfig_id291023"></a>When a call comes into Asterisk, the
      identity of the incoming call is matched in the channel configuration
      file for the protocol in use (e.g., <code class="filename">sip.conf</code>). The
      channel configuration file also handles authentication and defines where
      that channel will enter the dialplan.</p><p><a id="DeviceConfig_id291032"></a>Once Asterisk has determined how to
      handle the channel, it will pass call control to the correct context in
      the dialplan. The <code class="literal">context</code> parameter in the channel
      configuration file tells the channel where it will enter the dialplan
      (which contains all the information about how to handle and route the
      call).<a id="I_indexterm5_d1e10606" class="indexterm"></a></p><div class="figure-float"><div class="figure"><a id="DeviceConfig_id291038"></a><p class="title"><strong>Figure&nbsp;5.1.&nbsp;Relationship of sip.conf to extensions.conf</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject5_d1e10612"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0501.png" alt="Relationship of sip.conf to extensions.conf"></div></div></div><br class="figure-break"></div><p><a id="DeviceConfig_id291061"></a>Conversely, if the dialplan has been
      programmed to dial another device when the request for extension number
      <code class="literal">101</code> is being processed, a request to dial telephony
      device <code class="literal">0000FFFF0002</code> will use the channel
      configuration file to determine how to pass the call back out of the
      dialplan to the telephone on the network (including such details as
      authentication, codec, and so forth).</p><p><a id="DeviceConfig_id291074"></a>A key point to remember is that the
      channel configuration files control not only how calls enter the system,
      but also how they leave the system. So, for example, if one set calls
      another set, the channel configuration file is used not only to pass the
      call through to the dialplan, but also to direct the call from the
      dialplan to the destination.</p></div><div class="sect2" title="sip.conf"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceConfig_id291081"></a>sip.conf</h3></div></div></div><p><a id="DeviceConfig_id291088"></a><a id="index-534N131BH5L" class="indexterm"></a><a id="index-702Q431PP7Q" class="indexterm"></a>The SIP<sup>[<a id="id532746" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id532746" class="footnote">47</a>]</sup> channel module is arguably the most mature and
      feature-rich of all the channel modules in Asterisk. This is due to the
      enormous popularity of the SIP protocol, which has taken over the
      VoIP/telecom industry and been implemented in thousands of devices and
      PBXs. If you look through the <code class="filename">sip.conf.sample</code> file
      in the <code class="filename">./configs</code> subdirectory of your Asterisk
      source you will notice a wealth of options available. Fortunately, the
      default options are normally all you need, and therefore you can create
      a very simple configuration file that will allow most standard SIP
      telephones to connect with Asterisk.</p><p><a id="DeviceConfig_id291110"></a>The first thing you need to do is
      create a configuration file in your <code class="filename">/etc/asterisk</code>
      directory called <code class="filename">sip.conf</code>.</p><p><a id="DeviceConfig_id291125"></a>Paste or type the following information
      into the file:</p><a id="DeviceConfig_id291128"></a><pre class="programlisting">[general]
context=unauthenticated         ; default context for incoming calls
allowguest=no                   ; disable unauthenticated calls
srvlookup=yes                   ; enabled DNS SRV record lookup on outbound calls
udpbindaddr=0.0.0.0             ; listen for UDP requests on all interfaces
tcpenable=no                    ; disable TCP support

[office-phone](!)   ; create a template for our devices
type=friend         ; the channel driver will match on username first, IP second
context=LocalSets   ; this is where calls from the device will enter the dialplan
host=dynamic        ; the device will register with asterisk
nat=yes             ; assume device is behind NAT
                    ; *** NAT stands for Network Address Translation, which allows  
                    ; multiple internal devices to share an external IP address.
secret=s3CuR#p@s5   ; a secure password for this device -- DON'T USE THIS PASSWORD!
dtmfmode=auto       ; accept touch-tones from the devices, negotiated automatically
disallow=all        ; reset which voice codecs this device will accept or offer
allow=ulaw          ; which audio codecs to accept from, and request to, the device
allow=alaw          ; in the order we prefer

; define a device name and use the office-phone template
[0000FFFF0001](office-phone)

; define another device name using the same template
[0000FFFF0002](office-phone)</pre><p><a id="DeviceConfig_id291160"></a>Open the <code class="filename">sip.conf</code>
      file you’ve just created, and we’ll go over each item.</p><p><a id="DeviceConfig_id291167"></a>We’ve created four sections, the first
      one being the <code class="literal">[general]</code> section. This is a standard
      section that appears at the top of the configuration file for all
      channel modules, and must always be named in this way. The
      <code class="literal">[general]</code> section contains general configuration
      options for how that protocol relates to your system, and can be used to
      define default parameters as well.</p><p><a id="DeviceConfig_id291179"></a>For example, we’ve defined the default
      <a id="I_indexterm5_d1e10681" class="indexterm"></a><a id="I_indexterm5_d1e10686" class="indexterm"></a>context as <code class="literal">unauthenticated</code>, to ensure
      that we have explicitly declared where unauthenticated guest calls will
      enter the dialplan (rather than leaving that to chance). We’ve named it
      <code class="literal">unauthenticated</code> to make it obvious that calls
      processed in this context are not trusted, and thus should not be able
      to do things such as make outbound calls to the PSTN (which could
      potentially cost money, or represent identity theft). You should be
      aware that we could have used any name we wanted, and also that there
      needs to be an identically named context in
      <code class="filename">extensions.conf</code> to define the call flow for
      unauthenticated calls.</p><p><a id="DeviceConfig_id291197"></a>The next option is
      <code class="literal">allowguest</code><a id="I_indexterm5_d1e10705" class="indexterm"></a>, which we’ve disabled as we don’t want to accept any
      unauthenticated calls at this time. Keep in mind that for some channels
      you may actually want to accept unauthenticated calls. A common use for
      allowing unauthenticated calls is for companies that allow dialing by
      uniform resource identifiers (URIs)<a id="I_indexterm5_d1e10709" class="indexterm"></a>, like email addresses. If we wanted to allow customers to
      call us from their phones without having to authenticate, we could
      enable guest calls and handle them in the
      <code class="literal">unauthenticated</code> context defined by the previous
      option.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id291213"></a>You may be wondering why you might
        ever want to allow unauthenticated calls.<a id="I_indexterm5_d1e10721" class="indexterm"></a> The reason is that if you publish your SIP URI on your
        business cards (e.g., <code class="uri">sip:leif.madsen@shifteight.org</code>),
        calls to that URI will fail if your unauthenticated context simply
        hangs up. What you want instead is for your unauthenticated context to
        put incoming calls into a controlled environment. You may wish to
        allow the calls, but you won’t necessarily trust them.<sup>[<a id="id532995" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id532995" class="footnote">48</a>]</sup></p></div><p><a id="DeviceConfig_id291234"></a>The
      <code class="literal">srvlookup</code><a id="I_indexterm5_d1e10739" class="indexterm"></a> option is used to enable Asterisk to perform a lookup via
      a DNS SRV record, which is typically used for outbound connections to
      service providers. We’ll talk more about Asterisk and DNS in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR" title="Chapter 12. Internet Call Routing">Chapter&nbsp;12, <em>Internet Call Routing</em></a>.</p><p><a id="DeviceConfig_id291242"></a>The
      <code class="literal">udpbindaddr</code><sup>[<a id="id533057" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id533057" class="footnote">49</a>]</sup>option takes the value of an IP address or
      <code class="literal">0.0.0.0</code> to tell Asterisk which network interface it
      should listen to for requests carried by the UDP network transport
      protocol (which is the protocol that actually carries the voice
      channels). By defining <code class="literal">0.0.0.0</code>, we’re instructing the
      channel driver to listen on all available interfaces. Alternatively, we
      could limit VoIP connections for this protocol to a single interface by
      defining the IP address of a specific network interface on our
      system.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DeviceConfig_id291268"></a>Currently in Asterisk the
        <code class="literal">udpbindaddr</code> and
        <code class="literal">tcpbindaddr</code><a id="I_indexterm5_d1e10774" class="indexterm"></a> options are an all-or-one proposition. In other words,
        if you have three NICs in your system, you can’t restrict VoIP traffic
        to two of them: it’s either one only, or all of them.</p></div><div class="sidebar" title="IPv6 in sip.conf"><a id="DeviceConfig_id163474"></a><div class="titlepage"><div><div><p class="title"><strong>IPv6 <a id="I_indexterm5_d1e10781" class="indexterm"></a>in sip.conf</strong></p></div></div></div><p><a id="DeviceConfig_id163482"></a>As of version 1.8, Asterisk supports
        IPv6 for both SIP and RTP traffic. All of the configuration options in
        <code class="filename">/etc/asterisk/sip.conf</code> related to IP addresses
        can accept either an IPv4 or an IPv6 address. As an example, consider
        the different values for the <code class="literal">udpbindaddr</code>
        option:</p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>udpbindaddr value</th><th>Description</th></tr></thead><tbody><tr><td>
                  <code class="literal">192.168.100.50</code>
                </td><td>Bind to a specific IPv4 address.</td></tr><tr><td>
                  <code class="literal">2001:db8::1</code>
                </td><td>Bind to a specific IPv6 address</td></tr><tr><td>
                  <code class="literal">0.0.0.0</code>
                </td><td>Bind to all IPv4 addresses on the system.</td></tr><tr><td>
                  <code class="literal">::</code>
                </td><td>Bind to all IPv4 <span class="emphasis"><em>and</em></span> IPv6
                addresses.</td></tr></tbody></table></div></div><p><a id="DeviceConfig_id291280"></a>The
      <code class="literal">tcpenable</code><a id="I_indexterm5_d1e10833" class="indexterm"></a> option allows us to accept requests via the TCP network
      transport protocol. For now we’ve disabled it, as the UDP method is
      currently more mature (and more popular) and we’re attempting to
      eliminate as many barriers as possible. Having said that, feel free to
      test TCP support once you’re comfortable configuring your <span class="keep-together">devices</span>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id163590"></a>There are also
        <code class="literal">tlsenable</code> and
        <code class="literal">tlsbindaddr</code><a id="I_indexterm5_d1e10848" class="indexterm"></a> options for enabling SIP over TLS (encrypted SIP).
        We’ll cover the configuration of SIP with TLS in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p></div><p><a id="DeviceConfig_id291289"></a>The next section we’ve defined is a
      template we have chosen to name <code class="literal">[office-phone](!)</code>.
      We’ve created it as a template so that we can use the values within it
      for all of our devices.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id291300"></a>Following the section name with
        <code class="literal">(!)</code> <a id="I_indexterm5_d1e10865" class="indexterm"></a><a id="I_indexterm5_d1e10868" class="indexterm"></a>tells Asterisk to treat this section as a template. By
        doing this we eliminate the need to repetitively add and change
        configuration options for every device we choose to define. Templates
        are extremely useful and are available in all of Asterisk’s
        configuration files. If you want to change something for an individual
        device that was previously defined in the template for that device,
        you can do that under the section header, and it will override what
        was defined by the template. It is not necessary to use templates, but
        they are extremely handy, and we use them extensively.</p></div><p><a id="DeviceConfig_id291313"></a>In the
      <code class="literal">[office-phone]<a id="I_indexterm5_d1e10877" class="indexterm"></a></code> template we’ve defined several options required
      for authentication and control of calls to and from devices that use
      that template. The first option we’ve configured is the
      <code class="literal">type</code>, which we’ve set to <code class="literal">friend</code>.
      This tells the channel driver to attempt to match on name first, and
      then IP address.</p><div class="sidebar" title="SIP Configuration Matching and the type Option"><a id="DeviceConfig_id291332"></a><div class="titlepage"><div><div><p class="title"><strong>SIP Configuration Matching and the type Option</strong></p></div></div></div><p><a id="DeviceConfig_id291337"></a><a id="I_indexterm5_d1e10891" class="indexterm"></a><a id="I_indexterm5_d1e10896" class="indexterm"></a>In the example we have provided, the configuration for
        SIP phones is set with <code class="literal">type=friend</code>. There are two
        other type definitions you can use: <code class="literal">user</code> and
        <code class="literal">peer</code>. The difference between them has to do with
        how Asterisk interprets incoming SIP requests. The rules are covered
        in this table:<a id="I_indexterm5_d1e10909" class="indexterm"></a></p><div class="informaltable"><table border="1"><colgroup><col><col></colgroup><thead><tr><th>type =</th><th>Description</th></tr></thead><tbody><tr><td>
                  <code class="literal">peer</code>
                </td><td>Match incoming requests to a configuration entry using
                the source IP address and port number.</td></tr><tr><td>
                  <code class="literal">user</code>
                </td><td>Match incoming requests to a configuration entry using
                the username in the <code class="literal">From</code> header of the SIP
                request. This name is matched to a section in
                <code class="filename">sip.conf</code> with the same name in square
                brackets.</td></tr><tr><td>
                  <code class="literal">friend</code>
                </td><td>This enables matching rules for both
                <code class="literal">peer</code> and <code class="literal">user</code>. This is
                the setting most commonly used for SIP phones.</td></tr></tbody></table></div></div><p><a id="DeviceConfig_id291364"></a>When a request from a telephone is
      received and authenticated by Asterisk, the requested extension number
      is handled by the dialplan in the <code class="literal">context</code> defined in
      the device configuration; in our case, the context named
      <code class="literal">LocalSets</code>.</p><p><a id="DeviceConfig_id291376"></a>The <code class="literal">host</code><a id="I_indexterm5_d1e10964" class="indexterm"></a> option is used when we need to send a request to the
      telephone (such as when we want to call someone). Asterisk needs to know
      where the device is on the network. By defining the value as
      <code class="literal">dynamic</code>, we let Asterisk know that the telephone will
      tell us where it is on the network instead of having its location
      defined statically. If we wanted to define the address statically, we
      could replace <code class="literal">dynamic</code> with an IP address such as
      <code class="literal">192.168.128.30</code>.</p><p><a id="DeviceConfig_id291395"></a>The <code class="literal">nat</code><a id="I_indexterm5_d1e10981" class="indexterm"></a> option is used to tell Asterisk to enable some tricks to
      make phone calls work when a SIP phone may be located behind a NAT. This
      is important because the SIP protocol includes IP addresses in messages.
      If a phone is on a private network, it may end up placing private
      addresses in SIP messages, which are often not useful.</p><p><a id="DeviceConfig_id291414"></a>The password for the device is defined
      by the <code class="literal">secret</code><a id="I_indexterm5_d1e10989" class="indexterm"></a> parameter. While this is not strictly required, you
      should note that it is quite common for unsavory folks to run phishing
      scripts that look for exposed VoIP accounts with insecure passwords and
      simple device names (such as a device name of <code class="literal">100</code>
      with a password of <code class="literal">1234</code>). By utilizing an uncommon
      device name such as a MAC address, and a password that is a little
      harder to guess, we can significantly lower the risk to our system
      should we need to expose it to the outside world.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id291427"></a>You can generate a secure password
        <a id="I_indexterm5_d1e11002" class="indexterm"></a><a id="I_indexterm5_d1e11005" class="indexterm"></a>using one of several password generators available on
        the Internet and on your operating system. Here is a simple script
        that you can run at your console to generate one:</p><a id="I_programlisting5_d1e11011"></a><pre class="programlisting">          <code class="prompt">$ </code>
          <strong class="userinput"><code>dd if=/dev/random count=1 bs=8 2&gt;/dev/null | base64 | sed -e 's/=*$//'</code></strong>
        </pre></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DeviceConfig_id291440"></a>Do not use the password we have
        defined in the example. This book will be available online and can be
        downloaded by anyone, and that particular password is almost certain
        to become one of the first passwords added to the list employed by
        VoIP phishing scripts in brute-force password attacks. If your SIP
        ports are exposed to the Internet and you use simple passwords, rest
        assured that you will eventually be <span class="keep-together">defrauded</span>.</p></div><p><a id="DeviceConfig_id291448"></a>The
      <code class="literal">dtmfmode</code><a id="I_indexterm5_d1e11026" class="indexterm"></a> option is used to define which DTMF (touch-tone) format
      Asterisk should expect to be sent by the telephone. The four options
      are: <code class="literal">info</code>, <code class="literal">inband</code>,
      <code class="literal">rfc2833</code>, and <code class="literal">auto</code>. The
      <code class="literal">info</code> value means to use the SIP INFO method,
      <code class="literal">inband</code> is for inband audio tones, and
      <code class="literal">rfc2833</code> is for the out-of-band method defined by that
      RFC. Using <code class="literal">auto</code> allows Asterisk to automatically
      determine which DTMF mode to use (it prefers <code class="literal">rfc2833</code>
      if available).</p><p><a id="DeviceConfig_id291486"></a>The last two options,
      <code class="literal">disallow</code><a id="I_indexterm5_d1e11062" class="indexterm"></a> and <code class="literal">allow (sip.conf)</code>, are used to
      control which audio codecs are accepted from and offered to the
      telephone. By defining <code class="literal">disallow=all</code> first, we’re
      telling Asterisk to reset any previously defined codec definitions in
      the <code class="literal">[general]</code> section (or the internal defaults);
      then we explicitly declare which codecs we’ll accept (and the order we
      prefer). In our example we’ve enabled both <code class="literal">ulaw</code> and
      <code class="literal">alaw</code>, with <code class="literal">ulaw</code> most preferred (if
      you are outside of Canada or the US, you’ll likely want to declare
      <code class="literal">alaw</code> first).</p><p><a id="DeviceConfig_id291519"></a>Now that we’re finished with our
      template, we can define our device names and, utilizing the
      <code class="literal">office-phone</code> template, greatly simplify the amount of
      details required under each device section. The device name is defined
      in the square brackets, and the template to be applied is defined in the
      parentheses following the device name. We can add additional options to
      the device name by specifying them below the device name:</p><a id="DeviceConfig_id291530"></a><pre class="programlisting">[0000FFFF0003](office-phone) ; template must be on same line and no space between
secret=@N0th3rP4S5
allow=gsm</pre><p><a id="DeviceConfig_id291534"></a>As far as the SIP module in Asterisk
      can tell, it will end up reading this in as if it was a section defined
      like this, which is a configuration section with all of the options
      specified from the template first:</p><a id="DeviceConfig_id163963"></a><pre class="programlisting">[0000FFFF0003]

;
; These options came from the template section.
;
type=friend
context=LocalSets
host=dynamic
nat=yes 
secret=s3CuR#p@s5
dtmfmode=auto
disallow=all
allow=ulaw
allow=alaw

;
; These options came from the specific section.
;
secret=@N0th3rP4S5 ; Overrides the secret from the template
allow=gsm          ; Adds gsm to the list of allowed codecs</pre><p>Note that if you specify an option that was also specified in the
      template, the module will see that option twice. For most options, it
      will override the value in the template, but for some, such as
      <code class="literal">type</code>, <code class="literal">allow</code>, and
      <code class="literal">disallow</code>, it will not.<a id="I_indexterm5_d1e11111" class="indexterm"></a><a id="I_indexterm5_d1e11112" class="indexterm"></a></p></div><div class="sect2" title="iax.conf"><div class="titlepage"><div><div><h3 class="title"><a id="id534066"></a>iax.conf</h3></div></div></div><p><a id="index-465O241IB5N" class="indexterm"></a><a id="index-687R277AE8O" class="indexterm"></a><a id="index-186T380HQ2A" class="indexterm"></a>IAX2 stands for the Inter-Asterisk eXchange protocol,
      version 2. It was originally developed to connect Asterisk systems
      together across different physical networks, and especially those behind
      firewalls and NAT devices. IAX2 was designed to limit the number of
      ports required to carry VoIP calls across a firewall, and to easily
      traverse networks that employed NAT devices (which historically have
      been problematic for the SIP protocol). As Asterisk has developed over
      the years, the IAX2 protocol has matured. It was standardized in an IETF
      RFC in 2009,<sup>[<a id="id534121" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id534121" class="footnote">50</a>]</sup> but IAX2 has not become popular with hardware vendors,
      possibly due to the relative recency of the RFC, and certainly due to
      the fact that SIP is far and away the most recognized VoIP protocol in
      terms of mind-share (i.e., nontechnical folks have probably heard of
      SIP). IAX2, however, has advantages that make it a protocol worth
      discussing.</p><p><a id="DeviceConfig_id291563"></a>One of the primary advantages of IAX is
      single-port firewall penetration.<a id="I_indexterm5_d1e11140" class="indexterm"></a> All traffic, including signaling and audio data, is
      transferred over a single UDP port (4569), which can greatly simplify
      securing the VoIP network.<sup>[<a id="id534151" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id534151" class="footnote">51</a>]</sup></p><p><a id="DeviceConfig_id291581"></a>Another advantage is IAX2 trunking,
      which encapsulates packets for several voice frames into the same
      datagram using a single IAX2 header. The benefit of this is a reduction
      in the amount of overhead required to send many simultaneous calls
      between two endpoints. The amount of bandwidth saved with IAX2 trunking
      when sending just a couple of calls between locations is pretty
      insignificant, but when you start scaling to the size of dozens or
      hundreds of calls, the savings can be substantial.</p><p><a id="DeviceConfig_id291593"></a>For now, we’re only interested in the
      minimal configuration required to get our IAX2 endpoints talking to each
      other, so let’s explore what we need to configure in
      <code class="filename">iax.conf</code> to do so.</p><p><a id="DeviceConfig_id291601"></a>First, we need to create our
      <code class="filename">iax.conf</code> file in the
      <code class="filename">/etc/asterisk</code> configuration directory and add the
      following configuration information to the file:</p><a id="DeviceConfig_id291623"></a><pre class="programlisting">[general]
autokill=yes   ; don't stall for a long time if other endpoint doesn't respond
srvlookup=yes  ; enable DNS SRV lookups for outbound calls

[office-phone](!)    ; template for IAX-based office phones
type=friend          ; Asterisk will allow calls to and from this phone
host=dynamic         ; inform Asterisk that the phone will tell us where
                     ;   it is on the network
secret=my5UP3rp@s5!  ; a secure password -- which means DON'T USE THIS ONE!
context=LocalSets    ; the context where incoming requests will enter the dialplan
disallow=all         ; reset the available voice codecs
allow=ulaw           ; prefer the ulaw codec
allow=alaw           ; but also allow the alaw codec

[0000FFFF0004](office-phone) ; define our first phone with the office-phone template

[0000FFFF0005](office-phone) ; define another phone with our office-phone template</pre><p><a id="DeviceConfig_id291634"></a>Let’s go over the options we added to
      this file, starting first with the <code class="literal">[general]</code> section.
      This is where we define our default configuration, our global options,
      and our general channel driver setup. There are many options we can
      define here, and we encourage you to check out the
      <code class="filename">iax.conf.sample</code> file in the
      <code class="filename">configs</code> directory of your Asterisk source,<sup>[<a id="id534255" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id534255" class="footnote">52</a>]</sup> but since we’re looking for a straightforward
      configuration, we’re going to allow many of the default options to be
      applied.</p><p><a id="DeviceConfig_id291658"></a>One option we have added is
      <code class="literal">autokill</code><a id="I_indexterm5_d1e11188" class="indexterm"></a>, which is used to instruct the
      <code class="filename">chan_iax2.so</code> channel driver not to wait around too
      long on stalled connections. Also,
      <code class="literal">srvlookup</code><a id="I_indexterm5_d1e11197" class="indexterm"></a> has been enabled to allow DNS SRV lookups for outgoing
      calls.</p><p><a id="DeviceConfig_id291673"></a>The next section we’ve defined is named
      <code class="literal">[office-phone](!)</code>, which is a template that contains
      the options we’ll apply to our IAX phones and the authentication
      information required for communication between the phones and
      Asterisk.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id291683"></a>As mentioned in the preceding
        section, following the section name with <code class="literal">(!)</code> tells
        Asterisk to treat this section as a template. Templates are useful, so
        use them(!).</p></div><p><a id="DeviceConfig_id291692"></a>The first option we’ve configured in
      our template is the <code class="literal">type</code>. We’ve defined the
      <code class="literal">type</code> to be <code class="literal">friend</code>, which informs
      Asterisk that we plan on placing calls to the phone and that we expect
      to receive requests (calls) from the phone.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id291709"></a>The other two types are
        <code class="literal">user</code> and <code class="literal">peer</code>. In IAX2, a
        <code class="literal">friend</code> is a combination of both a
        <code class="literal">user</code> and a <code class="literal">peer</code>, which is common
        for telephones because we expect to send calls to them, and to receive
        requests for placing calls from them. We could alternatively define
        two separate sections with the same name with types of
        <code class="literal">user</code> and <code class="literal">peer</code>, and then define
        only the required information for each of those types; or if we only
        ever expected to send calls to or place calls using a section (such as
        in the case of an inbound- or outbound-only service provider), we
        would define it as only either a <code class="literal">user</code> or a
        <code class="literal">peer</code>. However, in the vast majority of cases, just
        utilizing the <code class="literal">type</code> of <code class="literal">friend</code> is
        the most logical choice.</p><p><a id="DeviceConfig_id164186"></a>Note the difference between the
        meaning of the <code class="literal">type</code> option in
        <code class="filename">iax.conf</code> versus <code class="filename">sip.conf</code>
        (see the sidebar <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291332" title="SIP Configuration Matching and the type Option">SIP Configuration Matching and the type Option</a>). In
        <code class="filename">iax.conf</code>, the meaning is much simpler: it only
        has to do with the direction of the phone calls.</p></div><p><a id="DeviceConfig_id291747"></a>Following the <code class="literal">type</code>
      option, we’ve set <code class="literal">host</code> to <code class="literal">dynamic</code>,
      which means the phone will register with us to identify where it exists
      on the network (so that we know where to send its calls). Alternatively,
      we could statically define an IP address such as
      <code class="literal">192.168.128.50</code> where all calls will be sent to and
      accepted from. This will only work if the device will always have the
      same IP address.</p><p><a id="DeviceConfig_id291766"></a>The next option is
      <code class="literal">secret</code><a id="I_indexterm5_d1e11295" class="indexterm"></a>, which defines the password.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DeviceConfig_id291775"></a>You should make sure you are
        implementing a secure password here, especially if you plan on opening
        your system up to the outside world at all. Do not use something
        stupid such as <code class="literal">1234</code>, or you’ll regret it. No,
        seriously. We’re not kidding. Not even in the lab.</p></div><p><a id="DeviceConfig_id291782"></a>The number of successful attacks on
      VoIP-enabled telephone systems (not just Asterisk) is on the rise, and
      will continue to get worse. Commonly, successful intrusions are due to
      weak passwords. If you get in the habit of using strong passwords now,
      you’ll have that much more protection in the future.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id291790"></a>You can generate a complex password
        <a id="I_indexterm5_d1e11310" class="indexterm"></a>using a password generator like those available on the
        Internet and on your operating system. Here is a simple script that
        you can run at the Linux shell prompt to generate a string that’ll be
        suitable as a password:</p><a id="I_programlisting5_d1e11316"></a><pre class="programlisting"><code class="prompt">$ </code>dd <strong class="userinput"><code>if=/dev/random count=1 bs=8 2&gt;/dev/null | base64 | sed -e 's/=*$//'</code></strong></pre></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DeviceConfig_id291801"></a>Do not use the password we have
        defined in the example. You can be sure that shortly after this book
        is published, that will be one of the first passwords a brute-force
        bot will try to use on your system.</p></div><p><a id="DeviceConfig_id291808"></a>The
      <code class="literal">context</code><a id="I_indexterm5_d1e11329" class="indexterm"></a> option defines the context at which this channel will
      enter the dialplan. When a call is placed by a telephone and the request
      is received by Asterisk, it is handled by the logic defined in the
      context configured here within the dialplan
      (<code class="filename">extensions.conf</code>).</p><p><a id="DeviceConfig_id291819"></a>Following that are the
      <code class="literal">disallow</code><a id="I_indexterm5_d1e11340" class="indexterm"></a> and <code class="literal">allow</code><a id="I_indexterm5_d1e11346" class="indexterm"></a> options. These define the codecs that will be allowed for
      this channel (in order of preference). The directive
      <code class="literal">disallow=all</code> resets any default codecs that may have
      been permitted in the <code class="literal">[general]</code> section (or as part
      of the channel defaults). Then, we define the specific codecs we wish to
      permit with <code class="literal">allow</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id291844"></a>If we wanted to use specific codecs
        <a id="I_indexterm5_d1e11363" class="indexterm"></a>for one of our devices, we could define that codec
        within the device configuration section for that channel simply by
        adding it below the device section header:<a id="I_indexterm5_d1e11369" class="indexterm"></a><a id="I_indexterm5_d1e11370" class="indexterm"></a><a id="I_indexterm5_d1e11371" class="indexterm"></a></p><a id="DeviceConfig_id291849"></a><pre class="programlisting">[0004F2FF0006](office-phone)
disallow=all ; Clear previous codec settings.
allow=gsm    ; Allow only gsm.</pre></div></div><div class="sect2" title="Modifying Your Channel Configuration Files for Your Environment"><div class="titlepage"><div><div><h3 class="title"><a id="id534809"></a>Modifying Your Channel Configuration Files for Your
      Environment</h3></div></div></div><p><a id="DeviceConfig_id291866"></a><a id="I_indexterm5_d1e11378" class="indexterm"></a><a id="I_indexterm5_d1e11385" class="indexterm"></a><a id="I_indexterm5_d1e11390" class="indexterm"></a>Our examples so far have been based on hypothetical device
      names. To create actual channels based on whatever you have in your
      environment, you will want to change the device names in your
      <code class="filename">sip.conf</code> and <code class="filename">iax.conf</code> files to
      something that makes more sense.</p><p><a id="DeviceConfig_id291878"></a>For example, if you have a Polycom IP
      430 set with a MAC address of <code class="literal">0004f2119698</code>, you’ll
      want to define a device identifier in <code class="filename">sip.conf</code> for
      that device:</p><a id="DeviceConfig_id291888"></a><pre class="programlisting">[0004f2119698](office-phone)
</pre><p><a id="DeviceConfig_id291892"></a>If you have an IAX softphone <a id="I_indexterm5_d1e11414" class="indexterm"></a>on your PC that you wish to use, your
      <code class="filename">iax.conf</code> file may want something like this:</p><a id="DeviceConfig_id291899"></a><pre class="programlisting">[001b63a28ccc](office-phone) ; you could have a comment like Leif's Laptop
</pre><p><a id="DeviceConfig_id291903"></a>Remember that you can name your devices
      anything you want. Asterisk doesn’t care, but for ease of management,
      make sure you choose a naming convention that is logical, scalable, and
      sustainable.<a id="I_indexterm5_d1e11425" class="indexterm"></a></p></div></div><div class="sect1" title="Loading Your New Channel Configurations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id291909"></a>Loading Your New Channel Configurations</h2></div></div></div><p><a id="DeviceConfig_id291914"></a><a id="I_indexterm5_d1e11430" class="indexterm"></a><a id="I_indexterm5_d1e11435" class="indexterm"></a><a id="I_indexterm5_d1e11440" class="indexterm"></a>In order to inform Asterisk of the new configurations, you
    will need to pass it a command that instructs it to reload the relevant
    configuration file. The Asterisk CLI is where you can pass various
    commands to a running Asterisk system.</p><div class="sect2" title="The Asterisk CLI"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceConfig_id291920"></a>The Asterisk CLI</h3></div></div></div><p><a id="DeviceConfig_id291925"></a><a id="I_indexterm5_d1e11450" class="indexterm"></a>The best way to see what is happening with your Asterisk
      system is through the Asterisk CLI. This interface provides various
      levels of output to let you know what is happening on your system, and
      offers a wealth of useful utilities to allow you to affect your running
      system. Begin by calling up the Asterisk CLI and reloading the
      configuration files for your channel modules:</p><a id="DeviceConfig_id291931"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo asterisk -r</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload chan_sip.so</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload chan_iax2.so</code></strong></pre><p><a id="DeviceConfig_id291942"></a>Verify that your new channels have been
      loaded:</p><a id="DeviceConfig_id291946"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip show peers</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip show users</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>iax2 show peers</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>iax2 show users</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id291963"></a>At this point your Asterisk system
        should be configured to handle registrations <a id="I_indexterm5_d1e11502" class="indexterm"></a>from the defined devices. Calls to and from the sets
        will not work until the configuration on the devices has been
        completed. Since each device is different in this regard, detailed
        configuration instructions for each model are outside of the scope of
        this book.</p></div></div></div><div class="sect1" title="Testing to Ensure Your Devices Have Registered"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id291973"></a>Testing to Ensure Your Devices Have Registered</h2></div></div></div><p><a id="DeviceConfig_id291978"></a><a id="I_indexterm5_d1e11512" class="indexterm"></a><a id="I_indexterm5_d1e11517" class="indexterm"></a><a id="I_indexterm5_d1e11522" class="indexterm"></a><a id="I_indexterm5_d1e11527" class="indexterm"></a>Once your device has registered to Asterisk, you will be
    able to query the location and state of the device from the Asterisk
    CLI.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceConfig_id291985"></a>It is a common misconception that
      registration is how a device authenticates itself for the purpose of
      obtaining permission to make calls. This is incorrect. The only purpose
      of registration is to allow a device to identify its location on the
      network, so that Asterisk<sup>[<a id="id535258" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id535258" class="footnote">53</a>]</sup> knows where to send calls intended for that device.</p><p><a id="DeviceConfig_id291997"></a>Authentication for outgoing calls is an
      entirely separate process and always happens on a per-call basis,
      regardless of whether a set has registered. This means that your set may
      be able to make calls, but not receive them. This will normally happen
      when the set has not registered successfully (so Asterisk does not know
      where it is), and yet has the correct credentials for making calls (so
      Asterisk is willing to accept calls from it).</p></div><p><a id="DeviceConfig_id292005"></a>To check the registration status of a
    device, simply call up the Asterisk CLI:</p><a id="DeviceConfig_id292009"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo asterisk -r</code></strong></pre><p><a id="DeviceConfig_id292023"></a>Typing the following command returns a
    listing of all the peers that Asterisk knows about (regardless of their
    state):</p><a id="DeviceConfig_id292027"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip show peers</code></strong>
Name/username              Host            Dyn Nat ACL Port     Status
0000FFFF0001/0000FFFF0001    192.168.1.100    D   N      5060     Unmonitored
0000FFFF0002/0000FFFF0002    192.168.1.101    D   N      5060     Unmonitored
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>You may notice that the <code class="literal">Name/username</code> field
      does not always show the full name of the device. This is because this
      field is limited to 25 <span class="keep-together">characters</span>.</p></div><p><a id="DeviceConfig_id292042"></a>Note that the <code class="literal">Status</code>
    in our example is set to <code class="literal">Unmonitored</code>. This is because
    we are not using the <code class="literal">qualify=yes</code> option in our
    <code class="filename">sip.conf</code> file.</p></div><div class="sect1" title="Analog Phones"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id164614"></a>Analog Phones</h2></div></div></div><p><a id="DeviceConfig_id164619"></a><a id="index-260B257SM4T" class="indexterm"></a><a id="index-826Q831RL6U" class="indexterm"></a>There are two popular methods for connecting analog phones
    to Asterisk. The first is by using an ATA that most commonly connects to
    Asterisk using the SIP protocol. The Asterisk configuration for an ATA is
    the same as it would be for any other SIP-based handset. The other method
    is to directly connect the phones to the Asterisk server using telephony
    hardware from a vendor such as Digium. Digium sells telephony cards
    <a id="I_indexterm5_d1e11597" class="indexterm"></a>that can be added to your server to provide FXS ports for
    connecting analog phones (or fax machines). For the purposes of
    demonstrating the configuration, we’re going to show the configuration
    required if you had a Digium AEX440E card, which is an AEX410 half-length
    PCI-Express with four FXS modules and hardware-based echo
    cancellation.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id164631"></a>Regardless of which hardware you are
      using, consult your vendor’s documentation for any hardware-specific
      configuration requirements.</p></div><p><a id="DeviceConfig_id164637"></a>First, ensure that both Asterisk and
    DAHDI are installed (refer back to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it" title="How to Install It">the section called “How to Install It”</a> for instructions). Note that
    DAHDI must be installed before you install Asterisk. When you install
    DAHDI, be sure to install the <code class="filename">init</code> script as well.
    This will ensure that your hardware is properly initialized when the
    system boots up. The <code class="filename">init</code> script is installed from
    the <code class="filename">DAHDI-tools</code> package.</p><p><a id="DeviceConfig_id164650"></a>The <code class="filename">init</code> script uses
    the <code class="filename">/etc/dahdi/modules</code> file to determine which
    modules should be loaded to support the hardware in the system. The
    installation of the <code class="filename">init</code> script attempts to
    automatically set up this file for you, but you should check it to make
    sure it is correct:</p><a id="DeviceConfig_id164659"></a><pre class="programlisting"># Autogenerated by tools/xpp/dahdi_genconf (Dahdi::Config::Gen::Modules) on 
# Tue Jul 27 10:31:46 2010
# If you edit this file and execute tools/xpp/dahdi_genconf again,
# your manual changes will be LOST.
wctdm24xxp
</pre><p><a id="DeviceConfig_id164664"></a>There is one more configuration file
    required for DAHDI: <code class="filename">/etc/dahdi/system.conf</code>. It looks
    like this:</p><a id="DeviceConfig_id164671"></a><pre class="programlisting"># Specify that we would like DAHDI to generate tones that are
# used in the United States.
loadzone = us
defaultzone = us

# We have 4 FXS ports; configure them to use FXO signaling.
fxoks = 1-4</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id164678"></a>This configuration assumes the card is
      being used in the United States. For some tips on
      internationalization,<a id="I_indexterm5_d1e11643" class="indexterm"></a> see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization" title="Chapter 9. Internationalization">Chapter&nbsp;9, <em>Internationalization</em></a>.</p></div><p><a id="DeviceConfig_id164688"></a>If the card you are configuring does not
    have hardware-based echo cancellation, another line will need to be added
    to <code class="filename">/etc/dahdi/system.conf</code> to enable software-based
    echo cancellation:</p><a id="DeviceConfig_id164695"></a><pre class="programlisting">echocanceller = mg2,1-4</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceConfig_id164701"></a>MG2 <a id="I_indexterm5_d1e11662" class="indexterm"></a>is the recommended echo canceller <a id="I_indexterm5_d1e11666" class="indexterm"></a>that comes with the official DAHDI package. There is
      another open source echo canceller out there that is compatible with
      DAHDI, called OSLEC (Open Source Line Echo Canceller). Many people
      report very good results with the use of OSLEC. For more information
      about the installation of OSLEC on your system, see the website at
      <a class="ulink" href="http://www.rowetel.com/blog/oslec.html" target="_top">http://www.rowetel.com/blog/oslec.html</a>.</p></div><p><a id="DeviceConfig_id164714"></a>Now, use the <code class="filename">init</code>
    script to load the proper modules and initialize the hardware:</p><a id="DeviceConfig_id164718"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo /etc/init.d/dahdi start</code></strong>
Loading DAHDI hardware modules:
  wctdm24xxp:                                              [  OK  ]

Running dahdi_cfg:                                         [  OK  ]</pre><p><a id="DeviceConfig_id164728"></a>Now that DAHDI has been configured, it is
    time to move on to the relevant configuration of Asterisk. Once Asterisk
    is installed, ensure that the <code class="literal">chan_dahdi</code> module has
    been installed. If it is not loaded in Asterisk, check to see if it exists
    in <code class="filename">/usr/lib/asterisk/modules/</code>. If it is there, edit
    <code class="filename">/etc/asterisk/modules.conf</code> to load
    <code class="filename">chan_dahdi.so</code>. If the module is not present on disk,
    DAHDI was not installed before installing Asterisk; go back and install it
    now (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870" title="DAHDI">the section called “DAHDI”</a> for details). You can
    verify its presence using the following command:</p><a id="DeviceConfig_id164735"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module show like chan_dahdi.so</code></strong>
Module                         Description                              Use Count 
chan_dahdi.so                  DAHDI Telephony Driver                   0         
1 modules loaded
</pre><p><a id="DeviceConfig_id164745"></a>Next, you must configure
    <code class="filename">/etc/asterisk/chan_dahdi.conf</code>. This is the
    configuration file for the <code class="literal">chan_dahdi</code> module, which is
    the interface between Asterisk and DAHDI. It should look like this:</p><a id="DeviceConfig_id164750"></a><pre class="programlisting">[trunkgroups]

; No trunk groups are needed in this configuration.

[channels]

; The channels context is used when defining channels using the
; older deprecated method.  Don't use this as a section name.

[phone](!)
;
; A template to hold common options for all phones.
;
usecallerid = yes
hidecallerid = no
callwaiting = no
threewaycalling = yes
transfer = yes
echocancel = yes
echotraining = yes
immediate = no
context = LocalSets
signalling = fxo_ks ; Uses FXO signaling for an FXS channel 

[phone1](phone)
callerid = "Mark Michelson" &lt;(256)555-1212&gt;
dahdichan = 1

[phone2](phone)
callerid = "David Vossel" &lt;(256)555-2121&gt;
dahdichan = 2

[phone3](phone)
callerid = "Jason Parker" &lt;(256)555-3434&gt;
dahdichan = 3

[phone4](phone) 
callerid = "Matthew Nicholson" &lt;(256)555-4343&gt;
dahdichan = 4
</pre><p><a id="DeviceConfig_id164762"></a>You can verify that Asterisk has loaded
    your configuration by running the <span class="command"><strong>dahdi show channels</strong></span>
    CLI command:</p><a id="DeviceConfig_id164776"></a><pre class="programlisting"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>dahdi show channels</code></strong>
   Chan Extension  Context         Language   MOH Interpret    Blocked    State     
 pseudo            default                    default                     In Service
      1            LocalSets                  default                     In Service
      2            LocalSets                  default                     In Service
      3            LocalSets                  default                     In Service
      4            LocalSets                  default                     In Service</pre><p>For detailed information on a specific channel, you can run
    <span class="command"><strong>dahdi show channel
    <em class="replaceable"><code>1</code></em></strong></span>.<a id="I_indexterm5_d1e11740" class="indexterm"></a><a id="I_indexterm5_d1e11741" class="indexterm"></a></p></div><div class="sect1" title="A Basic Dialplan to Test Your Devices"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id292056"></a>A Basic Dialplan to Test Your Devices</h2></div></div></div><p><a id="DeviceConfig_id292061"></a><a id="I_indexterm5_d1e11747" class="indexterm"></a><a id="I_indexterm5_d1e11752" class="indexterm"></a><a id="I_indexterm5_d1e11757" class="indexterm"></a><a id="I_indexterm5_d1e11762" class="indexterm"></a>We’re not going to dive too deeply into the dialplan just
    yet, but an initial dialplan that you can use to test your newly
    registered devices will be helpful. Place the following contents in
    <code class="filename">/etc/asterisk/extensions.conf</code>:</p><a id="DeviceConfig_id292071"></a><pre class="programlisting">[LocalSets]

exten =&gt; 100,1,Dial(SIP/0000FFFF0001) ; Replace 0000FFFF0001 with your device name

exten =&gt; 101,1,Dial(SIP/0000FFFF0002) ; Replace 0000FFFF0002 with your device name

;
; These will allow you to dial each of the 4 analog phones configured
; in the previous section.
;
exten =&gt; 102,1,Dial(DAHDI/1)
exten =&gt; 103,1,Dial(DAHDI/2)
exten =&gt; 104,1,Dial(DAHDI/3)
exten =&gt; 105,1,Dial(DAHDI/4)

exten =&gt; 200,1,Answer()
    same =&gt; n,Playback(hello-world)
    same =&gt; n,Hangup()
</pre><p><a id="DeviceConfig_id292089"></a>This basic dialplan will allow you to
    dial your SIP devices using extensions 100 and 101. The four lines of the
    analog card can be dialed with extensions 102 through 105, respectively.
    You can also listen to the <code class="literal">hello-world</code> prompt that was
    created for this book by dialing extension 200. All of these extensions
    are arbitrary numbers, and could be anything you want. Also, this is by no
    means a complete dialplan; we’ll develop it further in later
    chapters.</p><p><a id="DeviceConfig_id292098"></a>You will need to reload your dialplan
    before changes will take effect in Asterisk. You can reload it from the
    Linux shell:</p><a id="DeviceConfig_id292102"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo asterisk -rx "dialplan reload"</code></strong></pre><p><a id="DeviceConfig_id292108"></a>or from the Asterisk CLI:</p><a id="DeviceConfig_id292111"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>dialplan reload</code></strong></pre><p><a id="DeviceConfig_id292116"></a>You should now be able to dial between
    your two new extensions. Open up the CLI in order to see the call
    progression. You should see something like this (and the set you are
    calling should ring):</p><a id="DeviceConfig_id292121"></a><pre class="screen">    -- Executing [100@LocalSets:1] Dial("SIP/0000FFFF0001-0000000c", 
       "SIP/0000FFFF0001") in new stack
    -- Called 0000FFFF0001
    -- SIP/0000FFFF0001-0000000d is ringing</pre><p><a id="DeviceConfig_id292126"></a>If this does not happen, you are going to
    need to review your configuration and ensure you have not made any
    typos.</p></div><div class="sect1" title="Under the Hood: Your First Call"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id292132"></a>Under the Hood: Your First Call</h2></div></div></div><p><a id="DeviceConfig_id292137"></a><a id="I_indexterm5_d1e11806" class="indexterm"></a>In order to get you thinking about what is happening under
    the hood, we’re going to briefly cover some of what is actually happening
    with the SIP protocol when two sets on the same Asterisk system call each
    other.</p><div class="note" title="Asterisk as a B2BUA" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Asterisk as a B2BUA</h3><p><a id="DeviceConfig_id292147"></a><a id="I_indexterm5_d1e11816" class="indexterm"></a>Bear in mind that there are actually two calls going on
      here: one from the originating set to Asterisk, and another from
      Asterisk to the destination set. SIP is a peer-to-peer protocol, and
      from the perspective of the protocol there are two calls happening. The
      SIP protocol is not aware that Asterisk is bridging the calls; each set
      understands its connection to Asterisk, with no real knowledge of the
      set on the other side. It is for this reason that Asterisk is often
      referred to as a B2BUA (Back to Back User Agent). This is also why it is
      so easy to bridge different protocols together using Asterisk.</p></div><p><a id="DeviceConfig_id292163"></a>For the call you just made, the dialogs
    shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292168" title="Figure 5.2. SIP dialogs">Figure&nbsp;5.2, “SIP dialogs”</a> will have taken
    place.</p><p><a id="DeviceConfig_id292187"></a>For more details on how SIP messaging
    works, please refer to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a> and
    the SIP RFC at <a class="ulink" href="http://www.ietf.org/rfc/rfc3261.txt" target="_top">http://www.ietf.org/rfc/rfc3261.txt</a>.</p><div class="figure-float"><div class="figure"><a id="DeviceConfig_id292168"></a><p class="title"><strong>Figure&nbsp;5.2.&nbsp;SIP dialogs</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject5_d1e11833"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0502.png" width="486" alt="SIP dialogs"></div></div></div><br class="figure-break"></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceConfig_id292192"></a>Conclusion</h2></div></div></div><p><a id="DeviceConfig_id292197"></a>In this chapter we learned best practices
    for device naming by abstracting the concepts of users, extension numbers,
    and devices, and how to define the device configuration and authentication
    parameters in the channel configuration files. Next, we’ll delve into the
    magic of Asterisk that is the dialplan, and see how simple things can
    create <span class="keep-together">great results</span>.<a id="I_indexterm5_d1e11846" class="indexterm"></a><a id="I_indexterm5_d1e11847" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id531555" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id531555" class="para">42</a>] </sup>This has nothing to do with Asterisk configuration, and each
      hardware manufacturer will have its own tools to allow you to configure
      its devices.</p></div><div class="footnote"><p><sup>[<a id="ftn.id531687" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id531687" class="para">43</a>] </sup>Actually, Asterisk does try to implement and abstract the
        concepts of users and devices internally by using the
        <code class="filename">users.conf</code><a id="I_indexterm5_d1e10306" class="indexterm"></a><a id="I_indexterm5_d1e10309" class="indexterm"></a> file; however, it is typically only used by the
        Asterisk GUI. Abstracting the concepts logically using the dialplan is
        easier to understand and far more flexible.</p></div><div class="footnote"><p><sup>[<a id="ftn.id532060" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532060" class="para">44</a>] </sup>Or any other network, for that matter. ATAs could more formally
        be said to be analog-to-digital gateways, where the nature of the
        digital protocol may vary (e.g., proprietary ATAs on traditional
        PBXs).</p></div><div class="footnote"><p><sup>[<a id="ftn.id532127" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532127" class="para">45</a>] </sup>An ATA is not the only way to connect analog phones. Hardware
        vendors such as Digium sell cards that go in the Asterisk server and
        provide analog telephony ports.</p></div><div class="footnote"><p><sup>[<a id="ftn.id532134" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532134" class="para">46</a>] </sup>For a really awesome cordless analog phone, you want to check
        out the EnGenius DuraFon devices, which are expensive, but
        impressive.</p></div><div class="footnote"><p><sup>[<a id="ftn.id532746" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532746" class="para">47</a>] </sup>The SIP RFC is a long read, but about the first 25 pages are a
          good introduction. Check it out at <a class="ulink" href="http://www.ietf.org/rfc/rfc3261.txt" target="_top">http://www.ietf.org/rfc/rfc3261.txt</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id532995" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532995" class="para">48</a>] </sup>The whole concept of security and trust on a VoIP network is
            something that can become quite complex. Spammers are already hard
            at work figuring out this technology, and you need to be aware of
            the concepts. We’ll cover this in more depth later in the book,
            such as in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id533057" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id533057" class="para">49</a>] </sup><a id="I_indexterm5_d1e10752" class="indexterm"></a>The complement to this option is
          <code class="literal">tcpbindaddr</code>, used for listening for requests
          carried via the TCP network transport protocol.</p></div><div class="footnote"><p><sup>[<a id="ftn.id534121" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534121" class="para">50</a>] </sup><a class="ulink" href="http://www.rfc-editor.org/rfc/rfc5456.txt" target="_top">http://www.rfc-editor.org/rfc/rfc5456.txt</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id534151" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534151" class="para">51</a>] </sup>SIP, which has separate signaling and voice data protocols and
          ports, requires port 5060 for signaling, and at least two RTP ports
          for every active call for voice. By default, Asterisk uses ports
          5060 for SIP and 10,000 through 20,000 for RTP, although that can be
          tuned with the <code class="filename">rtp.conf</code> file.</p></div><div class="footnote"><p><sup>[<a id="ftn.id534255" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534255" class="para">52</a>] </sup>We also encourage you to read <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081" title="sip.conf">the section called “sip.conf”</a> in this chapter, as it contains
          many concepts that apply equally to other Asterisk configuration
          files.</p></div><div class="footnote"><p><sup>[<a id="ftn.id535258" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id535258" class="para">53</a>] </sup>Or any other SIP registrar server, for that matter.</p></div></div></div><div class="chapter" title="Chapter 6. Dialplan Basics"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-DP-Basics"></a>Chapter&nbsp;6.&nbsp;Dialplan Basics</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2">Extensions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.3">Priorities</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id261938">Unnumbered priorities</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262049">The 'same =&gt;' operator</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262089">Priority labels</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2">A Simple Dialplan</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.3">Hello World</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3">Building an Interactive Dialplan</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2">Handling Invalid Entries and Timeouts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.3">Using the Dial() Application</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292362">Argument 1: Destination</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292588">Argument 2: Timeout</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292662">Argument 3: Option</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292716">Argument 4: URI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292738">Updating the dialplan</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292773">Blank arguments</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.1">Global variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.2">Channel variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.3">Environment variables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.4">Adding variables to our dialplan</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6">Pattern Matching</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8">Includes</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-4">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="DialplanBasics_id281852"></a>Everything should be made as simple as
    possible, <span class="keep-together">but not simpler</span>.</p><div class="attribution"><span>—<span class="attribution">Albert Einstein</span></span></div></div><p><a id="DialplanBasics_id284432"></a><a id="index-513D558OT4L" class="indexterm"></a><a id="index-516J641IB2E" class="indexterm"></a>The dialplan is the heart of your Asterisk system. It defines
  how calls flow into and out of the system. A form of scripting language, the
  dialplan contains instructions that Asterisk follows in response to external
  triggers. In contrast to traditional phone systems, Asterisk’s dialplan is
  fully customizable.</p><p><a id="DialplanBasics_id254021"></a>This chapter introduces the essential
  concepts of the dialplan. The information presented here is critical to your
  understanding of dialplan code and will form the basis of any dialplan you
  write. The examples have been designed to build upon one another, and we
  recommend that you do not skip too much of this chapter, since it is so
  fundamentally important to Asterisk. Please also note that this chapter is
  by no means an exhaustive survey of all the possible things dialplans can
  do; our aim is to cover just the essentials. We’ll cover more advanced
  dialplan topics in later chapters. You are encouraged to experiment.</p><div class="sect1" title="Dialplan Syntax"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-DP-Basics-SECT-1"></a>Dialplan Syntax</h2></div></div></div><p><a id="DialplanBasics_id283801"></a><a id="index-186B217BG5C" class="indexterm"></a><a id="index-131F807WN7T" class="indexterm"></a>The Asterisk dialplan is specified in the configuration file
    named <code class="filename">extensions.conf</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-23"></a>Tip</h3><p><a id="DialplanBasics_id285012"></a>The <code class="filename">extensions.conf</code><a id="I_indexterm6_d1e11894" class="indexterm"></a><a id="I_indexterm6_d1e11897" class="indexterm"></a> file usually resides in the <code class="filename">/etc/asterisk/</code> directory, but its location
      may vary depending on how you installed Asterisk. Other common locations
      for this file include <code class="filename">/usr/local/etc/asterisk/</code> and <code class="filename">/opt/etc/asterisk/</code>.</p></div><p><a id="DialplanBasics_id283412"></a>The dialplan is made up of four main
    concepts: contexts, extensions, priorities, and applications. After
    explaining the role each of these elements plays in the <span class="keep-together">dialplan</span>, we’ll have you build a basic but
    functioning dialplan.</p><div class="sidebar" title="Sample Configuration Files"><a id="asterisk-DP-Basics-SIDEBAR-1.1"></a><div class="titlepage"><div><div><p class="title"><strong>Sample Configuration Files</strong></p></div></div></div><p><a id="DialplanBasics_id215379"></a>If you installed the sample
      configuration files <a id="I_indexterm6_d1e11922" class="indexterm"></a>when you installed Asterisk, you will most likely have an
      existing <code class="filename">extensions.conf</code>
      file<a id="I_indexterm6_d1e11929" class="indexterm"></a>. Instead of starting with the sample file, we suggest
      that you build your <span class="emphasis"><em>extensions.conf</em></span> file from
      scratch. Starting with the sample file is not the best or easiest way to
      learn how to build dialplans.</p><p><a id="DialplanBasics_id287802"></a>That being said, the sample <code class="filename">extensions.conf</code> file remains a fantastic
      resource, full of examples and ideas that you can use after you’ve
      learned the basic concepts. If you followed our installation
      instructions, you will find the file <code class="filename">extensions.conf.sample</code> in the folder
      <code class="filename">~/src/asterisk-complete/asterisk/1.8/configs</code>
      (along with many other sample config files).</p></div><div class="sect2" title="Contexts"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-1.1"></a>Contexts</h3></div></div></div><p><a id="DialplanBasics_id216015"></a><a id="I_indexterm6_d1e11953" class="indexterm"></a><a id="I_indexterm6_d1e11960" class="indexterm"></a>Dialplans are broken into sections called
      <span class="emphasis"><em>contexts</em></span>. Contexts keep different parts of the
      dialplan from interacting with one another. An extension that is defined
      in one context is completely isolated from extensions in any other
      context, unless interaction is specifically allowed. (We’ll cover how to
      allow interaction between contexts near the end of the chapter. See
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8" title="Includes">the section called “Includes”</a> for more
      information.)</p><p><a id="DialplanBasics_id270310"></a>As a simple example, let’s imagine we
      have two companies sharing an Asterisk server. If we place each
      company’s automated attendant in its own context, they will be
      completely separated from each other. This allows us to independently
      define what happens when, say, extension 0 is dialed: Callers dialing
      <code class="literal">0</code> from Company A’s voice menu will
      get Company A’s receptionist, while callers dialing <code class="literal">0</code> at Company B’s voice menu will get Company
      B’s receptionist. (This assumes, of course, that we’ve told Asterisk to
      transfer the calls to the receptionists when callers press <code class="literal">0</code>.<sup>[<a id="id536698" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id536698" class="footnote">54</a>]</sup>)</p><p><a id="DialplanBasics_id270344"></a>Contexts are defined by placing the
      name of the context inside square brackets (<code class="literal">[]</code>). <a id="I_indexterm6_d1e11999" class="indexterm"></a><a id="I_indexterm6_d1e12002" class="indexterm"></a>The name can be made up of the letters A through Z (upper-
      and lowercase), the numbers 0 through 9, and the hyphen and
      underscore.<sup>[<a id="asterisk-DP-Basics-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-DP-Basics-FN-1" class="footnote">55</a>]</sup> A context for incoming calls might look like this:</p><a id="I_programlisting5_tt717"></a><pre class="programlisting">[incoming]</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DialplanBasics_id270375"></a>Context names have a maximum length
        of 79 characters (80 characters – 1 terminating null).</p></div><p><a id="DialplanBasics_id270381"></a>All of the instructions placed after
      a context definition are part of that context, until the next context is
      defined. At the beginning of the dialplan, there are two special
      contexts named <code class="literal">[general]</code> <a id="I_indexterm6_d1e12020" class="indexterm"></a>and <code class="literal">[globals]</code><a id="I_indexterm6_d1e12028" class="indexterm"></a>. The <code class="literal">[general]</code> section
      contains a list of general dialplan settings (which you’ll probably
      never have to worry about), and we will discuss the <code class="literal">[globals]</code> context in the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.1" title="Global variables">the section called “Global variables”</a>. For now, it’s just important
      to know that these two labels are not really contexts. Avoid the use of
      <code class="literal">[general]</code>, <code class="literal">[default]</code>, and <code class="literal">[globals]</code> as context names, but otherwise name
      your contexts anything you wish.</p><p>When you define a channel (which is not done in the <code class="filename">extensions.conf</code> file, but rather in files
      such as <code class="filename">sip.conf</code>, <code class="filename">iax.conf</code>, <code class="filename">chan_dahdi.conf</code>, etc.), one of the required
      parameters in each channel definition is <code class="code">context</code>.
      <span class="emphasis"><em>The context is the point in the dialplan where connections
      from that channel <a id="I_indexterm6_d1e12070" class="indexterm"></a>will begin.</em></span> The context setting for the channel
      is how you plug the channel into the dialplan. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id36055184" title="Figure 6.1. Relation between channel configuration files and contexts in the dialplan">Figure&nbsp;6.1, “Relation between channel configuration files and contexts in
        the dialplan”</a> illustrates the relationship
      between channel configuration files and contexts in the dialplan.</p><div class="figure-float"><div class="figure"><a id="DialplanBasics_id36055184"></a><p class="title"><strong>Figure&nbsp;6.1.&nbsp;Relation between channel configuration files and contexts in
        the dialplan</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject6_d1e12082"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0601.png" alt="Relation between channel configuration files and contexts in the dialplan"></div></div></div><br class="figure-break"></div><p><a id="DialplanBasics_id216310"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DialplanBasics_id216335"></a>This is one of the most important
          concepts to understand when dealing with channels and dialplans.
          Once you understand the relationship of the context definition in a
          channel to the matching context in the <span class="keep-together">dial</span><span class="keep-together">plan</span>, you will find it much easier to
          troubleshoot the call flow through an Asterisk system.</p></div><p>An important use of contexts (perhaps the most important use)
      is to provide security. By using contexts correctly, you can give
      certain callers access to features (such as long-distance calling) that
      aren’t made available to others. If you do not design your dialplan
      carefully, you may inadvertently allow others to fraudulently use your
      system. Please keep this in mind as you build your Asterisk system;
      there are many bots on the Internet that were specifically written to
      identify and exploit poorly secured Asterisk systems.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-24"></a>Warning</h3><p><a id="DialplanBasics_id216361"></a>The Asterisk wiki <a id="I_indexterm6_d1e12100" class="indexterm"></a>at <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Important+Security+Considerations" target="_top">https://wiki.asterisk.org/wiki/display/AST/Important+Security+Considerations</a>
        outlines several steps you should take to keep your Asterisk system
        secure. <a id="I_indexterm6_d1e12106" class="indexterm"></a>(<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a> in this book also
        deals with security.) It is vitally important that you read and
        understand this page. If you ignore the security precautions outlined
        there, you may end up allowing anyone and everyone to make
        long-distance or toll calls at your expense!</p><p><a id="DialplanBasics_id216375"></a>If you don’t take the security of
        your Asterisk system seriously, you may end up paying—literally.
        <span class="emphasis"><em>Please</em></span> take the time and effort to secure your
        system from toll fraud.</p></div></div><div class="sect2" title="Extensions"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-1.2"></a>Extensions</h3></div></div></div><p><a id="DialplanBasics_id216394"></a><a id="I_indexterm6_d1e12123" class="indexterm"></a><a id="I_indexterm6_d1e12130" class="indexterm"></a>In the world of telecommunications, the word
      <span class="emphasis"><em>extension</em></span> usually refers to a numeric identifier
      that, when dialed, will ring a phone (or system resource such as
      voicemail or a queue). In Asterisk, an extension is far more powerful,
      as it defines the unique series of steps (each step containing an
      application) through which Asterisk will take that call.</p><p><a id="DialplanBasics_id216403"></a>Within each context, we can define as
      many (or few) extensions as required. When a particular extension is
      triggered (by an incoming call or by digits being dialed on a channel),
      Asterisk will follow the steps defined for that extension. It is the
      extensions, therefore, that specify what happens to calls as they make
      their way through the <span class="keep-together">dial</span><span class="keep-together">plan</span>. Although extensions can, of course,
      be used to specify phone extensions in the traditional sense (i.e.,
      extension 153 will cause the SIP telephone set on John’s desk to ring),
      in an Asterisk dialplan, they can be used for much more.</p><p><a id="DialplanBasics_id216417"></a>The syntax for an extension is the
      word <code class="literal">exten</code>, followed by an arrow
      formed by the equals sign and the greater-than sign, like this:</p><a id="I_programlisting5_tt721"></a><pre class="programlisting">exten =&gt;</pre><p><a id="DialplanBasics_id216434"></a>This is followed by the name (or
      number) of the extension. When dealing with traditional telephone
      systems, we tend to think of extensions as the numbers you would dial to
      make another phone ring. In Asterisk, you get a whole lot more; for
      example, extension names can be any combination of numbers and letters.
      Over the course of this chapter and the next, we’ll use both numeric and
      alphanumeric extensions.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-25"></a>Tip</h3><p><a id="DialplanBasics_id261792"></a><a id="I_indexterm6_d1e12157" class="indexterm"></a>Assigning names to extensions may seem like a
        revolutionary concept, but when you realize that many VoIP transports
        support (or even actively encourage) dialing by name or email address
        rather than just by number, it makes perfect sense. This is one of the
        features that makes Asterisk so flexible and powerful.</p></div><p><a id="DialplanBasics_id261799"></a>Each step in an extension is composed
      of three components:</p><div class="itemizedlist"><a id="DialplanBasics_id261802"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DialplanBasics_id261805"></a><a id="DialplanBasics_id261807"></a>The name (or number) of the
          extension</p></li><li class="listitem"><p><a id="DialplanBasics_id261811"></a><a id="DialplanBasics_id261813"></a>The priority (each extension can
          include multiple steps; the step number is called the
          “priority”)</p></li><li class="listitem"><p><a id="DialplanBasics_id261819"></a><a id="DialplanBasics_id261822"></a>The application (or command) that
          will take place at that step</p></li></ul></div><p><a id="DialplanBasics_id261828"></a>These three components are separated
      by commas, like this:</p><a id="I_programlisting5_tt724"></a><pre class="programlisting">exten =&gt; <em class="replaceable"><code>name</code></em>,<em class="replaceable"><code>priority</code></em>,<em class="replaceable"><code>application()</code></em></pre><p><a id="DialplanBasics_id261847"></a>Here’s a simple example of what a
      real extension might look like:</p><a id="I_programlisting5_tt725"></a><pre class="programlisting">exten =&gt; 123,1,Answer()</pre><p><a id="DialplanBasics_id261861"></a>In this example, the extension name
      is <code class="literal">123</code>, the priority is <code class="literal">1</code>, and the application is <code class="literal">Answer()</code>.</p></div><div class="sect2" title="Priorities"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-1.3"></a>Priorities</h3></div></div></div><p><a id="DialplanBasics_id261893"></a><a id="I_indexterm6_d1e12208" class="indexterm"></a><a id="I_indexterm6_d1e12215" class="indexterm"></a>Each extension can have multiple steps, called
      <span class="emphasis"><em>priorities</em></span>. The priorities are numbered
      sequentially, starting with 1, and each executes one specific
      application. As an example, the following extension would answer the
      phone (in priority number 1), and then hang it up (in priority number
      2):</p><a id="I_programlisting5_tt726"></a><pre class="programlisting">exten =&gt; 123,1,Answer()
exten =&gt; 123,2,Hangup()</pre><p><a id="DialplanBasics_id261910"></a>It’s pretty obvious that this code
      doesn’t really do anything useful. We’ll get there. The key point to
      note here is that for a particular extension, Asterisk follows the
      priorities in order. This style of dialplan syntax is still seen from
      time to time, although (as you’ll see momentarily) it is not generally
      used anymore for new code:</p><p><a id="DialplanBasics_id261915"></a><a id="DialplanBasics_id261916"></a></p><pre class="programlisting">exten =&gt; 123,1,Answer()
exten =&gt; 123,2,<em class="replaceable"><code>do something</code></em>
exten =&gt; 123,3,<em class="replaceable"><code>do something else</code></em>
exten =&gt; 123,4,<em class="replaceable"><code>do one last thing</code></em>
exten =&gt; 123,5,Hangup()</pre><div class="sect3" title="Unnumbered priorities"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id261938"></a>Unnumbered priorities</h4></div></div></div><p><a id="DialplanBasics_id261943"></a><a id="I_indexterm6_d1e12244" class="indexterm"></a>In older releases of Asterisk, the numbering of
        priorities caused a lot of problems. Imagine having an extension that
        had 15 priorities, and then needing to add something at step 2: all of
        the subsequent priorities would have to be manually renumbered.
        <span class="keep-together">Asterisk</span> does not handle missing
        steps or misnumbered priorities, and debugging these types of errors
        was pointless and frustrating.</p><p><a id="DialplanBasics_id261950"></a>Beginning with version 1.2,
        Asterisk addressed this problem: it introduced the use of the <code class="literal">n</code> priority, which stands for “next.” Each
        time Asterisk encounters a priority named <code class="literal">n</code>, it takes the number of the previous
        priority and adds 1. This makes it easier to make changes to your
        dialplan, as you don’t have to keep renumbering all your steps. For
        example, your dialplan might look something like this:</p><a id="DialplanBasics_id261971"></a><pre class="programlisting">exten =&gt; 123,1,Answer()
exten =&gt; 123,n,<em class="replaceable"><code>do something</code></em>
exten =&gt; 123,n,<em class="replaceable"><code>do something else</code></em>
exten =&gt; 123,n,<em class="replaceable"><code>do one last thing</code></em>
exten =&gt; 123,n,Hangup()</pre><p><a id="DialplanBasics_id261988"></a>Internally, Asterisk will calculate
        the next priority number every time it encounters an <code class="literal">n</code>.<sup>[<a id="id537608" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id537608" class="footnote">56</a>]</sup> Bear in mind that you must always specify priority
        number 1. If you accidentally put an <code class="literal">n</code> instead of <code class="literal">1</code> for the first priority (a common mistake
        even among experienced dialplan coders), you’ll find after reloading
        the dialplan that the extension will not exist.</p></div><div class="sect3" title="The &#39;same =&gt;&#39; operator"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id262049"></a>The 'same =&gt;' operator</h4></div></div></div><p><a id="DialplanBasics_id262058"></a><a id="I_indexterm6_d1e12308" class="indexterm"></a><a id="I_indexterm6_d1e12311" class="indexterm"></a><a id="I_indexterm6_d1e12314" class="indexterm"></a>In the never-ending effort to simplify coding effort, a
        new construct was created to make extension building and management
        even easier. As long as the extension remains the same, rather than
        having to type the full extension on each line, you can simply type
        <code class="literal">same =&gt;</code> , followed by the
        priority and application:</p><p><a id="DialplanBasics_id262068"></a><a id="DialplanBasics_id262069"></a></p><pre class="programlisting">exten =&gt; 123,1,Answer()
   same =&gt; n,<em class="replaceable"><code>do something</code></em>
   same =&gt; n,<em class="replaceable"><code>do something else</code></em>
   same =&gt; n,<em class="replaceable"><code>do one last thing</code></em>
   same =&gt; n,Hangup()</pre><p>The indentation is not required, but
        it may make for easier reading. This style of dialplan will also make
        it easier to copy code from one extension to another. We prefer this
        style ourselves, and highly recommend it.</p></div><div class="sect3" title="Priority labels"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id262089"></a>Priority labels</h4></div></div></div><p><a id="DialplanBasics_id262094"></a><a id="I_indexterm6_d1e12340" class="indexterm"></a><a id="I_indexterm6_d1e12343" class="indexterm"></a>Priority labels allow you to assign a name to a priority
        within an extension. This is to ensure that you can refer to a
        priority by something other than its number (which probably isn’t
        known, given that dialplans now generally use unnumbered priorities).
        The reason it is important to be able to address a particular priority
        in an extension is that you will often want to send calls from other
        parts of the dialplan to a particular priority in a particular
        extension. We’ll talk about that more later. To assign a text label to
        a priority, simply add the label inside parentheses after the
        priority, like this:</p><p><a id="DialplanBasics_id262106"></a><a id="I_programlisting5_tt730"></a></p><pre class="programlisting">exten =&gt; 123,n(<em class="replaceable"><code>label</code></em>),<em class="replaceable"><code>application()</code></em></pre><p><a id="DialplanBasics_id262158"></a>Later, we’ll cover how to jump
        between different priorities based on dialplan logic. You’ll see a lot
        more of priority labels, and you’ll use them often in your
        dialplans.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DialplanBasics_id262123"></a>A very common mistake when
          writing labels is to insert a comma between the <code class="literal">n</code> and the <code class="literal">(</code>, like this:</p><a id="I_programlisting5_tt731"></a><pre class="programlisting">exten =&gt; 123,n,(<em class="replaceable"><code>label</code></em>),<em class="replaceable"><code>application()</code></em> ;&lt;-- THIS IS NOT GOING TO WORK</pre><p><a id="DialplanBasics_id262152"></a>This mistake will break that part
          of your dialplan, and you will get an error stating that the
          application cannot be found.</p></div></div></div><div class="sect2" title="Applications"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-1.4"></a>Applications</h3></div></div></div><p><a id="DialplanBasics_id262175"></a><a id="I_indexterm6_d1e12380" class="indexterm"></a><a id="I_indexterm6_d1e12387" class="indexterm"></a>Applications are the workhorses of the dialplan. Each
      application performs a specific action on the current channel, such as
      playing a sound, accepting touch-tone input, looking something up in a
      database, dialing a channel, hanging up the call, and so forth. In the
      previous example, you were introduced to two simple applications:
      <code class="literal">Answer()</code><a id="I_indexterm6_d1e12395" class="indexterm"></a> and <code class="literal">Hangup()</code><a id="I_indexterm6_d1e12401" class="indexterm"></a>. You’ll learn more about how these work
      momentarily.</p><p><a id="DialplanBasics_id262193"></a>Some applications, including <code class="literal">Answer() </code>and <code class="literal">Hangup()</code>, need no other instructions to do
      their jobs. Most applications, however, require additional information.
      These additional elements, or <span class="emphasis"><em>arguments</em></span>, are passed
      on to the applications to affect how they perform their actions. To pass
      arguments to an application, place them between the parentheses that
      follow the application name, separated by commas.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-27"></a>Tip</h3><p><a id="DialplanBasics_id262221"></a>Occasionally, you may also see the
        pipe character (<code class="literal">|</code>) <a id="I_indexterm6_d1e12422" class="indexterm"></a><a id="I_indexterm6_d1e12427" class="indexterm"></a>being used as a separator between arguments, instead of
        a comma. Starting in Asterisk 1.6.0, support for the pipe as a
        separator character has been removed.<sup>[<a id="id538059" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id538059" class="footnote">57</a>]</sup></p></div></div><div class="sect2" title="The Answer(), Playback(), and Hangup() Applications"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-2.2"></a>The Answer(), Playback(), and Hangup() Applications</h3></div></div></div><p><a id="DialplanBasics_id262248"></a><a id="I_indexterm6_d1e12443" class="indexterm"></a><a id="I_indexterm6_d1e12450" class="indexterm"></a>The <code class="literal">Answer()</code>
      application is used to answer a channel that is ringing. This does the
      initial setup for the channel that receives the incoming call. As we
      mentioned earlier, <code class="literal">Answer()</code> takes no
      arguments. <code class="literal">Answer()</code> is not always
      required (in fact, in some cases it may not be desirable at all), but it
      is an effective way to ensure a channel is connected before performing
      further actions.</p><div class="sidebar" title="The Progress() Application"><a id="DialplanBasics_id262266"></a><div class="titlepage"><div><div><p class="title"><strong>The Progress() Application</strong></p></div></div></div><p><a id="DialplanBasics_id262274"></a><a id="I_indexterm6_d1e12467" class="indexterm"></a>Sometimes it is useful to be able to pass information
        back to the network before answering a call. The <code class="literal">Progress()</code> application attempts to provide
        call progress information to the originating channel. Some carriers
        expect this, and thus you may be able to resolve strange signaling
        problems by inserting <code class="literal">Progress()</code>
        into the dialplan where your incoming calls arrive.</p></div><p><a id="DialplanBasics_id262288"></a>The <code class="literal">Playback()</code> <a id="I_indexterm6_d1e12483" class="indexterm"></a>application is used for playing a previously recorded
      sound file over a channel. Input from the user is ignored, which means
      that you would not use <code class="literal">Playback()</code> in
      an auto attendant, for example, unless you did not want to accept input
      at that point.<sup>[<a id="id538222" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id538222" class="footnote">58</a>]</sup></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-28"></a>Tip</h3><p><a id="DialplanBasics_id262324"></a>Asterisk comes with many
        professionally recorded sound files,<a id="I_indexterm6_d1e12506" class="indexterm"></a> which should be found in the default sounds directory
        (usually <code class="filename">/var/lib/asterisk/sounds/</code>). When you
        compile Asterisk, you can choose to install <span class="keep-together">various</span> sets of sample sounds that have
        been recorded in a variety of languages and file formats. We’ll be
        using these files in many of our examples. Several of the files in our
        examples come from the Extra Sound Package,<a id="I_indexterm6_d1e12516" class="indexterm"></a> so please take the time to install it (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>). You can also have your own sound
        prompts recorded in the same voices as the stock prompts by visiting
        <a class="ulink" href="http://www.theivrvoice.com/" target="_top">http://www.theivrvoice.com/</a>. Later in the book
        we’ll talk more about how you can use a telephone and the dialplan to
        create and manage your own system recordings.</p></div><p><a id="DialplanBasics_id262355"></a>To use <code class="literal">Playback()</code>, specify a filename (without a file
      extension) as the argument. For example, <code class="literal">Playback(filename)</code> would play the sound file
      called <code class="filename">filename.wav</code>, assuming it
      was located in the default sounds directory. Note that you can include
      the full path to the file if you want, like this:</p><a id="I_programlisting5_tt748"></a><pre class="programlisting">Playback(/home/john/sounds/filename)</pre><p><a id="DialplanBasics_id262382"></a>The previous example would play
      <span class="emphasis"><em>filename.wav</em></span> from the
      <span class="emphasis"><em>/home/john/sounds/</em></span> directory. You can also use
      relative paths from the Asterisk sounds directory, as follows:</p><a id="I_programlisting5_tt749"></a><pre class="programlisting">Playback(custom/filename)</pre><p><a id="DialplanBasics_id262402"></a>This example would play <code class="filename">filename.wav</code> from the <code class="filename">custom/</code> subdirectory of the default sounds
      directory (probably <code class="filename">/var/lib/asterisk/sounds/custom/filename.wav</code>).
      Note that if the specified directory contains more than one file with
      that filename but with different file extensions, Asterisk automatically
      plays the best file.<sup>[<a id="asterisk-DP-Basics-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-DP-Basics-FN-2" class="footnote">59</a>]</sup></p><p><a id="DialplanBasics_id262448"></a>The <code class="literal">Hangup()</code> <a id="I_indexterm6_d1e12585" class="indexterm"></a>application does exactly as its name implies: it hangs up
      the active channel. You should use this application at the end of a
      context when you want to end the current call, to ensure that callers
      don’t continue on in the dialplan in a way you might not have
      anticipated. The <code class="literal">Hangup()</code> application
      does not require any arguments, but you can pass an ISDN cause code if
      you want (e.g., <code class="literal">Hangup(16)</code>).</p><p><a id="DialplanBasics_id262471"></a>As we work through the book, we will
      be introducing you to many more Asterisk applications.<a id="I_indexterm6_d1e12597" class="indexterm"></a><a id="I_indexterm6_d1e12598" class="indexterm"></a></p></div></div><div class="sect1" title="A Simple Dialplan"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-DP-Basics-SECT-2"></a>A Simple Dialplan</h2></div></div></div><p><a id="DialplanBasics_id262487"></a><a id="I_indexterm6_d1e12603" class="indexterm"></a><a id="I_indexterm6_d1e12608" class="indexterm"></a>OK, enough theory. Open up the file <code class="filename">/etc/asterisk/extensions.conf</code>, and let’s take a
    look at your first dialplan (which was created in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a>). We’re going to add to that.</p><div class="sect2" title="Hello World"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-2.3"></a>Hello World</h3></div></div></div><p><a id="DialplanBasics_id262503"></a>As is typical in many technology
      books (especially computer programming books), our first example is
      called “Hello World!”</p><p><a id="DialplanBasics_id262509"></a>In the first priority of our
      extension, we answer the call. In the second, we play a sound file named
      <code class="filename">hello-world</code>, and in the third we
      hang up the call. The code we are interested in for this example looks
      like this:</p><a id="I_programlisting5_tt751"></a><pre class="programlisting">exten =&gt; 200,1,Answer()
   same =&gt; n,Playback(hello-world)
   same =&gt; n,Hangup()</pre><p><a id="DialplanBasics_id262527"></a>If you followed along in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a>, you’ll already have a channel or two
      configured, as well as the sample dialplan that contains this code. If
      not, what you need is an <code class="filename">extensions.conf</code> file in your <code class="filename">/etc/asterisk/</code> directory that contains the
      following code:</p><p><a id="DialplanBasics_id262539"></a><a id="DialplanBasics_id262540"></a></p><pre class="programlisting">[LocalSets] ; this is the context name
exten =&gt; 100,1,Dial(SIP/0000FFFF0001) ; Replace 0000FFFF0001 with your device name

exten =&gt; 101,1,Dial(SIP/0000FFFF0002) ; Replace 0000FFFF0002 with your device name

exten =&gt; 200,1,Answer()
   same =&gt; n,Playback(hello-world)
   same =&gt; n,Hangup()</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DialplanBasics_id262547"></a>If you don’t have any channels
          configured, now is the time to do so. There is real satisfaction
          that comes from passing your first call into an Asterisk dialplan on
          a system that you’ve built from scratch. People get this funny grin
          on their faces as they realize that they have just created a
          telephone system. This pleasure can be yours as well, so please,
          don’t go any further until you have made this little bit of dialplan
          work. If you have any problems, get back to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a> and work through the <span class="keep-together">examples there</span>.</p></div><p>If you don’t have this dialplan code built yet, you’ll need to
      add it and reload the dialplan with this CLI command:</p><a id="DialplanBasics_id262565"></a><pre class="screen"><code class="computeroutput">*CLI&gt;</code> <strong class="userinput"><code>dialplan reload</code></strong></pre><p><a id="DialplanBasics_id262572"></a>or from the shell with:</p><a id="DialplanBasics_id262576"></a><pre class="screen"><code class="computeroutput">$</code> <strong class="userinput"><code>sudo /usr/sbin/asterisk -rx "dialplan reload"</code></strong></pre><p><a id="DialplanBasics_id262583"></a>Calling extension 200 from either of
      your configured phones should reward you with the voice of Allison Smith
      saying “Hello World.”</p><p><a id="DialplanBasics_id262591"></a>If it doesn’t work, check the
      Asterisk console for error messages, and make sure your channels are
      assigned to the <code class="literal">LocalSets</code>
      context.</p><div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="DialplanBasics_id262602"></a>Important</h3><p><a id="DialplanBasics_id262604"></a>We do not recommend that you move
        forward in this book until you have verified the following:</p><div class="orderedlist"><a id="DialplanBasics_id262608"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="DialplanBasics_id262610"></a><a id="DialplanBasics_id262612"></a>Calls between extension 100 and
            101 are working</p></li><li class="listitem"><p><a id="DialplanBasics_id262616"></a><a id="DialplanBasics_id262619"></a>Calling extension 200 plays
            “Hello World”</p></li></ol></div></div><p><a id="DialplanBasics_id262625"></a>Even though this example is very
      short and simple, it emphasizes the core concepts of contexts,
      extensions, priorities, and applications. You now have the fundamental
      knowledge on which all dialplans are built.</p></div></div><div class="sect1" title="Building an Interactive Dialplan"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-DP-Basics-SECT-3"></a>Building an Interactive Dialplan</h2></div></div></div><p><a id="DialplanBasics_id262645"></a><a id="index-803M273PS6B" class="indexterm"></a>The dialplan we just built was static; it will always
    perform the same actions on every call. Many dialplans will also need
    logic to perform different actions based on input from the user, so let’s
    take a look at that now.</p><div class="sect2" title="The Goto(), Background(), and WaitExten() Applications"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.1"></a>The Goto(), Background(), and WaitExten() Applications</h3></div></div></div><p><a id="DialplanBasics_id262659"></a><a id="I_indexterm6_d1e12700" class="indexterm"></a>As its name implies, the <code class="literal">Goto()</code> application <a id="I_indexterm6_d1e12711" class="indexterm"></a>is used to send a call to another part of the dialplan.
      The syntax for the <code class="literal">Goto()</code> application
      requires us to pass the destination context, extension, and priority on
      as arguments to the application, like this:</p><a id="I_programlisting5_tt763"></a><pre class="programlisting">    same =&gt; n,Goto(<em class="replaceable"><code>context</code></em>,<em class="replaceable"><code>extension</code></em>,<em class="replaceable"><code>priority</code></em>)</pre><p><a id="DialplanBasics_id262693"></a>We’re going to create a new context
      called <code class="literal">TestMenu</code>, and create an
      extension in our <code class="literal">LocalSets</code> context
      that will pass calls to that context using <code class="literal">Goto():</code></p><p><a id="DialplanBasics_id262706"></a><a id="DialplanBasics_id262707"></a></p><pre class="programlisting">exten =&gt; 201,1,Goto(TestMenu,start,1) ; add this to the end of the 
                                      ; [LocalSets] context

[TestMenu]
exten =&gt; start,1,Answer()</pre><p>Now, whenever a device enters the <code class="literal">LocalSets</code> context and dials <code class="literal">201</code>, the call will be passed to the <code class="literal">start</code> extension in the <code class="literal">TestMenu</code> context (which currently won’t do
      anything interesting because we still have more code to write).</p><p><a id="DialplanBasics_id262712"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DialplanBasics_id262716"></a>We used the extension <code class="literal">start</code> in this example, but we could have
          used anything we wanted as an extension name, either numeric or
          alpha. We prefer to use alpha characters for extensions that are not
          directly dialable, as this makes the dialplan easier to read. Point
          being, we could have used <code class="literal">123</code> or
          <code class="literal">xyz123</code>, or <code class="literal">99luftballons</code>, or whatever we wanted
          instead of <code class="literal">start</code>. The word
          “start” doesn’t actually mean anything to the dialplan; it’s just
          another extension.</p></div><p><a id="DialplanBasics_id262756"></a>One of the most useful applications
      in an interactive Asterisk dialplan is the <code class="literal">Background()</code><sup>[<a id="id539119" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id539119" class="footnote">60</a>]</sup> application. Like <code class="literal">Playback()</code>, it plays a recorded sound
      file. Unlike <code class="literal">Playback()</code>, however, when the caller
      presses a key (or series of keys) on her telephone keypad, it interrupts
      the playback and passes the call to the extension that corresponds with
      the pressed digit(s). If a caller presses <code class="literal">5</code>, for example, Asterisk will stop playing the
      sound prompt and send control of the call to the first priority of
      extension <code class="literal">5</code> (assuming there is an
      extension <code class="literal">5</code> to send the call
      to).</p><p><a id="DialplanBasics_id262806"></a>The most common use of the <code class="literal">Background()</code> application is to create voice
      menus <a id="I_indexterm6_d1e12807" class="indexterm"></a>(often called<a id="I_indexterm6_d1e12811" class="indexterm"></a> <span class="emphasis"><em>auto attendants</em></span><sup>[<a id="id539214" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id539214" class="footnote">61</a>]</sup> or <span class="emphasis"><em>phone trees</em></span>). Many companies use
      voice menus to direct callers to the proper extensions, thus relieving
      their receptionists from having to answer every single call.</p><p><a id="DialplanBasics_id262823"></a><code class="literal">Background()</code><a id="I_indexterm6_d1e12829" class="indexterm"></a> has the same syntax as <code class="literal">Playback()</code>:</p><a id="I_programlisting5_tt758"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)</pre><p><a id="DialplanBasics_id262845"></a>If you want Asterisk to wait for
      input from the caller after the sound prompt has finished playing, you
      can use <code class="literal">WaitExten()</code><a id="I_indexterm6_d1e12843" class="indexterm"></a>. The <code class="literal">WaitExten()</code>
      application waits for the caller to enter DTMF digits and is used
      directly following the <code class="literal">Background()</code>
      application, like this:</p><a id="I_programlisting5_tt759"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)
   same =&gt; n,WaitExten()</pre><p><a id="DialplanBasics_id262876"></a>If you’d like the <code class="literal">WaitExten()</code> application to wait a specific
      number of seconds for a response (instead of using the default
      <a id="I_indexterm6_d1e12860" class="indexterm"></a><a id="I_indexterm6_d1e12865" class="indexterm"></a>timeout<sup>[<a id="id539363" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id539363" class="footnote">62</a>]</sup>), simply pass the number of seconds as the first argument
      to <code class="literal">WaitExten()</code>, like this:</p><a id="I_programlisting5_tt760"></a><pre class="programlisting">   same =&gt; n,WaitExten(5) ; We recommend always passing a time argument to WaitExten()</pre><p><a id="DialplanBasics_id262901"></a>Both <code class="literal">Background()</code> and <code class="literal">WaitExten()</code> allow the caller to enter DTMF
      digits. Asterisk then attempts to find an extension in the current
      context that matches the digits that the caller entered. If Asterisk
      finds a match, it will send the call to that extension. Let’s
      demonstrate by adding a few lines to our dialplan example:</p><a id="I_programlisting5_tt761"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)
   same =&gt; n,WaitExten(5)

exten =&gt; 1,1,Playback(digits/1)

exten =&gt; 2,1,Playback(digits/2)</pre><p><a id="DialplanBasics_id262931"></a>After making these changes, save and
      reload your dialplan:</p><a id="DialplanBasics_id36056599"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>dialplan reload</code></strong></pre><p><a id="DialplanBasics_id262935"></a>If you call into extension <code class="literal">201</code>, you should hear a sound prompt that says
      “main menu.” The system will then wait 5 seconds for you to enter a
      digit. If the digit you press is either <code class="literal">1</code> or <code class="literal">2</code>,
      Asterisk will match the relevant extension, and read that digit back to
      you. Since we didn’t provide any further instructions, your call will
      then end. You’ll also find that if you enter a different digit (such as
      <code class="literal">3</code>), the dialplan will be unable to
      proceed.</p><p><a id="DialplanBasics_id262964"></a>Let’s embellish things a little.
      We’re going to use the <code class="literal">Goto()</code>
      application to have the dialplan repeat the greeting after playing back
      the number:</p><a id="I_programlisting5_tt764"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)
   same =&gt; n,WaitExten(5)

exten =&gt; 1,1,Playback(digits/1)
<span class="strong"><strong>   same =&gt; n,Goto(TestMenu,start,1)</strong></span>

exten =&gt; 2,1,Playback(digits/2)
<span class="strong"><strong>   same =&gt; n,Goto(TestMenu,start,1)
</strong></span></pre><p><a id="DialplanBasics_id262997"></a>These new lines will send control of
      the call back to the <code class="literal">start</code> extension
      after playing back the selected number. This is generally considered
      friendlier than just hanging up.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-29"></a>Tip</h3><p><a id="DialplanBasics_id292215"></a>If you look up the details of the
        <code class="literal">Goto()</code> application, you’ll find
        that you can actually pass either one, two, or three arguments to the
        application. If you pass a single argument, Asterisk will assume it’s
        the destination priority in the current extension. If you pass two
        arguments, Asterisk will treat them as the extension and the priority
        to go to in the current <span class="keep-together">context.</span></p><p><a id="DialplanBasics_id292233"></a>In this example, we’ve passed all
        three arguments for the sake of clarity, but passing just the
        extension and priority would have had the same effect, since the
        destination context is the same as the source context.</p></div></div><div class="sect2" title="Handling Invalid Entries and Timeouts"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.2"></a>Handling Invalid Entries and Timeouts</h3></div></div></div><p><a id="DialplanBasics_id292250"></a><a id="I_indexterm6_d1e12946" class="indexterm"></a><a id="I_indexterm6_d1e12953" class="indexterm"></a>Now that our first voice menu is starting to come
      together, let’s add some additional special extensions.<a id="I_indexterm6_d1e12959" class="indexterm"></a> First, we need an extension for invalid entries. In
      Asterisk, when a context receives a request for an extension that is not
      valid within that context (e.g., pressing <code class="literal">9</code> in the preceding example), the call is sent
      to the <code class="literal">i</code> extension. We also need an
      extension to handle situations when the caller doesn’t give input in
      time (the default timeout is 10 seconds). Calls will be sent to the
      <code class="literal">t</code> extension if the caller takes too
      long to press a digit after <code class="literal">WaitExten()</code> has been called. Here is what our
      dialplan will look like after we’ve added these two extensions:</p><a id="I_programlisting5_tt767"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)
   same =&gt; n,WaitExten(5)

exten =&gt; 1,1,Playback(digits/1)
   same =&gt; n,Goto(TestMenu,start,1)

exten =&gt; 2,1,Playback(digits/2)
   same =&gt; n,Goto(TestMenu,start,1)

<span class="strong"><strong>exten =&gt; i,1,Playback(pbx-invalid)
   same =&gt; n,Goto(TestMenu,start,1)

exten =&gt; t,1,Playback(vm-goodbye)
   same =&gt; n,Hangup()</strong></span></pre><p><a id="DialplanBasics_id292300"></a>Using the <code class="literal">i</code> and <code class="literal">t</code>
      extensions makes our menu a little more robust and user-friendly. That
      being said, it is still quite limited, because outside callers still
      have no way of connecting to a live person. To do that, we’ll need to
      learn about another application, called <code class="literal">Dial()</code>.</p></div><div class="sect2" title="Using the Dial() Application"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.3"></a>Using the Dial() Application</h3></div></div></div><p><a id="DialplanBasics_id292332"></a><a id="index-816I851SB1B" class="indexterm"></a><a id="index-373A172CC1E" class="indexterm"></a>One of Asterisk’s most valuable features is its ability to
      connect different callers to each other. This is especially useful when
      callers are using different methods of communication. For example,
      caller A might be communicating over the traditional analog <span class="keep-together">telephone</span> network, while user B might be
      sitting in a café halfway around the world and speaking on an IP
      telephone. Luckily, Asterisk takes much of the hard work out of
      connecting and translating between disparate networks. All you have to
      do is learn how to use the <code class="literal">Dial()</code>
      application.</p><p><a id="DialplanBasics_id292346"></a>The syntax of the <code class="literal">Dial()</code> application is more complex than that
      of the other applications we’ve used so far, but don’t let that scare
      you off. <code class="literal">Dial()</code> takes up to four
      arguments, which we’ll look at next.</p><div class="sect3" title="Argument 1: Destination"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292362"></a>Argument 1: Destination</h4></div></div></div><p><a id="DialplanBasics_id292367"></a><a id="I_indexterm6_d1e13026" class="indexterm"></a>The first argument is the destination you’re attempting
        to call, which (in its simplest form) is made up of a technology (or
        transport) across which to make the call, a forward slash, and the
        address of the remote endpoint or resource. Common technology types
        include DAHDI (for analog and T1/E1/J1 channels), SIP, and
        IAX2.</p><p><a id="DialplanBasics_id36056861"></a>For example, let’s assume that we
        want to call a DAHDI endpoint identified by <code class="literal">DAHDI/1</code>, which is an FXS channel with an
        analog phone plugged into it. The technology is <code class="literal">DAHDI</code>, and the resource (or channel
        identifier) is <code class="literal">1</code>. Similarly, a call
        to a SIP device (as defined in <code class="filename">sip.conf</code>) might have a destination of
        <code class="literal">SIP/0004F2001122</code>, and a call to an
        IAX device (defined in <code class="filename">iax.conf</code>)
        might have a destination of <code class="literal">IAX2/Softphone</code>.<sup>[<a id="id539923" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id539923" class="footnote">63</a>]</sup> If we wanted Asterisk to ring the <code class="literal">DAHDI/1</code> channel when extension <code class="literal">105</code> is reached in the dialplan, we’d add the
        following extension:</p><a id="I_programlisting5_tt770"></a><pre class="programlisting">exten =&gt; 105,1,Dial(DAHDI/1)</pre><p><a id="DialplanBasics_id292435"></a>We can also dial multiple channels
        at the same time, by concatenating the destinations with an ampersand
        (<code class="literal">&amp;</code>), like this:</p><a id="I_programlisting5_tt773"></a><pre class="programlisting">exten =&gt; 105,1,Dial(DAHDI/1&amp;SIP/0004F2001122&amp;IAX2/Softphone)</pre><p><a id="DialplanBasics_id292452"></a>The <code class="literal">Dial()</code> application will ring all of the
        specified destinations simultaneously, and bridge the inbound call
        with whichever destination channel answers first (the other channels
        will immediately stop ringing). If the <code class="literal">Dial()</code> application can’t contact any of the
        destinations, Asterisk will set a variable called <code class="literal">DIALSTATUS</code><a id="I_indexterm6_d1e13083" class="indexterm"></a> with the reason that it couldn’t dial the destinations,
        and continue on with the next priority in the extension.<sup>[<a id="asterisk-DP-Basics-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-DP-Basics-FN-3" class="footnote">64</a>]</sup></p><p><a id="DialplanBasics_id292496"></a>The <code class="literal">Dial()</code> application also allows you to
        connect to a remote VoIP endpoint not previously defined in one of the
        channel configuration files. The full syntax is:</p><a id="I_programlisting5_tt775"></a><pre class="programlisting">Dial(<em class="replaceable"><code>technology/user</code></em><em class="replaceable"><code>[:password]</code></em>@<em class="replaceable"><code>remote_host</code></em><em class="replaceable"><code>[:port]</code></em><em class="replaceable"><code>[/remote_extension]</code></em>)</pre><p><a id="DialplanBasics_id292526"></a>As an example, you can dial into a
        demonstration server at Digium using the IAX2 protocol by using the
        following extension:</p><a id="I_programlisting5_tt776"></a><pre class="programlisting">exten =&gt; 500,1,Dial(IAX2/guest@misery.digium.com/s)</pre><p><a id="DialplanBasics_id292539"></a>The full syntax for the <code class="literal">Dial()</code> application is slightly different for
        DAHDI channels:</p><a id="I_programlisting5_tt777"></a><pre class="programlisting">Dial(DAHDI/<em class="replaceable"><code>[gGrR]</code></em><em class="replaceable"><code>channel_or_group</code></em><em class="replaceable"><code>[/remote_extension]</code></em>)</pre><p><a id="DialplanBasics_id292563"></a>For example, here is how you would
        dial <code class="literal">1-800-555-1212</code> on DAHDI
        channel <span class="keep-together">number 4</span><sup>[<a id="id540155" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id540155" class="footnote">65</a>]</sup>:</p><a id="I_programlisting5_tt778"></a><pre class="programlisting">exten =&gt; 501,1,Dial(DAHDI/4/18005551212)</pre></div><div class="sect3" title="Argument 2: Timeout"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292588"></a>Argument 2: Timeout</h4></div></div></div><p><a id="DialplanBasics_id292594"></a><a id="I_indexterm6_d1e13150" class="indexterm"></a>The second argument to the <code class="literal">Dial()</code> application is a timeout, specified
        in seconds. If a timeout is given, <code class="literal">Dial()</code> will attempt to call the specified
        destination(s) for that number of seconds before giving up and moving
        on to the next priority in the extension. If no timeout is specified,
        <code class="literal">Dial()</code> will continue to dial the
        called channel(s) until someone answers or the caller hangs up. Let’s
        add a timeout of 10 seconds to our extension:</p><a id="I_programlisting5_tt779"></a><pre class="programlisting">exten =&gt; 201,1,Dial(DAHDI/1,10)</pre><p><a id="DialplanBasics_id292626"></a>If the call is answered before the
        timeout, the channels are bridged and the dialplan is done. If the
        destination simply does not answer, is busy, or is otherwise
        unavailable, Asterisk will set a variable called <code class="literal">DIALSTATUS</code> and then continue on with the
        next priority in the extension.</p><p><a id="DialplanBasics_id292637"></a>Let’s put what we’ve learned so far
        into another example:</p><a id="I_programlisting5_tt780"></a><pre class="programlisting">exten =&gt; 201,1,Dial(DAHDI/1,10)<span class="strong"><strong>    
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()
</strong></span></pre><p><a id="DialplanBasics_id292655"></a>As you can see, this example will
        play the <span class="emphasis"><em>vm-nobodyavail.gsm</em></span> sound file if the
        call goes unanswered.</p></div><div class="sect3" title="Argument 3: Option"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292662"></a>Argument 3: Option</h4></div></div></div><p><a id="DialplanBasics_id292668"></a><a id="I_indexterm6_d1e13185" class="indexterm"></a>The third argument to <code class="literal">Dial()</code> is an option string. It may contain
        one or more characters that modify the behavior of the <code class="literal">Dial()</code> application. While the list of
        possible options is too long to cover here, one of the most popular is
        the <code class="literal">m</code> option. If you place the
        letter <code class="literal">m</code> as the third argument, the
        calling party will hear hold music instead of ringing while the
        destination channel is being called (assuming, of course, that music
        on hold has been configured correctly). To add the <code class="literal">m</code> option to our last example, we simply
        change the first line:</p><a id="I_programlisting5_tt781"></a><pre class="programlisting"><span class="strong"><strong>exten =&gt; 201,1,Dial(DAHDI/1,10,m)</strong></span>
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()</pre></div><div class="sect3" title="Argument 4: URI"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292716"></a>Argument 4: URI</h4></div></div></div><p><a id="DialplanBasics_id292722"></a><a id="I_indexterm6_d1e13212" class="indexterm"></a>The fourth and final argument to the <code class="literal">Dial()</code> application is a URI. If the
        destination channel supports receiving a URI at the time of the call,
        the specified URI will be sent (for example, if you have an IP
        telephone that supports receiving a URI, it will appear on the phone’s
        display; likewise, if you’re using a softphone, the URI might pop up
        on your computer screen). This argument is very rarely used.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DialplanBasics_id36057251"></a>Few (if any) phones support
          <a id="I_indexterm6_d1e13222" class="indexterm"></a>URI information being passed to them. If you’re
          looking for something like a screen pop, you might want to check out
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>, and more specifically the
          section on Jabber in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286789" title="Using XMPP (Jabber) with Asterisk">the section called “Using XMPP (Jabber) with Asterisk”</a>.</p></div></div><div class="sect3" title="Updating the dialplan"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292738"></a>Updating the dialplan</h4></div></div></div><p><a id="DialplanBasics_id292744"></a><a id="I_indexterm6_d1e13236" class="indexterm"></a>Let’s modify extensions <code class="literal">1</code> and <code class="literal">2</code>
        in our menu to use the <code class="literal">Dial()</code>
        application:</p><a id="I_programlisting5_tt782"></a><pre class="programlisting">[TestMenu]
exten =&gt; start,1,Answer()
   same =&gt; n,Background(main-menu)
   same =&gt; n,WaitExten(5)

exten =&gt; 1,1,Dial(SIP/0000FFFF0001,10) ; Replace 0000FFFF0001 with your device name
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()

exten =&gt; 2,1,Dial(SIP/0000FFFF0002,10) ; Replace 0000FFFF0002 with your device name
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()

exten =&gt; i,1,Playback(pbx-invalid)
   same =&gt; n,Goto(TestMenu,start,1)

exten =&gt; t,1,Playback(vm-goodbye)
   same =&gt; n,Hangup()</pre></div><div class="sect3" title="Blank arguments"><div class="titlepage"><div><div><h4 class="title"><a id="DialplanBasics_id292773"></a>Blank arguments</h4></div></div></div><p><a id="DialplanBasics_id292778"></a>Note that the second, third, and
        fourth arguments may be left blank; only the first argument is
        required. For example, if you want to specify an option but not a
        timeout, simply leave the timeout argument blank, like this:<a id="I_indexterm6_d1e13258" class="indexterm"></a><a id="I_indexterm6_d1e13259" class="indexterm"></a></p><a id="I_programlisting5_tt783"></a><pre class="programlisting">exten =&gt; 1,1,Dial(DAHDI/1,,m)</pre></div></div><div class="sect2" title="Using Variables"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.5"></a>Using Variables</h3></div></div></div><p><a id="DialplanBasics_id292803"></a><a id="index-004A873QG6C" class="indexterm"></a><a id="index-175O155VJ5M" class="indexterm"></a>Variables can be used in an Asterisk dialplan to help
      reduce typing, improve clarity, or add logic. If you have some computer
      programming experience, you already understand what a variable is. If
      not, we’ll briefly explain what variables are and how they are used.
      They are a vitally important Asterisk dialplan concept (and something
      you will not find in the dialplan of any proprietary PBX).</p><p><a id="DialplanBasics_id292814"></a>A <span class="emphasis"><em>variable</em></span> is a
      named container that can hold a value. The advantage of a variable is
      that its contents may change, but its name does not, which means you can
      write code that references the variable name and not worry about what
      the value will be. So, for example, we might create a variable called
      <code class="literal">JOHN</code> and assign it the value of
      <code class="literal">DAHDI/1</code>. This way, when we’re writing
      our dialplan we can refer to John’s channel by name, instead of
      remembering that John is using the channel named <code class="literal">DAHDI/1</code>. If at some point we change John’s
      channel to something else, we don’t have to change any of our code that
      references the <code class="literal">JOHN</code> variable; we only
      have to change the value assigned to the variable.</p><p><a id="DialplanBasics_id292844"></a>There are two ways to reference
      <a id="I_indexterm6_d1e13296" class="indexterm"></a>a variable. To reference the variable’s name, simply type
      the name of the variable, such as <code class="literal">LEIF</code>. If, on the other hand, you want to
      reference the contents of the value, you must type a dollar sign, an
      opening curly brace, the name of the variable, and a closing curly brace
      (in the case of <code class="literal">LEIF</code>, we would
      reference the value of the variable with <code class="literal">${LEIF}</code>). Here’s how we might use a variable
      inside the <code class="literal">Dial()</code> application:</p><a id="I_programlisting5_tt789"></a><pre class="programlisting">exten =&gt; 301,1,Set(LEIF=SIP/0000FFFF0001)
   same =&gt; n,Dial(${LEIF})</pre><p><a id="DialplanBasics_id292878"></a>In our dialplan, whenever we refer to
      <code class="literal">${LEIF}</code>, Asterisk will automatically
      replace it with whatever value has been assigned to the variable named
      <code class="literal">LEIF</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-31"></a>Tip</h3><p><a id="DialplanBasics_id292899"></a>Note that <a id="I_indexterm6_d1e13325" class="indexterm"></a>variable names are case-sensitive. A variable named
        <code class="literal">LEIF</code> is different than a variable
        named <code class="literal">Leif</code>. For readability’s sake,
        all our variable names in the examples will be written in uppercase.
        You should also be aware that any variables set by Asterisk will be
        uppercase. Some variables, such as <code class="literal">CHANNEL</code> and <code class="literal">EXTEN</code>, are reserved by Asterisk. You should
        not attempt to set these variables. It is popular to write global
        variables in uppercase and channel variables in Pascal/Camel
        case.</p></div><p><a id="DialplanBasics_id292931"></a>There are three types of variables we
      can use in our dialplan: global variables, channel variables, and
      environment variables. Let’s take a moment to look at each type.</p><div class="sect3" title="Global variables"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.5.1"></a>Global variables</h4></div></div></div><p><a id="DialplanBasics_id292944"></a><a id="I_indexterm6_d1e13349" class="indexterm"></a><a id="I_indexterm6_d1e13354" class="indexterm"></a>As their name implies, <span class="emphasis"><em>global</em></span>
        variables are visible to all channels at all times. Global variables
        are useful in that they can be used anywhere within a dialplan to
        increase readability and manageability. Suppose for a moment that you
        had a large dialplan and several hundred references to the <code class="literal">SIP/0000FFFF0001</code> channel. Now imagine you
        had to go through your dialplan and change all of those references to
        <code class="literal">SIP/0000FFFF0002</code>. It would be a
        long and error-prone process, to say the least.</p><p><a id="DialplanBasics_id292966"></a>On the other hand, if you had
        defined a global variable that contained the value <code class="literal">SIP/0000FFFF0001</code> at the beginning of your
        dialplan and then referenced that instead, you would have to change
        only one line of code to affect all places in the dialplan where that
        channel was used.</p><p><a id="DialplanBasics_id292977"></a>Global variables should be declared
        in the <code class="literal">[globals]</code> context at the
        beginning of the <code class="filename">extensions.conf</code>
        file. As an example, we will create a global variable named <code class="literal">LEIF</code> with a value of <code class="literal">SIP/0000FFFF0001</code>. This variable is set at
        the time Asterisk parses the dialplan:</p><a id="I_programlisting5_tt792"></a><pre class="programlisting">[globals]
LEIF=SIP/0000FFFF0001</pre></div><div class="sect3" title="Channel variables"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.5.2"></a>Channel variables</h4></div></div></div><p><a id="DialplanBasics_id293016"></a><a id="I_indexterm6_d1e13392" class="indexterm"></a><a id="I_indexterm6_d1e13397" class="indexterm"></a>A <span class="emphasis"><em>channel</em></span> variable is a variable
        that is associated only with a particular call. Unlike global
        variables, channel variables are defined only for the duration of the
        current call and are available only to the channels participating in
        that call.</p><p><a id="DialplanBasics_id293025"></a>There are many predefined channel
        variables available for use within the dialplan, which are explained
        in the Asterisk wiki at <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Channel+Variables" target="_top">https://wiki.asterisk.org/wiki/display/AST/Channel+Variables</a>.
        Channel variables are set via the <code class="literal">Set()</code> application:</p><a id="I_programlisting5_tt794"></a><pre class="programlisting">exten =&gt; 202,1,Set(MagicNumber=42)
    same =&gt; n,SayNumber(${MagicNumber})</pre><p><a id="DialplanBasics_id293050"></a>You’re going to be seeing a lot
        more channel variables. Read on.</p></div><div class="sect3" title="Environment variables"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.5.3"></a>Environment variables</h4></div></div></div><p><a id="DialplanBasics_id293062"></a><span class="emphasis"><em>Environment</em></span>
        <a id="I_indexterm6_d1e13422" class="indexterm"></a><a id="I_indexterm6_d1e13427" class="indexterm"></a>variables are a way of accessing Unix environment
        variables from within Asterisk. These are referenced using the
        <code class="literal">ENV()</code> dialplan function.<sup>[<a id="id541092" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id541092" class="footnote">66</a>]</sup> The syntax looks like <code class="literal">${ENV(</code><em class="replaceable"><code>var</code></em><code class="literal">)}</code>, where <em class="replaceable"><code>var</code></em> is
        the Unix environment variable you wish to reference. Environment
        variables aren’t commonly used in Asterisk dialplans, but they are
        available should you need them.</p></div><div class="sect3" title="Adding variables to our dialplan"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.5.4"></a>Adding variables to our dialplan</h4></div></div></div><p><a id="DialplanBasics_id293108"></a><a id="I_indexterm6_d1e13456" class="indexterm"></a>Now that we’ve learned about variables, let’s put them
        to work in our dialplan. We’re going to add three global variables
        that will associate a variable name to a channel name:</p><a id="I_programlisting5_tt798"></a><pre class="programlisting">[globals]
LEIF=SIP/0000FFFF0001
JIM=SIP/0000FFFF0002
RUSSELL=SIP/0000FFFF0003

[LocalSets]
exten =&gt; 100,1,Dial(${LEIF})
exten =&gt; leif,1,Dial(${LEIF})

exten =&gt; 101,1,Dial(${JIM})
exten =&gt; jim,1,Dial(${JIM})

exten =&gt; 102,1,Dial(${RUSSELL})
exten =&gt; russell,1,Dial(${RUSSELL})

[TestMenu]
exten =&gt; 201,1,Answer()
   same =&gt; n,Background(enter-ext-of-person)
   same =&gt; n,WaitExten()

exten =&gt; 1,1,Dial(DAHDI/1,10)
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()

exten =&gt; 2,1,Dial(SIP/Jane,10)
   same =&gt; n,Playback(vm-nobodyavail)
   same =&gt; n,Hangup()

exten =&gt; i,1,Playback(pbx-invalid)
   same =&gt; n,Goto(incoming,123,1)

exten =&gt; t,1,Playback(vm-goodbye)
   same =&gt; n,Hangup()</pre><p><a id="DialplanBasics_id310803"></a>You’ll notice we’ve added pseudonym
        extension names for our extension numbers. In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2" title="Extensions">the section called “Extensions”</a>, we explained that Asterisk
        does not care which naming scheme you use to identify an extension.
        We’ve simply added both numeric and named extension identifiers for
        reaching the same endpoint; extensions <code class="literal">100</code> and <code class="literal">leif</code> both reach the device located at
        <span class="emphasis"><em><code class="literal">SIP/0000FFFF0001</code></em></span>, extensions
        <code class="literal">101</code> and <code class="literal">jim</code> both reach the device located at
        <span class="emphasis"><em><code class="literal">SIP/0000FFFF0002</code></em></span>, and both
        <code class="literal">102</code> and <code class="literal">russell</code> reach the device located at
        <span class="emphasis"><em><code class="literal">SIP/0000FFFF0003</code></em></span>. The devices are
        identified with the global variables <code class="literal">${LEIF}</code>, <code class="literal">${JIM}</code>, and <code class="literal">${RUSSELL}</code>, respectively, and we’re dialing
        those locations using the <code class="literal">Dial()</code>
        application.</p><p><a id="DialplanBasics_id310860"></a>In our test menu we’ve simply
        picked a couple of random endpoints to dial, such as <code class="literal">DAHDI/1</code> and <code class="literal">SIP/Jane</code>. These could be replaced with any
        available endpoints that you wish. Our <code class="literal">TestMenu</code> context has been built to start
        giving you an idea as to what an Asterisk dialplan looks
        like.<a id="I_indexterm6_d1e13523" class="indexterm"></a><a id="I_indexterm6_d1e13524" class="indexterm"></a></p></div></div><div class="sect2" title="Pattern Matching"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.6"></a>Pattern Matching</h3></div></div></div><p><a id="DialplanBasics_id293140"></a><a id="index-748O240AQ1R" class="indexterm"></a><a id="index-746L684FI1G" class="indexterm"></a>If we want to be able to allow people to dial
      <span class="emphasis"><em>through </em></span>Asterisk and have Asterisk connect them to
      outside resources, we need a way to match on any possible phone number
      that the caller might dial. For situations like this, Asterisk offers
      <span class="emphasis"><em>pattern matching</em></span>. Pattern matching allows you to
      create one extension in your dialplan that matches many different
      numbers. This is enormously useful.</p><div class="sect3" title="Pattern-matching syntax"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.6.1"></a>Pattern-matching syntax</h4></div></div></div><p><a id="DialplanBasics_id293160"></a><a id="I_indexterm6_d1e13552" class="indexterm"></a><a id="I_indexterm6_d1e13559" class="indexterm"></a>When using pattern matching, certain letters and symbols
        represent what we are trying to match. <span class="emphasis"><em>Patterns always start
        with an underscore</em></span> (<code class="literal">_</code>).<a id="I_indexterm6_d1e13571" class="indexterm"></a><a id="I_indexterm6_d1e13574" class="indexterm"></a> This tells Asterisk that we’re matching on a pattern,
        and not on an explicit extension name.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-32"></a>Warning</h3><p><a id="DialplanBasics_id293181"></a>If you forget the underscore at
          the beginning of your pattern, Asterisk will think it’s just a named
          extension and won’t do any pattern matching. This is one of the most
          common mistakes people make when starting to learn Asterisk.</p></div><p><a id="DialplanBasics_id293190"></a>After the underscore, you can use
        one or more of the following characters:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">X</code></span></dt><dd><p><a id="DialplanBasics_id293208"></a><a id="DialplanBasics_id293210"></a>Matches any single digit from
              0 to 9.</p></dd><dt><span class="term"><code class="literal">Z</code></span></dt><dd><p><a id="DialplanBasics_id293226"></a><a id="DialplanBasics_id293228"></a>Matches any single digit from
              1 to 9.</p></dd><dt><span class="term"><code class="literal">N</code></span></dt><dd><p><a id="DialplanBasics_id293246"></a><a id="DialplanBasics_id293248"></a>Matches any single digit from
              2 to 9.</p></dd><dt><span class="term"><code class="literal">[15-7]</code></span></dt><dd><p><a id="DialplanBasics_id293266"></a><a id="DialplanBasics_id293268"></a>Matches a single character
              from the range of digits specified. In this case, the pattern
              matches a single 1, as well as any number in the range 5, 6,
              7.</p></dd><dt><span class="term"><code class="literal">.</code>
            (period)</span></dt><dd><p><a id="DialplanBasics_id293286"></a><a id="DialplanBasics_id293288"></a>Wildcard match; matches
              <span class="emphasis"><em>one or more</em></span> characters, no matter what they
              are.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-DP-Basics-NOTE-33"></a>Warning</h3><p><a id="DialplanBasics_id293301"></a>If you’re not careful,
                wildcard matches can make your dialplans do things you’re not
                expecting (like matching built-in extensions such as <code class="literal">i</code> or <code class="literal">h</code>). You should use the wildcard
                match in a pattern only after you’ve matched as many other
                digits as possible. For example, the following pattern match
                should probably never be used:</p><a id="I_programlisting5_tt807"></a><pre class="programlisting">_.</pre><p><a id="DialplanBasics_id293329"></a>In fact, Asterisk will warn
                you if you try to use it. Instead, if you really need a
                catch-all pattern match, use this one to match all strings
                that start with a digit:</p><a id="I_programlisting5_tt808"></a><pre class="programlisting">_X.</pre><p><a id="DialplanBasics_id293341"></a>Or this one, to match any
                alphanumeric string:</p><a id="DialplanBasics_id293344"></a><pre class="programlisting">_[0-9a-zA-Z].</pre></div></dd><dt><span class="term">! <span class="emphasis"><em>(bang)</em></span></span></dt><dd><p><a id="DialplanBasics_id293360"></a><a id="DialplanBasics_id293362"></a>Wildcard <a id="I_indexterm6_d1e13650" class="indexterm"></a>match; matches <span class="emphasis"><em>zero or more</em></span>
              characters, no matter what they are.</p></dd></dl></div><p><a id="DialplanBasics_id293372"></a>To use pattern matching in your
        dialplan, simply put the pattern in the place of the extension name
        (or number):</p><a id="I_programlisting5_tt811"></a><pre class="programlisting">exten =&gt; _NXX,1,Playback(silence/1&amp;auth-thankyou)</pre><p><a id="DialplanBasics_id293384"></a>In this example, the pattern
        matches any three-digit extension from 200 through 999 (the <code class="literal">N</code> matches any digit between 2 and 9, and
        each <code class="literal">X</code> matches a digit between 0
        and 9). That is to say, if a caller dialed any three-digit extension
        between 200 and 999 in this context, he would hear the sound file
        <span class="emphasis"><em>auth-thankyou.gsm</em></span>.</p><p><a id="DialplanBasics_id293404"></a>One other important thing to know
        about pattern matching is that if Asterisk finds more than one pattern
        that matches the dialed extension, it will use the <span class="emphasis"><em>most
        specific</em></span> one (going from left to right). Say you had
        defined the following two patterns, and a caller dialed <code class="literal">555-1212</code>:</p><a id="I_programlisting5_tt812"></a><pre class="programlisting">exten =&gt; _555XXXX,1,Playback(silence/1&amp;digits/1)
exten =&gt; _55512XX,1,Playback(silence/1&amp;digits/2)</pre><p><a id="DialplanBasics_id293426"></a>In this case the second extension
        would be selected, because it is more specific.</p></div><div class="sect3" title="Pattern-matching examples"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.6.2"></a>Pattern-matching examples</h4></div></div></div><p><a id="DialplanBasics_id293439"></a><a id="I_indexterm6_d1e13691" class="indexterm"></a>This pattern matches any seven-digit number, as long as
        the first digit is 2 or higher:</p><a id="I_programlisting5_tt813"></a><pre class="programlisting">_NXXXXXX</pre><p><a id="DialplanBasics_id293450"></a>The preceding pattern would be
        compatible with any North American Numbering Plan local seven-digit
        number.</p><p><a id="DialplanBasics_id293454"></a>In areas with 10-digit dialing,
        that pattern would look like this:</p><p><a id="DialplanBasics_id293458"></a><a id="I_programlisting5_tt814"></a></p><pre class="programlisting">_NXXNXXXXXX</pre><p>Note
        that neither of these two patterns would handle long-distance calls.
        We’ll cover those shortly.</p><div class="sidebar" title="The NANP and Toll Fraud"><a id="asterisk-DP-Basics-SIDEBAR-3.1"></a><div class="titlepage"><div><div><p class="title"><strong>The NANP and Toll Fraud</strong></p></div></div></div><p><a id="DialplanBasics_id293477"></a>The North American Numbering Plan
          (NANP)<a id="I_indexterm6_d1e13714" class="indexterm"></a><a id="I_indexterm6_d1e13719" class="indexterm"></a> is a shared telephone numbering scheme used by 19
          countries in North America and the Caribbean. All of these countries
          share country code 1.</p><p><a id="DialplanBasics_id293482"></a>In the United States and Canada,
          telecom regulations are similar (and sensible) enough that you can
          place a long-distance call to most numbers in country code 1 and
          expect to pay a reasonable toll. However, many people don’t realize
          that 17 other countries, many of which have very different telecom
          regulations, share the NANP. (More information can be found at
          <a class="ulink" href="http://www.nanpa.com/" target="_top">http://www.nanpa.com</a>.)</p><p><a id="DialplanBasics_id293498"></a>One popular scam <a id="I_indexterm6_d1e13731" class="indexterm"></a>using the NANP tries to trick naïve North Americans
          into calling expensive per-minute toll numbers in a Caribbean
          country; the callers believe that since they dialed 1-NPA-NXX-XXXX
          to reach the number, they’ll be paying their standard national
          long-distance rate for the call. Since the country in question may
          have regulations that allow for this form of extortion, the caller
          is ultimately held responsible for the call charges.</p><p><a id="DialplanBasics_id293507"></a>The only way to prevent this sort
          of activity is to block calls to certain area codes (809, for
          example) and remove the restrictions only on an as-needed
          basis.</p></div><p><a id="DialplanBasics_id293513"></a>Let’s try another:</p><a id="I_programlisting5_tt817"></a><pre class="programlisting">_1NXXNXXXXXX</pre><p><a id="DialplanBasics_id293523"></a>This one will match the number 1,
        followed by an area code between 200 and 999, then any seven-digit
        number. In the NANP calling area, you would use this pattern to match
        any long-distance number.<sup>[<a id="asterisk-DP-Basics-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-DP-Basics-FN-8" class="footnote">67</a>]</sup></p><p><a id="DialplanBasics_id293543"></a>And finally this one:</p><a id="I_programlisting5_tt818"></a><pre class="programlisting">_011.</pre><p><a id="DialplanBasics_id293553"></a>Note the period on the end. This
        pattern matches any number that starts with 011 and has at least one
        more digit. In the NANP, this indicates an international phone number.
        (We’ll be using these patterns in the next section to add outbound
        dialing capabilities to our dialplan.)</p><div class="sidebar" title="Pattern Matches in Other Countries"><a id="DialplanBasics_id293562"></a><div class="titlepage"><div><div><p class="title"><strong>Pattern Matches in Other Countries</strong></p></div></div></div><p><a id="DialplanBasics_id293567"></a>The examples in this section were
          NANPA-centric, but the basic logic applies in any country. Here are
          some examples for other countries (note that we were not able to
          test these, and they are almost certainly incomplete):</p><p><a id="DialplanBasics_id293572"></a><a id="DialplanBasics_id293574"></a></p><pre class="programlisting">; UK, Germany, Italy, China, etc.
_00. ; international dialing code
_0. ; national dialing prefix

; Australia
_0011. ; international dialing code
_0. ; national dialing prefix

</pre><p>This is by no means comprehensive, but it should give you a
          general idea of the patterns you’ll want to consider for your own
          country.</p></div></div><div class="sect3" title="Using the ${EXTEN} channel variable"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-DP-Basics-SECT-3.6.3"></a>Using the ${EXTEN} channel variable</h4></div></div></div><p><a id="DialplanBasics_id293590"></a><a id="I_indexterm6_d1e13767" class="indexterm"></a><a id="I_indexterm6_d1e13774" class="indexterm"></a><a id="I_indexterm6_d1e13777" class="indexterm"></a>So what happens if you want to use pattern matching but
        need to know which digits were actually dialed? Enter the <code class="literal">${EXTEN}</code> channel variable. Whenever you dial
        an extension, Asterisk sets the <code class="literal">${EXTEN}</code> channel variable to the digits that
        were dialed. We can use an application called <code class="literal">SayDigits()</code> to test this out:</p><a id="I_programlisting5_tt820"></a><pre class="programlisting">exten =&gt; _XXX,1,Answer()
   same =&gt; n,SayDigits(${EXTEN})</pre><p><a id="DialplanBasics_id293618"></a>In this example, the <code class="literal">SayDigits()</code> application will read back to
        you the three-digit extension you dialed.</p><p><a id="DialplanBasics_id293627"></a>Often, it’s useful to manipulate
        the <code class="literal">${EXTEN}</code> by stripping a certain
        number of digits off the front of the extension. This is accomplished
        by using the syntax <code class="literal">${EXTEN:</code><em class="replaceable"><code>x</code></em><code class="literal">}</code>, where <em class="replaceable"><code>x</code></em> is
        where you want the returned string to start, from left to right. For
        example, if the value of <code class="literal">${EXTEN}</code>
        is <code class="literal">95551212</code>, <code class="literal">${EXTEN:1}</code> equals <code class="literal">5551212</code>. Let’s try another example:</p><a id="I_programlisting5_tt822"></a><pre class="programlisting">exten =&gt; _XXX,1,Answer()
   same =&gt; n,SayDigits(${EXTEN:1})</pre><p><a id="DialplanBasics_id293673"></a>In this example, the <code class="literal">SayDigits()</code> application would start at the
        second digit, and thus read back only the last two digits of the
        dialed extension.</p><div class="sidebar" title="More Advanced Digit Manipulation"><a id="I_sidebar5_tt824"></a><div class="titlepage"><div><div><p class="title"><strong>More Advanced Digit Manipulation</strong></p></div></div></div><p><a id="DialplanBasics_id293690"></a>The <code class="literal">${EXTEN}</code> variable properly has the syntax
          <code class="literal">${EXTEN</code>:<em class="replaceable"><code>x</code></em>:<em class="replaceable"><code>y</code></em><code class="literal">}</code>, where <em class="replaceable"><code>x</code></em> is
          the starting position and <em class="replaceable"><code>y</code></em> is the number
          of digits to return. Given the following dial string:</p><p><a id="DialplanBasics_id293719"></a><a id="I_programlisting5_tt825"></a></p><pre class="programlisting">94169671111</pre><p><a id="DialplanBasics_id293728"></a>we can extract the following
          digit strings using the <code class="literal">${EXTEN:<em class="replaceable"><code>x</code></em>:<em class="replaceable"><code>y</code></em>}</code>
          construct:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">${EXTEN:1:3}</code> would contain <code class="literal">416</code></p></li><li class="listitem"><p><code class="code">${EXTEN:4:7}</code> would contain <code class="literal">9671111</code></p></li><li class="listitem"><p><code class="code">${EXTEN:-4:4}</code> would start four digits from
              the end and return four digits, giving us <code class="literal">1111</code></p></li><li class="listitem"><p><code class="code">${EXTEN:2:-4}</code> would start two digits in and
              exclude the last four digits, giving us <code class="literal">16967</code></p></li><li class="listitem"><p><code class="code">${EXTEN:-6:-4}</code> would start six digits from
              the end and exclude the last four digits, giving us <code class="literal">67</code></p></li><li class="listitem"><p><code class="code">${EXTEN:1}</code> would give us everything after the
              first digit, or <code class="literal">4169671111</code>
              (if the number of digits to return is left blank, it will return
              the entire remaining string)</p></li></ul></div><p><a id="DialplanBasics_id293785"></a>This is a very powerful
          construct, but most of these variations are not very common in
          normal use. For the most part, you will be using <code class="literal">${EXTEN}</code> (or perhaps <code class="literal">${EXTEN:1}</code> if you need to strip off an
          external access code).<a id="I_indexterm6_d1e13925" class="indexterm"></a><a id="I_indexterm6_d1e13926" class="indexterm"></a></p></div></div></div><div class="sect2" title="Includes"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-DP-Basics-SECT-3.8"></a>Includes</h3></div></div></div><p><a id="DialplanBasics_id293809"></a><a id="I_indexterm6_d1e13931" class="indexterm"></a><a id="I_indexterm6_d1e13938" class="indexterm"></a>Asterisk has an important feature that allows extensions
      from one context to be available from within another context. This is
      accomplished through use of the <code class="literal">include</code> directive. The <code class="literal">include</code> directive allows us to control access
      to different sections of the dialplan.</p><p><a id="DialplanBasics_id293820"></a>The <code class="literal">include</code> statement takes the following form,
      where <em class="replaceable"><code>context</code></em> is the name of the remote
      context we want to include in the current context:</p><a id="I_programlisting5_tt833"></a><pre class="programlisting">include =&gt; <em class="replaceable"><code>context</code></em></pre><p><a id="DialplanBasics_id293842"></a>Including one context within another
      context allows extensions within the included context to be
      dialable.</p><p><a id="DialplanBasics_id293846"></a>When we include other contexts within
      our current context, we have to be mindful of the order in which we are
      including them. Asterisk will first try to match the dialed extension in
      the current context. If unsuccessful, it will then try the first
      included context (including any contexts included in that context), and
      then continue to the other included contexts in the order in which they
      were included.</p><p><a id="DialplanBasics_id293853"></a>We will discuss the <code class="literal">include</code> directive more in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.<a id="I_indexterm6_d1e13971" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-DP-Basics-SECT-4"></a>Conclusion</h2></div></div></div><p><a id="DialplanBasics_id293870"></a>And there you have it—a basic but
    functional dialplan. There is still much we have not covered, but you’ve
    got all of the fundamentals. In the following chapters, we’ll continue to
    build on this foundation.</p><p><a id="DialplanBasics_id293877"></a>If parts of this dialplan don’t make
    sense, you may want to go back and reread a section or two before
    continuing on to the next chapter. It’s imperative that you understand
    these principles and how to apply them, as the next chapters build on this
    information.<a id="I_indexterm6_d1e13980" class="indexterm"></a><a id="I_indexterm6_d1e13981" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id536698" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id536698" class="para">54</a>] </sup>This is a very important consideration. With traditional PBXs,
          there are generally a set of defaults <a id="I_indexterm6_d1e11985" class="indexterm"></a>for things like reception, which means that if you
          forget to define them, they will probably work anyway. In Asterisk,
          the opposite is true. If you do not tell Asterisk how to handle
          every situation, and it comes across something it cannot handle, the
          call will typically be disconnected. We’ll cover some best practices
          later that will help ensure this does not happen. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2" title="Handling Invalid Entries and Timeouts">the section called “Handling Invalid Entries and Timeouts”</a> for more
          information.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-DP-Basics-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-FN-1" class="para">55</a>] </sup>Please note that the space is conspicuously absent from the
          list of allowed characters. Don’t use spaces in your context
          names—you won’t like the result!</p></div><div class="footnote"><p><sup>[<a id="ftn.id537608" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id537608" class="para">56</a>] </sup>Asterisk permits simple arithmetic within the priority, such
            as <code class="literal">n+200</code>, and the priority
            <code class="literal">s</code> (for same), but their usage
            is somewhat deprecated due to the existence of priority labels.
            Please note that <span class="emphasis"><em>extension</em></span> <code class="literal">s</code> and <span class="emphasis"><em>priority</em></span>
            <code class="literal">s</code> are two distinct
            concepts.</p></div><div class="footnote"><p><sup>[<a id="ftn.id538059" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id538059" class="para">57</a>] </sup>Except in some parts of <code class="filename">voicemail.conf</code>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id538222" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id538222" class="para">58</a>] </sup>There is another application called <code class="literal">Background()</code> that is very similar to
          <code class="literal">Playback()</code>, except that it does
          allow input from the caller. You can read more about this
          application in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR" title="Chapter 17. Interactive Voice Response">Chapter&nbsp;17, <em>Interactive Voice Response</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-DP-Basics-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-FN-2" class="para">59</a>] </sup>Asterisk selects the best file based on translation
          cost—<a id="I_indexterm6_d1e12562" class="indexterm"></a><a id="I_indexterm6_d1e12565" class="indexterm"></a>that is, it selects the file that is the least
          CPU-intensive to convert to its native audio format. When you start
          Asterisk, it calculates the translation costs between the different
          audio formats (they often vary from system to system). You can see
          these translation costs by typing <span class="command"><strong>show
          translation</strong></span> at the Asterisk command-line interface. The
          numbers shown represent how many milliseconds it takes Asterisk to
          transcode one second of audio. We’ll talk more about the different
          audio formats (known as <span class="emphasis"><em>codecs</em></span>) in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3" title="Codecs">the section called “Codecs”</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id539119" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id539119" class="para">60</a>] </sup>It should be noted that some people expect that <code class="literal">Background()</code>, due to its name, will
          continue onward through the next steps in the dialplan while the
          sound is being played. In reality, its name refers to the fact that
          it is playing a sound in the background, while waiting for DTMF in
          the foreground.</p></div><div class="footnote"><p><sup>[<a id="ftn.id539214" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id539214" class="para">61</a>] </sup>More information about auto attendants can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id539363" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id539363" class="para">62</a>] </sup>See the dialplan function <code class="literal">TIMEOUT()</code> for information on how to change
          the default timeouts. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper" title="Chapter 10. Deeper into the Dialplan">Chapter&nbsp;10, <em>Deeper into the Dialplan</em></a> for
          information on what dialplan functions are.</p></div><div class="footnote"><p><sup>[<a id="ftn.id539923" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id539923" class="para">63</a>] </sup>If this were a production environment, this would not
            actually be a good name for this device. If you have more than one
            softphone on your system (or add another in the future), how will
            you tell them apart?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-DP-Basics-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-FN-3" class="para">64</a>] </sup>We’ll cover variables in the upcoming section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5" title="Using Variables">the section called “Using Variables”</a>. In future chapters we’ll
            discuss how to have your dialplan make decisions based on the
            value of <code class="literal">DIALSTATUS</code>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id540155" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id540155" class="para">65</a>] </sup>Bear in mind that this assumes that this channel connects to
            something that knows how to reach external numbers.</p></div><div class="footnote"><p><sup>[<a id="ftn.id541092" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id541092" class="para">66</a>] </sup>We’ll get into dialplan functions later. Don’t worry too
            much about environment variables right now. They are not important
            to understanding the dialplan.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-DP-Basics-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-FN-8" class="para">67</a>] </sup>If you grew up in North America, you may believe that the 1
            you dial before a long-distance call is “the long-distance code.”
            This is incorrect. The number 1 is the international country code
            for NANP. Keep this in mind if you send your phone number to
            someone in another country. The recipient may not know your
            country code, and thus be unable to call you with just your area
            code and phone number. Your full phone number with country code is
            +1 NPA NXX XXXX (where NPA is your area code)―e.g., +1 416 555
            1212.</p></div></div></div><div class="chapter" title="Chapter 7. Outside Connectivity"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-OutsideConn"></a>Chapter&nbsp;7.&nbsp;Outside Connectivity</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn-SECT-1">The Basics of Trunking</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271202">PSTN Circuits</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271212">Traditional PSTN Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240837">Digital telephony</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240851">Installing PSTN Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291235">VoIP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291257">VoIP to VoIP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291268">Configuring VoIP Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291281">Configuring SIP trunks between Asterisk systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291291">Configuring IAX trunks between Asterisk systems</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291322">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="OutsideConnectivity_id265047"></a>You cannot always control what
    goes on outside. But you can always control what goes on inside.</p><div class="attribution"><span>—<span class="attribution">Wayne Dyer</span></span></div></div><p><a id="OutsideConnectivity_id267012"></a><a id="index-042C776PN5F" class="indexterm"></a><a id="index-764V025VP1W" class="indexterm"></a>In the previous chapters, we have covered a lot of important
  information that is essential to a working Asterisk system. However, we have
  yet to accomplish the one thing that is vital to any useful PBX: namely,
  connecting it to the outside world. In this chapter we will rectify that
  situation.</p><p><a id="OutsideConnectivity_id272084"></a>The architecture of Asterisk is
  significant, due in large part to the fact that it treats all channel types
  as equal. This is in contrast to a traditional PBX, where trunks (which
  connect to the outside world) and extensions (which connect to users and
  resources) are very different. The fact that the Asterisk dialplan treats
  all channels in a similar manner means that in an Asterisk system you can
  accomplish very easily things that are much more difficult (or impossible)
  to achieve on a traditional PBX.</p><p><a id="OutsideConnectivity_id270249"></a>This flexibility does come with a
  price, however. Since the system does not inherently know the difference
  between an internal resource (such as a telephone set) and an external
  resource (for example, a telco circuit), it is up to you to ensure that your
  <span class="keep-together">dial</span><span class="keep-together">plan</span> handles each type of resource
  appropriately.</p><div class="sect1" title="The Basics of Trunking"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-OutsideConn-SECT-1"></a>The Basics of Trunking</h2></div></div></div><p><a id="OutsideConnectivity_id241507"></a><a id="I_indexterm7_d1e14013" class="indexterm"></a><a id="I_indexterm7_d1e14018" class="indexterm"></a>The purpose of <span class="emphasis"><em>trunking</em></span> is to provide a
    shared connection between two entities. For example, a trunk road would be
    a highway that connects two towns together. Railroads used the term
    “trunk” extensively, to refer to a major line that connected feeder lines
    together.</p><p><a id="OutsideConnectivity_id270116"></a>Similarly, in telecom, trunking is
    used to connect two systems together. Carriers use telecom trunks to
    connect their networks together, and in a PBX, the circuits that connect
    the PBX to the outside world are commonly referred to as trunks (although
    the carriers themselves do not generally consider these to be trunks).
    From a technical perspective, the definition of a trunk is not as clear as
    it used to be (PBX trunks used totally different technology from station
    circuits), but as a concept, trunks are still very important. For example,
    with VoIP, everything is actually peer-to-peer (so from a technology
    perspective there isn’t really such a thing as a trunk anymore), but it is
    still useful to be able to differentiate between VoIP resources that
    connect to the outside world and VoIP resources that connect to user
    endpoints (such as SIP telephones).</p><p><a id="OutsideConnectivity_id271541"></a>It’s probably easiest to think of
    a trunk as a collection of circuits that service a route. So, in an
    Asterisk PBX, you might have trunks that go to your VoIP provider for
    long-distance calls, trunks for your PSTN circuits, and trunks that
    connect your various offices together. These trunks might actually run
    across the same network connection, but in your dialplan you could treat
    them quite differently.</p><p><a id="OutsideConnectivity_id255139"></a>While we believe that VoIP will
    eventually completely replace the PSTN, many of the concepts that are in
    use on VoIP circuits (such as a “phone number”) owe their existence more
    to history than any technical requirement, and thus we feel it will be
    helpful to discuss using traditional PSTN circuits with Asterisk before we
    get into VoIP.</p><p><a id="OutsideConnectivity_id247553"></a>If the system you are installing
    will use VoIP circuits only, that is not a problem. Go straight to the
    VoIP section of this chapter,<sup>[<a id="id542986" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id542986" class="footnote">68</a>]</sup> and we’ll take you through what you need to do. We do
    recommend reading the PSTN sections at your convenience, since there may
    be general knowledge in them that could be of use to you, but it is not
    strictly required in order to understand and use Asterisk.</p></div><div class="sect1" title="Fundamental Dialplan for Outside Connectivity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="OutsideConnectivity_id242479"></a>Fundamental Dialplan for Outside Connectivity</h2></div></div></div><p><a id="OutsideConnectivity_id264321"></a><a id="I_indexterm7_d1e14043" class="indexterm"></a><a id="I_indexterm7_d1e14048" class="indexterm"></a>In a traditional PBX, external lines are generally accessed
    by way of an access code that must be dialed before the number.<sup>[<a id="id543047" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id543047" class="footnote">69</a>]</sup> It is common to use the digit 9 <a id="I_indexterm7_d1e14058" class="indexterm"></a><a id="I_indexterm7_d1e14061" class="indexterm"></a><a id="I_indexterm7_d1e14064" class="indexterm"></a>for this purpose.</p><p><a id="OutsideConnectivity_id263549"></a>In Asterisk, it is similarly
    possible to assign 9 for routing of external calls, but since the Asterisk
    dialplan is so much more intelligent, it is not really necessary to force
    your users to dial 9 before placing a call. Typically, you will have an
    extension range for your system (say, 100–199), and a feature code range
    (*00 to *99). Anything outside those ranges that matches the dialing
    pattern for your country or region can be treated as an external
    call.</p><p><a id="OutsideConnectivity_id253377"></a>If you have one carrier providing
    all of your external routing, you can handle your external dialing
    <a id="I_indexterm7_d1e14074" class="indexterm"></a>through a few simple pattern matches. The example in this
    section is valid for the North American Numbering Plan (NANP). If your
    country is not within the NANP (which serves Canada, the US, and several
    Caribbean countries), you will need a different pattern match.</p><p><a id="OutsideConnectivity_id289542"></a>The <code class="literal">[globals]</code> section contains two variables, named
    <code class="literal">LOCAL</code> and <code class="literal">TOLL</code>.<sup>[<a id="id543157" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id543157" class="footnote">70</a>]</sup> The purpose of these variables is to simplify management of
    your dialplan should you ever need to change carriers. They allow you to
    make one change to the dialplan that will affect all places where the
    specified channel is referred to:</p><p><a id="OutsideConnectivity_id216507"></a><a id="OutsideConnectivity_id216508"></a></p><pre class="programlisting">[globals]
LOCAL=DAHDI/G0           ; assuming you have a PSTN card in your system
TOLL=SIP/YourVoipCarrier ; as defined in sip.conf
</pre><p><a id="OutsideConnectivity_id216512"></a>The <code class="literal">[external]</code> section <a id="I_indexterm7_d1e14101" class="indexterm"></a>contains the actual dialplan code that will recognize the
    numbers dialed and pass them to the <code class="function">Dial()</code> application<sup>[<a id="id543219" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id543219" class="footnote">71</a>]</sup>:</p><p><a id="OutsideConnectivity_id271158"></a><a id="OutsideConnectivity_id271159"></a></p><pre class="programlisting">[external]
exten =&gt; _NXXNXXXXXX,1,Dial(${LOCAL}/${EXTEN})  ; 10-digit pattern match for NANP
exten =&gt; _NXXXXXX,1,Dial(${LOCAL}/${EXTEN})    ; 7-digit pattern match for NANP
exten =&gt; _1NXXNXXXXXX,1,Dial(${TOLL}/${EXTEN}) ; Long-distance pattern match for NANP
exten =&gt; _011.,1,Dial(${TOLL}/${EXTEN})        ; International pattern match for 
                                               ; calls made from NANP

; This section is functionally the same as the above section. 
; It is for people who like to dial '9' before their calls
exten =&gt; _9NXXNXXXXXX,1,Dial(${LOCAL}/${EXTEN:1})
exten =&gt; _9NXXXXXX,1,Dial(${LOCAL}/${EXTEN:1})
exten =&gt; _91NXXNXXXXXX,1,Dial(${TOLL}/${EXTEN:1})
exten =&gt; _9011.,1,Dial(${TOLL}/${EXTEN:1})
</pre><p><a id="OutsideConnectivity_id271173"></a>In any context that would be used
    by sets or user devices, you would use an <code class="function">include</code>=&gt; directive to allow access to the
    <code class="literal">external</code> context:</p><a id="OutsideConnectivity_id271181"></a><pre class="programlisting">[LocalSets]
include =&gt; external</pre><p><a id="OutsideConnectivity_id271184"></a></p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="OutsideConnectivity_id271187"></a>It is critically important
        that you do not include access to the external lines in any context
        <a id="I_indexterm7_d1e14131" class="indexterm"></a><a id="I_indexterm7_d1e14136" class="indexterm"></a>that might process an incoming call. The risk here is
        that a phishing bot could eventually gain access to your outgoing
        trunks (you’d be surprised at how common these phishing bots
        are).</p><p><a id="OutsideConnectivity_id271193"></a>We cannot stress enough how
        important it is that you ensure that no external resource can access
        your toll lines.<a id="I_indexterm7_d1e14144" class="indexterm"></a></p></div></div><div class="sect1" title="PSTN Circuits"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="OutsideConnectivity_id271202"></a>PSTN Circuits</h2></div></div></div><p><a id="OutsideConnectivity_id271207"></a><a id="index-864B401AN5I" class="indexterm"></a><a id="index-231T537UW2U" class="indexterm"></a>The Public Switched Telephone Network (PSTN) has existed for
    over a century. It is the precursor to many of the technologies that shape
    our world today, from the Internet to MP3 players.</p><div class="sect2" title="Traditional PSTN Trunks"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id271212"></a>Traditional PSTN Trunks</h3></div></div></div><p><a id="OutsideConnectivity_id271218"></a><a id="I_indexterm7_d1e14166" class="indexterm"></a>There are two types of fundamental technology that phone
      carriers use to deliver telephone circuits: analog and digital.</p><div class="sect3" title="Analog telephony"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id262143"></a>Analog telephony</h4></div></div></div><p><a id="OutsideConnectivity_id262149"></a><a id="I_indexterm7_d1e14178" class="indexterm"></a>The first telephone networks were all analog. The audio
        signal that you generated with your voice was used to generate an
        electrical signal that was carried to the other end. The electrical
        signal had the same characteristics as the sound being
        produced.</p><p><a id="OutsideConnectivity_id262154"></a>Analog circuits have several
        characteristics that differentiate them from other circuits you might
        wish to connect to Asterisk:</p><div class="itemizedlist"><a id="OutsideConnectivity_id262159"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id262161"></a><a id="OutsideConnectivity_id262163"></a>No signaling channel
            exists—most signaling is electromechanical.</p></li><li class="listitem"><p><a id="OutsideConnectivity_id262167"></a><a id="OutsideConnectivity_id262170"></a>Disconnect supervision is
            usually delayed by several seconds, and is not completely
            reliable.</p></li><li class="listitem"><p><a id="OutsideConnectivity_id262174"></a><a id="OutsideConnectivity_id262176"></a>Far-end supervision is
            minimal (for example, answer supervision is lacking).</p></li><li class="listitem"><p><a id="OutsideConnectivity_id262181"></a><a id="OutsideConnectivity_id262183"></a>Differences in circuits
            means that audio characteristics will vary from circuit to
            circuit, and will require tuning.</p></li></ul></div><p><a id="OutsideConnectivity_id262190"></a>Analog circuits that you wish
        to connect to your Asterisk system will need to connect to a Foreign
        eXchange Office (FXO) port.<a id="I_indexterm7_d1e14201" class="indexterm"></a> Since there is no such thing as an FXO port in any
        standard computer, an FXO card must be purchased and installed in the
        system in order to connect traditional analog lines.<sup>[<a id="id543586" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id543586" class="footnote">72</a>]</sup></p><div class="sidebar" title="FXO and FXS"><a id="OutsideConnectivity_id270768"></a><div class="titlepage"><div><div><p class="title"><strong>FXO and FXS</strong></p></div></div></div><p><a id="OutsideConnectivity_id270773"></a><a id="I_indexterm7_d1e14212" class="indexterm"></a>For any analog circuit, there are two ends: the office
          (typically the central office of the PSTN), and the station
          (typically a phone, but could also be a card such as a modem or line
          card in a PBX).</p><p><a id="OutsideConnectivity_id270778"></a>The central office is
          responsible for:</p><div class="itemizedlist"><a id="OutsideConnectivity_id270782"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id270784"></a><a id="OutsideConnectivity_id270786"></a>Power on the line
              (nominally 48 VDC)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id270791"></a><a id="OutsideConnectivity_id270793"></a>Ringing voltage
              (nominally 90 VAC)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id270798"></a><a id="OutsideConnectivity_id270800"></a>Providing dial
              tone</p></li><li class="listitem"><p><a id="OutsideConnectivity_id270804"></a><a id="OutsideConnectivity_id270806"></a>Detecting hook state
              (off-hook and on-hook)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id240774"></a><a id="OutsideConnectivity_id240776"></a>Sending supplementary
              signaling such as caller ID</p></li></ul></div><p><a id="OutsideConnectivity_id240782"></a>The
          station is responsible for:</p><div class="itemizedlist"><a id="OutsideConnectivity_id240785"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id240787"></a><a id="OutsideConnectivity_id240789"></a>Providing a ringer (or
              at least being able to handle ringing voltage in some
              manner)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id240795"></a><a id="OutsideConnectivity_id240797"></a>Providing a dialpad (or
              some way of sending DTMF)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id240801"></a><a id="OutsideConnectivity_id240803"></a>Providing a hook switch
              to indicate the status of the line</p></li></ul></div><p><a id="OutsideConnectivity_id240808"></a>A Foreign eXchange (FX) port
          <span class="emphasis"><em>is named by what it connects to</em></span>, not by what it
          does. So, for example, a Foreign eXchange Office (FXO) port is
          actually a station: it connects to the central office. A Foreign
          eXchange Station (FXS) port is actually a port that provides the
          services of a central office (in other words, you would plug an
          analog set into an FXS port).</p><p><a id="OutsideConnectivity_id240817"></a>It is for this reason that
          the signaling settings in the Asterisk config files<a id="I_indexterm7_d1e14254" class="indexterm"></a> seem backwards: FXO ports use FXS signaling; FXS
          ports use FXO signaling. When you understand that the name of the
          physical port type is based on what it connects to, the signaling
          names in Asterisk make a bit more sense: if an FXO port connects to
          the central office, it needs to be able to behave as a station, and
          therefore needs FXS signaling.</p><p><a id="OutsideConnectivity_id240825"></a>Note that changing from FXO
          to FXS is not something you can simply do with a settings change.
          FXO and FXS ports require completely different electronics. Most
          analog cards available for Asterisk use some form of daughter card
          that connects to the main card and provides the correct channel
          type, meaning that you have some flexibility in defining what types
          of ports you have on your card.</p></div><p><a id="OutsideConnectivity_id240834"></a>Analog ports are not generally
        used in medium to large systems. They are most commonly used in
        smaller offices (less than 10 lines; less than 30 phones). Your
        decision to use analog might be based on some of the following
        factors:</p><div class="itemizedlist"><a id="OutsideConnectivity_id36061119"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id36061122"></a><a id="OutsideConnectivity_id36061124"></a>Availability of digital
            trunks in your area</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061128"></a><a id="OutsideConnectivity_id36061130"></a>Cost (analog is less
            expensive at smaller densities, but more expensive at higher
            densities)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061134"></a><a id="OutsideConnectivity_id36061136"></a>Logistics (if you
            already have analog lines installed, you may wish to keep
            them)</p></li></ul></div><p><a id="OutsideConnectivity_id36061142"></a>From a technical
        perspective, you would normally want to have digital rather than
        analog circuits. Reality does not always accommodate, though, so
        analog will likely be around for a few more years yet.</p></div><div class="sect3" title="Digital telephony"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id240837"></a>Digital telephony</h4></div></div></div><p><a id="OutsideConnectivity_id240843"></a><a id="I_indexterm7_d1e14280" class="indexterm"></a>Digital telephony was developed in order to overcome
        many of the limitations of analog. Some of the benefits of digital
        circuits include:</p><div class="itemizedlist"><a id="OutsideConnectivity_id36061160"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id36061162"></a><a id="OutsideConnectivity_id36061164"></a>No loss of amplitude
            over long distances</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061169"></a><a id="OutsideConnectivity_id36061171"></a>Reduced noise on
            circuits (especially long-distance circuits)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061175"></a><a id="OutsideConnectivity_id36061177"></a>Ability to carry more
            than one call per circuit</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061181"></a><a id="OutsideConnectivity_id36061184"></a>Faster call setup and
            teardown</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061188"></a><a id="OutsideConnectivity_id36061190"></a>Richer signaling
            information (especially if using ISDN)</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061194"></a><a id="OutsideConnectivity_id36061196"></a>Lower cost for
            carriers</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36061201"></a><a id="OutsideConnectivity_id36061203"></a>Lower cost for customers
            (at higher densities)</p></li></ul></div><p><a id="OutsideConnectivity_id240846"></a>In an Asterisk system (or any
        PBX, for that matter), there are several types of digital circuits you
        might want to connect:</p><div class="variablelist"><dl><dt><span class="term">T1 (24 channels)</span></dt><dd><p>Used in Canada and the United States (mostly for
              ISDN-PRI)</p></dd><dt><span class="term">E1 (32 channels)</span></dt><dd><p>Used in the rest of the world (ISDN-PRI or MFC/R2)</p></dd><dt><span class="term">BRI (2 channels)</span></dt><dd><p>Used for ISDN-BRI circuits (Euro-ISDN)</p></dd></dl></div><p><a id="OutsideConnectivity_id36061258"></a>Note that the physical
        circuit can be further defined by the protocol running on the circuit.
        For example, a T1 could be used for either ISDN-PRI, or CAS, and an E1
        could be used for ISDN-PRI, CAS, or MFC/R2. We’ll discuss the
        different protocols in the next section.</p></div></div><div class="sect2" title="Installing PSTN Trunks"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id240851"></a>Installing PSTN Trunks</h3></div></div></div><p><a id="OutsideConnectivity_id240856"></a><a id="index-623C072CL3S" class="indexterm"></a><a id="index-523I560JK3O" class="indexterm"></a>Depending on the hardware you have installed, the process
      for installing your PSTN cards will vary. We will discuss installation
      in general terms, which will apply to all Digium PSTN cards.<a id="I_indexterm7_d1e14348" class="indexterm"></a> Other manufacturers tend to provide installation scripts
      with their hardware, which will automate much of this for you.</p><div class="sect3" title="Downloading and installing DAHDI"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id240859"></a>Downloading and installing DAHDI</h4></div></div></div><p><a id="OutsideConnectivity_id240865"></a><a id="I_indexterm7_d1e14358" class="indexterm"></a><a id="I_indexterm7_d1e14363" class="indexterm"></a><a id="I_indexterm7_d1e14368" class="indexterm"></a>The Digium Asterisk Hardware Device Interface, a.k.a.
        DAHDI (<span class="emphasis"><em>DAW-dee</em></span>)<sup>[<a id="id544254" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id544254" class="footnote">73</a>]</sup> is the software framework required to enable
        communication between PSTN cards and <span class="keep-together">Asterisk</span>. Even if you do not have any
        PSTN hardware, we recommend installing DAHDI since it is a simple,
        reliable way to get a valid timing source.<sup>[<a id="id544269" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id544269" class="footnote">74</a>]</sup> Complete DAHDI installation<a id="I_indexterm7_d1e14389" class="indexterm"></a> instructions can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>.</p><div class="sidebar" title="Disable Loading Extra DAHDI Modules"><a id="OutsideConnectivity_id240903"></a><div class="titlepage"><div><div><p class="title"><strong>Disable Loading Extra DAHDI Modules</strong></p></div></div></div><p><a id="OutsideConnectivity_id291003"></a><a id="I_indexterm7_d1e14401" class="indexterm"></a>By default <a id="I_indexterm7_d1e14407" class="indexterm"></a>DAHDI will load all compiled modules into memory. As
          this is unnecessary, let’s disable loading any of the hardware
          modules for now. If no modules are loaded in the configuration
          files, DAHDI will load the <code class="literal">dahdi_dummy</code> driver, which provides an
          interface for Asterisk to get timing from the kernel so that
          timing-dependent modules such as MeetMe and IAX2 trunking work
          correctly.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id291016"></a>As of DAHDI 2.3.0, the
            requirement to load <code class="literal">dahdi_dummy</code><a id="I_indexterm7_d1e14421" class="indexterm"></a> for a timing interface no longer exists. The same
            functionality has now been integrated into the main <code class="literal">dahdi</code> kernel module.</p></div><p><a id="OutsideConnectivity_id291021"></a>The configuration file
          defining which modules DAHDI will load is in <code class="filename">/etc/dahdi/modules</code>. To disable loading of
          extra modules, all we need to do is edit the <code class="filename">modules</code> file and comment out all the
          modules by placing a hash (<code class="literal">#</code>) at
          the start of each line. When you’re done, your <code class="filename">modules</code> configuration file should look
          similar to the following:</p><a id="OutsideConnectivity_id291028"></a><pre class="programlisting"># Contains the list of modules to be loaded / unloaded by /etc/init.d/dahdi. 
# 
# NOTE: Please add/edit /etc/modprobe.d/dahdi or /etc/modprobe.conf if you 
# would like to add any module parameters. 
# 
# Format of this file: list of modules, each in its own line. 
# Anything after a '#' is ignored, likewise trailing and leading 
# whitespace and empty lines. 
# Digium TE205P/TE207P/TE210P/TE212P: PCI dual-port T1/E1/J1 
# Digium TE405P/TE407P/TE410P/TE412P: PCI quad-port T1/E1/J1 
# Digium TE220: PCI-Express dual-port T1/E1/J1 
# Digium TE420: PCI-Express quad-port T1/E1/J1 
#wct4xxp 
# Digium TE120P: PCI single-port T1/E1/J1 
# Digium TE121: PCI-Express single-port T1/E1/J1 
# Digium TE122: PCI single-port T1/E1/J1 
#wcte12xp 
# Digium T100P: PCI single-port T1 
# Digium E100P: PCI single-port E1 
#wct1xxp 
# Digium TE110P: PCI single-port T1/E1/J1 
#wcte11xp 
# Digium TDM2400P/AEX2400: up to 24 analog ports 
# Digium TDM800P/AEX800: up to 8 analog ports 
# Digium TDM410P/AEX410: up to 4 analog ports 
#wctdm24xxp 
# X100P - Single port FXO interface 
# X101P - Single port FXO interface 
#wcfxo 
# Digium TDM400P: up to 4 analog ports 
#wctdm 
# Digium B410P: 4 NT/TE BRI ports 
#wcb4xxp 
# Digium TC400B: G729 / G723 Transcoding Engine 
#wctc4xxp 
# Xorcom Astribank Devices 
#xpp_usb</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="OutsideConnectivity_id322990"></a>You can also use <span class="command"><strong>dahdi_genconf modules</strong></span><a id="I_indexterm7_d1e14449" class="indexterm"></a> to generate a proper empty configuration file. The
            <span class="command"><strong>dahdi_genconf</strong></span> application
            <a id="I_indexterm7_d1e14456" class="indexterm"></a><a id="I_indexterm7_d1e14459" class="indexterm"></a>will search your system for hardware and, if none is
            found, create a <code class="filename">modules</code> file
            that does not load any hardware modules.</p></div><p><a id="OutsideConnectivity_id291042"></a>You can then restart your
          DAHDI process to unload any existing drivers that were loaded, and
          load just the <code class="literal">dahdi_dummy</code> module
          with the init script:</p><a id="OutsideConnectivity_id291047"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo /etc/init.d/dahdi restart</code></strong> 
Unloading DAHDI hardware modules: done 
Loading DAHDI hardware modules: 
No hardware timing source found in /proc/dahdi, loading dahdi_dummy 
Running dahdi_cfg: [ OK ]</pre><p><a id="OutsideConnectivity_id323031"></a>Before you can start using
          your hardware, though, you’ll need to configure the <code class="filename">/etc/dahdi/system.conf</code> file; this process
          is described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054" title="Configuring digital circuits">the section called “Configuring digital circuits”</a> and
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083" title="Configuring analog circuits">the section called “Configuring analog circuits”</a>.</p></div></div><div class="sect3" title="Configuring digital circuits"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id291054"></a>Configuring digital circuits</h4></div></div></div><p><a id="OutsideConnectivity_id291059"></a><a id="I_indexterm7_d1e14493" class="indexterm"></a><a id="I_indexterm7_d1e14498" class="indexterm"></a>Digital telephony was developed by carriers as a way to
        reduce the cost of long-distance circuits, as well as improve
        transmission quality. The entire PSTN backbone has been fully digital
        for many years now. The essence of a digital circuit is the
        digitization of the audio, but digital trunks also allow for more
        complex and reliable signaling. Several standards have been developed
        and deployed, and for each standard there may be regional differences
        as well.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="OutsideConnectivity_id323076"></a>You can use <span class="command"><strong>dahdi_hardware</strong></span><a id="I_indexterm7_d1e14507" class="indexterm"></a><a id="I_indexterm7_d1e14510" class="indexterm"></a> and <span class="command"><strong>lsdahdi</strong></span>
          to<a id="I_indexterm7_d1e14519" class="indexterm"></a><a id="I_indexterm7_d1e14522" class="indexterm"></a> help you determine what telephony hardware your
          system contains. You can also use <span class="command"><strong>dahdi_genconf modules</strong></span><a id="I_indexterm7_d1e14531" class="indexterm"></a><a id="I_indexterm7_d1e14534" class="indexterm"></a> to build an <code class="filename">/etc/asterisk/modules</code> file for you based
          on the found hardware.</p></div><div class="sect4" title="PRI ISDN"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id291062"></a>PRI ISDN</h5></div></div></div><p><a id="OutsideConnectivity_id291068"></a><a id="I_indexterm7_d1e14547" class="indexterm"></a>Primary Rate Interface ISDN (commonly known as PRI) is
          a protocol designed to run primarily on a DS1 circuit (a T1 or E1,
          depending on where you are in the world) between a carrier and a
          customer. PRI uses one of the DS0 channels as a signaling channel
          (referred to as the <span class="emphasis"><em>D-channel</em></span>). A typical PRI
          circuit is therefore broken down into a group of
          <span class="emphasis"><em>B-channels</em></span><a id="I_indexterm7_d1e14556" class="indexterm"></a> (the bearer channels that actually carry the calls),
          and a <span class="keep-together">D-channel</span> <a id="I_indexterm7_d1e14563" class="indexterm"></a>for signaling. Although it is most common to find a
          PRI circuit being carried across a single physical circuit (such as
          a T1 or E1), it is possible to have a PRI circuit span multiple
          DS1s, and even to have multiple D-channels.<sup>[<a id="id544829" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id544829" class="footnote">75</a>]</sup></p><p><a id="OutsideConnectivity_id36060545"></a>While there are many
          different ways to configure <a id="I_indexterm7_d1e14580" class="indexterm"></a>PRI circuits, we are hoping to avoid confusing you
          with all of the options (many of which are obsolete or at least no
          longer in common use), and instead provide examples of the more
          common configurations.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id323143"></a>When installing <a id="I_indexterm7_d1e14589" class="indexterm"></a><a id="I_indexterm7_d1e14594" class="indexterm"></a>telephony hardware, be sure you update the <code class="filename">/etc/dahdi/modules</code> file to enable the
            appropriate modules for your hardware and then reload DAHDI with
            the init script (<code class="filename">/etc/init.d/dahdi</code>). You can use the
            <span class="command"><strong>dahdi_genconf modules</strong></span> command
            <a id="I_indexterm7_d1e14607" class="indexterm"></a><a id="I_indexterm7_d1e14611" class="indexterm"></a>to generate the <code class="filename">modules</code> file for your system as
            well.</p></div><p><a id="OutsideConnectivity_id36060556"></a>Most PRI circuits in North
          America will use a T1 with the following characteristics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Line code: B8ZS (bipolar with 8-zeros substitution)</p></li><li class="listitem"><p>Framing: ESF (extended superframe)</p></li></ul></div><p><a id="OutsideConnectivity_id36060595"></a>You will need to configure
          two files. The <code class="filename">/etc/dahdi/system.conf</code> file should look
          something like this:</p><p><a id="OutsideConnectivity_id36060602"></a><a id="OutsideConnectivity_id36060603"></a></p><pre class="programlisting">loadzone = us
defaultzone = us

span = 1,1,0,esf,b8zs
bchan = 1-23
echocanceller = mg2,1-23
hardhdlc = 24
</pre><p><a id="OutsideConnectivity_id36060607"></a>And the <code class="filename">/etc/asterisk/chan_dahdi.conf</code> file should
          look like this:<a id="OutsideConnectivity_id36060613"></a></p><pre class="programlisting">[trunkgroups]

[channels]

usecallerid = yes
hidecallerid = no
callwaiting = yes
usecallingpres = yes
callwaitingcallerid = yes
threewaycalling = yes
transfer = yes
canpark = yes
cancallforward = yes
callreturn = yes
echocancel = yes
echocancelwhenbridged = yes
relaxdtmf = yes
rxgain = 0.0
txgain = 0.0
group = 1
callgroup = 1
pickupgroup = 1
immediate = no

switchtype = national ; commonly referred to as NI2
context = from-pstn
group = 0
echocancel = yes
signalling = pri_cpe
channel =&gt; 1-23
</pre><p>Some carriers will use Nortel’s DMS switch,<a id="I_indexterm7_d1e14645" class="indexterm"></a> which commonly uses the DMS100 protocol instead of
          National ISDN 2. In this case you would set the <code class="literal">switchtype</code><a id="I_indexterm7_d1e14651" class="indexterm"></a> to <code class="literal">DMS100</code>:</p><a id="OutsideConnectivity_id36060629"></a><pre class="programlisting">switchtype = dms100</pre><p><a id="OutsideConnectivity_id36060639"></a>Outside of Canada and the
          US, PRI circuits will be carried on an E1 circuit.</p><p><a id="OutsideConnectivity_id36060643"></a>In Europe, an E1 circuit
          used for PRI will normally have the following
          characteristics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Line code: CCS</p></li><li class="listitem"><p>Framing: HDB3 (high-density bipolar)</p></li></ul></div><p><a id="OutsideConnectivity_id36060681"></a>The <code class="filename">/etc/dahdi/system.conf</code> file might look
          something like this:</p><p><a id="OutsideConnectivity_id36060685"></a><a id="OutsideConnectivity_id36060686"></a></p><pre class="programlisting">span = 1,0,0,ccs,hdb3,crc4
bchan = 1-15,17-31
hardhdlc = 16</pre><p><a id="OutsideConnectivity_id36060690"></a>And the <code class="filename">/etc/asterisk/chan_dahdi.conf</code> file should
          look something like this:</p><a id="OutsideConnectivity_id36060695"></a><pre class="programlisting">[trunkgroups]

[channels]

usecallerid = yes
hidecallerid = no
callwaiting = yes
usecallingpres = yes
callwaitingcallerid = yes
threewaycalling = yes
transfer = yes
canpark = yes
cancallforward = yes
callreturn = yes
echocancel = yes
echocancelwhenbridged = yes
relaxdtmf = yes
rxgain = 0.0
txgain = 0.0
group = 1
callgroup = 1
pickupgroup = 1
immediate = no

switchtype = qsig
context = pri_incoming
group = 0
signalling = pri_cpe
channel =&gt; 1-15,17-31
</pre></div><div class="sect4" title="BRI ISDN"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id291072"></a>BRI ISDN</h5></div></div></div><p><a id="OutsideConnectivity_id291077"></a><a id="I_indexterm7_d1e14691" class="indexterm"></a>Basic Rate Interface ISDN (commonly known as BRI, or
          sometimes even just ISDN) was intended to be the smaller sibling to
          PRI. BRI only provides two 64K <span class="keep-together">B-channels</span> and a 16K D-channel. The
          use of BRI has been somewhat limited in North America (we don’t
          recommend using it for any reason), but in some countries in Europe
          it is widely used and has almost completely replaced analog.</p><p><a id="OutsideConnectivity_id36060725"></a>BRI support under Asterisk
          will be different depending on the BRI card you are installing. The
          manufacturer of your BRI card will provide specific installation
          instructions for its hardware.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id323432"></a>When installing telephony
            hardware, be sure you update the <code class="filename">/etc/dahdi/modules</code> file to enable the
            appropriate modules for your hardware and then reload DAHDI with
            the init script (<code class="filename">/etc/init.d/dahdi</code>). You can use the
            <span class="command"><strong>dahdi_genconf modules</strong></span> command
            <a id="I_indexterm7_d1e14714" class="indexterm"></a><a id="I_indexterm7_d1e14717" class="indexterm"></a>to generate the <code class="filename">modules</code> file for your system as
            well.</p></div></div><div class="sect4" title="MFC/R2"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id36060731"></a>MFC/R2</h5></div></div></div><p><a id="OutsideConnectivity_id36060736"></a><a id="I_indexterm7_d1e14730" class="indexterm"></a>The MFC/R2 protocol could be thought of as a precursor
          to ISDN. It was at first used on analog circuits, but it is now
          mostly deployed on the same E1 circuits that also carry ISDN-PRI.
          This protocol is not typically found in Canada, the US, or Western
          Europe, but it is very popular in some parts of the world
          (especially Latin America and Asia), mostly because it tends to be a
          less expensive service offering from the carriers.</p><p><a id="OutsideConnectivity_id36060744"></a>There are many different
          flavors of this protocol, each country having a different regional
          variant.</p><p><a id="OutsideConnectivity_id36060748"></a>The OpenR2 project
          <a id="I_indexterm7_d1e14738" class="indexterm"></a>provides the <code class="literal">libopenr2</code> library,<a id="I_indexterm7_d1e14745" class="indexterm"></a><a id="I_indexterm7_d1e14748" class="indexterm"></a> which needs to be installed on your system in order
          for Asterisk to support your R2 circuits. Before installing <code class="literal">libopenr2</code>, however, you need to have DAHDI
          installed.</p><p><a id="OutsideConnectivity_id36060756"></a>The compilation and
          installation order, therefore, is:</p><div class="orderedlist"><a id="OutsideConnectivity_id36060760"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="OutsideConnectivity_id36060762"></a><a id="OutsideConnectivity_id36060764"></a>DAHDI</p></li><li class="listitem"><p><a id="OutsideConnectivity_id36060768"></a><a id="OutsideConnectivity_id36060770"></a><code class="literal">libopenr2</code></p></li><li class="listitem"><p><a id="OutsideConnectivity_id36060775"></a><a id="OutsideConnectivity_id36060777"></a>Asterisk</p></li></ol></div><p><a id="OutsideConnectivity_id36060782"></a>Once OpenR2 has been
          installed, you can use the <span class="command"><strong>r2test</strong></span>
          application to see a list of variants that are supported:</p><a id="OutsideConnectivity_id36002186"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>r2test -l</code></strong>
Variant Code        Country                                 
AR                  Argentina                               
BR                  Brazil                                  
CN                  China                                   
CZ                  Czech Republic                          
CO                  Colombia                                
EC                  Ecuador                                 
ITU                 International Telecommunication Union   
MX                  Mexico                                  
PH                  Philippines                             
VE                  Venezuela</pre><p><a id="OutsideConnectivity_id36002200"></a>For additional information
          on configuring R2 support in Asterisk, see the <code class="filename">configs/chan_dahdi.conf.sample</code> file
          included in the Asterisk source tree (search for “mfcr2”).
          Additionally, OpenR2 contains some sample configuration files for
          connecting Asterisk to networks in various countries. To read
          information about some of the country variants, search the <code class="filename">/doc/asterisk</code> folder and refer to the
          documents inside the appropriate subdirectory:</p><a id="OutsideConnectivity_id36002210"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ls doc/asterisk/</code></strong>
ar  br  ec  mx  ve
</pre><p><a id="OutsideConnectivity_id36002218"></a>As an example, OpenR2
          provides a sample configuration for connecting to Telmex or Axtel in
          Mexico. We’ll step you through this to give you an idea of the
          process. First, you must configure DAHDI by modifying <code class="filename">/etc/dahdi/system.conf</code> as shown
          here:</p><a id="OutsideConnectivity_id36002226"></a><pre class="programlisting">loadzone = us
defaultzone = us

span = 1,1,0,cas,hdb3
cas = 1-15:1101
cas = 17-31:1101

span = 2,1,0,cas,hdb3
cas = 32-46:1101
cas = 48-62:1101
</pre><p><a id="OutsideConnectivity_id36002230"></a>Next, you must configure
          Asterisk by modifying <code class="filename">/etc/asterisk/chan_dahdi.conf</code> as <span class="keep-together">follows</span>:</p><a id="OutsideConnectivity_id36002237"></a><pre class="programlisting">signalling = mfcr2
mfcr2_variant = mx
mfcr2_get_ani_first = no
mfcr2_max_ani = 10
mfcr2_max_dnis = 4
mfcr2_category = national_subscriber
mfcr2_mfback_timeout = -1
mfcr2_metering_pulse_timeout = -1
; this is for debugging purposes
mfcr2_logdir = log
mfcr2_logging = all
; end debugging configuration
channel =&gt; 1-15
channel =&gt; 17-31
</pre></div></div><div class="sect3" title="Configuring analog circuits"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id291083"></a>Configuring analog circuits</h4></div></div></div><p><a id="OutsideConnectivity_id262203"></a><a id="I_indexterm7_d1e14819" class="indexterm"></a><a id="I_indexterm7_d1e14824" class="indexterm"></a>There are many companies producing PSTN cards for
        Asterisk. The card will need to have its drivers installed so that
        Linux can recognize it (DAHDI ships with these drivers for Digium
        cards). From that point, configuration is handled by the Asterisk
        module <code class="literal">chan_dahdi</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="OutsideConnectivity_id315785"></a>You can use <span class="command"><strong>dahdi_hardware</strong></span><a id="I_indexterm7_d1e14838" class="indexterm"></a><a id="I_indexterm7_d1e14841" class="indexterm"></a> and <span class="command"><strong>lsdahdi</strong></span><a id="I_indexterm7_d1e14849" class="indexterm"></a><a id="I_indexterm7_d1e14852" class="indexterm"></a> to determine what telephony hardware your system
          contains.</p></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id315799"></a>When installing telephony
          hardware, be sure you update the <code class="filename">/etc/dahdi/modules</code> file to enable the
          appropriate modules for your hardware and then reload DAHDI with the
          init script (<code class="filename">/etc/init.d/dahdi</code>). You can use the
          <span class="command"><strong>dahdi_genconf modules</strong></span><a id="I_indexterm7_d1e14869" class="indexterm"></a><a id="I_indexterm7_d1e14872" class="indexterm"></a> command to generate the <code class="filename">modules</code> file for your system as
          well.</p></div><p><a id="OutsideConnectivity_id262212"></a>In order to configure an FXO
        card to work with Asterisk, two files are required.</p><p><a id="OutsideConnectivity_id262217"></a>The first is not an Asterisk
        configuration file, and is thus located in the <code class="filename">/etc/dahdi</code> folder on your system.<sup>[<a id="id545862" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id545862" class="footnote">76</a>]</sup> This file, <code class="filename">system.conf</code><a id="I_indexterm7_d1e14894" class="indexterm"></a><a id="I_indexterm7_d1e14897" class="indexterm"></a> allows you to define some basic parameters, as well as
        specify the channels that will be available to your system. Our
        example assumes a four-port FXO card, but many different combinations
        are possible, depending on your hardware.</p><p><a id="OutsideConnectivity_id270743"></a><a id="OutsideConnectivity_id270744"></a></p><pre class="programlisting">loadzone = us       ; tonezone defines sounds the interface must produce
                    ; (dialtone, busy signal, ringback, etc.)
defaultzone = us    ; define a default tonezone
fxsks = 1-4         ; which channels on the card will have these parameters
</pre><p><a id="OutsideConnectivity_id270749"></a>Once your card and channels
        are known to the operating system, you must configure them for
        Asterisk by means of the file <code class="filename">/etc/asterisk/chan_dahdi.conf</code>:</p><p><a id="OutsideConnectivity_id270757"></a><a id="OutsideConnectivity_id270758"></a></p><pre class="programlisting">[channels]

;
; To apply other options to these channels, put them before "channel".
;
signalling = fxs_ks  ; in Asterisk, FXO channels use FXS signaling 
                     ; (and yes, FXS channels use FXO signaling)
channel =&gt; 1-4       ; apply all the previously defined settings to this channel
</pre><p><a id="OutsideConnectivity_id270764"></a>In this example, we have told
        Asterisk that the first four DAHDI channels in the system are FXO
        ports.</p><div class="sect4" title="The s extension"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id291091"></a>The s extension</h5></div></div></div><p><a id="OutsideConnectivity_id291100"></a><a id="I_indexterm7_d1e14920" class="indexterm"></a>If you are connecting to the PSTN using analog
          channels, we need to explain extension <code class="literal">s</code>. When calls enter a context without a
          specific destination extension (for example, a ringing FXO line from
          the PSTN), they are passed to the <code class="literal">s</code> extension. (The <code class="literal">s</code> stands for “start,” as this is where a
          call will start if no extension information was passed with the
          call). This extension can also be useful for accepting calls that
          have been redirected from other parts of the dialplan. For example,
          if we had a list of DID numbers that were all going to the same
          place, we might want to point each DID to the <code class="literal">s</code> extension, rather than having to code
          duplicate dialplan logic for each DID.</p><p><a id="OutsideConnectivity_id291130"></a>Since this is exactly what
          we need for our dialplan, let’s begin to fill in the pieces. We will
          be performing three actions on the call (answer it, play a sound
          file, and hang it up), so our <code class="literal">s</code>
          extension will need three priorities. We’ll place the three
          priorities <a id="I_indexterm7_d1e14941" class="indexterm"></a>below <code class="literal">[incoming]</code>,
          because we have decided that all incoming calls should start in this
          <span class="keep-together">context</span><sup>[<a id="asterisk-DP-Basics-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-DP-Basics-FN-6" class="footnote">77</a>]</sup>:</p><a id="I_programlisting5_tt744"></a><pre class="programlisting">[incoming]
exten =&gt; s,1,Answer()
   same =&gt; n,Playback(tt-weasels)
   same =&gt; n,Hangup()</pre><p><a id="OutsideConnectivity_id36059696"></a>Obviously, you would not
          normally want to answer a call and then hang up. Typically, an
          incoming call will either be answered by an automated attendant, or
          ring directly to a phone (or group of phones).<a id="I_indexterm7_d1e15012" class="indexterm"></a><a id="I_indexterm7_d1e15013" class="indexterm"></a><a id="I_indexterm7_d1e15014" class="indexterm"></a><a id="I_indexterm7_d1e15015" class="indexterm"></a></p></div></div></div></div><div class="sect1" title="VoIP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="OutsideConnectivity_id291235"></a>VoIP</h2></div></div></div><p><a id="OutsideConnectivity_id291240"></a><a id="index-333N881QR4R" class="indexterm"></a><a id="index-643L868QC4M" class="indexterm"></a>In the world of telecom, VoIP is still a relatively new
    concept. For the century or so prior to VoIP, the only way to connect your
    site to the PSTN was through the use of circuits provided for that purpose
    by your local telephone company. VoIP now allows for connections between
    endpoints without the PSTN having to be involved at all (although in most
    VoIP scenarios, there will still be a PSTN component at some point,
    especially if there is a traditional E.164 phone number involved).</p><div class="sect2" title="PSTN Termination"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id291246"></a>PSTN Termination</h3></div></div></div><p><a id="OutsideConnectivity_id291251"></a><a id="I_indexterm7_d1e15033" class="indexterm"></a><a id="I_indexterm7_d1e15040" class="indexterm"></a><a id="I_indexterm7_d1e15045" class="indexterm"></a>Until VoIP totally replaces the PSTN, there will be a need
      to connect calls from VoIP networks to the public telephone network.
      This process is referred to as <span class="emphasis"><em>termination</em></span>. What it
      means is that at some point a gateway connected to the PSTN needs to
      accept calls from the VoIP network and connect them to the PSTN network.
      From the perspective of the PSTN, the call will appear to have
      originated at the termination point.</p><p><a id="OutsideConnectivity_id36059742"></a>Asterisk can be used as a PSTN
      termination point. In fact, given that Asterisk handles protocol
      conversion with ease, this can be an excellent use for an Asterisk
      system.</p><p><a id="OutsideConnectivity_id36059747"></a>In order to provide
      termination, an Asterisk box will need to be able to handle all of the
      protocols you wish to connect to the PSTN. In general, this means that
      your Asterisk box will need a PRI circuit to handle the PSTN connection,
      and SIP channels to handle the calls coming from the VoIP network. The
      underlying principle is the same regardless of whether you’re running a
      small system providing PSTN trunks to an office full of VoIP telephones,
      or a complex network of gateway machines deployed in strategic
      locations, offering termination to thousands of subscribers.</p><p><a id="OutsideConnectivity_id36059756"></a>Calls from the VoIP network
      will arrive in the dialplan in whatever context you assigned to the
      incoming SIP channels, and the dialplan will relay the calls out through
      the PSTN interface. At its very simplest, a portion of a dialplan that
      supports termination could look like this:</p><p><a id="OutsideConnectivity_id36059761"></a><a id="OutsideConnectivity_id36059762"></a></p><pre class="programlisting">[from-voip-network]
exten =&gt; _X.,1,Verbose(2, Call from VoIP network to ${EXTEN})
   same =&gt; n,Dial(DAHDI/g0/${EXTEN})</pre><p>In reality, though,
      you will often have to handle a more complex routing plan that takes
      into consideration things like geography, corporate policy, cost,
      available resources, and so forth.</p><p><a id="OutsideConnectivity_id36059768"></a></p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="OutsideConnectivity_id36059771"></a><a id="I_indexterm7_d1e15067" class="indexterm"></a>Given that most PSTN circuits will allow you to dial
          any number, anywhere in the world, and given that you will be
          expected to pay for all incurred charges, we cannot stress enough
          the importance of security on any gateway machine that is providing
          PSTN termination. Criminals put a lot of effort into cracking phone
          systems (especially poorly secured Asterisk systems), and if you do
          not pay careful attention to all aspects of security, you will be
          the victim of toll fraud. It’s only a matter of time.</p><p><a id="OutsideConnectivity_id36059779"></a>Do not allow any unsecured
          VoIP connections into any context that contains PSTN
          termination.</p></div></div><div class="sect2" title="PSTN Origination"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id36059788"></a>PSTN Origination</h3></div></div></div><p><a id="OutsideConnectivity_id36059794"></a><a id="I_indexterm7_d1e15079" class="indexterm"></a><a id="I_indexterm7_d1e15086" class="indexterm"></a><a id="I_indexterm7_d1e15091" class="indexterm"></a>Obviously, if you want to pass calls from your VoIP
      network to the PSTN, you might also want to be able to accept calls from
      the PSTN into your VoIP network. The process of doing this is commonly
      referred to as <span class="emphasis"><em>origination</em></span>. This simply means that
      the call originated in the PSTN.</p><p><a id="OutsideConnectivity_id36059799"></a>In order to provide
      origination, a phone number is required. You will therefore need to
      obtain a circuit from your local phone company, which you will connect
      to your Asterisk system. Depending on where you are in the world, there
      are several different types of circuits that could provide this
      functionality, from a basic analog POTS line to a carrier-grade SS7
      circuit.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id36059816"></a>Phone numbers as used for
        the purpose of origination are commonly called direct inward dialing
        numbers (DIDs). <a id="I_indexterm7_d1e15105" class="indexterm"></a><a id="I_indexterm7_d1e15108" class="indexterm"></a>This is not strictly the case in all situations (for
        example, the phone number on a traditional analog line would not be
        considered a DID), but the term is useful enough that it has caught
        on. Historically, a DID referred to a phone number associated with a
        trunk connected to customer premise equipment (CPE).</p></div><p><a id="OutsideConnectivity_id36059824"></a>Since phone numbers are
      controlled by the traditional telecom industry, you will need to obtain
      the number either from a carrier directly, or from one of the many
      companies that purchase numbers in bulk and resell them in smaller
      blocks. If you obtain a circuit such as a PRI circuit, you will normally
      be able to order DID numbers to be delivered with that circuit.</p><p><a id="OutsideConnectivity_id36059830"></a>In order to accept a call from
      a circuit you are using for origination, you will normally need to
      handle the passing of the phone number that was called. This is because
      PSTN trunks can typically handle more than one phone number, and thus
      the carrier needs to identify which number was called so that your
      Asterisk system will know how to route the call. The number that was
      dialed is commonly referred to as the Dialed Number Identification
      Service (DNIS) number.<a id="I_indexterm7_d1e15116" class="indexterm"></a> The DNIS number and the DID do not have to
      match,<sup>[<a id="id546658" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id546658" class="footnote">78</a>]</sup> but typically they will. If you are ordering a circuit
      from the carrier, you will want to ask that they send the DNIS (if they
      don’t understand that, you may want to consider another carrier).</p><p><a id="OutsideConnectivity_id36059846"></a>In the dialplan, you associate
      the incoming circuit with a context that will know how to handle the
      incoming digits. As an example, it could look something like
      this:</p><p><a id="OutsideConnectivity_id36059851"></a><a id="OutsideConnectivity_id36059852"></a></p><pre class="programlisting">[from-pstn] 
; This is the context that would be listed in the config file
; for the circuit (i.e. chan_dahdi.conf)

exten =&gt; _X.,1,Verbose(2,Incoming call to ${EXTEN})
    same =&gt; n,Goto(number-mapping,${EXTEN},1)

[number-mapping] 
; This context is not strictly required, but will make it easier
; to keep track of your DIDs in a single location in your dialplan. 
; From here you can pass the call to another part of the dialplan
; where the actual dialplan work will take place.

exten =&gt; 4165551234,1,Dial(SIP/0000FFFF0001)
exten =&gt; 4165554321,1,Goto(autoattendant-context,start,1)
exten =&gt; 4165559876,1,VoiceMailMain() ; a handy back door for listening
                                      ; to voice messages

exten =&gt; i,1,Verbose(2,Incoming call to invalid number)
</pre><p>In the <code class="literal">number-mapping</code>
      context <a id="I_indexterm7_d1e15139" class="indexterm"></a><a id="I_indexterm7_d1e15142" class="indexterm"></a>you explicitly list all of the DIDs that you expect to
      handle, plus an invalid handler for any DIDs that are not listed (you
      could send invalid numbers to reception, or to an automated attendant,
      or to some context that plays an invalid prompt).</p></div><div class="sect2" title="VoIP to VoIP"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id291257"></a>VoIP to VoIP</h3></div></div></div><p><a id="OutsideConnectivity_id291262"></a><a id="I_indexterm7_d1e15152" class="indexterm"></a><a id="I_indexterm7_d1e15159" class="indexterm"></a>Eventually, the need for the PSTN will likely vanish, and
      most voice communications will take place over network
      connections.</p><p><a id="OutsideConnectivity_id36059876"></a>The original thinking behind
      the SIP protocol was that it was to be a peer-to-peer protocol.
      Technically, this is still the case. What has happened, however, is that
      things have gotten a bit more complicated. Issues such as security,
      privacy, corporate policies, integration, centralization, and so forth
      have made things a bit more involved than simply putting a URI into a
      SIP phone and having a SIP phone somewhere else ring in response.</p><p><a id="OutsideConnectivity_id36059883"></a>The SIP protocol <a id="I_indexterm7_d1e15169" class="indexterm"></a>has become bloated and complex. Implementing SIP-based
      systems and networks has arguably become even more complicated than
      implementing traditional phone PBXs and networks.<sup>[<a id="id546852" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id546852" class="footnote">79</a>]</sup></p><p><a id="OutsideConnectivity_id36059896"></a>We are not going to get into
      the complexities of designing and implementing VoIP networks in this
      book, but we will discuss some of the ways you can configure Asterisk to
      support VoIP connectivity to other VoIP systems.</p></div><div class="sect2" title="Configuring VoIP Trunks"><div class="titlepage"><div><div><h3 class="title"><a id="OutsideConnectivity_id291268"></a>Configuring VoIP Trunks</h3></div></div></div><p><a id="OutsideConnectivity_id291273"></a><a id="index-887S354AT3D" class="indexterm"></a><a id="index-758V204CT0J" class="indexterm"></a><a id="index-703G546FV1V" class="indexterm"></a>In Asterisk, there is no need to explicitly install your
      VoIP modules (unless for some reason you did not compile Asterisk with
      the required modules). There are several VoIP protocols that you can
      choose to use with Asterisk, but we will focus on the two most popular:
      SIP and IAX.</p><div class="sect3" title="Configuring SIP trunks between Asterisk systems"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id291281"></a>Configuring SIP trunks between Asterisk systems</h4></div></div></div><p><a id="OutsideConnectivity_id291286"></a><a id="I_indexterm7_d1e15206" class="indexterm"></a><a id="I_indexterm7_d1e15213" class="indexterm"></a>SIP is far and away the most popular of the VoIP
        protocols—so much so that many people would consider other VoIP
        protocols to be obsolete (they are not, but it cannot be denied that
        SIP has dominated VoIP for several years now).</p><p><a id="OutsideConnectivity_id36059936"></a>The SIP protocol is
        peer-to-peer and does not really have a formal trunk specification.
        This means that whether you are connecting a single phone to your
        server or connecting two servers together, the SIP connections will be
        similar.</p><div class="sect4" title="Connecting two Asterisk systems together with SIP"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id36059941"></a>Connecting two Asterisk systems together with SIP</h5></div></div></div><p><a id="OutsideConnectivity_id36059947"></a>The need to be able to
          connect two Asterisk systems together to allow calls to be sent
          between them is a fairly common requirement. Perhaps you have a
          company with two physical locations and want to have a PBX at each
          location, or maybe you’re the administrator of the company PBX and
          you like Asterisk so much that you would also like to install it at
          home. This section provides a quick guide on configuring two
          Asterisk servers to be able to pass calls to each other over SIP. In
          our example, we will creatively refer to the two servers as <code class="literal">serverA</code> and <code class="literal">serverB</code>.</p><p><a id="OutsideConnectivity_id36002768"></a>The first file that must
          be modified is <code class="filename">/etc/asterisk/sip.conf</code>. This is the main
          configuration file for setting up SIP accounts. First, this entry
          must be added to <code class="filename">sip.conf</code> on
          <code class="literal">serverA</code>. It defines a SIP peer
          for the other server:</p><a id="OutsideConnectivity_id36002790"></a><pre class="programlisting">[serverB]

;
; Specify the SIP account type as 'peer'.  This means that incoming
; calls will be matched on IP address and port number.  So, when Asterisk
; receives a call from 192.168.1.102 and the standard SIP port of 5060,
; it will match this entry in sip.conf.  It will then request authentication
; and expect the password to match the 'secret' specified here.
;
type = peer
;
; This is the IP address for the remote box (serverB). This option can also
; be provided a hostname.
;
host = 192.168.1.102
;
; When we send calls to this SIP peer and must provide authentication,
; we use 'serverA' as our username.
;
username = serverA
;
; This is the shared secret with serverB.  It will be used as the password
; when either receiving a call from serverB, or sending a call to serverB.
;
secret = apples
;
; When receiving a call from serverB, match it against extensions
; in the 'incoming' context of extensions.conf.
;
context = incoming
;
; Start by clearing out the list of allowed codecs.
;
disallow = all
;
; Only allow the ulaw codec.
;
allow = ulaw
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="OutsideConnectivity_id36002782"></a>Be sure to change the
            <code class="literal">host</code> option <a id="I_indexterm7_d1e15251" class="indexterm"></a>to match the appropriate IP address for your own
            setup.</p></div><p><a id="OutsideConnectivity_id36002793"></a>Now put the following
          entry in <code class="filename">/etc/asterisk/sip.conf</code>
          on <code class="literal">serverB</code>. It is nearly
          identical to the contents of the entry we put on <code class="literal">serverA</code>, but the name of the peer and the
          IP address were changed:</p><a id="OutsideConnectivity_id36002807"></a><pre class="programlisting">[serverA]

type = peer
host = 192.168.1.101
username = serverB
secret = apples
context = incoming
disallow = all
allow = ulaw
</pre><p><a id="OutsideConnectivity_id36002811"></a>At this point you should
          be able to verify that the configuration has been successfully
          loaded into Asterisk using some CLI commands. The first command to
          try is <span class="command"><strong>sip show peers</strong></span><a id="I_indexterm7_d1e15272" class="indexterm"></a><a id="I_indexterm7_d1e15275" class="indexterm"></a>. As the name implies, it will show all SIP peers that
          have been configured:</p><a id="OutsideConnectivity_id36002826"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip show peers</code></strong>
Name/username       Host             Dyn Forcerport ACL Port     Status     
serverB/serverA     192.168.1.101                       5060     Unmonitored 
1 sip peers [Monitored: 0 online, 0 offline Unmonitored: 1 online, 0 offline]</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>You can also try <span class="command"><strong>sip show peer
            serverB</strong></span>. That command will show much more detail.</p></div><p><a id="OutsideConnectivity_id36002837"></a>The last step in setting
          up SIP calls between two Asterisk servers is to modify the dialplan
          in <code class="filename">/etc/asterisk/extensions.conf</code>. For
          example, if you wanted any calls made on <code class="literal">serverA</code> to extensions 6000 through 6999 to
          be sent over to <code class="literal">serverB</code>, you
          would use this line in the dialplan:</p><a id="OutsideConnectivity_id36002853"></a><pre class="programlisting">exten =&gt; _6XXX,1,Dial(SIP/${EXTEN}@serverB)</pre></div><div class="sect4" title="Connecting an Asterisk system to a SIP provider"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id36059950"></a>Connecting an Asterisk system to a SIP provider</h5></div></div></div><p><a id="OutsideConnectivity_id36059956"></a><a id="I_indexterm7_d1e15312" class="indexterm"></a>When you sign up for a SIP provider, you may have
          service for sending and/or receiving phone calls. The configuration
          will differ slightly depending on your usage of the SIP provider.
          Further, the configuration will differ between each provider.
          Ideally, the SIP provider that you sign up with will provide
          Asterisk configuration examples to help get you connected as quickly
          as possible. In case they do not, though, we will attempt to give
          you a common setup that will help you get started.</p><p><a id="OutsideConnectivity_id36002875"></a>If you will be receiving
          calls from your service provider, the service provider will most
          likely require your server to register with one of its servers. To
          do so, you must add a registration line to the <code class="literal">[general]</code> section of <code class="filename">/etc/asterisk/sip.conf</code>:</p><a id="OutsideConnectivity_id36002886"></a><pre class="programlisting">[general]
...
register =&gt; <em class="replaceable"><code>username</code></em>:<em class="replaceable"><code>password</code></em>@<em class="replaceable"><code>your.provider.tld</code></em>
...</pre><p><a id="OutsideConnectivity_id36002900"></a>Next, you will need to
          create a peer entry in <code class="filename">sip.conf</code>
          for your service provider. Here is a sample peer entry:</p><a id="OutsideConnectivity_id36002907"></a><pre class="programlisting">[<em class="replaceable"><code>myprovider</code></em>]

type = peer
host = <em class="replaceable"><code>your.provider.tld</code></em>
username = <em class="replaceable"><code>username</code></em>
secret = <em class="replaceable"><code>password</code></em>
; Most providers won't authenticate when they send calls to you,
; so you need this line to just accept their calls.
insecure = invite
dtmfmode = rfc2833
disallow = all
allow = ulaw</pre><p><a id="OutsideConnectivity_id36002925"></a>Now that the account has
          been defined, you must add some extensions in the dialplan to allow
          you to send calls to your service provider:</p><a id="OutsideConnectivity_id36002930"></a><pre class="programlisting">exten =&gt; _1NXXNXXXXXX,1,Dial(SIP/${EXTEN}@<em class="replaceable"><code>myprovider</code></em>)</pre></div><div class="sect4" title="Encrypting SIP calls"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id36002938"></a>Encrypting SIP calls</h5></div></div></div><p><a id="OutsideConnectivity_id36002943"></a><a id="I_indexterm7_d1e15367" class="indexterm"></a><a id="I_indexterm7_d1e15372" class="indexterm"></a>Asterisk supports TLS for encryption of the SIP
          signaling and SRTP for encryption <a id="I_indexterm7_d1e15378" class="indexterm"></a>of the media streams of a phone call. In this section
          we will set up calls using SIP TLS and SRTP between two Asterisk
          severs. The first step is to ensure the proper dependencies have
          been installed. Ensure that you have both OpenSSL <a id="I_indexterm7_d1e15384" class="indexterm"></a>and LibSRTP <a id="I_indexterm7_d1e15388" class="indexterm"></a>installed. If either one of these was not installed,
          reinstall Asterisk after installing these dependencies to ensure
          that support for TLS and SRTP are included. Once complete, make sure
          that the <code class="literal">res_srtp</code> module was
          compiled and installed. To install OpenSSL, the package is <code class="literal">openssl-devel</code> on CentOS and <code class="literal">libssl-dev</code> on Ubuntu. To install LibSRTP,
          the package is <code class="literal">libsrtp-devel</code> on
          CentOS and <code class="literal">libsrtp0-dev</code> on
          Ubuntu.</p><p><a id="OutsideConnectivity_id36002969"></a>Next we will configure SIP
          TLS. You must enable TLS using the global <code class="literal">tlsenable</code> option in the <code class="literal">[general]</code> section of <code class="filename">/etc/asterisk/sip.conf</code> on both servers.
          You can optionally specify an address to bind to if you would like
          to limit listening for TLS connections to a single IP address on the
          system. In this example, we have the IPv6 wildcard address specified
          to allow TLS connections on all IPv4 and IPv6 addresses on the
          system:</p><a id="OutsideConnectivity_id36002985"></a><pre class="programlisting">[general]

tlsenable = yes
tlsbindaddr = ::
</pre><p><a id="OutsideConnectivity_id36002988"></a>The next step is to get
          certificates <a id="I_indexterm7_d1e15423" class="indexterm"></a>in place. For the purposes of demonstrating the
          configuration and functionality, we are going to generate
          self-signed certificates using a helper script distributed with
          Asterisk. If you were setting this up in a production environment,
          you might not want to use self-signed certificates. However, if you
          do, there are a number of applications out there that help make it
          easier to manage your own <a id="I_indexterm7_d1e15427" class="indexterm"></a><a id="I_indexterm7_d1e15430" class="indexterm"></a>certificate authority (CA), such as TinyCA.</p><p><a id="OutsideConnectivity_id36002996"></a>The script that we are
          going to use is <span class="command"><strong>ast_tls_cert</strong></span><a id="I_indexterm7_d1e15438" class="indexterm"></a><a id="I_indexterm7_d1e15441" class="indexterm"></a>, which is in the <code class="filename">contrib/scripts/</code> directory of the
          Asterisk source tree. We need to generate a CA certificate and two
          server certificates. The first invocation of <span class="command"><strong>ast_tls_cert</strong></span> will generate the CA cert and
          the server cert for <code class="literal">serverA</code>. The
          second invocation of <span class="command"><strong>ast_tls_cert</strong></span>
          will generate the server cert for <code class="literal">serverB</code>:</p><a id="OutsideConnectivity_id36003021"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd contrib/scripts</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>mkdir certs</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./ast_tls_cert -d certs -C <em class="replaceable"><code>serverA</code></em> -o <em class="replaceable"><code>serverA</code></em></code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./ast_tls_cert -d certs -C <em class="replaceable"><code>serverB</code></em> -o <em class="replaceable"><code>serverB</code></em> -c certs/ca.crt -k certs/ca.key</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>ls certs</code></strong>
ca.cfg  ca.crt  ca.key  serverA.crt  serverA.csr  serverA.key  serverA.pem
serverB.crt  serverB.csr  serverB.key  serverB.pem  tmp.cfg
</pre><p><a id="OutsideConnectivity_id36003068"></a>Now that the certificates
          have been created, they need to be moved to the appropriate
          locations on <code class="literal">serverA</code> and <code class="literal">serverB</code>. We will use the <code class="filename">/var/lib/asterisk/keys/</code> directory to hold
          the certificates. Move the following files to <code class="literal">serverA</code>:</p><div class="itemizedlist"><a id="OutsideConnectivity_id36003086"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id36003088"></a><a id="OutsideConnectivity_id36003090"></a><code class="filename">ca.crt</code></p></li><li class="listitem"><p><a id="OutsideConnectivity_id36003096"></a><a id="OutsideConnectivity_id36003098"></a><code class="filename">serverA.pem</code></p></li></ul></div><p><a id="OutsideConnectivity_id36003104"></a>And move these files to
          <code class="literal">serverB</code>:</p><div class="itemizedlist"><a id="OutsideConnectivity_id36003111"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="OutsideConnectivity_id36003113"></a><a id="OutsideConnectivity_id36003115"></a><code class="filename">ca.crt</code></p></li><li class="listitem"><p><a id="OutsideConnectivity_id36003120"></a><a id="OutsideConnectivity_id36003122"></a><code class="filename">serverB.pem</code></p></li></ul></div><p><a id="OutsideConnectivity_id36003129"></a>With the certificates in
          place, we can complete the Asterisk configuration. We need to point
          Asterisk to the server certificate that we just created. Since we’re
          using self-signed certificates, we also need to point to the CA
          certificate. In the <code class="literal">[general]</code>
          section of <code class="filename">/etc/asterisk/sip.conf</code> on <code class="literal">serverA</code>, add these options:</p><a id="OutsideConnectivity_id36003144"></a><pre class="programlisting">[general]

tlscertfile = /var/lib/asterisk/keys/serverA.pem
tlscafile = /var/lib/asterisk/keys/ca.crt</pre><p><a id="OutsideConnectivity_id36003148"></a>Make the same changes to
          <code class="filename">sip.conf</code> on <code class="literal">serverB</code>:</p><a id="OutsideConnectivity_id36003158"></a><pre class="programlisting">[general]

tlscertfile = /var/lib/asterisk/keys/serverB.pem
tlscafile = /var/lib/asterisk/keys/ca.crt</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="OutsideConnectivity_id36003164"></a>When you create the
            server certificates,<a id="I_indexterm7_d1e15570" class="indexterm"></a> the Common Name field must match the hostname of
            the server. If you use the <span class="command"><strong>ast_tls_cert</strong></span> script, this is the value
            given to the <code class="filename">-C</code> option. If
            there is a problem verifying the server certificate when you make
            a call, you may need to fix the Common Name field. Alternatively,
            for the sake of testing you can set the <code class="literal">tlsdontverifyserver</code> option to <code class="literal">yes</code> in the <code class="literal">[general]</code> section of <code class="filename">/etc/asterisk/sip.conf</code>, and Asterisk
            will allow the call to proceed even if it fails verification of
            the server certificate.</p></div><p><a id="OutsideConnectivity_id36003192"></a>In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059941" title="Connecting two Asterisk systems together with SIP">the section called “Connecting two Asterisk systems together with SIP”</a>, we created the
          configuration necessary to pass calls between <code class="literal">serverA</code> and <code class="literal">serverB</code>. We are now going to modify that
          configuration so that Asterisk knows that the calls between the two
          servers should be encrypted. The only change required is to add the
          <code class="literal">transport = tls</code> option to the
          peer entry for the other server.</p><p><a id="OutsideConnectivity_id36003212"></a>On <code class="literal">serverA</code>:</p><a id="OutsideConnectivity_id36003219"></a><pre class="programlisting">[serverB]

type = peer
host = 192.168.1.102
username = serverA
secret = apples
context = incoming                                                           
disallow = all                    
allow = ulaw
transport = tls                   
</pre><p><a id="OutsideConnectivity_id36003224"></a>On <code class="literal">serverB</code>:</p><a id="OutsideConnectivity_id36003230"></a><pre class="programlisting">[serverA]

type = peer
host = 192.168.1.101
username = serverB
secret = apples
context = incoming                                                           
disallow = all                    
allow = ulaw
transport = tls   </pre><p><a id="OutsideConnectivity_id36003235"></a>Now when you make a call
          using <code class="literal">Dial(SIP/serverA)</code> or
          <code class="literal">Dial(SIP/serverB)</code>, the SIP
          signaling will be encrypted. You can modify the dialplan to force
          outgoing calls to have encrypted signaling by setting the <code class="literal">CHANNEL(secure_bridge_signaling)</code> function
          to <code class="literal">1</code>:</p><a id="OutsideConnectivity_id36003253"></a><pre class="programlisting">[default]

exten =&gt; 1234,1,Set(CHANNEL(secure_bridge_signaling)=1)
    same =&gt; n,Dial(SIP/1234@serverB)
</pre><p><a id="OutsideConnectivity_id36003258"></a>On the side receiving the
          call, you can check whether the signaling on an incoming call is
          encrypted using the <code class="literal">CHANNEL(secure_signaling)</code> dialplan
          function. Consider the following example dialplan:</p><a id="OutsideConnectivity_id36003266"></a><pre class="programlisting">[incoming]

exten =&gt; _X.,1,Answer()
    same =&gt; n,GotoIf($["${CHANNEL(secure_signaling)}" = "1"]?secure:insecure)
    same =&gt; n(secure),NoOp(Signaling is encrypted.)
    same =&gt; n,Hangup()
    same =&gt; n(insecure),NoOp(Signaling is not encrypted.)
    same =&gt; n,Hangup()
</pre><p><a id="OutsideConnectivity_id36003274"></a>When a call is sent from
          <code class="literal">serverA</code> to <code class="literal">serverB</code> using this configuration, you can
          see from the output on the Asterisk console that the dialplan
          determines that the signaling of the incoming call is
          encrypted:</p><a id="OutsideConnectivity_id36003285"></a><pre class="screen">    -- Executing [1234@incoming:1] Answer("SIP/serverA-00000000", "") in new stack
    -- Executing [1234@incoming:2] GotoIf("SIP/serverA-00000000", 
       "1?secure:insecure") in new stack
    -- Goto (incoming,1234,3)
    -- Executing [1234@incoming:3] NoOp("SIP/serverA-00000000", 
       "Signaling is encrypted.") in new stack
    -- Executing [1234@incoming:4] Hangup("SIP/serverA-00000000", "") in new stack
</pre><p><a id="OutsideConnectivity_id36003292"></a>Now that SIP TLS has been
          set up for calls between <code class="literal">serverA</code>
          and <code class="literal">serverB</code>, we will set up SRTP
          so that the media streams associated with the call are encrypted as
          well. Luckily, it is quite easy to configure, compared to what was
          required to get SIP TLS working. First, make sure that you have the
          <code class="literal">res_srtp</code> module loaded in
          Asterisk:</p><a id="OutsideConnectivity_id36003307"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module show like res_srtp.so</code></strong> 
Module                         Description                              Use Count 
res_srtp.so                    Secure RTP (SRTP)                        0         
1 modules loaded
</pre><p><a id="OutsideConnectivity_id36003317"></a>To enable SRTP, set the
          <code class="literal">CHANNEL(secure_bridge_media)</code>
          function to <code class="literal">1</code>:</p><a id="OutsideConnectivity_id36003329"></a><pre class="programlisting">[default]

exten =&gt; 1234,1,Set(CHANNEL(secure_bridge_signaling)=1)
    same =&gt; n,Set(CHANNEL(secure_bridge_media)=1)
    same =&gt; n,Dial(SIP/1234@serverB)
</pre><p>This indicates that encrypted media is required for an
          outbound call. When the call is sent out via SIP, Asterisk will
          require that SRTP be used, or the call will fail.</p><p><a id="OutsideConnectivity_id36003332"></a>With all of these tools in
          place, you can ensure that calls between two Asterisk servers are
          fully encrypted. The same techniques should be applied for
          encrypting calls between Asterisk and a SIP phone.</p><p>The dialplan functions provide a mechanism for verifying
          <a id="I_indexterm7_d1e15689" class="indexterm"></a>the encryption status of an incoming call and forcing
          encryption on an outgoing call. However, keep in mind that these
          tools only provide the means for controlling encryption for one hop
          of the call path. If the call goes through multiple servers, these
          tools do not guarantee that the call is encrypted through the entire
          call path. It is important to carefully consider what your
          requirements are for secure calls and take all of the necessary
          steps to ensure that those requirements are respected throughout the
          entire call path. Security is complicated, hard work.</p></div></div><div class="sect3" title="Configuring IAX trunks between Asterisk systems"><div class="titlepage"><div><div><h4 class="title"><a id="OutsideConnectivity_id291291"></a>Configuring IAX trunks between Asterisk systems</h4></div></div></div><p><a id="OutsideConnectivity_id291296"></a><a id="I_indexterm7_d1e15699" class="indexterm"></a><a id="I_indexterm7_d1e15704" class="indexterm"></a>The Inter-Asterisk eXchange protocol, version 2 (most
        commonly known as IAX<sup>[<a id="id548420" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id548420" class="footnote">80</a>]</sup>) is Asterisk’s own VoIP protocol. It is different from
        SIP in that the signaling and media are carried in the same
        connection. This difference is one of the advantages of the IAX
        protocol, as it makes getting IAX to work across NAT connections much
        simpler.</p><div class="sect4" title="IAX trunking"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id291299"></a>IAX trunking</h5></div></div></div><p><a id="OutsideConnectivity_id291305"></a><a id="I_indexterm7_d1e15718" class="indexterm"></a>One of the more unique features of the IAX protocol is
          IAX trunking. Trunking an IAX connection could be useful on any
          network link that will often be carrying multiple simultaneous VoIP
          calls between two systems. By encapsulating multiple audio streams
          in one packet, IAX trunking cuts down on the overhead on the data
          connection, which can save bandwidth on a heavily used network
          link.</p></div><div class="sect4" title="IAX encryption"><div class="titlepage"><div><div><h5 class="title"><a id="OutsideConnectivity_id36059999"></a>IAX encryption</h5></div></div></div><p><a id="OutsideConnectivity_id36060004"></a><a id="I_indexterm7_d1e15728" class="indexterm"></a><a id="I_indexterm7_d1e15733" class="indexterm"></a>The principal advantage of IAX encryption is that it
          requires one simple change to the<code class="filename">
          /etc/asterisk/iax.conf</code> file:</p><p><a id="OutsideConnectivity_id36060012"></a><a id="OutsideConnectivity_id36060013"></a></p><pre class="programlisting">[general]
encryption = yes
</pre><p>For extra protection, you can set the following option to
          ensure that no IAX connection can happen without encryption:</p><p><a id="OutsideConnectivity_id36060018"></a><a id="OutsideConnectivity_id36060019"></a></p><pre class="programlisting">forceencryption = yes</pre><p><a id="OutsideConnectivity_id36060023"></a>Both of these options can
          be specified in the <code class="literal">[general]</code>
          section, as well as in <code class="literal">peer</code>/<code class="literal">user</code>/<code class="literal">friend</code> sections in <code class="filename">iax.conf</code>.<a id="I_indexterm7_d1e15767" class="indexterm"></a><a id="I_indexterm7_d1e15768" class="indexterm"></a><a id="I_indexterm7_d1e15769" class="indexterm"></a><a id="I_indexterm7_d1e15770" class="indexterm"></a><a id="I_indexterm7_d1e15771" class="indexterm"></a></p></div></div></div></div><div class="sect1" title="Emergency Dialing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="OutsideConnectivity_id291313"></a>Emergency Dialing</h2></div></div></div><p><a id="OutsideConnectivity_id291319"></a><a id="I_indexterm7_d1e15776" class="indexterm"></a><a id="I_indexterm7_d1e15781" class="indexterm"></a>In North America, people are used to being able to dial 911
    in order to reach emergency services. Outside of North America, well-known
    emergency numbers are 112 and <span class="keep-together">999.
    If</span> you make your Asterisk system available to people, you are
    obligated (in many cases regulated) to ensure that calls can be made to
    emergency services from any telephone connected to the system (even those
    phones that otherwise are restricted from making calls).</p><p><a id="OutsideConnectivity_id376874"></a>One of the essential pieces of
    information the emergency response organization needs to know is where the
    emergency is (i.e., where to send the fire trucks). In a traditional PSTN
    trunk <a id="I_indexterm7_d1e15790" class="indexterm"></a>this information is already known by the carrier and is
    subsequently passed along to the Public Safety Answering Point (PSAP).
    With VoIP <a id="I_indexterm7_d1e15796" class="indexterm"></a>circuits things can get a bit more complicated, by virtue of
    the fact that VoIP circuits are not physically tied to any geographical
    location.</p><p><a id="OutsideConnectivity_id376882"></a>You need to ensure that your
    system will properly handle 911 calls from any phone connected to it, and
    you need to communicate what is available to your users. As an example, if
    you allow users to register to the system from softphones on their
    laptops, what happens if they are in a hotel room in another country, and
    they dial 911?<sup>[<a id="id548771" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id548771" class="footnote">81</a>]</sup></p><p><a id="OutsideConnectivity_id376895"></a>The dialplan for handling
    emergency calls does not need to be complicated. In fact, it’s far better
    to keep it simple. People are often tempted to implement all sorts of
    fancy functionality in the emergency services portions of their dialplans,
    but if a bug in one of your fancy features causes an emergency call to
    fail, lives could be at risk. This is no place for playing around. The
    <code class="literal">[emergency-services]</code> section of your
    dialplan might look something like this:</p><p><a id="OutsideConnectivity_id376902"></a><a id="OutsideConnectivity_id376903"></a></p><pre class="programlisting">[emergency-services]
exten =&gt; 911,1,Goto(dialpsap,1)
exten =&gt; 9911,1,Goto(dialpsap,1) ; some people will dial '9' because 
                                 ; they're used to doing that from the PBX
exten =&gt; 999,1,Goto(dialpsap,1)
exten =&gt; 112,1,Goto(dialpsap,1)

exten =&gt; dialpsap,1,Verbose(1,Call initiated to PSAP!)
    same =&gt; n,Dial(${LOCAL}/911) ; REPLACE 911 HERE WITH WHATEVER 
                                 ; IS APPROPRIATE TO YOUR AREA

[internal]
include =&gt; emergency-services   ; you have to have this in any context 
                                ; that has users in it
</pre><p>In contexts where you know the users are not on-site (for
    example, remote users with their laptops), something like this might be
    best instead:</p><p><a id="OutsideConnectivity_id398527"></a><a id="OutsideConnectivity_id398528"></a></p><pre class="programlisting">[no-emergency-services]
exten =&gt; 911,1,Goto(nopsap,1)
exten =&gt; 9911,1,Goto(nopsap,1) ; for people who dial '9' before external calls
exten =&gt; 999,1,Goto(nopsap,1)
exten =&gt; 112,1,Goto(nopsap,1)

exten =&gt; nopsap,1,Verbose(1,Call initiated to PSAP!) 
    same =&gt; n,Playback(no-emerg-service) ; you'll need to record this prompt

[remote-users]
include =&gt; no-emergency-services</pre><p>In North America,
    regulations have obligated many VoIP carriers to offer what is popularly
    known as <code class="filename">E911</code>.<sup>[<a id="id548855" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id548855" class="footnote">82</a>]</sup> When you sign up for their services, they will require
    address information for each DID that you wish to associate with outgoing
    calls. This address information will then be sent to the PSAP appropriate
    to that address, and your emergency calls should be handled the same as
    they would be if they were dialed on a traditional PSTN circuit.</p><p><a id="OutsideConnectivity_id398554"></a>Handling emergency calls does not
    have to be complicated (in fact, it is best to keep this as simple as
    possible). The bottom line is that you need to make sure that the phone
    system you create allows emergency calls.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="OutsideConnectivity_id291322"></a>Conclusion</h2></div></div></div><p><a id="OutsideConnectivity_id291327"></a>Eventually, we believe that the
    PSTN will disappear entirely. Before that happens, however, a distributed
    mechanism that is widely used and trusted will be needed to allow
    organizations and individuals to publish addressing information so that
    they can be found. We’ll explore some of the ways this is already possible
    in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR" title="Chapter 12. Internet Call Routing">Chapter&nbsp;12, <em>Internet Call Routing</em></a>.<a id="I_indexterm7_d1e15836" class="indexterm"></a><a id="I_indexterm7_d1e15837" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id542986" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id542986" class="para">68</a>] </sup>But do not collect $200.</p></div><div class="footnote"><p><sup>[<a id="ftn.id543047" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id543047" class="para">69</a>] </sup>In a key system, each line has a corresponding button on each
        telephone, and lines are accessed by pressing the desired line
        key.</p></div><div class="footnote"><p><sup>[<a id="ftn.id543157" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id543157" class="para">70</a>] </sup>You can name these anything you wish. The words “local” and
        “toll” do not have any built-in meaning to the Asterisk
        dialplan.</p></div><div class="footnote"><p><sup>[<a id="ftn.id543219" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id543219" class="para">71</a>] </sup>For more information on pattern matches, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics" title="Chapter 6. Dialplan Basics">Chapter&nbsp;6, <em>Dialplan Basics</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id543586" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id543586" class="para">72</a>] </sup>You would use the exact same card if you wanted to connect a
            traditional home telephone line to your Asterisk system.</p></div><div class="footnote"><p><sup>[<a id="ftn.id544254" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id544254" class="para">73</a>] </sup>Don’t ask.</p></div><div class="footnote"><p><sup>[<a id="ftn.id544269" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id544269" class="para">74</a>] </sup>There are other ways of getting a timing source, and if you
            want a really tight system it is possible to run Asterisk without
            DAHDI, but it’s not something we’re going to cover here.</p></div><div class="footnote"><p><sup>[<a id="ftn.id544829" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id544829" class="para">75</a>] </sup>Sometimes circuits are referenced by the number of B- and
              D-channels they contain, so a single T1 <a id="I_indexterm7_d1e14571" class="indexterm"></a>running the PRI protocol in North America might be
              referred to as 23B+D, and a dual T1 circuit with a backup
              <span class="keep-together">D-channel</span> would be a
              46B+2D. We’ve even seen PRI referenced as nB+nD, although this
              can get a little bit pedantic.</p></div><div class="footnote"><p><sup>[<a id="ftn.id545862" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id545862" class="para">76</a>] </sup>In theory, these cards could be used for any software that
            supports DAHDI; therefore, the basic card configuration is not a
            part of Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-DP-Basics-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-FN-6" class="para">77</a>] </sup>There is nothing special about any <a id="I_indexterm7_d1e14955" class="indexterm"></a><a id="I_indexterm7_d1e14960" class="indexterm"></a>context name. We could have named this context
              [<code class="literal">stuff_that_comes_in</code>], and as
              long as that was the context assigned in the channel <a id="I_indexterm7_d1e14969" class="indexterm"></a>definition in <span class="emphasis"><em>sip.conf</em></span>,
              <span class="emphasis"><em>iax.conf</em></span>,
              <span class="emphasis"><em>chan_dahdi.conf</em></span>, et al., the channel would
              enter the dialplan in that context. Having said that, it is
              strongly recommended that you give your contexts names that help
              you to understand their purpose. Some good context names might
              include [<code class="literal">incoming</code>], [<code class="literal">local_calls</code>], [<code class="literal">long_distance</code>], [<code class="literal">sip_telephones</code>], [<code class="literal">user_services</code>], [<code class="literal">experimental</code>], [<code class="literal">remote_locations</code>], and so forth.
              Always remember that a context determines how a channel enters
              the dialplan, so name accordingly.</p></div><div class="footnote"><p><sup>[<a id="ftn.id546658" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id546658" class="para">78</a>] </sup>In traditional PBXs, the purpose of DIDs was to allow
          connection directly to an extension in the office. Many PBXs could
          not support concepts such as number translation or flexible digit
          lengths, and thus the carrier had to pass the extension number as
          the DID digits, rather than the number that was dialed (the DNIS
          number). For example, the phone number 416-555-1234 might have been
          mapped to extension 100, and thus the carrier would have sent the
          digits <code class="literal">100</code> to the PBX instead of
          the DNIS of <code class="literal">4165551234</code>. If you
          ever replace an old PBX with an Asterisk system, you may find this
          translation in place, and you’ll need to obtain a list of mappings
          between the numbers that the caller dials and the numbers that are
          sent to the PBX. It is also common to see the carrier only pass the
          last four digits of the DNIS number, which the PBX then translates
          into an internal number.</p></div><div class="footnote"><p><sup>[<a id="ftn.id546852" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id546852" class="para">79</a>] </sup>There are many proprietary PBX systems in the market that have
          a basic configuration that will work right out of the box. Asterisk
          deployments are far more flexible, but seldom as simple.</p></div><div class="footnote"><p><sup>[<a id="ftn.id548420" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id548420" class="para">80</a>] </sup>Pronounced “eeks.”</p></div><div class="footnote"><p><sup>[<a id="ftn.id548771" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id548771" class="para">81</a>] </sup>Don’t assume this can’t happen. When somebody calls 911 it’s
        because they have an emergency, and it’s not safe to assume that
        they’re going to be in a rational state of mind.</p></div><div class="footnote"><p><sup>[<a id="ftn.id548855" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id548855" class="para">82</a>] </sup>It’s not actually the carrier that’s offering this; rather it’s
        a capability of the PSAP. E911 is also used on PSTN trunks, but since
        that happens without any involvement on your part (the PSTN carriers
        handle the paperwork for you), you are generally not aware that you
        have E911 on your local lines.</p></div></div></div><div class="chapter" title="Chapter 8. Voicemail"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Voicemail"></a>Chapter&nbsp;8.&nbsp;Voicemail</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id263499">Comedian Mail</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292544">Dialplan Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292842">Storage Backends</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292932">ODBC</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293070">Using Asterisk As a Standalone Voicemail Server</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      <span class="keep-together">Voicemail Server</span></a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293304">sip.conf requirements</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293431">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Voicemail_id255105"></a>Just leave a message, maybe I’ll
    call.</p><div class="attribution"><span>—<span class="attribution">Joe Walsh</span></span></div></div><p><a id="Voicemail_id255425"></a><a id="index-802I022ID5R" class="indexterm"></a><a id="index-840I300SF2W" class="indexterm"></a>Before email and instant messaging became ubiquitous,
  voicemail was a popular method of electronic messaging. Even though most
  people prefer text-based messaging systems, voicemail remains an essential
  component of any PBX.</p><div class="sect1" title="Comedian Mail"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Voicemail_id263499"></a>Comedian Mail</h2></div></div></div><p><a id="DeeperDialplan_id294398"></a><a id="index-768O670MC1K" class="indexterm"></a><a id="index-236Q453VP0W" class="indexterm"></a>One of the most popular (or, arguably, unpopular) features
    of any modern telephone system is voicemail. Asterisk has a reasonably
    flexible voicemail system named Comedian Mail.<sup>[<a id="id549054" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id549054" class="footnote">83</a>]</sup> Some of the features of Asterisk’s voicemail system
    include:</p><div class="itemizedlist"><a id="DeeperDialplan_id294418"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeeperDialplan_id294420"></a><a id="DeeperDialplan_id294422"></a>Unlimited password-protected
        voicemail boxes, each containing mailbox folders for organizing
        voicemail</p></li><li class="listitem"><p><a id="DeeperDialplan_id294438"></a><a id="DeeperDialplan_id294440"></a>Different greetings for busy and
        unavailable states</p></li><li class="listitem"><p><a id="DeeperDialplan_id294444"></a><a id="DeeperDialplan_id294446"></a>Default and custom greetings</p></li><li class="listitem"><p><a id="DeeperDialplan_id294450"></a><a id="DeeperDialplan_id294452"></a>The ability to associate phones
        with more than one mailbox and mailboxes with more than one
        phone</p></li><li class="listitem"><p><a id="DeeperDialplan_id294458"></a><a id="DeeperDialplan_id294460"></a>Email notification of voicemail,
        with the voicemail optionally attached as a sound file<sup>[<a id="asterisk-CHP-6-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-4" class="footnote">84</a>]</sup></p></li><li class="listitem"><p><a id="DeeperDialplan_id294484"></a><a id="DeeperDialplan_id294486"></a>Voicemail forwarding and
        broadcasts</p></li><li class="listitem"><p><a id="DeeperDialplan_id294491"></a><a id="DeeperDialplan_id294493"></a>Message-waiting indicator (flashing
        light or stuttered dialtone) on many types of phones</p></li><li class="listitem"><p><a id="DeeperDialplan_id294518"></a><a id="DeeperDialplan_id294520"></a>Company directory of employees,
        based on voicemail boxes</p></li></ul></div><p><a id="DeeperDialplan_id294526"></a>And that’s just the tip of the
    iceberg!</p><p><a id="Voicemail_id250595"></a>The default version of the <code class="filename">/etc/asterisk/voicemail.conf</code> file requires a
    few tweaks in order to provide a configuration that will be suitable to
    most situations.</p><p><a id="Voicemail_id247132"></a>We’ll begin by going through the various
    options you can define in <code class="filename">voicemail.conf</code>, and then we’ll provide a sample
    configuration file with the settings we recommend for most
    deployments.</p><p><a id="Voicemail_id246582"></a>The <code class="filename">voicemail.conf</code> file contains several sections
    where parameters can be defined. The following sections detail all the
    options that are available.</p><div class="sect2" title="The [general] Section"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id272814"></a>The [general] Section</h3></div></div></div><p><a id="Voicemail_id247973"></a><a id="index-616H841IA2R" class="indexterm"></a><a id="index-125G412DJ6O" class="indexterm"></a><a id="index-360B633WH1H" class="indexterm"></a>The first section, <code class="literal">[general]</code>, allows you to define global
      settings for your voicemail system. The available options are listed in
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272012" title="Table 8.1. [general] section options for voicemail.conf">Table&nbsp;8.1, “[general] section options for voicemail.conf”</a>.</p><div class="table"><a id="Voicemail_id272012"></a><p class="title"><strong>Table&nbsp;8.1.&nbsp;[general] section options for voicemail.conf</strong></p><div class="table-contents"><table summary="[general] section options for voicemail.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">format</code></td><td><p><a id="Voicemail_id216498"></a> <code class="literal"><a id="I_indexterm8_d1e15966" class="indexterm"></a>wav49|gsm|wav</code> </p></td><td>For each format listed, Asterisk will create a separate
              recording in that format whenever a message is left. The benefit
              of this is that some transcoding steps may be saved if the
              stored format is the same as the codec used on the channel. We
              like wav because it is the highest quality, and wav49 because it
              is nicely compressed and easy to email. We don’t like gsm due to
              it’s scratchy sound, but it enjoys some popularity.<sup>[<a id="id549430" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id549430" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">serveremail</code></td><td><code class="literal"><a id="I_indexterm8_d1e15984" class="indexterm"></a>user@domain</code></td><td>When an email is sent from Asterisk, this is the email
              address that it will appear to come from.<sup>[<a id="id549479" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id549479" class="footnote">b</a>]</sup></td></tr><tr><td><code class="literal">attach</code></td><td><code class="literal"><a id="I_indexterm8_d1e16001" class="indexterm"></a>yes,no</code></td><td>If an email address is specified for a mailbox, this
              determines whether the messages is attached to the email (if
              not, a simple message notification is sent).</td></tr><tr><td><code class="literal">maxmsg</code></td><td><code class="literal"><a id="I_indexterm8_d1e16013" class="indexterm"></a>9999</code></td><td>By default Asterisk will only allow a maximum of 100
              messages to be stored per user. For users who delete messages,
              this is no problem. For people who like to save their messages,
              this space can get eaten up quickly. With the size of hard
              drives these days, you could easily store thousands of messages
              for each user, so our current thinking is to set this to the
              maximum and let the users manage things from there.</td></tr><tr><td><code class="literal">maxsecs</code></td><td><code class="literal"><a id="I_indexterm8_d1e16025" class="indexterm"></a>0</code></td><td>This type of setting was useful back in the days when a
              large voicemail system might have only 40 MB<sup>[<a id="id549596" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id549596" class="footnote">c</a>]</sup> of storage: it was necessary to limit the system
              because it was easy to fill up the hard drive. This setting can
              be annoying to callers (although it does force them to get to
              the point, so some people like it). Nowadays, with terabyte
              drives becoming common, there is no reason not to set this to a
              high value. Two considerations are: 1) if a channel gets hung in
              a mailbox, it’s good to set some sort of value so it doesn’t
              stay there for days, but 2) if a user wants to use her mailbox
              to record notes to herself, she won’t appreciate it if you cut
              her off after three minutes. A setting somewhere between
              <code class="literal">600</code> seconds (10 minutes) and
              <code class="literal">3600</code> seconds (1 hour) will
              probably be about right.</td></tr><tr><td><code class="literal">minsecs</code></td><td><code class="literal"><a id="I_indexterm8_d1e16047" class="indexterm"></a>4</code></td><td>Many folks will hang up instead of leaving a message when
              they call somebody and get voicemail. Sometimes this hangup
              happens after recording has started, so the mailbox owner gets
              an annoying two-second message of somebody hanging up. This
              setting ensures that Asterisk will ignore messages that are
              shorter than the configured minimum length. You should take care
              not to set this to a value that is too high, though, because
              then a message like “Hey it’s me give me a call” (which can be
              said in less than one second) will get lost, and you’ll get
              complaints of messages disappearing. Three seconds seems to be
              about right. To discourage people from leaving ultra-short
              messages that might be discarded, you can request callers to
              identify themselves and leave some information about why they
              called.</td></tr><tr><td><code class="literal">maxgreet</code></td><td><code class="literal"><a id="I_indexterm8_d1e16059" class="indexterm"></a>1800</code></td><td>You can define the maximum greeting length if you want.
              Again, since storage is not a problem and setting this too low
              will annoy your more verbose users, we suggest setting this to a
              high value and letting your users figure it out an appropriate
              length for themselves.</td></tr><tr><td><code class="literal">skipms</code></td><td><code class="literal"><a id="I_indexterm8_d1e16071" class="indexterm"></a>3000</code></td><td>When listening to messages, users can skip ahead or
              backwards by pressing (by default) <code class="literal">*</code> and <code class="literal">#</code>. This setting indicates the length
              of the jump (in milliseconds).</td></tr><tr><td><code class="literal">maxsilence</code></td><td><code class="literal"><a id="I_indexterm8_d1e16089" class="indexterm"></a>5</code></td><td>This setting defines the maximum time for which the
              caller can remain silent before the recording is stopped. We
              like to set this setting to one second longer than <code class="literal">minsecs</code> (if you set it equal to or
              greater than <code class="literal">minsecs</code>, you
              will get a warning).</td></tr><tr><td><code class="literal">silencethreshold</code></td><td><code class="literal"><a id="I_indexterm8_d1e16107" class="indexterm"></a>128</code></td><td>You can fine-tune the silence sensitivity of Asterisk to
              better define what qualifies as silence. In practice, this is
              seldom a good idea, since you cannot control the volumes of all
              the calls you’ll be getting from different places. It’s best to
              leave this at the default.</td></tr><tr><td><code class="literal">maxlogins</code></td><td><code class="literal"><a id="I_indexterm8_d1e16119" class="indexterm"></a>3</code></td><td>This little security feature is intended to make
              brute-force attacks on your mailbox passwords more
              time-consuming. If a bad password is received this many times,
              voicemail will hang up and you’ll have to call back in to try
              again. Note that this will not lock up the mailbox. Patient
              snoopers can continue to try to log into your mailbox as many
              times as they like, they’ll just have to call back every third
              attempt. If you have a lot of ham-fingered users, you can set
              this to something like <code class="literal">5</code>.</td></tr><tr><td><code class="literal">moveheard</code></td><td><code class="literal"><a id="I_indexterm8_d1e16135" class="indexterm"></a>yes</code></td><td>This setting will move listened-to messages to the
              <code class="filename">Old</code> folder. We recommend
              leaving this at the default.</td></tr><tr><td><code class="literal">forward</code> <code class="literal">_</code> <code class="literal">urgent</code> <code class="literal">_</code> <code class="literal">auto</code></td><td><code class="literal"><a id="I_indexterm8_d1e16158" class="indexterm"></a>no</code></td><td>Setting this to <code class="literal">yes</code>
              will preserve the original urgency setting of any messages the
              user receives and then forwards on. If you leave it at <code class="literal">no</code>, users can set the urgency level
              themselves on messages that they forward.</td></tr><tr><td><code class="literal">userscontext</code></td><td><code class="literal"><a id="I_indexterm8_d1e16176" class="indexterm"></a>default</code></td><td>If you use the <code class="filename">users.conf</code> file (we don’t), you can
              define here the context where entries are registered.</td></tr><tr><td><code class="literal">externnotify</code></td><td><code class="filename"><a id="I_indexterm8_d1e16191" class="indexterm"></a>/path/to/script</code></td><td>If you wish to run an external app whenever a message is
              left, you can define it here.</td></tr><tr><td><code class="literal">smdienable</code></td><td><code class="literal"><a id="I_indexterm8_d1e16203" class="indexterm"></a>no</code></td><td>If you are using Asterisk as a voicemail server on a PBX
              that supports SMDI, you can enable it here.</td></tr><tr><td><code class="literal">smdiport</code></td><td><code class="filename"><a id="I_indexterm8_d1e16215" class="indexterm"></a>/dev/ttyS0</code></td><td>Here is where you would define the SMDI port that
              messages between Asterisk and the external PBX would pass
              across.</td></tr><tr><td><code class="literal">externpass</code></td><td><code class="filename"><a id="I_indexterm8_d1e16227" class="indexterm"></a>/path/to/script</code></td><td>Any time the password on a mailbox is changed, the script
              you define here will be notified of the <code class="literal">context</code>, <code class="literal">mailbox</code>, and <code class="literal">new password</code>. The script will then be
              responsible for updating <code class="filename">voicemail.conf</code> (the Asterisk
              voicemail app will not update the password if this parameter is
              defined).</td></tr><tr><td><code class="literal">externpassnotify</code></td><td><code class="filename"><a id="I_indexterm8_d1e16251" class="indexterm"></a>/path/to/script</code></td><td>Any time the password on a mailbox is changed, the script
              you define here will be notified of the <code class="literal">context</code>, <code class="literal">mailbox</code>, and <code class="literal">new password</code>. Asterisk will handle
              updating the password in <code class="filename">voicemail.conf</code>. If you have defined
              <code class="literal">externpass</code>, this option will
              be ignored.</td></tr><tr><td><code class="literal">externpasscheck</code></td><td><code class="filename"><a id="I_indexterm8_d1e16278" class="indexterm"></a>/usr/local/bin/voicemailpwcheck.py</code></td><td>See the sidebar following this table for a description of
              this option.</td></tr><tr><td><code class="literal">directoryintro</code></td><td><code class="literal"><a id="I_indexterm8_d1e16290" class="indexterm"></a>dir-intro</code></td><td>The <code class="literal">Directory()</code>
              dialplan application uses the <code class="filename">voicemail.conf</code> file to search by name
              from an auto attendant. There is a default prompt that plays,
              called <code class="literal">dir-intro</code>. If you
              want, you can specify a different file to play instead.</td></tr><tr><td><code class="literal">charset</code></td><td><code class="literal"><a id="I_indexterm8_d1e16311" class="indexterm"></a>ISO-8859-1</code></td><td>If you need a character set other than ISO-8859-1 (a.k.a
              Latin 1) to be supported, you can specify it here.</td></tr><tr><td><code class="literal">adsifdn</code></td><td><code class="literal"><a id="I_indexterm8_d1e16324" class="indexterm"></a>0000000F</code></td><td>Use this option to configure the Feature Descriptor
              Number.<sup>[<a id="id550396" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id550396" class="footnote">d</a>]</sup></td></tr><tr><td><code class="literal">adsisec</code></td><td><code class="literal"><a id="I_indexterm8_d1e16339" class="indexterm"></a>9BDBF7AC</code></td><td>Use this option to configure the security lock
              code.</td></tr><tr><td><code class="literal">adsiver</code></td><td><code class="literal"><a id="I_indexterm8_d1e16351" class="indexterm"></a>1</code></td><td>This specifies the ADSI voicemail application version
              number.</td></tr><tr><td><code class="literal">pbxskip</code></td><td><code class="literal"><a id="I_indexterm8_d1e16363" class="indexterm"></a>yes</code></td><td>If you do not want emails from your voicemail to have the
              string [PBX] added to the subject, you can set this to <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">fromstring</code></td><td><code class="literal"><a id="I_indexterm8_d1e16378" class="indexterm"></a>The Asterisk PBX</code></td><td>You can use this setting to configure the <code class="literal">From:</code> name that will appear in emails
              from your PBX.</td></tr><tr><td><code class="literal">usedirectory</code></td><td><code class="literal"><a id="I_indexterm8_d1e16393" class="indexterm"></a>yes</code></td><td>This option allows users composing messages from their
              mailboxes to take advantage of the Directory.</td></tr><tr><td><code class="literal">odbcstorage</code></td><td><span class="emphasis"><em> <code class="literal"><a id="I_indexterm8_d1e16406" class="indexterm"></a>&lt;item from res_odbc.conf&gt;</code>
              </em></span></td><td>If you want to store voice messages in a database, you
              can do that using the Asterisk <code class="literal">res_odbc</code> connector. Here, you would
              set the name of the item in the <code class="filename">res_odbc</code> file. For details, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering" title="Chapter 22. Clustering">Chapter&nbsp;22, <em>Clustering</em></a>.</td></tr><tr><td><code class="literal">odbctable</code></td><td><span class="emphasis"><em> <code class="literal"><a id="I_indexterm8_d1e16427" class="indexterm"></a>&lt;table name&gt;</code> </em></span></td><td>This setting specifies the table name in the database
              that the <code class="literal">odbcstorage</code> setting
              refers to. For details, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering" title="Chapter 22. Clustering">Chapter&nbsp;22, <em>Clustering</em></a>.</td></tr><tr><td><code class="literal">emailsubject</code></td><td><a id="I_indexterm8_d1e16443" class="indexterm"></a><code class="literal">[PBX]: New</code>
              <code class="literal">message</code>
              <code class="literal">${VM_MSGNUM} in mailbox
              ${VM_MAILBOX}</code></td><td>When Asterisk sends an email, you can use this setting to
              define what the <code class="literal">Subject:</code> line
              of the email will look like. See the <code class="filename">voicemail.conf.sample</code> file for more
              details.</td></tr><tr><td><code class="literal">emailbody</code></td><td><code class="literal"><a id="I_indexterm8_d1e16468" class="indexterm"></a>Dear ${VM_NAME}:\n\n\tjust wanted to let you know
              you were just left a ${VM_DUR} long message (number
              ${VM_MSGNUM})\nin mailbox ${VM_MAILBOX u might\nwant to check it
              when you get a chance. Thanks!\n\n\t\t\t\t--Asterisk\n
              </code></td><td>When Asterisk sends an email, you can use this setting to
              define what the body of the email will look like. See the
              <code class="filename">voicemail.conf.sample</code> file
              for more details.</td></tr><tr><td><code class="literal">pagerfromstring</code></td><td><code class="literal"><a id="I_indexterm8_d1e16483" class="indexterm"></a>The Asterisk PBX</code></td><td>We don’t actually know anybody who uses pagers anymore
              (nor can we recall having seen one in many years), but if you
              have one of these historical oddities and you want to customize
              what Asterisk sends with its pager notification, presumably you
              can do that with this. A very practical usage of this feature
              for short message voicemail notifications is to send a message
              to an email to SMS gateway.</td></tr><tr><td><code class="literal">pagersubject</code></td><td><code class="literal"><a id="I_indexterm8_d1e16496" class="indexterm"></a>New VM</code></td><td>As above.</td></tr><tr><td><code class="literal">pagerbody</code></td><td><code class="literal"><a id="I_indexterm8_d1e16508" class="indexterm"></a>New ${VM_DUR} long msg in box ${VM_MAILBOX}\nfrom
              ${VM_CALLERID}, on ${VM_DATE}</code></td><td>The formatting for this uses the same rules as <code class="literal">emailbody</code>.</td></tr><tr><td><code class="literal">emaildateformat</code></td><td><code class="literal"><a id="I_indexterm8_d1e16523" class="indexterm"></a>%A, %d %B %Y at %H:%M:%S</code></td><td>This option allows you to specify the date format in
              emails. Uses the same rules as the C function <code class="literal">STRFTIME</code>.</td></tr><tr><td><code class="literal">pagerdateformat</code></td><td><code class="literal"><a id="I_indexterm8_d1e16538" class="indexterm"></a>%A, %d %B %Y at %H:%M:%S</code></td><td>This option allows you to specify the date format in
              pager. Uses the same rules as the C function <code class="literal">STRFTIME</code>.</td></tr><tr><td><code class="literal">mailcmd</code></td><td><code class="literal"><a id="I_indexterm8_d1e16553" class="indexterm"></a>/usr/sbin/sendmail -t</code></td><td>If you want to override the default operating system
              application for sending mail, you can specify it here.</td></tr><tr><td><code class="literal">pollmailboxes</code></td><td><code class="literal"><a id="I_indexterm8_d1e16565" class="indexterm"></a>no, yes</code></td><td>If the contents of mailboxes are changed by anything
              other than <code class="literal">app_voicemail</code>
              (such as external applications or another Asterisk system),
              setting this to <code class="literal">yes</code> will
              cause <code class="literal">app_voicemail</code> to poll
              all the mailboxes for changes, which will trigger proper message
              waiting indication (MWI) updates.</td></tr><tr><td><code class="literal">pollfreq</code></td><td><code class="literal"><a id="I_indexterm8_d1e16586" class="indexterm"></a>30</code></td><td>Used in concert with <code class="literal">pollmailboxes</code>, this option specifies
              the number of seconds to wait between mailbox polls.</td></tr><tr><td><code class="literal">imapgreetings</code></td><td><code class="literal"><a id="I_indexterm8_d1e16601" class="indexterm"></a>no, yes</code></td><td>This enables/disables remote storage of greetings in the
              IMAP folder. For more details, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>.</td></tr><tr><td><code class="literal">greetingsfolder</code></td><td><code class="literal"><a id="I_indexterm8_d1e16615" class="indexterm"></a>INBOX</code></td><td>If you’ve enabled <code class="literal">imapgreetings</code>, this parameter allows
              you to define the folder your greetings will be stored in
              (defaults to <span class="emphasis"><em>INBOX</em></span>).</td></tr><tr><td><code class="literal">imapparentfolder</code></td><td><code class="literal"><a id="I_indexterm8_d1e16633" class="indexterm"></a>INBOX</code></td><td>IMAP servers can handle parent folders in different ways.
              This field allows you to specify the parent folder for your
              mailboxes. For more details, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id549430" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id549430" class="para">a</a>] </sup>The separator that is used for
                  each format option must be the pipe (<code class="literal">|</code>) character.</p></div><div class="footnote"><p><sup>[<a id="ftn.id549479" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id549479" class="para">b</a>] </sup>Sending email from Asterisk can require some careful
                  configuration, because many spam filters will find Asterisk
                  messages suspicious and will simply ignore them. We talk
                  more about how to set email for Asterisk in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id549596" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id549596" class="para">c</a>] </sup>Yes, you read that correctly: megabytes.</p></div><div class="footnote"><p><sup>[<a id="ftn.id550396" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id550396" class="para">d</a>] </sup>The Analog Display Services Interface is a standard
                  that allows for more complex feature interactions through
                  the use of the phone display and menus. With the advent of
                  VoIP telephones, ADSI’s popularity has decreased in recent
                  years.</p></div></td></tr></tbody></table></div></div><br class="table-break"><div class="sidebar" title="External Validation of Voicemail Passwords"><a id="Voicemail_id291397"></a><div class="titlepage"><div><div><p class="title"><strong>External Validation of Voicemail Passwords</strong></p></div></div></div><p><a id="Voicemail_id291403"></a><a id="I_indexterm8_d1e16645" class="indexterm"></a><a id="I_indexterm8_d1e16650" class="indexterm"></a><a id="I_indexterm8_d1e16655" class="indexterm"></a>By default, Asterisk does not validate user passwords to
        ensure they are at least somewhat secure. Anyone who maintains
        voicemail systems will tell you that a large percentage of mailbox
        users set their passwords to something like <code class="literal">1234</code> or <code class="literal">1111</code>, or some other string that’s easy to
        guess. This represents a huge security hole in the voicemail
        system.</p><p><a id="Voicemail_id291416"></a>Since the <code class="filename">app_voicemail.so</code> module <a id="I_indexterm8_d1e16670" class="indexterm"></a>does not have the built-in ability to validate
        passwords, the settings <code class="literal">externpass</code>,
        <code class="literal">externpassnotify</code>, and <code class="literal">externpasscheck</code> allow you to validate them
        using an external program. Asterisk will call the program based on the
        path you specify, and pass it the following arguments:</p><a id="I_programlisting8_d1e16683"></a><pre class="programlisting">mailbox context oldpass newpass</pre><p><a id="Voicemail_id291438"></a>The script will then evaluate the
        arguments based on rules that you defined in the external script and,
        based on your rules, it should return to Asterisk a value of <code class="literal">VALID</code> for success or <code class="literal">INVALID</code> for failure (actually, the return
        value for a failed password can be anything except the words VALID or
        FAILURE). This value is typically printed to <code class="filename">stdout</code>. If the script returns <code class="literal">INVALID</code>, Asterisk will play an
        invalid-password prompt and the user will need to attempt something
        different.</p><p><a id="Voicemail_id291469"></a>Ideally, you would want to implement
        rules such as the following:</p><div class="itemizedlist"><a id="Voicemail_id291473"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Voicemail_id291475"></a><a id="Voicemail_id291477"></a>Passwords must be a minimum of six
            digits in length</p></li><li class="listitem"><p><a id="Voicemail_id291481"></a><a id="Voicemail_id291483"></a>Passwords must not be strings of
            repeated digits (e.g., <code class="literal">111111</code>)</p></li><li class="listitem"><p><a id="Voicemail_id291492"></a><a id="Voicemail_id291494"></a>Passwords must not be strings of
            contiguous digits (e.g., <code class="literal">123456</code>
            or <code class="literal">987654</code>)</p></li></ul></div><p><a id="Voicemail_id291506"></a>Asterisk comes with a simple script that
        will greatly improve the security of your voicemail system. It is
        located in the source code under the folder: <code class="filename">/contrib/scripts/voicemailpwcheck.py</code>.</p><p><a id="Voicemail_id291515"></a>We strongly recommend that you copy it
        to your <code class="filename">/usr/local/bin</code> folder (or
        wherever you prefer to put such things), and then uncomment the
        <code class="literal">externpasscheck=</code> option in your
        <code class="filename">voicemail.conf</code> file. Your
        voicemail system will then enforce the password security rules you
        have established.</p></div><p><a id="Voicemail_id291534"></a>Part of the <code class="literal">[general]</code> section is an area that is referred
      to as <span class="emphasis"><em>advanced options</em></span>. These options (listed in
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id291550" title="Table 8.2. Advanced options for voicemail.conf">Table&nbsp;8.2, “Advanced options for voicemail.conf”</a>) are defined in the same way as
      the other options in the <code class="literal">[general]</code>
      section, but they can also be defined on a per-mailbox basis, overriding
      whatever is defined under <code class="literal">[general]</code>
      for that particular setting.</p><div class="table"><a id="Voicemail_id291550"></a><p class="title"><strong>Table&nbsp;8.2.&nbsp;Advanced options for voicemail.conf</strong></p><div class="table-contents"><table summary="Advanced options for voicemail.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">tz</code></td><td><code class="literal"><a id="I_indexterm8_d1e16771" class="indexterm"></a>eastern</code>, <code class="literal">european</code>, etc.</td><td>Specifies the <code class="literal">zonemessages</code> name, as defined in the
              <code class="literal">[zone</code><code class="literal">messages]</code> section, discussed in
              the next section.</td></tr><tr><td><code class="literal">locale</code></td><td><code class="literal"><a id="I_indexterm8_d1e16795" class="indexterm"></a>de_DE.utf8</code>, <code class="literal">es_US.utf8</code>, etc.</td><td>Used to define how Asterisk generates date/time strings
              in different locales. To determine the locales that are valid on
              your Linux system, type <span class="command"><strong>locale
              -a</strong></span> at the shell.</td></tr><tr><td><code class="literal">attach</code></td><td><code class="literal"><a id="I_indexterm8_d1e16814" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If an email address is specified for a mailbox, this
              determines whether the messages are attached to the email
              notifications (otherwise, a simple message notification is
              sent).</td></tr><tr><td><code class="literal">attachfmt</code></td><td><code class="literal"><a id="I_indexterm8_d1e16829" class="indexterm"></a>wav49</code>, <code class="literal">wav</code>, etc.</td><td>If <code class="literal">attach</code> is enabled
              and messages are stored in different formats, this defines which
              format is sent with the email notifications. Often <code class="literal">wav49</code> is a good choice, as it uses a
              better compression algorithm and thus will use less
              bandwidth.</td></tr><tr><td><code class="literal">saycid</code></td><td><code class="literal"><a id="I_indexterm8_d1e16851" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This command will state the caller ID of the person who
              left the message.</td></tr><tr><td><code class="literal">cidinternalcontexts</code></td><td><span class="emphasis"><em><a id="I_indexterm8_d1e16866" class="indexterm"></a><code class="literal">&lt;context&gt;</code></em></span>,
              <span class="emphasis"><em><code class="literal">&lt;another</code><code class="literal"> </code><code class="literal">context&gt;</code></em></span></td><td>Any dialplan contexts listed here will be searched in an
              attempt to locate the mailbox context, so that the name
              associated with the mailbox number can be spoken. The voicemail
              box number needs to match the extension number that the call
              came from, and the voicemail context needs to match the dialplan
              context.<sup>[<a id="id551876" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id551876" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">sayduration</code></td><td><code class="literal"><a id="I_indexterm8_d1e16890" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This command will state the length of the
              message.</td></tr><tr><td><code class="literal">saydurationm</code></td><td><code class="literal"><a id="I_indexterm8_d1e16905" class="indexterm"></a>2</code></td><td>Use this to specify the minimum duration of a message to
              qualify for its length being played back. For example, if you
              set this to <code class="literal">2</code>, any message
              less than 2 minutes in length will not have its length
              stated.</td></tr><tr><td><code class="literal">dialout</code></td><td><span class="emphasis"><em> <code class="literal"><a id="I_indexterm8_d1e16921" class="indexterm"></a>&lt;context&gt;</code> </em></span></td><td>If allowed, users can dial out from their mailboxes. This
              is considered a very dangerous feature in a phone system (mainly
              because many voicemail users like to use <code class="literal">1234</code> as their password), and is
              therefore not recommended. If you insist on allowing this, make
              sure you have a second level of password in the dialplan where
              another password is specified. Even so, this is not a safe
              practice.</td></tr><tr><td><code class="literal">sendvoicemail</code></td><td><code class="literal"><a id="I_indexterm8_d1e16936" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This allows users to compose messages to other users from
              within their mailboxes.</td></tr><tr><td><code class="literal">searchcontexts</code></td><td><code class="literal"><a id="I_indexterm8_d1e16951" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This allows voicemail applications in the dialplan to not
              have to specify the voicemail context, since all contexts will
              be searched. This is not recommended.</td></tr><tr><td><code class="literal">callback</code></td><td><span class="emphasis"><em> <code class="literal"><a id="I_indexterm8_d1e16968" class="indexterm"></a>&lt;context&gt;</code> </em></span></td><td>This specifies which dialplan context to use to call back
              to the sender of a message. The specified context will need to
              be able to handle dialing of numbers in the format in which they
              are received (for example, the country code may not be received
              with the caller ID, but might be required for the outgoing
              call).</td></tr><tr><td><code class="literal">exitcontext</code></td><td><span class="emphasis"><em> <code class="literal"><a id="I_indexterm8_d1e16981" class="indexterm"></a>&lt;context&gt;</code> </em></span></td><td>There are options that allow the callers to exit the
              voicemail system when they are in the process of leaving a
              message (for example, pressing <code class="literal">0</code> to get an operator). By default, the
              context the caller came from will be used as the exit context.
              If desired, this setting will define a different context for
              callers exiting the voicemail system.</td></tr><tr><td><code class="literal">review</code></td><td><code class="literal"><a id="I_indexterm8_d1e16996" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This should almost always be set to <code class="literal">yes</code> (even though it defaults to
              <code class="literal">no</code>). People get upset if your
              voicemail system does not allow them to review their messages
              prior to delivering them.</td></tr><tr><td><code class="literal">operator</code></td><td><code class="literal"><a id="I_indexterm8_d1e17017" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Best practice dictates that you should allow your callers
              to “zero out” from a mailbox, should they not wish to leave a
              message. Note that an <code class="literal">o</code>
              extension (not “zero,” “oh”) is required in the <code class="literal">exitcontext</code> in order to handle these
              calls.</td></tr><tr><td><code class="literal">envelope</code></td><td><code class="literal"><a id="I_indexterm8_d1e17038" class="indexterm"></a>no</code>, <code class="literal">yes</code></td><td>You can have voicemail play back the details of the
              message before it plays the actual message. Since this
              information can also be accessed by pressing <code class="literal">5</code>, we generally set this to <code class="literal">no</code>.</td></tr><tr><td><code class="literal">delete</code></td><td><code class="literal"><a id="I_indexterm8_d1e17059" class="indexterm"></a>no</code>, <code class="literal">yes</code></td><td>After an email message notification is sent (which could
              include the message itself), the message will be deleted. This
              option is risky, because even though a message was emailed, it
              is no guarantee that it was received (spam filters seem to love
              to delete Asterisk voicemail messages). Point being: on a new
              system, leave this at <code class="literal">no</code>
              until you are certain that no messages are being lost due to
              spam filters.</td></tr><tr><td><code class="literal">volgain</code></td><td><code class="literal"><a id="I_indexterm8_d1e17077" class="indexterm"></a>0.0</code></td><td>This setting allows you to increase the volume of
              received messages. Volume used to be a problem in older releases
              of Asterisk, but has not been an issue for many years. We
              recommend leaving this at the default. The <span class="application"><code class="filename">sox</code></span> utility is required
              for this to work.</td></tr><tr><td><code class="literal">nextaftercmd</code></td><td><code class="literal"><a id="I_indexterm8_d1e17093" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This handy little setting will save you some time, as it
              takes you directly to the next message once you’ve finished
              dealing with the current message.</td></tr><tr><td><code class="literal">forcename</code></td><td><code class="literal"><a id="I_indexterm8_d1e17108" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This strange little setting will check if the mailbox
              password is the same as the mailbox number. If it is, it will
              force the user to change his voicemail password and record his
              name.</td></tr><tr><td><code class="literal">forcegreetings</code></td><td><code class="literal"><a id="I_indexterm8_d1e17123" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>As above, but for greetings.</td></tr><tr><td><code class="literal">hidefromdir</code></td><td><code class="literal"><a id="I_indexterm8_d1e17138" class="indexterm"></a>no</code>, <code class="literal">yes</code></td><td>If you wish, you can hide specific mailboxes from the
              <code class="literal">Directory()</code> application using
              this setting.</td></tr><tr><td><code class="literal">tempgreetwarn</code></td><td><code class="literal"><a id="I_indexterm8_d1e17157" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Setting this to <code class="literal">yes</code>
              will warn the mailbox owner that she has a temporary greeting
              set. This can be a useful reminder when people return from trips
              or vacations.</td></tr><tr><td><code class="literal">passwordlocation</code></td><td><code class="literal"><a id="I_indexterm8_d1e17175" class="indexterm"></a>spooldir</code></td><td>If you want, you can have mailbox passwords stored in the
              spool folder for each mailbox.<sup>[<a id="id552651" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id552651" class="footnote">b</a>]</sup></td></tr><tr><td><code class="literal">messagewrap</code></td><td><code class="literal"><a id="I_indexterm8_d1e17196" class="indexterm"></a>no</code>, <code class="literal">yes</code></td><td>If this is set to <code class="literal">yes</code>,
              when the user has listened to the last message, pressing next
              (<code class="literal">6</code>) will take him to the
              first message. Also, pressing previous (<code class="literal">4</code>) when at the first message will take
              the user to the last message.</td></tr><tr><td><code class="literal">minpassword</code></td><td><code class="literal"><a id="I_indexterm8_d1e17220" class="indexterm"></a>6</code></td><td>This option enforces a minimum password length. Note that
              this does not prevent the users from setting their passwords to
              something that’s easy to guess (such as <code class="literal">123456</code>).</td></tr><tr><td><code class="literal">vm-password</code></td><td><code class="literal"><a id="I_indexterm8_d1e17235" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the password prompt in voicemail.</td></tr><tr><td><code class="literal">vm-newpassword</code></td><td><code class="literal"><a id="I_indexterm8_d1e17247" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “Please enter your new password followed by the pound
              key” prompt in voicemail.</td></tr><tr><td><code class="literal">vm-passchanged</code></td><td><code class="literal"><a id="I_indexterm8_d1e17259" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “Your password has been changed” prompt in
              voicemail.</td></tr><tr><td><code class="literal">vm-reenterpassword</code></td><td><code class="literal"><a id="I_indexterm8_d1e17271" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “Please reenter your password followed by the pound key”
              prompt in <span class="keep-together">voicemail</span>.</td></tr><tr><td><code class="literal">vm-mismatch</code></td><td><code class="literal"><a id="I_indexterm8_d1e17286" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “The passwords you entered and reentered did not match”
              prompt in <span class="keep-together">voicemail</span>.</td></tr><tr><td><code class="literal">vm-invalid-password</code></td><td><code class="literal"><a id="I_indexterm8_d1e17301" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “That is not a valid password. Please try again” prompt
              in voicemail.</td></tr><tr><td><code class="literal">vm-pls-try-again</code></td><td><code class="literal"><a id="I_indexterm8_d1e17313" class="indexterm"></a>custom_sound</code></td><td>If you want, you can specify a custom sound here to use
              for the “Please try again” prompt in voicemail.</td></tr><tr><td><code class="literal">listen-control-forward-key</code></td><td><code class="literal"><a id="I_indexterm8_d1e17326" class="indexterm"></a>#</code></td><td>You can use this setting to customize the fast forward
              key.</td></tr><tr><td><code class="literal">listen-control-reverse-key</code></td><td><code class="literal"><a id="I_indexterm8_d1e17338" class="indexterm"></a>*</code></td><td>You can use this setting to customize the rewind
              key.</td></tr><tr><td><code class="literal">listen-control-pause-key</code></td><td><code class="literal"><a id="I_indexterm8_d1e17350" class="indexterm"></a>0</code></td><td>You can use this setting to customize the pause/unpause
              key.</td></tr><tr><td><code class="literal">listen-control-restart-key</code></td><td><code class="literal"><a id="I_indexterm8_d1e17362" class="indexterm"></a>2</code></td><td>You can use this setting to customize the replay
              key.</td></tr><tr><td><code class="literal">listen-control-stop-key</code></td><td><code class="literal"><a id="I_indexterm8_d1e17374" class="indexterm"></a>13456789</code></td><td>You can use this setting to customize the interrupt
              playback key.</td></tr><tr><td><code class="literal">backupdeleted</code></td><td><code class="literal"><a id="I_indexterm8_d1e17386" class="indexterm"></a>0</code></td><td>This setting will allow you to specify how many deleted
              messages are automatically stored by the system. This is similar
              to a recycle bin. Setting this to <code class="literal">0</code> disables this feature. Up to 9999
              messages can be stored, after which the oldest message will be
              erased each time another message is deleted.<a id="I_indexterm8_d1e17395" class="indexterm"></a><a id="I_indexterm8_d1e17396" class="indexterm"></a><a id="I_indexterm8_d1e17397" class="indexterm"></a></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id551876" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id551876" class="para">a</a>] </sup>Yes, we found this a bit confusing too.</p></div><div class="footnote"><p><sup>[<a id="ftn.id552651" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id552651" class="para">b</a>] </sup>Typically the spool folder is <code class="filename">/var/spool/asterisk/</code>, and it can
                  be defined in <code class="filename">/etc/asterisk/asterisk.conf</code>.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="The [zonemessages] Section"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292254"></a>The [zonemessages] Section</h3></div></div></div><p><a id="Voicemail_id292261"></a><a id="I_indexterm8_d1e17402" class="indexterm"></a><a id="I_indexterm8_d1e17409" class="indexterm"></a><a id="I_indexterm8_d1e17414" class="indexterm"></a>The next section of the <code class="filename">voicemail.conf</code> file is the <code class="literal">[zonemessages]</code> section. The purpose of this
      section is to allow time zone–specific handling of messages, so you can
      play back to the user messages with the correct timestamps. You can set
      the name of the zone to whatever you need. Following the zone name, you
      can define which time zone you want the name to refer to, as well as
      some options that define how timestamps are played back. You can look at
      the <code class="filename">~/src/asterisk-complete/asterisk/1.8/configs/voicemail.conf.sample</code>
      file for syntax details. Asterisk includes the examples shown in <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292277" title="Table 8.3. [zonemessages] section options for voicemail.conf">Table&nbsp;8.3, “[zonemessages] section options for voicemail.conf”</a>.</span></p><div class="table"><a id="Voicemail_id292277"></a><p class="title"><strong>Table&nbsp;8.3.&nbsp;[zonemessages] section options for voicemail.conf</strong></p><div class="table-contents"><table summary="[zonemessages] section options for voicemail.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Zone name</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">eastern</code></td><td><a id="I_indexterm8_d1e17448" class="indexterm"></a><code class="literal">America/New_York|'vm-received' Q</code>
              <code class="literal">'digits</code><code class="literal">/at' IMp</code></td><td>This value would be suitable for the eastern time zone
              (EST/EDT).</td></tr><tr><td><code class="literal">central</code></td><td><code class="literal"><a id="I_indexterm8_d1e17466" class="indexterm"></a>America/Chicago|'vm-received' Q 'digits/at'
              IMp</code></td><td>This value would be suitable for the central time zone
              (CST/CDT).</td></tr><tr><td><code class="literal">central24</code></td><td><code class="literal"><a id="I_indexterm8_d1e17478" class="indexterm"></a>America/Chicago|'vm-received' q 'digits/at' H N
              'hours'</code></td><td>This value would also be suitable for CST/CDT, but would
              play back the time in 24-hour format.</td></tr><tr><td><code class="literal">military</code></td><td><a id="I_indexterm8_d1e17489" class="indexterm"></a><code class="literal">Zulu|'vm-received' q
              'digits/at' H N 'hours'</code> <code class="literal">'phonetic/z_p'</code></td><td>This value would be suitable for Universal Time
              Coordinated (Zulu time, formerly GMT).</td></tr><tr><td><code class="literal">european</code></td><td><code class="literal"><a id="I_indexterm8_d1e17505" class="indexterm"></a>Europe/Copenhagen|'vm-received' a d b 'digits/at'
              HM</code></td><td>This value would be suitable for Central European time
              (CEST).</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="The Contexts Section"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292396"></a>The Contexts Section</h3></div></div></div><p><a id="Voicemail_id292402"></a><a id="I_indexterm8_d1e17515" class="indexterm"></a><a id="I_indexterm8_d1e17522" class="indexterm"></a><a id="I_indexterm8_d1e17527" class="indexterm"></a>All the remaining sections in the <code class="filename">voicemail.conf</code> file will be the voicemail
      contexts, which allow you to segregate groups of mailboxes.</p><p><a id="Voicemail_id292406"></a>In many cases, you will only need one
      <a id="I_indexterm8_d1e17536" class="indexterm"></a>voicemail context, commonly named <code class="literal">[default]</code>. This is worth noting, as it will
      make things simpler in the dialplan: all the voicemail-related
      applications assume the context <code class="literal">default</code> if no context is specified. In other
      words, if you don’t require separation of your voicemail users, use
      <code class="literal">default</code> as your one and only
      voicemail context.</p><p><a id="Voicemail_id292422"></a>The format for the mailboxes is as
      follows:</p><p><a id="Voicemail_id292426"></a><a id="Voicemail_id292427"></a></p><pre class="programlisting">mailbox =&gt; <em class="replaceable"><code>password</code></em>[,<em class="replaceable"><code>FirstName</code></em> <em class="replaceable"><code>LastName</code></em>[,<em class="replaceable"><code>email</code></em> <em class="replaceable"><code>addr</code></em>[,<em class="replaceable"><code>pager</code></em> <em class="replaceable"><code>addr</code></em>[,<em class="replaceable"><code>options</code></em>[|<em class="replaceable"><code>options</code></em>]]]]]</pre><p><a id="Voicemail_id292432"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id292435"></a>The pipe character (|) <a id="I_indexterm8_d1e17588" class="indexterm"></a><a id="I_indexterm8_d1e17593" class="indexterm"></a>used to be more popular in Asterisk. For the first few
          years, it was used as the standard delimiter. More recently, it has
          almost completely been replaced by the comma; however, there are
          still a few places where the pipe is used. One of them is in
          <code class="filename">voicemail.conf</code>: for example, as
          a separator for any mailbox-specific options, and also as the
          separator character in the <code class="literal">format=</code> declarative. You’ll see this in
          our upcoming example, as well as in the <code class="filename">voicemail.conf.sample</code> file.</p></div><p><a id="DeeperDialplan_id294619"></a>The parts of the mailbox <a id="I_indexterm8_d1e17610" class="indexterm"></a>definition are:</p><div class="variablelist"><dl><dt><span class="term"><em class="replaceable"><code>mailbox</code></em></span></dt><dd><p><a id="DeeperDialplan_id294632"></a><a id="DeeperDialplan_id294634"></a>This is the mailbox number. It
            usually corresponds with the extension number of the associated
            set.</p></dd><dt><span class="term"><em class="replaceable"><code>password</code></em></span></dt><dd><p><a id="DeeperDialplan_id294647"></a><a id="DeeperDialplan_id294649"></a>This is the numeric password
            that the mailbox owner will use to access her voicemail. If the
            user changes her password, the system will update this field in
            the <code class="filename">voicemail.conf</code>
            file.</p></dd><dt><span class="term"><em class="replaceable"><code>FirstName LastName</code></em></span></dt><dd><p><a id="DeeperDialplan_id294666"></a><a id="DeeperDialplan_id294668"></a>This is the name of the mailbox
            owner. The company directory uses the text in this field to allow
            callers to spell usernames.</p></dd><dt><span class="term"><em class="replaceable"><code>email address</code></em></span></dt><dd><p><a id="DeeperDialplan_id294681"></a><a id="DeeperDialplan_id294683"></a>This is the email address of
            the mailbox owner. Asterisk can send voicemail notifications
            (including the voicemail message itself, as an attachment) to the
            specified email box.</p></dd><dt><span class="term"><em class="replaceable"><code>pager address</code></em></span></dt><dd><p><a id="DeeperDialplan_id294697"></a><a id="DeeperDialplan_id294699"></a>This is the email address of
            the mailbox owner’s pager or cell phone. Asterisk can send a short
            voicemail notification message to the specified email
            address.</p></dd><dt><span class="term"><em class="replaceable"><code>options</code></em></span></dt><dd><p><a id="DeeperDialplan_id294714"></a><a id="DeeperDialplan_id294716"></a>This field is a list of options
            for setting the mailbox owner’s time zone and overriding the
            global voicemail settings. There are nine valid options: <code class="literal">attach</code>, <code class="literal">serveremail</code>, <code class="literal">tz</code>, <code class="literal">saycid</code>, <code class="literal">review</code>, <code class="literal">operator</code>, <code class="literal">callback</code>, <code class="literal">dialout</code>, and <code class="literal">exitcontext</code>. These options should be in
            <em class="replaceable"><code>option</code></em> <code class="literal">=</code> <em class="replaceable"><code>value</code></em>
            pairs, separated by the pipe character (<code class="literal">|</code>). The <code class="literal">tz</code> option sets the user’s time zone to a
            time zone previously defined in the <code class="literal">[zonemessages]</code> section of <code class="filename">voicemail.conf</code>, and the other eight
            options override the global voicemail settings with the same
            names.</p></dd></dl></div><p><a id="Voicemail_id420885"></a>The mailboxes you define in your <code class="filename">voicemail.conf</code> file might look like the
      following <span class="keep-together">examples</span>:</p><p><a id="Voicemail_id292458"></a><a id="Voicemail_id292459"></a></p><pre class="programlisting">[default]
100 =&gt; 5542,Mike Loukides,mike@shifteight.org
101 =&gt; 67674,Tim OReilly,tim@shifteight.org
102 =&gt; 36217,Mary JonesSmith,mary.jones-smith@shifteight.org

; *** This needs to all be on the same line
103 =&gt; 5426,Some Guy,,,dialout=fromvm|callback=fromvm
|review=yes|operator=yes|envelope=yes

[shifteight]
100 =&gt; 0107,Leif Madsen,leif@shifteight.org
101 =&gt; 0523,Jim VanMeggelen,jim@shifteight.org,,attach=no|maxmsg=100
102 =&gt; 11042,Tilghman Lesher,,,attach=no|tz=central</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Voicemail_id292467"></a>The Asterisk directory cannot handle
          the concept of a family name that is anything other than a simple
          word. This means that family names such as
          <span class="emphasis"><em>O’Reilly</em></span>, <span class="emphasis"><em>Jones-Smith</em></span>, and
          yes, even <span class="emphasis"><em>Van Meggelen</em></span> must have any
          punctuation characters and spaces removed before being added to
          <code class="filename">voicemail.conf</code>.</p></div><p>The contexts in <code class="filename">voicemail.conf</code> are an excellent and powerful
      concept, but you will likely find that the <code class="literal">default</code> context will be all that you need in
      normal use.</p></div><div class="sect2" title="An Initial voicemail.conf File"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292496"></a>An Initial voicemail.conf File</h3></div></div></div><p><a id="Voicemail_id292504"></a><a id="I_indexterm8_d1e17747" class="indexterm"></a><a id="I_indexterm8_d1e17754" class="indexterm"></a><a id="I_indexterm8_d1e17759" class="indexterm"></a><a id="I_indexterm8_d1e17764" class="indexterm"></a>We recommend the following sample as a starting point. You
      can refer to <code class="filename">~/asterisk-complete/asterisk/1.8/configs/voicemail.conf.sample</code>
      for details on the various settings: <a id="Voicemail_id292511"></a></p><pre class="programlisting">; Voicemail Configuration

[general]
format=wav49|wav
serveremail=voicemail@shifteight.org
attach=yes
skipms=3000
maxsilence=10
silencethreshold=128
maxlogins=3
emaildateformat=%A, %B %d, %Y at %r
pagerdateformat=%A, %B %d, %Y at %r
sendvoicemail=yes ; Allow the user to compose and send a voicemail while inside

[zonemessages]
eastern=America/New_York|'vm-received' Q 'digits/at' IMp
central=America/Chicago|'vm-received' Q 'digits/at' IMp
central24=America/Chicago|'vm-received' q 'digits/at' H N 'hours'
military=Zulu|'vm-received' q 'digits/at' H N 'hours' 'phonetic/z_p'
european=Europe/Copenhagen|'vm-received' a d b 'digits/at' HM

[shifteight.org]
100 =&gt; 1234,Leif Madsen,leif@shifteight.org
101 =&gt; 1234,Jim Van Meggelen,jim@shifteight.org
102 =&gt; 1234,Russell Bryant,russell@shifteight.org
103 =&gt; 1234,Jared Smith,jared@shifteight.org
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id292527"></a>Setting up a Linux server to handle
          the sending of email is a Linux administration task that is beyond
          the scope of this book. You will need to test your voicemail to
          email service to ensure that the email is being handled
          appropriately by the Mail Transfer Agent (MTA),<sup>[<a id="id554308" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id554308" class="footnote">85</a>]</sup> and that downstream spam filters are not rejecting the
          messages (one reason this might happen is if your Asterisk server is
          using a hostname in the email body that does not in fact resolve to
          it).<a id="I_indexterm8_d1e17782" class="indexterm"></a><a id="I_indexterm8_d1e17783" class="indexterm"></a></p></div></div></div><div class="sect1" title="Dialplan Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Voicemail_id292544"></a>Dialplan Integration</h2></div></div></div><p><a id="Voicemail_id292549"></a><a id="index-805W146OC3H" class="indexterm"></a><a id="index-340L460GN2T" class="indexterm"></a>There are two primary dialplan applications that are
    provided by the <code class="filename">app_voicemail.so</code>
    module in Asterisk. The first, simply named <code class="function">VoiceMail()</code>, does exactly what you would expect
    it to, which is to record a message in a mailbox. The second one,
    <code class="function">VoiceMailMain()</code>, allows a caller to
    log into a mailbox to retrieve messages.</p><div class="sect2" title="The VoiceMail() Dialplan Application"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292564"></a>The VoiceMail() Dialplan Application</h3></div></div></div><p><a id="Voicemail_id292573"></a><a id="I_indexterm8_d1e17812" class="indexterm"></a><a id="I_indexterm8_d1e17819" class="indexterm"></a>When you want to pass a call to voicemail, you need to
      provide two arguments: the mailbox (or mailboxes) in which the message
      should be left, and any options relating to this, such as which greeting
      to play or whether to mark the message as urgent. The structure of the
      <code class="literal">VoiceMail()</code> command is this:</p><p><a id="Voicemail_id292579"></a><a id="I_programlisting8_d1e17831"></a></p><pre class="programlisting"><em class="replaceable"><code>VoiceMail</code></em>(<em class="replaceable"><code>mailbox</code></em>[@<em class="replaceable"><code>context</code></em>][&amp;<em class="replaceable"><code>mailbox</code></em>[@<em class="replaceable"><code>context</code></em>][&amp;...]][,<em class="replaceable"><code>options</code></em>])</pre><p><a id="Voicemail_id292594"></a>The options you can pass to <code class="function">VoiceMail()</code> to provide a higher level of
      control are detailed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292600" title="Table 8.4. VoiceMail() optional arguments">Table&nbsp;8.4, “VoiceMail() optional arguments”</a>.</p><div class="table"><a id="Voicemail_id292600"></a><p class="title"><strong>Table&nbsp;8.4.&nbsp;VoiceMail() optional arguments</strong></p><div class="table-contents"><table summary="VoiceMail() optional arguments" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Argument</th><th align="center">Purpose</th></tr></thead><tbody><tr><td><code class="literal">b</code></td><td><a id="I_indexterm8_d1e17874" class="indexterm"></a>Instructs Asterisk to play the busy greeting for
              the mailbox (if no busy greeting is found, the unavailable
              greeting will be played).</td></tr><tr><td><code class="literal">d([c])</code></td><td><a id="I_indexterm8_d1e17883" class="indexterm"></a>Accepts digits to be processed by context <code class="literal">c</code>. If the context is not specified, it
              will default to the current context.</td></tr><tr><td><code class="literal">g(#)</code></td><td><a id="I_indexterm8_d1e17895" class="indexterm"></a>Applies the specified amount of gain (in decibels)
              to the recording. Only works on DAHDI channels.</td></tr><tr><td><code class="literal">s</code></td><td><a id="I_indexterm8_d1e17904" class="indexterm"></a>Suppresses playback of instructions to the callers
              after playing the greeting.</td></tr><tr><td><code class="literal">u</code></td><td><a id="I_indexterm8_d1e17913" class="indexterm"></a>Instructs Asterisk to play the unavailable
              greeting for the mailbox (this is the default behavior).</td></tr><tr><td><code class="literal">U</code></td><td><a id="I_indexterm8_d1e17922" class="indexterm"></a>Indicates that this message is to be marked as
              urgent. The most notable effect this has is when voicemail is
              stored on an IMAP server. In that case, the email will be marked
              as urgent. When the mailbox owner calls in to the Asterisk
              voicemail system, he should also be informed that the message is
              urgent.</td></tr><tr><td><code class="literal">P</code></td><td><a id="I_indexterm8_d1e17931" class="indexterm"></a>Indicates that this message is to be marked as
              priority.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="DeeperDialplan_id294980"></a>The <code class="literal">VoiceMail()</code> application sends the caller to
      the specified mailbox, so that he can leave a message. The mailbox
      should be specified as <em class="replaceable"><code>mailbox</code></em><code class="literal">@</code><em class="replaceable"><code>context</code></em>, where
      <em class="replaceable"><code>context</code></em> is the name of the voicemail context.
      The option letters <code class="literal">b</code> or <code class="literal">u</code> can be added to request the type of
      greeting. If the letter <code class="literal">b</code> is used,
      the caller will hear the mailbox owner’s <span class="emphasis"><em>busy</em></span>
      message. If the letter <code class="literal">u</code> is used, the
      caller will hear the mailbox owner’s <span class="emphasis"><em>unavailable</em></span>
      message (if one exists).</p><p><a id="DeeperDialplan_id295045"></a>Consider this simple example
      extension 101, which allows people to call John:</p><a id="I_programlisting6_tt941"></a><pre class="programlisting">exten =&gt; 101,1,Dial(${JOHN})</pre><p><a id="DeeperDialplan_id295077"></a>Let’s add an unavailable message that
      the caller will be played if John doesn’t answer the phone. Remember,
      the second argument to the <code class="literal">Dial()</code>
      application is a timeout. If the call is not answered before the timeout
      expires, the call is sent to the next priority. Let’s add a 10-second
      timeout, and a priority to send the caller to voicemail if John doesn’t
      answer in time:</p><a id="I_programlisting6_tt942"></a><pre class="programlisting">exten =&gt; 101,1,Dial(${JOHN},10)
exten =&gt; 101,n,VoiceMail(101@default,u)      </pre><p><a id="DeeperDialplan_id295107"></a>Now, let’s change it so that if John
      is busy (on another call), the caller will be sent to his voicemail,
      where he will hear John’s busy message. To do this, we will make use of
      the <code class="literal">${DIALSTATUS}</code> variable,<a id="I_indexterm8_d1e17986" class="indexterm"></a> which contains one of several status values (type
      <code class="filename">core show application dial</code> at the
      Asterisk console for a listing of all the possible values):</p><a id="I_programlisting6_tt943"></a><pre class="programlisting">exten =&gt; 101,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(101@default,u)
   same =&gt; n,Hangup()
<span class="strong"><strong>   same =&gt; n(busy),VoiceMail(101@default,b)</strong></span>
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id295142"></a>Now callers will get John’s voicemail
      (with the appropriate greeting) if John is either busy or unavailable. A
      slight problem remains, however, in that John has no way of retrieving
      his messages. We will remedy that in the next section.</p></div><div class="sect2" title="The VoiceMailMain() Dialplan Application"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292721"></a>The VoiceMailMain() Dialplan Application</h3></div></div></div><p><a id="Voicemail_id292729"></a><a id="I_indexterm8_d1e18004" class="indexterm"></a><a id="I_indexterm8_d1e18011" class="indexterm"></a><a id="I_indexterm8_d1e18018" class="indexterm"></a>Users can retrieve their voicemail messages, change their
      voicemail options, and record their voicemail greetings using the
      <code class="literal">VoiceMailMain()</code> application. <code class="literal">VoiceMailMain()</code> accepts two arguments: the
      mailbox number (and optionally the context) to be accessed, and some
      options. Both arguments are optional.</p><p><a id="Voicemail_id292735"></a>The structure of the <code class="literal">VoiceMailMain()</code> application looks like
      this:</p><p><a id="Voicemail_id292739"></a><a id="I_programlisting8_d1e18034"></a></p><pre class="programlisting">VoiceMailMain([<em class="replaceable"><code>mailbox</code></em>][@<em class="replaceable"><code>context</code></em>][,<em class="replaceable"><code>options</code></em>])</pre><p><a id="Voicemail_id292747"></a>If you do not pass any arguments to
      <code class="function">VoiceMailMain()</code>, it will play a
      prompt asking the caller to provide her mailbox number. The options that
      can be supplied are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292757" title="Table 8.5. VoiceMailMain() optional arguments">Table&nbsp;8.5, “VoiceMailMain() optional arguments”</a>.</p><div class="table"><a id="Voicemail_id292757"></a><p class="title"><strong>Table&nbsp;8.5.&nbsp;VoiceMailMain() optional arguments</strong></p><div class="table-contents"><table summary="VoiceMailMain() optional arguments" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Argument</th><th align="center">Purpose</th></tr></thead><tbody><tr><td><code class="literal">p</code></td><td><a id="I_indexterm8_d1e18068" class="indexterm"></a>Allows you to treat the
              &lt;<span class="emphasis"><em>mailbox</em></span>&gt; parameter as a prefix to
              the mailbox number.</td></tr><tr><td><code class="literal">g(<em class="replaceable"><code>#</code></em>)</code></td><td><a id="I_indexterm8_d1e18083" class="indexterm"></a>Increases the gain by <code class="literal">#</code> decibels when playing back
              messages.</td></tr><tr><td><code class="literal">s</code></td><td>Skips the password check.</td></tr><tr><td><code class="literal">a(<em class="replaceable"><code>folder</code></em>)</code></td><td><a id="I_indexterm8_d1e18104" class="indexterm"></a>Starts the session in one of the following
              voicemail folders (defaults to <code class="literal">0</code>): <code class="literal">0 -
              INBOX, 1 - Old, 2 - Work, 3 - Family, 4 - Friends, 5 - Cust1, 6
              - Cust2, 7 - Cust3, 8 - Cust4, 9 - Cust5 </code></td></tr></tbody></table></div></div><br class="table-break"><p><a id="Voicemail_id292743"></a>To allow users to dial an extension to
      check their voicemail, you could add an extension to the dialplan like
      this:</p><p><a id="Voicemail_id292748"></a><a id="Voicemail_id292749"></a></p><pre class="screen">[Services]

exten =&gt; *98,1,VoiceMailMain()</pre></div><div class="sect2" title="Creating a Dial-by-Name Directory"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-4.4"></a>Creating a Dial-by-Name Directory</h3></div></div></div><p><a id="DeeperDialplan_id295210"></a><a id="I_indexterm8_d1e18125" class="indexterm"></a><a id="I_indexterm8_d1e18132" class="indexterm"></a><a id="I_indexterm8_d1e18139" class="indexterm"></a>One last feature of the Asterisk voicemail system that we
      should cover is the dial-by-name directory. This is created with the
      <code class="literal">Directory()</code> application.<a id="I_indexterm8_d1e18146" class="indexterm"></a><a id="I_indexterm8_d1e18149" class="indexterm"></a> This application uses the names defined in the mailboxes
      in <code class="filename">voicemail.conf</code> to present the
      caller with a dial-by-name directory of the users.</p><p><a id="DeeperDialplan_id295257"></a><code class="literal">Directory()</code> takes up to three arguments: the
      voicemail context from which to read the names, the optional dialplan
      context in which to dial the user, and an option string (which is also
      optional). By default, <code class="literal">Directory()</code>
      searches for the user by last name, but passing the <code class="literal">f</code> option forces it to search by first name
      instead. Let’s add two dial-by-name directories to the <code class="literal">incoming</code> context of our sample dialplan, so
      that callers can search by either first or last name:</p><a id="I_programlisting6_tt949"></a><pre class="programlisting">exten =&gt; 8,1,Directory(default,incoming,f)
exten =&gt; 9,1,Directory(default,incoming)</pre><p><a id="DeeperDialplan_id295294"></a>If callers press <code class="literal">8</code>, they’ll get a directory by first name. If
      they dial <code class="literal">9</code>, they’ll get the
      directory by last name.</p></div><div class="sect2" title="Using a Jitterbuffer"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id36004128"></a>Using a Jitterbuffer</h3></div></div></div><p><a id="Voicemail_id36004134"></a><a id="I_indexterm8_d1e18185" class="indexterm"></a><a id="I_indexterm8_d1e18192" class="indexterm"></a><a id="I_indexterm8_d1e18199" class="indexterm"></a>When using Asterisk as a voicemail server,<sup>[<a id="id555499" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id555499" class="footnote">86</a>]</sup> you may want to add a <code class="filename">jitterbuffer</code> in between voicemail and the
      caller. The purpose of a jitterbuffer is to help deal with the fact that
      when a call traverses an IP network, the traffic may not arrive with
      perfect timing and in perfect order. If packets occasionally arrive with
      a bit of delay (jitter) or if they arrive out of order, a jitterbuffer
      can fix it so that the voicemail system receives the voice stream on
      time and in order. If the jitterbuffer detects that a packet was lost
      (or may arrive so late that it will no longer matter), it can perform
      packet loss concealment. That is, it will attempt to make up a frame of
      audio to put in place of the lost audio to make it harder to hear that
      audio was lost.</p><p><a id="Voicemail_id36004151"></a>In Asterisk, jitterbuffer support can
      only be enabled on a bridge between two channels. In the case of
      voicemail, there is generally only a single channel connected to one of
      the voicemail applications. To enable the use of a jitterbuffer in front
      of voicemail, we create a bridge between two channels by using a
      <code class="literal">Local</code> channel and specifying the
      <code class="literal">j</code> option. Specifying the <code class="literal">n</code> option for the <code class="literal">Local</code> channel additionally ensures that the
      <code class="literal">Local</code> channel is not optimized out of
      the call path in Asterisk:<a id="I_indexterm8_d1e18234" class="indexterm"></a><a id="I_indexterm8_d1e18235" class="indexterm"></a></p><a id="Voicemail_id36004178"></a><pre class="programlisting">[Services]

exten =&gt; *98,1,Dial(Local/vmm@Services/nj)

exten =&gt; vmm,1,VoiceMailMain()</pre></div></div><div class="sect1" title="Storage Backends"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Voicemail_id292842"></a>Storage Backends</h2></div></div></div><p><a id="Voicemail_id292847"></a><a id="index-344W132CF0K" class="indexterm"></a><a id="index-427S143CU2S" class="indexterm"></a>The storage of messages on a traditional voicemail system
    has always tended to be overly complicated.<sup>[<a id="id555667" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id555667" class="footnote">87</a>]</sup> Asterisk, on the other hand, not only provides you with a
    simple, logical, filesystem-based storage mechanism, but also offers a few
    extra message storage options.</p><div class="sect2" title="Linux Filesystem"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292862"></a>Linux Filesystem</h3></div></div></div><p><a id="Voicemail_id292867"></a><a id="I_indexterm8_d1e18261" class="indexterm"></a><a id="I_indexterm8_d1e18268" class="indexterm"></a><a id="I_indexterm8_d1e18275" class="indexterm"></a>By default, Asterisk will store voice messages <a id="I_indexterm8_d1e18281" class="indexterm"></a>in the spool folder,<a id="I_indexterm8_d1e18285" class="indexterm"></a> at <code class="filename">/var/spool/asterisk/voicemail/&lt;context&gt;/&lt;mailbox&gt;</code>.
      The messages <a id="I_indexterm8_d1e18292" class="indexterm"></a>can be stored in multiple formats (such as WAV and GSM),
      depending on what you specified as the <code class="literal">format</code> in the <code class="literal">[general]</code> section of your <code class="filename">voicemail.conf</code> file. Your greetings will also
      be stored in this folder.</p><p><a id="Voicemail_id292884"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id292887"></a>Asterisk will not create a folder for
          any mailboxes that do not have any recordings yet (as would be the
          case with a new mailbox), so this folder cannot be used as a
          reliable method of determining which mailboxes exist on the
          system.</p></div><p><a id="Voicemail_id292893"></a>Here’s an example of what might be in a
      mailbox folder. This mailbox has no new messages in the <code class="filename">INBOX</code>, has two saved messages in the
      <code class="filename">Old</code> folder, and has <code class="filename">busy</code> and <code class="filename">unavailable</code> greetings recorded:</p><p><a id="Voicemail_id292910"></a><a id="Voicemail_id292911"></a></p><pre class="screen">/var/spool/asterisk/voicemail/default
./INBOX
./Old
./Old/msg0000.WAV
./Old/msg0000.txt
./Old/msg0001.WAV
./Old/msg0001.txt
./Urgent
./busy.WAV
./unavail
./unavail.WAV
</pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id292917"></a>For each message, there is a matching
          <code class="filename">msg####.txt</code> file, which
          contains the envelope information for the message. The <code class="filename">msg####.txt</code> file is also critically
          important for message waiting indication (MWI), as this is the file
          that Asterisk looks for in the <code class="filename">INBOX</code> to determine whether the message
          light for a user should be on or off.</p></div></div><div class="sect2" title="ODBC"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id292932"></a>ODBC</h3></div></div></div><p><a id="Voicemail_id292937"></a><a id="I_indexterm8_d1e18343" class="indexterm"></a><a id="I_indexterm8_d1e18350" class="indexterm"></a><a id="I_indexterm8_d1e18357" class="indexterm"></a>In a centralized or distributed system, you may find it
      desirable to store messages as binary objects in a database, instead of
      as files on the filesystem. We’ll discuss this in detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578" title="ODBC Voicemail">the section called “ODBC Voicemail”</a>.</p></div><div class="sect2" title="IMAP"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id293050"></a>IMAP</h3></div></div></div><p><a id="Voicemail_id293055"></a><a id="I_indexterm8_d1e18369" class="indexterm"></a><a id="I_indexterm8_d1e18376" class="indexterm"></a><a id="I_indexterm8_d1e18383" class="indexterm"></a>Many people would prefer to manage their voicemail as part
      of their email. This has been called <span class="emphasis"><em>unified
      messaging</em></span><a id="I_indexterm8_d1e18391" class="indexterm"></a> by the telecom industry, and its implementation has
      traditionally been expensive and complex. Asterisk allows for a fairly
      simple integration between voicemail and email, either through its
      built-in voicemail to email handler, or through a relationship with an
      IMAP server. We’ll discuss IMAP integration in detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration" title="VoiceMail IMAP Integration">the section called “VoiceMail IMAP Integration”</a>.<a id="I_indexterm8_d1e18397" class="indexterm"></a><a id="I_indexterm8_d1e18398" class="indexterm"></a></p></div></div><div class="sect1" title="Using Asterisk As a Standalone Voicemail Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Voicemail_id293070"></a>Using Asterisk As a Standalone Voicemail Server</h2></div></div></div><p><a id="Voicemail_id293076"></a><a id="index-427P347NG8R" class="indexterm"></a><a id="index-781Q704JL3N" class="indexterm"></a>In a traditional telecom environment, the voicemail server
    was typically a standalone unit (provided either as a separate server
    altogether, or as an add-in card to the system). Very few PBXs had fully
    integrated voicemail (in the sense that voicemail was an integral part of
    the PBX rather than a peripheral device).</p><p><a id="Voicemail_id293082"></a>Asterisk is quite capable of serving as a
    standalone voicemail system. The two most common reasons one might want to
    do this are:</p><div class="orderedlist"><a id="Voicemail_id293087"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Voicemail_id293089"></a><a id="Voicemail_id293091"></a>If you are building a large, centralized
        system and have several servers each providing a specific function
        (proxy server, media gateway, voicemail, conferencing, etc.)</p></li><li class="listitem"><p><a id="Voicemail_id293097"></a><a id="Voicemail_id293099"></a>If you wish to replace the voicemail
        system on a traditional PBX with an Asterisk voicemail</p></li></ol></div><p><a id="Voicemail_id293106"></a>Asterisk can serve in either of these
    roles.</p><div class="sect2" title="Integrating Asterisk into a SIP Environment As a Standalone Voicemail Server"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id293109"></a>Integrating Asterisk into a SIP Environment As a Standalone
      <span class="keep-together">Voicemail Server</span></h3></div></div></div><p><a id="Voicemail_id293115"></a><a id="index-132D227PQ8N" class="indexterm"></a>If you want to have Asterisk act as a dedicated voicemail
      server (i.e., with no sets registered to it and no other types of calls
      passing through it), the process from the dialplan perspective is quite
      simple. Getting message waiting to work can be a bit more difficult,
      though.</p><p><a id="Voicemail_id293124"></a>Let’s start with a quick diagram. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293125" title="Figure 8.1. Simplified SIP enterprise environment">Figure&nbsp;8.1, “Simplified SIP enterprise environment”</a> shows an overly simplified example of a
      typical SIP enterprise environment. We don’t even have an Asterisk
      server in there (other than for the voicemail), in order to give you a
      generic representation of how Asterisk could serve as a standalone
      voicemail server in an otherwise non-Asterisk <span class="keep-together">environment</span>.</p><p><a id="Voicemail_id293146"></a>Unfortunately, Asterisk cannot send
      message notification to an endpoint if it doesn’t know where that
      endpoint is. In a typical Asterisk system, where set registration and
      voicemail are handled on the same machine, this is never a problem,
      since Asterisk knows where the sets are. But in an environment where the
      sets are not registered to Asterisk, this can become a complex
      problem.</p><p><a id="Voicemail_id293156"></a>There are several solutions on the
      Internet that recommend using the <code class="literal">externnotify</code><a id="I_indexterm8_d1e18450" class="indexterm"></a> option in <code class="filename">voicemail.conf</code>, triggering an external script
      whenever a message is left in a mailbox (or deleted). While we can’t say
      that’s a bad approach, we find it a bit kludgy, and it requires the
      administrator to understand how to write an external script or program
      to handle the actual passing of the message.</p><div class="figure-float"><div class="figure"><a id="Voicemail_id293125"></a><p class="title"><strong>Figure&nbsp;8.1.&nbsp;Simplified SIP enterprise environment</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject8_d1e18460"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0801.png" alt="Simplified SIP enterprise environment"></div></div></div><br class="figure-break"></div><p><a id="Voicemail_id293169"></a>Instead you can statically define an entry
      for each mailbox in the voicemail server’s <code class="filename">sip.conf</code><a id="I_indexterm8_d1e18469" class="indexterm"></a> file, indicating where the message notifications are to
      be sent. Rather than defining the address of each endpoint, however, you
      can have the voicemail server send all messages to the proxy, which will
      handle the relay of the message notifications to the appropriate
      endpoints.</p><p><a id="Voicemail_id293180"></a>The voicemail server still needs to know
      about the SIP endpoints, even though the devices are not registered
      directly to it. This can be done either through a <code class="filename">sip.conf</code> file that identifies each SIP
      endpoint, or through a static real-time database that does the same
      thing. Whether you use <code class="filename">sip.conf</code> or
      the Asterisk Realtime Architecture (ARA), each endpoint will require an
      entry similar to this:<a id="Voicemail_id293188"></a></p><pre class="screen">[messagewaiting](!)            ; a template to handle the settings common 
                               ; to all mailboxes
type=peer
subscribecontext=voicemailbox  ; the dialplan context on the voicemail server
context=voicemailbox           ; the dialplan context on the voicemail server
host=192.168.1.1               ; ip address of presence server

[0000FFFF0001](messagewaiting) ; this will need to match the subscriber 
                               ; name on the proxy
mailbox=0000FFFF0001@DIR1      ; this has to be in the form mailbox@mailboxcontext
defaultuser=0000FFFF0001       ; this will need to match the subscriber 
                               ; name on the proxy
</pre><p><a id="Voicemail_id293197"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id293200"></a>Note that Asterisk’s dynamic realtime
          <a id="I_indexterm8_d1e18487" class="indexterm"></a>will not work with this configuration, as a peer’s
          information is only loaded into memory when there is an actual call
          involving that peer. Since message notification is not a call as far
          as Asterisk is concerned, using dynamic realtime will not allow
          message waiting to happen for any peers not registered to
          Asterisk.</p></div><p>You will <span class="emphasis"><em>not</em></span> want to implement this unless
      you have prototyped the basic operation of the solution. Although we all
      agree that SIP is a protocol, not everyone agrees as to the correct way
      to implement the protocol. As a result, there are many interoperability
      challenges that need to be addressed in a solution like this. We have
      provided a basic introduction to this concept in this book, but the
      implementation details will depend on other factors external to
      Asterisk, such as the capabilities of the proxy.</p><p><a id="Voicemail_id293213"></a>The fact that no device has to register
      with Asterisk will significantly reduce the load on the Asterisk server,
      and as a result this design should allow for a voicemail server that can
      support several thousand subscribers.</p><div class="sect3" title="Dialplan requirements"><div class="titlepage"><div><div><h4 class="title"><a id="Voicemail_id293218"></a>Dialplan requirements</h4></div></div></div><p><a id="Voicemail_id293224"></a><a id="I_indexterm8_d1e18503" class="indexterm"></a>The dialplan of the voicemail server can be fairly
        simple. Two needs must be satisfied:</p><div class="orderedlist"><a id="Voicemail_id293228"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Voicemail_id293230"></a><a id="Voicemail_id293232"></a>Receive incoming calls and direct
            them to the appropriate mailbox</p></li><li class="listitem"><p><a id="Voicemail_id293237"></a><a id="Voicemail_id293239"></a>Handle incoming calls from users
            wishing to check their messages</p></li></ol></div><p><a id="Voicemail_id293246"></a>The system that is passing calls to the
        voicemail server should set some SIP headers in order to pass
        additional information to the voicemail server. Typically, this
        information would include the mailbox/username that is relevant to the
        call. In our example, we are going to set the headers <code class="literal">X-Voicemail-Mailbox</code><a id="I_indexterm8_d1e18520" class="indexterm"></a> and <code class="literal">X-Voicemail-Context</code><a id="I_indexterm8_d1e18526" class="indexterm"></a>, which will contain information we wish to pass to the
        voicemail server.<sup>[<a id="id556640" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id556640" class="footnote">88</a>]</sup></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Voicemail_id293269"></a>If the source system is also an
            Asterisk system, you might set the headers using the <code class="literal">SIPAddHeader()</code> voicemail
            application,<a id="I_indexterm8_d1e18545" class="indexterm"></a><a id="I_indexterm8_d1e18548" class="indexterm"></a> in a manner similar <span class="keep-together">to
            this</span>:</p><a id="I_programlisting8_d1e18557"></a><pre class="programlisting">exten =&gt; sendtovoicemail,1,Verbose(2,Set SIP headers for voicemail)
    same =&gt; n,SipAddHeader(X-Voicemail-Mailbox: &lt;mailbox number&gt;)
    same =&gt; n,SipAddHeader(X-Voicemail-Context: voicemailbox)</pre><p><a id="Voicemail_id293274"></a>Note that this dialplan does not go
            on the voicemail server. It would only be useful if one of the
            other servers in your environment was also an Asterisk server. If
            you were using a different kind of server, you would need to find
            out how to set custom headers in that platform, or find out if it
            already uses specific headers for this sort of thing, and possibly
            modify the dialplan on the voicemail server to handle those
            headers.</p></div><p><a id="Voicemail_id293289"></a>The voicemail server will need an
        <code class="filename">extensions.conf</code> file containing
        the following:</p><p><a id="Voicemail_id293293"></a><a id="Voicemail_id293294"></a></p><pre class="screen">[voicemailbox]
; direct incoming calls to a mailbox
exten =&gt;  Deliver,1,NoOp()
    same =&gt;  n,Set(Mailbox=${SIP_HEADER(X-Voicemail-Mailbox)})
    same =&gt;  n,Set(MailboxContext=${SIP_HEADER(X-Voicemail-Context)})
    same =&gt;  n,VoiceMail(${Mailbox}@${MailboxContext})
    same =&gt;  n,Hangup()

; connect users to their mailbox so that they can retrieve messages exten =&gt;  
Retrieve,1,NoOp()
    same =&gt;  n,Set(Mailbox=${SIP_HEADER(X-Voicemail-Mailbox)})
    same =&gt;  n,Set(MailboxContext=${SIP_HEADER(X-Voicemail-Context)})
    same =&gt;  n,VoiceMailMain(${Mailbox}@${MailboxContext})
    same =&gt;  n,Hangup()</pre></div><div class="sect3" title="sip.conf requirements"><div class="titlepage"><div><div><h4 class="title"><a id="Voicemail_id293304"></a>sip.conf requirements</h4></div></div></div><p><a id="Voicemail_id293311"></a>In the <code class="filename">sip.conf</code> file on the voicemail server, not
        only are entries required for all the mailboxes for message waiting
        notification, but some sort of entry is required to define the
        connection between the voicemail server and the rest of the SIP
        environment:</p><p><a id="Voicemail_id293320"></a><a id="Voicemail_id293321"></a></p><pre class="screen">[VOICEMAILTRUNK]
type=peer
defaultuser=voicemail
fromuser=voicemail
secret=s0m3th1ngs3cur3
canreinvite=no
host=&lt;<em class="replaceable"><code>address of proxy/registrar server</code></em>&gt;
disallow=all
allow=ulaw
dtmfmode=rfc2833
context=voicemailbox</pre><p>The other end of the connection (probably your
        proxy server) must be configured to pass voicemail connections to the
        voicemail server.</p><p><a id="Voicemail_id293329"></a>Running Asterisk as a standalone
        voicemail server requires some knowledge of clustering and
        integration, but you can’t beat the price.<a id="I_indexterm8_d1e18586" class="indexterm"></a></p></div></div><div class="sect2" title="SMDI (Simplified Message Desk Interface)"><div class="titlepage"><div><div><h3 class="title"><a id="Voicemail_id293336"></a>SMDI (Simplified Message Desk Interface)</h3></div></div></div><p><a id="Voicemail_id293341"></a><a id="I_indexterm8_d1e18591" class="indexterm"></a><a id="I_indexterm8_d1e18594" class="indexterm"></a>The Simplified Message Desk Interface (SMDI) protocol is
      intended to allow communication of basic message information between
      telephone systems and voicemail <span class="keep-together">systems</span>.</p><p><a id="Voicemail_id293346"></a>Asterisk supports SMDI, but given that
      this is an old protocol that runs across a serial connection, there are
      likely to be integration challenges. Support in various PBXs and other
      devices may be spotty. Still, it’s a fairly simple protocol, so for sure
      it’s worth testing out if you are considering using Asterisk as a
      voicemail replacement.</p><p><a id="Voicemail_id293352"></a>The following is not a detailed
      explanation of how to configure SMDI for Asterisk, but rather an
      introduction to the concepts, with some basic examples. If you are
      planning on implementing SMDI, you will need to write some complex
      dialplan logic and have a good understanding of how to interconnect
      systems via serial connections.</p><p><a id="Voicemail_id293358"></a>SMDI is enabled in Asterisk by the use of
      two options in the <code class="literal">[general]</code> section
      of the <code class="filename">voicemail.conf</code> file:</p><p><a id="Voicemail_id293369"></a><a id="Voicemail_id293370"></a></p><pre class="screen">smdienable=yes
smdiport=/dev/ttyS0; or whatever serial port you are connecting your SMDI service to</pre><p>Additionally,
      you will need an <code class="filename">smdi.conf</code> file in
      your <code class="filename">/etc/asterisk</code> folder to define
      the details of your SMDI configuration. It should look something like
      this (see the <code class="filename">smdi.conf.sample</code> file
      for more information on the available options):</p><p><a id="Voicemail_id293386"></a><a id="Voicemail_id293387"></a></p><pre class="screen">[interfaces]
charsize=7
paritybit=even
baudrate=1200           ; hopefully a higher bitrate is supported
smdiport=/dev/ttyS0     ; or whatever serial port you'll be using to handle 
                        ; SMDI messages on asterisk

[mailboxes]             ; map incoming digit strings (typically DID numbers) 
                        ; to a valid mailbox@context in voicemail.conf
smdiport=/dev/ttyS0     ; first declare which SMDI port the following mailboxes 
                        ; will use
4169671111=1234@default
4165551212=9999@default

</pre><p>In the dialplan there are two functions that will be wanted in an
      SMDI configuration. The <code class="function">SMDI_MSG_RETRIEVE()</code> function pulls the
      relevant message from the SMDI message queue. You need to pass the
      function a search key (typically the DID that is referred to in the
      message), and it will pass back an ID number that can be referenced by
      the <code class="literal">SMDI_MSG()</code> function:</p><a id="Voicemail_id293405"></a><pre class="screen">SMDI_MSG_RETRIEVE(&lt;<em class="replaceable"><code>smdi port</code></em>&gt;,&lt;<em class="replaceable"><code>search key</code></em>&gt;[,<em class="replaceable"><code>timeout</code></em>[,<em class="replaceable"><code>options</code></em>]])</pre><p><a id="Voicemail_id293409"></a>Once you have the SMDI message ID, you can
      use the <code class="function">SMDI_MSG()</code> function
      <a id="I_indexterm8_d1e18655" class="indexterm"></a><a id="I_indexterm8_d1e18658" class="indexterm"></a>to access various details about the message, such as the
      <code class="literal">station</code>, <code class="literal">callerID</code>, and <code class="literal">type</code> (the SMDI message type):</p><a id="Voicemail_id293418"></a><pre class="screen">SMDI_MSG(&lt;<em class="replaceable"><code>message_id</code></em>&gt;,&lt;<em class="replaceable"><code>component</code></em>&gt;)</pre><p><a id="Voicemail_id293421"></a>In your dialplan, you will need to handle
      the lookup of the SMDI messages that come in, in order to ensure that
      calls are handled correctly. For example, if an incoming call is
      intended for delivery to a mailbox, the message type might be one of
      <code class="literal">B</code> (for busy) or <code class="literal">N</code> (for unanswered calls). If, on the other
      hand, the call is intended to go to <code class="literal">VoiceMailMain()</code> because the caller wants to
      retrieve his messages, the SMDI message type would be <code class="literal">D</code>, and that would have to be
      handled.<a id="I_indexterm8_d1e18695" class="indexterm"></a><a id="I_indexterm8_d1e18696" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Voicemail_id293431"></a>Conclusion</h2></div></div></div><p><a id="Voicemail_id293436"></a>While the Asterisk voicemail system is quite
    old in terms of Asterisk code, it is nevertheless a powerful application
    that can (and does) compete quite successfully with expensive, proprietary
    voicemail systems.<a id="I_indexterm8_d1e18702" class="indexterm"></a><a id="I_indexterm8_d1e18703" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id549054" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id549054" class="para">83</a>] </sup>This name was a play on words, inspired in part by Nortel’s
        voicemail system Meridian Mail.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-4" class="para">84</a>] </sup>No, you really don’t have to pay for this—and yes, it really
            does work.</p></div><div class="footnote"><p><sup>[<a id="ftn.id554308" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id554308" class="para">85</a>] </sup>Also sometimes called a Message Transfer Agent.</p></div><div class="footnote"><p><sup>[<a id="ftn.id555499" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id555499" class="para">86</a>] </sup>This advice applies to any situation where Asterisk is the
          endpoint of a call. Another example would be when using the <code class="literal">MeetMe()</code> or <code class="literal">ConfBridge()</code> applications for
          conferencing.</p></div><div class="footnote"><p><sup>[<a id="ftn.id555667" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id555667" class="para">87</a>] </sup>Nortel used to store its messages in a sort of special
        partition, in a proprietary format, which made it pretty much
        impossible to extract messages from the system, or email them, or
        archive them, or really do anything with them.</p></div><div class="footnote"><p><sup>[<a id="ftn.id556640" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id556640" class="para">88</a>] </sup>As far as we know, there aren’t any specific SIP headers
            <a id="I_indexterm8_d1e18533" class="indexterm"></a>that are standardized for this sort of thing, so you
            should be able to name the headers whatever you want. We chose
            these header names simply because they make some sort of sense.
            You may find that other headers would suit your needs
            better.</p></div></div></div><div class="chapter" title="Chapter 9. Internationalization"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Internationalization"></a>Chapter&nbsp;9.&nbsp;Internationalization</h2></div><div><div class="author"><h3 class="author"><span class="firstname">David</span> <span class="surname">Duffett</span></h3></div></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id373863">Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305757">Caller ID</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></span></dt></dl></div><div class="epigraph"><p><a id="Internationalization_id415320"></a>I traveled a good deal all over
    the world, and I got along pretty good in all these foreign countries, for
    I have a theory that it’s their country and they got a right <span class="keep-together">to run it like they want to.</span></p><div class="attribution"><span>—<span class="attribution">Will Rogers</span></span></div></div><p><a id="Internationalization_id402602"></a><a id="index-715I800GE1G" class="indexterm"></a><a id="index-710F276RG6J" class="indexterm"></a>Telephony is one of those areas of life where, whether at home
  or at work, people do not like surprises. When people use phones, anything
  outside of the norm is an expectation not met, and as someone who is
  probably in the business of supplying telephone systems, you will know that
  expectations going unmet can lead to untold misery in terms of the extra
  work, lost money, and so forth that are associated with customer
  dissatisfaction.</p><p><a id="Internationalization_id339545"></a>In addition to ensuring that the
  user experience is in keeping with what users expect, there is also the need
  to make your Asterisk feel “at home.” For example, if an outbound call is
  placed over an analog line (FXO), Asterisk will need to interpret the tones
  that it “hears” on the line (busy, ringing, etc.).</p><p><a id="Internationalization_id326360"></a>By default <a id="I_indexterm9_d1e18734" class="indexterm"></a>(and maybe as one might expect since it was “born in the
  USA”), Asterisk is configured to work within North America. However, since
  Asterisk gets deployed in many places and (thankfully) people from all over
  the world make contributions to it, it is quite possible to tune Asterisk
  for correct operation just about anywhere you choose to deploy it.</p><p><a id="Internationalization_id346172"></a>If you have been reading this book
  from the beginning, chapter by chapter, you will have already made some
  choices during the process of installation and initial configuration that
  will have set up your Asterisk to work in your local area (and live up to
  your customers’ expectations).</p><p>Quite a few of the chapters in this book contain information that will
  help you internationalize<sup>[<a id="id557363" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id557363" class="footnote">89</a>]</sup> or (perhaps more properly) localize your Asterisk
  implementation. The purpose of this chapter is to provide a single place
  where all aspects of the changes that need to be made to your Asterisk-based
  telephone system in this context can be referenced, discussed, and
  explained. The reason for using the phrase “Asterisk-based telephone system”
  rather than just “Asterisk” is that some of the changes will need to be made
  in other parts of the system (IP phones, ATAs, etc.), while other changes
  will be implemented within Asterisk and DAHDI configuration files.</p><p><a id="Internationalization_id316187"></a>Let’s start by getting a list
  together (in no particular order) of the things that may need to be changed
  in order to optimise your Asterisk-based telephone system for a given
  location outside of North America. You can shout some out if you
  like…</p><div class="itemizedlist"><a id="Internationalization_id346806"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Internationalization_id312238"></a><a id="Internationalization_id317754"></a>Language/accent of the
      prompts</p></li><li class="listitem"><p><a id="Internationalization_id342412"></a><a id="Internationalization_id311742"></a>Physical connectorization for
      PSTN interfaces (FXO, BRI, PRI)</p></li><li class="listitem"><p><a id="Internationalization_id311681"></a><a id="Internationalization_id304754"></a>Tones heard by users of IP
      phones and/or ATAs</p></li><li class="listitem"><p><a id="Internationalization_id310525"></a><a id="Internationalization_id345392"></a>Caller ID format sent and/or
      received by analog interfaces</p></li><li class="listitem"><p><a id="Internationalization_id313608"></a><a id="Internationalization_id313610"></a>Tones for analog interfaces to
      be supplied or detected by Asterisk</p></li><li class="listitem"><p><a id="Internationalization_id315660"></a><a id="Internationalization_id336618"></a>Format of time/date stamps for
      voicemail</p></li><li class="listitem"><p><a id="Internationalization_id336622"></a><a id="Internationalization_id336624"></a>The way the above time/date
      stamps are announced by Asterisk</p></li><li class="listitem"><p><a id="Internationalization_id336628"></a><a id="Internationalization_id336631"></a>Patterns within the dialplan
      (of IP phones, ATAs, and Asterisk itself if you are using the sample
      dialplan)</p></li><li class="listitem"><p><a id="Internationalization_id336636"></a><a id="Internationalization_id336638"></a>The way to indicate to an
      analog device that voicemail is waiting (MWI)</p></li><li class="listitem"><p>Tones supplied to callers by Asterisk (these come into play once a
      user is “inside” the system; e.g., the tones heard during a call
      transfer)</p></li></ul></div><p><a id="Internationalization_id329603"></a>We’ll cover everything in this
  list, adopting a strategy of working from the outer edge of the system
  toward the very core (Asterisk itself). We will conclude with a handy
  checklist of what you may need to change and where to change it.</p><p><a id="Internationalization_id329609"></a>Although the principles discussed
  in this chapter will allow you to adapt your Asterisk specifically for your
  region (or that of your customer), for the sake of consistency all of our
  examples will focus on how to adapt Asterisk for one region: the United
  Kingdom.</p><div class="sect1" title="Devices External to the Asterisk Server"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Internationalization_id412919"></a>Devices External to the Asterisk Server</h2></div></div></div><p><a id="Internationalization_id402272"></a><a id="index-205S560QP4B" class="indexterm"></a><a id="index-353D822CO4J" class="indexterm"></a><a id="index-636O576VL8U" class="indexterm"></a><a id="index-553U820LC2K" class="indexterm"></a>There are massive differences between a good old fashioned
    analog telephone and any one of the large number of IP phones out there,
    and we need to pick up on one of the really fundamental differences in
    order to throw light on the next explanation, which covers the settings we
    might need to change on devices external to Asterisk, such as IP
    phones.</p><p><a id="Internationalization_id329633"></a>Have you ever considered the fact
    that an analog phone <a id="I_indexterm9_d1e18828" class="indexterm"></a>is a totally dumb device (we know that a basic model is
    very, very cheap) that needs to connect to an intelligent network (the
    PSTN), whereas an IP phone (e.g., SIP or IAX2) is a very intelligent
    device that connects to a dumb network (the Internet, or any regular IP
    network)? Figures <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#smart_network" title="Figure 9.1. The old days: dumb devices connect to a smart network">9.1</a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dumb_network" title="Figure 9.2. The situation today: smart devices connect through a dumb network">9.2</a> illustrate the difference.</p><div class="figure-float"><div class="figure"><a id="smart_network"></a><p class="title"><strong>Figure&nbsp;9.1.&nbsp;The old days: dumb devices connect to a smart network</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e18841"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0901.png" alt="The old days: dumb devices connect to a smart network"></div></div></div><br class="figure-break"></div><div class="figure-float"><div class="figure"><a id="dumb_network"></a><p class="title"><strong>Figure&nbsp;9.2.&nbsp;The situation today: smart devices connect through a dumb
      network</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e18849"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0902.png" alt="The situation today: smart devices connect through a dumb network"></div></div></div><br class="figure-break"></div><p><a id="Internationalization_id329639"></a>Could we take two analog phones,
    connect them directly to each other and have the functionality we would
    normally associate with a regular phone? No, of course not, because the
    network supplies everything: the actual power to the phone, the dialtone
    (from the local exchange or CO), the caller ID information, the ringing
    tone (from the remote [closest to the destination phone] exchange or CO),
    all the signaling required, and so on.</p><p><a id="Internationalization_id329646"></a>Conversely, could we take two IP
    phones, <a id="I_indexterm9_d1e18858" class="indexterm"></a>connect them directly to each other, and get some sensible
    functionality? Sure we could, because all the intelligence is inside the
    IP phones themselves—they provide the tones we hear (dialtone, ringing,
    busy) and run the protocol that does all the required signaling (usually
    SIP). In fact, you can try this for yourself—most mid-price IP phones have
    a built-in Ethernet switch, so you can actually connect the two IP phones
    directly to each other with a regular (straight-through) Ethernet patch
    cable, or just connect them through a regular switch. They will need to
    have fixed IP addresses in the absence of a DHCP server, and you can
    usually dial the IP address of the other phone just by using the
    <code class="literal">*</code> key for the dots in <span class="keep-together">the
    address</span>.</p><p><a id="Internationalization_id308136"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dumb_network" title="Figure 9.2. The situation today: smart devices connect through a dumb network">Figure&nbsp;9.2, “The situation today: smart devices connect through a dumb
      network”</a>
    points to the fact that on an IP phone, we are responsible for setting all
    of the tones that the network would have provided in the old days. This
    can be done in one of (at least) two ways. The first is to configure the
    tones provided by the IP phone on the device’s own web GUI. This is done
    by browsing to the IP address of the phone (the IP address can usually be
    obtained by a menu option on the phone) and then selecting the appropriate
    options. For example, on a Yealink IP phone, the tones are set on the
    <code class="filename">Phone</code> page of the web GUI, under the
    <code class="filename">Tones</code> tab (where you’ll find a list of the different
    types of tone that can be changed—in the case of the Yealink, these are
    Dial, Ring Back, Busy, Congestion, Call Waiting, Dial Recall, Record,
    Info, Stutter, Message, and Auto Answer).</p><p><a id="Internationalization_id308150"></a>The other way that this
    configuration <a id="I_indexterm9_d1e18881" class="indexterm"></a>can be applied is to auto-provision the phone with these
    settings. A full explanation of the mechanism for auto-provisioning is
    beyond the scope of this book, but you can usually set up the tones in the
    appropriate attributes of the relevant elements in the XML file.</p><p><a id="Internationalization_id308161"></a>While we are changing settings on
    the IP phones, there are two other things that may need to be changed in
    order for the phones to look right and to function correctly as part of
    the system.</p><p><a id="Internationalization_id308166"></a>Most phones display the time when
    idle and, since many people find it particularly annoying when their
    phones show the wrong time, we need to ensure that the correct local time
    is displayed. It should be fairly easy to find the appropriate page of the
    web GUI (or XML attributes) to specify the time server. You will also find
    that there are settings for daylight saving time and other relevant stuff
    nearby.</p><p><a id="Internationalization_id330560"></a>The last thing to change is a
    potential show-stopper as far as the making of a phone call is
    concerned—the dialplan. We’re not talking about the dialplan we find in
    <code class="filename">/etc/asterisk/extensions.conf</code>, but the dialplan of
    the phone. Not everyone realizes that IP phones have dialplans
    too—although these dialplans are more concerned with which dial strings
    are permitted than with what to do on a given dial.</p><p><a id="Internationalization_id330570"></a>The general rule seems to be that
    if you dial on-hook the built-in dialplan is bypassed, but if you pick up
    the handset the dialplan comes into play, and it just might happen that
    the dialplan will not allow the dial string you need to be dialed.
    Although this problem can manifest itself with a refusal by the phone to
    pass certain types of numbers through to Asterisk, it can also affect any
    feature codes you plan to use. This can easily be remedied by Googling the
    model number of the phone along with “UK dialplan” (or the particular
    region you need), or you can go to the appropriate page on the web GUI and
    either manually adjust the dialplan or pick the country you need from a
    drop-down box (depending on the type of phone you are working
    with).</p><p><a id="Internationalization_id330580"></a>The prior discussion of IP phone
    configuration also applies to any analog telephone adaptors
    (ATAs)<a id="I_indexterm9_d1e18902" class="indexterm"></a> you plan to use—specifically, to those supporting an FXS
    interface. In addition, you may need to specify some of the electrical
    characteristics of the telephony interface, like line voltage and
    impedance, together with the caller ID format that will work with local
    phones. All that differs is the way you obtain the IP address for the web
    GUI—this is usually done by dialing a specific code on the attached analog
    phone, which results in the IP address being read back to the
    caller.</p><p><a id="Internationalization_id330597"></a>Of course, an ATA may also
    feature an FXO interface, which will also need to be configured to
    properly interact with the analog line provided in your region. The types
    of things that need to be changed are similar to the FXS interface.</p><p><a id="Internationalization_id330602"></a>What if you are connecting your
    analog phone or line to a Digium card? We’ll cover this next.<a id="I_indexterm9_d1e18912" class="indexterm"></a><a id="I_indexterm9_d1e18913" class="indexterm"></a><a id="I_indexterm9_d1e18914" class="indexterm"></a><a id="I_indexterm9_d1e18915" class="indexterm"></a></p></div><div class="sect1" title="PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Internationalization_id397307"></a>PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</h2></div></div></div><p><a id="Internationalization_id386081"></a><a id="index-030A288MK6L" class="indexterm"></a><a id="index-718B444VG7P" class="indexterm"></a><a id="index-015F225OD0N" class="indexterm"></a><a id="index-357L363BF4J" class="indexterm"></a><a id="index-336F604MT6H" class="indexterm"></a>Before we get to DAHDI and Asterisk configuration, we need
    to physically connect to the PSTN. Unfortunately, there are no worldwide
    standards for these connections; in fact, there are often variations from
    one part of a given country to another.</p><p><a id="Internationalization_id332492"></a>PRI connections <a id="I_indexterm9_d1e18948" class="indexterm"></a>are generally terminated in an RJ45 connection <a id="I_indexterm9_d1e18952" class="indexterm"></a>these days, although the impedance of the connections can
    vary. In some countries (notably in South America), it is still possible
    to find PRIs terminated in two BNC connectors, one for transmit and one
    for receive.</p><p><a id="Internationalization_id332498"></a>Generally speaking, a PRI
    terminated in an RJ45 will be an ISDN connection, and if you find the
    connection is made by a pair of BNC connectors (push-and-twist coaxial
    connectors), the likelihood is that you are dealing with a CAS-based
    protocol (like R2).</p><p><a id="Internationalization_id332504"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#balun-connection" title="Figure 9.3. A balun">Figure&nbsp;9.3, “A balun”</a> shows the adaptor required if your telco has
    supplied BNC connectors (the Digium cards require an RJ45 connection). It
    is called a <span class="emphasis"><em>balun</em></span>, as it converts from a balanced
    connection (RJ45) to an unbalanced connection (the BNCs), in addition to
    changing the connection impedance.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="I_indexterm9_d1e18966" class="indexterm"></a><a id="I_indexterm9_d1e18969" class="indexterm"></a>Basic Rate Interfaces (BRIs) are common in continental
      Europe and are almost always supplied via an RJ45 connection.</p></div><div class="figure-float"><div class="figure"><a id="balun-connection"></a><p class="title"><strong>Figure&nbsp;9.3.&nbsp;A balun</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e18976"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0903.png" alt="A balun"></div></div></div><br class="figure-break"></div><p><a id="Internationalization_id332540"></a>Analog connections vary massively
    from place to place—you will know what kind of connector is used in your
    locality. The important thing to remember is that the analog line is only
    two wires, and these need to connect to the middle two pins of the RJ11
    plug that goes into the Digium card—<a id="I_indexterm9_d1e18983" class="indexterm"></a>the other end is the local one. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#bt-plug-diagram" title="Figure 9.4. The BT plug used for analog PSTN connections in the UK (note only pins 2–5 are present)">Figure&nbsp;9.4, “The BT plug used for analog PSTN connections in the UK (note only
      pins 2–5 are present)”</a> shows the plug used in the UK, where the two
    wires are connected to pins 2 and 5.</p><div class="figure-float"><div class="figure"><a id="bt-plug-diagram"></a><p class="title"><strong>Figure&nbsp;9.4.&nbsp;The BT plug used for analog PSTN connections in the UK (note only
      pins 2–5 are present)</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e18994"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0904.png" alt="The BT plug used for analog PSTN connections in the UK (note only pins 2–5 are present)"></div></div></div><br class="figure-break"></div><p><a id="Internationalization_id336661"></a>The Digium Asterisk Hardware
    Device Interface, or DAHDI, actually covers a number of things. It
    contains the kernel drivers for telephony adaptor cards that work within
    the DAHDI framework, as well as automatic configuration utilities and test
    tools. These parts are contained in two separate packages
    (<code class="filename">dahdi-linux</code> and <code class="filename">dahdi-tools</code>),
    but we can also use one complete package, called
    <code class="filename">dahdi-linux-complete</code>. All three packages are
    available at <a class="ulink" href="http://downloads.digium.com/pub/telephony/" target="_top">http://downloads.digium.com/pub/telephony/</a>. The
    installation of DAHDI was covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>.</p><p><a id="Internationalization_id336683"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a> covered the use of analog and digital
    PSTN connections, and we will not reiterate those details here. If you are
    using digital PSTN connections, your job is to find out what sort of
    connection the telco is giving you. Generally, if you have requested a
    primary rate interface (PRI), this will be a T1 in North America, a J1 in
    Japan, or an E1 in pretty much the rest of the world.</p><p><a id="Internationalization_id336694"></a>Once you have established the
    type of PRI connection the telco has given you, there are some further
    details that you will require in order to properly configure DAHDI and
    Asterisk (e.g., whether the connection is ISDN or a CAS-based protocol).
    Again, you will find these in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p><div class="sect2" title="DAHDI Drivers"><div class="titlepage"><div><div><h3 class="title"><a id="Internationalization_id336705"></a>DAHDI Drivers</h3></div></div></div><p><a id="Internationalization_id336711"></a><a id="I_indexterm9_d1e19026" class="indexterm"></a>The connections where some real localization will need to
      take place are those of analog interfaces. For the purposes of
      configuring your Asterisk-based telephone system to work best in a given
      locality, you will first need to specifically configure some low-level
      aspects of the way the Digium card interacts with the connected device
      or line. This is done through the DAHDI kernel driver(s), in a file
      called <code class="filename">/etc/dahdi/system.conf</code>.</p><p><a id="Internationalization_id336721"></a>In the following lines (taken
      from the sample configuration that you get with a fresh install of
      DAHDI), you will find both the <code class="literal">loadzone</code> and
      <code class="literal">defaultzone</code> settings. The
      <code class="literal">loadzone</code><a id="I_indexterm9_d1e19045" class="indexterm"></a> setting allows you to choose which tone set(s) the card
      will both generate (to feed to analog telephones) and recognize (on the
      connected analog telephone lines):</p><p><a id="Internationalization_id305573"></a><a id="Internationalization_id305574"></a></p><pre class="programlisting"># Tone Zone Data
# ^^^^^^^^^^^^^^
# Finally, you can preload some tone zones, to prevent them from getting
# overwritten by other users (if you allow non-root users to open /dev/dahdi/*
# interfaces anyway). Also this means they won't have to be loaded at runtime.
# The format is "loadzone=&lt;zone&gt;" where the zone is a two letter country code.
#
# You may also specify a default zone with "defaultzone=&lt;zone&gt;" where zone
# is a two letter country code.
#
# An up-to-date list of the zones can be found in the file zonedata.c
#
loadzone = us
#loadzone = us-old
#loadzone=gr
#loadzone=it
#loadzone=fr
#loadzone=de
#loadzone=uk
#loadzone=fi
#loadzone=jp
#loadzone=sp
#loadzone=no
#loadzone=hu
#loadzone=lt
#loadzone=pl
defaultzone=us
#</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Internationalization_id336729"></a>The
          <code class="filename">/etc/dahdi/system.conf</code> file uses the hash
          symbol (<code class="literal">#</code>) <a id="I_indexterm9_d1e19061" class="indexterm"></a><a id="I_indexterm9_d1e19066" class="indexterm"></a>to indicate a comment instead of a semicolon
          (<code class="literal">;</code>) like the files in
          <code class="filename">/etc/asterisk/</code>.</p></div><p>Although it is possible to load a number of different tone sets
      (you can see all the sets of tones in detail in
      <code class="filename">zonedata.c</code>) and to switch between them, in most
      practical situations you will only need:</p><a id="Internationalization_id305598"></a><pre class="programlisting">loadzone=uk     # to load the tone set
defaultzone=uk  # to default DAHDI to using that set</pre><p><a id="Internationalization_id305602"></a>…or whichever tones you need
      for your region.</p><p><a id="Internationalization_id305605"></a>If you perform a
      <span class="command"><strong>dahdi_genconf</strong></span><a id="I_indexterm9_d1e19090" class="indexterm"></a><a id="I_indexterm9_d1e19093" class="indexterm"></a> to automatically (or should that be auto-magically?)
      configure your DAHDI adaptors, you will notice that the newly generated
      <code class="filename">/etc/dahdi/system.conf</code> will have defaulted both
      <code class="literal">loadzone</code> and <code class="literal">defaultzone</code> to being
      <code class="literal">us</code>. Despite the warnings not to hand-edit the file,
      it is fine to change these settings to what you need.</p><p><a id="Internationalization_id305628"></a>In case you were wondering how
      we tell whether there are any voicemails in the mailbox associated with
      the channel an analog phone is plugged into, it is done with a stuttered
      dialtone. The format of this stuttered dialtone is decided by the
      <code class="literal">loadzone</code>/<code class="literal">defaultzone</code> combination
      you have used.</p><p><a id="Internationalization_id305640"></a>As a quick aside, analog phones
      that have a message waiting indicator (e.g., an LED or lamp that flashes
      to indicate there is new voicemail) achieve this by automatically going
      off-hook periodically and <span class="emphasis"><em>listening</em></span> for the
      stuttered dialtone. You can witness this by watching the Asterisk
      command line to see the DAHDI channel go active (if you have nothing
      better to do!).</p><p><a id="Internationalization_id305650"></a>That’s it at the DAHDI level.
      We chose the protocol(s) for PRI or BRI connections, the type of
      signaling for the analog channels (all covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>), and the tones for the analog
      connections that have just been discussed.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Internationalization_id305663"></a>Once you have completed your
        configuration at the DAHDI level (in
        <code class="filename">/etc/dahdi/system.conf</code>), you need to perform a
        <span class="command"><strong>dahdi_cfg -vvv</strong></span><a id="I_indexterm9_d1e19137" class="indexterm"></a><a id="I_indexterm9_d1e19140" class="indexterm"></a> to have DAHDI reread the configuration. This is also a
        good time to use <span class="command"><strong>dahdi_tool</strong></span><a id="I_indexterm9_d1e19148" class="indexterm"></a><a id="I_indexterm9_d1e19151" class="indexterm"></a> to check that everything appears to be in order at the
        Linux level.</p><p><a id="Internationalization_id305679"></a>This way, if things do not
        work properly after you have configured <span class="keep-together">Asterisk</span> to work with the DAHDI
        adaptors, you can be sure that the problem is confined to
        <code class="filename">chan_dahdi.conf</code> (or an <code class="filename">#included
        dahdi-channels.conf</code> if you are using this part of the
        <span class="command"><strong>dahdi_genconf</strong></span><a id="I_indexterm9_d1e19170" class="indexterm"></a><a id="I_indexterm9_d1e19173" class="indexterm"></a> output).</p></div><p><a id="Internationalization_id305695"></a>The relationship between Linux,
      DAHDI, and Asterisk (and therefore
      <code class="filename">/etc/dahdi/system.conf</code> and
      <code class="filename">/etc/asterisk/chan_dahdi.conf</code>) is shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-dahdi-relationship" title="Figure 9.5. The relationship between Linux, DAHDI, and Asterisk">Figure&nbsp;9.5, “The relationship between Linux, DAHDI, and Asterisk”</a>.<a id="I_indexterm9_d1e19191" class="indexterm"></a><a id="I_indexterm9_d1e19192" class="indexterm"></a><a id="I_indexterm9_d1e19193" class="indexterm"></a><a id="I_indexterm9_d1e19194" class="indexterm"></a><a id="I_indexterm9_d1e19196" class="indexterm"></a></p><div class="figure-float"><div class="figure"><a id="asterisk-dahdi-relationship"></a><p class="title"><strong>Figure&nbsp;9.5.&nbsp;The relationship between Linux, DAHDI, and Asterisk</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject9_d1e19200"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_0905.png" width="405" alt="The relationship between Linux, DAHDI, and Asterisk"></div></div></div><br class="figure-break"></div></div></div><div class="sect1" title="Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Internationalization_id373863"></a>Asterisk</h2></div></div></div><p><a id="Internationalization_id305742"></a><a id="index-250D537KP5N" class="indexterm"></a>With everything set at the Linux level, we now only need to
    configure Asterisk to make use of the channels we just enabled at the
    Linux level and to customize the way that Asterisk interprets and
    generates information that comes in from, or goes out over, these
    channels. This work is done in
    <code class="filename">/etc/asterisk/chan_dahdi.conf</code>.</p><p><a id="Internationalization_id305752"></a>In this file we will not only
    tell Asterisk what sort of channels we have (these settings will fit with
    what we already did in DAHDI), but also configure a number of things that
    will ensure Asterisk is well suited to its new home.</p><div class="sect2" title="Caller ID"><div class="titlepage"><div><div><h3 class="title"><a id="Internationalization_id305757"></a>Caller ID</h3></div></div></div><p><a id="Internationalization_id305762"></a><a id="I_indexterm9_d1e19224" class="indexterm"></a><a id="I_indexterm9_d1e19231" class="indexterm"></a>A key component of this change is caller ID. While caller
      ID delivery methods are pretty much standard within the BRI and PRI
      world, they vary widely in the analog world; thus, if you plugged an
      American analog phone into the UK telephone network, it would actually
      work as a phone, but caller ID information would not be displayed. This
      is because that information is transmitted in different ways in
      different places around the world, and an American phone would be
      looking for caller ID signaling in the US format, while the UK telephone
      network would be supplying it (if it is <span class="keep-together">enabled—</span>it is not standard in the UK; you
      have to pay for caller ID!) in the UK format.</p><p><a id="Internationalization_id305778"></a>Not only is the format
      different, but the method of telling a telephone (or Asterisk) to look
      out for the caller ID may vary from place to place too. This is
      important, as we do not want Asterisk to waste time looking for caller
      ID information if it is not being presented on the line.</p><p><a id="Internationalization_id305784"></a>Again, Asterisk defaults to the
      North American caller ID format (no entries in
      <code class="filename">/etc/asterisk/chan_dahdi.conf</code> describe this, it’s
      just the default), and in order to change it we will need to make some
      entries that describe the technical details of the caller ID system. In
      the case of the UK, the delivery of caller ID information is signaled by
      a polarity reversal on the telephone line (in other words, the A and B
      legs of the pair of telephone wires are temporarily switched over), and
      the actual caller ID information is delivered in a format known as V.23
      (frequency shift keying, or FSK). So, the entries in
      <code class="filename">chan_dahdi.conf</code> to receive UK-style caller ID on
      any FXO interfaces will look like this:</p><a id="Internationalization_id305800"></a><pre class="programlisting">cidstart=<em class="replaceable"><code>polarity</code></em>   ; the delivery of caller ID will be 
                    ; signaled by a polarity reversal
cidsignalling=<em class="replaceable"><code>v23</code></em>   ; the delivery of the called ID information 
                    ; will be in V23 format</pre><p><a id="Internationalization_id305812"></a>Of course, you may also need to
      send caller ID using the same local signaling information to any analog
      phones that are connected to FXS interfaces, and one more entry may be
      needed as in some locations the caller ID information is sent after a
      specified number of rings. If this is the case, you can use this
      entry:</p><a id="Internationalization_id305818"></a><pre class="programlisting">sendcalleridafter=2</pre><p><a id="Internationalization_id305821"></a>Before you can make these
      entries, you will need to establish the details of your local caller ID
      system (someone from your local telco or Google could be your friend
      here, but there is also some good information in the sample
      <code class="filename">/etc/asterisk/chan_dahdi.conf</code> file).</p></div><div class="sect2" title="Language and/or Accent of Prompts"><div class="titlepage"><div><div><h3 class="title"><a id="Internationalization_id305831"></a>Language and/or Accent of Prompts</h3></div></div></div><p><a id="Internationalization_id332109"></a><a id="I_indexterm9_d1e19271" class="indexterm"></a><a id="I_indexterm9_d1e19278" class="indexterm"></a><a id="I_indexterm9_d1e19281" class="indexterm"></a>As you may know, the prompts (or recordings) that Asterisk
      will use are stored in <code class="filename">/var/lib/asterisk/sounds/</code>.
      In older versions of Asterisk all the sounds were in this actual
      directory, but these days you will find a number of subdirectories that
      allow the use of different languages or accents. The names of these
      subdirectories are arbitrary; you can call them whatever you
      want.</p><p><a id="Internationalization_id332118"></a>Note that the filenames in
      these directories must be what Asterisk is expecting—for example, in
      <code class="filename">/var/lib/asterisk/sound/en/</code> the file
      <code class="filename">hello.gsm</code> would contain the word “Hello” (spoken by
      the lovely Allison), whereas <code class="filename">hello.gsm</code> in
      <code class="filename">/var/lib/asterisk/sounds/es/</code> (for Spanish in this
      case) would contain the word “Hola” (spoken by the Spanish equivalent of
      the lovely Allison<sup>[<a id="id559311" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id559311" class="footnote">90</a>]</sup>).</p><p><a id="Internationalization_id332158"></a>The default directory used is
      <code class="filename">/var/lib/asterisk/sounds/en</code>, so how do you change
      that?</p><p><a id="Internationalization_id332166"></a>There are two ways. One is to
      set the language in the channel configuration file that calls are
      arriving through using the <code class="literal">language</code> directive. For
      example, the line:</p><p><a id="Internationalization_id332174"></a>
        <a id="Internationalization_id332175"></a></p><pre class="programlisting">language=en_UK</pre><p>
      </p><p><a id="Internationalization_id332178"></a>placed in
      <code class="filename">chan_dahdi.conf</code>, <code class="filename">sip.conf</code>, and
      so on (to apply generally, or for just a given channel or profile) will
      tell Asterisk to use sound files found in
      <code class="filename">/var/lib/asterisk/sounds/en_UK</code> (which could contain
      British-accented prompts) for all calls that come in through those
      channels.</p><p><a id="Internationalization_id332194"></a>The other way is to change the
      language during a phone call through the dialplan. This (along with many
      attributes of an individual call) can be set using the
      <code class="literal">CHANNEL()</code> dialplan function.<a id="I_indexterm9_d1e19342" class="indexterm"></a><a id="I_indexterm9_d1e19345" class="indexterm"></a> See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper" title="Chapter 10. Deeper into the Dialplan">Chapter&nbsp;10, <em>Deeper into the Dialplan</em></a> for a full
      treatment of dialplan functions.</p><p><a id="Internationalization_id332208"></a>The following example would
      allow the caller to choose one of three languages in which to continue
      the call:</p><p><a id="Internationalization_id332212"></a><a id="Internationalization_id332213"></a></p><pre class="programlisting">; gives the choice of (1) French, (2) Spanish, or (3) German
exten =&gt; s,1,Background(choose-language)
   same =&gt; n,WaitExten(5)

exten =&gt; 1,1,Set(CHANNEL(language)=fr)

exten =&gt; 2,1,Set(CHANNEL(language)=es)

exten =&gt; 3,1,Set(CHANNEL(language)=de)

; the next priority for extensions 1, 2, or 3 would be handled here
exten =&gt; _[123],n,Goto(menu,s,1)</pre><p>If the caller pressed
      <code class="literal">1</code> sounds would be played from
      <code class="filename">/var/lib/asterisk/sounds/fr</code>, if he pressed
      <code class="literal">2</code> the sounds would come from
      <code class="filename">/var/lib/asterisk/sounds/es</code>, and so on.</p><p><a id="Internationalization_id332236"></a>As already mentioned, the names
      of these directories are arbitrary and do not need to be only two
      characters long—the main thing is that you match the name of the
      subdirectory you have created in the <code class="literal">language</code>
      directive in the channel configuration, or when you set the
      <code class="literal">CHANNEL(language)</code> argument in the dialplan.</p></div><div class="sect2" title="Time/Date Stamps and Pronunciation"><div class="titlepage"><div><div><h3 class="title"><a id="Internationalization_id332249"></a>Time/Date Stamps and Pronunciation</h3></div></div></div><p><a id="Internationalization_id332254"></a><a id="I_indexterm9_d1e19384" class="indexterm"></a><a id="I_indexterm9_d1e19391" class="indexterm"></a><a id="I_indexterm9_d1e19396" class="indexterm"></a>Asterisk uses the Linux system time from the host server,
      as you would expect, but we may have users of the system who are in
      different time zones, or even in different countries. Voicemail is where
      the rubber hits the road, as this is where users come into contact with
      time/date stamp information.</p><p><a id="Internationalization_id332260"></a>Consider a scenario where some
      users of the system are based in the US, while others are in the
      UK.</p><p><a id="Internationalization_id332265"></a>As well as the time difference,
      another thing to consider is the way people in the two locations are
      used to hearing date and time information—in the US, dates are usually
      ordered month, day, year and times are specified in 12-hour clock format
      (e.g., <span class="keep-together">2:54 P.M.</span>).</p><p><a id="Internationalization_id332270"></a>In contrast, in the UK, dates
      are ordered day, month, year and times are often specified in 24-hour
      clock format (14:54 hrs)—although some people in the UK prefer 12-hour
      clock format, so we will cover that too.</p><p><a id="Internationalization_id332276"></a>Since all these things are
      connected to voicemail, you would be right to guess that we configure it
      in <code class="filename">/etc/asterisk/voicemail.conf</code>—specifically, in
      the <code class="literal">[zonemessages]</code> section <a id="I_indexterm9_d1e19419" class="indexterm"></a><a id="I_indexterm9_d1e19422" class="indexterm"></a><a id="I_indexterm9_d1e19427" class="indexterm"></a>of the file.</p><p><a id="Internationalization_id332287"></a>Here is the
      <code class="literal">[zonemessages]</code> part of the sample
      <code class="filename">voicemail.conf</code> file that comes with Asterisk, with
      <code class="literal">UK24</code> (for UK people that like 24-hour clock format
      times) and <code class="literal">UK12</code> (for UK people that prefer 12-hour
      clock format) zones added:</p><a id="Internationalization_id332304"></a><pre class="programlisting">[zonemessages]
; Users may be located in different timezones, or may have different
; message announcements for their introductory message when they enter
; the voicemail system. Set the message and the timezone each user
; hears here. Set the user into one of these zones with the tz=attribute
; in the options field of the mailbox. Of course, language substitution
; still applies here so you may have several directory trees that have
; alternate language choices.
;
; Look in /usr/share/zoneinfo/ for names of timezones.
; Look at the manual page for strftime for a quick tutorial on how the
; variable substitution is done on the values below.
;
; Supported values:
; 'filename' filename of a soundfile (single ticks around the filename
; required)
; ${VAR} variable substitution
; A or a Day of week (Saturday, Sunday, ...)
; B or b or h Month name (January, February, ...)
; d or e numeric day of month (first, second, ... thirty-first)
; Y Year
; I or l Hour, 12 hour clock
; H Hour, 24 hour clock (single digit hours preceded by "oh")
; k Hour, 24 hour clock (single digit hours NOT preceded by "oh")
; M Minute, with 00 pronounced as "o'clock"
; N Minute, with 00 pronounced as "hundred" (US military time)
; P or p AM or PM
; Q "today", "yesterday" or ABdY
; (*note: not standard strftime value)
; q " (for today), "yesterday", weekday, or ABdY
; (*note: not standard strftime value)
; R 24 hour time, including minute
;
eastern=America/New_York|'vm-received' Q 'digits/at' IMp
central=America/Chicago|'vm-received' Q 'digits/at' IMp
central24=America/Chicago|'vm-received' q 'digits/at' H N 'hours'
military=Zulu|'vm-received' q 'digits/at' H N 'hours' 'phonetic/z_p'
european=Europe/Copenhagen|'vm-received' a d b 'digits/at' HM
    
UK24=Europe/London|'vm-received' q 'digits/at' H N 'hours'
UK12=Europe/London|'vm-received' Q 'digits/at' IMp    </pre><p><a id="Internationalization_id332323"></a>These zones not only specify a
      time, but also dictate the way times and dates are ordered and read
      out.</p><p><a id="Internationalization_id332327"></a>Having created these zones, we
      can go to the voicemail context part of
      <code class="filename">voicemail.conf</code> to associate the appropriate
      mailboxes with the correct zones:</p><a id="Internationalization_id332337"></a><pre class="programlisting">[default]
4001 =&gt; 1234,Russell Bryant,rb@shifteight.org,,|tz=central
4002 =&gt; 4444,David Duffett,dd@shifteight.org,,|tz=UK24
4003 =&gt; 4450,Mary Poppins,mp@shifteight.org,,|tz=UK12|attach=yes</pre><p><a id="Internationalization_id332342"></a>As you can see, when we declare
      a mailbox, we also (optionally) associate it with a particular zone.
      Full details on voicemail can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail" title="Chapter 8. Voicemail">Chapter&nbsp;8, <em>Voicemail</em></a>.</p><p><a id="Internationalization_id332353"></a>The last thing to localize in
      our Asterisk configuration is the tones played to callers by Asterisk
      once they are inside the system (e.g., the tones a caller hears during a
      transfer).</p><p><a id="Internationalization_id332358"></a>As identified earlier in this
      chapter, the initial tones that people hear when they are calling into
      the system will come from the IP phone, or from DAHDI for analog <span class="keep-together">channels</span>.</p><p><a id="Internationalization_id332362"></a>These tones are set in
      <code class="filename">/etc/asterisk/indications.conf</code>. Here is a part of
      the sample file, where you can see a given region specified by the
      <code class="literal">country</code> directive. We just need to change the country
      code as appropriate:</p><a id="Internationalization_id332377"></a><pre class="programlisting">;
; indications.conf
;
; Configuration file for location specific tone indications
;
; NOTE:
; When adding countries to this file, please keep them in alphabetical
; order according to the 2-character country codes!
;
; The [general] category is for certain global variables.
; All other categories are interpreted as location specific indications
;
[general]
country=uk   ; default is US, so we have changed it to UK</pre><p><a id="Internationalization_id332392"></a>Your dialplan will need to
      reflect the numbering scheme for your region. If you do not already know
      the scheme for your area, your local telecoms regulator will usually be
      able to supply details of the plan. Also, the example dialplan in
      <code class="filename">/etc/asterisk/extensions.conf</code> is, of course, packed
      with North American numbers and patterns.<a id="I_indexterm9_d1e19485" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion—Easy Reference Cheat Sheet"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Internationalization_id384018"></a>Conclusion—Easy Reference Cheat Sheet</h2></div></div></div><p><a id="Internationalization_id379054"></a><a id="I_indexterm9_d1e19491" class="indexterm"></a>As you can now see, there are quite a few things to change
    in order to fully localize your Asterisk-based telephone system, and not
    all of them are in the Asterisk, or even DAHDI, configuration—some things
    need to be changed on the connected IP phones or ATAs themselves.</p><p><a id="Internationalization_id332417"></a>Before we leave the chapter, have
    a look at <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#internationalization_cheat" title="Table 9.1. Internationalization cheat sheet">Table&nbsp;9.1, “Internationalization cheat sheet”</a>: a
    cheat sheet for what to change and where to change it, for your future
    reference.</p><div class="table"><a id="internationalization_cheat"></a><p class="title"><strong>Table&nbsp;9.1.&nbsp;Internationalization cheat sheet</strong></p><div class="table-contents"><table summary="Internationalization cheat sheet" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">What to change</th><th align="center">Where to change it</th></tr></thead><tbody><tr><td>Call progress tones</td><td>
              <div class="itemizedlist"><a id="Internationalization_id332457"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Internationalization_id332459"></a><a id="Internationalization_id332461"></a><a id="I_indexterm9_d1e19519" class="indexterm"></a>IP phones—on the phone itself</p></li><li class="listitem"><p><a id="Internationalization_id332465"></a><a id="Internationalization_id332467"></a>ATAs—on the ATA
                  itself</p></li><li class="listitem"><p><a id="Internationalization_id332472"></a><a id="Internationalization_id332474"></a>Analog phones—DAHDI
                  (<code class="filename">/etc/dahdi/system.conf</code>)</p></li></ul></div>
            </td></tr><tr><td>Type of PRI/BRI <a id="I_indexterm9_d1e19535" class="indexterm"></a>and <span class="keep-together">protocol</span></td><td>DAHDI—<code class="filename">/etc/dahdi/system.conf</code> and
            <code class="filename">/etc/asterisk/chan_dahdi.conf</code></td></tr><tr><td>Physical PSTN connections</td><td>
              <div class="itemizedlist"><a id="Internationalization_id337372"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Internationalization_id337374"></a><a id="Internationalization_id337376"></a><a id="I_indexterm9_d1e19555" class="indexterm"></a>Balun if required for PRI</p></li><li class="listitem"><p><a id="Internationalization_id337381"></a><a id="Internationalization_id337383"></a>Get the analog pair
                  to middle 2 pins of the RJ11 connecting to the Digium
                  card</p></li></ul></div>
            </td></tr><tr><td>Caller ID <a id="I_indexterm9_d1e19567" class="indexterm"></a><a id="I_indexterm9_d1e19572" class="indexterm"></a>on analog circuits</td><td>Asterisk—<code class="filename">/etc/asterisk/chan_dahdi.conf</code></td></tr><tr><td>Prompt language <a id="I_indexterm9_d1e19585" class="indexterm"></a>and/or accent</td><td>
              <div class="itemizedlist"><a id="Internationalization_id337410"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Internationalization_id337412"></a><a id="Internationalization_id337414"></a>Channel—<code class="filename">/etc/asterisk/sip.conf</code>,
                  <code class="filename">/etc/asterisk/iax.conf</code>,
                  <code class="filename">/etc/asterisk/chan_dahdi.conf</code>,
                  etc.</p></li><li class="listitem"><p><a id="Internationalization_id337434"></a><a id="Internationalization_id337436"></a>Dialplan—<code class="literal">CHANNEL(language)</code>
                  function</p></li></ul></div>
            </td></tr><tr><td>Voicemail time/date stamps <a id="I_indexterm9_d1e19614" class="indexterm"></a>and pronunciation</td><td><a id="I_indexterm9_d1e19621" class="indexterm"></a>Asterisk—<code class="filename">/etc/asterisk/voicemail.conf</code></td></tr><tr><td>Tones <a id="I_indexterm9_d1e19632" class="indexterm"></a>delivered by <span class="keep-together">Asterisk</span></td><td>Asterisk—<code class="filename">/etc/asterisk/indications.conf</code></td></tr></tbody></table></div></div><br class="table-break"><p>May all your Asterisk deployments feel at home…<a id="I_indexterm9_d1e19644" class="indexterm"></a><a id="I_indexterm9_d1e19645" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id557363" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id557363" class="para">89</a>] </sup><span class="emphasis"><em>i18n</em></span><a id="I_indexterm9_d1e18749" class="indexterm"></a> is a term used to abbreviate the word
      <span class="emphasis"><em>internationalization</em></span>, due to its length. The format
      is
      <span class="emphasis"><em>&lt;first_letter&gt;&lt;number&gt;&lt;last_letter&gt;</em></span>,
      where <span class="emphasis"><em>&lt;number&gt;</em></span> is the number of letters
      between the first and last letters. Other words, such as localization
      (L10n), modularization (m12n), etc. have also found a home with this
      scheme, which Leif finds a little bit ridiculous. More information can
      be found here: <a class="ulink" href="http://www.w3.org/2001/12/Glossary#I18N" target="_top">http://www.w3.org/2001/12/Glossary#I18N</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id559311" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id559311" class="para">90</a>] </sup>Who is, in fact, the same Allison who does the English
          prompts; June Wallack does the French prompts.<a id="I_indexterm9_d1e19305" class="indexterm"></a> The male Australian-accented prompts are done by
          Cameron Twomey. All voiceover talent are available to record
          additional prompts as well. See <a class="ulink" href="http://www.digium.com/en/products/ivr/" target="_top">http://www.digium.com/en/products/ivr/</a> for more
          information.</p></div></div></div><div class="chapter" title="Chapter 10. Deeper into the Dialplan"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-DP-Deeper"></a>Chapter&nbsp;10.&nbsp;Deeper into the Dialplan</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1">Expressions and Variable Manipulation</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2">Dialplan Functions</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.1">Syntax</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.2">Examples of Dialplan Functions</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3">Conditional Branching</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5">Macros</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.1">Defining Macros</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub">GoSub()</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060368">Defining Subroutines</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060490">Calling Subroutines from the Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060548">Using Arguments in Subroutines</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.1">Storing Data in the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.2">Retrieving Data from the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7">Handy Asterisk Features</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-8">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="DeeperDialplan_id286010"></a>For a list of all the ways technology
    has failed to improve the quality of life, please press three.</p><div class="attribution"><span>—<span class="attribution">Alice Kahn</span></span></div></div><p><a id="DeeperDialplan_id258886"></a><a id="index-623G267GP8A" class="indexterm"></a><a id="index-624I105MQ1N" class="indexterm"></a>Alrighty. You’ve got the basics of dialplans down, but you
  know there’s more to come. If you don’t have <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics" title="Chapter 6. Dialplan Basics">Chapter&nbsp;6, <em>Dialplan Basics</em></a> sorted out yet, please go back and give it
  another read. We’re about to get into more advanced topics.</p><div class="sect1" title="Expressions and Variable Manipulation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-1"></a>Expressions and Variable Manipulation</h2></div></div></div><p><a id="DeeperDialplan_id244855"></a><a id="index-574T324II1F" class="indexterm"></a><a id="index-842B771VT7I" class="indexterm"></a>As we begin our dive into the deeper aspects of dialplans,
    it is time to introduce you to a few tools that will greatly add to the
    power you can exercise in your dialplan. These constructs add incredible
    intelligence to your dialplan by enabling it to make decisions based on
    different criteria you define. Put on your thinking cap, and let’s get
    started.</p><div class="sect2" title="Basic Expressions"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-1.1"></a>Basic Expressions</h3></div></div></div><p><a id="DeeperDialplan_id288814"></a><a id="I_indexterm10_d1e19683" class="indexterm"></a><a id="I_indexterm10_d1e19690" class="indexterm"></a>Expressions are combinations of variables, operators, and
      values that you string together to produce a result. An expression can
      test values, alter strings, or perform mathematical calculations. Let’s
      say we have a variable called <code class="literal">COUNT</code>.
      In plain English, two expressions using that variable might be “<code class="literal">COUNT</code> plus 1” and “<code class="literal">COUNT</code> divided by 2.” Each of these expressions
      has a particular result or value, depending on the value of the given
      variable.</p><p><a id="DeeperDialplan_id216496"></a>In Asterisk, expressions always begin
      with a dollar sign <a id="I_indexterm10_d1e19707" class="indexterm"></a>and a<a id="I_indexterm10_d1e19711" class="indexterm"></a>n opening square bracket and end with a closing square
      bracket, as shown here:</p><a id="I_programlisting6_tt840"></a><pre class="programlisting">$[<em class="replaceable"><code>expression</code></em>]</pre><p><a id="DeeperDialplan_id271160"></a>Thus, we would write our two examples
      like this:</p><a id="I_programlisting6_tt841"></a><pre class="programlisting">$[${COUNT} + 1]
$[${COUNT} / 2]</pre><p><a id="DeeperDialplan_id271171"></a>When Asterisk encounters an
      expression in a dialplan, it replaces the entire expression with the
      resulting value. It is important to note that this takes place
      <span class="emphasis"><em>after</em></span> variable substitution. To demonstrate, let’s
      look at the following code<sup>[<a id="asterisk-CHP-6-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-1" class="footnote">91</a>]</sup>:</p><a id="I_programlisting6_tt843"></a><pre class="programlisting">exten =&gt; 321,1,Set(COUNT=3)
    same =&gt; n,Set(NEWCOUNT=$[${COUNT} + 1])
    same =&gt; n,SayNumber(${NEWCOUNT})</pre><p><a id="DeeperDialplan_id271219"></a>In the first priority, we assign the
      value of <code class="literal">3</code> to the variable named
      <code class="literal">COUNT</code>.</p><p><a id="DeeperDialplan_id262154"></a>In the second priority, only one
      application—<code class="literal">Set()</code>—is involved, but
      three things actually happen:</p><div class="orderedlist"><a id="DeeperDialplan_id262175"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="DeeperDialplan_id262183"></a><a id="DeeperDialplan_id262186"></a>Asterisk substitutes <code class="literal">${COUNT}</code> with the number <code class="literal">3</code> in the expression. The expression
          effectively becomes this:</p><a id="I_programlisting6_tt845"></a><pre class="programlisting">exten =&gt; 321,n,Set(NEWCOUNT=$[3 + 1])</pre></li><li class="listitem"><p><a id="DeeperDialplan_id262210"></a><a id="DeeperDialplan_id262212"></a>Asterisk evaluates the
          expression, adding <code class="literal">1</code> to <code class="literal">3</code>, and replaces it with its computed value
          of <code class="literal">4</code>:</p><a id="I_programlisting6_tt846"></a><pre class="programlisting">exten =&gt; 321,n,Set(NEWCOUNT=4)</pre></li><li class="listitem"><p><a id="DeeperDialplan_id240789"></a><a id="DeeperDialplan_id240791"></a>The <code class="literal">Set()</code>
          application assigns the value <code class="literal">4</code>
          to the <code class="literal">NEWCOUNT</code> variable</p></li></ol></div><p><a id="DeeperDialplan_id240813"></a>The third priority simply invokes the
      <code class="literal">SayNumber()</code> application, which speaks
      the current value of the variable <code class="literal">${NEWCOUNT}</code> (set to the value <code class="literal">4</code> in priority two).</p><p><a id="DeeperDialplan_id240844"></a>Try it out in your own
      dialplan.</p></div><div class="sect2" title="Operators"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-1.2"></a>Operators</h3></div></div></div><p><a id="DeeperDialplan_id267458"></a><a id="I_indexterm10_d1e19812" class="indexterm"></a><a id="I_indexterm10_d1e19819" class="indexterm"></a><a id="I_indexterm10_d1e19824" class="indexterm"></a>When you create an Asterisk dialplan, you’re really
      writing code in a specialized scripting language. This means that the
      Asterisk <span class="keep-together">dialplan—</span>like any
      programming <span class="keep-together">language—</span>recognizes
      symbols called <span class="emphasis"><em>operators</em></span> that allow you to
      manipulate variables. Let’s look at the types of operators that are
      available in Asterisk:</p><div class="variablelist"><dl><dt><span class="term">
            <span class="emphasis"><em>Boolean operators</em></span>
          </span></dt><dd><p><a id="DeeperDialplan_id267490"></a><a id="DeeperDialplan_id267492"></a><a id="I_indexterm10_d1e19846" class="indexterm"></a>These operators evaluate the “truth” of a statement.
            In computing terms, that essentially refers to whether the
            statement is something or nothing (nonzero or zero, true or false,
            on or off, and so on). The Boolean operators are:</p><div class="variablelist"><dl><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">|</code>
                <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id267530"></a><a id="DeeperDialplan_id267532"></a>This operator (called the
                  “or” operator, or “pipe”) returns the evaluation of
                  <em class="replaceable"><code>expr1</code></em> if it is true (neither an
                  empty string nor zero). Otherwise, it returns the evaluation
                  of <em class="replaceable"><code>expr2</code></em>.</p></dd><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">&amp;</code>
                <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id267592"></a><a id="DeeperDialplan_id292200"></a>This operator (called
                  “and”) returns the evaluation of
                  <em class="replaceable"><code>expr1</code></em> if both expressions are
                  true (i.e., neither expression evaluates to an empty string
                  or zero). Otherwise, it returns zero.</p></dd><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">{=, &gt;, &gt;=, &lt;, &lt;=,
                !=}</code> <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id292268"></a><a id="DeeperDialplan_id292271"></a>These operators return
                  the results of an integer comparison if both arguments are
                  integers; otherwise, they return the results of a string
                  comparison. The result of each comparison is <code class="literal">1</code> if the specified relation is
                  true, or <code class="literal">0</code> if the
                  relation is false. (If you are doing string comparisons,
                  they will be done in a manner that’s consistent with the
                  current local settings of your operating system.)</p></dd></dl></div></dd><dt><span class="term">
            <span class="emphasis"><em>Mathematical operators</em></span>
          </span></dt><dd><p><a id="DeeperDialplan_id292399"></a><a id="DeeperDialplan_id292401"></a><a id="I_indexterm10_d1e19911" class="indexterm"></a>Want to perform a calculation? You’ll want one of
            these:</p><div class="variablelist"><dl><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">{+, -}</code>
                <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id292425"></a><a id="DeeperDialplan_id292427"></a>These operators return
                  the results of the addition or subtraction of integer-valued
                  arguments.</p></dd><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">{*, /, %}</code>
                <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id292491"></a><a id="DeeperDialplan_id292494"></a>These return,
                  respectively, the results of the multiplication, integer
                  division, or remainder of integer-valued arguments.</p></dd></dl></div></dd><dt><span class="term">
            <span class="emphasis"><em>Regular expression operator</em></span>
          </span></dt><dd><p><a id="DeeperDialplan_id292604"></a><a id="DeeperDialplan_id292606"></a><a id="I_indexterm10_d1e19948" class="indexterm"></a>You can also use the regular expression operator in
            Asterisk:</p><div class="variablelist"><dl><dt><span class="term"><em class="replaceable"><code>expr1</code></em> <code class="literal">:</code>
                <em class="replaceable"><code>expr2</code></em></span></dt><dd><p><a id="DeeperDialplan_id292628"></a><a id="DeeperDialplan_id292630"></a>This operator matches
                  <em class="replaceable"><code>expr1</code></em> against
                  <em class="replaceable"><code>expr2</code></em>, where
                  <em class="replaceable"><code>expr2</code></em> must be a regular
                  expression.<sup>[<a id="asterisk-CHP-6-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-2" class="footnote">92</a>]</sup> The regular expression is anchored to the
                  beginning of the string with an implicit <code class="literal">^</code>.<sup>[<a id="asterisk-CHP-6-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-3" class="footnote">93</a>]</sup></p><p><a id="DeeperDialplan_id292734"></a>If the match succeeds and
                  the pattern contains at least one regular expression
                  subexpression—<code class="literal">\(</code>
                  <em class="replaceable"><code>...</code></em> <code class="literal">\)</code>—the string corresponding to
                  <code class="literal">\1</code> is returned;
                  otherwise, the matching operator returns the number of
                  characters matched. If the match fails and the pattern
                  contains a regular expression subexpression, the null string
                  is returned; otherwise, <code class="literal">0</code>
                  is returned.</p></dd></dl></div></dd></dl></div><p><a id="DeeperDialplan_id292772"></a>In Asterisk version 1.0 the parser
      was quite simple, so it required that you put at least one space between
      the operator and any other values. Consequently, the following might not
      have worked as expected:</p><a id="I_programlisting6_tt880"></a><pre class="programlisting">exten =&gt; 123,1,Set(TEST=$[2+1])</pre><p><a id="DeeperDialplan_id292789"></a>This would have assigned the variable
      <code class="literal">TEST</code> to the string “2+1”, instead of
      the value <code class="literal">3</code>. In order to remedy that,
      we would put spaces around the operator, like so:</p><a id="I_programlisting6_tt881"></a><pre class="programlisting">exten =&gt; 234,1,Set(TEST=$[2 + 1])</pre><p><a id="DeeperDialplan_id292814"></a>This is no longer necessary in
      current versions of Asterisk, as the expression parser has been made
      more forgiving in these types of scenarios. However, for readability’s
      sake, we still recommend including the spaces around your
      operators.</p><p><a id="DeeperDialplan_id292821"></a>To concatenate <a id="I_indexterm10_d1e20035" class="indexterm"></a><a id="I_indexterm10_d1e20038" class="indexterm"></a>text onto the beginning or end of a variable, simply place
      them together, like this:<a id="I_indexterm10_d1e20044" class="indexterm"></a><a id="I_indexterm10_d1e20045" class="indexterm"></a></p><a id="I_programlisting6_tt883"></a><pre class="programlisting">exten =&gt; 234,1,Set(NEWTEST=blah${TEST})</pre></div></div><div class="sect1" title="Dialplan Functions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-2"></a>Dialplan Functions</h2></div></div></div><p><a id="DeeperDialplan_id292957"></a><a id="I_indexterm10_d1e20052" class="indexterm"></a><a id="I_indexterm10_d1e20057" class="indexterm"></a>Dialplan functions allow you to add more power to your
    expressions; you can think of them as intelligent variables. Dialplan
    functions allow you to calculate string lengths, dates and times, MD5
    checksums, and so on, all from within a dialplan expression.</p><div class="sect2" title="Syntax"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-2.1"></a>Syntax</h3></div></div></div><p><a id="DeeperDialplan_id292996"></a><a id="I_indexterm10_d1e20067" class="indexterm"></a>Dialplan functions have the following basic syntax:</p><a id="I_programlisting6_tt886"></a><pre class="programlisting"><em class="replaceable"><code>FUNCTION_NAME</code></em>(<em class="replaceable"><code>argument</code></em>)</pre><p><a id="DeeperDialplan_id293013"></a>You reference a function’s name the
      same way as a variable’s name, but you reference a function’s
      <span class="emphasis"><em>value</em></span> with the addition of a dollar sign, an
      opening curly brace, and a closing curly brace:</p><a id="I_programlisting6_tt891"></a><pre class="programlisting">${<em class="replaceable"><code>FUNCTION_NAME</code></em>(<em class="replaceable"><code>argument</code></em>)}</pre><p><a id="DeeperDialplan_id293089"></a>Functions can also encapsulate other
      functions, like so:</p><a id="I_programlisting6_tt892"></a><pre class="programlisting">${<em class="replaceable"><code>FUNCTION_NAME</code></em>(${<em class="replaceable"><code>FUNCTION_NAME</code></em>(<em class="replaceable"><code>argument</code></em>)})}
 ^             ^ ^             ^        ^^^^
 1             2 3             4        4321</pre><p><a id="DeeperDialplan_id293111"></a>As you’ve probably already figured
      out, you must be very careful about making sure you have matching
      parentheses and braces. In the preceding example, we have labeled the
      opening parentheses and curly braces with numbers and their
      corresponding closing counterparts with the same numbers.</p></div><div class="sect2" title="Examples of Dialplan Functions"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-2.2"></a>Examples of Dialplan Functions</h3></div></div></div><p><a id="DeeperDialplan_id293129"></a>Functions are often used in
      conjunction with the <code class="literal">Set()</code>
      application <a id="I_indexterm10_d1e20116" class="indexterm"></a><a id="I_indexterm10_d1e20119" class="indexterm"></a>to either get or set the value of a variable. As a simple
      example, let’s look at the <code class="literal">LEN()</code>
      function. This function calculates the string length of its argument.
      Let’s calculate the string length of a variable and read back the length
      to the caller:</p><a id="I_programlisting6_tt895"></a><pre class="programlisting">exten =&gt; 123,1,Set(TEST=example)
    same =&gt; n,SayNumber(${LEN(${TEST})})</pre><p><a id="DeeperDialplan_id293179"></a>This example will first evaluate
      <code class="literal">$TEST</code> as <code class="literal">example</code>. The string
      “example” is then given to the <code class="literal">LEN()</code> function, which
      will evaluate as the length of the string, <code class="literal">7</code>.
      Finally, <code class="literal">7</code> is passed as an argument to the <code class="literal">SayNumber()</code> application.</p><p><a id="DeeperDialplan_id293194"></a>Let’s look at another simple example.
      If we wanted to set one of the various channel timeouts, we could use
      the <code class="literal">TIMEOUT()</code> function. The <code class="literal">TIMEOUT()</code> function accepts one of three
      arguments: <code class="literal">absolute</code>, <code class="literal">digit</code>, and <code class="literal">response</code>. To set the digit timeout with the
      <code class="literal">TIMEOUT()</code> function, we could use the
      <code class="literal">Set()</code> application, like so:</p><a id="I_programlisting6_tt897"></a><pre class="programlisting">exten =&gt; s,1,Set(TIMEOUT(digit)=30)</pre><p><a id="DeeperDialplan_id293257"></a>Notice the lack of <code class="literal">${ }</code> surrounding the function. Just as if we
      were assigning a value to a variable, we assign a value to a function
      without the use of the <code class="literal">${ }</code>
      encapsulation.</p><p><a id="DeeperDialplan_id293272"></a>A complete list of available
      functions can be found by typing <span class="command"><strong>core show functions</strong></span>
      at the Asterisk command-line interface.</p></div></div><div class="sect1" title="Conditional Branching"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-3"></a>Conditional Branching</h2></div></div></div><p><a id="DeeperDialplan_id293292"></a><a id="index-874E052NM8J" class="indexterm"></a><a id="index-401U348OO0R" class="indexterm"></a><a id="index-374J762MO6C" class="indexterm"></a>Now that you’ve learned a bit about expressions and
    functions, it’s time to put them to use. By using expressions and
    functions, you can add even more advanced logic to your dialplan. To allow
    your dialplan to make decisions, you’ll use <span class="emphasis"><em>conditional
    branching</em></span>. Let’s take a closer look.</p><div class="sect2" title="The GotoIf() Application"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-3.1"></a>The GotoIf() Application</h3></div></div></div><p><a id="DeeperDialplan_id293326"></a><a id="I_indexterm10_d1e20215" class="indexterm"></a><a id="I_indexterm10_d1e20222" class="indexterm"></a><a id="I_indexterm10_d1e20227" class="indexterm"></a><a id="I_indexterm10_d1e20230" class="indexterm"></a><a id="I_indexterm10_d1e20235" class="indexterm"></a>The key to conditional branching is the <code class="literal">GotoIf()</code> application. <code class="literal">GotoIf()</code> evaluates an expression and sends the
      caller to a specific destination based on whether the expression
      evaluates to <code class="literal">true</code> or <code class="literal">false</code>.</p><p><a id="DeeperDialplan_id293363"></a><code class="literal">GotoIf()</code> uses a special syntax, often called
      the <span class="emphasis"><em>conditional syntax</em></span>:</p><a id="I_programlisting6_tt899"></a><pre class="programlisting">GotoIf(<em class="replaceable"><code>expression</code></em>?<em class="replaceable"><code>destination1</code></em>:<em class="replaceable"><code>destination2</code></em>)</pre><p><a id="DeeperDialplan_id293392"></a>If the expression evaluates to true,
      the caller is sent to <em class="replaceable"><code>destination1</code></em>. If the
      expression evaluates to false, the caller is sent to the second
      destination. So, what is true and what is false? An empty string and the
      number <code class="literal">0</code> evaluate as false. Anything else evaluates
      <span class="keep-together">as true</span>.</p><p><a id="DeeperDialplan_id293406"></a>The destinations can each be one of
      the following:</p><div class="itemizedlist"><a id="DeeperDialplan_id293409"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeeperDialplan_id293411"></a><a id="DeeperDialplan_id293414"></a>A priority label within the same
          extension, such as <code class="literal">weasels</code></p></li><li class="listitem"><p><a id="DeeperDialplan_id293422"></a><a id="DeeperDialplan_id293424"></a>An extension and a priority label
          within the same context, such as <code class="literal">123,weasels</code></p></li><li class="listitem"><p><a id="DeeperDialplan_id293433"></a><a id="DeeperDialplan_id293435"></a>A context, extension, and
          priority label, such as <code class="literal">incoming,123,weasels</code></p></li></ul></div><p><a id="DeeperDialplan_id293445"></a>Either of the destinations may be
      omitted, but not both. If the omitted destination is to be followed,
      Asterisk simply goes on to the next priority in the current
      extension.</p><p><a id="DeeperDialplan_id293450"></a>Let’s use <code class="literal">GotoIf()</code> in an example:</p><a id="I_programlisting6_tt900"></a><pre class="programlisting">exten =&gt; 345,1,Set(TEST=1)
   same =&gt; n,GotoIf($[${TEST} = 1]?<span class="bold"><strong>weasels</strong></span>:<span class="bold"><strong>iguanas</strong></span>)
   same =&gt; <span class="bold"><strong>n(weasels)</strong></span>,Playback(weasels-eaten-phonesys)
   same =&gt; n,Hangup()
   same =&gt; <span class="bold"><strong>n(iguanas)</strong></span>,Playback(office-iguanas)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id293490"></a>
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeeperDialplan_id293493"></a>You will notice that we have used
          the <code class="literal">Hangup()</code>
          application<a id="I_indexterm10_d1e20333" class="indexterm"></a><a id="I_indexterm10_d1e20336" class="indexterm"></a> following each use of the <code class="literal">Playback()</code> application. This is done so
          that when we jump to the <code class="literal">weasels</code>
          label, the call stops before execution gets to the
          <span class="emphasis"><em>office-iguanas</em></span> sound file. It is becoming
          increasingly common to see extensions broken up into multiple
          components (protected from each other by the <code class="literal">Hangup()</code> command), each one a distinct
          sequence of steps executed following a <code class="literal">GotoIf()</code>.</p></div><p>
      </p><div class="sidebar" title="Providing Only a False Conditional Path"><a id="I_sidebar6_tt901"></a><div class="titlepage"><div><div><p class="title"><strong>Providing Only a False Conditional Path</strong></p></div></div></div><p><a id="DeeperDialplan_id293548"></a><a id="I_indexterm10_d1e20362" class="indexterm"></a>If we wanted to, we could have crafted the preceding
        example like this:</p><p><a id="DeeperDialplan_id293552"></a><a id="I_programlisting6_tt902"></a></p><pre class="programlisting">exten =&gt; 345,1,Set(TEST=1)
   same =&gt; n,GotoIf($[${TEST} = 1]?:<span class="bold"><strong>iguanas</strong></span>) ; we don't have the weasels label anymore,
                                             ; but this will still work
   same =&gt; n,Playback(weasels-eaten-phonesys)
   same =&gt; n,Hangup()
   same =&gt; <span class="bold"><strong>n(iguanas)</strong></span>,Playback(office-iguanas)
   same =&gt; n,Hangup()</pre><p>There’s nothing between the <code class="literal">?</code> and the <code class="literal">:</code>, so if the statement evaluates to true,
        execution will continue at the next step. Since that’s what we want, a
        label isn’t needed.</p><p><a id="DeeperDialplan_id293588"></a>We don’t really recommend doing
        this, because it’s hard to read, but you will see dialplans like this,
        so it’s good to be aware that this syntax is totally correct.</p></div><p><a id="DeeperDialplan_id293595"></a>Typically, when you have this type of
      layout where you end up wanting to prevent Asterisk from falling through
      to the next priority after you’ve performed that jump, it’s probably
      better to jump to separate extensions instead of priority labels. If
      anything, it makes it a bit more clear when reading the dialplan. We
      could rewrite the previous bit of dialplan like this:</p><p><a id="DeeperDialplan_id293598"></a><a id="I_programlisting6_tt903"></a></p><pre class="programlisting">exten =&gt; 345,1,Set(TEST=1)
   same =&gt; n,GotoIf($[${TEST} = 1]?weasels,1:iguanas,1) ; now we're going to
                                                        ; <em class="replaceable"><code>extension,priority</code></em>

exten =&gt; weasels,1,Playback(weasels-eaten-phonesys)     ; this is NOT a label.
                                                        ; It is a different extension
   same =&gt; n,Hangup()

exten =&gt; iguanas,1,Playback(office-iguanas)
   same =&gt; n,Hangup()</pre><p>By changing the value assigned to
      <code class="literal">TEST</code> in the first line, you should be
      able to have your Asterisk server play a different greeting.</p><p><a id="DeeperDialplan_id293631"></a>Let’s look at another example of
      conditional branching. This time, we’ll use both <code class="literal">Goto()</code> and <code class="literal">GotoIf()</code> to count down from 10 and then hang
      up:</p><a id="I_programlisting6_tt904"></a><pre class="programlisting">exten =&gt; 123,1,Set(COUNT=10)
   same =&gt; n(start),GotoIf($[${COUNT} &gt; 0]?:goodbye)
   same =&gt; n,SayNumber(${COUNT})
   same =&gt; n,Set(COUNT=$[${COUNT} - 1])
   same =&gt; n,Goto(start)
   same =&gt; n(goodbye),Hangup()</pre><p><a id="DeeperDialplan_id293659"></a>Let’s analyze this example. In the
      first priority, we set the variable <code class="literal">COUNT</code> to <code class="literal">10</code>. Next, we check to see if <code class="literal">COUNT</code> is greater than <code class="literal">0</code>. If it is, we move on to the next priority.
      (Don’t forget that if we omit a destination in the <code class="literal">GotoIf()</code> application, control goes to the next
      priority.) From there, we speak the number, subtract <code class="literal">1</code> from <code class="literal">COUNT</code>, and go back to priority label <code class="literal">start</code>. If <code class="literal">COUNT</code> is less than or equal to <code class="literal">0</code>, control goes to priority label <code class="literal">goodbye</code>, and the call is hung up.</p><p><a id="DeeperDialplan_id293724"></a>The classic example of conditional
      branching is affectionately known as the anti-<span class="keep-together">girlfriend</span> logic. If the caller ID number
      of the incoming call matches the phone number of the recipient’s
      ex-girlfriend, Asterisk gives a different message than it ordinarily
      would to any other caller. While somewhat simple and primitive, it’s a
      good example for learning about conditional branching within the
      Asterisk dialplan.</p><p><a id="DeeperDialplan_id293734"></a>This example uses the <code class="literal">CALLERID</code> function, which allows us to retrieve
      the caller ID information on the inbound call. Let’s assume for the sake
      of this example that the victim’s phone number is 888-555-1212:</p><a id="I_programlisting6_tt905"></a><pre class="programlisting">exten =&gt; 123,1,GotoIf($[${CALLERID(num)} = 8885551212]?reject:allow)
   same =&gt; n(allow),Dial(DAHDI/4)
   same =&gt; n,Hangup()
   same =&gt; n(reject),Playback(abandon-all-hope)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id293757"></a>In priority <code class="literal">1</code>, we
      call the <code class="literal">GotoIf()</code>
      application.<a id="I_indexterm10_d1e20462" class="indexterm"></a><a id="I_indexterm10_d1e20465" class="indexterm"></a> It tells Asterisk to go to priority label <code class="literal">reject</code> if the caller ID number matches
      <code class="literal">8885551212</code>, and otherwise to go to
      priority label <code class="literal">allow</code> (we could have
      simply omitted the label name, causing the <code class="literal">GotoIf()</code> to fall through). If the caller ID
      number matches, control of the call goes to priority label <code class="literal">reject</code>, which plays back an uninspiring
      message to the undesired caller. Otherwise, the call attempts to dial
      the recipient on channel <code class="literal">DAHDI/4</code>.</p></div><div class="sect2" title="Time-Based Conditional Branching with GotoIfTime()"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-3.2"></a>Time-Based Conditional Branching with GotoIfTime()</h3></div></div></div><p><a id="DeeperDialplan_id293809"></a><a id="I_indexterm10_d1e20495" class="indexterm"></a><a id="I_indexterm10_d1e20502" class="indexterm"></a><a id="I_indexterm10_d1e20507" class="indexterm"></a><a id="I_indexterm10_d1e20514" class="indexterm"></a><a id="I_indexterm10_d1e20517" class="indexterm"></a><a id="I_indexterm10_d1e20520" class="indexterm"></a>Another way to use conditional branching in your dialplan
      is with the <code class="literal">GotoIfTime()</code> application.
      Whereas <code class="literal">GotoIf()</code> evaluates an
      expression to decide what to do, <code class="literal">GotoIfTime()</code> looks at the current system time
      and uses that to decide whether or not to follow a different branch in
      the dialplan.</p><p><a id="DeeperDialplan_id293868"></a>The most obvious use of this
      application is to give your callers a different greeting before and
      after normal business hours.</p><p><a id="DeeperDialplan_id293872"></a>The syntax for the <code class="literal">GotoIfTime()</code> application looks like
      this:</p><a id="I_programlisting6_tt906"></a><pre class="programlisting">GotoIfTime(<em class="replaceable"><code>times</code></em>,<em class="replaceable"><code>days_of_week</code></em>,<em class="replaceable"><code>days_of_month</code></em>,<em class="replaceable"><code>months</code></em>?<em class="replaceable"><code>label</code></em>)</pre><p><a id="DeeperDialplan_id293904"></a>In short, <code class="literal">GotoIfTime()</code> sends the call to the specified
      <em class="replaceable"><code>label</code></em> if the current date and time match the
      criteria specified by <em class="replaceable"><code>times</code></em>,
      <em class="replaceable"><code>days_of_week</code></em>,
      <em class="replaceable"><code>days_of_month</code></em>, and
      <em class="replaceable"><code>months</code></em>. Let’s look at each argument in more
      detail:</p><div class="variablelist"><dl><dt><span class="term">
            <em class="replaceable"><code>times</code></em>
          </span></dt><dd><p><a id="DeeperDialplan_id293939"></a><a id="DeeperDialplan_id293941"></a><a id="I_indexterm10_d1e20588" class="indexterm"></a>This is a list of one or more time ranges, in a
            24-hour format. As an example, 9:00 A.M. through 5:00 P.M. would
            be specified as <code class="literal">09:00-17:00</code>.
            The day starts at 0:00 and ends at 23:59.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeeperDialplan_id293962"></a>It is worth noting that
                times will properly wrap around. So, if you wish to specify
                the times your office is closed, you might write <code class="literal">18:00-9:00</code> in the
                <em class="replaceable"><code>times</code></em> parameter, and it will
                perform as expected. Note that this technique works as well
                for the other components of <code class="literal">GotoIfTime()</code>. For example, you can
                write <code class="literal">sat-sun</code> to specify
                the weekend days.</p></div></dd><dt><span class="term">
            <em class="replaceable"><code>days_of_week</code></em>
          </span></dt><dd><p><a id="DeeperDialplan_id293997"></a><a id="DeeperDialplan_id293999"></a><a id="I_indexterm10_d1e20616" class="indexterm"></a>This is a list of one or more days of the week. The
            days should be specified as <code class="literal">mon</code>, <code class="literal">tue</code>, <code class="literal">wed</code>, <code class="literal">thu</code>, <code class="literal">fri</code>, <code class="literal">sat</code>, and/or <code class="literal">sun</code>. Monday through Friday would be
            expressed as <code class="literal">mon-fri</code>. Tuesday
            and Thursday would be expressed as <code class="literal">tue&amp;thu</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeeperDialplan_id294063"></a>Note that you can specify a
                combination of ranges and single days, as in: <code class="literal">sun-mon&amp;wed&amp;fri-sat</code>, or,
                more simply: <code class="literal">wed&amp;fri-mon</code>.</p></div></dd><dt><span class="term">
            <em class="replaceable"><code>days_of_month</code></em>
          </span></dt><dd><p><a id="DeeperDialplan_id294087"></a><a id="DeeperDialplan_id294089"></a><a id="I_indexterm10_d1e20663" class="indexterm"></a>This is a list of the numerical days of the month.
            Days are specified by the numbers <code class="literal">1</code> through <code class="literal">31</code>. The 7th through the 12th would be
            expressed as <code class="literal">7-12</code>, and the 15th
            and 30th of the month would be written as <code class="literal">15&amp;30</code>.</p></dd><dt><span class="term">
            <em class="replaceable"><code>months</code></em>
          </span></dt><dd><p><a id="DeeperDialplan_id294146"></a><a id="DeeperDialplan_id294148"></a><a id="I_indexterm10_d1e20685" class="indexterm"></a>This is a list of one or more months of the year.
            The months should be written as <code class="literal">jan</code>-<code class="literal">apr</code> for a range, and separated with
            ampersands when wanting to include nonsequential months, such as
            <code class="literal">jan&amp;mar&amp;jun</code>. You can
            also combine them like so: <code class="literal">jan-apr&amp;jun&amp;oct-dec</code>.</p></dd></dl></div><p><a id="DeeperDialplan_id294190"></a>If you wish to match on all possible
      values for any of these arguments, simply put an <code class="literal">*</code> in for that argument.</p><p><a id="DeeperDialplan_id294225"></a>The
      <em class="replaceable"><code>label</code></em><a id="I_indexterm10_d1e20710" class="indexterm"></a> argument can be any of the following:</p><div class="itemizedlist"><a id="DeeperDialplan_id294242"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeeperDialplan_id294244"></a><a id="DeeperDialplan_id294246"></a>A priority label within the same
          extension, such as <code class="literal">time_has_passed</code></p></li><li class="listitem"><p><a id="DeeperDialplan_id294255"></a><a id="DeeperDialplan_id294257"></a>An extension and a priority
          within the same context, such as <code class="literal">123,time_has_passed</code></p></li><li class="listitem"><p><a id="DeeperDialplan_id294266"></a><a id="DeeperDialplan_id294268"></a>A context, extension, and
          priority, such as <code class="literal">incoming,123,time_has_passed</code></p></li></ul></div><p><a id="DeeperDialplan_id294278"></a>Now that we’ve covered the syntax,
      let’s look at a couple of examples. The following example would match
      from <span class="emphasis"><em>9:00 A.M. to 5:59 P.M</em></span>., on <span class="emphasis"><em>Monday
      through Friday</em></span>, on <span class="emphasis"><em>any day of the month</em></span>,
      in <span class="emphasis"><em>any month of the year</em></span>:</p><a id="I_programlisting6_tt914"></a><pre class="programlisting">exten =&gt; s,1,GotoIfTime(09:00-17:59,mon-fri,*,*?open,s,1)</pre><p><a id="DeeperDialplan_id294304"></a>If the caller calls during these
      hours, the call will be sent to the first priority of the <code class="literal">s</code> extension in the context named <code class="literal">open</code>. If the call is made outside of the
      specified times, it will be sent to the next priority of the current
      extension. This allows you to easily branch on multiple times, as shown
      in the next example (note that you should always put your most specific
      time matches before the least specific ones):</p><a id="I_programlisting6_tt915"></a><pre class="programlisting">; If it's any hour of the day, on any day of the week,
; during the fourth day of the month, in the month of July,
; we're closed
exten =&gt; s,1,GotoIfTime(*,*,4,jul?closed,s,1)

; During business hours, send calls to the open context
   same =&gt; n,GotoIfTime(09:00-17:59,mon-fri,*,*?open,s,1)
   same =&gt; n,GotoIfTime(09:00-11:59,sat,*,*?open,s,1)

; Otherwise, we're closed
   same =&gt; n,Goto(closed,s,1)</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeeperDialplan_id294337"></a>If you run into the situation where
        you ask the question, “But I specified 17:58 and it’s now 17:59. Why
        is it still doing the same thing?” it should be noted that the
        granularity of the <code class="literal">GotoIfTime()</code>
        application is only to a two-minute period. So, if you specify 18:00
        as the ending time of a period, the system will continue to perform
        the same way until 18:01:59.<a id="I_indexterm10_d1e20763" class="indexterm"></a><a id="I_indexterm10_d1e20764" class="indexterm"></a><a id="I_indexterm10_d1e20765" class="indexterm"></a></p></div></div></div><div class="sect1" title="Macros"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-5"></a>Macros</h2></div></div></div><p><a id="DeeperDialplan_id295319"></a><a id="index-417O218NK3O" class="indexterm"></a><a id="index-786J211GR0Q" class="indexterm"></a>Macros<sup>[<a id="id563507" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id563507" class="footnote">94</a>]</sup> are a very useful construct designed to avoid repetition in
    the dialplan. They also help in making changes to the dialplan. To
    illustrate this point, let’s look at our sample dialplan again. If you
    remember the changes we made for voicemail, we ended up with the following
    for John’s extension:</p><a id="I_programlisting6_tt951"></a><pre class="programlisting">exten =&gt; 101,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(101@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(101@default,b)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id295406"></a>Now imagine you have a hundred users on
    your Asterisk system—setting up the extensions would involve a lot of
    copying and pasting. Then imagine that you need to make a change to the
    way your extensions work. That would involve a lot of editing, and you’d
    be almost certain to have errors.</p><p><a id="DeeperDialplan_id295414"></a>Instead, you can define a macro that
    contains a list of steps to take, and then have all of the phone
    extensions refer to that macro. All you need to change is the macro, and
    everything in the dialplan that references that macro will change as
    well.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-CHP-6-NOTE-35"></a>Tip</h3><p><a id="DeeperDialplan_id295426"></a>If you’re familiar with computer
      programming, you’ll recognize that macros are similar to subroutines in
      many modern programming <span class="keep-together">languages</span>.
      If you’re not familiar with computer programming, don’t <span class="keep-together">worry—</span>we’ll walk you through creating a
      macro.</p></div><p><a id="DeeperDialplan_id295435"></a>The best way to appreciate macros is to
    see one in action, so let’s move right along.</p><div class="sect2" title="Defining Macros"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-5.1"></a>Defining Macros</h3></div></div></div><p><a id="DeeperDialplan_id295447"></a><a id="I_indexterm10_d1e20826" class="indexterm"></a><a id="I_indexterm10_d1e20833" class="indexterm"></a>Let’s take the dialplan logic we used to set up voicemail
      for John and turn it into a macro. Then we’ll use the macro to give John
      and Jane (and the rest of their coworkers) the same
      functionality.</p><p><a id="DeeperDialplan_id295454"></a>Macro definitions look a lot like
      contexts. (In fact, you could argue that they really are small, limited
      contexts.) You define a macro by placing <code class="literal">macro-</code> and the name of your macro in square
      brackets, like this:</p><a id="I_programlisting6_tt952"></a><pre class="programlisting">[macro-voicemail]</pre><p><a id="DeeperDialplan_id295472"></a>Macro names <a id="I_indexterm10_d1e20849" class="indexterm"></a>must start with <code class="literal">macro-</code>.
      This distinguishes them from regular contexts. The commands within the
      macro are built almost identically to anything else in the dialplan; the
      only limiting factor is that macros use only the <code class="literal">s</code> extension. Let’s add our voicemail logic to
      the macro, changing the extension to <code class="literal">s</code> as we go:</p><a id="I_programlisting6_tt953"></a><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(101@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(101@default,b)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id295504"></a>That’s a start, but it’s not perfect,
      as it’s still specific to John and his mailbox number. To make the macro
      generic so that it will work not only for John but also for all of his
      coworkers, we’ll take advantage of another property of macros:
      arguments. But first, let’s see how we call macros in our
      dialplan.</p></div><div class="sect2" title="Calling Macros from the Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-5.2"></a>Calling Macros from the Dialplan</h3></div></div></div><p><a id="DeeperDialplan_id295521"></a><a id="I_indexterm10_d1e20873" class="indexterm"></a><a id="I_indexterm10_d1e20880" class="indexterm"></a><a id="I_indexterm10_d1e20885" class="indexterm"></a>To use a macro in our dialplan, we use the <code class="literal">Macro()</code> application.<a id="I_indexterm10_d1e20894" class="indexterm"></a> This application calls the specified macro and passes it
      any arguments. For example, to call our voicemail macro from our
      dialplan, we can do the following:</p><a id="I_programlisting6_tt955"></a><pre class="programlisting">exten =&gt; 101,1,Macro(voicemail)</pre><p><a id="DeeperDialplan_id295553"></a>The <code class="literal">Macro()</code> application also defines several
      special variables for our use. They include:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">${MACRO_CONTEXT}</code>
          </span></dt><dd><p><a id="DeeperDialplan_id295587"></a><a id="DeeperDialplan_id295589"></a>The original context in which
            the macro was called.</p></dd><dt><span class="term">
            <code class="literal">${MACRO_EXTEN}</code>
          </span></dt><dd><p><a id="DeeperDialplan_id295617"></a><a id="DeeperDialplan_id295619"></a>The original extension in which
            the macro was called.</p></dd><dt><span class="term">
            <code class="literal">${MACRO_PRIORITY}</code>
          </span></dt><dd><p><a id="DeeperDialplan_id295647"></a><a id="DeeperDialplan_id295649"></a>The original priority in which
            the macro was called.</p></dd><dt><span class="term"><code class="literal">${ARG</code>
          <em class="replaceable"><code>n</code></em> <code class="literal">}</code></span></dt><dd><p><a id="DeeperDialplan_id295686"></a><a id="DeeperDialplan_id295688"></a>The
            <em class="replaceable"><code>n</code></em>th argument passed to the macro. For
            example, the first argument would be <code class="literal">${ARG1}</code>, the second <code class="literal">${ARG2}</code>, and so on.</p></dd></dl></div><p><a id="DeeperDialplan_id295721"></a>As we explained earlier, the way we
      initially defined our macro was hardcoded for John, instead of being
      generic. Let’s change our macro to use <code class="literal">${MACRO_EXTEN}</code> instead of <code class="literal">101</code> for the mailbox number. That way, if we
      call the macro from extension 101 the voicemail messages will go to
      mailbox 101, if we call the macro from extension 102 messages will go to
      mailbox 102, and so on:</p><a id="I_programlisting6_tt961"></a><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(${MACRO_EXTEN}@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(${MACRO_EXTEN}@default,b)
   same =&gt; n,Hangup()</pre></div><div class="sect2" title="Using Arguments in Macros"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-5.3"></a>Using Arguments in Macros</h3></div></div></div><p><a id="DeeperDialplan_id295759"></a><a id="I_indexterm10_d1e20965" class="indexterm"></a><a id="I_indexterm10_d1e20972" class="indexterm"></a><a id="I_indexterm10_d1e20977" class="indexterm"></a>Okay, now we’re getting closer to having the macro the way
      we want it, but we still have one thing left to change: we need to pass
      in the channel to dial, as it’s currently still hardcoded for <code class="literal">${JOHN}</code> (remember that we defined the variable
      <code class="literal">JOHN</code> as the channel to call when we
      want to reach John). Let’s pass in the channel as an argument, and then
      our first macro will be complete:</p><a id="I_programlisting6_tt964"></a><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${ARG1},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(${MACRO_EXTEN}@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(${MACRO_EXTEN}@default,b)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id295816"></a>Now that our macro is done, we can
      use it in our dialplan. Here’s how we can call our macro to provide
      voicemail to John, Jane, and Jack:</p><a id="I_programlisting6_tt965"></a><pre class="programlisting">exten =&gt; 101,1,Macro(voicemail,${JOHN})
exten =&gt; 102,1,Macro(voicemail,${JANE})
exten =&gt; 103,1,Macro(voicemail,${JACK})</pre><p><a id="DeeperDialplan_id295831"></a>With 50 or more users, this dialplan
      will still look neat and organized; we’ll simply have one line per user,
      referencing a macro that can be as complicated as required. We could
      even have a few different macros for various user types, such as
      <code class="literal">executives</code>, <code class="literal">courtesy_phones</code>, <code class="literal">call_center_agents</code>, <code class="literal">analog_sets</code>, <code class="literal">sales_department</code>, and so on.</p><p><a id="DeeperDialplan_id295865"></a>A more advanced version of the macro
      might look something like this:</p><a id="I_programlisting6_tt966"></a><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${ARG1},20)
   same =&gt; n,Goto(s-${DIALSTATUS},1)

exten =&gt; s-NOANSWER,1,VoiceMail(${MACRO_EXTEN},u)
   same =&gt; n,Goto(incoming,s,1)

exten =&gt; s-BUSY,1,VoiceMail(${MACRO_EXTEN},b)
   same =&gt; n,Goto(incoming,s,1)

exten =&gt; _s-.,1,Goto(s-NOANSWER,1)</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeeperDialplan_id36060260"></a>Since we know how to use dialplan
        functions now as well, here is another way of controlling which
        voicemail prompt (unavailable vs. busy) is played to the caller. In
        the following example, we’ll be using the <code class="literal">IF()</code>
        dialplan function<a id="I_indexterm10_d1e21022" class="indexterm"></a>:<a id="I_indexterm10_d1e21028" class="indexterm"></a></p><a id="DeeperDialplan_id36060269"></a><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${ARG1},20)
   same =&gt; n,VoiceMail(${MACRO_EXTEN},${IF($[${DIALSTATUS} = BUSY]?b:u)})</pre></div><p><a id="DeeperDialplan_id295880"></a>This macro depends on a nice side
      effect of the <code class="literal">Dial()</code> application:
      when you use the <code class="literal">Dial()</code>
      application,<a id="I_indexterm10_d1e21041" class="indexterm"></a><a id="I_indexterm10_d1e21044" class="indexterm"></a> it sets the <code class="literal">DIALSTATUS</code>
      variable <a id="I_indexterm10_d1e21053" class="indexterm"></a>to indicate whether the call was successful or not. In
      this case, we’re handling the <code class="literal">NOANSWER</code> and <code class="literal">BUSY</code> cases, and treating all other result
      codes as a <code class="literal">NOANSWER</code>.<a id="I_indexterm10_d1e21067" class="indexterm"></a><a id="I_indexterm10_d1e21068" class="indexterm"></a></p></div></div><div class="sect1" title="GoSub()"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="GoSub"></a>GoSub()</h2></div></div></div><p><a id="DeeperDialplan_id36060331"></a><a id="index-572V035UV6C" class="indexterm"></a><a id="index-075G351DA4M" class="indexterm"></a><a id="index-144V832OQ0T" class="indexterm"></a><a id="index-108T845BB2I" class="indexterm"></a>The <code class="literal">GoSub()</code> dialplan application is
    similar to the <code class="literal">Macro()</code> application, in that the purpose
    is to allow you to call a block of dialplan functionality, pass
    information to that block, and return from it (optionally with a return
    value). <code class="literal">GoSub()</code> works in a different manner from
    <code class="literal">Macro()</code>, though, in that it doesn’t have the stack
    space requirements, so it nests effectively. Essentially,
    <code class="literal">GoSub()</code> acts like <code class="literal">Goto()</code> with a
    memory of where it <span class="keep-together">came from</span>.</p><p><a id="DeeperDialplan_id36060356"></a>In this section we’re going to
    reimplement what we learned in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5" title="Macros">the section called “Macros”</a>.
    If necessary, you might want to review that section: it explains why we
    might use a subroutine, and the goal we’re trying to accomplish.</p><div class="sect2" title="Defining Subroutines"><div class="titlepage"><div><div><h3 class="title"><a id="DeeperDialplan_id36060368"></a>Defining Subroutines</h3></div></div></div><p><a id="DeeperDialplan_id36060374"></a><a id="I_indexterm10_d1e21120" class="indexterm"></a><a id="index-783S221FK5M" class="indexterm"></a><a id="I_indexterm10_d1e21130" class="indexterm"></a>Unlike with <code class="literal">Macro()</code>, there are no
      special naming requirements when using <code class="literal">GoSub()</code> in the
      dialplan. In fact, you can use <code class="literal">GoSub()</code> within the
      same context and extension if you want to. In most cases, however,
      <code class="literal">GoSub()</code> is used in a similar fashion to
      <code class="literal">Macro()</code>, so defining a new context is common. When
      creating the context, we like to prepend the name with
      <code class="literal">sub</code> so we know the context is typically called from
      the <code class="literal">GoSub()</code> application (of course, there is no
      requirement that you do so, but it seems a sensible convention).</p><p><a id="DeeperDialplan_id36060402"></a>Here is a simple example of how we
      might define a subroutine in Asterisk:</p><p><a id="DeeperDialplan_id36060406"></a><a id="DeeperDialplan_id36060407"></a></p><pre class="programlisting">[subVoicemail]</pre><p>Let’s take
      our example from <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5" title="Macros">the section called “Macros”</a> and convert it
      to a subroutine. Here is how it is defined for use with
      <code class="literal">Macro()</code>:</p><p><a id="DeeperDialplan_id36060427"></a><a id="I_programlisting6_tt954"></a></p><pre class="programlisting">[macro-voicemail]
exten =&gt; s,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(101@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(101@default,b)
   same =&gt; n,Hangup()</pre><p>If we were going to convert this to
      be used for a subroutine, it might look like this:</p><p><a id="DeeperDialplan_id36060440"></a><a id="I_programlisting6_tt958"></a></p><pre class="programlisting">[subVoicemail]
exten =&gt; start,1,Dial(${JOHN},10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(101@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(101@default,b)
   same =&gt; n,Hangup()</pre><p>Not much of a change, right? All
      we’ve altered in this example is the context name, from
      <code class="literal">[macro-voicemail]</code> to
      <code class="literal">[subVoicemail]</code>, and the extension, from
      <code class="literal">s</code> to <code class="literal">start</code> (since there is no
      requirement that the extension be called anything in particular, unlike
      with <code class="literal">Macro()</code>, which expects the extension to be
      <code class="literal">s</code>).</p><p><a id="DeeperDialplan_id36060474"></a>Of course, as in the example in the
      section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5" title="Macros">the section called “Macros”</a>, we haven’t passed any
      arguments to the subroutine, so whenever we call
      <code class="literal">[subVoicemail]</code>, <code class="literal">${JOHN}</code> will
      always be called, and the voicemail box 101 will get used. In the
      following sections, we’ll dig a little deeper. First we’ll look at how
      we would call a subroutine, and then we’ll learn how to pass
      arguments.</p></div><div class="sect2" title="Calling Subroutines from the Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="DeeperDialplan_id36060490"></a>Calling Subroutines from the Dialplan</h3></div></div></div><p><a id="DeeperDialplan_id36060495"></a><a id="I_indexterm10_d1e21210" class="indexterm"></a><a id="I_indexterm10_d1e21217" class="indexterm"></a><a id="I_indexterm10_d1e21222" class="indexterm"></a>Subroutines are called from the dialplan using the
      <code class="literal">GoSub()</code> application. The arguments to
      <code class="literal">GoSub()</code> differ slightly than those for
      <code class="literal">Macro()</code>, because <code class="literal">GoSub()</code> has no
      naming requirements for the context or extension (or priority) that gets
      used. Additionally, no special channel variables are set when calling a
      subroutine, other than the passed arguments, which are saved to
      <code class="literal">${ARG<em class="replaceable"><code>n</code></em>}</code> (where the first
      argument is <code class="literal">${ARG1}</code>, the second argument is
      <code class="literal">${ARG2}</code>, and so forth).</p><p><a id="DeeperDialplan_id36060524"></a>Now that we’ve updated our
      voicemail macro to be called as a subroutine, lets take a look at how we
      call it using <code class="literal">GoSub()</code>:</p><p><a id="DeeperDialplan_id36060528"></a><a id="DeeperDialplan_id36060530"></a></p><pre class="programlisting">exten =&gt; 101,1,GoSub(subVoicemail,start,1())</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeeperDialplan_id36060535"></a>You’ll notice that we’ve placed
          a set of opening and closing parentheses within our
          <code class="literal">GoSub()</code> application. These are the placeholders
          for any arguments we might pass to the subroutine, and while it is
          optional for them to exist, it’s a programming style we prefer to
          use.</p></div><p>Next, let’s look at how we can pass arguments to our subroutine
      in order to make it more general.</p></div><div class="sect2" title="Using Arguments in Subroutines"><div class="titlepage"><div><div><h3 class="title"><a id="DeeperDialplan_id36060548"></a>Using Arguments in Subroutines</h3></div></div></div><p><a id="DeeperDialplan_id36060553"></a><a id="I_indexterm10_d1e21272" class="indexterm"></a><a id="I_indexterm10_d1e21279" class="indexterm"></a><a id="I_indexterm10_d1e21284" class="indexterm"></a>The ability to use arguments is one of the major features
      of using <code class="literal">Macro()</code> or <code class="literal">GoSub()</code>,
      because it allows you to abstract out code that would otherwise be
      duplicated across your dialplan. Without the need to duplicate the code,
      we can better manage it, and we can easily add functionality to large
      numbers of users by modifying a single location. You are encouraged to
      move code into this form whenever you find yourself creating duplicate
      code.</p><p><a id="DeeperDialplan_id36060567"></a>Before we start using our
      subroutine, we need to update it to accept arguments so that it is
      generic enough to be used by multiple users:</p><p><a id="DeeperDialplan_id36060581"></a><a id="I_programlisting6_tt956"></a></p><pre class="programlisting">[subVoicemail]
exten =&gt; start,1,Dial(<strong class="userinput"><code>${ARG1}</code></strong>,10)
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
   same =&gt; n(unavail),VoiceMail(<strong class="userinput"><code>${ARG2}</code></strong>@default,u)
   same =&gt; n,Hangup()
   same =&gt; n(busy),VoiceMail(<strong class="userinput"><code>${ARG2}</code></strong>@default,b)
   same =&gt; n,Hangup()</pre><p>Recall that previously we had
      hardcoded the channel variable <code class="literal">${JOHN}</code> as the
      location to dial, and mailbox <code class="literal">101</code> as the voicemail
      box to be used if <code class="literal">${JOHN}</code> wasn’t available. In this
      code, we’ve replaced <code class="literal">${JOHN}</code> and
      <code class="literal">101</code> with <code class="literal">${ARG1}</code> and
      <code class="literal">${ARG2}</code>, respectively. In more complex subroutines we
      might even assign the variables <code class="literal">${ARG1}</code> and
      <code class="literal">${ARG2}</code> to something like
      <code class="literal">${DESTINATION}</code> and <code class="literal">${VMBOX}</code>, to
      make it clear what the <code class="literal">${ARG1}</code> and <code class="literal">${ARG2}</code> represent.</p><p><a id="DeeperDialplan_id36060636"></a>Now that we’ve updated our
      subroutine, we can use it for several extensions:</p><a id="DeeperDialplan_id36060640"></a><pre class="programlisting">[LocalSets]
exten =&gt; 101,1,GoSub(subVoicemail,start,1(${JOHN},${EXTEN}))
exten =&gt; 102,1,GoSub(subVoicemail,start,1(${JANE},${EXTEN}))
exten =&gt; 103,1,GoSub(subVoicemail,start,1(${JACK},${EXTEN}))</pre><p><a id="DeeperDialplan_id36060645"></a>Again, our dialplan is nice and
      neat. We could even modify our subroutine down to just three
      lines:<a id="I_programlisting6_tt957"></a></p><pre class="programlisting">[subVoicemail]
exten =&gt; start,1,Dial(${ARG1},10)
   same =&gt; n,VoiceMail(${ARG2}@default,${IF($[${DIALSTATUS} = BUSY]?b:u)})
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id36060660"></a>One difference to note between
      <code class="literal">GoSub()</code> and <code class="literal">Macro()</code>, however, is
      that if we left our subroutine like this, we’d never return. In this
      particular example that’s not a problem, since after the voicemail is
      left, we would expect the caller to hang up anyway. In situations where
      we want to do more after the subroutine has executed, though, we need to
      implement the <code class="literal">Return()</code> application.</p></div><div class="sect2" title="Returning from a Subroutine"><div class="titlepage"><div><div><h3 class="title"><a id="DeeperDialplan_id36060676"></a>Returning from a Subroutine</h3></div></div></div><p><a id="DeeperDialplan_id36060682"></a><a id="I_indexterm10_d1e21375" class="indexterm"></a><a id="I_indexterm10_d1e21382" class="indexterm"></a><a id="I_indexterm10_d1e21387" class="indexterm"></a>Unlike <code class="literal">Macro()</code>, the
      <code class="literal">GoSub()</code> dialplan application does not return
      automatically once it is done executing. In order to return from whence
      we came, we need to use the <code class="literal">Return()</code> application. Now
      that we know how to call a subroutine and pass arguments, we can look at
      an example where we might need to return from the subroutine.</p><p><a id="DeeperDialplan_id36060697"></a>Using our previous example, we
      could break out the dialing portion and the voicemail portion into
      separate subroutines:</p><a id="DeeperDialplan_id36060701"></a><pre class="programlisting">[subDialer]
exten =&gt; start,1,Dial(${ARG1},${ARG2})
   same =&gt; n,Return()

[subVoicemail]
exten =&gt; start,1,VoiceMail(${ARG1}@${ARG2},${ARG3})
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id36060706"></a>The <code class="literal">[subDialer]</code>
      context created here takes two arguments: <code class="literal">${ARG1}</code>,
      which contains the destination to dial; and <code class="literal">${ARG2}</code>,
      which contains the ring cycle, defined in seconds. We conclude the
      <code class="literal">[subDialer]</code> context with the dialplan application
      <code class="literal">Return()</code>, which will return to the priority following
      the one that called <code class="literal">GoSub()</code> (the next line of the
      dialplan).</p><p><a id="DeeperDialplan_id36060730"></a>The
      <code class="literal">[subVoicemail]</code> context contains the
      <code class="literal">VoiceMail()</code> application, which is using three
      arguments passed to it: <code class="literal">${ARG1}</code> contains the mailbox
      number, <code class="literal">${ARG2}</code> contains the voicemail context, and
      <code class="literal">${ARG3}</code> contains a value to indicate which voicemail
      message (unavailable or busy) to play to the caller.</p><p><a id="DeeperDialplan_id36060751"></a>Calling these subroutines might
      look like this:</p><p><a id="DeeperDialplan_id36060754"></a><a id="DeeperDialplan_id36060756"></a></p><pre class="programlisting">exten =&gt; 101,1,GoSub(subDialer,start,1(${JOHN},30))
   same =&gt; n,GoSub(subVoicemail,start,1(${EXTEN},default,u))</pre><p>Here
      we’ve used the <code class="literal">subDialer</code> subroutine, which attempts
      to call <code class="literal">${JOHN}</code>, ringing him for 30 seconds. If the
      <code class="literal">Dial()</code> application returns (e.g., if the line was
      busy, or there was no answer for 30 seconds), we
      <code class="literal">Return()</code> from the subroutine and execute the next
      line of our dialplan, which calls the <code class="literal">subVoicemail</code>
      subroutine. From there, we pass the extension that was dialed (e.g.,
      <code class="literal">101</code>) as the mailbox number, and pass the values
      <code class="literal">default</code> for the voicemail context and the letter
      <code class="literal">u</code> to play the unavailable message.</p><p><a id="DeeperDialplan_id36060790"></a>Our example has been hardcoded to
      play the unavailable voicemail message, but we can modify the
      <code class="literal">Return()</code> application to return the
      <code class="literal">${DIALSTATUS}</code> so that we can play the busy message if
      its value is <code class="literal">BUSY</code>. To do this, we’ll use the
      <code class="literal">${GOSUB_RETVAL}</code> channel variable, which is set
      whenever we pass a value to the <code class="literal">Return()</code>
      application:</p><p><a id="DeeperDialplan_id36060797"></a><a id="DeeperDialplan_id36060798"></a></p><pre class="programlisting">[subDialer]
exten =&gt; start,1,Dial(${ARG1},${ARG2})
   same =&gt; n,Return(<strong class="userinput"><code>${DIALSTATUS}</code></strong>)

[subVoicemail]
exten =&gt; start,1,VoiceMail(${ARG1}@${ARG2},${ARG3})
   same =&gt; n,Hangup()</pre><p>In this version we’ve made just the
      one change: <code class="literal">Return()</code> to
      <code class="literal">Return(${DIALSTATUS})</code>.</p><p><a id="DeeperDialplan_id36060815"></a>Now we can modify extension
      <code class="literal">101</code> to use the <code class="literal">${GOSUB_RETVAL}</code>
      channel variable, which will be set by
      <code class="literal">Return()</code>:</p><p><a id="DeeperDialplan_id36060825"></a><a id="DeeperDialplan_id36060826"></a></p><pre class="programlisting">exten =&gt; 101,1,GoSub(subDialer,start,1(${JOHN},30))
<strong class="userinput"><code>   same =&gt; n,Set(VoicemailMessage=${IF($[${GOSUB_RETVAL} = BUSY]?b:u)})</code></strong>
   same =&gt; n,GoSub(subVoicemail,start,1(${EXTEN},default,<strong class="userinput"><code>${VoicemailMessage}</code></strong>))</pre><p>Our
      dialplan now has a new line that sets the
      <code class="literal">${VoicemailMessage}</code> channel variable to a value of
      <code class="literal">u</code> or <code class="literal">b</code>, using the
      <code class="literal">IF()</code> dialplan function and the value of
      <code class="literal">${GOSUB_RETVAL}</code>. We then pass the value of
      <code class="literal">${VoicemailMessage}</code> as the third argument to our
      <code class="literal">subVoicemail</code> subroutine.</p><p><a id="DeeperDialplan_id36060864"></a>Before moving on, you might want to
      go back and review <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5" title="Macros">the section called “Macros”</a> and<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub" title="GoSub()">the section called “GoSub()”</a>. We’ve given you a lot to digest here, but these
      concepts will save you a lot of work as you start building your
      dialplans.<a id="I_indexterm10_d1e21553" class="indexterm"></a><a id="I_indexterm10_d1e21554" class="indexterm"></a><a id="I_indexterm10_d1e21555" class="indexterm"></a><a id="I_indexterm10_d1e21556" class="indexterm"></a><a id="I_indexterm10_d1e21557" class="indexterm"></a></p></div></div><div class="sect1" title="Local Channels"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeeperDialplan_id324598"></a>Local Channels</h2></div></div></div><p><a id="DeeperDialplan_id324603"></a><a id="index-403M730VA5M" class="indexterm"></a><a id="index-834F182WR4U" class="indexterm"></a><a id="index-126F345EN4K" class="indexterm"></a>Local channels are a method of executing dialplans from the
    <code class="literal">Dial()</code> application.<a id="I_indexterm10_d1e21581" class="indexterm"></a><a id="I_indexterm10_d1e21584" class="indexterm"></a> They may seem like a bit of a strange concept when you
    first start using them, but believe us when we tell you they are a
    glorious and extremely useful feature that you will almost certainly want
    to make use of when you start writing advanced dialplans. The best way to
    illustrate the use of Local channels is through an example. Let’s suppose
    we have a situation where we need to ring multiple people, but we need to
    provide delays of different lengths before dialing each of the members.
    The use of Local channels is the only solution to the problem.</p><p><a id="DeeperDialplan_id324637"></a>With the <code class="literal">Dial()</code>
    application, you can certainly ring multiple endpoints, but all three
    channels will ring at the same time, and for the same length of time.
    Dialing multiple channels at the same time is done like so:</p><p><a id="DeeperDialplan_id324646"></a><a id="DeeperDialplan_id324647"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 107,1,Verbose(2,Dialing multiple locations simultaneously)
   same =&gt; n,Dial(SIP/0000FFFF0001&amp;DAHDI/g0/14165551212&amp;SIP/MyITSP/12565551212,30)
   same =&gt; n,Hangup()</pre><p>This example dials three destinations
    for a period of 30 seconds. If none of those locations answers the call
    within 30 seconds, the dialplan continues to the next line and the call is
    hung up.</p><p><a id="DeeperDialplan_id324655"></a>However, let’s say we want to introduce
    some delays, and stop ringing locations at different times. Using Local
    channels gives us independent control over each of the channels we want to
    dial, so we can introduce delays and control the period of time for which
    each channel rings independently. We’re going to show you how this is done
    in the dialplan, both within a table that shows the delays visually, and
    all together in a box, like we’ve done for other portions of the dialplan.
    We’ll be building the dialplan to match the time starts and stops
    described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#TimeDelayedLocalChannels" title="Figure 10.1. Time delayed dialing with local channels">Figure&nbsp;10.1, “Time delayed dialing with local channels”</a>.</p><div class="figure-float"><div class="figure"><a id="TimeDelayedLocalChannels"></a><p class="title"><strong>Figure&nbsp;10.1.&nbsp;Time delayed dialing with local channels</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject10_d1e21606"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1001.png" alt="Time delayed dialing with local channels"></div></div></div><br class="figure-break"></div><p><a id="DeeperDialplan_id324670"></a>First we need to call three Local
    channels, which will all execute different parts of the dialplan. We do
    this with the <code class="literal">Dial()</code> application, like
    so:<a id="DeeperDialplan_id324673"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 107,1,Verbose(2,Dialing multiple locations with time delay)

; *** This all needs to be on a single line
   same =&gt; n,Dial(Local/channel_1@TimeDelay&amp;Local/channel_2@TimeDelay
&amp;Local/channel_3@TimeDelay,40)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id324679"></a>Now our <code class="literal">Dial()</code>
    application will dial three Local channels. The destinations will be the
    <code class="literal">channel_1</code>, <code class="literal">channel_2</code>, and
    <code class="literal">channel_3</code> extensions located within the
    <code class="literal">TimeDelay</code> dialplan context. Remember that Local
    channels are a way of executing the dialplan from within the
    <code class="literal">Dial()</code> application. Our master timeout for all the
    channels is 40 seconds, which means any Local channel that does not have a
    shorter timeout configured will be hung up if it does not answer the call
    within that period of time.</p><p>As promised, <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#delayed_dialing" title="Table 10.1. Delayed dialing using Local channels">Table&nbsp;10.1, “Delayed dialing using Local channels”</a> illustrates the
    delay configurations<a id="I_indexterm10_d1e21643" class="indexterm"></a>.</p><div class="table"><a id="delayed_dialing"></a><p class="title"><strong>Table&nbsp;10.1.&nbsp;Delayed dialing using Local channels</strong></p><div class="table-contents"><table summary="Delayed dialing using Local channels" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th align="center">Time period <span class="keep-together">(in
            seconds)</span></th><th align="center">channel_1</th><th align="center">channel_2</th><th align="center">channel_3</th></tr></thead><tbody><tr><td>0</td><td>
              <code class="literal">Dial(SIP/0000FFFF0001,20)</code>
            </td><td>
              <code class="literal">Wait(10)</code>
            </td><td>
              <code class="literal">Wait(15)</code>
            </td></tr><tr><td>5</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>10</td><td>&nbsp;</td><td>
              <code class="literal">Dial(DAHDI/g0/14165551212)</code>
            </td><td>&nbsp;</td></tr><tr><td>15</td><td>&nbsp;</td><td>&nbsp;</td><td>
              <code class="literal">Dial(SIP/MyITSP/12565551212,15)</code>
            </td></tr><tr><td>20</td><td>
              <code class="literal">Hangup()</code>
            </td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>25</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>30</td><td>&nbsp;</td><td>&nbsp;</td><td>
              <code class="literal">Hangup()</code>
            </td></tr><tr><td>35</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>40</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><p><a id="DeeperDialplan_id314606"></a>In this table, we can see that
    <code class="literal">channel_1</code> started dialing location
    <code class="literal">SIP/0000FFFF0001</code> immediately and waited for a period of
    20 seconds. After 20 seconds, that Local channel hung up. Our
    <code class="literal">channel_2</code> waited for 10 seconds prior to dialing the
    endpoint <code class="literal">DAHDI/g0/14165551212</code>. There was no maximum
    time associated with this <code class="literal">Dial()</code>, so its dialing period
    ended when the master time out of 40 seconds (which we set when we
    initially called the Local channels) expired. Finally,
    <code class="literal">channel_3</code> waited 15 seconds prior to dialing, then
    dialed <code class="literal">SIP/MyITSP/12565551212</code> and waited for a period
    of 15 seconds prior to hanging up.</p><p><a id="DeeperDialplan_id314637"></a>If we put all this together, we end up
    with the following dialplan:</p><p><a id="DeeperDialplan_id314641"></a><a id="DeeperDialplan_id314642"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 107,1,Verbose(2,Dialing multiple locations with time delay)

; *** This all needs to be on a single line
   same =&gt; n,Dial(Local/channel_1@TimeDelay&amp;Local/channel_2@TimeDelay
&amp;Local/channel_3@TimeDelay,40)
   same =&gt; n,Hangup()

[TimeDelay]
exten =&gt; channel_1,1,Verbose(2,Dialing the first channel)
   same =&gt; n,Dial(SIP/0000FFFF0001,20)
   same =&gt; n,Hangup()

exten =&gt; channel_2,1,Verbose(2,Dialing the second channel with a delay)
   same =&gt; n,Wait(10)
   same =&gt; n,Dial(DAHDI/g0/14165551212)

exten =&gt; channel_3,1,Verbose(2,Dialing the third channel with a delay)
   same =&gt; n,Wait(15)
   same =&gt; n,Dial(SIP/MyITSP/12565551212,15)
   same =&gt; n,Hangup()</pre><p>You’ll see Local channels used
    throughout this book, for various purposes. Remember that the intention is
    simply to perform some dialplan logic from a location where you can only
    dial a location, but require some dialplan logic to be executed prior to
    dialing the endpoint you eventually want to get to. A good example of this
    is with the use of the <code class="literal">Queue()</code> application, which we’ll
    discuss in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989" title="Using Local Channels">the section called “Using Local Channels”</a>.</p><p><a id="DeeperDialplan_id314666"></a>Additional scenarios and information
    about Local channels and the modifier flags (<code class="literal">/n</code>, <code class="literal">/j</code>,
    <code class="literal">/m</code>, <code class="literal">/b</code>) are available at <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Local+Channel" target="_top">https://wiki.asterisk.org/wiki/display/AST/Local+Channel</a>.
    If you will be making any sort of regular use of Local channels, that is a
    very important document to read.<a id="I_indexterm10_d1e21786" class="indexterm"></a><a id="I_indexterm10_d1e21787" class="indexterm"></a><a id="I_indexterm10_d1e21788" class="indexterm"></a></p></div><div class="sect1" title="Using the Asterisk Database (AstDB)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-6"></a>Using the Asterisk Database (AstDB)</h2></div></div></div><p><a id="DeeperDialplan_id295935"></a><a id="index-856F233LT0M" class="indexterm"></a><a id="index-884M336WG7N" class="indexterm"></a><a id="index-423W572PH8R" class="indexterm"></a>Having fun yet? It gets even better!</p><p><a id="DeeperDialplan_id295938"></a>Asterisk provides a powerful mechanism
    for storing values called the <span class="emphasis"><em>Asterisk database
    </em></span>(AstDB). The AstDB provides a simple way to store data for use
    within your dialplan.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-CHP-6-NOTE-36"></a>Tip</h3><p><a id="DeeperDialplan_id295972"></a>For those of you with experience
      using relational databases <a id="I_indexterm10_d1e21815" class="indexterm"></a>such as PostgreSQL or MySQL, the Asterisk database is not
      a traditional relational database; it is a Berkeley DB version 1
      database. There are several ways to store data from Asterisk in a
      relational database. Check out <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a> for more
      about relational databases.</p></div><p><a id="DeeperDialplan_id296004"></a>The Asterisk database stores its data
    in groupings called <span class="emphasis"><em>families</em></span><a id="I_indexterm10_d1e21827" class="indexterm"></a>, with values identified by
    <span class="emphasis"><em>keys</em></span><a id="I_indexterm10_d1e21833" class="indexterm"></a>. Within a family, a key may be used only once. For example,
    if we had a family called <code class="literal">test</code>, we
    could store only one value with a key called <code class="literal">count</code>. Each stored value must be associated with
    a family.</p><div class="sect2" title="Storing Data in the AstDB"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-6.1"></a>Storing Data in the AstDB</h3></div></div></div><p><a id="DeeperDialplan_id296053"></a><a id="I_indexterm10_d1e21847" class="indexterm"></a><a id="I_indexterm10_d1e21854" class="indexterm"></a><a id="I_indexterm10_d1e21859" class="indexterm"></a>To store a new value in the Asterisk database, we use the
      <code class="literal">Set()</code> application,<sup>[<a id="asterisk-CHP-6-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-5" class="footnote">95</a>]</sup> but instead of using it to set a channel variable, we use
      it to set an AstDB variable. For example, to assign the <code class="literal">count</code> key in the <code class="literal">test</code> family with the value of <code class="literal">1</code>, we would write the following:</p><a id="I_programlisting6_tt975"></a><pre class="programlisting">exten =&gt; 456,1,Set(DB(test/count)=1)</pre><p><a id="DeeperDialplan_id296142"></a>If a key named <code class="literal">count</code> already exists in the <code class="literal">test</code> family, its value will be overwritten
      with the new value. You can also store values from the Asterisk command
      line, by running the command <span class="command"><strong>database put &lt;family&gt;
      &lt;key&gt; &lt;value&gt;</strong></span>. For our example, you would type
      <span class="command"><strong>database put test count 1</strong></span>.</p></div><div class="sect2" title="Retrieving Data from the AstDB"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-6.2"></a>Retrieving Data from the AstDB</h3></div></div></div><p><a id="DeeperDialplan_id296191"></a><a id="I_indexterm10_d1e21910" class="indexterm"></a><a id="I_indexterm10_d1e21917" class="indexterm"></a><a id="I_indexterm10_d1e21922" class="indexterm"></a>To retrieve a value from the Asterisk database and assign
      it to a variable, we use the <code class="literal">Set()</code>
      application again. Let’s retrieve the value of <code class="literal">count</code> (again, from the <code class="literal">test</code> family), assign it to a variable called
      <code class="literal">COUNT</code>, and then speak the value to
      the caller:</p><a id="I_programlisting6_tt977"></a><pre class="programlisting">exten =&gt; 456,1,Set(DB(test/count)=1)
<span class="strong"><strong>   same =&gt; n,Set(COUNT=${DB(test/count)})</strong></span>
   same =&gt; n,SayNumber(${COUNT})</pre><p><a id="DeeperDialplan_id296232"></a>You may also check the value of a
      given key from the Asterisk command line by running the command
      <span class="command"><strong>database get</strong></span> <span class="command"><strong>&lt;family&gt;
      &lt;key&gt;</strong></span>. To view the entire contents of the AstDB, use the
      <span class="command"><strong>database show</strong></span> command.</p></div><div class="sect2" title="Deleting Data from the AstDB"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-6.3"></a>Deleting Data from the AstDB</h3></div></div></div><p><a id="DeeperDialplan_id296259"></a><a id="I_indexterm10_d1e21962" class="indexterm"></a><a id="I_indexterm10_d1e21969" class="indexterm"></a><a id="I_indexterm10_d1e21974" class="indexterm"></a><a id="I_indexterm10_d1e21977" class="indexterm"></a>There are two ways to delete data from the Asterisk
      database. To delete a key, you can use the <code class="literal">DB_DELETE()</code> application. It takes the path to
      the key as its arguments, like this:</p><a id="I_programlisting6_tt978"></a><pre class="programlisting">; deletes the key and returns its value in one step
exten =&gt; 457,1,Verbose(0, The value was ${DB_DELETE(test/count)})</pre><p><a id="DeeperDialplan_id296277"></a>You can also delete an entire key
      family by using the <code class="literal">DBdeltree()</code>
      application. The <code class="literal">DBdeltree()</code>
      application takes a single argument: the name of the key family to
      delete. To delete the entire <code class="literal">test</code>
      family, do the following:</p><a id="I_programlisting6_tt979"></a><pre class="programlisting">exten =&gt; 457,1,DBdeltree(test)</pre><p><a id="DeeperDialplan_id296306"></a>To delete keys and key families from
      the AstDB via the command-line interface, use the <span class="command"><strong>database
      del</strong></span> <span class="command"><strong>&lt;key&gt;</strong></span> and <span class="command"><strong>database
      deltree</strong></span> <span class="command"><strong>&lt;family&gt;</strong></span> commands,
      respectively.</p></div><div class="sect2" title="Using the AstDB in the Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-6.4"></a>Using the AstDB in the Dialplan</h3></div></div></div><p><a id="DeeperDialplan_id296336"></a><a id="I_indexterm10_d1e22021" class="indexterm"></a><a id="I_indexterm10_d1e22028" class="indexterm"></a><a id="I_indexterm10_d1e22033" class="indexterm"></a>There are an infinite number of ways to use the Asterisk
      database in a dialplan. To introduce the AstDB, we’ll look at two simple
      examples. The first is a simple counting example to show that the
      Asterisk database is persistent (meaning that it survives system
      reboots). In the second example, we’ll use the <code class="literal">BLACKLIST()</code> function <a id="I_indexterm10_d1e22044" class="indexterm"></a><a id="I_indexterm10_d1e22047" class="indexterm"></a>to evaluate whether or not a number is on the blacklist
      and should be blocked.</p><p><a id="DeeperDialplan_id296351"></a>To begin the counting example, let’s
      first retrieve a number (the value of the <code class="literal">count</code> key) from the database and assign it to
      a variable named <code class="literal">COUNT</code>. If the key
      doesn’t exist, <code class="literal">DB()</code> will return
      <code class="literal">NULL</code> (no value). Therefore, we can use the <code class="literal">ISNULL()</code> function <a id="I_indexterm10_d1e22071" class="indexterm"></a><a id="I_indexterm10_d1e22074" class="indexterm"></a>to verify whether or not a value was returned. If not, we
      will initialize the AstDB with the <code class="literal">Set()</code> application, where we will set the value
      in the database to <code class="literal">1</code>. The next
      priority will send us back to priority <code class="literal">1</code>. This will
      happen the very first time we dial this extension:</p><a id="I_programlisting6_tt980"></a><pre class="programlisting">exten =&gt; 678,1,Set(COUNT=${DB(test/count)})
   same =&gt; n,GotoIf($[${ISNULL(${COUNT})}]?:continue)
   same =&gt; n,Set(DB(test/count)=1)
   same =&gt; n,Goto(1)
   same =&gt; n(continue),NoOp()</pre><p><a id="DeeperDialplan_id296402"></a>Next, we’ll say the current value of
      <code class="literal">COUNT</code>, and then increment <code class="literal">COUNT</code>:</p><a id="I_programlisting6_tt981"></a><pre class="programlisting">exten =&gt; 678,1,Set(COUNT=${DB(test/count)})
   same =&gt; n,GotoIf($[${ISNULL(${COUNT})}]?:continue)
   same =&gt; n,Set(DB(test/count)=1)
   same =&gt; n,Goto(1)
   same =&gt; n(continue),NoOp()
<span class="strong"><strong>   same =&gt; n,SayNumber(${COUNT})
   same =&gt; n,Set(COUNT=$[${COUNT} + 1])</strong></span></pre><p><a id="DeeperDialplan_id296432"></a>Now that we’ve incremented <code class="literal">COUNT</code>, let’s put the new value back into the
      database. Remember that storing a value for an existing key overwrites
      the previous value:</p><a id="I_programlisting6_tt982"></a><pre class="programlisting">exten =&gt; 678,1,Set(COUNT=${DB(test/count)})
   same =&gt; n,GotoIf($[${ISNULL(${COUNT})}]?:continue)
   same =&gt; n,Set(DB(test/count)=1)
   same =&gt; n,Goto(1)
   same =&gt; n(continue),NoOp()
   same =&gt; n,SayNumber(${COUNT})
   same =&gt; n,Set(COUNT=$[${COUNT} + 1])
<span class="strong"><strong>   same =&gt; n,Set(DB(test/count)=${COUNT})</strong></span></pre><p><a id="DeeperDialplan_id296458"></a>Finally, we’ll loop back to the first
      priority. This way, the application will continue counting:</p><a id="I_programlisting6_tt983"></a><pre class="programlisting">exten =&gt; 678,1,Set(COUNT=${DB(test/count)})
   same =&gt; n,GotoIf($[${ISNULL(${COUNT})}]?:continue)
   same =&gt; n,Set(DB(test/count)=1)
   same =&gt; n,Goto(1)
   same =&gt; n(continue),NoOp()
   same =&gt; n,SayNumber(${COUNT})
   same =&gt; n,Set(COUNT=$[${COUNT} + 1]
   same =&gt; n,Set(DB(test/count)=${COUNT})
   same =&gt; n,Goto(1)</pre><p><a id="DeeperDialplan_id296477"></a>Go ahead and try this example. Listen
      to it count for a while, and then hang up. When you dial this extension
      again, it should continue counting from where it left off. The value
      stored in the database will be persistent, even across a restart of
      Asterisk.</p><p><a id="DeeperDialplan_id254071"></a>In the next example, we’ll create
      dialplan logic around the <code class="literal">BLACKLIST()</code>
      function, which checks to see if the current caller ID number exists in
      the blacklist. (The blacklist is simply a family called <code class="literal">blacklist</code> in the AstDB.) If <code class="literal">BLACKLIST()</code> finds the number in the blacklist,
      it returns the value <code class="literal">1</code>; otherwise, it
      will return <code class="literal">0</code>. We can use these
      values in combination with a <code class="literal">GotoIf()</code>
      to control whether the call will execute the <code class="literal">Dial()</code> <span class="keep-together">application</span>:</p><a id="I_programlisting6_tt984"></a><pre class="programlisting">exten =&gt; 124,1,GotoIf($[${BLACKLIST()]?blocked,1)
   same =&gt; n,Dial(${JOHN})

exten =&gt; blocked,1,Playback(privacy-you-are-blacklisted)
   same =&gt; n,Playback(vm-goodbye)
   same =&gt; n,Hangup()</pre><p><a id="DeeperDialplan_id254131"></a>To add a number to the blacklist, run
      the <span class="command"><strong>database put blacklist &lt;number&gt; 1</strong></span> command
      from the Asterisk command-line interface.<a id="I_indexterm10_d1e22153" class="indexterm"></a><a id="I_indexterm10_d1e22154" class="indexterm"></a><a id="I_indexterm10_d1e22155" class="indexterm"></a></p></div></div><div class="sect1" title="Handy Asterisk Features"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-7"></a>Handy Asterisk Features</h2></div></div></div><p><a id="DeeperDialplan_id296656"></a>Now that we’ve gone over some more of
    the basics, let’s look at a few popular functions that have been
    incorporated into Asterisk.</p><div class="sect2" title="Zapateller()"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-7.1"></a>Zapateller()</h3></div></div></div><p><a id="DeeperDialplan_id296669"></a><code class="literal">Zapateller()</code><a id="I_indexterm10_d1e22168" class="indexterm"></a><a id="I_indexterm10_d1e22173" class="indexterm"></a><a id="I_indexterm10_d1e22176" class="indexterm"></a> is a simple Asterisk application that plays a special
      information tone at the beginning of a call, which causes auto-dialers
      (usually used by telemarketers) to think that the line has been
      disconnected. Not only will they hang up, but their systems will flag
      your number as out of service, which could help you avoid all kinds of
      telemarketing calls.<a id="I_indexterm10_d1e22182" class="indexterm"></a> To use this functionality within your dialplan, simply
      call the <code class="literal">Zapateller()</code>
      application.</p><p><a id="DeeperDialplan_id296696"></a>We’ll also use the optional <code class="literal">nocallerid</code><a id="I_indexterm10_d1e22193" class="indexterm"></a> option so that the tone will be played only when there is
      no caller ID information on the incoming call. For example, you might
      use <code class="literal">Zapateller()</code> in the <code class="literal">s</code> extension of your <code class="literal">[incoming]</code> context, like this:</p><a id="I_programlisting6_tt989"></a><pre class="programlisting">[incomimg]
exten =&gt; s,1,Zapateller(nocallerid)
   same =&gt; n,Playback(enter-ext-of-person)</pre></div><div class="sect2" title="Call Parking"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-6-SECT-7.2"></a>Call Parking</h3></div></div></div><p><a id="DeeperDialplan_id296751"></a><a id="I_indexterm10_d1e22212" class="indexterm"></a><a id="I_indexterm10_d1e22217" class="indexterm"></a><a id="I_indexterm10_d1e22220" class="indexterm"></a>Another handy feature is called <span class="emphasis"><em>call
      parking</em></span>. Call parking allows you to place a call on hold in a
      “parking lot,” so that it can be taken off hold from another extension.
      Parameters for call parking (such as the extensions to use, the number
      of spaces, and so on) are all controlled within the
      <code class="filename">features.conf</code> configuration file. The <code class="literal">[general]</code> section of the
      <code class="filename">features.conf</code> file contains four settings related
      to call parking:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">parkext</code>
          </span></dt><dd><p><a id="DeeperDialplan_id296808"></a><a id="DeeperDialplan_id296810"></a><a id="I_indexterm10_d1e22245" class="indexterm"></a>This is the parking lot extension. Transfer a call
            to this extension, and the system will tell you which parking
            position the call is in. By default, the parking extension is
            <code class="literal">700</code>.</p></dd><dt><span class="term">
            <code class="literal">parkpos</code>
          </span></dt><dd><p><a id="DeeperDialplan_id296843"></a><a id="DeeperDialplan_id296845"></a><a id="I_indexterm10_d1e22258" class="indexterm"></a>This option defines the number of parking slots. For
            example, setting it to <code class="literal">701-720</code>
            creates 20 parking positions, numbered 701 through 720.</p></dd><dt><span class="term">
            <code class="literal">context</code>
          </span></dt><dd><p><a id="DeeperDialplan_id296878"></a><a id="DeeperDialplan_id296880"></a><a id="I_indexterm10_d1e22271" class="indexterm"></a>This is the name of the parking context. To be able
            to park calls, you must include this context.</p></dd><dt><span class="term">
            <code class="literal">parkingtime</code>
          </span></dt><dd><p><a id="DeeperDialplan_id296907"></a><a id="DeeperDialplan_id296909"></a><a id="I_indexterm10_d1e22281" class="indexterm"></a>If set, this option controls how long (in seconds) a
            call can stay in the parking lot. If the call isn’t picked up
            within the specified time, the extension that parked the call will
            be called back.</p></dd></dl></div><p><a id="DeeperDialplan_id296952"></a>Also note that because the user needs
      to be able to transfer the calls to the parking lot extension, you
      should make sure you’re using the <code class="literal">t</code>
      and/or <code class="literal">T</code> options to the <code class="literal">Dial()</code> application.</p><p><a id="DeeperDialplan_id296984"></a>So, let’s create a simple dialplan to
      show off call parking:</p><a id="I_programlisting6_tt997"></a><pre class="programlisting">[incoming]
include =&gt; parkedcalls

exten =&gt; 103,1,Dial(SIP/Bob,,tT)
exten =&gt; 104,1,Dial(SIP/Charlie,,tT)</pre><p><a id="DeeperDialplan_id296997"></a>To illustrate how call parking works,
      say that Alice calls into the system and dials extension 103 to reach
      Bob. After a while, Bob transfers the call to extension 700, which tells
      him that the call from Alice has been parked in position 701. Bob then
      dials Charlie at extension 104, and tells him that Alice is at extension
      701. Charlie then dials extension 701 and begins to talk to Alice. This
      is a simple and effective way of allowing callers to be transferred
      between users.</p></div><div class="sect2" title="Conferencing with MeetMe()"><div class="titlepage"><div><div><h3 class="title"><a id="meetmeConferencing"></a>Conferencing with MeetMe()</h3></div></div></div><p><a id="DeeperDialplan_id297041"></a><a id="I_indexterm10_d1e22306" class="indexterm"></a><a id="I_indexterm10_d1e22311" class="indexterm"></a><a id="I_indexterm10_d1e22316" class="indexterm"></a>Last but not least, let’s cover setting up an audio
      conference bridge <a id="I_indexterm10_d1e22322" class="indexterm"></a>with the <code class="literal">MeetMe()</code>
      application.<sup>[<a id="asterisk-CHP-6-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-6-FN-6" class="footnote">96</a>]</sup> This application allows multiple callers to converse
      together, as if they were all in the same physical location. Some of the
      main features include:</p><div class="itemizedlist"><a id="DeeperDialplan_id297072"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeeperDialplan_id297075"></a><a id="DeeperDialplan_id297077"></a>The ability to create
          password-protected conferences</p></li><li class="listitem"><p><a id="DeeperDialplan_id297081"></a><a id="DeeperDialplan_id297083"></a>Conference administration (mute
          conference, lock conference, kick participants)</p></li><li class="listitem"><p><a id="DeeperDialplan_id297088"></a><a id="DeeperDialplan_id297090"></a>The option of muting all but one
          participant (useful for company announcements, broadcasts,
          etc.)</p></li><li class="listitem"><p><a id="DeeperDialplan_id297096"></a><a id="DeeperDialplan_id297098"></a>Static or dynamic conference
          creation</p></li></ul></div><p><a id="DeeperDialplan_id297103"></a>Let’s walk through setting up a basic
      conference room. The configuration options for the MeetMe conferencing
      system are found in <code class="filename">meetme.conf</code>. Inside the
      configuration file, you define conference rooms and optional numeric
      passwords. (If a password is defined here, it will be required to enter
      all conferences using that room.) For our example, let’s set up a
      conference room at extension 600. First, we’ll set up the conference
      room in <code class="filename">meetme.conf</code>. We’ll call it <code class="literal">600</code>, and we won’t assign a password at this
      time:</p><a id="I_programlisting6_tt1000"></a><pre class="programlisting">[rooms]
conf =&gt; 600</pre><p><a id="DeeperDialplan_id297145"></a>Now that the configuration file is
      complete, we’ll need to restart Asterisk so that it can reread the
      <code class="filename">meetme.conf</code> file. Next, we’ll add support for the
      conference room to our dialplan with the <code class="literal">MeetMe()</code> application. <code class="literal">MeetMe()</code> takes three arguments: the name of
      the conference room (as defined in <code class="filename">meetme.conf</code>), a
      set of options, and the password the user must enter to join this
      conference. Let’s set up a simple conference using room <code class="literal">600</code>, the <code class="literal">i</code>
      option (which announces when people enter and exit the conference), and
      a password of <code class="literal">54321</code>:</p><a id="I_programlisting6_tt1001"></a><pre class="programlisting">exten =&gt; 600,1,MeetMe(600,i,54321)</pre><p><a id="DeeperDialplan_id297196"></a>That’s all there is to it! When
      callers enter extension <code class="literal">600</code>, they will be prompted
      for the password. If they correctly enter <code class="literal">54321</code>, they will be added to the conference.
      You can run <span class="command"><strong>core show application MeetMe</strong></span> from the
      Asterisk CLI for a list of all the options supported by the <code class="literal">MeetMe()</code> application.</p><p><a id="DeeperDialplan_id297217"></a>Another useful application is
      <code class="literal">MeetMeCount()</code>.<a id="I_indexterm10_d1e22406" class="indexterm"></a><a id="I_indexterm10_d1e22409" class="indexterm"></a> As its name suggests, this application counts the number
      of users in a particular conference room. It takes up to two <span class="keep-together">arguments</span>: the conference room in which to
      count the number of participants, and optionally a variable name to
      assign the count to. If the variable name is not passed as the second
      argument, the count is read to the caller:</p><a id="I_programlisting6_tt1002"></a><pre class="programlisting">exten =&gt; 601,1,Playback(conf-thereare)
   same =&gt; n,MeetMeCount(600)
   same =&gt; n,Playback(conf-peopleinconf)</pre><p><a id="DeeperDialplan_id297244"></a>If you pass a variable as the second
      argument to <code class="literal">MeetMeCount()</code>, the count
      is assigned to the variable, and playback of the count is skipped. You
      might use this to limit the number of participants, like this:</p><a id="I_programlisting6_tt1004"></a><pre class="programlisting">; limit the conference room to 10 participants
exten =&gt; 600,1,MeetMeCount(600,CONFCOUNT)
   same =&gt; n,GotoIf($[${CONFCOUNT} &lt;= 10]?meetme:conf_full,1)
   same =&gt; n(meetme),MeetMe(600,i,54321)

exten =&gt; conf_full,1,Playback(conf-full)</pre><p><a id="DeeperDialplan_id297274"></a>Isn’t Asterisk fun?</p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-6-SECT-8"></a>Conclusion</h2></div></div></div><p><a id="DeeperDialplan_id297286"></a>In this chapter, we’ve covered a few
    more of the many applications in the Asterisk dialplan, and hopefully
    we’ve given you some more tools that you can use to further explore the
    creation of your own dialplans. As with other chapters, we invite you to
    go back and reread any sections that require clarification.<a id="I_indexterm10_d1e22435" class="indexterm"></a><a id="I_indexterm10_d1e22436" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-1" class="para">91</a>] </sup>Remember that when you <span class="emphasis"><em>reference</em></span> a
          variable you can call it by its name, but when you refer to a
          variable’s <span class="emphasis"><em>value</em></span>, you have to use the dollar
          sign and brackets around the variable name.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-2" class="para">92</a>] </sup>For more on regular expressions, grab a copy of
                      the ultimate reference, Jeffrey E. F. Friedl’s
                      <span class="emphasis"><em><a class="ulink" href="http://oreilly.com/catalog/9780596528126/" target="_top">Mastering
                      Regular Expressions</a></em></span> (O’Reilly), or
                      visit <a class="ulink" href="http://www.regular-expressions.info/" target="_top">http://www.regular-expressions.info</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-3" class="para">93</a>] </sup>If you don’t know what a <code class="literal">^</code> has to do with regular
                      expressions, you simply must read <span class="emphasis"><em><a class="ulink" href="http://oreilly.com/catalog/9780596528126/" target="_top">Mastering
                      Regular Expressions</a></em></span>. It will change
                      your life!</p></div><div class="footnote"><p><sup>[<a id="ftn.id563507" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id563507" class="para">94</a>] </sup>Although <code class="literal">Macro()</code> seems like a
        general-purpose dialplan subroutine, it has a stack overflow problem
        that means you should not try to nest <code class="literal">Macro()</code> calls more than five levels deep. If
        you plan to use a lot of macros within macros (and call complex
        functions within them), you may run into stability problems. You will
        know you have a problem with just one test call, so if your dialplan
        tests out, you’re good to go. We also recommend that you take a look
        at the <code class="literal">GoSub()</code> and <code class="literal">Return()</code> applications (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub" title="GoSub()">the section called “GoSub()”</a>), as a lot of macro functionality can be
        implemented without actually using <code class="literal">Macro()</code>. Also, please note that we are not
        suggesting that you don’t use <code class="literal">Macro()</code>. It is fantastic and works very
        well; it just doesn’t nest efficiently.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-5" class="para">95</a>] </sup>Previous versions of Asterisk had applications called <code class="literal">DBput()</code> and <code class="literal">DBget()</code> that were used to set values in
          and retrieve values from the AstDB. If you’re using an old version
          of Asterisk, you’ll want to use those applications instead.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-6-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-FN-6" class="para">96</a>] </sup>In the world of legacy PBXs, this type of functionality is
          very expensive. Either you have to pay big bucks for a dial-in
          service, or you have to add an expensive conferencing bridge to your
          proprietary PBX.</p></div></div></div><div class="chapter" title="Chapter 11. Parking and Paging"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-SysAdmin"></a>Chapter&nbsp;11.&nbsp;Parking and Paging</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265355">Places to Send Your Pages</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257823">VoIP paging adaptors</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257873">Bringing it all together</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247965">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="AdditionalConfig_id286039"></a>I don’t believe in angels, no. But I
    do have a wee parking angel. It’s on my dashboard and you wind it up. The
    wings flap and it’s supposed to give you a parking space. It’s worked so
    far.</p><div class="attribution"><span>—<span class="attribution">Billy Connolly</span></span></div></div><p><a id="AdditionalConfig_id245933"></a><a id="index-784U123RT7J" class="indexterm"></a>This chapter will focus on two important aspects of a PBX
  system: parking calls to allow them to be answered from a location different
  from where they were originally answered, and paging, which allows the
  announcement of who the call is for and how it can be retrieved.</p><p>In Asterisk, these two functionalities are exclusive to one another,
  and can be used independently of one another. Some businesses that contain
  large warehouses, or have employees who move around the office a lot and
  don’t necessarily sit at a desk all day, utilize the paging and parking
  functionality of their systems to direct calls around the office. In this
  chapter we’ll show you how to use both parking and paging in the traditional
  setting, along with a couple of more modern takes on this commonly used
  functionality.</p><div class="sect1" title="features.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AdditionalConfig_id256654"></a>features.conf</h2></div></div></div><p><a id="AdditionalConfig_id285483"></a><a id="index-338C535RH7S" class="indexterm"></a><a id="index-681O187QT0N" class="indexterm"></a><a id="index-083M123QW6K" class="indexterm"></a>There are several features common to most modern PBXs that
    Asterisk also provides. Many of these features have optional parameters.
    The <code class="filename">features.conf</code> file is where you
    can adjust or define the various feature parameters in Asterisk.</p><div class="sidebar" title="DTMF-Based Features"><a id="AdditionalConfig_id251377"></a><div class="titlepage"><div><div><p class="title"><strong>DTMF-Based Features</strong></p></div></div></div><p><a id="AdditionalConfig_id264134"></a><a id="I_indexterm11_d1e22479" class="indexterm"></a>Many of the parameters in <code class="filename">features.conf</code> only apply when invoked on
      calls that have been bridged by the dialplan applications <code class="literal">Dial()</code> or <code class="literal">Queue()</code>, with one or more of the options
      <code class="literal">K</code>, <code class="literal">k</code>, <code class="literal">H</code>,
      <code class="literal">h</code>, <code class="literal">T</code>, <code class="literal">t</code>,
      <code class="literal">W</code>, <code class="literal">w</code>, <code class="literal">X</code>, or
      <code class="literal">x</code> specified. Features accessed in
      this way are DTMF-based (meaning they can’t be accessed via SIP
      messaging, but only through touch-tone signals in the audio channel
      triggered by the users dialing the required digits on their
      dialpads).<sup>[<a id="id568585" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id568585" class="footnote">97</a>]</sup></p><p><a id="AdditionalConfig_id287074"></a>Transfers on SIP channels
      <a id="I_indexterm11_d1e22529" class="indexterm"></a>(for example from a SIP telephone) can be handled using
      the capabilities of the phone itself, and won’t be affected by anything
      in the <code class="filename">features.conf</code> file.</p></div><div class="sect2" title="The [general] section"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id268510"></a>The [general] section</h3></div></div></div><p><a id="AdditionalConfig_id253719"></a><a id="index-757C557AN1J" class="indexterm"></a><a id="index-025C472SK4C" class="indexterm"></a><a id="index-340J316DQ1G" class="indexterm"></a>In the <code class="literal">[general]</code>
      section of <code class="filename">features.conf</code>, you can
      define options that fine-tune the behavior of the park and transfer
      features in Asterisk. These options are listed in <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id244340" title="Table 11.1. features.conf [general] section">Table&nbsp;11.1, “features.conf [general] section”</a>.</span></p><div class="table"><a id="AdditionalConfig_id244340"></a><p class="title"><strong>Table&nbsp;11.1.&nbsp;features.conf [general] section</strong></p><div class="table-contents"><table summary="features.conf [general] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">parkext</code></td><td><code class="literal"><a id="I_indexterm11_d1e22591" class="indexterm"></a>700</code></td><td>Sets the default extension used to park calls.</td></tr><tr><td><code class="literal">parkpos</code></td><td><code class="literal"><a id="I_indexterm11_d1e22603" class="indexterm"></a>701-720</code></td><td>Sets the range of extensions used as the parking lot.
              Parked calls may be retrieved by dialing the numbers in this
              range.</td></tr><tr><td><code class="literal">context</code></td><td><code class="literal"><a id="I_indexterm11_d1e22615" class="indexterm"></a>parkedcalls</code></td><td>Sets the default dialplan context where the parking
              extension and the parking lot extensions are created.</td></tr><tr><td><code class="literal">parkinghints</code></td><td><code class="literal"><a id="I_indexterm11_d1e22627" class="indexterm"></a>no</code></td><td>Enables/disables automatic creation of dialplan hints for
              the parking lot extensions so that phones can subscribe to the
              state of extensions in the parking lot. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkingtime</code></td><td><code class="literal"><a id="I_indexterm11_d1e22642" class="indexterm"></a>45</code></td><td>Specifies the number of seconds a call will wait in the
              parking lot before timing out.</td></tr><tr><td><code class="literal">comebacktoorigin</code></td><td><code class="literal"><a id="I_indexterm11_d1e22654" class="indexterm"></a>yes</code></td><td>Configures the handling of timed-out parked calls. For
              more information on the behavior of this option, see the sidebar
              titled <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sidebar_comebacktoorigin" title="Handling Timed-Out Parked Calls with the comebacktoorigin Option">Handling Timed-Out Parked Calls with the comebacktoorigin
        Option</a>.</td></tr><tr><td><code class="literal">courtesytone</code></td><td><code class="literal"><a id="I_indexterm11_d1e22668" class="indexterm"></a>beep</code></td><td>Specifies the sound file to be played to the parked
              caller when the parked call is retrieved from the parking
              lot.</td></tr><tr><td><code class="literal">parkedplay</code></td><td><code class="literal"><a id="I_indexterm11_d1e22680" class="indexterm"></a>caller</code></td><td>Indicates which side of the call to play the <code class="literal">courtesytone</code> to when a parked call is
              picked up. Valid options include <code class="literal">callee</code>, <code class="literal">caller</code>, <code class="literal">both</code>, or <code class="literal">no</code>. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkedcalltransfers</code></td><td><code class="literal"><a id="I_indexterm11_d1e22711" class="indexterm"></a>caller</code></td><td>Controls which side of a call has the ability to execute
              a DTMF-based transfer in the call that results from picking up a
              parked call. Valid options include <code class="literal">callee</code>, <code class="literal">caller</code>, <code class="literal">both</code>, or <code class="literal">no</code>. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkedcallreparking</code></td><td><code class="literal"><a id="I_indexterm11_d1e22738" class="indexterm"></a>caller</code></td><td>Controls which side of a call has the ability to execute
              a DTMF-based park in the call that results from picking up a
              parked call.<sup>[<a id="id569180" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id569180" class="footnote">a</a>]</sup> Valid options include <code class="literal">callee</code>, <code class="literal">caller</code>, <code class="literal">both</code>, or <code class="literal">no</code>. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkedcallhangup</code></td><td><code class="literal"><a id="I_indexterm11_d1e22770" class="indexterm"></a>caller</code></td><td>Controls which side of a call has the ability to execute
              a DTMF-based hangup in the call that results from picking up a
              parked call. Valid options include <code class="literal">callee</code>, <code class="literal">caller</code>, <code class="literal">both</code>, or <code class="literal">no</code>. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkedcallrecording</code></td><td><code class="literal"><a id="I_indexterm11_d1e22798" class="indexterm"></a>caller</code></td><td>Controls which side of a call has the ability to initiate
              a DTMF-based one-touch recording in the call that results from
              picking up a parked call. Valid options include <code class="literal">callee</code>, <code class="literal">caller</code>, <code class="literal">both</code>, or <code class="literal">no</code>. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">parkeddynamic</code></td><td><code class="literal"><a id="I_indexterm11_d1e22825" class="indexterm"></a>yes</code></td><td>Enables the dynamic creation of parking lots in the
              dialplan. The channel variables <code class="literal">PARKINGDYNAMIC</code>, <code class="literal">PARKINGDYNCONTEXT</code>, and <code class="literal">PARKINGDYNPOS</code> need to be set.</td></tr><tr><td><code class="literal">adsipark</code></td><td><code class="literal"><a id="I_indexterm11_d1e22846" class="indexterm"></a>yes</code></td><td>Passes ADSI information regarding the parked call back to
              the originating set.</td></tr><tr><td><code class="literal">findslot</code></td><td><code class="literal"><a id="I_indexterm11_d1e22858" class="indexterm"></a>next</code></td><td>Configures the parking slot selection behavior. See <a class="link" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#findslot_detail">Parking Lots</a> for more
              details.</td></tr><tr><td><code class="literal">parkedmusicclass</code></td><td><code class="literal"><a id="I_indexterm11_d1e22872" class="indexterm"></a>default</code></td><td>Specifies the class to be used for the music on hold
              played to a parked caller. A music class set in the dialplan
              using the <code class="literal">CHANNEL(musicclass)</code>
              dialplan function will override this setting.</td></tr><tr><td><code class="literal">transferdigittimeout</code></td><td><code class="literal"><a id="I_indexterm11_d1e22887" class="indexterm"></a>3</code></td><td>Sets the number of seconds to wait for each digit from
              the caller executing a transfer.</td></tr><tr><td><code class="literal">xfersound</code></td><td><code class="literal"><a id="I_indexterm11_d1e22899" class="indexterm"></a>beep</code></td><td>Specifies the sound to be played to indicate that an
              attended transfer is complete.</td></tr><tr><td><code class="literal">xferfailsound</code></td><td><code class="literal"><a id="I_indexterm11_d1e22911" class="indexterm"></a>beeperr</code></td><td>Specifies the sound to be played to indicate that an
              attended transfer has failed to complete.</td></tr><tr><td><code class="literal">pickupexten</code></td><td><code class="literal"><a id="I_indexterm11_d1e22923" class="indexterm"></a>*8</code></td><td>Configures the extension used for call pickup.</td></tr><tr><td><code class="literal">pickupsound</code></td><td><code class="literal"><a id="I_indexterm11_d1e22935" class="indexterm"></a>beep</code></td><td>Specifies the sound to be played to indicate a successful
              call pickup attempt. No sound is played by default.</td></tr><tr><td><code class="literal">pickupfailsound</code></td><td><code class="literal"><a id="I_indexterm11_d1e22947" class="indexterm"></a>beeperr</code></td><td>Specifies the sound to be played to indicate a failed
              call pickup attempt. No sound is played by default.</td></tr><tr><td><code class="literal">featuredigittimeout</code></td><td><code class="literal"><a id="I_indexterm11_d1e22960" class="indexterm"></a>1000</code></td><td>Sets the number of milliseconds to wait in between digits
              pressed during a bridged call when matching against DTMF
              activated call features.</td></tr><tr><td><code class="literal">atxfernoanswertimeout</code></td><td><code class="literal"><a id="I_indexterm11_d1e22972" class="indexterm"></a>15</code></td><td>Configures the number of seconds to wait for the target
              of an attended transfer to answer before considering the attempt
              timed out.</td></tr><tr><td><code class="literal">atxferdropcall</code></td><td><code class="literal"><a id="I_indexterm11_d1e22984" class="indexterm"></a>no</code></td><td>Configures behavior of attended transfer call handling
              when the transferer hangs up before the transfer is complete and
              the transfer fails. By default, this option is set to <code class="literal">no</code> and a call will be originated to
              attempt to connect the transferee back to the caller that
              initiated the transfer. If set to <code class="literal">yes</code>, the call will be dropped after
              the transfer fails.</td></tr><tr><td><code class="literal">atxferloopdelay</code></td><td><code class="literal"><a id="I_indexterm11_d1e23002" class="indexterm"></a>10</code></td><td>Sets the number of seconds to wait in between callback
              retries if <code class="literal">atxferdropcall</code> is
              set to <code class="literal">no</code>.</td></tr><tr><td><code class="literal">atxfercallbackretries</code></td><td><code class="literal"><a id="I_indexterm11_d1e23020" class="indexterm"></a>2</code></td><td>Sets the number of callback attempts to make if <code class="literal">atxferdropcall</code> is set to <code class="literal">no</code>. By default, this is set to
              <code class="literal">2</code> callback attempts.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id569180" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id569180" class="para">a</a>] </sup>Read that again. It makes sense.</p></div></td></tr></tbody></table></div></div><br class="table-break"><div class="sidebar" title="Handling Timed-Out Parked Calls with the comebacktoorigin Option"><a id="sidebar_comebacktoorigin"></a><div class="titlepage"><div><div><p class="title"><strong>Handling Timed-Out Parked Calls with the comebacktoorigin
        Option</strong></p></div></div></div><p><a id="AdditionalConfig_id243639"></a><a id="I_indexterm11_d1e23039" class="indexterm"></a><a id="I_indexterm11_d1e23042" class="indexterm"></a><a id="I_indexterm11_d1e23045" class="indexterm"></a>This option configures the behavior of call parking when
        the parked call times out (see the <code class="literal">parkingtime</code> option). <code class="literal">comebacktoorigin</code> can have one of two
        values:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">yes</code> (default)</span></dt><dd><p>When the parked call timeout is exceeded, Asterisk will
              attempt to send the call back to the peer that parked this call.
              If the channel is no longer available to <span class="keep-together">Asterisk</span>, the caller will be
              disconnected.</p></dd><dt><span class="term"><code class="literal">no</code></span></dt><dd><p>This option would be used when you want to perform custom
              dialplan functionality on parked calls that have exceeded their
              timeouts. The caller will be sent into a specific area of the
              dialplan where logic can be applied to gracefully handle the
              remainder of the call (this may involve simply returning the
              call to a different extension, or performing a lookup of some
              sort).</p></dd></dl></div><p>You also may need to take into account calls where the
        originating channel cannot handle a returned parked call. If, for
        example, the call was parked by a channel that is also a trunk to
        another system, there would not be enough information to send the call
        back to the correct person on that other system. The actions following
        a timeout would be more complex than <code class="literal">comebacktoorigin=yes</code> could handle
        gracefully.</p><p><a id="AdditionalConfig_id243686"></a>Parked calls that time out with
        <code class="literal">comebacktoorigin=no</code> will always be
        sent into the <code class="literal">parkedcallstimeout</code>
        context.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AdditionalConfig_id243698"></a>The dialplan (and contexts)
            were discussed in detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics" title="Chapter 6. Dialplan Basics">Chapter&nbsp;6, <em>Dialplan Basics</em></a>.</p></div><p>The extension they will be sent to will be built from the
        name of the channel that parked the call. For example, if a SIP peer
        named <code class="literal">0004F2040808</code> parked this
        call, the extension will be <code class="literal">SIP_0004F2040808</code>.</p><p><a id="AdditionalConfig_id243712"></a>If this extension does not exist,
        the call will be sent to the <code class="literal">s</code>
        extension in the <code class="literal">parkedcallstimeout</code>
        context instead. Finally, if the <code class="literal">s</code>
        extension of <code class="literal">parkedcallstimeout</code>
        does not exist, the call will be sent to the <code class="literal">s</code> extension of the <code class="literal">default</code> context.</p><p><a id="AdditionalConfig_id243737"></a>Additionally, for any calls where
        <code class="literal">comebacktoorigin=no</code>, there will be
        an extension of <code class="literal">SIP_0004F2040808</code>
        created in the <code class="literal">park-dial</code> context.
        This extension will be set up to do a <code class="literal">Dial()</code> to <code class="literal">SIP/0004F2040808</code>.<a id="I_indexterm11_d1e23138" class="indexterm"></a><a id="I_indexterm11_d1e23139" class="indexterm"></a><a id="I_indexterm11_d1e23140" class="indexterm"></a><sup>[<a id="id570217" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id570217" class="footnote">98</a>]</sup></p></div></div><div class="sect2" title="The [featuremap] Section"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id243770"></a>The [featuremap] Section</h3></div></div></div><p><a id="AdditionalConfig_id243778"></a><a id="I_indexterm11_d1e23151" class="indexterm"></a><a id="I_indexterm11_d1e23158" class="indexterm"></a><a id="I_indexterm11_d1e23163" class="indexterm"></a>This section allows you to define specific DTMF sequences,
      which will trigger various features on channels that have been bridged
      via options in the <code class="literal">Dial()</code> or <code class="literal">Queue()</code> application. The options are detailed
      in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243783" title="Table 11.2. features.conf [featuremap] section">Table&nbsp;11.2, “features.conf [featuremap] section”</a>.</p><div class="table"><a id="AdditionalConfig_id243783"></a><p class="title"><strong>Table&nbsp;11.2.&nbsp;features.conf [featuremap] section</strong></p><div class="table-contents"><table summary="features.conf [featuremap] section" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th><th align="center">Dial()/Queue() Flags</th></tr></thead><tbody><tr><td><code class="literal">blindxfer</code></td><td><code class="literal"><a id="I_indexterm11_d1e23197" class="indexterm"></a>#1</code></td><td>Invokes a blind (unsupervised) transfer</td><td><code class="literal">T, t</code></td></tr><tr><td><code class="literal">disconnect</code></td><td><code class="literal"><a id="I_indexterm11_d1e23212" class="indexterm"></a>*0</code></td><td>Hangs up the call</td><td><code class="literal">H, h</code></td></tr><tr><td><code class="literal">automon</code></td><td><code class="literal"><a id="I_indexterm11_d1e23227" class="indexterm"></a>*1</code></td><td>Starts recording of the current call using the <code class="literal">Monitor()</code> application (pressing this
              key sequence a second time stops the <span class="keep-together">recording</span>)</td><td><code class="literal">W, w</code></td></tr><tr><td><code class="literal">atxfer</code></td><td><code class="literal"><a id="I_indexterm11_d1e23248" class="indexterm"></a>*2</code></td><td>Performs an automated transfer</td><td><code class="literal">T, t</code></td></tr><tr><td><code class="literal">parkcall</code></td><td><code class="literal"><a id="I_indexterm11_d1e23263" class="indexterm"></a>#72</code></td><td>Parks a call</td><td><code class="literal">K, k</code></td></tr><tr><td><code class="literal">automixmon</code></td><td><code class="literal"><a id="I_indexterm11_d1e23278" class="indexterm"></a>*3</code></td><td>Starts recording of the current call using the <code class="literal">MixMonitor()</code> application (pressing
              this key sequence again stops the recording)</td><td><code class="literal">X, x</code></td></tr></tbody></table></div></div><br class="table-break"><p><a id="AdditionalConfig_id243930"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AdditionalConfig_id243933"></a>The default <a id="I_indexterm11_d1e23294" class="indexterm"></a><code class="literal">blindxfer</code> and
          <code class="literal">disconnect</code> codes are <code class="literal"><code class="literal">#</code></code> and
          <code class="literal"><code class="literal">*</code></code>, respectively. Normally you’ll
          want to change them from the defaults, as they will interfere with
          other things that you might want to do (for example, if you use the
          <code class="literal">Tt</code> option in your <span class="application"><code class="literal">Dial()</code></span> command, every time
          you press the <code class="literal">#</code> key you’ll
          initiate a transfer).</p></div></div><div class="sect2" title="The [applicationmap] Section"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id243954"></a>The [applicationmap] Section</h3></div></div></div><p><a id="AdditionalConfig_id243963"></a><a id="I_indexterm11_d1e23328" class="indexterm"></a><a id="I_indexterm11_d1e23335" class="indexterm"></a><a id="I_indexterm11_d1e23340" class="indexterm"></a>This section of <code class="filename">features.conf</code> allows you to map DTMF codes to
      dialplan applications. The caller will be placed on hold until the
      application has completed execution.</p><p><a id="AdditionalConfig_id243968"></a>The syntax for defining an
      application map is as follows (it must appear on a single line; line
      breaks are not allowed)<sup>[<a id="id570802" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id570802" class="footnote">99</a>]</sup>:</p><p><a id="AdditionalConfig_id243979"></a><a id="AdditionalConfig_id392068"></a></p><pre class="programlisting">&lt;<em class="replaceable"><code>FeatureName</code></em>&gt; =&gt; &lt;<em class="replaceable"><code>DTMF_sequence</code></em>&gt;,&lt;<em class="replaceable"><code>ActivateOn</code></em>&gt;[/&lt;<em class="replaceable"><code>ActivatedBy</code></em>&gt;]
,&lt;<em class="replaceable"><code>Application</code></em>&gt;([&lt;<em class="replaceable"><code>AppArguments</code></em>&gt;])[,<em class="replaceable"><code>MOH_Class</code></em>]</pre><p><a id="AdditionalConfig_id243985"></a>What you are doing is the
      following:</p><div class="orderedlist"><a id="AdditionalConfig_id243989"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="AdditionalConfig_id243991"></a><a id="AdditionalConfig_id243993"></a>Giving your map a name so that
          it can be enabled in the dialplan through the use of the <code class="literal">DYNAMIC_FEATURES</code> channel variable.</p></li><li class="listitem"><p><a id="AdditionalConfig_id244002"></a><a id="AdditionalConfig_id244004"></a>Defining the DTMF sequence that
          activates this feature (we recommend using at least two digits for
          this).</p></li><li class="listitem"><p><a id="AdditionalConfig_id256845"></a><a id="AdditionalConfig_id256847"></a>Defining which channel the
          feature will be activated on, and (optionally) which participant is
          allowed to activate the feature (the default is to allow both
          channels to use/activate this feature).</p></li><li class="listitem"><p><a id="AdditionalConfig_id256853"></a><a id="AdditionalConfig_id256855"></a>Giving the name of the
          application that this map will trigger, and its arguments.</p></li><li class="listitem"><p><a id="AdditionalConfig_id256860"></a><a id="AdditionalConfig_id256862"></a>Providing an optional music on
          hold (MOH) class to assign to this feature (which the opposite
          channel will hear when the application is executing). If you do not
          define any MOH class, the caller will hear only silence.</p></li></ol></div><p><a id="AdditionalConfig_id256870"></a>Here is an example of an
      application map that will trigger an AGI script:<a id="I_indexterm11_d1e23401" class="indexterm"></a></p><p><a id="AdditionalConfig_id256874"></a><a id="AdditionalConfig_id256875"></a></p><pre class="programlisting">agi_test =&gt; *6,self/callee,AGI(agi-test.agi),default</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AdditionalConfig_id256881"></a>Since applications spawned from
        the application map are run outside the PBX core, you cannot execute
        any applications that trigger the <span class="keep-together">dial</span><span class="keep-together">plan</span> (such as <code class="literal">Goto()</code>, <code class="literal">Macro()</code>, <code class="literal">Background()</code>, etc.). If you wish to use the
        application map to spawn external processes (including executing
        dialplan code), you will need to trigger an external application
        through an <code class="literal">AGI()</code> call or the
        <code class="literal">System()</code> application. Point being,
        if you want anything complex to happen through the use of an
        application map, you will need to test very carefully, as not all
        things will work as you <span class="keep-together">might
        expect</span>.</p></div><p><a id="AdditionalConfig_id256907"></a>To use an application map, you must
      declare it in the dialplan by setting the <code class="literal">DYNAMIC</code><code class="literal">_</code><code class="literal">FEATURES</code> variable <a id="I_indexterm11_d1e23445" class="indexterm"></a>somewhere before the <code class="literal">Dial()</code> command that connects the channels. Use
      the double underscore modifier on the variable name in order to ensure
      that the application map is available to both channels throughout the
      life of the call. For example:</p><p><a id="AdditionalConfig_id256928"></a><a id="AdditionalConfig_id256929"></a></p><pre class="programlisting">exten =&gt; 101,n,Set(__DYNAMIC_FEATURES=agi_test)
exten =&gt; 101,n,Dial(SIP/0000FFFF0002)
</pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AdditionalConfig_id256934"></a>If you want to allow more than
          one application map to be available on a call, you will need to use
          the <code class="literal">#</code> symbol <a id="I_indexterm11_d1e23461" class="indexterm"></a><a id="I_indexterm11_d1e23466" class="indexterm"></a>as a delimiter between multiple map names:</p><table border="0" summary="Simple list" class="simplelist"><tbody><tr><td><code class="literal">Set(__DYNAMIC_FEATURES=agi_test#my_other_map)</code></td></tr></tbody></table><p>The reason why the <code class="literal"><code class="literal">#</code></code> character was chosen instead
          of a simple comma is that older versions of the <code class="literal">Set()</code> application interpreted the comma
          differently than more recent versions, and the syntax for
          application maps has never been updated.</p></div><p><a id="AdditionalConfig_id256959"></a>Don’t forget to reload the features
      module after making changes to the <code class="filename">features.conf</code> file:</p><a id="I_programlisting11_d1e23491"></a><pre class="programlisting">*CLI&gt; <strong class="userinput"><code>features reload</code></strong></pre><p><a id="AdditionalConfig_id256971"></a>You can verify that your changes
      have taken place through the CLI command <span class="command"><strong>features show</strong></span><a id="I_indexterm11_d1e23499" class="indexterm"></a><a id="I_indexterm11_d1e23502" class="indexterm"></a>. Make sure you test out your application map before you
      turn it over to your users!</p><div class="sidebar" title="Inheriting Channel Variables"><a id="I_sidebar11_d1e23509"></a><div class="titlepage"><div><div><p class="title"><strong>Inheriting Channel Variables</strong></p></div></div></div><p>Channel variables are always associated with the original
        channel that set them, and are no longer available once the channel is
        transferred.</p><p>In order to allow channel variables to follow the channel as it
        is transferred among the system, channel variable inheritance must be
        employed. There are two modifiers that can allow the channel variable
        to follow the channel: single underscore and double underscore.</p><p>The single underscore (<code class="literal">_</code>)
        causes the channel variable to be inherited by the channel for a
        single transfer, and is no longer available for additional transfers.
        If you use a double underscore (<code class="literal">__</code>), the channel variable will be inherited
        throughout the life of that <span class="keep-together">channel</span>.</p><p>Setting channel variables for inheritance simply requires you to
        prefix the channel name with a single or double underscore. The
        channel variables are then referenced exactly the same as they would
        be normally (e.g., do not attempt to read the values of channel
        variables with the underscores in the variable name).</p><p>Here’s an example of setting a channel variable for single
        transfer inheritance:</p><a id="I_programlisting11_d1e23531"></a><pre class="programlisting">exten =&gt; <em class="replaceable"><code>example</code></em>,1,<em class="replaceable"><code>Set</code></em>(_<em class="replaceable"><code>MyVariable</code></em>=<em class="replaceable"><code>thisValue</code></em>)</pre><p>Here’s an example of setting a channel variable for infinite
        transfer inheritance:</p><a id="I_programlisting11_d1e23547"></a><pre class="programlisting">exten =&gt; <em class="replaceable"><code>example</code></em>,1,<em class="replaceable"><code>Set</code></em>(__<em class="replaceable"><code>MyVariable</code></em>=<em class="replaceable"><code>thisValue</code></em>)</pre><p>To read the value of the channel variable, do not use
        underscore(s):</p><a id="I_programlisting11_d1e23563"></a><pre class="programlisting">exten =&gt; <em class="replaceable"><code>example</code></em>,1,Verbose(1,<em class="replaceable"><code>Value of MyVariable is</code></em>: ${<em class="replaceable"><code>MyVariable</code></em>})</pre></div></div><div class="sect2" title="Application Map Grouping"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id256980"></a>Application Map Grouping</h3></div></div></div><p><a id="AdditionalConfig_id256986"></a><a id="I_indexterm11_d1e23578" class="indexterm"></a><a id="I_indexterm11_d1e23585" class="indexterm"></a><a id="I_indexterm11_d1e23590" class="indexterm"></a><a id="I_indexterm11_d1e23593" class="indexterm"></a>If you have a lot of features that you need to activate
      for a particular context or extension, you can group several features
      together in an application map grouping, so that one assignment of the
      <code class="literal">DYNAMIC_FEATURES</code> variable <a id="I_indexterm11_d1e23600" class="indexterm"></a>will assign all of the designated features of that
      map.</p><p><a id="AdditionalConfig_id256992"></a>The application map groupings are
      added at the end of the <code class="filename">features.conf</code> file. Each grouping is given a
      name, and then the relevant features are listed.</p><p><a id="AdditionalConfig_id256996"></a><a id="AdditionalConfig_id256997"></a></p><pre class="programlisting">[shifteight]
unpauseMonitor =&gt; *1    ; custom key mapping
pauseMonitor =&gt; *2      ; custom key mapping
agi_test =&gt;             ; no custom key mapping

</pre><p><a id="AdditionalConfig_id257002"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AdditionalConfig_id257006"></a>If you want to specify a custom
          key mapping to a feature in an application map grouping, simply
          follow the <code class="literal">=&gt;</code> with the key
          mapping you want. If you do not specify a key mapping, the default
          key map for that feature will be used (as found in the <code class="literal">[featuremap]</code> section). Regardless of
          whether you want to assign a custom key mapping or not, the <code class="literal">=&gt;</code> operator is required.</p></div><p>In the dialplan, you would assign this application map grouping
      with the <code class="literal">Set()</code> <span class="keep-together">application</span>:</p><p><a id="AdditionalConfig_id257026"></a><a id="AdditionalConfig_id257027"></a></p><pre class="programlisting">Set(__DYNAMIC_FEATURES=shifteight) ; use the double underscore if you want to ensure
                                   ; both call legs have the variable assigned.
</pre></div><div class="sect2" title="Parking Lots"><div class="titlepage"><div><div><h3 class="title"><a id="parkingLots"></a>Parking Lots</h3></div></div></div><p><a id="AdditionalConfig_id257070"></a><a id="I_indexterm11_d1e23639" class="indexterm"></a><a id="I_indexterm11_d1e23646" class="indexterm"></a>A parking lot allows a call to be held in the system
      without being associated with a particular extension. The call can then
      be retrieved by anyone who knows the park code for that call. This
      feature is often used in conjunction with an overhead paging system (PA
      system, or Tannoy, for our UK readers). For this reason, it is often
      referred to as park-and-page; however, it should be noted that parking
      and paging are in fact separate.</p><p><a id="AdditionalConfig_id257077"></a>To park a call in Asterisk, you
      need to transfer the caller to the feature code assigned to parking,
      which is assigned in the <code class="filename">features.conf</code> file with the <code class="literal">parkext</code> directive. By default, this is
      <code class="literal">700</code>:</p><a id="AdditionalConfig_id257092"></a><pre class="programlisting">parkext =&gt; 700      ; What extension to dial to park (all parking lots)</pre><p><a id="AdditionalConfig_id257097"></a>You have to wait to complete the
      transfer until you get the number of the parking retrieval slot from the
      system, or you will have no way of retrieving the call. By default the
      retrieval slots, assigned with the <code class="literal">parkpos</code> directive in <code class="filename">features.conf</code>, are numbered from
      701–720:</p><p><a id="AdditionalConfig_id257112"></a><a id="AdditionalConfig_id257113"></a></p><pre class="programlisting">parkpos =&gt; 701-720  ; What extensions to park calls on (defafult parking lot)</pre><p>Once
      the call is parked, anyone on the system can retrieve it by dialing the
      number of the retrieval slot (<code class="literal">parkpos</code>) assigned to that call. The call will
      then be bridged to the channel that dialed the retrieval code.</p><p><a id="AdditionalConfig_id257124"></a>There are two common ways to define
      how retrieval slots are assigned. This is done with the <code class="literal"><a id="findslot_detail"></a>findslot</code> directive
      <a id="I_indexterm11_d1e23685" class="indexterm"></a>in the <code class="filename">features.conf
      </code>file. The default method (<code class="literal">findslot
      =&gt; first</code>) always uses the lowest-numbered slot if it is
      available, and only assigns higher-numbered codes if required. The
      second method (<code class="literal">findslot =&gt; next</code>)
      will rotate through the retrieval codes with each successive park,
      returning to the first retrieval code after the last one has been used.
      Which method you choose will depend on how busy your parking lots are.
      If you use parking rarely, the default <code class="literal">findslot</code> of <code class="literal">first</code> will be best (people will be used to
      their parked calls always being in the same slot). If you use parking a
      lot (for example, in an automobile dealership), on the other hand, it is
      far better for each successive page to assign the next slot, since you
      will often have more than one call parked at a time. Your users will get
      used to listening carefully to the actual parking lot number (instead of
      just always dialing <code class="literal">701</code>), and this
      will minimize the chance of people accidentally retrieving the wrong
      call on a busy system.</p><p><a id="AdditionalConfig_id257160"></a>If you are using parking, you are
      probably also going to need a way to announce the parked calls so that
      the intended parties know how to retrieve them. While you could just run
      down the hall yelling “Bob, there’s a call for you on 701!,” the more
      professional method is to use a paging system (more formally known as a
      public address system), which we will discuss in the next
      section.<a id="I_indexterm11_d1e23710" class="indexterm"></a><a id="I_indexterm11_d1e23711" class="indexterm"></a><a id="I_indexterm11_d1e23712" class="indexterm"></a></p></div></div><div class="sect1" title="Overhead and “Underchin” Paging (a.k.a. Public Address)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AdditionalConfig_id257169"></a>Overhead and “Underchin” Paging (a.k.a. Public Address)</h2></div></div></div><p><a id="AdditionalConfig_id257175"></a><a id="index-822U043WS4D" class="indexterm"></a><a id="index-254H312IW6Q" class="indexterm"></a><a id="index-168N366IQ4P" class="indexterm"></a><a id="index-352K135EW8V" class="indexterm"></a>In many PBX systems, it is desirable to be able to allow a
    user to send his voice from a telephone into a public address system. This
    normally involves dialing a feature code or extension that makes a
    connection to a public address resource of some kind, and then making an
    announcement through the handset of the telephone that is broadcast to all
    devices associated with that paging resource. Often, this will be an
    external paging system consisting of an amplifier connected to overhead
    speakers; however, paging through the speakers of office telephones is
    also popular (mainly for cost reasons). If you have the budget (or an
    existing overhead paging system), overhead paging <a id="I_indexterm11_d1e23730" class="indexterm"></a>is generally better, but set paging (a.k.a. “underchin”
    paging) can work well in many environments. What is perhaps most common is
    to have a mix of set and overhead paging, where, for example, set-based
    paging might be in use for offices, but overhead paging would be used for
    warehouse, hallway, and public areas (cafeteria, reception, etc.).</p><p><a id="AdditionalConfig_id257187"></a>In Asterisk, the <code class="literal">Page()</code> application<a id="I_indexterm11_d1e23739" class="indexterm"></a> is used for paging. This application simply takes a list of
    channels as its argument, calls all of the listed channels simultaneously,
    and, as they are answered, puts each one into a conference room. With this
    in mind, it becomes obvious that one requirement for paging to work is
    that <span class="emphasis"><em>each destination channel must be able to automatically
    answer the incoming connection</em></span> and place the resultant audio
    onto a speaker of some sort (in other words, <code class="literal">Page()</code> won’t work if all the phones just
    ring).</p><p><a id="AdditionalConfig_id257205"></a>So, while the <code class="literal">Page()</code> application itself is painless and simple
    to use, getting all the destination channels to handle the incoming pages
    correctly is a bit trickier. We’ll get to that shortly.</p><p><a id="AdditionalConfig_id257213"></a>The <code class="literal">Page()</code> application takes three arguments,
    defining the group of channels the page is to be connected to, the
    options, and the timeout:</p><a id="AdditionalConfig_id257218"></a><pre class="programlisting">exten =&gt; *724,1,Page(${ChannelsToPage},i,120)</pre><p><a id="AdditionalConfig_id257222"></a>The options (outlined in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257235" title="Table 11.3. Page() options">Table&nbsp;11.3, “Page() options”</a>) give you some flexibility with
    respect to how <code class="literal">Page()</code> works, but the
    majority of the configuration is going to have to do with how the target
    devices handle the incoming connection. We’ll dive into the various ways
    you can configure devices to receive pages in the next section.</p><div class="table"><a id="AdditionalConfig_id257235"></a><p class="title"><strong>Table&nbsp;11.3.&nbsp;Page() options</strong></p><div class="table-contents"><table summary="Page() options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Option</th><th>Description</th><th>Discussion</th></tr></thead><tbody><tr><td><code class="literal">d</code></td><td><a id="I_indexterm11_d1e23788" class="indexterm"></a>Enables full-duplex audio</td><td>Sometimes referred to as “talkback paging,” the use of this
            option implies that the equipment that receives the page has the
            ability to transmit audio back at the same time as it is receiving
            audio. Generally, you would not want to use this unless you had a
            specific need for it.</td></tr><tr><td><code class="literal">i</code></td><td><a id="I_indexterm11_d1e23799" class="indexterm"></a>Ignores attempts to forward the call</td><td>You would normally want this option enabled.</td></tr><tr><td><code class="literal">q</code></td><td><a id="I_indexterm11_d1e23810" class="indexterm"></a>Does not play beep to caller (quiet mode)</td><td>Normally you won’t use this, but if you have an external
            amplifier that provides its own tone, you may want to set this
            option.</td></tr><tr><td><code class="literal">r</code></td><td><a id="I_indexterm11_d1e23821" class="indexterm"></a>Records the page into a file</td><td>If you intended on using the same page multiple times in
            the future, you could record the page and then use it again later
            by triggering it using <code class="literal">Originate()</code> or using the <code class="literal">A(x)</code> option to <code class="literal">Page()</code>.</td></tr><tr><td><code class="literal">s</code></td><td><a id="I_indexterm11_d1e23841" class="indexterm"></a>Dials a channel only if the device state is <code class="literal">NOT_INUSE</code></td><td>This option is likely only useful (and reliable) on
            SIP-bound channels, and even so may not work if a single line is
            allowed multiple calls on it. Therefore, don’t rely on this option
            in all cases.</td></tr><tr><td><code class="literal">A(x)</code></td><td><a id="I_indexterm11_d1e23854" class="indexterm"></a>Plays announcement <code class="literal">x</code> to all participants</td><td>You could use a previously recorded file to be played over
            the paging system. If you combined this with <code class="literal">Originate()</code> and <code class="literal">Record()</code>, you could implement a delayed
            paging system.</td></tr><tr><td><code class="literal">n</code></td><td><a id="I_indexterm11_d1e23874" class="indexterm"></a>Does not play announcement simultaneously to caller
            (implies <code class="literal">A(x)</code>)</td><td>By default the system will play the paged audio to both the
            caller and the callee. If this option is enabled, the paged audio
            will not be played to the caller (the person paging).</td></tr></tbody></table></div></div><br class="table-break"><p><a id="AdditionalConfig_id257368"></a>Because of how <code class="literal">Page()</code> works, it is very resource-intensive. We
    cannot stress this enough. Carefully read on, and we’ll cover how to
    ensure that paging does not cause performance problems in a production
    environment (which it is almost certain to do if not designed
    correctly).</p><div class="sect2" title="Places to Send Your Pages"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id265355"></a>Places to Send Your Pages</h3></div></div></div><p><a id="AdditionalConfig_id265360"></a><a id="index-728V187KQ6O" class="indexterm"></a>As we stated before, <code class="literal">Page()</code> is in and of itself very simple. The
      trick is how to bring it all together. Pages can be sent to different
      kinds of channels, and they all require different configuration.</p><div class="sect3" title="External paging"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id265366"></a>External paging</h4></div></div></div><p><a id="AdditionalConfig_id265371"></a><a id="I_indexterm11_d1e23905" class="indexterm"></a><a id="I_indexterm11_d1e23912" class="indexterm"></a>If a public address system is installed in the building,
        it is common to connect the telephone system to an external amplifier
        and send pages to it through a call to a channel. One way of doing
        this is to plug the sound card of your server into the amplifier and
        send calls to the channel named <code class="literal">Console/DSP</code><a id="I_indexterm11_d1e23918" class="indexterm"></a>, but this assumes that the sound drivers on your server
        are working correctly and the audio levels are normalized correctly on
        that channel. Another, potentially simpler, and possibly more robust
        way to handle external paging is to use an FXS device of some kind
        (such as an ATA), which is connected to a paging interface such as a
        Bogen UTI1,<a id="I_indexterm11_d1e23922" class="indexterm"></a><sup>[<a id="id572537" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id572537" class="footnote">100</a>]</sup> which then connects to the paging amplifier.<sup>[<a id="id572547" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id572547" class="footnote">101</a>]</sup></p><p><a id="AdditionalConfig_id265397"></a>In your dialplan, paging to an
        external amplifier would look like a simple <code class="literal">Dial()</code> to the device that is connected to
        the paging equipment. For example, if you had an ATA configured in
        <code class="filename">sip.conf</code> as <code class="literal">[PagingATA]</code>, and you plugged the ATA into a
        Bogen UTI1, you would perform paging by dialing:</p><p><a id="AdditionalConfig_id265413"></a><a id="AdditionalConfig_id265414"></a></p><pre class="programlisting">exten =&gt; *724,1,Verbose(2,Paging to external amplifier) ; note the '*' in the 
                                                        ; extension is part of 
                                                        ; what you actually dial
   same =&gt; n,Set(PageDevice=SIP/PagingATA)
   same =&gt; n,Page(${PageDevice},i,120)</pre><p>Note that for this
        to work you will have had to register your ATA as a SIP device under
        <code class="filename">sip.conf</code>, and in this case we
        named the device <code class="literal">[PagingATA]</code>. You
        can name this device anything you want (for example, we often use the
        MAC address as the name of a SIP device), but for anything that is not
        a user telephone, it can be helpful to use a name that makes it stand
        out from other devices.</p><p><a id="AdditionalConfig_id257521"></a>If you had an FXS card in your
        system and you connected the UTI1 to that, you would <code class="literal">Dial()</code> to the channel for that FXS port
        instead:</p><p><a id="AdditionalConfig_id257526"></a><a id="AdditionalConfig_id257527"></a></p><pre class="programlisting">   same =&gt; n,Dial(DAHDI/25)</pre><p><a id="AdditionalConfig_id257531"></a>The UTI1 answers the call and
        opens a channel to the paging system; you then make your announcement
        and hang up.</p></div><div class="sect3" title="Set paging"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id257536"></a>Set paging</h4></div></div></div><p><a id="AdditionalConfig_id257541"></a><a id="I_indexterm11_d1e23967" class="indexterm"></a><a id="I_indexterm11_d1e23974" class="indexterm"></a>Set-based paging first became popular in key telephone
        systems, where the speakers of the office telephones are used as a
        poor-man’s public address system. Most SIP telephones have the ability
        to auto-answer a call on handsfree, which accomplishes what is
        required on a per-telephone basis. In addition to this, however, it is
        necessary to pass the audio to more than one set at the same time.
        Asterisk uses its built-in conferencing engine to handle the
        under-the-hood details. You use the <code class="literal">Page()</code> application <a id="I_indexterm11_d1e23981" class="indexterm"></a><a id="I_indexterm11_d1e23984" class="indexterm"></a>to make it happen.</p><p><a id="AdditionalConfig_id257553"></a>Like <code class="literal">Dial()</code>, the <code class="literal">Page()</code> application can handle several
        channels. Since you will generally want <code class="literal">Page()</code> to signal several sets at once
        (perhaps even all the sets on your system) you may end up with lengthy
        device strings that look something like this:</p><p><a id="AdditionalConfig_id257568"></a><a id="AdditionalConfig_id257569"></a></p><pre class="programlisting">Page(SIP/SET1&amp;SIP/SET2&amp;SIP/SET3&amp;SIP/SET4&amp;SIP/SET5&amp;SIP/SET6&amp;SIP/SET7&amp;...</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="AdditionalConfig_id257576"></a><a id="I_indexterm11_d1e24006" class="indexterm"></a>Beyond a certain size, your Asterisk system will be
          unable to page multiple sets. For example, in an office with 200
          telephones, using SIP to page every set would not be possible; the
          traffic and CPU load on your Asterisk server would simply be too
          much. In cases like this, you should be looking at either multicast
          paging or external paging.</p></div><p><a id="AdditionalConfig_id257587"></a>Perhaps the trickiest part of
        SIP-based paging <a id="I_indexterm11_d1e24014" class="indexterm"></a>is the fact that you usually have to tell each set that
        it must auto-answer, but different manufacturers of SIP telephones use
        different SIP messages for this purpose. So, depending on the
        telephone model you are using, the commands needed to accomplish
        SIP-based set paging will be different. Here are some examples:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For Aastra:<a id="I_indexterm11_d1e24022" class="indexterm"></a></p><a id="AdditionalConfig_id257598"></a><pre class="programlisting">exten =&gt; *724,1,Verbose(2,Paging to Aastra sets)
   same =&gt; n,SIPAddHeader(Alert-Info: info=alert-autoanswer)
   same =&gt; n,Set(PageDevice=SIP/00085D000000)
   same =&gt; n,Page(${PageDevice},i)</pre></li><li class="listitem"><p>For Polycom:<a id="I_indexterm11_d1e24030" class="indexterm"></a></p><a id="AdditionalConfig_id257608"></a><pre class="programlisting">exten =&gt; *724,1,Verbose(2,Paging to Polycom sets)
   same =&gt; n,SIPAddHeader(Alert-Info: Ring Answer)
   same =&gt; n,Set(PageDevice=SIP/0004F2000000)
   same =&gt; n,Page(${PageDevice},i)</pre></li><li class="listitem"><p>For Snom:<a id="I_indexterm11_d1e24038" class="indexterm"></a></p><a id="AdditionalConfig_id257619"></a><pre class="programlisting">exten =&gt; *724,1,Verbose(2,Paging to Snom sets)
   same =&gt; n,Set(VXML_URL=intercom=true)

; replace 'domain.com' with the domain of your system
   same =&gt; n,SIPAddHeader(Call-Info: sip:domain.com\;answer-after=0)
   same =&gt; n,Set(PageDevice=SIP/000413000000)
   same =&gt; n,Page(${PageDevice},i)</pre></li><li class="listitem"><p>For Cisco SPA <a id="I_indexterm11_d1e24046" class="indexterm"></a>(the former Linksys phones,<a id="I_indexterm11_d1e24052" class="indexterm"></a> not the 79XX series):</p><a id="AdditionalConfig_id257632"></a><pre class="programlisting">exten =&gt; *724,1,Verbose(2,Paging to Cisco SPA sets -- but not Cisco 79XX sets)
   same =&gt; n,SIPAddHeader(Call-Info:\;answer-after=0)        ; Cisco SPA phones
   same =&gt; n,Set(PageDevice=SIP/0004F2000000)
   same =&gt; n,Page(${PageDevice},i)</pre></li></ul></div><p><a id="AdditionalConfig_id257639"></a>Assuming you’ve figured that out,
        what happens if you have a mix of phones in your environment? How do
        you control which headers to send to which phones?<sup>[<a id="id573007" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id573007" class="footnote">102</a>]</sup></p><p><a id="AdditionalConfig_id257649"></a>Any way you slice it, it’s not
        pretty.</p><p><a id="AdditionalConfig_id257652"></a>Fortunately, many of these sets
        support IP multicast,<a id="I_indexterm11_d1e24068" class="indexterm"></a> which is a far better way to send a page to multiple
        sets (read on for details). Still, if you only have a few phones on
        your system and they are all from the same manufacturer, SIP-based
        paging could be the simplest, so we don’t want to scare you off it
        completely.</p></div><div class="sect3" title="Multicast paging via the MulticastRTP channel"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id257664"></a>Multicast paging via the MulticastRTP channel</h4></div></div></div><p><a id="AdditionalConfig_id257669"></a><a id="I_indexterm11_d1e24078" class="indexterm"></a><a id="I_indexterm11_d1e24085" class="indexterm"></a>If you are serious about paging through the sets on your
        system, and you have more than a handful of phones, you will need to
        look at using IP multicast. The concept of IP multicast <a id="I_indexterm11_d1e24091" class="indexterm"></a>has been around for a long time,<sup>[<a id="id573122" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id573122" class="footnote">103</a>]</sup> but it has not been widely used. Nevertheless, it is
        ideal for paging within a single location.</p><p><a id="AdditionalConfig_id257690"></a>Asterisk has a channel (<code class="literal">chan_multicast_rtp</code>)<a id="I_indexterm11_d1e24108" class="indexterm"></a> that is designed to create an RTP multicast.<a id="I_indexterm11_d1e24112" class="indexterm"></a> This stream is then subscribed to by the various
        phones, and the result is that whenever media appears on the multicast
        stream, the phones will pass that media to their speakers.</p><p><a id="AdditionalConfig_id257695"></a>Since <code class="literal">MulticastRTP</code> is a channel driver, it does
        not have an application, but instead will work anywhere in the
        dialplan that you might otherwise use a channel. In our case, we’ll be
        using the <code class="literal">Page()</code> application to
        initiate our multicast.</p><p><a id="AdditionalConfig_id257704"></a>To use the multicast channel, you
        simply send a call to it the same as you would to any other channel.
        The syntax for the channel is as follows:</p><p><a id="AdditionalConfig_id257708"></a><a id="AdditionalConfig_id257709"></a></p><pre class="programlisting">MulticastRTP/&lt;type&gt;/&lt;ip address:port&gt;[/&lt;linksys address:port&gt;]</pre><p><a id="AdditionalConfig_id257714"></a>The type can be either <code class="literal">basic</code> or <code class="literal">linksys</code>. The basic syntax of the <code class="literal">MulticastRTP</code> channel looks like this:</p><p><a id="AdditionalConfig_id257718"></a><a id="AdditionalConfig_id257719"></a></p><pre class="programlisting">exten =&gt; *723,1,Page(MulticastRTP/basic/239.0.0.1:1234)</pre><p><a id="AdditionalConfig_id257723"></a>Not all sets support IP
        multicast, but we have tested it out on Snom,<sup>[<a id="id573276" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id573276" class="footnote">104</a>]</sup> Linksys/Cisco, and Aastra, and it works swell.<sup>[<a id="id573283" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id573283" class="footnote">105</a>]</sup></p><div class="sidebar" title="Multicast Paging on Cisco SPA Telephones"><a id="AdditionalConfig_id257742"></a><div class="titlepage"><div><div><p class="title"><strong>Multicast Paging on Cisco SPA Telephones</strong></p></div></div></div><p><a id="AdditionalConfig_id257747"></a>The multicast paging <a id="I_indexterm11_d1e24160" class="indexterm"></a>feature on Cisco SPA phones <a id="I_indexterm11_d1e24166" class="indexterm"></a>is a bit strange, but once configured it works fine.
          The trick of it is that the address you put into the phone is not
          the multicast address that the page is sent across, but rather a
          sort of signaling channel.</p><p><a id="AdditionalConfig_id257753"></a>What we have found is that you
          can make this address the same as the multicast address, but simply
          use a different port number.</p><p><a id="AdditionalConfig_id257758"></a>The dialplan looks like
          this:</p><p><a id="AdditionalConfig_id257761"></a><a id="AdditionalConfig_id257762"></a></p><pre class="programlisting">exten =&gt; *724,1,Page(MulticastRTP/linksys/239.0.0.1:1234/239.0.0.1:6061)</pre><p>In
          the SPA phone, you need to log into the Administration interface and
          navigate to the <code class="interfacename">SIP</code> tab. At the very
          bottom of the page you will find the section called
          <span class="emphasis"><em>Linksys Key System Parameters</em></span><a id="I_indexterm11_d1e24185" class="indexterm"></a>. You need to set the following parameters:</p><div class="itemizedlist"><a id="AdditionalConfig_id257777"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="AdditionalConfig_id257779"></a><a id="AdditionalConfig_id257782"></a><code class="literal">Linksys Key System:</code> <code class="literal">Yes</code></p></li><li class="listitem"><p><a id="AdditionalConfig_id257788"></a><a id="AdditionalConfig_id257790"></a><code class="literal">Multicast Address:</code> <code class="literal">239.0.0.1:6061</code></p></li></ul></div><p><a id="AdditionalConfig_id257798"></a>Note that the multicast address
          you assign to the phone is the one that comes second in the channel
          definition (in our example, the one using port 6061).</p><p><a id="AdditionalConfig_id257803"></a>Note that you can write the
          <code class="literal">Page()</code> command <a id="I_indexterm11_d1e24211" class="indexterm"></a><a id="I_indexterm11_d1e24214" class="indexterm"></a>in this format in an environment where there is a mix
          of SPA phones (FKA Linksys, now Cisco) phones and other types of
          phones. The other phones will use the first address and will work
          the same as if you had used <code class="literal">basic</code>
          instead of <code class="literal">linksys</code>.</p></div></div><div class="sect3" title="VoIP paging adaptors"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id257823"></a>VoIP paging adaptors</h4></div></div></div><p><a id="AdditionalConfig_id257829"></a><a id="I_indexterm11_d1e24230" class="indexterm"></a><a id="I_indexterm11_d1e24237" class="indexterm"></a><a id="I_indexterm11_d1e24242" class="indexterm"></a>Recently, there have been some VoIP-based paging
        speakers introduced to the market. These devices are addressed in the
        dialplan in the exact same way as a SIP ATA connected to a UTI1, but
        they can be installed in the same manner as overhead speakers would
        be. Since they auto-answer, there is no need to pass them any extra
        information, the way you would need to with a SIP telephone
        set.</p><p><a id="AdditionalConfig_id257835"></a>For smaller installations (where
        no more than perhaps half a dozen speakers are required), these
        devices may be cost-effective. However, for anything larger than that,
        (or installation in a complex environment such as a warehouse or
        parking lot), you will get better performance at far less cost with a
        traditional analog paging system connected to the phone system by an
        analog (FXS) interface.</p><p><a id="AdditionalConfig_id257842"></a>We don’t know if these devices
        support multicast. Keep this in mind if you are planning to use a
        large number of them.</p></div><div class="sect3" title="Combination paging"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id257848"></a>Combination paging</h4></div></div></div><p><a id="AdditionalConfig_id257854"></a><a id="I_indexterm11_d1e24254" class="indexterm"></a><a id="I_indexterm11_d1e24261" class="indexterm"></a>In many organizations, there may be a need for both
        set-based and external paging. As an example, a manufacturing facility
        might want to use set-based paging for the office area but overhead
        paging for the plant and warehouse. From Asterisk’s perspective, this
        is fairly simple to accomplish. When you call the <code class="literal">Page()</code> application,<a id="I_indexterm11_d1e24268" class="indexterm"></a><a id="I_indexterm11_d1e24271" class="indexterm"></a> you simply specify the various resources you want to
        page, separated by the <code class="literal">&amp;</code>
        character, and they will all be included in the conference that the
        <code class="literal">Page()</code> application creates.</p></div><div class="sect3" title="Bringing it all together"><div class="titlepage"><div><div><h4 class="title"><a id="AdditionalConfig_id257873"></a>Bringing it all together</h4></div></div></div><p><a id="AdditionalConfig_id257878"></a>At this point you should have a
        list of the various channel types that you want to page. Since
        <code class="literal">Page()</code> will nearly always want to
        signal more than one channel, we recommend setting a global variable
        that defines the list of channels to include, and then calling the
        <code class="literal">Page()</code> application with that
        string:<a id="AdditionalConfig_id257884"></a></p><pre class="programlisting">[global]

MULTICAST=MulticastRTP/linksys/239.0.0.1:1234
;MULTICAST=MulticastRTP/linksys/239.0.0.1:1234/239.0.0.1:6061 ; if you have SPA 
                                                              ; (Linksys/Cisco)
                                                              ; phones

BOGEN=SIP/ATAforPaging  ; This assumes an ATA in your sip.conf file named 
                        ; [ATAforPaging]
;BOGEN=DAHDI/25         ; We could do this too, assuming we have an analog 
                        ; FXS card at DAHDI channel 25
PAGELIST=${MULTICAST}&amp;${BOGEN} ; All of these variable names are arbitrary. 
                               ; Asterisk doesn't care what you call these strings

[page_context] ; You don't need a page context, so long as the extension you 
               ; assign to paging is dialable by your sets

exten =&gt; *724,1,Page(${PAGELIST},i,120)</pre><p><a id="AdditionalConfig_id257893"></a>This example offers several
        possible configurations, depending on the hardware. While it is not
        strictly required to have a <code class="literal">PAGELIST</code> variable <a id="I_indexterm11_d1e24301" class="indexterm"></a>defined, we have found that this will tend to simplify
        the management of multiple paging resources, especially during the
        configuration and testing process.</p><p><a id="AdditionalConfig_id257902"></a>We created a context for paging
        for the purposes of this example. In order for this to work, you’ll
        need to either <code class="literal">include</code> this context
        in the contexts where your sets enter the dialplan, or code a <code class="literal">Goto()</code> in those contexts to take the user to
        this context and extension (i.e., <code class="literal">Goto(page_context,*724,1)</code>) Alternatively,
        you could hardcode an extension for the <code class="literal">Page()</code> application in each context that
        services sets.<a id="I_indexterm11_d1e24319" class="indexterm"></a></p></div></div><div class="sect2" title="Zone Paging"><div class="titlepage"><div><div><h3 class="title"><a id="AdditionalConfig_id247793"></a>Zone Paging</h3></div></div></div><p><a id="AdditionalConfig_id247798"></a><a id="I_indexterm11_d1e24324" class="indexterm"></a><a id="I_indexterm11_d1e24329" class="indexterm"></a>Zone paging is popular in places such as automobile
      dealerships, where the parts department, the sales department, and
      perhaps the used car department all require paging, but have no need to
      hear each other’s pages.</p><p><a id="AdditionalConfig_id247804"></a>In zone paging, the person sending
      the page needs to select which zone she wishes to page into. A zone
      paging controller such as a Bogen PCM2000 is generally used to allow
      signaling of the different zones: the <code class="literal">Page()</code> application signals the zone
      controller, the zone controller answers, and then an additional digit is
      sent to select which zone the page is to be sent to. Most zone
      controllers will allow for a page to all zones, in addition to combining
      zones (for example, a page to both the new and used car sales <span class="keep-together">departments</span>).</p><p><a id="AdditionalConfig_id247812"></a>You could also have separate
      extensions in the dialplan going to separate ATAs (or groups of
      telephones), but this may prove more complicated and expensive than
      simply purchasing a paging controller that is designed to handle this.
      Zone paging doesn’t require any significantly different technology, but
      it does require a little more thought and planning with respect to both
      the dialplan and the hardware.<a id="I_indexterm11_d1e24343" class="indexterm"></a><a id="I_indexterm11_d1e24344" class="indexterm"></a><a id="I_indexterm11_d1e24345" class="indexterm"></a><a id="I_indexterm11_d1e24346" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AdditionalConfig_id247965"></a>Conclusion</h2></div></div></div><p><a id="AdditionalConfig_id247970"></a>In this chapter we explored the
    <span class="emphasis"><em>features.conf</em></span> file, which contains the functionality
    for enabling DTMF-based transfers, enabling the recording of calls during
    a call, and configuring parking lots for one or more companies. We also
    looked at various ways of announcing calls and information to people in
    the office using a multitude of paging methods, including traditional
    overhead paging systems and multicast paging to the phone sets on
    employees’ desks. This exploration of the various methods of implementing
    the traditional parking and paging methods in a modern way will hopefully
    show you the flexibility Asterisk can offer.<a id="I_indexterm11_d1e24355" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id568585" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id568585" class="para">97</a>] </sup>Yes, we realize that a SIP INFO message is in fact a SIP
          message, and is not technically part of the audio channel, but the
          point is that you can’t use the “transfer” or “park” button on your
          SIP phone to access these features while on a call. You’ll have to
          send DTMF.</p></div><div class="footnote"><p><sup>[<a id="ftn.id570217" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id570217" class="para">98</a>] </sup>We hope you realize that the actual extension will be
            related to the channel name that parked the call, and will not be
            <code class="literal">SIP_0004F2040808</code> (unless Leif
            sells you the Polycom phone from his lab).</p></div><div class="footnote"><p><sup>[<a id="ftn.id570802" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id570802" class="para">99</a>] </sup>There is some flexibility in the syntax (you can look at the
          sample file for details), but our example uses the style we
          recommend, since it’s the most consistent with typical dialplan
          syntax.</p></div><div class="footnote"><p><sup>[<a id="ftn.id572537" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id572537" class="para">100</a>] </sup>The Bogen UTI1 is useful because it can handle all manner of
            different kinds of incoming and outgoing connections, which pretty
            nearly guarantees that you’ll be able to painlessly connect your
            telephone system to any sort of external paging equipment, no
            matter how old or obscure.</p></div><div class="footnote"><p><sup>[<a id="ftn.id572547" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id572547" class="para">101</a>] </sup>In this book we’re assuming that the external paging
            equipment is already installed and was working with the old phone
            system.</p></div><div class="footnote"><p><sup>[<a id="ftn.id573007" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id573007" class="para">102</a>] </sup>Hint: the local channel will be your friend here.</p></div><div class="footnote"><p><sup>[<a id="ftn.id573122" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id573122" class="para">103</a>] </sup>It even has its own Class D reserved IP address space, from
            224.0.0.0 to 239.255.255.255 (but read up on IP multicast before
            you just grab one of these and assign it). Parts of this address
            space are private, parts are public, and parts are designated for
            purposes other than what you might want to use them for. For
            information about multicast addressing, see <a class="ulink" href="http://en.wikipedia.org/wiki/IP_multicast#IP_multicast_addressing_assignments" target="_top">http://en.wikipedia.org/wiki/IP_multicast#IP_multicast_addressing_assignments</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id573276" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id573276" class="para">104</a>] </sup>Very loud, and no way to adjust gain.</p></div><div class="footnote"><p><sup>[<a id="ftn.id573283" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id573283" class="para">105</a>] </sup>So far as we can tell, Polycom sets do not support
            multicast. We certainly were not able to find a way to <span class="keep-together">use it.</span></p></div></div></div><div class="chapter" title="Chapter 12. Internet Call Routing"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-ICR"></a>Chapter&nbsp;12.&nbsp;Internet Call Routing</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR-SECT-1">DNS and SIP URIs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id268880">The SIP URI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289964">Modifying sip.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288167">File parsing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288915">ENUM and E.164</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289026">ENUM</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289190">ISN, ITAD, and freenum.org</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289278">ITAD Subscriber Numbers (ISNs)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247800">IP Telephony Administrative Domains (ITADs)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248004">Testing Your ITAD</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579341">Receiving calls to your ITAD</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248274">Security and Identity</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248402">Spam over Internet Telephony (SPIT)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248457">Phishing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248492">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="InternetCallRouting_id283829"></a>There ain’t no such thing as a
    free lunch (TANSTAAFL).</p><div class="attribution"><span>—<span class="attribution">Robert Heinlein</span></span></div></div><p><a id="InternetCallRouting_id284709"></a><a id="index-728G477JN2P" class="indexterm"></a><a id="index-337I440RF3U" class="indexterm"></a>One of the attractions of VoIP is the concept of avoiding the
  use of the PSTN altogether, and routing all calls directly between endpoints
  using the Internet at little or no cost. While the technology to do this has
  been around for some time, the reality is that most phone calls still cost
  money—even those that are routed across VoIP services.</p><p><a id="InternetCallRouting_id268174"></a>From a technology standpoint, there
  are still many systems out there that cannot handle routing VoIP calls using
  anything other than a dialpad on a telephone.</p><p><a id="InternetCallRouting_id267918"></a>From a cultural standpoint, we are
  still used to calling each other using a numerical string (a.k.a., a phone
  number). With VoIP, the concept of being able to phone somebody using
  <code class="filename">name@domain</code> (just as we do with email)
  makes sense, but there are a few things to consider before we can get
  there.</p><p><a id="InternetCallRouting_id264440"></a>So what’s holding everything
  up?</p><div class="sidebar" title="freenum.org"><a id="InternetCallRouting_id253755"></a><div class="titlepage"><div><div><p class="title"><strong><a class="ulink" href="http://www.freenum.org/" target="_top">freenum.org</a></strong></p></div></div></div><p><a id="InternetCallRouting_id256438"></a><a id="I_indexterm12_d1e24388" class="indexterm"></a>The first few sections of this chapter may put you off the
    whole idea entirely, so we want to start off by saying that
    <span class="emphasis"><em>freenum.org</em></span> proposes an interim solution to the whole
    mess that is so elegant, we can’t see any reason why everyone in the VoIP
    community won’t embrace it.<sup>[<a id="id574180" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id574180" class="footnote">106</a>]</sup></p></div><div class="sect1" title="DNS and SIP URIs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-ICR-SECT-1"></a>DNS and SIP URIs</h2></div></div></div><p><a id="InternetCallRouting_id249022"></a><a id="index-864T206UR2U" class="indexterm"></a><a id="index-623E713CF6M" class="indexterm"></a>The Domain Name System (DNS) is designed to make it easier
    for humans to locate resources on the Internet. While ultimately all
    connections between endpoints are handled through numerical IP addresses,
    it can be very helpful to associate a name (such as
    <span class="emphasis"><em>www.google.com</em></span>) with what may in fact be multiple IP
    addresses.</p><p><a id="InternetCallRouting_id264459"></a>In the case of VoIP, the use of a
    domain name can take something like <code class="literal">100@192.168.1.1</code> (<code class="literal"><em class="replaceable"><code>extension</code></em>@<em class="replaceable"><code>server</code></em></code>)
    and make it available as <code class="literal">leif@shifteight.org</code> (which looks so much sexier
    on a business card).</p><div class="sect2" title="The SIP URI"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id268880"></a>The SIP URI</h3></div></div></div><p><a id="InternetCallRouting_id280745"></a><a id="I_indexterm12_d1e24436" class="indexterm"></a><a id="I_indexterm12_d1e24443" class="indexterm"></a><a id="I_indexterm12_d1e24448" class="indexterm"></a>A SIP URI generally looks like <code class="literal">sip:<em class="replaceable"><code>endpoint</code></em>@<em class="replaceable"><code>domain.tld</code></em></code>.
      Depending on your SIP client, you may be able to dial a SIP URI as
      <code class="literal"><em class="replaceable"><code>endpoint</code></em>@<em class="replaceable"><code>domain.tld</code></em></code>,
      or even just as <code class="literal"><em class="replaceable"><code>endpoint</code></em></code> (if you
      have a proxy server and the endpoint you are calling is part of your
      domain).</p><p><a id="InternetCallRouting_id280760"></a>For a SIP telephone, which often
      only has a numerical dialpad, it can be problematic to dial a SIP URI by
      name,<sup>[<a id="id574384" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id574384" class="footnote">107</a>]</sup> so it has become common to use numerical dialing to reach
      external resources. We are also used to making “phone calls” using
      “phone numbers.” The SIP protocol itself, however, only understands
      <code class="literal"><em class="replaceable"><code>resource</code></em>@<em class="replaceable"><code>address</code></em></code>,
      so whatever you dial must ultimately be converted to this format before
      SIP can do anything with it. Usually the only reason you can dial
      something by “phone number” from your SIP phone is because you are
      registered to a resource that understands how to convert the numerical
      strings you dial into SIP URIs.</p><p><a id="InternetCallRouting_id262610"></a>In Asterisk, the <code class="literal"><em class="replaceable"><code>resource</code></em></code> part of
      the URI (the part before the <code class="literal">@</code>) must
      match an extension in the dialplan.<sup>[<a id="id574433" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id574433" class="footnote">108</a>]</sup> The <code class="literal"><em class="replaceable"><code>address</code></em></code> portion
      will be the address (or hostname) of the Asterisk server itself. So, a
      URI of <code class="literal">sip:100@shifteight.org</code> will
      end up at an extension called <code class="literal">100</code>,
      somewhere in the dialplan of the server that provides SIP service for
      <code class="literal">shifteight.org</code>.</p><p><a id="InternetCallRouting_id266439"></a>What is dialed (<code class="literal">100</code>) may not in any way relate to the actual
      identifier of the endpoint being connected to. For example, we might
      have a user named Leif whose phone may be a device that registers itself
      by its MAC address, and therefore could be something like <code class="literal">0000FFFF0001@192.168.1.99</code>.<sup>[<a id="id574502" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id574502" class="footnote">109</a>]</sup> Much of the purpose of the Asterisk dialplan is to
      simplify addressing for users and to handle the complexities of the
      various protocols that Asterisk supports.</p></div><div class="sect2" title="SRV Records"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id266470"></a>SRV Records</h3></div></div></div><p><a id="InternetCallRouting_id266475"></a><a id="I_indexterm12_d1e24544" class="indexterm"></a><a id="I_indexterm12_d1e24551" class="indexterm"></a><a id="I_indexterm12_d1e24556" class="indexterm"></a>A Service Record (SRV) is a somewhat new type of DNS
      record that provides information about available services. Defined in
      RFC 2782, it is often used by newer protocols (SIP being one of them).
      If you want to support SIP lookups on your domain, you will require a
      relevant SRV record in order to properly respond.</p><p><a id="InternetCallRouting_id266481"></a>When a SIP connection does a
      lookup on <code class="literal">leif@shifteight.org</code>, for the purposes of
      SIP, the SRV record can respond that the requested service (SIP) is
      actually found on the server <code class="literal">pbx.shifteight.org</code> (or possibly even on a
      completely different domain, such as <code class="literal">pbx.tothemoon.net</code>).</p><p><a id="InternetCallRouting_id265000"></a>Internet hosting providers
      typically offer a web-based interface for setting up DNS records, but
      many of them do not provide a good interface for SRV records (assuming
      they offer anything at all). You can generally set up A records and MX
      records easily enough, but SRV records can be trickier. If your host
      does not support SRV records, you will need to move your DNS hosting to
      another provider if you want to be able to support SIP SRV lookups for
      your domain.</p><p><a id="InternetCallRouting_id265008"></a>The majority of DNS servers run
      BIND (Berkeley Internet Name Daemon). The BIND record for an SRV entry
      for SIP will look something like this:</p><a id="I_programlisting12_d1e24575"></a><pre class="programlisting">        <code class="code">_sip._udp.shifteight.org. 86400 IN SRV 0 0 5060 pbx.shifteight.org.</code>
      </pre><p><a id="InternetCallRouting_id265018"></a>The form of the record is
      detailed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#components_sipsrv" title="Table 12.1. Components of a SIP SRV record">Table&nbsp;12.1, “Components of a SIP SRV record”</a>.</p><div class="table"><a id="components_sipsrv"></a><p class="title"><strong>Table&nbsp;12.1.&nbsp;Components of a SIP SRV record</strong></p><div class="table-contents"><table summary="Components of a SIP SRV record" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Description</th><th align="center">Example</th></tr></thead><tbody><tr><td>Service</td><td><a id="I_indexterm12_d1e24599" class="indexterm"></a>Symbolic name of service</td><td><code class="literal">_sip.</code></td></tr><tr><td>Proto</td><td><a id="I_indexterm12_d1e24610" class="indexterm"></a>Transport protocol</td><td><code class="literal">_udp.</code></td></tr><tr><td>Name</td><td>Domain name for this record<sup>[<a id="id574775" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id574775" class="footnote">a</a>]</sup></td><td><code class="literal">shifteight.org.</code></td></tr><tr><td>TTL</td><td><a id="I_indexterm12_d1e24632" class="indexterm"></a>Time to live (in seconds)</td><td><code class="literal">86400</code></td></tr><tr><td>Class</td><td><a id="I_indexterm12_d1e24643" class="indexterm"></a>DNS class field (always <code class="literal">IN</code>)</td><td><code class="literal">IN</code></td></tr><tr><td>Priority</td><td><a id="I_indexterm12_d1e24657" class="indexterm"></a>Target host priority</td><td><code class="literal">0</code></td></tr><tr><td>Weight</td><td><a id="I_indexterm12_d1e24668" class="indexterm"></a>Relative weight of this record</td><td><code class="literal">0</code></td></tr><tr><td>Port</td><td><a id="I_indexterm12_d1e24679" class="indexterm"></a>TCP/UDP port number</td><td><code class="literal">5060</code></td></tr><tr><td>Target</td><td><a id="I_indexterm12_d1e24690" class="indexterm"></a>Hostname of machine providing this service</td><td><code class="literal">pbx.shifteight.org.</code></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id574775" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id574775" class="para">a</a>] </sup>Note the trailing dot.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="InternetCallRouting_id289887"></a>When you configure an SRV
      record, you can test it with the following Linux command:</p><a id="I_programlisting12_d1e24699"></a><pre class="programlisting"># <strong class="userinput"><code>dig SRV _sip._udp.shifteight.org</code></strong></pre><p><a id="InternetCallRouting_id289895"></a>The result will contain several
      components, but the section you are interested in is:</p><a id="I_programlisting12_d1e24706"></a><pre class="programlisting">        <code class="code">;; ANSWER SECTION:
_sip._udp.shifteight.org. 14210 IN SRV 0 0 5060 pbx.shifteight.org.</code>
      </pre><p><a id="InternetCallRouting_id289908"></a>This means that your DNS server
      is responding correctly to an SRV lookup for <span class="keep-together">SIP to your</span> domain by responding with the
      hostname of your PBX (in this case, <code class="literal">pbx.shifteight.org</code>).</p><p><a id="InternetCallRouting_id289916"></a>Any SIP requests to your domain
      will be referred to your Asterisk server, which will be responsible for
      handling incoming SIP connections.<sup>[<a id="id575044" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id575044" class="footnote">110</a>]</sup></p><p><a id="InternetCallRouting_id289928"></a>If your dialplan does not
      understand the name/resource/endpoint portion of the SIP URI, calls will
      fail. This means that if you want to be able to offer resources in your
      Asterisk system by name, you will need relevant dialplan entries.</p></div><div class="sect2" title="Accepting Calls to Your System"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289934"></a>Accepting Calls to Your System</h3></div></div></div><p><a id="InternetCallRouting_id289940"></a><a id="index-230M674DU7F" class="indexterm"></a><a id="index-373Q867CJ3H" class="indexterm"></a><a id="index-352N386JT1T" class="indexterm"></a>When a SIP URI comes into your Asterisk system, the
      resource portion of the URI will arrive in the dialplan as an <code class="literal">${EXTEN}</code><a id="I_indexterm12_d1e24748" class="indexterm"></a>. So, for example, <code class="literal">leif@shifteight.org</code> would arrive in the
      dialplan as <code class="literal">leif</code> within the <code class="literal">${EXTEN}</code> channel variable in whatever context
      you use to handle unauthenticated SIP calls (if you are building your
      dialplan using the examples in this book, that will be the <code class="literal">unauthenticated</code> dialplan context).</p><div class="sect3" title="Modifying sip.conf"><div class="titlepage"><div><div><h4 class="title"><a id="InternetCallRouting_id289964"></a>Modifying sip.conf</h4></div></div></div><p><a id="InternetCallRouting_id289972"></a><a id="I_indexterm12_d1e24769" class="indexterm"></a>Once you are familiar with the security implications of
        allowing unauthenticated SIP connections, you will need to ensure that
        your <code class="filename">sip.conf</code> file allows for
        them. While Asterisk allows them by default, in earlier chapters of
        this book we have instructed you to disable unauthenticated SIP calls.
        The logic for this is simple: if you don’t need it, don’t enable
        it.</p><p><a id="InternetCallRouting_id289982"></a>Since we are now interested in
        allowing calls from the Internet, we will need to allow
        unauthenticated SIP calls. We do that by setting a general variable in
        the <code class="filename">/etc/asterisk/sip.conf</code> file,
        as follows:</p><p><a id="InternetCallRouting_id287900"></a><a id="InternetCallRouting_id287901"></a></p><pre class="programlisting">[general]
context=unauthenticated         ; default context for incoming calls
<span class="emphasis"><em>allowguest=yes</em></span>                  ; enable unauthenticated calls
</pre><p>After making this change, don’t forget to reload SIP, using
        this command from the command line:</p><a id="InternetCallRouting_id403323"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo asterisk -rx "sip reload"</code></strong></pre><p>or this one from the Asterisk CLI:</p><a id="InternetCallRouting_id415580"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip reload</code></strong></pre><p><a id="InternetCallRouting_id287926"></a>You can verify that the
        changes have succeeded using the Asterisk CLI command <span class="command"><strong>sip show settings</strong></span><a id="I_indexterm12_d1e24806" class="indexterm"></a><a id="I_indexterm12_d1e24809" class="indexterm"></a>. What you want to see is <code class="literal">Allow
        unknown access: Yes</code> under the <code class="literal">Global Settings</code> section, and <code class="literal">Context: unauthenticated</code> under the <code class="literal">Default Settings</code> header.</p></div><div class="sect3" title="Standard dialplan"><div class="titlepage"><div><div><h4 class="title"><a id="InternetCallRouting_id287950"></a>Standard dialplan</h4></div></div></div><p><a id="InternetCallRouting_id287955"></a><a id="I_indexterm12_d1e24832" class="indexterm"></a>In order to handle an incoming name, your dialplan needs
        to contain an extension that matches that name.</p><p><a id="InternetCallRouting_id287960"></a>A dialplan entry on the
        <code class="literal">pbx.shifteight.org</code> system might
        look like this:</p><p><a id="InternetCallRouting_id287967"></a><a id="InternetCallRouting_id287968"></a></p><pre class="programlisting">[unauthenticated]
exten =&gt; leif,1,Goto(PublicExtensions,100,1)

exten =&gt; jim,1,Goto(PublicExtensions,101,1)

exten =&gt; tilghman,1,Goto(PublicExtensions,102,1)

exten =&gt; russell,1,Goto(PublicExtensions,103,1)
</pre><p>This is by far the simplest way to implement name dialing,
        but it is also complex to maintain, especially in systems with
        hundreds of users.</p><p><a id="InternetCallRouting_id287978"></a>In order to implement name
        handling in a more powerful way, you could add something like the
        following to your <code class="filename">extensions.conf</code><a id="I_indexterm12_d1e24851" class="indexterm"></a><a id="I_indexterm12_d1e24854" class="indexterm"></a> file. Note that some lines have been wrapped in this
        example due to space restrictions. These lines must appear on a single
        line in the dialplan. All lines should start with <code class="literal">exten =&gt;</code>, <code class="literal">same
        =&gt;</code>, or a comment indicator (<code class="literal">;</code>).</p><p><a id="InternetCallRouting_id287986"></a><a id="InternetCallRouting_id287987"></a></p><pre class="programlisting">[unauthenticated]
exten =&gt; _[A-Za-z0-9].,1,Verbose(2,UNAUTHENTICATED REQUEST TO ${EXTEN} FROM 
${CALLERID(all)})
   same =&gt; n,Set(FilteredExtension=${FILTER(A-Za-z0-9,${EXTEN})})
   same =&gt; n,Set(CheckPublicExtensionResult=${DIALPLAN_EXISTS(PublicExtensions,
${FilteredExtension},1)})
   same =&gt; n,GotoIf($["${CheckPublicExtensionResult}" = "0"]?CheckEmailLookup)
   same =&gt; n,Goto(PublicExtensions,${FilteredExtension},1)

; This is our handler for when someone dials a SIP URI with a name
   same =&gt; n(CheckEmailLookup),GoSub(subEmailToExtensionLookup,start,1
(${TOLOWER(${FilteredExtension})}))
   same =&gt; n,GotoIf($["${GOSUB_RETVAL}" = "NoResult"]?i,1:PublicExtensions,
${GOSUB_RETVAL},1)
   same =&gt; n,Goto(i,1)

; This handles invalid numbers/names
exten =&gt; i,1,Verbose(2,Incoming call from ${CALLERID(all)} to context ${CONTEXT} 
found no result)
   same =&gt; n,Playback(silence/1&amp;invalid)
   same =&gt; n,Hangup()

; These are explicit extension matches (useful on small systems)
exten =&gt; leif,1,Goto(PublicExtensions,100,1)

exten =&gt; jim,1,Goto(PublicExtensions,101,1)

exten =&gt; tilghman,1,Goto(PublicExtensions,102,1)

exten =&gt; russell,1,Goto(PublicExtensions,103,1)
</pre><p><a id="InternetCallRouting_id288004"></a>When a call enters the
        dialplan, it can match in one of two places: it can match our pattern
        match at the top, or it can match the explicit named extensions closer
        to the bottom of our example (i.e., <code class="literal">leif</code>, <code class="literal">jim</code>, <code class="literal">tilghman</code>, or <code class="literal">russell</code>).</p><p><a id="InternetCallRouting_id288022"></a>If the call does not
        explicitly match our named extensions, the pattern match will be
        utilized. Our pattern match of <code class="literal">_[A-Za-z0-9].</code> matches any string starting
        with an alphanumeric character followed by one or more other
        characters.</p><p><a id="InternetCallRouting_id288030"></a>The incoming string needs to
        be made safe, so we utilize the <code class="literal">FILTER()</code> function <a id="I_indexterm12_d1e24896" class="indexterm"></a><a id="I_indexterm12_d1e24899" class="indexterm"></a>to remove nonalphanumeric characters, and assign the
        result to the <code class="literal">FilteredExtension</code>
        channel variable.</p><p><a id="InternetCallRouting_id288041"></a>The <code class="literal">DIALPLAN_EXISTS()</code> function <a id="I_indexterm12_d1e24913" class="indexterm"></a><a id="I_indexterm12_d1e24916" class="indexterm"></a>will be used to see if the request matches anything in
        the <code class="literal">PublicExtensions</code> context. This
        function will return either a <code class="literal">0</code> (if
        no match is <span class="keep-together">found) or</span> a <code class="literal">1</code> (when a match is found) and assign the
        result to the <code class="literal">Check</code><code class="literal">Public</code><code class="literal">Extension</code><code class="literal">Result</code> channel variable.<a id="I_indexterm12_d1e24944" class="indexterm"></a></p><p><a id="InternetCallRouting_id288063"></a>The next line is a <code class="literal">GotoIf()</code> that checks the status of the
        <code class="literal">CheckPublicExtensionResult</code>
        variable. If the result returned was <code class="literal">0</code>, the dialplan will continue at the
        <code class="literal">CheckEmailLookup</code> priority label. If
        the result was anything other than <code class="literal">0</code> (in this case, the other result could have
        been a <code class="literal">1</code>), the next line of the
        dialplan will be executed. This line will perform a <code class="literal">Goto()</code> and continue execution in the
        <code class="literal">PublicExtensions</code> context
        (presumably to dial our destination endpoint).</p><p><a id="InternetCallRouting_id288094"></a>Assuming our <code class="literal">CheckPublicExtensionResult</code> variable was a
        <code class="literal">0</code>, our dialplan will continue at
        the <code class="literal">CheckEmailLookup</code> priority
        label, where we use the subroutine <code class="literal">sub</code><code class="literal">Email</code><code class="literal">To</code><span class="keep-together"><code class="literal">ExtensionLookup</code></span> via a <code class="literal">GoSub()</code>.<sup>[<a id="id575847" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id575847" class="footnote">111</a>]</sup> We pass the value contained within the <code class="literal">Filtered</code><code class="literal">Extension</code> channel
        variable <a id="I_indexterm12_d1e25012" class="indexterm"></a>to the subroutine, but you’ll notice that we’ve wrapped
        it in the <code class="literal">TOLOWER()</code> dialplan function (which
        expects your email addresses to be stored in lowercase as opposed to
        mixed case).</p><p><a id="InternetCallRouting_id288134"></a>Upon return from the <code class="literal">subEmailToExtensionLookup</code> subroutine, we
        check the <code class="literal">GOSUB_RETVAL</code> channel
        variable <a id="I_indexterm12_d1e25027" class="indexterm"></a>(which was automatically set when the subroutine
        returned). The result will be one of two things: the extension number
        that matches the name that was passed to the subroutine, or the string
        <code class="literal">NoResult</code>. Our dialplan checks
        <code class="literal">${GOSUB_RETVAL}</code>, and if it contains
        <code class="literal">NoResult</code>, the caller is passed to
        the <code class="literal">i</code> (invalid) extension, where we
        inform the caller that the extension dialed is invalid. If all is
        well, the call will continue execution in the <code class="literal">PublicExtensions</code> context.</p></div><div class="sect3" title="File parsing"><div class="titlepage"><div><div><h4 class="title"><a id="InternetCallRouting_id288167"></a>File parsing</h4></div></div></div><p><a id="InternetCallRouting_id288172"></a><a id="I_indexterm12_d1e25051" class="indexterm"></a><a id="I_indexterm12_d1e25056" class="indexterm"></a>This little trick will allow you to use the <code class="filename">voicemail.conf</code> file to look up valid
        usernames against their email address. This could end up being kludgy,
        and it requires that the email field in <code class="filename">voicemail.conf</code> is filled out and contains a
        username (before the <code class="literal">@</code> symbol) that
        you will support in your dialplan, but it’s simple to code in the
        dialplan, and if nothing else it will give you some ideas of how you
        might handle providing a more automated way of linking names to
        extension numbers for the purpose of SIP URI dialing. Note that this
        method will not allow you to exclude some people from name dialing.
        It’s all or nothing.</p><p><a id="InternetCallRouting_id265352"></a>We’ve written this as a
        subroutine, which is invoked something like this:</p><p><a id="InternetCallRouting_id265356"></a><a id="InternetCallRouting_id265357"></a></p><pre class="programlisting">; where 'name' is the username as found in the email address
GoSub(subEmailToExtensionLookup,start,1(name))</pre><p>The subroutine
        looks like this:</p><a id="InternetCallRouting_id265362"></a><pre class="programlisting">[subEmailToExtensionLookup]
exten =&gt; start,1,Verbose(2,Checking for user in voicemail.conf)
   same =&gt; n,Set(LOCAL(FilteredExtension)=${FILTER(a-z0-9,${ARG1})})
   same =&gt; n,Set(LOCAL(Result)=${SHELL(grep "${LOCAL(FilteredExtension)}@" 
/etc/asterisk/voicemail.conf)})
   same =&gt; n,GotoIf($[${ISNULL(${LOCAL(Result)})}]?no_Result,1)
   same =&gt; n,Set(LOCAL(ExtensionToDial)=${CUT(${LOCAL(Result)},=,1)})
   same =&gt; n,Set(LOCAL(ExtensionToDial)=${FILTER(0-9,${LOCAL(ExtensionToDial)})})
   same =&gt; n,Return(${LOCAL(ExtensionToDial)})

exten =&gt; no_Result,1,Verbose(2,No user ${ARG1} found in voicemail.conf)
   same =&gt; n,Return(NoResult)
</pre><p><a id="InternetCallRouting_id265376"></a>Let’s go over this code,
        because there are some useful actions being performed that you may be
        able to apply for other purposes as well.</p><p><a id="InternetCallRouting_id265380"></a>First, a channel variable
        named <code class="literal">FilteredExtension</code> is created.
        This variable is local to the subroutine:</p><a id="I_programlisting12_d1e25084"></a><pre class="programlisting">Set(LOCAL(FilteredExtension)=${FILTER(a-z0-9,${ARG1})})</pre><p><a id="InternetCallRouting_id265392"></a>The <code class="literal">FILTER()</code> function looks at the entire
        <code class="literal">${ARG1}</code> and removes any
        nonalphanumeric characters. This is primarily for security reasons. We
        are passing this string out to the shell, so it’s critical to ensure
        it will only contain characters that we expect.</p><p><a id="InternetCallRouting_id265404"></a>The next step is where the
        coolness happens:</p><a id="I_programlisting12_d1e25096"></a><pre class="programlisting">Set(LOCAL(Result)=${SHELL(grep "${LOCAL(FilteredExtension)}@" /etc/asterisk/voicemail.conf)})</pre><p><a id="InternetCallRouting_id265412"></a>The shell is invoked in order
        to run the <span class="command"><strong>grep</strong></span> shell application,
        which will search through the <code class="filename">voicemail.conf</code> file, return any lines that
        contain <code class="literal">name@</code>, and assign the
        result to the variable <code class="literal">${Result}</code>:</p><a id="I_programlisting12_d1e25113"></a><pre class="programlisting">GotoIf($[${ISNULL(${LOCAL(Result)})}]?no_result,1)</pre><p><a id="InternetCallRouting_id288502"></a>If no lines contain the string
        we’re looking for, we’ll return from the subroutine the value <code class="literal">NoResult</code> (which will be found in the
        <code class="literal">${GOSUB_RETVAL}</code> channel variable).
        The dialplan section that called the subroutine will need to handle
        this condition.</p><p><a id="InternetCallRouting_id288514"></a>We’ve created an extension
        named <code class="literal">no_result</code> for this
        purpose:</p><a id="InternetCallRouting_id288521"></a><pre class="programlisting">exten =&gt; no_result,1,Verbose(2,No user ${ARG1} found in voicemail.conf)
   same =&gt; n,Return(NoResult)</pre><p><a id="InternetCallRouting_id288526"></a>If
        <code class="literal">${Result}</code> is not null, the next
        steps will clean up <code class="literal">${Result}</code> in
        order to extract the extension number<sup>[<a id="id576271" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id576271" class="footnote">112</a>]</sup> of the user with the name passed in <code class="literal">${ARG1}</code>:</p><a id="I_programlisting12_d1e25146"></a><pre class="programlisting">Set(LOCAL(ExtensionToDial)=${CUT(${LOCAL(Result)},=,1)})</pre><p><a id="InternetCallRouting_id288554"></a>The <code class="literal">CUT()</code> function will use the <code class="literal">=</code> symbol as the field delimiter and will
        assign the value from the first field found in <code class="literal">${Result}</code> to the new variable <code class="literal">ExtensionToDial</code>. From there, we simply need
        to trim any trailing spaces by filtering all nonnumeric
        characters:</p><a id="I_programlisting12_d1e25162"></a><pre class="programlisting">Set(LOCAL(ExtensionToDial)=${FILTER(0-9,${LOCAL(ExtensionToDial)})})</pre><p><a id="InternetCallRouting_id288577"></a>We can now return the
        extension number of the name we received:</p><a id="I_programlisting12_d1e25166"></a><pre class="programlisting">Return(${LOCAL(ExtensionToDial)})</pre><p><a id="InternetCallRouting_id288586"></a>This example was something we
        whipped up for the purposes of illustrating some methods you can
        employ in order to easily match names to extension numbers for the
        purposes of SIP URI dialing. This is by no means the best way of doing
        this, but it is fairly simple to implement, and in many cases may be
        all that you need.</p></div><div class="sect3" title="Database lookup"><div class="titlepage"><div><div><h4 class="title"><a id="InternetCallRouting_id288593"></a>Database lookup</h4></div></div></div><p><a id="InternetCallRouting_id288598"></a><a id="I_indexterm12_d1e25175" class="indexterm"></a>Using a database is by far the best way to handle user
        information on larger, more complex systems. We will discuss
        integrating Asterisk with databases in more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>, but it is useful to introduce the concept
        here.</p><p><a id="InternetCallRouting_id288605"></a>A database is ideal for
        handling name lookup, as it makes maintenance of user data (and
        integration with external systems such as web interfaces) far simpler.
        However, it does require a bit more effort to design and
        implement.</p><p><a id="InternetCallRouting_id288610"></a>The example we will use in
        this chapter will work, but for a production environment it is
        probably too simplistic. Our goal here is simply to give you enough
        information to understand the concept; a tighter integration is part
        of what is covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>.</p><p><a id="InternetCallRouting_id288616"></a>First, we’ll need a table to
        handle our name-to-extension mapping.<a id="I_indexterm12_d1e25189" class="indexterm"></a> This could be a separate table from the main user
        table, or it could be handled in the main user table, provided that
        that table contains a field that will contain the exact strings that
        users will publish as their SIP URIs (as an example, some companies
        have rules regarding how email addresses look, so Leif might have a
        URI such as <code class="literal">lmadsen@shifteight.org</code>,
        or <code class="literal">leif.madsen@shifteight.org</code>).</p><p><a id="InternetCallRouting_id288630"></a></p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="InternetCallRouting_id288634"></a>If you are serious about
            implementing this example in a production system, make sure you
            are familiar with the material in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>,
            as some key concepts are covered there that we omit here.</p></div><p>Our sample <code class="literal">NameMapping</code> table
        looks like <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288640" title="Table 12.2. NameMapping table">Table&nbsp;12.2, “NameMapping table”</a>.</p><div class="table"><a id="InternetCallRouting_id288640"></a><p class="title"><strong>Table&nbsp;12.2.&nbsp;NameMapping table</strong></p><div class="table-contents"><table summary="NameMapping table" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Name</th><th align="center">Extension</th><th align="center">Context</th></tr></thead><tbody><tr><td><code class="literal">leif</code></td><td><code class="literal">100</code></td><td><code class="literal">publicExtensions</code></td></tr><tr><td><code class="literal">leif.madsen</code></td><td><code class="literal">100</code></td><td><code class="literal">publicExtensions</code></td></tr><tr><td><code class="literal">lmadsen</code></td><td><code class="literal">100</code></td><td><code class="literal">publicExtensions</code></td></tr><tr><td><code class="literal">jim</code></td><td><code class="literal">101</code></td><td><code class="literal">publicExtensions</code></td></tr><tr><td><code class="literal">reception</code></td><td><code class="literal">0</code></td><td><code class="literal">Services</code> <sup>[<a id="id576668" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id576668" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">voicemail</code></td><td><code class="literal">*98</code></td><td><code class="literal">Services</code></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id576668" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id576668" class="para">a</a>] </sup>Make sure this context exists on your system.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="InternetCallRouting_id288789"></a>We believe that having a
        separate table that only handles name-to-extension/context mapping is
        the most useful solution, since this table can be used to handle more
        than just users with telephone sets. You are encouraged to come up
        with other ways to handle this that may be more suitable to your
        environment.</p><p><a id="InternetCallRouting_id288795"></a>In the dialplan, we would
        refer to this table using Asterisk’s <code class="literal">func_odbc</code> function:</p><p><a id="InternetCallRouting_id288800"></a><a id="InternetCallRouting_id288801"></a></p><pre class="programlisting">[subLookupNameInNameMappingTable]
exten =&gt; start,1,Verbose(2,Looking up ${ARG1})

; where 'name' is the username as found in the email address 
   same =&gt; n,Set(ARRAY(CalleeExtension,CalleeContext)=${GET_NAME_LOOKUP(${ARG1})})
   same =&gt; n,GotoIf($[${ISNULL(${CalleeExtension})}]?no_result,1)
   same =&gt; n,GotoIf($[${ISNULL(${CalleeContext})}]?no_result,1)
   same =&gt; n,Return() ; You'll need to handle the new CalleeExtension and 
                      ; CalleeContext variables in the code that called this 
                      ; subroutine

exten =&gt; no_result,1,Verbose(2,Name was not found in the database.)
   same =&gt; n,Return(NoResult)
</pre><p><a id="InternetCallRouting_id288810"></a>The <code class="filename">/etc/asterisk/func_odbc.conf</code> file will
        require the following entry:</p><a id="InternetCallRouting_id288816"></a><pre class="programlisting">[NAME_LOOKUP](DB)
prefix=GET
SELECT Extension,Context FROM NameMapping WHERE Name='${ARG1}'

</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InternetCallRouting_id288823"></a>Keep in mind that there’s
          nothing to say you can’t reference more than one datastore to look
          up names. For example, you might have a table such as the one we’ve
          described here, but also have a secondary lookup that goes to, say,
          an LDAP database to try to resolve names there as well. This can get
          complicated to configure and maintain, but if designed right it can
          also mean that your Asterisk system can be tightly integrated with
          other systems in your enterprise.</p></div><p><a id="InternetCallRouting_id288832"></a>Details on how to handle all
        of this in your dialplan are beyond the scope of this book. Suffice it
        to say that in your dialplan you will still need to handle the values
        that your subroutine creates or assigns.<a id="I_indexterm12_d1e25311" class="indexterm"></a><a id="I_indexterm12_d1e25312" class="indexterm"></a><a id="I_indexterm12_d1e25313" class="indexterm"></a></p></div></div><div class="sect2" title="Dialing SIP URIs from Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id288838"></a>Dialing SIP URIs from Asterisk</h3></div></div></div><p><a id="InternetCallRouting_id288844"></a><a id="I_indexterm12_d1e25318" class="indexterm"></a><a id="I_indexterm12_d1e25325" class="indexterm"></a><a id="I_indexterm12_d1e25328" class="indexterm"></a>Asterisk can dial a SIP URI as easily as any other sort of
      destination, but it is the endpoint (namely, your telephone) that is
      ultimately going to shoulder the burden of composing the address, and
      there lies the difficulty.</p><p><a id="InternetCallRouting_id288849"></a>Most SIP telephones will allow
      you to compose a SIP URI using the dialpad. This sounds like a great
      idea at first, but since there are no typewriter keys on a phone set, in
      order to dial something like <code class="literal">jim.vanmeggelen@shifteight.org</code> what you would
      need to actually input into the phone would be something along the lines
      of:</p><a id="I_programlisting12_d1e25339"></a><pre class="programlisting">5-444-6-*-888-2-66(pause)-6-33-4(pause)-4-33-555-33-66-#-7777-44(pause)-444-333-8-33-
444-(pause)-4(pause)-44-8-*-666-777-4</pre><p><a id="InternetCallRouting_id288864"></a>To support this in your
      dialplan, you would need something similar to this<sup>[<a id="id576943" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id576943" class="footnote">113</a>]</sup>:</p><p><a id="InternetCallRouting_id288868"></a><a id="InternetCallRouting_id288869"></a></p><pre class="programlisting">exten =&gt; _[0-9a-zA-Z].,1,Verbose()
   same =&gt; n,Set(FilteredExtension=${FILTER(0-9a-zA-Z@-_.,${EXTEN})})
   same =&gt; n,Dial(SIP/${FilteredExtension})</pre><p>It’s simple,
      it’s fun, and it works! … ?</p><p><a id="InternetCallRouting_id288886"></a>The reality is that until all
      phones support complex and flexible address books, as well as a
      QWERTY-style keyboard (perhaps via touchscreen), SIP URI dialing is not
      going to take off.</p><p><a id="InternetCallRouting_id288892"></a>If you have a SIP URI that you
      want to dial on a regular basis (for example, during the writing of this
      book there were many calls made between Jim and Leif), you could add
      something like this to your dialplan:</p><a id="I_programlisting12_d1e25361"></a><pre class="programlisting">exten =&gt; 5343,1,Dial(SIP/leif.madsen@shifteight.org)</pre><p><a id="InternetCallRouting_id288902"></a>With this in your dialplan, you
      could dial <code class="literal">5343</code> <code class="literal">(LEIF)</code> on your phone and the Asterisk dialplan
      would translate it into the appropriate SIP URI. It’s not practical for
      a large number of URIs, but for a few here and there it can be a helpful
      shortcut.</p><p><a id="InternetCallRouting_id288908"></a>Nevertheless, keep reading,
      because there are some very useful components of DNS that simplify the
      process of dialing directly between systems without the use of the
      PSTN.<a id="I_indexterm12_d1e25373" class="indexterm"></a><a id="I_indexterm12_d1e25374" class="indexterm"></a></p></div></div><div class="sect1" title="ENUM and E.164"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InternetCallRouting_id288915"></a>ENUM and E.164</h2></div></div></div><p><a id="InternetCallRouting_id288920"></a><a id="index-128S314RP2R" class="indexterm"></a><a id="index-655V682JO2V" class="indexterm"></a>Although the SIP protocol really doesn’t think in terms of
    phone numbers, the reality is that phone numbers are not going away any
    time soon, and if you want to properly integrate a VoIP system with as
    many telephone networks as possible, you’re going to need to handle the
    PSTN in some way.</p><p><a id="InternetCallRouting_id288926"></a>ENUM maps telephone numbers onto
    the Domain Name System (DNS). In theory, ENUM is a great idea. Why not cut
    out the PSTN altogether, and simply route phone calls directly between
    endpoints using the same numbering plan? We’re not sure this idea is ever
    going to become what the emerging telecom community would like it to be,
    though. The reason? Nobody really can say who owns phone numbers.</p><div class="sect2" title="E.164 and the ITU"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id288933"></a>E.164 and the ITU</h3></div></div></div><p><a id="InternetCallRouting_id288938"></a><a id="I_indexterm12_d1e25394" class="indexterm"></a><a id="I_indexterm12_d1e25399" class="indexterm"></a><a id="I_indexterm12_d1e25402" class="indexterm"></a><a id="I_indexterm12_d1e25409" class="indexterm"></a>The International Telecommunication Union (ITU) is a
      United Nations agency that is actually older than the UN itself. It was
      founded in 1865 as the International Telegraph Union. The ITU-T sector,
      known for many decades as CCITT (Comité consultatif international
      téléphonique et télégraphique),<a id="I_indexterm12_d1e25413" class="indexterm"></a><a id="I_indexterm12_d1e25416" class="indexterm"></a> is the standards body responsible for all of the
      protocols used by the PSTN, as well as many that are used in VoIP. Prior
      to the advent of VoIP, the workings of the ITU-T sector were of little
      interest to the average person, and membership was generally limited to
      industries and institutions that had a vested interest in
      telecommunications standards.</p><p><a id="InternetCallRouting_id288951"></a>ITU standards tend to follow a
      letter-dot-number format. ITU-T standards you may have heard of include
      H.323, H.264, G.711, G.729, and so forth.</p><p><a id="InternetCallRouting_id288955"></a>E.164 is the ITU-T standard that
      defines the international numbering plan for the PSTN. If you’ve ever
      used a telephone, you’ve used E.164 addressing.</p><p><a id="InternetCallRouting_id288960"></a>Each country in the world has
      been assigned a country code,<sup>[<a id="id577275" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id577275" class="footnote">114</a>]</sup> and control of addressing in those countries is handled by
      the local authorities.</p><p><a id="InternetCallRouting_id288973"></a>E.164 numbers are limited to 15
      digits in length (excluding the prefix).</p><p><a id="InternetCallRouting_id288977"></a>In Asterisk, there is nothing
      special that needs to be done in order to handle E.164 addressing, other
      than to make sure your dialplan is suitable to the needs of any
      PSTN-compatible channels you may have.</p><p><a id="InternetCallRouting_id288982"></a>For example, if you’re operating
      in a NANP country, you will probably need to have the following pattern
      matches:</p><p><a id="InternetCallRouting_id288986"></a><a id="InternetCallRouting_id288987"></a></p><pre class="programlisting">_NXXNXXXXXX
_1NXXNXXXXXX
_011X.
_N11
</pre><p>In the UK, you might need something more like this:</p><p><a id="InternetCallRouting_id288992"></a><a id="InternetCallRouting_id288993"></a></p><pre class="programlisting">_0[123789]XXXXXXXXX
_0[123789]XXXXXXXX
</pre><p>And in Australia, your dialplan might have these pattern
      matches:</p><p><a id="InternetCallRouting_id288998"></a><a id="InternetCallRouting_id288999"></a></p><pre class="programlisting">_NXXXXXXX
_0XXXXXXXXX
</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="InternetCallRouting_id289005"></a>Please don’t just copy and
        paste these pattern matches into your <span class="keep-together">dial</span><span class="keep-together">plan</span>. The peculiarities of regional
        dialplans are tricky, and change constantly. One important item that
        needs to be carefully considered is the region-specific number for
        emergency calling, as discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313" title="Emergency Dialing">the section called “Emergency Dialing”</a>. You don’t want to get this
        stuff wrong.</p></div><div class="sidebar" title="The North American Numbering Plan Authority"><a id="InternetCallRouting_id289012"></a><div class="titlepage"><div><div><p class="title"><strong>The North American Numbering Plan Authority</strong></p></div></div></div><p><a id="InternetCallRouting_id289017"></a><a id="I_indexterm12_d1e25462" class="indexterm"></a>In much of North America, the North American Numbering
        Plan (NANP) is in use. All countries in the NANP are assigned to
        country code <code class="literal">1</code>. Canada and the US
        are the most well-known of these countries, but the NANP actually
        includes around 24 different countries and territories (mostly in the
        Caribbean).</p></div></div><div class="sect2" title="ENUM"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289026"></a>ENUM</h3></div></div></div><p><a id="InternetCallRouting_id289031"></a><a id="I_indexterm12_d1e25475" class="indexterm"></a><a id="I_indexterm12_d1e25482" class="indexterm"></a>In order to allow the mapping of E.164 numbers onto the
      DNS namespace, a way of representing phone numbers as DNS names had to
      be devised.</p><p><a id="InternetCallRouting_id289036"></a>This concept is defined in RFC
      3761, helpfully named “The E.164 to Uniform Resource Identifiers (URI)
      Dynamic Delegation Discovery System (DDDS) Application (ENUM).” ENUM
      reportedly stands for Electronic NUmber Mapping.</p><p><a id="InternetCallRouting_id289045"></a>According to the RFC, converting
      a phone number into an ENUM-compatible address requires the following
      algorithm:</p><a id="InternetCallRouting_id289049"></a><pre class="programlisting">1. Remove all characters with the exception of the digits.
For example, the First Well Known Rule produced the Key
"+442079460148".  This step would simply remove the
leading "+", producing "442079460148".

2. Put dots (".") between each digit. Example:
      4.4.2.0.7.9.4.6.0.1.4.8

3. Reverse the order of the digits. Example:
      8.4.1.0.6.4.9.7.0.2.4.4

4. Append the string ".e164.arpa" to the end.  Example:
      8.4.1.0.6.4.9.7.0.2.4.4.e164.arpa
</pre><p><a id="InternetCallRouting_id289057"></a>Clear as mud?</p><p><a id="InternetCallRouting_id289060"></a>ENUM has not taken off. The
      reasons appear to be mostly political in nature. The problem stems from
      the fact that there is no one organization that controls numbering on
      the PSTN the way that IANA does for the Internet. Since no one entity
      has a clear mandate for managing E.164 numbers globally, the challenge
      of maintaining an accurate and authoritative database for ENUM has
      proved elusive.</p><p><a id="InternetCallRouting_id289067"></a>Some countries in Europe have
      done a good job of delivering reliable ENUM databases, but in country
      code 1 (NANP), which contains multiple countries and therefore multiple
      regulatory bodies, the situation has become an illogical mess. This is
      hardly surprising, since the carriers that control E.164 addressing
      can’t reasonably be expected to get enthusiastic about allowing you to
      bypass their networks. The organizations responsible for implementing
      ENUM in North America have tended to work toward creating a PSTN on the
      Internet, which could save them money, but not you or I.</p><p><a id="InternetCallRouting_id289075"></a>This is not at all what is
      wanted. Why would I want to route VoIP calls from my system to yours
      across a network that wants to charge me for the privilege? SIP is
      designed to route calls between endpoints, and has no real use for the
      concept of a carrier.</p><p><a id="InternetCallRouting_id289081"></a>The advantage of all this is
      supposed to be that when an ENUM lookup is performed, a valid SIP URI is
      returned.</p></div><div class="sect2" title="Asterisk and ENUM"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289086"></a>Asterisk and ENUM</h3></div></div></div><p><a id="InternetCallRouting_id289092"></a><a id="I_indexterm12_d1e25508" class="indexterm"></a><a id="I_indexterm12_d1e25515" class="indexterm"></a>Asterisk can perform lookups against ENUM databases using
      either the <code class="literal">ENUMLOOKUP()</code> function or a
      combination of the <code class="literal">ENUMQUERY()</code> and
      <code class="literal">ENUMRESULT()</code> dialplan functions.
      <code class="literal">ENUMLOOKUP()</code> only returns a single
      value back from the lookup, and is useful when you know there is likely
      to only be one return value (such as the SIP URI you want the system to
      dial), or if you simply want to get the number of records
      available.</p><div class="sidebar" title="Status of ENUM Around the World"><a id="InternetCallRouting_id289111"></a><div class="titlepage"><div><div><p class="title"><strong>Status of ENUM Around the World</strong></p></div></div></div><p><a id="InternetCallRouting_id289117"></a><a id="I_indexterm12_d1e25537" class="indexterm"></a>In the NANP (and many other) countries, the official
        <code class="filename">e164.arpa</code> zone has not been
        formally implemented, and therefore there is no official place to go
        to perform ENUM lookups for NANP numbers.</p><p><a id="InternetCallRouting_id289123"></a>A list of the statuses of
        various countries’ implementations of ENUM can be found at <a class="ulink" href="http://enumdata.org/" target="_top">http://enumdata.org/</a>. For those countries fortunate
        enough to have ENUM in production, you can perform ENUM lookups
        directly to their <code class="filename">e164.arpa</code> zones
        of those countries fortunate enough to have ENUM in production.</p><p><a id="InternetCallRouting_id289134"></a>For countries without
        <code class="filename">e164.arpa</code> zones, there are
        several alternative places to perform lookups, the most popular
        currently being <a class="ulink" href="http://www.e164.org/" target="_top">http://www.e164.org</a>. Note that
        these organizations have no formal mandate to maintain the zones they
        represent. They are community-based, best-effort projects, and the
        data contained in them will frequently be out-of-date.</p></div><p><a id="InternetCallRouting_id289147"></a>An ENUM lookup in the dialplan
      might look like this:</p><p><a id="InternetCallRouting_id289150"></a><a id="InternetCallRouting_id289151"></a></p><pre class="programlisting">exten =&gt; _X.,1,Set(CurrentExten=${FILTER(0-9,${EXTEN})})
   same =&gt; n,Set(LookupResult=${ENUMLOOKUP(${CurrentExten},sip,,,e164.arpa)})
   same =&gt; n,GotoIf($[${EXISTS(${LookupResult})}]?HaveLocation,1)
   same =&gt; n,Set(LookupResult=${ENUMLOOKUP(${CurrentExten},sip,,,e164.org)})
   same =&gt; n,GotoIf($[${ISNULL(${LookupResult})}]?NormalCall,1:HaveLocation,1)

exten =&gt; HaveLocation,1,Verbose(2,Handle dialing via SIP URI returned)
   exten =&gt; ...

exten =&gt; NormalCall,1,Verbose(2,Handle dialing via standard PSTN route)
   exten =&gt; ...
</pre><p>The dialplan code we just looked at will take the number
      dialed and pass it to the <code class="literal">ENUMLOOKUP()</code> function.<a id="I_indexterm12_d1e25570" class="indexterm"></a><a id="I_indexterm12_d1e25573" class="indexterm"></a> It requests the method type to be <code class="literal">sip</code> (we want the SIP URI returned) and the
      lookup to be performed first against the listings in DNS found in the
      <span class="emphasis"><em>e164.arpa</em></span> zone, and next against the records found
      at <a class="ulink" href="http://www.e164.org/" target="_top">http://www.e164.org</a>.</p><p><a id="InternetCallRouting_id289182"></a>Outside the countries that have
      implemented it, there is little uptake of ENUM. As such, many ENUM
      queries will not return any results. This is not expected to change in
      the near future, and ENUM will remain a curiosity until more widely
      implemented.<a id="I_indexterm12_d1e25590" class="indexterm"></a><a id="I_indexterm12_d1e25591" class="indexterm"></a></p></div></div><div class="sect1" title="ISN, ITAD, and freenum.org"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InternetCallRouting_id289190"></a>ISN, ITAD, and freenum.org</h2></div></div></div><p><a id="InternetCallRouting_id289195"></a><a id="index-876Q386ID1S" class="indexterm"></a>Finally we get to the cool part of this chapter.</p><p><a id="InternetCallRouting_id289198"></a>The biggest shortcoming of ENUM is
    that it uses a numbering system that is not under the control of any
    Internet numbering authorities.<sup>[<a id="id577904" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id577904" class="footnote">115</a>]</sup> The <span class="emphasis"><em>freenum.org</em></span> project solves this
    problem by utilizing a numbering scheme that is managed by IANA. This
    means that a formal, globally valid, nongeographic numbering system for
    VoIP can be immediately and easily implemented without getting mired in
    the bureaucracy and politics that burden the E.164 numbering
    system.</p><div class="sidebar"><a id="I_sidebar12_d1e25611"></a><div class="titlepage"></div><p>John Todd, who manages the project, notes that
      <span class="quote">“<span class="quote"><span class="emphasis"><em>Freenum.org is a DNS service that uses ENUM-like
      mapping methods to allow many services to be mapped to a keypad-friendly
      string. The most obvious and widely used method for this is connecting
      VoIP users together for free by creating an easily-remembered dial
      string that maps to SIP URIs in the background. However, anything that
      can appear in a NAPTR record <a id="I_indexterm12_d1e25617" class="indexterm"></a>(email, instant messenger, web addresses) can be mapped to
      an ISN-style freenum.org address. The goal of the project is to provide
      free numeric pointers to the billions of phones that support only 0–9, *
      and # characters and allow those devices to communicate via VoIP or
      other next-generation protocols. The project is spread out across more
      than thirty DNS servers worldwide.</em></span></span>”</span></p></div><div class="sect2" title="Got ISN?"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289215"></a>Got ISN?</h3></div></div></div><p><a id="InternetCallRouting_id289220"></a><a id="I_indexterm12_d1e25625" class="indexterm"></a><a id="I_indexterm12_d1e25630" class="indexterm"></a>The heart of the <span class="emphasis"><em>freenum.org</em></span> concept
      is the ITAD Subscriber Number (ISN). The ISN is a numeric string that is
      composed of an extension number on your system, an asterisk character
      separator (<code class="literal">*</code>),<a id="I_indexterm12_d1e25644" class="indexterm"></a><a id="I_indexterm12_d1e25647" class="indexterm"></a><sup>[<a id="id578045" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578045" class="footnote">116</a>]</sup> and a number that is unique to your organization called an
      IP Telephony Administrative Domain (ITAD) number. The advantage of the
      ISN is that it can be dialed from any telephone. An ISN would look
      something like this:</p><a id="I_programlisting12_d1e25657"></a><pre class="programlisting">0*1273</pre><p><a id="InternetCallRouting_id289247"></a>which would represent
      <span class="emphasis"><em>extension zero at ITAD 1273</em></span><sup>[<a id="id578082" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578082" class="footnote">117</a>]</sup> and would resolve to
      <code class="uri">sip:0@shifteight.org</code>.</p><p><a id="InternetCallRouting_id289266"></a>You control your extension
      numbers (everything to the left of the <code class="literal">*</code>). Your ITAD is assigned by IANA (the same
      organization that controls IP and MAC addresses).</p><p><a id="InternetCallRouting_id289270"></a>Once your ITAD is assigned, you
      will be able to publish ISNs on your website, or on business cards, or
      wherever you would normally publish phone numbers. Any system capable of
      dialing ISNs will allow its users to call you by dialing your ISN. Calls
      will be routed directly between the two systems using the SIP URI that
      <span class="emphasis"><em>freenum.org</em></span> returns.</p></div><div class="sect2" title="ITAD Subscriber Numbers (ISNs)"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289278"></a>ITAD Subscriber Numbers (ISNs)</h3></div></div></div><p><a id="InternetCallRouting_id289284"></a>The ISN does not replace a SIP
      URI, but rather complements it by allowing dialing of VoIP numbers using
      only characters found on a standard telephone dialpad. In order to
      resolve an ISN into a valid URI, the DNS system will query the ISN
      against the <span class="emphasis"><em>freenum.org</em></span> domain. Any DNS lookup
      against your ISN will return a URI that defines how your system expects
      to receive calls to that ISN.<sup>[<a id="id578150" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578150" class="footnote">118</a>]</sup></p></div><div class="sect2" title="Management of Internet Numbering"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id289300"></a>Management of Internet Numbering</h3></div></div></div><p><a id="InternetCallRouting_id289306"></a><a id="I_indexterm12_d1e25701" class="indexterm"></a><a id="I_indexterm12_d1e25708" class="indexterm"></a>The Internet Assigned Numbers Authority (IANA) is the body
      responsible for managing any numbering system that exists as a result of
      an RFC that requires a numerical database of some kind. The most
      well-known responsibility of IANA is the delegation of IP addresses to
      the five Regional Internet Registries that control all of the public IP
      addresses on the planet.<sup>[<a id="id578213" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578213" class="footnote">119</a>]</sup> These organizations are responsible for the assignment of
      <span class="keep-together">IP addresses</span> within their
      regions.</p><p><a id="InternetCallRouting_id247787"></a>There are many other numbering
      schemes that have been created as a result of an RFC. Other IANA-managed
      numbers include MAC addresses—specifically, the Organizationally Unique
      Identifier (OUI) portion of the MAC addressing space.</p><p><a id="InternetCallRouting_id247793"></a>Several years ago, a protocol
      named TRIP (Telephony Routing over IP) <a id="I_indexterm12_d1e25723" class="indexterm"></a><a id="I_indexterm12_d1e25726" class="indexterm"></a>was created. While this protocol never took off, and is
      unlikely to see any future growth, it did offer us one incredibly useful
      thing: the ITAD. Since ITADs are part of an RFC, the IANA is mandated to
      maintain a database of ITADs. This is what makes
      <span class="emphasis"><em>freenum.org</em></span> possible.</p></div><div class="sect2" title="IP Telephony Administrative Domains (ITADs)"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id247800"></a>IP Telephony Administrative Domains (ITADs)</h3></div></div></div><p><a id="InternetCallRouting_id247805"></a><a id="I_indexterm12_d1e25737" class="indexterm"></a><a id="I_indexterm12_d1e25744" class="indexterm"></a><span class="emphasis"><em>Freenum.org</em></span> takes advantage of IANA’s
      responsibility to maintain a database of ITAD numbers and allows us to
      build simple, standards-based, globally relevant, and community-driven
      numbering plans for VoIP.<sup>[<a id="id578335" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578335" class="footnote">120</a>]</sup> You can find the list of currently assigned ITAD numbers
      at <a class="ulink" href="http://www.iana.org/assignments/trip-parameters/trip-parameters.xml#trip-parameters-5" target="_top">http://www.iana.org/assignments/trip-parameters/trip-parameters.xml#trip-parameters-5</a>.</p><p><a id="InternetCallRouting_id247828"></a>You will want to obtain your own
      ITAD number by submitting the form located at <a class="ulink" href="http://www.iana.org/cgi-bin/assignments.pl" target="_top">http://www.iana.org/cgi-bin/assignments.pl</a>.</p><p><a id="InternetCallRouting_id247836"></a>This form should be filled out
      as shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#requestforassign" title="Figure 12.1. Request for Assignments form">Figure&nbsp;12.1, “Request for Assignments form”</a>.</p><div class="figure-float"><div class="figure"><a id="requestforassign"></a><p class="title"><strong>Figure&nbsp;12.1.&nbsp;Request for Assignments form</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject12_d1e25772"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_12inf01.png" width="432" alt="Request for Assignments form"></div></div></div><br class="figure-break"></div><p><a id="InternetCallRouting_id247924"></a>Your application will be
      reviewed by a Real Human Being™, and within a few days you should be
      assigned an ITAD by IANA. A few days later, you will also receive
      information for your <span class="emphasis"><em>freenum.org</em></span> account (there is
      currently a simple review process to ensure that bots and spammers don’t
      abuse the system). You will then need to log onto the
      <span class="emphasis"><em>freenum.org</em></span> site and define the parameters for your
      ITAD.</p></div><div class="sect2" title="Create a DNS Entry for Your ITAD"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id247934"></a>Create a DNS Entry for Your ITAD</h3></div></div></div><p><a id="InternetCallRouting_id247940"></a><a id="I_indexterm12_d1e25789" class="indexterm"></a>In the top-right corner of the
      <span class="emphasis"><em>freenum.org</em></span> site, you will see a <span class="emphasis"><em>Sign in
      here</em></span> link. Your username is the email address you registered
      with IANA, and your password will have been emailed to you by the
      <span class="emphasis"><em>freenum.org</em></span> system.<sup>[<a id="id578498" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578498" class="footnote">121</a>]</sup></p><p><a id="InternetCallRouting_id247956"></a>You will be presented with a
      list of your assigned ITADs. In order for your new ITAD to work, you
      will need to ensure the DNS records are up-to-date.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InternetCallRouting_id247962"></a>There are two methods of
        handling DNS for your ITAD. The first (and simplest) is to have a
        NAPTR record <a id="I_indexterm12_d1e25817" class="indexterm"></a>inserted into the <span class="emphasis"><em>freenum.org</em></span> zone.
        The other way is to create a zone for your ITAD, and have
        <span class="emphasis"><em>freenum.org</em></span> delegate that zone to your name
        servers. We will only discuss the first method here, but if you are
        familiar with NAPTR/ENUM administration for a DNS server, you can use
        the second method.</p></div><p><a id="InternetCallRouting_id247971"></a>The
      <span class="emphasis"><em>freenum.org</em></span> folks have created the <a id="I_indexterm12_d1e25832" class="indexterm"></a><a id="I_indexterm12_d1e25835" class="indexterm"></a>Freenum Automated Self-Service Tool (FASST) to simplify
      DNS record entry for you. The essential fields will already be filled
      out. The only thing you need to change is under the <span class="emphasis"><em>DNS
      Setting</em></span> section of the form: specify the hostname of your PBX
      and save the changes. The FASST tool uses a regular expression to
      convert an ISN lookup to a SIP URI.</p><p><a id="InternetCallRouting_id247977"></a>In order to specify your
      hostname,<a id="I_indexterm12_d1e25844" class="indexterm"></a> you will need to modify the sample regular expression
      provided by FASST, changing the sample hostname <code class="literal">sip.yourdomain.com</code> to the hostname of your
      PBX. So, for example, in our case we would want to change:</p><a id="I_programlisting12_d1e25851"></a><pre class="programlisting">!^\\+*([^\\*]*)!sip:\\1@sip.yourdomain.com!</pre><p><a id="InternetCallRouting_id247991"></a>to:</p><a id="I_programlisting12_d1e25855"></a><pre class="programlisting">!^\\+*([^\\*]*)!sip:\\1@pbx.shifteight.org!</pre><p><a id="InternetCallRouting_id247998"></a>The other fields in the DNS
      entry should not be changed unless you know what you are doing. The rest
      of the fields in the form are optional, and can be filled out as you see
      fit.</p><div class="sidebar"><a id="I_sidebar12_d1e25861"></a><div class="titlepage"></div><p>John Todd notes: <span class="quote">“<span class="quote"><span class="emphasis"><em>For those sites which have
        extremely complex configurations or geographically diverse offices
        with different SIP servers handling different prefixes (for instance:
        12xxx goes to the Asterisk server in France, 13xxx to the Asterisk
        server in Germany, and so on) then there are more sophisticated
        methods where you run your own delegated zone out of the freenum.org
        domain, but those are outside the scope of this book but can be
        learned about on the freenum.org site.</em></span></span>”</span></p></div></div><div class="sect2" title="Testing Your ITAD"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248004"></a>Testing Your ITAD</h3></div></div></div><p><a id="InternetCallRouting_id248010"></a><a id="I_indexterm12_d1e25871" class="indexterm"></a><a id="I_indexterm12_d1e25878" class="indexterm"></a><a id="I_indexterm12_d1e25883" class="indexterm"></a>As is often the case with DNS changes, it can take a few
      days for your changes to propagate through the system. To check, you can
      Google for “online dig tool” to find a web-based lookup tool, or use the
      <span class="emphasis"><em>dig</em></span> tool under Linux:</p><p><a id="InternetCallRouting_id248018"></a><a id="I_programlisting12_d1e25893"></a></p><pre class="programlisting">$ <strong class="userinput"><code>dig NAPTR 4.3.2.1.1273.freenum.org</code></strong></pre><p><a id="InternetCallRouting_id248023"></a>Once your record is updated in
      the system, the result will include the following:</p><p><a id="InternetCallRouting_id248027"></a><a id="InternetCallRouting_id248028"></a></p><pre class="programlisting">;; ANSWER SECTION: 
4.3.2.1.1273.freenum.org. 86400 IN NAPTR 100 10 "u" "E2U+sip" 
"!^\\+*([^\\*]*)!sip:\\1@shifteight.org!" .</pre><p><a id="InternetCallRouting_id248033"></a>If the answer section does not
      include the regular expression containing your domain name, the records
      have not updated and you should wait a few more hours (or even leave it
      for a day).</p></div><div class="sect2" title="Using ISNs in Your Asterisk System"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248039"></a>Using ISNs in Your Asterisk System</h3></div></div></div><p><a id="InternetCallRouting_id248044"></a><a id="I_indexterm12_d1e25908" class="indexterm"></a><a id="I_indexterm12_d1e25915" class="indexterm"></a>So now that you’ve got your own ITAD (you did sign up,
      right?), you’ll want to make it available to others, and also configure
      your dialplan to allow you to dial other ITADs.</p><p><a id="InternetCallRouting_id248049"></a>Under the <code class="literal">[globals]</code> section of your dialplan (<code class="filename">/etc/asterisk/extensions.conf</code>), add a global
      variable that contains your ITAD:</p><p><a id="InternetCallRouting_id248061"></a><a id="InternetCallRouting_id248062"></a></p><pre class="programlisting">[globals]
ITAD = 1273 ; replace '1273' with your own ITAD number</pre><p>To
      allow calling to ITADs from your system, you will need something like
      the following dialplan code<sup>[<a id="id578907" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id578907" class="footnote">122</a>]</sup>:</p><p><a id="InternetCallRouting_id248068"></a><a id="InternetCallRouting_id248069"></a></p><pre class="programlisting">[OutgoingISN]
exten =&gt; _X*X!,1,GoSub(subFreenum,start,1(${EXTEN}))
exten =&gt; _XX*X!,1,GoSub(subFreenum,start,1(${EXTEN}))
exten =&gt; _XXX*X!,1,GoSub(subFreenum,start,1(${EXTEN}))
exten =&gt; _XXXX*X!,1,GoSub(subFreenum,start,1(${EXTEN}))
exten =&gt; _XXXXX*X!,1,GoSub(subFreenum,start,1(${EXTEN}))
; you may need to add more lines here to handle XXXXXX*X, XXXXXXX*X, and so forth

[subFreenum]
exten =&gt; start,1,Verbose(2,Performing ISN lookup)
   same =&gt; n,Set(ISN=${FILTER(0-9*,${ARG1})})
   same =&gt; n,Set(Result=${ENUMLOOKUP(${ISN},sip,s,,freenum.org)})
   same =&gt; n,GotoIf($[${EXISTS(${Result})}]?call,1:no_result,1)

exten =&gt; call,1,Verbose(2,Placing call to ISN --${ISN}-- via ${Result})
   same =&gt; n,Dial(SIP/${Result})
   same =&gt; n,Return()

exten =&gt; no_result,1,Verbose(2,Lookup for ISN: --${ISN}-- returned no result)
   same =&gt; n,Playback(silence/1&amp;invalid)
   same =&gt; n,Return()
</pre><p><a id="InternetCallRouting_id248082"></a>We have added two new contexts
      to our dialplan: <code class="literal">OutgoingISN</code> and
      <code class="literal">subFreenum</code>. The <code class="literal">OutgoingISN</code> context controls who can dial ISN
      numbers from within your dialplan. If you have been following our
      examples throughout this book, you should have a context called <code class="literal">LocalSets</code>, which is the context where all your
      telephones enter the dialplan. Including <code class="literal">OutgoingISN</code> within <code class="literal">LocalSets</code> enables dialing of ISN
      numbers:</p><p><a id="InternetCallRouting_id248107"></a><a id="InternetCallRouting_id248108"></a></p><pre class="programlisting">[LocalSets]
include =&gt; OutgoingISN  ; include the context that enables ISN dialing
include =&gt; CallPlace    ; use subroutine to determine what you can dial
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InternetCallRouting_id248114"></a>We have placed the <code class="literal">OutgoingISN</code> include above the <code class="literal">CallPlace</code> include because Asterisk will
          perform extension matching in the order of the includes, and since
          <code class="literal">CallPlace</code> has a more general
          pattern match than our <code class="literal">OutgoingISN</code> pattern matches, we need to
          make sure <code class="literal">OutgoingISN</code> appears
          first.</p></div><p>The magic for dialing ISN numbers is handled in the <code class="literal">subFreenum</code> context.<a id="I_indexterm12_d1e25986" class="indexterm"></a><a id="I_indexterm12_d1e25989" class="indexterm"></a> Our <code class="literal">OutgoingISN</code>
      context will pass the requested extension (e.g., <code class="literal">1234*256</code>) to the <code class="literal">subFreenum</code> subroutine. After the initial call
      to <code class="literal">Verbose()</code> on the first line, the
      subroutine will filter the request for numbers and the asterisk
      (<code class="literal">*</code>) character to make the extension
      safe. The result will then be assigned to the <code class="literal">ISN</code> channel variable:</p><a id="I_programlisting12_d1e26014"></a><pre class="programlisting">exten =&gt; start,n,Set(ISN=${FILTER(0-9*,${ARG1})})</pre><p><a id="InternetCallRouting_id248170"></a>The subroutine will then perform
      a lookup for the ISN via the DNS system using the <code class="literal">ENUMLOOKUP()</code> dialplan function. Options passed
      to the <code class="literal">ENUMLOOKUP()</code> function
      <a id="I_indexterm12_d1e26024" class="indexterm"></a><a id="I_indexterm12_d1e26027" class="indexterm"></a>include:</p><div class="itemizedlist"><a id="InternetCallRouting_id248181"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="InternetCallRouting_id248183"></a><a id="InternetCallRouting_id248185"></a>The ISN number to look
          up</p></li><li class="listitem"><p><a id="InternetCallRouting_id248190"></a><a id="InternetCallRouting_id248192"></a>The method type to look up
          and return (SIP)</p></li><li class="listitem"><p><a id="InternetCallRouting_id248196"></a><a id="InternetCallRouting_id248198"></a>The <code class="literal">s</code> option, which tells Asterisk to perform
          an ISN-style lookup instead of a standard ENUM lookup</p></li><li class="listitem"><p><a id="InternetCallRouting_id248207"></a><a id="InternetCallRouting_id248209"></a>The zone suffix for
          performing the lookups (we’ll use <code class="literal">freenum.org</code>, but the default is <code class="literal">e164.arpa</code>)</p></li></ul></div><p><a id="InternetCallRouting_id248220"></a>Our code for performing the
      lookup then looks like this:</p><a id="I_programlisting12_d1e26059"></a><pre class="programlisting">exten =&gt; start,n,Set(Result=${ENUMLOOKUP(${ISN},sip,s,,freenum.org)})</pre><p><a id="InternetCallRouting_id248230"></a>Following the lookup and storing
      the result in the <code class="literal">${Result}</code> channel
      variable, our subroutine will verify whether we received a result or
      not:</p><a id="I_programlisting12_d1e26066"></a><pre class="programlisting">exten =&gt; start,n,GotoIf($[${EXISTS(${Result})}]?call,1:no_result,1)</pre><p><a id="InternetCallRouting_id248244"></a>If no result is received, the
      call will be handled in the <code class="literal">no_result</code>
      extension. If a result is received back from our lookup, then execution
      will continue at the <code class="literal">call</code> extension
      where the call will be placed using the result stored in the <code class="literal">${Result}</code> channel variable.</p><div class="sect3" title="Receiving calls to your ITAD"><div class="titlepage"><div><div><h4 class="title"><a id="id579341"></a>Receiving calls to your ITAD</h4></div></div></div><p><a id="InternetCallRouting_id248260"></a><a id="I_indexterm12_d1e26083" class="indexterm"></a><a id="I_indexterm12_d1e26086" class="indexterm"></a>Receiving calls to your ITAD is much simpler. If your
        system supports incoming SIP URIs, ISNs will already work for
        you.<sup>[<a id="id579381" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id579381" class="footnote">123</a>]</sup> We showed the configuration required to accept calls to
        your system in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934" title="Accepting Calls to Your System">the section called “Accepting Calls to Your System”</a>.<a id="I_indexterm12_d1e26098" class="indexterm"></a></p></div></div></div><div class="sect1" title="Security and Identity"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InternetCallRouting_id248274"></a>Security and Identity</h2></div></div></div><p><a id="InternetCallRouting_id248280"></a><a id="index-176G446BI1W" class="indexterm"></a><a id="index-011N888QI2L" class="indexterm"></a>It is a sad fact of the Internet that there are a few
    selfish, greedy criminal types out there who think nothing of attempting
    to take advantage of people for their own gain. In telecom, this behavior
    represents several risks to you.</p><p><a id="InternetCallRouting_id248285"></a>In this section, we will focus on
    security issues relating to the portions of your system that you intend to
    make publicly available through the Internet. While it would be simple to
    just refuse to allow any sort of external connections, the reality is that
    if you want people to be able to call you for free from the Internet (for
    example, if you intend to publish your company’s SIP URIs on your web
    page), you are going to have to define a secure place within your system
    where those calls will arrive. Securing your incoming public VoIP
    connections is conceptually similar to implementing a DMZ in traditional
    networking.<sup>[<a id="id579479" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id579479" class="footnote">124</a>]</sup></p><p><a id="InternetCallRouting_id248302"></a>In Asterisk, certain contexts in
    your dialplan cannot be trusted. This means that you will need to
    carefully consider what resources are available to channels that enter the
    system through these contexts, and ensure that only certain services and
    features are available.</p><div class="sect2" title="Toll Fraud"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248308"></a>Toll Fraud</h3></div></div></div><p><a id="InternetCallRouting_id248313"></a><a id="I_indexterm12_d1e26123" class="indexterm"></a><a id="I_indexterm12_d1e26130" class="indexterm"></a><a id="I_indexterm12_d1e26135" class="indexterm"></a><a id="I_indexterm12_d1e26140" class="indexterm"></a>Toll fraud is by far the biggest risk to your phone system
      in terms of the potential for ruinous cost. It is not unheard of for
      fraudsters to rack up tens of thousands of dollars in stolen phone calls
      over the course of a few days.</p><p><a id="InternetCallRouting_id248319"></a>Toll fraud is not a new thing,
      having existed prior to VoIP; however, the enabling nature of VoIP means
      that it is easier for fraudsters to take advantage of unsecured systems.
      Most carriers will not take responsibility for these costs, and thus if
      your system is compromised you could be stuck with a very large phone
      bill. While carriers are getting better and better at alerting their
      customers to suspicious activity, that does not absolve you of
      responsibility for ensuring your system is hardened against this very
      real and very dangerous threat.</p><p><a id="InternetCallRouting_id248327"></a>Within your Asterisk system, it
      is vitally important that you know what resources on your system are
      exposed to the outside world and ensure that those resources are
      secure.</p><p><a id="InternetCallRouting_id248332"></a>The most common form of toll
      fraud these days is accomplished by brute-force attack. In this
      scenario, the thieves will have a script that will contact your system
      and attempt to register as a valid user. If they are able to register as
      a telephone on your system, the flood of calls will commence, and you
      will be stuck with the bill. If you are using simple extension numbers
      and easy-to-guess passwords, and your system accepts registrations from
      outside your firewall, it is certain that you will eventually be the
      victim of toll fraud.</p><p><a id="InternetCallRouting_id248340"></a>Brute-force attacks can also
      cause performance problems with your system, as one of these scripts can
      flood your router and PBX with massive numbers of registration
      attempts.</p><p><a id="InternetCallRouting_id248345"></a>The following tactics have
      proven successful in minimizing the risk of toll fraud:</p><div class="orderedlist"><a id="InternetCallRouting_id248349"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="InternetCallRouting_id248351"></a><a id="InternetCallRouting_id248354"></a>Do not use easy-to-guess
          passwords.<a id="I_indexterm12_d1e26158" class="indexterm"></a> Passwords should be at least eight characters long
          and contain a mix of digits, letters, and characters. <code class="literal">8a$j03H%</code> is a good password.<sup>[<a id="id579675" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id579675" class="footnote">125</a>]</sup> <code class="literal">1234</code> is not.</p></li><li class="listitem"><p><a id="InternetCallRouting_id248373"></a><a id="InternetCallRouting_id248375"></a>Do not use extension numbers
          for your SIP registrations <a id="I_indexterm12_d1e26177" class="indexterm"></a><a id="I_indexterm12_d1e26182" class="indexterm"></a>in <code class="filename">sip.conf</code>.
          Instead of <code class="literal">[1000]</code>, use something
          like a MAC address (something like <code class="literal">[0004f2123456]</code> would be much more
          difficult for a brute-force script to guess).</p></li><li class="listitem"><p><a id="InternetCallRouting_id248388"></a><a id="InternetCallRouting_id248390"></a>Use an analysis script such
          as <code class="filename">fail2ban</code> to tweak your
          internal firewall to block IP addresses that are displaying abusive
          behavior, such as massive packet floods.</p></li></ol></div><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="InternetCallRouting_id248397"></a>The <code class="filename">fail2ban</code> daemon <a id="I_indexterm12_d1e26209" class="indexterm"></a>is emerging as a popular way to automatically respond to
        security threats. We’ll discuss it further in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a>.</p></div></div><div class="sect2" title="Spam over Internet Telephony (SPIT)"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248402"></a>Spam over Internet Telephony (SPIT)</h3></div></div></div><p><a id="InternetCallRouting_id248408"></a><a id="I_indexterm12_d1e26219" class="indexterm"></a><a id="I_indexterm12_d1e26226" class="indexterm"></a><a id="I_indexterm12_d1e26231" class="indexterm"></a>VoIP spam has not yet taken off, but rest assured, it
      will. Spammers all over the world are drooling at the prospect of being
      able to freely assault anyone and everyone with an Internet-enabled
      phone system.</p><p><a id="InternetCallRouting_id248413"></a>Like email, VoIP entails a
      certain level of trust, in that it assumes that every phone call is
      legitimate. Unfortunately, as with email spam, it only takes a few bad
      apples to spoil things for the rest of us.</p><p><a id="InternetCallRouting_id248419"></a>Many organizations and persons
      are working on ways to address SPIT now, before it becomes a problem.
      Some concepts being worked on include certificates and whitelists. No
      one method has emerged as the definitive solution.</p><p><a id="InternetCallRouting_id248424"></a>While it would be easy to simply
      lock our systems away from the world, the fact is that Internet
      telephony is something that every business will be expected to support
      in the not-too-distant future. SPIT will increasingly become a problem
      as more and more unsavory characters decide that this is the new road to
      riches.</p><p><a id="InternetCallRouting_id248430"></a>Solving the SPIT problem will be
      an ongoing process: a battle between us and The Bad Guys™.</p></div><div class="sect2" title="Distributed Denial of Service Attacks"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248436"></a>Distributed Denial of Service Attacks</h3></div></div></div><p><a id="InternetCallRouting_id248442"></a><a id="I_indexterm12_d1e26247" class="indexterm"></a><a id="I_indexterm12_d1e26254" class="indexterm"></a><a id="I_indexterm12_d1e26259" class="indexterm"></a><a id="I_indexterm12_d1e26262" class="indexterm"></a>SIP denial of service attacks are already happening on the
      Internet. Amazon’s EC2 cloud has become a popular place to originate
      these attacks from, and other cloud-based or compromised systems will
      become popular for these activities as well. The actual attacks are not
      strictly denial of service attacks (in the sense that they are not
      deliberately trying to choke your system); rather, they are attack
      campaigns that are typically trying to use brute force to locate
      exploitable holes in any systems they can find. As the sheer number of
      these attacks increases, the effect on the network will be similar to
      that of email spam.</p><p><a id="InternetCallRouting_id248451"></a>The previously mentioned
      <code class="filename">fail2ban</code> daemon can be useful in
      minimizing the effects of these attacks. Refer to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security" title="Chapter 26. Security">Chapter&nbsp;26, <em>Security</em></a> for more details.</p></div><div class="sect2" title="Phishing"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248457"></a>Phishing</h3></div></div></div><p><a id="InternetCallRouting_id248462"></a><a id="I_indexterm12_d1e26279" class="indexterm"></a><a id="I_indexterm12_d1e26286" class="indexterm"></a><a id="I_indexterm12_d1e26291" class="indexterm"></a>When a VoIP system has been compromised, one popular use
      of the compromised system is to relay fraud campaigns using the identity
      of the compromised system. Criminals engaging in so-called phishing
      expeditions will make random calls to lists of numbers, attempting to
      obtain credit card or other sensitive information, while posing as your
      organization.</p></div><div class="sect2" title="Security Is an Ongoing Process"><div class="titlepage"><div><div><h3 class="title"><a id="InternetCallRouting_id248469"></a>Security Is an Ongoing Process</h3></div></div></div><p><a id="InternetCallRouting_id248475"></a><a id="I_indexterm12_d1e26299" class="indexterm"></a><a id="I_indexterm12_d1e26306" class="indexterm"></a>In contrast to previous editions, throughout this book we
      have tried to provide examples and best practices that take security
      into consideration at all stages. Whatever you are working on, you
      should be thinking about security. While implementing good security
      requires more design, development, and testing effort, it will save you
      time and money in the long run.</p><p><a id="InternetCallRouting_id248482"></a>Most security holes happen as a
      result of something that was hastily implemented and wasn’t locked down
      later. “I’ll just quickly build this now, and I’ll clean it up later”
      are words you never want to say (or hear).<a id="I_indexterm12_d1e26314" class="indexterm"></a><a id="I_indexterm12_d1e26315" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="InternetCallRouting_id248492"></a>Conclusion</h2></div></div></div><p><a id="InternetCallRouting_id248497"></a>One of the dreams of VoIP was that
    it was going to make phone calls free. Over a decade later, we’re still
    paying for our phone calls. The technology has existed for some time, but
    the ease of use has not been there.</p><p><a id="InternetCallRouting_id248502"></a>It costs nothing to register your
    ITAD and set up your system to handle ISNs. If every Asterisk system
    deployed had an ITAD, and people started publishing their ISNs on
    websites, vcards, and business cards, the weight of the Asterisk community
    would drive industry adoption.</p><p><a id="InternetCallRouting_id248508"></a>Security considerations for VoIP
    have to be taken into consideration, but we expect that the benefits will
    outweigh the risks.</p><p><a id="InternetCallRouting_id248513"></a>Our collective dream of free
    Internet calling may be closer than we think.<a id="I_indexterm12_d1e26328" class="indexterm"></a><a id="I_indexterm12_d1e26329" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id574180" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id574180" class="para">106</a>] </sup>Seriously, get your butt over to
        <span class="emphasis"><em>freenum.org</em></span> and get your ISN today. It’s simple
        and free, and soon all the cool kids will have one.</p></div><div class="footnote"><p><sup>[<a id="ftn.id574384" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id574384" class="para">107</a>] </sup>Do you know where the <code class="literal">@</code>
          symbol is on your dialpad?</p></div><div class="footnote"><p><sup>[<a id="ftn.id574433" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id574433" class="para">108</a>] </sup>Bear in mind that an extension in Asterisk can be any
          alphanumeric string, such as <code class="literal">leif</code>
          or <code class="literal">100</code>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id574502" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id574502" class="para">109</a>] </sup>You could actually dial this URI directly from your phone and
          bypass the Asterisk server, but you can see how dialing <code class="literal">100</code> is going to be a lot more popular than
          trying to figure out how to type <code class="literal">0004f2a1b2c3@192.168.1.99</code> into your phone
          using just the numeric dialpad (it can be done, by the way).</p></div><div class="footnote"><p><sup>[<a id="ftn.id575044" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id575044" class="para">110</a>] </sup>This could just as easily be a proxy server, or any other
          server capable of handling incoming SIP connections.</p></div><div class="footnote"><p><sup>[<a id="ftn.id575847" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id575847" class="para">111</a>] </sup>We explain the use of <code class="literal">subEmailToExtensionLookup</code> in the
            following section.</p></div><div class="footnote"><p><sup>[<a id="ftn.id576271" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id576271" class="para">112</a>] </sup>In actual fact, what we are extracting is the voicemail box
            number; however, this number is generally going to be the same as
            the user’s dialable internal extension number. If it is not the
            same, this particular technique will not accomplish
            name-to-extension lookups, and another way will have to be
            found.</p></div><div class="footnote"><p><sup>[<a id="ftn.id576943" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id576943" class="para">113</a>] </sup>Technically, the characters <code class="literal">! # $ %
          &amp; ' * + / = ? ^ ` { | } ~</code> are also valid as part of
          the <code class="literal">local-part</code> of an email
          address; however, they are uncommon, and we have elected not to
          allow them in our dialplan examples.</p></div><div class="footnote"><p><sup>[<a id="ftn.id577275" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id577275" class="para">114</a>] </sup>With the exception of 24 countries and territories in country
          code 1, which are all part of the North American Numbering Plan
          Authority (NANPA).</p></div><div class="footnote"><p><sup>[<a id="ftn.id577904" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id577904" class="para">115</a>] </sup>More to the point, perhaps, is that E.164 numbers are controlled
        by far too many organizations, each one subjected to different
        regulations, and having goals that are not always compatible with the
        concept of global, free VoIP calling.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578045" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578045" class="para">116</a>] </sup>This character has nothing to do with the software that is the
          subject of this book; it simply refers to the <code class="literal">*</code> that is on the dialpad of every
          telephone. We wonder what might have been if, instead of Asterisk,
          Mark Spencer had decided to call his creation Octothorpe.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578082" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578082" class="para">117</a>] </sup>ITAD 1273 is assigned to
          <span class="emphasis"><em>shifteight.org</em></span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578150" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578150" class="para">118</a>] </sup>Although <span class="emphasis"><em>freenum.org</em></span> can handle ITADs
          that resolve to non-SIP URIs, the handling of multiple protocols is
          beyond the scope of this book. For now, we recommend you restrict
          your ISN to handling SIP URIs.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578213" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578213" class="para">119</a>] </sup>AfriNIC, APNIC, ARIN, LACNIC, and RIPE NCC.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578335" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578335" class="para">120</a>] </sup>Note that <span class="emphasis"><em>freenum.org</em></span> has consulted with
          the folks at IANA in regard to the use of ITADs with protocols other
          than TRIP.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578498" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578498" class="para">121</a>] </sup>This may take a few days, so if you’ve received your ITAD from
          IANA but not yet a password from <span class="emphasis"><em>freenum.org</em></span>,
          give it some time.</p></div><div class="footnote"><p><sup>[<a id="ftn.id578907" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id578907" class="para">122</a>] </sup>If people publish the users’ full DIDs instead of their
          internal extension numbers, the pattern matches will need to support
          up to 15 digits.</p></div><div class="footnote"><p><sup>[<a id="ftn.id579381" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579381" class="para">123</a>] </sup>If you’ve set up your ITAD and ISN correctly, the conversion
            from ISN dial string to SIP URI will take place before the call
            arrives on your doorstep.</p></div><div class="footnote"><p><sup>[<a id="ftn.id579479" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579479" class="para">124</a>] </sup>A DMZ is any portion of your network that you expose to the
        Internet (such as your website), and therefore cannot completely
        trust. It is not uncommon for organizations to place the PBX within a
        DMZ.</p></div><div class="footnote"><p><sup>[<a id="ftn.id579675" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579675" class="para">125</a>] </sup>Actually, since it’s published in this book, it is no
              longer a good password, but you get the idea.</p></div></div></div><div class="chapter" title="Chapter 13. Automatic Call Distribution (ACD) Queues"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-ACD"></a>Chapter&nbsp;13.&nbsp;Automatic Call Distribution (ACD) Queues</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289508">Queue Members</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288626">Automatically Logging Into and Out of Multiple Queues</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288932">Advanced Queues</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288963">Overflow</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289208">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="ACD_id285873"></a>An Englishman, even if he is alone, forms an
    orderly queue of one.</p><div class="attribution"><span>—<span class="attribution">George Mikes</span></span></div></div><p><a id="ACD_id244274"></a><a id="index-104E651IV3I" class="indexterm"></a><a id="index-021A288VC7A" class="indexterm"></a><a id="I_indexterm13_d1e26347" class="indexterm"></a>Automatic Call Distribution (ACD), or call queuing, provides a
  way for a PBX to queue up incoming calls from a group of users: it
  aggregates multiple calls into a holding pattern and assigns each call a
  rank that determines the order in which that call should be delivered to an
  available agent (typically, first in first out). When an agent becomes
  available, the highest-ranked caller in the queue is delivered to that
  agent, and everyone else moves up a rank.</p><p><a id="ACD_id256358"></a>If you have ever called an organization and heard
  “all of our representatives are busy,” you have experienced ACD. The
  advantage of ACD to the callers is that they don’t have to keep dialing back
  in an attempt to reach someone, and the advantages to the organizations are
  that they are able to better service their customers and to temporarily
  handle situations where there are more callers than there are
  agents.<sup>[<a id="id580381" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id580381" class="footnote">126</a>]</sup></p><p><a id="ACD_id290917"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id253676"></a>There are two types of call centers:<a id="I_indexterm13_d1e26362" class="indexterm"></a> inbound and outbound. ACD refers to the technology that
      handles inbound call centers, whereas the term Predictive Dialer refers
      to the technology that handles outbound call centers. In this book we
      will primarily focus on inbound calling.</p></div><p><a id="ACD_id285576"></a>We’ve all been frustrated by poorly designed and
  managed queues: enduring hold music from a radio that isn’t in tune,
  mind-numbing wait times, and pointless messages that tell you every 20
  seconds how important your call is, despite that fact that you’ve been
  waiting for 30 minutes and have heard the message so many times you can
  quote it from memory. From a customer service perspective, queue design may
  be one of the most important aspects of your telephone system. As with an
  automated attendant, what must be kept in mind above all else is that
  <span class="emphasis"><em>your callers are not interested in holding in a
  queue</em></span><a id="I_indexterm13_d1e26370" class="indexterm"></a>. They called because <span class="emphasis"><em>they want to talk to
  you</em></span>. All your design decisions must keep this crucial fact
  front-and-center in your mind: people want to talk to other people; not to
  your phone system.<sup>[<a id="id580459" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id580459" class="footnote">127</a>]</sup></p><p><a id="ACD_id290960"></a>The purpose of this chapter is to teach you how to
  create and design queues that get callers to their intended destinations as
  quickly and painlessly as possible.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id36001115"></a>In this chapter, we may flip back and forth
    between the usage of the terms <span class="emphasis"><em>queue
    members</em></span><a id="I_indexterm13_d1e26392" class="indexterm"></a> and <span class="emphasis"><em>agents</em></span><a id="I_indexterm13_d1e26398" class="indexterm"></a>. Unless we are talking about agents logged in via <code class="literal">chan_agent</code> (using <code class="literal">AgentLogin()</code>), we’re almost certainly talking
    about queue members as added via <code class="literal">AddQueueMember()</code> or the CLI commands (which
    we’ll discuss in this chapter). Just know that there is a difference in
    Asterisk between an <span class="emphasis"><em>agent</em></span> and a <span class="emphasis"><em>queue
    member</em></span>, but that we’ll use the term <span class="emphasis"><em>agent</em></span>
    loosely to simply describe an endpoint as called by a <code class="literal">Queue()</code>.</p></div><div class="sect1" title="Creating a Simple ACD Queue"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id285928"></a>Creating a Simple ACD Queue</h2></div></div></div><p><a id="ACD_id283941"></a><a id="index-120P146EF3M" class="indexterm"></a>To start with, we’re going to create a simple ACD queue. It
    will accept callers and attempt to deliver them to a member of the
    queue.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id290921"></a>In Asterisk, the term
      <span class="emphasis"><em>member</em></span> refers to a peer assigned to a queue that
      can be dialed, such as <code class="literal">SIP/0000FFFF0001</code>. An
      <span class="emphasis"><em>agent</em></span> technically refers to the Agent channel also
      used for dialing endpoints. Unfortunately, the Agent channel is a
      deprecated technology in Asterisk, as it is limited in flexibility and
      can cause unexpected issues that can be hard to diagnose and resolve. We
      will not be covering the use of <code class="literal">chan_agent</code>, so be aware that we will generally
      use the term <span class="emphasis"><em>member</em></span> to refer to the telephone
      device and <span class="emphasis"><em>agent</em></span> to refer to the person who handles
      the call. Since one isn’t generally effective without the other, either
      term may refer to both.</p></div><p><a id="ACD_id251507"></a>We’ll create the queue(s) in the <code class="filename">queues.conf</code><a id="I_indexterm13_d1e26460" class="indexterm"></a> file, and manually add queue members to it through the
    Asterisk console. In the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289508" title="Queue Members">the section called “Queue Members”</a>, we’ll
    look into how to create a dialplan that allows us to dynamically add and
    remove queue members (as well as pause and unpause them).</p><p><a id="ACD_id259086"></a>The first step is to create your <code class="filename">queues.conf</code> file in the <code class="filename">/etc/asterisk</code> configuration directory:</p><a id="ACD_id262635"></a><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>cd /etc/asterisk/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>touch queues.conf</code></strong></pre><p><a id="ACD_id270124"></a>Populate it with the following configuration,
    which will create two queues named <code class="literal">[sales]</code> and <code class="literal">[support]</code>. You can name them anything you want,
    but we will be using these names later in the book, so if you use
    different queue names from what we’ve recommended here, make note of your
    choices for future reference:</p><a id="ACD_id270135"></a><pre class="programlisting">[general]
autofill=yes             ; distribute all waiting callers to available members
shared_lastcall=yes      ; respect the wrapup time for members logged into more 
                         ; than one queue

[StandardQueue](!)       ; template to provide common features
musicclass=default       ; play [default] music
strategy=rrmemory        ; use the Round Robin Memory strategy
joinempty=no             ; do not join the queue when no members available
leavewhenempty=yes       ; leave the queue when no members available
ringinuse=no             ; don't ring members when already InUse (prevents 
                         ; multiple calls to an agent)

[sales](StandardQueue)   ; create the sales queue using the parameters in the
                         ; StandardQueue template

[support](StandardQueue) ; create the support queue using the parameters in the
                         ; StandardQueue template</pre><p><a id="ACD_id270145"></a>The <code class="literal">[general]</code>
    section defines the default behavior and global options. We’ve only
    specified two options in the <code class="literal">[general]</code>
    section, since the built-in defaults are sufficient for our needs at this
    point.</p><p><a id="ACD_id270156"></a>The first option is
    <code class="option">autofill</code><a id="I_indexterm13_d1e26508" class="indexterm"></a>, which tells the queue to distribute all waiting callers to
    all available members immediately. Previous versions of Asterisk would
    only distribute one caller at a time, which meant that while Asterisk was
    signaling an agent, all other calls were held (even if other agents were
    available) until the first caller in line had been connected to an agent
    (which obviously led to bottlenecks in older versions of Asterisk where
    large, busy queues were being used). Unless you have a particular need for
    backward-compatibility, <span class="emphasis"><em>this option should always be set to
    <code class="literal">yes</code></em></span>.</p><p><a id="ACD_id265364"></a>The second option in the <code class="literal">[general]</code> section of <code class="filename">queues.conf</code> is
    <code class="option">shared_lastcall</code><a id="I_indexterm13_d1e26527" class="indexterm"></a>. When we enable <code class="option">shared_lastcall</code>, the last
    call to an agent who is logged into multiple queues will be the call that
    is counted for wrapup time<sup>[<a id="id580871" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id580871" class="footnote">128</a>]</sup> in order to avoid sending a call to an agent from another
    queue during the wrap period. If this option is set to <code class="literal">no</code>, the wrap timer will only apply to the queue
    the last call came from, which means an agent who was wrapping up a call
    from the support queue might still get a call from the sales queue. This
    option should also always be set to <code class="literal">yes</code>
    (the default).</p><p><a id="ACD_id265393"></a>The next section, <code class="literal">[StandardQueue]</code> is the template we’ll apply to
    our sales and support queues (we declared it a template by adding <code class="literal">(!)</code>). We’ve defined the
    <code class="option">musicclass</code><a id="I_indexterm13_d1e26556" class="indexterm"></a> to be the <code class="literal">default</code> music
    on hold, as configured in the <code class="filename">musiconhold.conf</code> file. The
    <code class="option">strategy</code><a id="I_indexterm13_d1e26569" class="indexterm"></a> we’ll employ is <code class="literal">rrmemory</code>, which stands for Round-Robin with
    Memory. The <code class="literal">rrmemory</code> strategy works by
    rotating through the agents in the queue in sequential order, keeping
    track of which agent got the last call, and presenting the next call to
    the next agent. When it gets to the last agent, it goes back to the top
    (as agents log in, they are added to the end of the list). We’ve set
    <code class="option">joinempty</code><a id="I_indexterm13_d1e26581" class="indexterm"></a> to <code class="literal">no</code> since it is
    generally bad form to put callers into a queue where there are no agents
    available to take their calls.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id288254"></a>You could set this to <code class="literal">yes</code> for ease of testing, but we would not
      recommend putting it into production unless you are using the queue for
      some function that is not about getting your callers to your agents.
      Nobody wants to wait in a line that is not going anywhere.</p></div><p><a id="ACD_id288264"></a>The <code class="option">leavewhenempty</code><a id="I_indexterm13_d1e26598" class="indexterm"></a> option is used to control whether callers should fall out
    of the <code class="literal">Queue()</code> application and continue
    on in the dialplan if no members are available to take their calls. We’ve
    set this to <code class="literal">yes</code> because it makes no
    sense to wait in a line that’s not going anywhere.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id288280"></a>From a business perspective, you should be
      telling your agents to clear all calls out of the queue before logging
      off for the day. If you find that there are a lot of calls queued up at
      the end of the day, you might want to consider extending someone’s shift
      to deal with them. Otherwise, they’ll just add to your stress when they
      call back the next day, in a worse mood.</p><p><a id="ACD_id324873"></a>The alternative is to use <code class="literal">GotoIfTime()</code> near the end of the day to
      redirect callers to voicemail, or some other appropriate location in
      your dialplan.</p></div><p><a id="ACD_id288288"></a>Finally, we’ve set
    <code class="option">ringinuse</code><a id="I_indexterm13_d1e26620" class="indexterm"></a> to <code class="literal">no</code>, which tells
    Asterisk not to ring members when their devices are already ringing. The
    purpose of setting <code class="option">ringinuse</code> to <code class="literal">no</code> is to avoid multiple calls to the same member
    from one or more queues.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id265002"></a>It should be mentioned that
      <code class="option">joinempty</code> and <code class="option">leavewhenempty</code> are
      looking for either no members logged into the queue, or all members
      unavailable. Agents that are <code class="literal">Ringing</code>
      or <code class="literal">InUse</code> are not considered
      unavailable, so will not block callers from joining the queue or cause
      them to be kicked out when <code class="literal"><code class="option">joinempty</code>=no</code> and/or <code class="literal"><code class="option">leavewhenempty</code>=yes</code>.</p></div><p><a id="ACD_id265026"></a>Once you’ve finished configuring your <code class="filename">queues.conf</code> file, you can save it and reload
    the <code class="filename">app_queue.so</code> module from your
    Asterisk CLI:</p><a id="ACD_id265031"></a><pre class="screen">$ <strong class="userinput"><code>asterisk -r</code></strong>
*CLI&gt; <strong class="userinput"><code>module reload app_queue.so</code></strong>
   -- Reloading module 'app_queue.so' (True Call Queueing)</pre><p><a id="ACD_id265041"></a>Then verify that your queues were loaded into
    memory:</p><a id="ACD_id265044"></a><pre class="screen">localhost*CLI&gt; <strong class="userinput"><code>queue show</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   No Members
   No Callers

sales        has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   No Members
   No Callers</pre><p><a id="ACD_id265054"></a>Now that you’ve created the queues, you need to
    configure your dialplan to allow calls to enter the queue.</p><p><a id="ACD_id265058"></a>Add the following dialplan logic to the <code class="filename">extensions.conf</code> file:</p><a id="ACD_id265064"></a><pre class="programlisting">[Queues]
exten =&gt; 7001,1,Verbose(2,${CALLERID(all)} entering the support queue)
same =&gt; n,Queue(support)
same =&gt; n,Hangup()

exten =&gt; 7002,1,Verbose(2,${CALLERID(all)} entering the sales queue)
same =&gt; n,Queue(sales)
same =&gt; n,Hangup()

[LocalSets]
include =&gt; Queues      ; allow phones to call queues</pre><p><a id="ACD_id265072"></a>We’ve included the <code class="literal">Queues</code> context in the <code class="literal">LocalSets</code> context so that our telephones can
    call the queues we’ve set up. In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a>, we’ll
    define menu items that go to these queues. Save the changes to your
    <code class="filename">extensidons.conf</code> file, and reload the
    dialplan with the <span class="command"><strong>dialplan reload</strong></span> CLI
    command.<a id="I_indexterm13_d1e26709" class="indexterm"></a><a id="I_indexterm13_d1e26714" class="indexterm"></a></p><p>If you dial extension <code class="literal">7001</code> or
    <code class="literal">7002</code> at this point, you will end up
    with output like the following:</p><a id="ACD_id289493"></a><pre class="screen"> -- Executing [7001@LocalSets:1] Verbose("SIP/0000FFFF0003-00000001", 
    "2,"Leif Madsen" &lt;100&gt; entering the support queue") in new stack
== "Leif Madsen" &lt;1--&gt; entering the support queue
 -- Executing [7001@LocalSets:2] Queue("SIP/0000FFFF0003-00000001", 
    "support") in new stack
    [2011-02-14 08:59:39] WARNING[13981]: app_queue.c:5738 queue_exec: 
    Unable to join queue 'support'
 -- Executing [7001@LocalSets:3]
    Hangup("SIP/0000FFFF0003-00000001", "") in new stack
 == Spawn extension (LocalSets, 7001, 3) exited non-zero on 
    'SIP/0000FFFF0003-00000001'</pre><p>You don’t join the queue at this point, as there are no agents in
    the queue to answer calls. Because we have <code class="literal">joinempty=no</code> and <code class="literal">leavewhenempty=yes</code> configured in
    <span class="emphasis"><em>queues.conf</em></span>, callers will not be placed into the
    queue. (This would be a good opportunity to experiment with the <code class="literal">joinempty</code> and <code class="literal">leavewhenempty</code> options in <code class="filename">queues.conf</code> to better understand their impact
    on queues.)</p><p><a id="ACD_id289502"></a>In the next section, we’ll demonstrate how to add
    members to your queue (as well as other member interactions with the
    queue, such as pause/unpause).<a id="I_indexterm13_d1e26750" class="indexterm"></a></p></div><div class="sect1" title="Queue Members"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id289508"></a>Queue Members</h2></div></div></div><p><a id="ACD_id289513"></a><a id="index-405R044KH2K" class="indexterm"></a>Queues aren’t very useful without someone to answer the
    calls that come into them, so we need a method for allowing agents to be
    logged into the queues to answer calls. There are various ways of going
    about this, and we’ll show you how to add members to the queue both
    manually (as an administrator) and dynamically (as the agent). We’ll start
    with the Asterisk CLI method, which allows you to easily add members to
    the queue for testing and minimal dialplan changes. We’ll then expand upon
    that, showing you how to add dialplan logic allowing agents to log
    themselves into and out of the queues and to pause and unpause themselves
    in queues they are logged into.</p><div class="sect2" title="Controlling Queue Members via the CLI"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id289522"></a>Controlling Queue Members via the CLI</h3></div></div></div><p><a id="ACD_id289528"></a><a id="I_indexterm13_d1e26765" class="indexterm"></a><a id="I_indexterm13_d1e26768" class="indexterm"></a>We can add queue members to any available queue through
      the Asterisk CLI command <span class="emphasis"><em>queue add</em></span>. The format of
      the <span class="command"><strong>queue add</strong></span> command <a id="I_indexterm13_d1e26778" class="indexterm"></a><a id="I_indexterm13_d1e26781" class="indexterm"></a>is (all on one line):</p><p><a id="ACD_id289535"></a><a id="ACD_id289536"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue add member &lt;<em class="replaceable"><code>channel</code></em>&gt; to &lt;<em class="replaceable"><code>queue</code></em>&gt; [[[penalty &lt;<em class="replaceable"><code>penalty</code></em>&gt;] as 
&lt;<em class="replaceable"><code>membername</code></em>&gt;] state_interface &lt;<em class="replaceable"><code>interface</code></em>&gt;]</code></strong></pre><p><a id="ACD_id289541"></a>The <span class="emphasis"><em>&lt;channel&gt;</em></span> is the
      channel we want to add to the queue, such as <code class="literal">SIP/0000FFFF0003</code>, and the
      <span class="emphasis"><em>&lt;queue&gt;</em></span> name will be something like <code class="literal">support</code> or <code class="literal">sales</code>—any queue name that exists in <code class="filename">/etc/asterisk/queues.conf</code>. For now we’ll
      ignore the <span class="keep-together">&lt;penalty&gt;</span>
      option, but we’ll discuss it in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288932" title="Advanced Queues">the section called “Advanced Queues”</a> (penalty
      is used to control the rank of a member within a queue, which can be
      important for agents who are logged into multiple queues). We can define
      the <span class="emphasis"><em>&lt;membername&gt;</em></span> to provide details to the
      queue-logging engine. The <code class="literal">state_interface</code> option is something that we
      should delve a bit more into at this junction. Because it is so
      important for all aspects of queues and their members in Asterisk, we’ve
      written a little section about it, so go ahead and read <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726" title="An Introduction to Device State">the section called “An Introduction to Device State”</a>. Once you’ve set that up, come back here and
      continue on. Don’t worry, we’ll wait.</p><p><a id="ACD_id252894"></a>Now that you’ve added <code class="literal">callcounter=yes</code> to <code class="filename">sip.conf</code> (we’ll be using SIP channels
      throughout the rest of our examples), let’s see how to add members to
      our queues from the Asterisk CLI.</p><p><a id="ACD_id252905"></a>Adding a queue member to the <code class="literal">support</code> queue can be done with the <span class="command"><strong>queue add member</strong></span> command:<a id="I_indexterm13_d1e26858" class="indexterm"></a><a id="I_indexterm13_d1e26863" class="indexterm"></a></p><a id="ACD_id252911"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue add member SIP/0000FFFF0001 to support</code></strong>
Added interface 'SIP/0000FFFF0001' to queue 'support'</pre><p><a id="ACD_id252918"></a>A query of the queue will verify that our new
      member has been added:</p><a id="ACD_id252921"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (Not in use) has taken no calls yet
   No Callers</pre><p><a id="ACD_id252930"></a>To remove a queue member, you would use the
      <span class="command"><strong>queue remove member</strong></span>
      command:<a id="I_indexterm13_d1e26883" class="indexterm"></a><a id="I_indexterm13_d1e26888" class="indexterm"></a></p><p><a id="ACD_id252937"></a><a id="ACD_id252938"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue remove member SIP/0000FFFF0001 from support </code></strong>
Removed interface 'SIP/0000FFFF0001' from queue 'support'</pre><p>Of course,
      you can use the <span class="command"><strong>queue show</strong></span> command
      again to verify that your member has been removed from the queue.</p><p><a id="ACD_id252950"></a>We can also pause and unpause members in a queue
      from the Asterisk console, with the <span class="command"><strong>queue pause
      member</strong></span><a id="I_indexterm13_d1e26906" class="indexterm"></a><a id="I_indexterm13_d1e26909" class="indexterm"></a> and <span class="command"><strong>queue unpause
      member</strong></span> commands<a id="I_indexterm13_d1e26918" class="indexterm"></a><a id="I_indexterm13_d1e26921" class="indexterm"></a>. They take a similar format to the previous commands
      we’ve been using:</p><a id="ACD_id252961"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue pause member SIP/0000FFFF0001 queue support reason DoingCallbacks</code></strong>
paused interface 'SIP/0000FFFF0001' in queue 'support' for reason 'DoingCallBacks'

*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (paused) (Not in use) has taken no calls yet
   No Callers</pre><p><a id="ACD_id252975"></a>By adding a reason for pausing the queue member,
      such as <code class="literal">lunchtime</code>, you ensure that
      your queue logs will contain some additional information that may be
      useful. Here’s how to unpause the member:</p><a id="ACD_id252980"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue unpause member SIP/0000FFFF0001 queue support reason off-break</code></strong>
unpaused interface 'SIP/0000FFFF0001' in queue 'support' for reason 'off-break'

*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (Not in use) has taken no calls yet
   No Callers</pre><p><a id="ACD_id252994"></a>In a production environment, the CLI would not
      normally be the best way to control the state of agents in a queue.
      Instead, there are dialplan applications that allow agents to inform the
      queue as to their availability.</p></div><div class="sect2" title="Controlling Queue Members with Dialplan Logic"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id253000"></a>Controlling Queue Members with Dialplan Logic</h3></div></div></div><p><a id="ACD_id253005"></a><a id="I_indexterm13_d1e26954" class="indexterm"></a>In a call center staffed by live agents, it is most common
      to have the agents themselves log in and log out at the start and end of
      their shifts (or whenever they go for lunch, or to the bathroom, or are
      otherwise not available to the queue).</p><p>To enable this, we will make use of the following dialplan
      applications:<a id="I_indexterm13_d1e26962" class="indexterm"></a><a id="I_indexterm13_d1e26967" class="indexterm"></a><a id="I_indexterm13_d1e26970" class="indexterm"></a><a id="I_indexterm13_d1e26975" class="indexterm"></a></p><div class="itemizedlist"><a id="ACD_id288492"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id288495"></a><a id="ACD_id288497"></a><span class="application"> <code class="literal">AddQueueMember()</code> </span></p></li><li class="listitem"><p><a id="ACD_id288502"></a><a id="ACD_id288504"></a><span class="application"> <code class="literal">RemoveQueueMember()</code> </span></p></li></ul></div><p><a id="ACD_id288511"></a>While logged into a queue, it may be that an
      agent needs to put herself into a state where she is temporarily
      unavailable to take calls. The following applications will allow
      this:<a id="I_indexterm13_d1e26991" class="indexterm"></a><a id="I_indexterm13_d1e26996" class="indexterm"></a><a id="I_indexterm13_d1e26999" class="indexterm"></a><a id="I_indexterm13_d1e27004" class="indexterm"></a></p><div class="itemizedlist"><a id="ACD_id288516"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id288518"></a><a id="ACD_id288520"></a><span class="application"> <code class="literal">PauseQueueMember()</code> </span></p></li><li class="listitem"><p><a id="ACD_id288526"></a><a id="ACD_id288528"></a><span class="application"> <code class="literal">UnpauseQueueMember()</code> </span></p></li></ul></div><p><a id="ACD_id288534"></a>It may be easier to think of these applications
      in the following manner: the add and remove applications are used to log
      in and log out, and the pause/unpause pair are used for short periods of
      agent unavailability. The difference is simply that pause/unpause set
      the member as unavailable/available without actually removing them from
      the queue. This is mostly useful for reporting purposes (if a member is
      paused, the queue supervisor can see that she is logged into the queue,
      but simply not available to take calls at that moment). If you’re not
      sure which one to use, we recommend that the agents use add/remove
      whenever they are not going to be available to take calls.</p><div class="sidebar" title="Using Pause and Unpause"><a id="ACD_id288544"></a><div class="titlepage"><div><div><p class="title"><strong>Using Pause and Unpause</strong></p></div></div></div><p><a id="ACD_id288550"></a>The use of pause and unpause is a matter of
        preference. In some environments, these options may be used for all
        activities during the day that render an agent unavailable (such as
        during the lunch hour and when performing work that is not
        queue-related). In most call centers, however, if an agent is not
        beside his phone and ready to take a call at that moment, he should
        not be logged in at all, even if he is only going to be away from his
        desk for a few minutes (such as for a bathroom break).</p><p><a id="ACD_id288557"></a>Some supervisors like to use the add/remove
        and pause/unpause settings as a sort of punch clock, so that they can
        track when their staff arrive for work and leave at the end of the
        day, and how long they spend at their desks and on breaks. We do not
        feel this is a sound practice, as the purpose of these applications is
        to inform the queue as to agent availability, not to enable tracking
        of employees’ activities.</p><p><a id="ACD_id288565"></a>An important thing to note here relates to the
        <code class="literal">joinempty</code> setting in <code class="filename">queues.conf</code>, which was discussed earlier.
        If an agent is paused, he is considered as logged into the queue.
        Let’s say it is near the end of the day, and one agent put himself
        into pause a few hours earlier to work on a project. All the other
        agents have logged out and gone home. A call comes in. The queue will
        note that an agent is logged into the queue, and will therefore queue
        the call, even though the reality is that there are no people actually
        staffing that queue at that time. This caller may end up holding in an
        unstaffed queue indefinitely.</p><p><a id="ACD_id288580"></a>In short, agents who are not sitting at their
        desks and planning to be available to take calls in the next few
        minutes should log out. Pause/unpause should only be used for brief
        moments of unavailability (if at all). If you want to use your phone
        system as a punch clock, there are lots of great ways to do that in
        Asterisk, but the queue member applications are not the way we would
        recommend.</p></div><p><a id="ACD_id288592"></a>Let’s build some simple dialplan logic that will
      allow our agents to indicate their availability to the queue. We are
      going to use the <code class="literal">CUT()</code> dialplan
      function to extract the name of our channel from our call to the system,
      so that the queue will know which channel to log into the queue.</p><p><a id="ACD_id288598"></a>We have built this dialplan to show a simple
      process for logging into and out of a queue, and changing the paused
      status of a member in a queue. We are doing this only for a single queue
      that we previously defined in the <code class="filename">queues.conf</code> file. The status channel
      variables that the <code class="literal">AddQueueMember()</code>,
      <code class="literal">RemoveQueueMember()</code>, <code class="literal">PauseQueueMember()</code>, and <code class="literal">Unpause</code><code class="literal">Queue</code><code class="literal">Member()</code> applications set
      might be used to <code class="literal">Playback()</code>
      announcements to the queue members after they’ve performed certain
      functions to let them know whether they have successfully logged in/out
      or paused/unpaused):</p><p><a id="ACD_id288604"></a><a id="ACD_id288605"></a></p><pre class="programlisting">[QueueMemberFunctions]

exten =&gt; *54,1,Verbose(2,Logging In Queue Member)
   same =&gt; n,Set(MemberChannel=${CHANNEL(channeltype)}/${CHANNEL(peername)})
   same =&gt; n,AddQueueMember(support,${MemberChannel})

; ${AQMSTATUS}
;   ADDED
;   MEMBERALREADY
;   NOSUCHQUEUE

exten =&gt; *56,1,Verbose(2,Logging Out Queue Member)
   same =&gt; n,Set(MemberChannel=${CHANNEL(channeltype)}/${CHANNEL(peername)})
   same =&gt; n,RemoveQueueMember(support,${MemberChannel})

; ${RQMSTATUS}:
;    REMOVED
;    NOTINQUEUE
;    NOSUCHQUEUE

exten =&gt; *72,1,Verbose(2,Pause Queue Member)
   same =&gt; n,Set(MemberChannel=${CHANNEL(channeltype)}/${CHANNEL(peername)})
   same =&gt; n,PauseQueueMember(support,${MemberChannel})

; ${PQMSTATUS}:
;     PAUSED
;     NOTFOUND

exten =&gt; *87,1,Verbose(2,Unpause Queue Member)
   same =&gt; n,Set(MemberChannel=${CHANNEL(channeltype)}/${CHANNEL(peername)})
   same =&gt; n,UnpauseQueueMember(support,${MemberChannel})

; ${UPQMSTATUS}:
;     UNPAUSED
;     NOTFOUND</pre></div><div class="sect2" title="Automatically Logging Into and Out of Multiple Queues"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288626"></a>Automatically Logging Into and Out of Multiple Queues</h3></div></div></div><p><a id="ACD_id288631"></a><a id="index-057G665QO5T" class="indexterm"></a>It is quite common for an agent to be a member of more
      than one queue. Rather than having a separate extension for logging into
      each queue (or demanding information from the agents about which queues
      they want to log into), this code uses the Asterisk database (<code class="literal">astdb</code>) to store queue membership information
      for each agent, and then loops through each queue the agents are a
      member of, logging them into each one in turn.</p><p><a id="ACD_id288642"></a>In order to for this code to work, an entry
      similar to the following will need to be added to the AstDB via the
      Asterisk CLI. For example, the following would store the member <code class="literal">0000FFFF0001</code> as being in both the <code class="literal">support</code> and <code class="literal">sales</code> queues:</p><a id="ACD_id288647"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>database put queue_agent 0000FFFF0001/available_queues support^sales</code></strong></pre><p><a id="ACD_id288653"></a>You will need to do this once for each agent,
      regardless of how many queues they are members of.</p><p><a id="ACD_id288657"></a>If you then query the Asterisk database, you
      should get a result similar to the following:</p><a id="ACD_id288660"></a><pre class="screen">pbx*CLI&gt; <strong class="userinput"><code>database show queue_agent</code></strong>
/queue_agent/0000FFFF0001/available_queues        : support^sales</pre><p><a id="ACD_id288667"></a>The following dialplan code is an example of how
      to allow this queue member to be automatically added to both the
      <code class="literal">support</code> and <code class="literal">sales</code> queues. We’ve defined a subroutine that
      is used to set up three channel variables (<code class="literal">MemberChannel</code>, <code class="literal">MemberChanType</code>, <code class="literal">AvailableQueues</code>). These channel variables
      are then used by the login (<code class="literal">*54</code>),
      logout (<code class="literal">*56</code>), pause (<code class="literal">*72</code>), and unpause (<code class="literal">*87</code>) extensions. Each of the extensions uses
      the <code class="literal">subSetup</code><code class="literal">Available</code><code class="literal">Queues</code> subroutine to set these channel
      variables and to verify that the AstDB contains a list of one or more
      queues for the device the queue member is calling from:</p><a id="ACD_id288672"></a><pre class="programlisting">[subSetupAvailableQueues]
;
; This subroutine is used by the various login/logout/pausing/unpausing routines
; in the [ACD] context. The purpose of the subroutine is centralize the retrieval 
; of information easier.
;
exten =&gt; start,1,Verbose(2,Checking for available queues)

; Get the current channel's peer name (0000FFFF0001)
   same =&gt; n,Set(MemberChannel=${CHANNEL(peername)})

; Get the current channel's technology type (SIP, IAX, etc)
   same =&gt; n,Set(MemberChanType=${CHANNEL(channeltype)})    

; Get the list of queues available for this agent
   same =&gt; n,Set(AvailableQueues=${DB(queue_agent/${MemberChannel}/
   available_queues)})
; *** This should all be on a single line

; if there are no queues assigned to this agent we'll handle it in the 
; no_queues_available extension
   same =&gt; n,GotoIf($[${ISNULL(${AvailableQueues})}]?no_queues_available,1) 
                                                                            
   same =&gt; n,Return()

exten =&gt; no_queues_available,1,Verbose(2,No queues available for agent 
   ${MemberChannel})
; *** This should all be on a single line

; playback a message stating the channel has not yet been assigned
   same =&gt; n,Playback(silence/1&amp;channel&amp;not-yet-assigned)  
   same =&gt; n,Hangup()

[ACD]
;
; Used for logging agents into all configured queues per the AstDB
;
;
; Logging into multiple queues via the AstDB system
exten =&gt; *54,1,Verbose(2,Logging into multiple queues per the database values)

; get the available queues for this channel
   same =&gt; n,GoSub(subSetupAvailableQueues,start,1())  
   same =&gt; n,Set(QueueCounter=1)  ; setup a counter variable

; using CUT(), get the first listed queue returned from the AstDB
   same =&gt; n,Set(WorkingQueue=${CUT(AvailableQueues,^,${QueueCounter})})

; While the WorkingQueue channel variable contains a value, loop
   same =&gt; n,While($[${EXISTS(${WorkingQueue})}])

; AddQueueMember(queuename[,interface[,penalty[,options[,membername
;  [,stateinterface]]]]])
; Add the channel to a queue, setting the interface for calling 
; and the interface for monitoring of device state
;
; *** This should all be on a single line
   same =&gt; n,AddQueueMember(${WorkingQueue},${MemberChanType}/
${MemberChannel},,,${MemberChanType}/${MemberChannel})


   same =&gt; n,Set(QueueCounter=$[${QueueCounter} + 1])    ; increase our counter

; get the next available queue; if it is null our loop will end
   same =&gt; n,Set(WorkingQueue=${CUT(AvailableQueues,^,${QueueCounter})})

   same =&gt; n,EndWhile()

; let the agent know they were logged in okay
   same =&gt; n,Playback(silence/1&amp;agent-loginok)
   same =&gt; n,Hangup()

exten =&gt; no_queues_available,1,Verbose(2,No queues available for ${MemberChannel})
   same =&gt; n,Playback(silence/1&amp;channel&amp;not-yet-assigned)
   same =&gt; n,Hangup()

; -------------------------

; Used for logging agents out of all configured queues per the AstDB
exten =&gt; *56,1,Verbose(2,Logging out of multiple queues)

; Because we reused some code, we've placed the duplicate code into a subroutine
   same =&gt; n,GoSub(subSetupAvailableQueues,start,1())   
   same =&gt; n,Set(QueueCounter=1)
   same =&gt; n,Set(WorkingQueue=${CUT(AvailableQueues,^,${QueueCounter})})
   same =&gt; n,While($[${EXISTS(${WorkingQueue})}])
   same =&gt; n,RemoveQueueMember(${WorkingQueue},${MemberChanType}/${MemberChannel})
   same =&gt; n,Set(QueueCounter=$[${QueueCounter} + 1])
   same =&gt; n,Set(WorkingQueue=${CUT(AvailableQueues,^,${QueueCounter})})
   same =&gt; n,EndWhile()
   same =&gt; n,Playback(silence/1&amp;agent-loggedoff)
   same =&gt; n,Hangup()

; -------------------------

; Used for pausing agents in all available queues
exten =&gt; *72,1,Verbose(2,Pausing member in all queues)
   same =&gt; n,GoSub(subSetupAvailableQueues,start,1())

   ; if we don't define a queue, the member is paused in all queues
   same =&gt; n,PauseQueueMember(,${MemberChanType}/${MemberChannel})
   same =&gt; n,GotoIf($[${PQMSTATUS} = PAUSED]?agent_paused,1:agent_not_found,1)

exten =&gt; agent_paused,1,Verbose(2,Agent paused successfully)
   same =&gt; n,Playback(silence/1&amp;unavailable)
   same =&gt; n,Hangup()

; -------------------------

; Used for unpausing agents in all available queues
exten =&gt; *87,1,Verbose(2,UnPausing member in all queues)
   same =&gt; n,GoSub(subSetupAvailableQueues,start,1())

   ; if we don't define a queue, then the member is unpaused from all queues
   same =&gt; n,UnPauseQueueMember(,${MemberChanType}/${MemberChannel})
   same =&gt; n,GotoIf($[${UPQMSTATUS} = UNPAUSED]?agent_unpaused,1:agent_not_found,1)

exten =&gt; agent_unpaused,1,Verbose(2,Agent paused successfully)
   same =&gt; n,Playback(silence/1&amp;available)
   same =&gt; n,Hangup()

; -------------------------

; Used by both pausing and unpausing dialplan functionality
exten =&gt; agent_not_found,1,Verbose(2,Agent was not found)
   same =&gt; n,Playback(silence/1&amp;cannot-complete-as-dialed)</pre><p><a id="ACD_id288723"></a>You could further refine these login and logout
      routines to take into account that the <code class="literal">AQMSTATUS</code> and <code class="literal">RQMSTATUS</code> channel variables are set each time
      <code class="literal">AddQueueMember()</code> and <code class="literal">RemoveQueueMember()</code> are used. For example, you
      could set a flag that lets the queue member know he has not been added
      to a queue by setting a flag, or even add recordings or text-to-speech
      systems to play back the particular queue that is producing the problem.
      Or, if you’re monitoring this via the Asterisk Manager Interface, you
      could have a screen pop, or use <code class="literal">JabberSend()</code> to inform the queue member via
      instant messaging. (Sorry, sometimes our brains run away with
      us.)<a id="I_indexterm13_d1e27164" class="indexterm"></a></p></div><div class="sect2" title="An Introduction to Device State"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288726"></a>An Introduction to Device State</h3></div></div></div><p><a id="ACD_id288732"></a><a id="I_indexterm13_d1e27169" class="indexterm"></a><a id="I_indexterm13_d1e27172" class="indexterm"></a>Device states in Asterisk are used to inform various
      applications as to whether your device is currently in use or not. This
      is especially important for queues, as we don’t want to send callers to
      an agent who is already on the phone. Device states are controlled by
      the channel module, and in Asterisk only <code class="literal">chan_sip</code> has the appropriate handling. When
      the queue asks for the state of a device, it first queries the channel
      driver (e.g., <code class="literal">chan_sip</code>). If the
      channel cannot provide the device state directly (as is the case with
      <code class="literal">chan_iax2</code>), it asks the Asterisk core
      to determine it, which it does by searching through channels currently
      in progress.</p><p><a id="ACD_id421466"></a>Unfortunately, simply asking the core to search
      through active channels isn’t accurate, so getting device state from
      channels other than <code class="literal">chan_sip</code> is less
      reliable when working with queues. We’ll explore some methods of
      controlling calls to other channel types in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288932" title="Advanced Queues">the section called “Advanced Queues”</a>, but for now we’ll focus on SIP channels,
      which do not have complex device state requirements. For more
      information about device states, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates" title="Chapter 14. Device States">Chapter&nbsp;14, <em>Device States</em></a>.</p><p><a id="ACD_id288755"></a>In order to correctly determine the state of a
      device in Asterisk, we need to enable call counters in <code class="filename">sip.conf</code>. By enabling call counters, we’re
      telling Asterisk to track the active calls for a device so that this
      information can be reported back to the channel module and the state can
      be accurately reflected in our queues. First, let’s see what happens to
      our queue without the <code class="option">callcounter</code> option:<a id="I_indexterm13_d1e27204" class="indexterm"></a></p><a id="ACD_id288768"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (Not in use) has taken no calls yet
   No Callers</pre><p><a id="ACD_id288777"></a>Now suppose we have an extension in our
      dialplan, <code class="literal">555</code>, that calls
      <span class="application"><code class="literal">MusicOnHold()</code></span>. If we dial that
      extension without having enabled call counters, a query of the <code class="literal">support</code> queue (of which <code class="literal">SIP/0000FFFF0001</code> is a member) from the
      Asterisk CLI will show something similar to the following:</p><a id="ACD_id288792"></a><pre class="screen">    -- Executing [555@LocalSets:1] MusicOnHold("SIP/0000FFFF0001-00000000", 
       "") in new stack
    -- Started music on hold, class 'default', on SIP/0000FFFF0001-00000000

*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (<strong class="userinput"><code>Not in use</code></strong>) has taken no calls yet
   No Callers</pre><p><a id="ACD_id288807"></a>Notice that even though our phone should be
      marked as <code class="literal">In Use</code> because it is on a
      call, it does not show up that way when we look at the queue status.
      This is obviously a problem since the queue will consider this device as
      available, even though it is already on a call.</p><p><a id="ACD_id288816"></a>To correct this problem, we need to add <code class="literal">callcounter=yes</code> to the <code class="literal">[general]</code> section of our <code class="filename">sip.conf</code> file. We can also specifically
      configure this for any peer (since it is a peer-level configuration
      option); however, this is really something you’ll want to set for all
      peers that might ever be part of a queue, so it’s normally going to be
      best to put this option in the <code class="literal">[general]</code> section (it could also be assigned
      to a template that would be used with all peers in the queue).</p><p><a id="ACD_id288836"></a>Edit your <code class="filename">sip.conf</code> file so it looks similar to the
      following:</p><a id="ACD_id288842"></a><pre class="programlisting">[general]
context=unauthenticated         ; default context for incoming calls
allowguest=no                   ; disable unauthenticated calls
srvlookup=yes                   ; enabled DNS SRV record lookup on outbound calls
udpbindaddr=0.0.0.0             ; listen for UDP request on all interfaces
tcpenable=no                    ; disable TCP support
<strong class="userinput"><code>callcounter=yes                 ; enable device states for SIP devices</code></strong></pre><p><a id="ACD_id288851"></a>Then reload the <code class="literal">chan_sip</code> module and perform the same test
      again:</p><a id="ACD_id288858"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>sip reload</code></strong>
 Reloading SIP 
  == Parsing '/etc/asterisk/sip.conf':   == Found</pre><p><a id="ACD_id288865"></a>The device should now show <code class="literal">In use</code> when a call is in progress from that
      device:</p><a id="ACD_id288872"></a><pre class="screen">  == Parsing '/etc/asterisk/sip.conf':   == Found
  == Using SIP RTP CoS mark 5
    -- Executing [555@LocalSets:1] MusicOnHold("SIP/0000FFFF0001-00000001", 
       "") in new stack
    -- Started music on hold, class 'default', on SIP/0000FFFF0001-00000001

*CLI&gt; <strong class="userinput"><code>queue show support</code></strong>
support      has 0 calls (max unlimited) in 'rrmemory' strategy 
(0s holdtime, 0s talktime), W:0, C:0, A:0, SL:0.0% within 0s
   Members: 
      SIP/0000FFFF0001 (dynamic) (In use) has taken no calls yet
   No Callers</pre><p><a id="ACD_id288885"></a>In short, <span class="application"><code class="literal">Queue()</code></span> needs to know the state
      of a device in order to properly manage call distribution. The <code class="literal">callcounter</code> option in <code class="filename">sip.conf</code> is an essential component of a
      properly functioning queue.<a id="I_indexterm13_d1e27296" class="indexterm"></a></p></div></div><div class="sect1" title="The queues.conf File"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id288901"></a>The queues.conf File</h2></div></div></div><p><a id="ACD_id288910"></a><a id="index-385M648RA0O" class="indexterm"></a><a id="index-378O077DP4C" class="indexterm"></a>We’ve mentioned the <code class="filename">queues.conf</code> file already, but there are many
    options in this file, and we figured it would be right and proper for us
    to go over some of them with you.</p><p><a id="ACD_id288915"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general_queues_id001" title="Table 13.1. Available options for [general] section of queues.conf">Table&nbsp;13.1, “Available options for [general] section of queues.conf”</a>
    contains the options available in the <code class="literal">[general]</code> section <a id="I_indexterm13_d1e27319" class="indexterm"></a>of <code class="filename">queues.conf</code>.</p><div class="table"><a id="options_general_queues_id001"></a><p class="title"><strong>Table&nbsp;13.1.&nbsp;Available options for [general] section of queues.conf</strong></p><div class="table-contents"><table summary="Available options for [general] section of queues.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center"><span class="keep-together">Available
            values</span></th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">persistentmembers</code></td><td><code class="literal"><a id="I_indexterm13_d1e27348" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Set this to <code class="literal">yes</code> to store
            dynamically added members to queues in the AstDB so that they can
            be re-added upon Asterisk restart.</td></tr><tr><td><code class="literal">autofill</code></td><td><code class="literal"><a id="I_indexterm13_d1e27366" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>With <code class="literal">autofill</code> disabled,
            the queue application will attempt to deliver calls to agents in a
            serial manner. This means only one call is attempted to be
            distributed to agents at a time. Additional callers are not
            distributed to agents until that caller is connected to an agent.
            With <code class="literal">autofill</code> enabled, callers
            are distributed to available agents simultaneously.</td></tr><tr><td><code class="literal">monitor-type</code></td><td><code class="literal"><a id="I_indexterm13_d1e27387" class="indexterm"></a>MixMonitor</code>,
            &lt;<em class="replaceable"><code>unspecified</code></em>&gt;</td><td>If you specify the value <code class="literal">MixMonitor</code> the <code class="literal">MixMonitor()</code> application will be used
            for recording calls within the queue. If you do not specify a
            value or comment the option out, the <code class="literal">Monitor()</code> application will be used
            instead.</td></tr><tr><td><code class="literal">updatecdr</code></td><td><code class="literal"><a id="I_indexterm13_d1e27412" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Set this to <code class="literal">yes</code> to
            populate the <code class="literal">dstchannel</code> field
            of the CDR records with the name of a dynamically added member on
            answer. The value is set with the <code class="literal">AddQueueMember()</code> application. This
            option is used to mimic the behavior of <code class="literal">chan_agent</code> channels.</td></tr><tr><td><code class="literal">shared_lastcall</code></td><td><code class="literal"><a id="I_indexterm13_d1e27439" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>This value is used for members logged into more than one
            queue to have their last call be the same across all queues, in
            order for the queues to respect the wrap up time of other
            queues.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ACD_id411793"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_defined_queues" title="Table 13.2. Available options for defined queues in queues.conf">Table&nbsp;13.2, “Available options for defined queues in queues.conf”</a>
    describes the options available for configuring queue contexts.<a id="I_indexterm13_d1e27451" class="indexterm"></a><a id="I_indexterm13_d1e27456" class="indexterm"></a></p><div class="table"><a id="options_defined_queues"></a><p class="title"><strong>Table&nbsp;13.2.&nbsp;Available options for defined queues in queues.conf</strong></p><div class="table-contents"><table summary="Available options for defined queues in queues.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center"><span class="keep-together">Available
            values</span></th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">musicclass</code></td><td><a id="I_indexterm13_d1e27480" class="indexterm"></a>Music class as defined by <code class="filename">musiconhold.conf</code></td><td>Sets the music class to be used by a particular queue. You
            can also override this value with the <code class="literal">CHANNEL</code><code class="literal">(musicclass)</code> channel
            variable.</td></tr><tr><td><code class="literal">announce</code></td><td><a id="I_indexterm13_d1e27498" class="indexterm"></a>Filename of the announcement</td><td>Used for playing an announcement to the agent that answered
            the call, typically to let him know what queue the caller is
            coming from. Useful when the agent is in multiple queues,
            especially when set to auto-answer the queue.</td></tr><tr><td><code class="literal">strategy</code></td><td><code class="literal"><a id="I_indexterm13_d1e27510" class="indexterm"></a>ringall</code>, <code class="literal">least</code><code class="literal">recent</code>, <code class="literal">fewest</code><code class="literal">calls</code>, <code class="literal">random</code>, <code class="literal">rrmemory</code>, <code class="literal">linear</code>, <code class="literal">wrandom</code></td><td><div class="itemizedlist"><a id="ACD_id419112"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id419114"></a><a id="ACD_id419116"></a><code class="literal">ringall</code>: rings all available
                  callers (default)</p></li><li class="listitem"><p><a id="ACD_id419121"></a><a id="ACD_id419123"></a><code class="literal">leastrecent</code>: rings the interface
                  that least <span class="keep-together">recently</span>
                  received a call</p></li><li class="listitem"><p><a id="ACD_id419128"></a><a id="ACD_id419130"></a><code class="literal">fewestcalls</code>: rings the interface
                  that has <span class="keep-together">completed</span> the
                  fewest calls in this queue</p></li><li class="listitem"><p><a id="ACD_id419135"></a><a id="ACD_id419137"></a><code class="literal">random</code>: rings a random
                  interface</p></li><li class="listitem"><p><a id="ACD_id419142"></a><a id="ACD_id419144"></a><code class="literal">rrmemory</code>: rings members in a
                  round-robin fashion, remembering where we left off last for
                  the next caller</p></li><li class="listitem"><p><a id="ACD_id419150"></a><a id="ACD_id419152"></a><code class="literal">linear</code>: rings members in the order
                  specified, <span class="keep-together">always</span>
                  starting at the beginning of the list</p></li><li class="listitem"><p><a id="ACD_id419157"></a><a id="ACD_id419159"></a><code class="literal">wrandom</code>: rings a random member,
                  but uses the members’ penalties as a weight.</p></li></ul></div></td></tr><tr><td><code class="literal">servicelevel</code></td><td><a id="I_indexterm13_d1e27588" class="indexterm"></a>Value in seconds</td><td>Used in statistics to determine the service level of the
            queue (calls answered within the service level time
            frame).</td></tr><tr><td><code class="literal">context</code></td><td><a id="I_indexterm13_d1e27599" class="indexterm"></a>Dialplan context</td><td>Allows a caller to exit the queue by pressing a
            <span class="emphasis"><em>single</em></span> DTMF digit. If a context is specified
            and the caller enters a number, that digit will attempt to be
            matched in the context specified, and dialplan execution will
            continue there.</td></tr><tr><td><code class="literal">penaltymemberslimit</code></td><td><a id="I_indexterm13_d1e27613" class="indexterm"></a>Value of <code class="literal">0</code> or
            greater</td><td>Used to disregard penalty values if the number of members
            in the queue is lower than the value specified.</td></tr><tr><td><code class="literal">timeout</code></td><td><a id="I_indexterm13_d1e27627" class="indexterm"></a>Value in seconds</td><td>Specifies the number of seconds to ring a member’s device.
            Also see <code class="literal">timeoutpriority</code>.</td></tr><tr><td><code class="literal">retry</code></td><td><a id="I_indexterm13_d1e27641" class="indexterm"></a>Value in seconds</td><td>Specifies the number of seconds to wait before attempting
            the next member in the queue if the <code class="literal">timeout</code> value is exhausted while
            attempting to ring a member of the queue.</td></tr><tr><td><code class="literal">timeoutpriority</code></td><td><code class="literal"><a id="I_indexterm13_d1e27656" class="indexterm"></a>app</code>, <code class="literal">conf</code></td><td>Used to control the priority of the two possible <code class="literal">timeout</code> options specified for a queue.
            The <code class="literal">Queue()</code> application has a
            timeout value that can be specified to control the absolute time a
            caller can be in the queue. The <code class="literal">timeout</code> value in <code class="filename">queues.conf</code> controls the amount of time
            (along with <code class="literal">retry</code>) to ring a
            member for. Sometime these values conflict, so you can control
            which value takes precedence. The default is <code class="literal">app</code>, as this is the way it works in
            previous versions.</td></tr><tr><td><code class="literal">weight</code></td><td><a id="I_indexterm13_d1e27689" class="indexterm"></a>Value of <code class="literal">0</code> or
            higher</td><td>Defines the weight of a queue. A queue with a higher weight
            defined will get first priority when members are associated with
            multiple queues.</td></tr><tr><td><code class="literal">wrapuptime</code></td><td><a id="I_indexterm13_d1e27703" class="indexterm"></a>Value in seconds</td><td>The number of seconds to keep a member unavailable in a
            queue after completing a call.</td></tr><tr><td><code class="literal">autofill</code></td><td><code class="literal"><a id="I_indexterm13_d1e27716" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Same as defined in the <code class="literal">[general]</code> section. This value can be
            defined per queue.</td></tr><tr><td><code class="literal">autopause</code></td><td><code class="literal"><a id="I_indexterm13_d1e27734" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">all</code></td><td>Enables/disables the automatic pausing of members who fail
            to answer a call. A value of <code class="literal">all</code> causes this member to be paused in
            all queues she is a member of.</td></tr><tr><td><code class="literal">maxlen</code></td><td><a id="I_indexterm13_d1e27754" class="indexterm"></a>Value of <code class="literal">0</code> or
            higher</td><td>Specifies the maximum number of callers allowed to be
            waiting in a queue. A value of zero means an unlimited number of
            callers are allowed in the queue.</td></tr><tr><td><code class="literal">setinterfacevar</code></td><td><code class="literal"><a id="I_indexterm13_d1e27769" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
            following channel variables will be set just prior to connecting
            the caller with the queue member:<div class="itemizedlist"><a id="ACD_id378618"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id378620"></a><a id="ACD_id378622"></a><code class="literal">MEMBERINTERFACE</code>: the member’s
                  interface, such as <code class="literal">Agent/1234</code></p></li><li class="listitem"><p><a id="ACD_id378629"></a><a id="ACD_id378631"></a><code class="literal">MEMBERNAME</code>: the name of the
                  member</p></li><li class="listitem"><p><a id="ACD_id378637"></a><a id="ACD_id378640"></a><code class="literal">MEMBERCALLS</code>: the number of calls
                  the interface has taken</p></li><li class="listitem"><p><a id="ACD_id378647"></a><a id="ACD_id378649"></a><code class="literal">MEMBERLASTCALL</code>: the last time the
                  member took a call</p></li><li class="listitem"><p><a id="ACD_id378655"></a><a id="ACD_id378657"></a><code class="literal">MEMBERPENALTY</code>: the penalty value
                  of the <span class="keep-together">member</span></p></li><li class="listitem"><p><a id="ACD_id409454"></a><a id="ACD_id409456"></a><code class="literal">MEMBERDYNAMIC</code>: indicates whether
                  the member was dynamically added to the queue or not</p></li><li class="listitem"><p><a id="ACD_id409462"></a><a id="ACD_id409465"></a><code class="literal">MEMBERREALTIME</code>: indicates whether
                  the member is included from real time or not</p></li></ul></div></td></tr><tr><td><code class="literal">setqueueentryvar</code></td><td><code class="literal"><a id="I_indexterm13_d1e27827" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
            following channel variables will be set just prior to the call
            being bridged:<div class="itemizedlist"><a id="ACD_id409489"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id409491"></a><a id="ACD_id409493"></a><code class="literal">QEHOLDTIME</code>: the amount of time the
                  caller was held in the queue</p></li><li class="listitem"><p><a id="ACD_id409500"></a><a id="ACD_id409502"></a><code class="literal">QEORIGINALPOS</code>: the position the
                  caller originally entered the queue at</p></li></ul></div></td></tr><tr><td><code class="literal">setqueuevar</code></td><td><code class="literal"><a id="I_indexterm13_d1e27856" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
            following channel variables will be set just prior to the call
            being bridged:<div class="itemizedlist"><a id="ACD_id409526"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id409528"></a><a id="ACD_id409531"></a><code class="literal">QUEUENAME</code>: the name of the
                  queue</p></li><li class="listitem"><p><a id="ACD_id409537"></a><a id="ACD_id409539"></a><code class="literal">QUEUEMAX</code>: the maximum number of
                  calls allowed in this queue</p></li><li class="listitem"><p><a id="ACD_id409546"></a><a id="ACD_id409548"></a><code class="literal">QUEUESTRATEGY</code>: the strategy method
                  defined for the queue</p></li><li class="listitem"><p><a id="ACD_id409555"></a><a id="ACD_id409558"></a><code class="literal">QUEUECALLS</code>: the number of calls
                  currently in the queue</p></li><li class="listitem"><p><a id="ACD_id409565"></a><a id="ACD_id409567"></a><code class="literal">QUEUEHOLDTIME</code>: the current average
                  hold time of callers in the queue</p></li><li class="listitem"><p><a id="ACD_id409574"></a><a id="ACD_id409576"></a><code class="literal">QUEUECOMPLETED</code>: the number of
                  completed calls in this queue</p></li><li class="listitem"><p><a id="ACD_id409583"></a><a id="ACD_id409585"></a><code class="literal">QUEUEABANDONED</code>: the number of
                  abandoned calls</p></li><li class="listitem"><p><a id="ACD_id409592"></a><a id="ACD_id409594"></a><code class="literal">QUEUESRVLEVEL</code>: the queue service
                  level</p></li><li class="listitem"><p><a id="ACD_id409600"></a><a id="ACD_id409602"></a><code class="literal">QUEUESRVLEVELPERF</code>: the queue’s
                  service level performance</p></li></ul></div></td></tr><tr><td><code class="literal">membermacro</code></td><td><a id="I_indexterm13_d1e27919" class="indexterm"></a>Name of a macro defined in the <span class="keep-together">dialplan</span></td><td>Defines a macro to be executed just prior to bridging the
            caller and the queue member.</td></tr><tr><td><code class="literal">announce-frequency</code></td><td><a id="I_indexterm13_d1e27932" class="indexterm"></a>Value in seconds</td><td>Defines how often we should announce the caller’s position
            and/or estimated hold time in the queue. Set this value to zero to
            disable.</td></tr><tr><td><code class="literal">min-announce-frequency</code></td><td><a id="I_indexterm13_d1e27943" class="indexterm"></a>Value in seconds</td><td>Specifies the minimum amount of time that must pass before
            we announce the caller’s position in the queue again. This is used
            when the caller’s position may change frequently, to prevent the
            caller hearing multiple updates in a short period of time.</td></tr><tr><td><code class="literal">periodic-announce-frequency</code></td><td><a id="I_indexterm13_d1e27954" class="indexterm"></a>Value in seconds</td><td>Indicates how often we should make periodic announcements
            to the caller.</td></tr><tr><td><code class="literal">random-periodic-announce</code></td><td><code class="literal"><a id="I_indexterm13_d1e27966" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, will play
            the defined periodic announcements in a random order. See <code class="literal">periodic-announce</code>.</td></tr><tr><td><code class="literal">relative-periodic-announce</code></td><td><code class="literal"><a id="I_indexterm13_d1e27988" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
            <code class="literal">periodic-announce-frequency</code>
            timer will start from when the end of the file being played back
            is reached, instead of from the beginning. Defaults to <code class="literal">no</code>.</td></tr><tr><td><code class="literal">announce-holdtime</code></td><td><code class="literal"><a id="I_indexterm13_d1e28012" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">once</code></td><td>Defines whether the estimated hold time should be played
            along with the periodic announcements. Can be set to <code class="literal">yes</code>, <code class="literal">no</code>, or only <code class="literal">once</code>.</td></tr><tr><td><code class="literal">announce-position</code></td><td><code class="literal"><a id="I_indexterm13_d1e28039" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">limit</code>, <code class="literal">more</code></td><td>Defines whether the caller’s position in the queue should
            be announced to her. If set to <code class="literal">no</code>, the position will never be
            announced. If set to <code class="literal">yes</code>, the
            caller’s position will always be announced. If the value is set to
            <code class="literal">limit</code>, the caller will hear her
            position in the queue only if it is within the limit defined by
            <code class="literal">announce-position-limit</code>. If the
            value is set to <code class="literal">more</code>, the
            caller will hear her position if it is beyond the number defined
            by <code class="literal">announce-position-limit</code>.</td></tr><tr><td><code class="literal">announce-position-limit</code></td><td><a id="I_indexterm13_d1e28078" class="indexterm"></a>Number of zero or greater</td><td>Used if you’ve defined <code class="literal">announce-position</code> as either <code class="literal">limit</code> or <code class="literal">more</code>.</td></tr><tr><td><code class="literal">announce-round-seconds</code></td><td><a id="I_indexterm13_d1e28098" class="indexterm"></a>Value in seconds</td><td>If this value is nonzero, we’ll announce the number of
            seconds as well, and round them to the value defined.</td></tr><tr><td><code class="literal">queue-thankyou</code></td><td><a id="I_indexterm13_d1e28109" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“Thank you for
            your patience”). If set to an empty value, the prompt will not be
            played at all.</td></tr><tr><td><code class="literal">queue-youarenext</code></td><td><a id="I_indexterm13_d1e28120" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“You are now
            first in line”). If set to an empty value, the prompt will not be
            played at all.</td></tr><tr><td><code class="literal">queue-thereare</code></td><td><a id="I_indexterm13_d1e28131" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“There are”).
            If set to an empty value, the prompt will not be played at
            all.</td></tr><tr><td><code class="literal">queue-callswaiting</code></td><td><a id="I_indexterm13_d1e28142" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“calls
            waiting”). If set to an empty value, the prompt will not be played
            at all.</td></tr><tr><td><code class="literal">queue-holdtime</code></td><td><a id="I_indexterm13_d1e28153" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“The current
            estimated hold time is”). If set to an empty value, the prompt
            will not be played at all.</td></tr><tr><td><code class="literal">queue-minutes</code></td><td><a id="I_indexterm13_d1e28164" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“minutes”). If
            set to an empty value, the prompt will not be played at
            all.</td></tr><tr><td><code class="literal">queue-seconds</code></td><td><a id="I_indexterm13_d1e28176" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“seconds”). If
            set to an empty value, the prompt will not be played at
            all.</td></tr><tr><td><code class="literal">queue-reporthold</code></td><td><a id="I_indexterm13_d1e28187" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“Hold time”).
            If set to an empty value, the prompt will not be played at
            all.</td></tr><tr><td><code class="literal">periodic-announce</code></td><td><a id="I_indexterm13_d1e28198" class="indexterm"></a>A set of periodic announcements to be played,
            separated by commas</td><td>Prompts are played in the order they are defined. Defaults
            to <code class="literal">queue-periodic-announce</code>
            (“All representatives are currently busy assisting other callers.
            Please wait for the next available representative”).</td></tr><tr><td><code class="literal">monitor-format</code></td><td><code class="literal"><a id="I_indexterm13_d1e28213" class="indexterm"></a>gsm</code>, <code class="literal">wav</code>, <code class="literal">wav49</code>, &lt;<em class="replaceable"><code>any valid file
            format</code></em>&gt;</td><td>Specifies the file format to use when recording. If
            <code class="literal">monitor-format</code> is commented out,
            calls will not be <span class="keep-together">recorded</span>.</td></tr><tr><td><code class="literal">monitor-type</code></td><td><code class="literal"><a id="I_indexterm13_d1e28241" class="indexterm"></a>MixMonitor</code>,
            &lt;<em class="replaceable"><code>unspecified</code></em>&gt;</td><td>Same as <code class="literal">monitor-type</code> as
            defined in the <code class="literal">[general]</code> section, but on a
            per-queue basis.</td></tr><tr><td><code class="literal">joinempty</code></td><td><code class="literal"><a id="I_indexterm13_d1e28263" class="indexterm"></a>paused</code>, <code class="literal">penalty</code>, <code class="literal">inuse</code>, <code class="literal">ringing</code>, <code class="literal">unavailable</code>, <code class="literal">invalid</code>, <code class="literal">unknown</code>, <code class="literal">wrapup</code></td><td>Controls whether a caller is added to the queue when no
            members are available. Comma-separated options can be included to
            define how this option determines whether members are available.
            The definitions for the values are:<div class="itemizedlist"><a id="ACD_id406444"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id406446"></a><a id="ACD_id406449"></a><code class="literal">paused</code>: members are considered
                  unavailable if they are paused.</p></li><li class="listitem"><p><a id="ACD_id406456"></a><a id="ACD_id406458"></a><code class="literal">penalty</code>: members are considered
                  unavailable if their penalties are less than <code class="literal">QUEUE</code><code class="literal">_</code><code class="literal">MAX</code><code class="literal">_</code><code class="literal">PENALTY</code>.</p></li><li class="listitem"><p><a id="ACD_id406469"></a><a id="ACD_id406471"></a><code class="literal">inuse</code>: members are considered
                  unavailable if their device <code class="literal">status</code> is In Use.</p></li><li class="listitem"><p><a id="ACD_id409644"></a><a id="ACD_id409646"></a><code class="literal">ringing</code>: members are considered
                  unavailable if their device status is <code class="literal">Ringing</code>.</p></li><li class="listitem"><p><a id="ACD_id409653"></a><a id="ACD_id409656"></a><code class="literal">unavailable</code>: applies primarily to
                  agent channels; if the agent is not logged in but is a
                  member of the queue, it is considered unavailable.</p></li><li class="listitem"><p><a id="ACD_id409664"></a><a id="ACD_id409666"></a><code class="literal">invalid</code>: members are considered
                  unavailable if their device status is <code class="literal">Invalid</code>. This is typically an
                  error condition.</p></li><li class="listitem"><p><a id="ACD_id409674"></a><a id="ACD_id409676"></a><code class="literal">unknown</code>: members are considered
                  unavailable if device status is unknown.</p></li><li class="listitem"><p><a id="ACD_id409684"></a><a id="ACD_id409686"></a><code class="literal">wrapup</code>: members are considered
                  unavailable if they are currently in the wrapup time after
                  the completion of a call.</p></li></ul></div></td></tr><tr><td><code class="literal">leavewhenempty</code></td><td><code class="literal"><a id="I_indexterm13_d1e28358" class="indexterm"></a>paused</code>, <code class="literal">penalty</code>, <code class="literal">inuse</code>, <code class="literal">ringing</code>, <code class="literal">unavailable</code>, <code class="literal">invalid</code>, <code class="literal">unknown</code>, <code class="literal">wrapup</code></td><td>Used to control whether callers are kicked out of the queue
            when members are no longer available to take calls. See <code class="literal">joinempty</code> for more information on the
            assignable <span class="keep-together">values</span>.</td></tr><tr><td><code class="literal">eventwhencalled</code></td><td><code class="literal"><a id="I_indexterm13_d1e28398" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">vars</code></td><td>If set to <code class="literal">yes</code>, the
            following manager events will be sent to the Asterisk Manager
            Interface (AMI):<div class="itemizedlist"><a id="ACD_id409730"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id409732"></a><a id="ACD_id409734"></a><code class="literal">AgentCalled</code></p></li><li class="listitem"><p><a id="ACD_id409738"></a><a id="ACD_id409740"></a><code class="literal">AgentDump</code></p></li><li class="listitem"><p><a id="ACD_id409745"></a><a id="ACD_id409747"></a><code class="literal">AgentConnect</code></p></li><li class="listitem"><p><a id="ACD_id409751"></a><a id="ACD_id409753"></a><code class="literal">AgentComplete</code></p></li></ul></div><p><a id="ACD_id409758"></a>If set to <code class="literal">vars</code>, all channel variables associated
            with the agent will also be sent to the AMI.</p></td></tr><tr><td><code class="literal">eventmemberstatus</code></td><td><code class="literal"><a id="I_indexterm13_d1e28441" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
            <code class="literal">QueueMemberStatus</code> event will be
            sent to AMI. Note that this may generate a lot of manager
            events.</td></tr><tr><td><code class="literal">reportholdtime</code></td><td><code class="literal"><a id="I_indexterm13_d1e28462" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Enables reporting of the caller’s hold time to the queue
            member prior to bridging.</td></tr><tr><td><code class="literal">ringinuse</code></td><td><code class="literal"><a id="I_indexterm13_d1e28477" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Used to avoid sending calls to members whose status is
            <code class="literal">In Use</code>. Recall from our
            discussion in the preceding section that only the SIP channel
            driver is currently able to accurately report this status.</td></tr><tr><td><code class="literal">memberdelay</code></td><td><a id="I_indexterm13_d1e28495" class="indexterm"></a>Value in seconds</td><td>Used if you want there to be a delay prior to the caller
            and queue member being connected to each other.</td></tr><tr><td><code class="literal">timeoutrestart</code></td><td><code class="literal"><a id="I_indexterm13_d1e28507" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, resets
            the timeout for an agent to answer if either a <code class="literal">BUSY</code> or <code class="literal">CONGESTION</code> status is received from the
            channel. This can be useful if the agent is allowed to reject or
            cancel a call.</td></tr><tr><td><code class="literal">defaultrule</code></td><td><a id="I_indexterm13_d1e28530" class="indexterm"></a>Rule as defined in <code class="filename">queuerules.conf</code></td><td>Associates a queue rule as defined in <code class="filename">queuerules.conf</code> to this queue, which is
            used to dynamically change the minimum and maximum penalties,
            which are then used to select an available agent. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485" title="Changing Penalties Dynamically (queuerules.conf)">the section called “Changing Penalties Dynamically (queuerules.conf)”</a>.</td></tr><tr><td><code class="literal">member</code></td><td><a id="I_indexterm13_d1e28548" class="indexterm"></a>Device</td><td>Used to define static members in a queue. To define a
            static member, you supply its
            <em class="replaceable"><code>Technology</code></em>/<em class="replaceable"><code>Device_ID</code></em>
            (e.g., <code class="literal">Agent/1234</code>, <code class="literal">SIP/0000FFFF0001</code>, <code class="literal">DAHDI/g0/14165551212</code>).<a id="I_indexterm13_d1e28570" class="indexterm"></a><a id="I_indexterm13_d1e28571" class="indexterm"></a></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect1" title="The agents.conf File"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id288918"></a>The agents.conf File</h2></div></div></div><p><a id="ACD_id288926"></a><a id="I_indexterm13_d1e28577" class="indexterm"></a><a id="I_indexterm13_d1e28580" class="indexterm"></a><a id="I_indexterm13_d1e28585" class="indexterm"></a>If you’ve browsed through the samples in the <code class="filename">~/src/asterisk-complete/1.8/configs/</code> directory,
    you may have noticed the <code class="filename">agents.conf</code>
    file. It may seem tempting, and it has its places, but overall the best
    way to implement queues is through the use of SIP channels. There are two
    reasons for this. The first is that SIP channels are the only type that
    provide true device state information. The other reason is that agents are
    always logged in when using the agent channel, and if you’re using remote
    agents, the bandwidth requirements may be greater than you wish. However,
    in busy call centers it may be desirable to force agents to answer calls
    immediately rather than having them press the answer button on the
    phone.</p><p><a id="ACD_id415213"></a>The <code class="filename">agents.conf</code> file is use to define agents for
    queues using the agents channel. This channel is similar in nature to the
    other channel types in Asterisk (local, SIP, IAX2, etc.), but it is more
    of a pseudo-channel in that it is used to connect callers to agents who
    have logged into the system using other types of transport channel. For
    example, suppose we use our SIP-enabled phone to log in to Asterisk using
    the <code class="literal">AgentLogin()</code> dialplan application.
    Once we’re logged in, the channel remains online the entire time it is
    available (logged on), and calls are then passed to it through the agent
    channel.</p><p><a id="ACD_id415225"></a>Let’s take a look at the various options available
    to us in the <code class="filename">agents.conf</code> file to get
    a better idea of what it provides us. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general_header" title="Table 13.3. Options available under the [general] header in agents.conf">Table&nbsp;13.3, “Options available under the [general] header in
      agents.conf”</a> shows the single option available in
    the <code class="literal">[general]</code> section <a id="I_indexterm13_d1e28615" class="indexterm"></a>of <code class="filename">agents.conf</code>. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_agents_header" title="Table 13.4. Options available under the [agents] header in agents.conf">Table&nbsp;13.4, “Options available under the [agents] header in agents.conf”</a> shows the available options under the
    <code class="literal">[agents]</code> header.</p><div class="table"><a id="options_general_header"></a><p class="title"><strong>Table&nbsp;13.3.&nbsp;Options available under the [general] header in
      agents.conf</strong></p><div class="table-contents"><table summary="Options available under the [general] header in
      agents.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center"><span class="keep-together">Available
            values</span></th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">multiplelogin</code></td><td><code class="literal"><a id="I_indexterm13_d1e28650" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, a single
            line on a device can log in as multiple agents. Defaults to
            <code class="literal">yes</code>.</td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a id="options_agents_header"></a><p class="title"><strong>Table&nbsp;13.4.&nbsp;Options available under the [agents] header <a id="I_indexterm13_d1e28668" class="indexterm"></a>in agents.conf</strong></p><div class="table-contents"><table summary="Options available under the [agents] header agents header section, agents.confin agents.conf" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center"><span class="keep-together">Available
            values</span></th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">maxloginretries</code></td><td><a id="I_indexterm13_d1e28688" class="indexterm"></a>Integer value</td><td>Specifies the maximum number of tries an agent has to log
            in before the system considers it a failed attempt and ends the
            call. Defaults to 3.</td></tr><tr><td><code class="literal">autologoff</code></td><td><a id="I_indexterm13_d1e28699" class="indexterm"></a>Value in seconds</td><td>Specifies the number of seconds for which an agent’s device
            should ring before the agent is automatically logged off.</td></tr><tr><td><code class="literal">autologoffunavail</code></td><td><code class="literal"><a id="I_indexterm13_d1e28711" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the agent
            is automatically logged off when the device being called returns a
            status of CHANUNAVAIL.</td></tr><tr><td><code class="literal">ackcall</code></td><td><code class="literal"><a id="I_indexterm13_d1e28729" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the agent
            must enter a single DTMF digit to accept the call. To be used in
            conjunction with <code class="literal">acceptdtmf</code>.
            Defaults to <code class="literal">no</code>.</td></tr><tr><td><code class="literal">acceptdtmf</code></td><td><a id="I_indexterm13_d1e28752" class="indexterm"></a>Single DTMF <span class="keep-together">character</span></td><td>Used in conjunction with <code class="literal">ackcall</code>, this option defines the DTMF
            character to be used to accept a call. Defaults to <code class="literal">#</code>.</td></tr><tr><td><code class="literal">endcall</code></td><td><code class="literal"><a id="I_indexterm13_d1e28772" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, allows an
            agent to end a call with a single DTMF digit. To be used in
            conjunction with <code class="literal">enddtmf</code>.
            Defaults to <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">enddtmf</code></td><td><a id="I_indexterm13_d1e28795" class="indexterm"></a>Single DTMF <span class="keep-together">character</span></td><td>Used in conjunction with <code class="literal">endcall</code>, this option defines the DTMF
            character to be used to end a call. Defaults to <code class="literal">*</code>.</td></tr><tr><td><code class="literal">wrapuptime</code></td><td><a id="I_indexterm13_d1e28814" class="indexterm"></a>Value in milliseconds</td><td>Specifies the amount of time after disconnection of a
            caller from an agent for which the agent will not be available to
            accept another call. Used in situations where agents must perform
            a function after each call (such as entering call details into a
            log).</td></tr><tr><td><code class="literal">musiconhold</code></td><td><a id="I_indexterm13_d1e28825" class="indexterm"></a>Music class as defined in <code class="filename">musiconhold.conf</code></td><td>Defines the default music class agents listen to when
            logged in.</td></tr><tr><td><code class="literal">goodbye</code></td><td><a id="I_indexterm13_d1e28838" class="indexterm"></a>Name of file (relative to <code class="filename">/var/lib/asterisk/sounds/&lt;lang&gt;/</code>)</td><td>Defines the default goodbye sound played to agents.
            Defaults to <code class="filename">vm-goodbye</code>.</td></tr><tr><td><code class="literal">updatecdr</code></td><td><code class="literal"><a id="I_indexterm13_d1e28856" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Used in call detail records to change the source channel
            field to the agent/<em class="replaceable"><code>agent_id</code></em>.</td></tr><tr><td><code class="literal">group</code></td><td><a id="I_indexterm13_d1e28874" class="indexterm"></a>Integer value</td><td>Allows you to define groups for sets of agents.
            <span class="emphasis"><em>The use of agent groups is essentially deprecated
            functionality that we do not recommend you use.</em></span> If you
            define <code class="literal">group1</code>, you can use
            <code class="literal">Agent/@1</code> in <code class="filename">queues.conf</code> to call that group of
            agents. The call will be connected arbitrarily to one of those
            agents. If no agents are available, it will return back to the
            queue like any other unanswered call. If you use <code class="literal">Agent/:1</code>, it will wait for a member of
            the group to become available. <span class="emphasis"><em>The use of strategies has
            no effect on agent groups. Do not use these.</em></span></td></tr><tr><td><code class="literal">recordagentcalls</code></td><td><code class="literal"><a id="I_indexterm13_d1e28904" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>Enables/disables the recording of agent calls. Disabled by
            default.</td></tr><tr><td><code class="literal">recordformat</code></td><td><a id="I_indexterm13_d1e28918" class="indexterm"></a>File format (<code class="literal">gsm</code>,
            <code class="literal">wav</code>, etc.)</td><td>Defines the format to be used when recording agent calls.
            Default is <code class="literal">wav</code>.</td></tr><tr><td><code class="literal">urlprefix</code></td><td><a id="I_indexterm13_d1e28938" class="indexterm"></a>String (URL)</td><td>Accepts a string as its argument. The string can be formed
            as a URL and is appended to the start of the text to be added to
            the name of the recording.</td></tr><tr><td><code class="literal">savecallsin</code></td><td><a id="I_indexterm13_d1e28949" class="indexterm"></a>Filesystem path (e.g., <code class="filename">/var/calls/</code>)</td><td>Accepts a filesystem path as its argument. Allows you to
            override the default path of <code class="filename">/var/spool/asterisk/monitor/</code> with one
            of your choosing.<sup>[<a id="id587744" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id587744" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">custom_beep</code></td><td><a id="I_indexterm13_d1e28969" class="indexterm"></a>Name of file (relative to <code class="filename">/var/lib/asterisk/sounds/&lt;lang&gt;/</code>)</td><td>Accepts a filename as its argument. Can be used to define a
            custom notification tone to signal to an always-connected agent
            that there is an incoming call.</td></tr><tr><td><code class="literal">agent</code></td><td><a id="I_indexterm13_d1e28983" class="indexterm"></a>Agent definition (see description)</td><td>Defines an agent for use by <code class="literal">Queue()</code> and <code class="literal">AgentLogin()</code>. These are agents that will
            log in and stay connected to the system, waiting for calls to be
            delivered by the <code class="literal">Queue()</code>
            dialplan application. Agents are defined like so:<a id="ACD_id413530"></a><pre class="programlisting">agent =&gt; <em class="replaceable"><code>agent_id</code></em>,<em class="replaceable"><code>agent_password</code></em>,<em class="replaceable"><code>name</code></em></pre><p><a id="ACD_id413541"></a>An example of a defined agent would
            be:<a id="ACD_id413544"></a></p><pre class="programlisting">agent =&gt; 1000,1234,Danielle Roberts</pre></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id587744" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id587744" class="para">a</a>] </sup>Since the storage of calls will
                require a large amount of hard drive space, you will want to
                define a strategy to handle storing and managing these
                recordings. This location should probably reside on a separate
                volume, one with very high performance characteristics.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect1" title="Advanced Queues"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id288932"></a>Advanced Queues</h2></div></div></div><p><a id="ACD_id288937"></a>In this section we’ll take a look at some of the
    finer-grained queue controls, such as options for controlling
    announcements and when callers should be placed into (or removed from) the
    queue. We’ll also look at penalties and priorities, exploring how we can
    control the agents in our queue by giving preference to a pool of agents
    to answer the call and increase that pool dynamically based on the wait
    times in the queue. Finally, we’ll look at using Local channels as queue
    members, which gives us the ability to perform dialplan functionality
    prior to connecting the caller to an agent.</p><div class="sect2" title="Priority Queue (Queue Weighting)"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288946"></a>Priority Queue (Queue Weighting)</h3></div></div></div><p><a id="ACD_id288951"></a><a id="I_indexterm13_d1e29021" class="indexterm"></a><a id="I_indexterm13_d1e29026" class="indexterm"></a><a id="I_indexterm13_d1e29029" class="indexterm"></a>Sometimes you need to add people to a queue at a higher
      priority than that given to other callers. Perhaps the caller has
      already spent time waiting in a queue, and an agent has taken some
      information but realized the caller needed to be transferred to another
      queue. In this case, to minimize the caller’s overall wait time, it
      might be desirable to transfer the call to a priority queue that has a
      higher weight (and thus a higher preference), so it will be answered
      quickly.</p><p><a id="ACD_id36004331"></a>Setting a higher priority on a queue is done
      with the <code class="literal">weight</code> option.<a id="I_indexterm13_d1e29038" class="indexterm"></a> If you have two queues with differing weights (e.g.,
      <code class="literal">support</code> and <code class="literal">support-priority</code>), agents assigned to both
      queues will be passed calls from the higher-priority queue in preference
      to calls from the lower-priority queue. Those agents will not take any
      calls from the lower-priority queue until the higher-priority queue is
      cleared. (Normally, there will be some agents who are assigned only to
      the lower-priority queue, to ensure that those calls are dealt with in a
      timely manner.) For example, if we place queue member James Shaw into
      both the <code class="literal">support</code> and <code class="literal">support-priority</code> queues, callers in the
      <code class="literal">support-priority</code> queue will have a
      preferred standing with James over callers in the <code class="literal">support</code> queue.</p><p><a id="ACD_id36004351"></a>Let’s take a look at how we could make this
      work. First, we need to create two queues that are identical except for
      the <code class="literal">weight</code> option. We can use a
      template for this to ensure that the two queues remain identical if
      anything should need to change in the future:</p><a id="ACD_id36004360"></a><pre class="programlisting">[support_template](!)
musicclass=default
strategy=rrmemory
joinempty=no
leavewhenempty=yes
ringinuse=no

[support](support_template)
weight=0

[support-priority](support_template)
weight=10</pre><p><a id="ACD_id36004364"></a>With our queues configured (and subsequently
      reloaded using <span class="command"><strong>module reload
      app_queue.so</strong></span><a id="I_indexterm13_d1e29072" class="indexterm"></a><a id="I_indexterm13_d1e29075" class="indexterm"></a> from the Asterisk console), we can now create two
      extensions to transfer callers to. This can be done wherever you would
      normally place your dialplan logic to perform transfers. We’re going to
      use the <code class="literal">LocalSets</code> context,<a id="I_indexterm13_d1e29084" class="indexterm"></a><a id="I_indexterm13_d1e29087" class="indexterm"></a> which we’ve previously enabled as the starting context
      for our devices:</p><a id="ACD_id36004378"></a><pre class="programlisting">[LocalSets]
include =&gt; Queue  ; allow direct transfer of calls to queues

[Queues]
exten =&gt; 7000,1,Verbose(2,Entering the support queue)
   same =&gt; n,Queue(support)             ; standard support queue available
                                        ; at extension 7000
   same =&gt; n,VoiceMail(7000@queues,u)   ; if there are no members in the queue, 
                                        ; we exit and send the caller to voicemail
   same =&gt; n,Hangup()

exten =&gt; 8000,1,Verbose(2,Entering the priority support queue)
   same =&gt; n,Queue(support-priority)    ; priority queue available at 
                                        ; extension 8000
   same =&gt; n,VoiceMail(7000@queues,u)   ; if there are no members in the queue, 
                                        ; we exit and send the caller to voicemail
   same =&gt; n,Hangup()</pre><p><a id="ACD_id36004381"></a>There you have it: two queues defined with
      different weights. We’ve configured our standard queues to start at
      extension <code class="literal">7000</code>, and our priority
      queues to start at <code class="literal">8000</code>. We can
      mirror this for several queues by simply matching between the <code class="literal">7XXX</code> and <code class="literal">8XXX</code> ranges. So, for example, if we have our
      <code class="literal">sales</code> queue at extension <code class="literal">7004</code>, our <code class="literal">priority-sales</code> queue (for returning customers,
      perhaps?) could be placed in the mirrored queue at <code class="literal">8004</code>, which has a higher weight.</p><p><a id="ACD_id36004384"></a>The only other configuration left to do is to
      make sure some or all of your queue members are placed in both queues.
      If you have more callers in your <code class="literal">7XXXX</code> queues, you may want to have more queue
      members logged into that queue, with a percentage of your queue members
      logged into both queues. Exactly how you wish to configure your queues
      will depend on your local policy and circumstances.</p></div><div class="sect2" title="Queue Member Priority"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288954"></a>Queue Member Priority</h3></div></div></div><p><a id="ACD_id288960"></a><a id="I_indexterm13_d1e29131" class="indexterm"></a><a id="I_indexterm13_d1e29136" class="indexterm"></a>Within a queue, we can <span class="emphasis"><em>penalize</em></span>
      members <a id="I_indexterm13_d1e29143" class="indexterm"></a><a id="I_indexterm13_d1e29146" class="indexterm"></a>in order to lower their preference for being called when
      there are people waiting in a particular queue. For example, we may
      penalize queue members when we want them to be a member of a queue, but
      to be used only when the queue gets full enough that all our preferred
      agents are unavailable. This means we can have three queues (say,
      <code class="literal">support</code>, <code class="literal">sales</code>, and <code class="literal">billing</code>), each containing the same three queue
      members: James Shaw, Kay Madsen, and Danielle Roberts.</p><p><a id="ACD_id36004419"></a>Suppose, however, that we want James Shaw to
      be the preferred contact in the <code class="literal">support</code> queue, Kay Madsen preferred in
      <code class="literal">sales</code>, and Danielle Roberts preferred
      in <code class="literal">billing</code>. By
      penalizing Kay Madsen and Danielle Roberts in <code class="literal">support</code>, we ensure that James Shaw will be the
      preferred queue member called. Similarly, we can penalize James Shaw and
      Danielle Roberts in the <code class="literal">sales</code> queue
      so Kay Madsen is preferred, and penalize James Shaw and Kay Madsen in
      the <code class="literal">billing</code> queue so Danielle Roberts
      is preferred.</p><p><a id="ACD_id36004426"></a>Penalizing queue members can be done either in
      the <code class="filename">queues.conf</code> file, if you’re
      specifying queue members statically, or through the <code class="literal">AddQueueMember()</code> dialplan application. Let’s
      look at how our queues would be set up with static members in <code class="filename">queues.conf</code>. We’ll be using the <code class="literal">StandardQueue</code> template we defined earlier in
      this chapter:</p><a id="ACD_id36004445"></a><pre class="programlisting">[support](StandardQueue)
member =&gt; SIP/0000FFFF0001,0,James Shaw         ; preferred
member =&gt; SIP/0000FFFF0002,10,Kay Madsen        ; second preferred
member =&gt; SIP/0000FFFF0003,20,Danielle Roberts  ; least preferred

[sales](StandardQueue)
member =&gt; SIP/0000FFFF0002,0,Kay Madsen
member =&gt; SIP/0000FFFF0003,10,Danielle Roberts
member =&gt; SIP/0000FFFF0001,20,James Shaw

[billing](StandardQueue)
member =&gt; SIP/0000FFFF0003,0,Danielle Roberts
member =&gt; SIP/0000FFFF0001,10,James Shaw
member =&gt; SIP/0000FFFF0002,20,Kay Madsen</pre><p><a id="ACD_id36004449"></a>By defining different penalties for each
      member of the queue, we can help control the preference for where
      callers are delivered, but still ensure that other queue members will be
      available to answer calls if the preferred member is unavailable.
      Penalties can also be defined using <code class="literal">AddQueueMember()</code>, as the following example
      demonstrates:</p><p><a id="ACD_id36004463"></a><a id="ACD_id36004464"></a></p><pre class="programlisting">exten =&gt; *54,1,Verbose(2,Logging In Queue Member)
   same =&gt; n,Set(MemberChannel=${CHANNEL(channeltype)}/${CHANNEL(peername)})

; *CLI&gt; database put queue support/0000FFFF0001/penalty 0
   same =&gt; n,Set(QueuePenalty=${DB(queue/support/${CHANNEL(peername)}/penalty)})

; *CLI&gt; database put queue support/0000FFFF0001/membername "James Shaw"
   same =&gt; n,Set(MemberName=${DB(queue/support/${CHANNEL(peername)}/membername)})

; AddQueueMember(queuename[,interface[,penalty[,options[,membername
; [,stateinterface]]]]])
   same =&gt; n,AddQueueMember(support,${MemberChannel},${QueuePenalty},,${MemberName})
</pre><p>Using <code class="literal">AddQueueMember()</code><a id="I_indexterm13_d1e29210" class="indexterm"></a><a id="I_indexterm13_d1e29213" class="indexterm"></a>, we’ve shown how you could retrieve the penalty
      associated with a given member name for a particular queue and assign
      that value to the member when she logs into the queue. Some additional
      abstraction would need to be done to make this work for multiple queues;
      for more information see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288626" title="Automatically Logging Into and Out of Multiple Queues">the section called “Automatically Logging Into and Out of Multiple Queues”</a>.</p></div><div class="sect2" title="Changing Penalties Dynamically (queuerules.conf)"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id36004485"></a>Changing Penalties Dynamically (queuerules.conf)</h3></div></div></div><p><a id="ACD_id36004494"></a><a id="I_indexterm13_d1e29225" class="indexterm"></a><a id="I_indexterm13_d1e29230" class="indexterm"></a><a id="I_indexterm13_d1e29233" class="indexterm"></a><a id="I_indexterm13_d1e29236" class="indexterm"></a>Using the <code class="filename">queuerules.conf</code> file, it is possible to
      specify rules to change the values of the <code class="literal">QUEUE_MIN_PENALTY</code><a id="I_indexterm13_d1e29247" class="indexterm"></a> and <code class="literal">QUEUE_MAX_PENALTY</code><a id="I_indexterm13_d1e29254" class="indexterm"></a> channel variables. The <code class="literal">QUEUE_MIN_PENALTY</code> and <code class="literal">QUEUE_MAX_PENALTY</code> channel variables are used
      to control which members of a queue are to be used for servicing
      callers. Let’s say we have a queue called <code class="literal">support</code>, and we have five queue members with
      various penalties ranging from <code class="literal">1</code>
      through <code class="literal">5</code>. If prior to a caller
      entering the queue the <code class="literal">QUEUE_MIN_PENALTY</code> channel variable is set to a
      value of <code class="literal">2</code> and the <code class="literal">QUEUE_MAX_PENALTY</code> is set to a value of
      <code class="literal">4</code>, only queue members whose penalties
      are set to values ranging from <code class="literal">2</code>
      through <code class="literal">4</code> will be considered
      available to answer that call:</p><a id="ACD_id36004523"></a><pre class="programlisting">[Queues]
exten =&gt; 7000,1,Verbose(2,Entering the support queue)
   same =&gt; n,Set(QUEUE_MIN_PENALTY=2)   ; set minimum queue member penalty to be used
   same =&gt; n,Set(QUEUE_MAX_PENALTY=4)   ; set maximum queue member penalty we'll use
   same =&gt; n,Queue(support)             ; entering the queue with minimum and maximum 
                                        ; member penalties to be used</pre><p><a id="ACD_id36004533"></a>What’s more, during the caller’s stay in the
      queue, we can dynamically change the values of <code class="literal">QUEUE_MIN_PENALTY</code> and <code class="literal">QUEUE_MAX_PENALTY</code> for that caller. This allows
      either more or a different set of queue members to be used, depending on
      how long the caller waits in the queue. For instance, in the previous
      example, we could modify the minimum penalty to <code class="literal">1</code> and the maximum penalty to <code class="literal">5</code> if the caller has to wait more than 60
      seconds in the queue.</p><p><a id="ACD_id36004546"></a>The rules are defined using the <code class="filename">queuerules.conf</code> file. Multiple rules can be
      created in order to facilitate different penalty changes throughout the
      call. Let’s take a look at how we’d define the changes described in the
      previous paragraph:</p><p><a id="ACD_id36004568"></a><a id="ACD_id36004569"></a></p><pre class="programlisting">[more_members]
penaltychange =&gt; 60,5,1</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ACD_id36004557"></a>If you make changes to the <code class="filename">queuerules.conf</code> file and reload <code class="filename">app_queue.so</code>, the new rules will affect
          only new callers in the queue, not existing callers.</p></div><p>We’ve defined the rule <code class="literal">more_members</code> in <code class="filename">queuerules.conf</code> and passed the following
      values to <code class="literal">penaltychange:</code> <code class="literal">60</code> is the number of seconds to wait before
      changing the penalty values, <code class="literal">5</code> is the
      new <code class="literal">QUEUE_MAX_PENALTY</code>, and <code class="literal">1</code> is the new <code class="literal">QUEUE_MIN_PENALTY</code>. With our new rule defined,
      we must reload <code class="filename">app_queue.so</code> to make
      it available to us for use:</p><p><a id="ACD_id36004590"></a><a id="ACD_id36004592"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>module reload app_queue.so</code></strong>
    -- Reloading module 'app_queue.so' (True Call Queueing)
  == Parsing '/etc/asterisk/queuerules.conf':   == Found</pre><p>We can also
      verify our rules at the console with <span class="command"><strong>queue show
      rules</strong></span>:</p><p><a id="ACD_id36004604"></a><a id="ACD_id36004605"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue show rules</code></strong>
Rule: more_members
   After 60 seconds, adjust QUEUE_MAX_PENALTY to 5 and adjust QUEUE_MIN_PENALTY to 1</pre><p>With our rule now loaded into memory, we can modify our dialplan
      to make use of it. Just modify the <code class="literal">Queue()</code> line to include the new rule, like
      so:</p><a id="ACD_id36004617"></a><pre class="programlisting">[Queues]
exten =&gt; 7000,1,Verbose(2,Entering the support queue)
   same =&gt; n,Set(QUEUE_MIN_PENALTY=2)   ; set minimum queue member penalty
   same =&gt; n,Set(QUEUE_MAX_PENALTY=4)   ; set maximum queue member penalty

; Queue(queuename[,options[,URL[,announceoverride[,timeout[,AGI[,macro
; [,gosub[,rule[,position]]]]]]]]])
   same =&gt; n,Queue(support<strong class="userinput"><code>,,,,,,,,more_members</code></strong>)  ; entering queue with minimum and 
                                                 ; maximum member penalties</pre><p><a id="ACD_id36004633"></a>The <code class="filename">queuerules.conf</code> file is quite flexible. We
      can define our rule using relative instead of absolute penalty values,
      and we can define multiple rules:</p><a id="ACD_id36004641"></a><pre class="programlisting">[more_members]
penaltychange =&gt; 30,+1
penaltychange =&gt; 45,,-1
penaltychange =&gt; 60,+1
penaltychange =&gt; 120,+2</pre><p><a id="ACD_id36004644"></a>Here, we’ve modified our <code class="literal">more_members</code> rule to use relative values.
      After 30 seconds, we increase the maximum penalty by <code class="literal">1</code> (which would take us to <code class="literal">5</code> using our sample <span class="keep-together">dial</span><span><span class="keep-together">plan</span></span>). After 45 seconds, we
      decrease the minimum penalty by <code class="literal">1</code>,
      and so on. We can verify our new rule changes after a <span class="command"><strong>module reload app_queue.so</strong></span> <a id="I_indexterm13_d1e29413" class="indexterm"></a><a id="I_indexterm13_d1e29416" class="indexterm"></a>at the Asterisk console:</p><a id="ACD_id36004656"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>queue show rules</code></strong>
Rule: more_members
  After 30 seconds, adjust QUEUE_MAX_PENALTY by 1 and adjust QUEUE_MIN_PENALTY by 0
  After 45 seconds, adjust QUEUE_MAX_PENALTY by 0 and adjust QUEUE_MIN_PENALTY by -1
  After 60 seconds, adjust QUEUE_MAX_PENALTY by 1 and adjust QUEUE_MIN_PENALTY by 0
  After 120 seconds, adjust QUEUE_MAX_PENALTY by 2 and adjust QUEUE_MIN_PENALTY by 0</pre></div><div class="sect2" title="Announcement Control"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id36004667"></a>Announcement Control</h3></div></div></div><p><a id="ACD_id36004672"></a><a id="index-770V481MB7U" class="indexterm"></a><a id="index-310F140HI4C" class="indexterm"></a>Asterisk has the ability to play several announcements to
      callers waiting in the queue. For example, you might want to announce
      the caller’s position in the queue, the average wait time, or make
      periodic announcements thanking your callers for waiting (or whatever
      your audio files say). It’s important to tune the values that control
      when these announcements are played to the callers, because announcing
      their position, thanking them for waiting, and telling them the average
      hold time too often may annoy them, causing them to either hang up or
      take it out on your agents.</p><p><a id="ACD_id36004681"></a>There are several options in the <code class="filename">queues.conf</code> file that you can use to
      fine-tune what and when announcements are played to your callers. The
      full list of queue options is available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901" title="The queues.conf File">the section called “The queues.conf File”</a>, but we’ll review the relevant ones
      here.</p><p><a id="ACD_id36004692"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_prompt_control_timing_id001" title="Table 13.5. Options related to prompt control timing within a queue">Table&nbsp;13.5, “Options related to prompt control timing within a queue”</a> lists the options you
      can use to control when announcements are played to the caller.</p><div class="table"><a id="options_prompt_control_timing_id001"></a><p class="title"><strong>Table&nbsp;13.5.&nbsp;Options related to prompt control timing within a queue</strong></p><div class="table-contents"><table summary="Options related to prompt control timing within a queue" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center">Available values</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">announce-frequency</code></td><td><a id="I_indexterm13_d1e29468" class="indexterm"></a>Value in <span class="keep-together">seconds</span></td><td>Defines how often we should announce the caller’s
              position and/or estimated hold time in the queue. Set this value
              to zero to disable.</td></tr><tr><td><code class="literal">min-announce-</code> <code class="literal">frequency</code></td><td><a id="I_indexterm13_d1e29483" class="indexterm"></a>Value in <span class="keep-together">seconds</span></td><td>Indicates the minimum amount of time that must pass
              before we announce the caller’s position in the queue again.
              This is used when the caller’s position may change frequently,
              to prevent the caller hearing multiple updates in a short period
              of time.</td></tr><tr><td><code class="literal">periodic</code> <code class="literal">-</code> <code class="literal">announce</code> <code class="literal">-</code> <code class="literal">frequency</code></td><td><a id="I_indexterm13_d1e29504" class="indexterm"></a>Value in <span class="keep-together">seconds</span></td><td>Specifies how often we should make periodic announcements
              to the caller.</td></tr><tr><td><code class="literal">random-periodic-announce</code></td><td><code class="literal"><a id="I_indexterm13_d1e29518" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, will
              play the defined periodic announcements in a random order. See
              <code class="literal">periodic-announce</code>.</td></tr><tr><td><code class="literal">relative-periodic-announce</code></td><td><code class="literal"><a id="I_indexterm13_d1e29539" class="indexterm"></a>yes</code>, <code class="literal">no</code></td><td>If set to <code class="literal">yes</code>, the
              <code class="literal">periodic-announce-frequency</code>
              timer will start from when the end of the file being played back
              is reached, instead of from the beginning. Defaults to <code class="literal">no</code>.</td></tr><tr><td><code class="literal">announce-holdtime</code></td><td><code class="literal"><a id="I_indexterm13_d1e29563" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">once</code></td><td>Defines whether the estimated hold time should be played
              along with the periodic announcements. Can be set to <code class="literal">yes</code>, <code class="literal">no</code>, or only <code class="literal">once</code>.</td></tr><tr><td><code class="literal">announce-position</code></td><td><code class="literal"><a id="I_indexterm13_d1e29590" class="indexterm"></a>yes</code>, <code class="literal">no</code>, <code class="literal">limit</code>, <code class="literal">more</code></td><td>Defines whether the caller’s position in the queue should
              be announced to her. If set to <code class="literal">no</code>, the position will never be
              announced. If set to <code class="literal">yes</code>, the
              caller’s position will always be announced. If the value is set
              to <code class="literal">limit</code>, the caller will
              hear her position in the queue only if it is within the limit
              defined by <code class="literal">announce-position-limit</code>. If the value
              is set to <code class="literal">more</code>, the caller
              will hear her position only if it is beyond the number defined
              by <code class="literal">announce-position-limit</code>.</td></tr><tr><td><code class="literal">announce-position-limit</code></td><td><a id="I_indexterm13_d1e29629" class="indexterm"></a>Number of zero or greater</td><td>Used if you’ve defined <code class="literal">announce-position</code> as either <code class="literal">limit</code> or <code class="literal">more</code>.</td></tr><tr><td><code class="literal">announce-round-seconds</code></td><td><a id="I_indexterm13_d1e29649" class="indexterm"></a>Value in <span class="keep-together">seconds</span></td><td>If this value is nonzero, we’ll announce the number of
              seconds as well, and round them to the value defined.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ACD_id36004906"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_controlling_playback_prompts" title="Table 13.6. Options for controlling the playback of prompts within a queue">Table&nbsp;13.6, “Options for controlling the playback of prompts within a queue”</a> shows what files will
      be used when announcements are played to the caller.</p><div class="table"><a id="options_controlling_playback_prompts"></a><p class="title"><strong>Table&nbsp;13.6.&nbsp;Options for controlling the playback <a id="I_indexterm13_d1e29663" class="indexterm"></a><a id="I_indexterm13_d1e29666" class="indexterm"></a>of prompts within a queue</strong></p><div class="table-contents"><table summary="Options for controlling the playback playback, prompts within a queuepromptsplayback with a queueof prompts within a queue" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Options</th><th align="center">Available values</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">musicclass</code></td><td><a id="I_indexterm13_d1e29687" class="indexterm"></a>Music class as defined by <code class="filename">musiconhold.conf</code></td><td>Sets the music class to be used by a particular queue.
              You can also override this value with the <code class="literal">CHANNEL(musicclass)</code> channel <span class="keep-together">variable</span>.</td></tr><tr><td><code class="literal">queue-thankyou</code></td><td><a id="I_indexterm13_d1e29706" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“Thank you
              for your patience”). If set to an empty value, the prompt will
              not be played at all.</td></tr><tr><td><code class="literal">queue-youarenext</code></td><td><a id="I_indexterm13_d1e29717" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“You are now
              first in line”). If set to an empty value, the prompt will not
              be played at all.</td></tr><tr><td><code class="literal">queue-thereare</code></td><td><a id="I_indexterm13_d1e29728" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“There
              are”). If set to an empty value, the prompt will not be played
              at all.</td></tr><tr><td><code class="literal">queue</code> <code class="literal">-</code> <code class="literal">calls</code> <code class="literal">waiting</code></td><td><a id="I_indexterm13_d1e29745" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“calls
              waiting”). If set to an empty value, the prompt will not be
              played at all.</td></tr><tr><td><code class="literal">queue-holdtime</code></td><td><a id="I_indexterm13_d1e29756" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“The current
              estimated hold time is”). If set to an empty value, the prompt
              will not be played at all.</td></tr><tr><td><code class="literal">queue-minutes</code></td><td><a id="I_indexterm13_d1e29767" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“minutes”).
              If set to an empty value, the prompt will not be played at
              all.</td></tr><tr><td><code class="literal">queue-seconds</code></td><td><a id="I_indexterm13_d1e29778" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“seconds”).
              If set to an empty value, the prompt will not be played at
              all.</td></tr><tr><td><code class="literal">queue-reporthold</code></td><td><a id="I_indexterm13_d1e29789" class="indexterm"></a>Filename of prompt to play</td><td>If not defined, will play the default value (“Hold
              time”). If set to an empty value, the prompt will not be played
              at all.</td></tr><tr><td><code class="literal">periodic-announce</code></td><td><a id="I_indexterm13_d1e29800" class="indexterm"></a>A set of periodic announcements to be played,
              separated by commas</td><td>Prompts are played in the order they are defined.
              Defaults to <code class="literal">queue-periodic-announce</code> (“All
              representatives are currently busy assisting other callers.
              Please wait for the next available representative”).</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ACD_id36005095"></a>If the number of options devoted to playing
      announcements to callers is any indication of their importance, it’s
      probably in our best interest to use them to their fullest potential.
      The options in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_prompt_control_timing_id001" title="Table 13.5. Options related to prompt control timing within a queue">Table&nbsp;13.5, “Options related to prompt control timing within a queue”</a>
      help us define when we’ll play announcements to callers, and the options
      in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_controlling_playback_prompts" title="Table 13.6. Options for controlling the playback of prompts within a queue">Table&nbsp;13.6, “Options for controlling the playback of prompts within a queue”</a> help us
      control what we play to our callers. With those tables in hand, let’s
      take a look at an example queue where we’ve defined some values. We’ll
      use our basic queue template as a starting point:</p><p><a id="ACD_id36005103"></a><a id="ACD_id36005104"></a></p><pre class="programlisting">[general]
autofill=yes             ; distribute all waiting callers to available members
shared_lastcall=yes      ; respect the wrapup time for members logged into more 
                         ; than one queue

[StandardQueue](!)       ; template to provide common features
musicclass=default       ; play [default] music
strategy=rrmemory        ; use the Round Robin Memory strategy
joinempty=yes            ; do not join the queue when no members available
leavewhenempty=no        ; leave the queue when no members available
ringinuse=no             ; don't ring members when already InUse (prevents 
                         ; multiple calls to an agent)

[sales](StandardQueue)   ; create the sales queue using the parameters in the
                         ; StandardQueue template

[support](StandardQueue) ; create the support queue using the parameters in the
                         ; StandardQueue template
</pre><p>We’ll now modify the <code class="literal">StardardQueue</code> template to control our
      announcements:</p><a id="ACD_id36005118"></a><pre class="programlisting">[StandardQueue](!)       ; template to provide common features
musicclass=default       ; play [default] music
strategy=rrmemory        ; use the Round Robin Memory strategy
joinempty=yes            ; do not join the queue when no members available
leavewhenempty=no        ; leave the queue when no members available
ringinuse=no             ; don't ring members when already InUse (prevents 
                         ; multiple calls to an agent)

; -------- Announcement Control --------
announce-frequency=30           ; announces caller's hold time and position every 30
                                ; seconds
min-announce-frequency=30       ; minimum amount of time that must pass before the
                                ; caller's position is announced 
periodic-announce-frequency=45  ; defines how often to play a periodic announcement to
                                ; caller
random-periodic-announce=no     ; defines whether to play periodic announcements in 
                                ; a random order, or serially
relative-periodic-announce=yes  ; defines whether the timer starts at the end of
                                ; file playback (yes) or the beginning (no)
announce-holdtime=once          ; defines whether the estimated hold time should be 
                                ; played along with the periodic announcement
announce-position=limit         ; defines if we should announce the caller's position
                                ; in the queue
announce-position-limit=10      ; defines the limit value where we announce the
                                ; caller's position (when announce-position is set to 
                                ; limit or more)
announce-round-seconds=30       ; rounds the hold time announcement to the nearest 
                                ; 30-second value</pre><p><a id="ACD_id36005121"></a>Let’s describe what we’ve just set in our
      <code class="literal">StandardQueue</code> template.</p><p><a id="ACD_id36005128"></a>We’ll announce the caller’s hold time and
      position every 30 seconds (<code class="literal">announce</code><code class="literal">-</code><code class="literal">frequency</code>),<sup>[<a id="id590291" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id590291" class="footnote">129</a>]</sup> and make sure the minimum amount of time that passes
      before we announce it again is at least 30 seconds (<code class="literal">min-announce-frequency</code>). We do this to limit
      how often our announcements are played to the callers, in order to avoid
      the updates becoming annoying. Periodically, we’ll play an announcement
      to the callers that thanks them for holding and assures them that an
      agent will be with them shortly. (The announcement is defined by the
      <code class="literal">periodic-announcement</code> setting. We’re
      using the default announcement, but you can define one or more
      announcements yourself using <code class="literal">periodic</code><code class="literal">-</code><code class="literal">announce</code>.)</p><p><a id="ACD_id36005157"></a>These periodic announcements will be played
      every 45 seconds (<code class="literal">periodic-announce-frequency</code>), in the order
      they were defined (<code class="literal">random-period-announce</code>). To determine when the
      <code class="literal">periodic-announce-frequency</code> timer
      should start, we use <code class="literal">relative-periodic-announce</code>. The <code class="literal">yes</code> setting means the timer will start after
      the announcement has finished playing, rather than when it starts to
      play. The problem you could run into if you set this to <code class="literal">no</code> is that if your periodic announcement runs
      for any significant length of time (lets say 30 seconds), it will appear
      as if it is being played every 15 seconds, rather than every 45 seconds
      as may be intended.</p><p><a id="ACD_id36005182"></a>How many times we announce the hold time to
      the caller is controlled via the <code class="literal">announce-holdtime</code> option, which we’ve set to
      <code class="literal">once</code>. Setting the value to <code class="literal">yes</code> will announce it every time, and setting
      to <code class="literal">no</code> will disable it.</p><p><a id="ACD_id36005200"></a>We configure how and when we announce the
      caller’s estimated remaining hold time via <code class="literal">announce-position</code>, which we’ve set to <code class="literal">limit</code>. Using the value of <code class="literal">limit</code> for <code class="literal">announce-position</code> lets us announce the
      caller’s position only if it is within the limit defined by <code class="literal">announce-position-limit</code>. So, in this case
      we’re only announcing the callers’ positions if they are in the first 10
      positions of the queue. We could also use <code class="literal">yes</code> to announce the position every time the
      periodic announcement is played, set it to <code class="literal">no</code> to never announce it, or use the value
      <code class="literal">more</code> if we want to announce the
      position only when it is greater than the value set for <code class="literal">announce-position-limit</code>.</p><p><a id="ACD_id36005239"></a>Our last option, <code class="literal">announce-round-seconds</code>, controls the value to
      round to when we announce the caller’s hold time. In this case, instead
      of saying “1 minute and 23 seconds,” the value would be rounded to the
      nearest 30-second value, which would result in a prompt of “1 minute and
      30 seconds.”<a id="I_indexterm13_d1e29927" class="indexterm"></a><a id="I_indexterm13_d1e29928" class="indexterm"></a></p></div><div class="sect2" title="Overflow"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288963"></a>Overflow</h3></div></div></div><p><a id="ACD_id288968"></a><a id="I_indexterm13_d1e29933" class="indexterm"></a><a id="I_indexterm13_d1e29938" class="indexterm"></a>Overflowing out of the queue is done either with a timeout
      value, or when no queue members are available (as defined by <code class="literal">joinempty</code> or <code class="literal">leavewhenempty</code>). In this section we’ll discuss
      how to control when overflow happens.</p><div class="sect3" title="Controlling timeouts"><div class="titlepage"><div><div><h4 class="title"><a id="ACD_id36005269"></a>Controlling timeouts</h4></div></div></div><p><a id="ACD_id36005275"></a><a id="I_indexterm13_d1e29952" class="indexterm"></a>The <code class="literal">Queue()</code>
        application <a id="I_indexterm13_d1e29961" class="indexterm"></a><a id="I_indexterm13_d1e29964" class="indexterm"></a>supports two kinds of timeout: one is for the maximum
        period of time a caller stays in the queue, and the other is how long
        to ring a device when attempting to connect a caller to a queue
        member. We’ll be talking about the maximum period of time a caller
        stays in the queue before the call overflows to another location, such
        as <code class="literal">VoiceMail()</code>. Once the call has
        fallen out of the queue, it can go anywhere that a call could normally
        go when controlled by the dialplan.</p><p><a id="ACD_id36005289"></a>The timeouts <a id="I_indexterm13_d1e29975" class="indexterm"></a>are specified in two locations. The timeout that
        indicates how long to ring queue members for is specified in the
        <code class="filename">queues.conf</code> file. The absolute
        timeout (how long the caller stays in the queue) is controlled via the
        <code class="literal">Queue()</code> application.<a id="I_indexterm13_d1e29987" class="indexterm"></a><a id="I_indexterm13_d1e29990" class="indexterm"></a> To set a maximum amount of time for callers to stay in
        a queue, simply specify it after the queue name in the <code class="literal">Queue()</code> application:</p><p><a id="ACD_id36005306"></a><a id="ACD_id36005307"></a></p><pre class="programlisting">[Queues]
exten =&gt; 7000,1,Verbose(2,Joining the support queue for a maximum of 2 minutes)
   same =&gt; n,Queue(support,<strong class="userinput"><code>120</code></strong>)
   same =&gt; n,VoiceMail(support@queues,u)
   same =&gt; n,Hangup()</pre><p>Of course, we could define a
        different destination, but the <code class="literal">VoiceMail()</code> application <a id="I_indexterm13_d1e30009" class="indexterm"></a><a id="I_indexterm13_d1e30012" class="indexterm"></a>is as good as any. Just make sure that if you’re going
        to send callers to voicemail someone checks it regularly and calls
        your customers back.</p><p><a id="ACD_id36005323"></a>Now let’s say we have the scenario where we
        have set our absolute timeout to 10 seconds, our timeout value for
        ringing queue members to 5 seconds, and our retry timeout value to 4
        seconds. In this scenario, we would ring the queue member for 5
        seconds, then wait 4 seconds before attempting another queue member.
        That brings us up to <span class="keep-together">9 seconds</span>
        of our absolute timeout of 10 seconds. At this point, should we ring
        the second queue member for 1 second and then exit the queue, or
        should we ring this member for the full 5 seconds before
        exiting?</p><p><a id="ACD_id36005332"></a>We control which timeout value has priority
        with the <code class="literal">timeoutpriority</code> option
        <a id="I_indexterm13_d1e30028" class="indexterm"></a>in <code class="filename">queues.conf</code>. The
        available values are <code class="literal">app</code> and
        <code class="literal">conf</code>. If we want the application
        timeout (the absolute timeout) to take priority, which would cause our
        caller to be kicked out after exactly 10 seconds, we should set the
        <code class="literal">timeoutpriority</code> value to <code class="literal">app</code>. If we want the configuration file
        timeout to take priority and finish ringing the queue member, which
        will cause the caller to stay in the queue a little longer, we should
        set <code class="literal">timeoutpriority</code> to <code class="literal">conf</code>. The default value is <code class="literal">app</code> (which is the default behavior in
        previous versions of Asterisk).</p></div><div class="sect3" title="Controlling when to join and leave a queue"><div class="titlepage"><div><div><h4 class="title"><a id="ACD_id36005370"></a>Controlling when to join and leave a queue</h4></div></div></div><p><a id="ACD_id36005375"></a><a id="I_indexterm13_d1e30061" class="indexterm"></a><a id="I_indexterm13_d1e30064" class="indexterm"></a>Asterisk provides two options that control when callers
        can join and are forced to leave queues, based on the statuses of the
        queue members. The first option, <code class="literal">joinempty</code><a id="I_indexterm13_d1e30070" class="indexterm"></a>, is used to control whether callers can enter a queue.
        The <code class="literal">leavewhenempty</code> option
        <a id="I_indexterm13_d1e30077" class="indexterm"></a>is used to control when callers already in a queue
        should be removed from that queue (i.e., if all of the queue members
        become unavailable). Both options take a comma-separated list of
        values that control this behavior. The factors are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_joinempty" title="Table 13.7. Options that can be set for joinempty or leavewhenempty">Table&nbsp;13.7, “Options that can be set for joinempty or
          leavewhenempty”</a>.</p><div class="table"><a id="options_joinempty"></a><p class="title"><strong>Table&nbsp;13.7.&nbsp;Options that can be set for joinempty or
          leavewhenempty</strong></p><div class="table-contents"><table summary="Options that can be set for joinempty or
          leavewhenempty" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Value</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">paused</code></td><td>Members are considered unavailable if they are
                paused.</td></tr><tr><td><code class="literal">penalty</code></td><td>Members are considered unavailable if their penalties
                are less than <code class="literal">QUEUE_MAX_PENALTY</code>.</td></tr><tr><td><code class="literal">inuse</code></td><td>Members are considered unavailable if their device
                status is <code class="literal">In Use</code>.</td></tr><tr><td><code class="literal">ringing</code></td><td>Members are considered unavailable if their device
                status is <code class="literal">Ringing</code>.</td></tr><tr><td><code class="literal">unavailable</code></td><td>Applies primarily to agent channels; if the agent is
                not logged in but is a member of the queue it is considered
                unavailable.</td></tr><tr><td><code class="literal">invalid</code></td><td>Members are considered unavailable if their device
                status is <code class="literal">Invalid</code>. This is
                typically an error condition.</td></tr><tr><td><code class="literal">unknown</code></td><td>Members are considered unavailable if device status is
                unknown.</td></tr><tr><td><code class="literal">wrapup</code></td><td>Members are considered unavailable if they are
                currently in the wrapup time after the completion of a
                call.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ACD_id36005508"></a>For <code class="literal">joinempty</code>, prior to placing a caller into
        the queue, all the members are checked for availability using the
        factors you list as criteria. If all members are deemed to be
        unavailable, the caller will not be permitted to enter the queue, and
        dialplan execution will continue at the next priority.<sup>[<a id="id591183" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id591183" class="footnote">130</a>]</sup> For the <code class="literal">leavewhempty</code>
        option, the members’ statuses are checked periodically against the
        listed conditions; if it is determined that no <span class="keep-together">members</span> are available to take calls, the
        caller is removed from the queue, with dialplan execution continuing
        at the next priority.</p><p><a id="ACD_id36005534"></a>An example use of <code class="literal">joinempty</code> could be:</p><p><a id="ACD_id36005541"></a><a id="ACD_id36005542"></a></p><pre class="programlisting">joinempty=paused,inuse,invalid</pre><p>With
        this configuration, prior to a caller entering the queue the statuses
        of all queue members will be checked, and the caller will not be
        permitted to enter the queue unless at least one queue member is found
        to have a status that is not <code class="literal">paused</code>, <code class="literal">inuse</code>, or <code class="literal">invalid</code>.</p><p><a id="ACD_id36005548"></a>The <code class="literal">leavewhenempty</code> example could be something
        like:</p><p><a id="ACD_id36005554"></a><a id="ACD_id36005556"></a></p><pre class="programlisting">leavewhenempty=inuse,ringing</pre><p>In
        this case, the queue members’ statuses will be checked periodically,
        and callers will be removed from the queue if no queue members can be
        found who do not have a status of either <code class="literal">inuse</code> or <code class="literal">ringing</code>.</p><p><a id="ACD_id36005568"></a>Previous versions of Asterisk used the
        values <code class="literal">yes</code>, <code class="literal">no</code>, <code class="literal">strict</code>, and <code class="literal">loose</code> as the available values to be
        assigned. The mapping of those values is shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#mapping_old_new_id001" title="Table 13.8. Mapping between old and new values for controlling when callers join and leave queues">Table&nbsp;13.8, “Mapping between old and new values for controlling when
          callers join and leave queues”</a>.</p><div class="table"><a id="mapping_old_new_id001"></a><p class="title"><strong>Table&nbsp;13.8.&nbsp;Mapping between old and new values for controlling when
          callers join and leave queues</strong></p><div class="table-contents"><table summary="Mapping between old and new values for controlling when
          callers join and leave queues" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Value</th><th align="center">Mapping (joinempty)</th><th align="center">Mapping (leavewhenempty)</th></tr></thead><tbody><tr><td><code class="literal">yes</code></td><td>(empty)</td><td>penalty,paused,invalid</td></tr><tr><td><code class="literal">no</code></td><td>penalty,paused,invalid</td><td>(empty)</td></tr><tr><td><code class="literal">strict</code></td><td>penalty,paused,invalid,unavailable</td><td>penalty,paused,invalid,unavailable</td></tr><tr><td><code class="literal">loose</code></td><td>penalty,invalid</td><td>penalty,invalid</td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect2" title="Using Local Channels"><div class="titlepage"><div><div><h3 class="title"><a id="ACD_id288989"></a>Using Local Channels</h3></div></div></div><p><a id="ACD_id288995"></a><a id="index-773R738DM4E" class="indexterm"></a><a id="index-537I646WI8E" class="indexterm"></a>The use of Local channels as queue members is a popular
      way of executing parts of the dialplan and performing checks prior to
      dialing the actual agent’s device. For example, it allows us to do
      things like start recording the call, set up channel variables, write to
      a log file, set a limit on the call length (e.g., if it is a paid
      service), or do any of the other things we might need to do once we know
      which location we’re going to call.</p><p><a id="ACD_id36005689"></a>When using Local channels for queues, they are
      added just like any other channels. In the <code class="filename">queues.conf</code> file, adding a Local channel
      would look like this:</p><p><a id="ACD_id36005697"></a><a id="ACD_id36005698"></a></p><pre class="programlisting">; queues.conf
[support](StandardQueue)
member =&gt; Local/SIP-0000FFFF0001@MemberConnector  ; pass the technology to dial over
                                                  ; and the device identifier,
                                                  ; separated by a hyphen. We'll
                                                  ; break it apart inside the 
                                                  ; MemberConnector context.</pre><p>
      </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ACD_id36005709"></a>Notice how we passed the type of
          technology we want to call along with the device identifier to the
          <code class="literal">MemberConnector</code> context. We’ve
          simply used a hyphen (although we could have used nearly anything as
          a separator argument) as the field marker. We’ll use the <code class="literal">CUT()</code> function inside the <code class="literal">MemberConnector</code> context and assign the
          first field (<code class="literal">SIP</code>) to one channel
          variable and the second field (<code class="literal">0000FFFF0001</code>) to another channel variable,
          which will then be used to call the endpoint.</p><p><a id="ACD_id36005723"></a>Passing information to be later “exploded”
          in the context used by the Local channel is a common and useful
          <code class="literal">technique</code> (kind of like the
          <code class="literal">explode()</code> function in
          PHP).</p></div><p><a id="ACD_id36005734"></a>Of course, we’ll need the <code class="literal">MemberConnector</code> context to actually connect
      the caller to the agent:</p><p><a id="ACD_id36005741"></a><a id="ACD_id36005742"></a></p><pre class="programlisting">[MemberConnector]
exten =&gt; _[A-Za-z0-9].,1,Verbose(2,Connecting ${CALLERID(all)} to Agent at ${EXTEN})

   ; filter out any bad characters, allowing alphanumeric characters and the hyphen
   same =&gt; n,Set(QueueMember=${FILTER(A-Za-z0-9\-,${EXTEN})

   ; assign the first field of QueueMember to Technology using the hyphen separator
   same =&gt; n,Set(Technology=${CUT(QueueMember,-,1)})

   ; assign the second field of QueueMember to Device using the hyphen separator
   same =&gt; n,Set(Device=${CUT(QueueMember,-,2)})

   ; dial the agent
   same =&gt; n,Dial(${Technology}/${Device})
   same =&gt; n,Hangup()</pre><p>So, now we’ve passed our queue member
      to the context, and we can dial the device. However, because we’re using
      the Local channel as the queue member, the <code class="literal">Queue()</code><a id="I_indexterm13_d1e30326" class="indexterm"></a><a id="I_indexterm13_d1e30329" class="indexterm"></a> won’t necessarily know the state the call is in,
      especially when the Local channel is optimized out of the path (see
      <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/Local+Channel+Modifiers" target="_top">https://wiki.asterisk.org/wiki/display/AST/Local+Channel+Modifiers</a>
      for information about the <code class="literal">/n</code>
      modifier, which causes the Local channel to not be optimized out of the
      path). The queue will be monitoring the state of the Local channel, and
      not that of the device we really want to monitor.</p><p><a id="ACD_id36005764"></a>Luckily, we can give the <code class="literal">Queue()</code> the actual device to monitor and
      associate that with the Local channel, so that the Local channel’s state
      is always that of the device we’ll end up calling. Our queue member
      would be modified in the <code class="filename">queues.conf</code> file like so:</p><p><a id="ACD_id36005775"></a><a id="ACD_id36005776"></a></p><pre class="programlisting">; queues.conf
[support](StandardQueue)
member =&gt; Local/SIP-0000FFFF0001@MemberConnector,,,SIP/0000FFFF0001</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="ACD_id36005784"></a>Only SIP channels <a id="I_indexterm13_d1e30354" class="indexterm"></a><a id="I_indexterm13_d1e30361" class="indexterm"></a><a id="I_indexterm13_d1e30366" class="indexterm"></a>are capable of sending back reliable device state
          information, so it is highly recommended that you use only these
          channels when using Local channels as queue members.</p></div><p>You can also use the <code class="literal">AddQueueMember()</code> <a id="I_indexterm13_d1e30376" class="indexterm"></a><a id="I_indexterm13_d1e30379" class="indexterm"></a>and <code class="literal">RemoveQueueMember()</code>
      applications<a id="I_indexterm13_d1e30388" class="indexterm"></a><a id="I_indexterm13_d1e30392" class="indexterm"></a> to add members to and remove members from a queue, just
      like with any other channel. <code class="literal">AddQueueMember()</code> also has the ability to set
      the state interface, which we defined statically in the <code class="filename">queues.conf</code> file. An example of how you might
      do this follows:</p><p><a id="ACD_id36005803"></a><a id="ACD_id36005804"></a></p><pre class="programlisting">[QueueMemberLogin]
exten =&gt; 500,1,Verbose(2,Logging in device ${CHANNEL(peername)} into the support queue)

   ; Save the device's technology to the MemberTech channel variable
   same =&gt; n,Set(MemberTech=${CHANNEL(channeltype)})
 
   ; Save the device's identifier to the MemberIdent channel variable
   same =&gt; n,Set(MemberIdent=${CHANNEL(peername)})

   ; Build up the interface name and assign it to the Interface channel variable
   same =&gt; n,Set(Interface=${MemberTech}/${MemberIdent})

   ; Add the member to the support queue using a Local channel. We're using the same
   ; format as before, separating the technology and the device indentifier with
   ; a hyphen and passing that information to the MemberConnector context. We then
   ; use the IF() function to determine if the member's technology is SIP and, if so,
   ; to pass back the contents of the Interface channel variable as the value to the
   ; state interface field of the AddQueueMember() application.
   ;
   ; *** This line should not have any line breaks
   same =&gt; n,AddQueueMember(support,Local/${MemberTech}-${MemberIdent}
@MemberConnector,,,${IF($[${MemberTech} = SIP]?${Interface})})
   same =&gt; n,Playback(silence/1)

   ; Play back either the agent-loginok or agent-incorrect file, depending on what
   ; the AQMSTATUS variable is set to.
   same =&gt; n,Playback(${IF($[${AQMSTATUS} = ADDED]?agent-loginok:agent-incorrect)})
   same =&gt; n,Hangup()</pre><p>Now that we can add devices to the
      queue using Local channels, let’s look at how we might control the
      number of calls to either non-SIP channels or devices with more than one
      line on them. We can make use of the <code class="literal">GROUP()</code> and <code class="literal">GROUP_COUNT()</code> functions to track call counts
      to an endpoint. We’ll modify our <code class="literal">MemberConnector</code> context to take this into
      account:</p><p><a id="ACD_id36005821"></a><a id="ACD_id36005822"></a></p><pre class="programlisting">[MemberConnector]
exten =&gt; _[A-Za-z0-9].,1,Verbose(2,Connecting ${CALLERID(all)} to Agent at ${EXTEN})

   ; filter out any bad characters, allowing alphanumeric characters and the hyphen
   same =&gt; n,Set(QueueMember=${FILTER(A-Za-z0-9\-,${EXTEN})

   ; assign the first field of QueueMember to Technology using the hyphen separator
   same =&gt; n,Set(Technology=${CUT(QueueMember,-,1)})

   ; assign the second field of QueueMember to Device using the hyphen separator
   same =&gt; n,Set(Device=${CUT(QueueMember,-,2)})

   ; Increase the value of the group inside the queue_members category by one
   same =&gt; n,Set(GROUP(queue_members)=${Technology}-${Device})

   ; Check if the group@category is greater than 1, and, if so, return Congestion()
   ; (too many channels)
   ;
   ; *** This line should not have any line breaks
   same =&gt; n,ExecIf($[${GROUP_COUNT(${Technology}-${Device}@queue_members)} &gt; 1]
?Congestion())

   ; dial the agent
   same =&gt; n,Dial(${Technology}/${Device})
   same =&gt; n,Hangup()</pre><p>The passing back of <code class="literal">Congestion()</code> will cause the caller to be
      returned to the queue (while this is happening, the caller gets no
      indication that anything is amiss and keeps hearing music until we
      actually connect to the device). While this is not an ideal situation
      because the queue will keep trying the member over and over again (or at
      least include it in the cycle of agents, depending on how many members
      you have and their current statuses), it is better than an agent getting
      multiple calls at the same time.</p><p><a id="ACD_id36005834"></a>We’ve also used this same method to create a
      type of reservation process. If you want to call an agent directly (for
      example, if the caller needs to follow up with a particular agent), you
      could reserve that agent by using the <code class="literal">GROUP()</code> and <code class="literal">GROUP_COUNT()</code> functions to essentially pause
      the agent in the queue until the caller can be connected. This is
      particularly useful in situations where you need to play some
      announcements to the caller prior to connecting her with the agent, but
      you don’t want the agent to get connected to another caller while the
      announcements are being played.<a id="I_indexterm13_d1e30432" class="indexterm"></a><a id="I_indexterm13_d1e30433" class="indexterm"></a></p></div></div><div class="sect1" title="Queue Statistics: The queue_log File"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id289009"></a>Queue Statistics: The queue_log File</h2></div></div></div><p><a id="ACD_id289015"></a><a id="index-256H580TC6P" class="indexterm"></a><a id="index-052J602FC1N" class="indexterm"></a><a id="index-561L263KI5F" class="indexterm"></a>The <code class="filename">queue_log</code> file
    located in <code class="filename">/var/log/asterisk/</code>
    contains information about the queues defined in your system (when a queue
    is reloaded, when queue members are added or removed, etc.) and about
    calls into the queues (e.g., their status and what channels the callers
    were connected to). The queue log is enabled by default, but can be
    controlled via the <code class="filename">logger.conf</code> file.
    There are three options related to the <code class="filename">queue_log</code> file specifically:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">queue_log</code></span></dt><dd><p>Controls whether the queue log is enabled or not. Valid values
          are <code class="literal">yes</code> or <code class="literal">no</code> (defaults to <code class="literal">yes</code>).</p></dd><dt><span class="term"><code class="literal">queue_log_to_file</code></span></dt><dd><p>Controls whether the queue log should be written to a file
          even when a real time backend is present. Valid values are <code class="literal">yes</code> or <code class="literal">no</code> (defaults to <code class="literal">no</code>).</p></dd><dt><span class="term"><code class="literal">queue_log_name</code></span></dt><dd><p>Controls the name of the queue log. The default is <code class="literal">queue_log</code>.</p></dd></dl></div><p><a id="ACD_id36005929"></a>The queue log is a pipe-separated list of
    events. The fields in the <code class="filename">queue_log</code>
    file are as follows:</p><div class="itemizedlist"><a id="ACD_id36005938"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ACD_id36005941"></a><a id="ACD_id36005943"></a>Epoch timestamp of the event</p></li><li class="listitem"><p><a id="ACD_id36005947"></a><a id="ACD_id36005949"></a>Unique ID of the call</p></li><li class="listitem"><p><a id="ACD_id36005953"></a><a id="ACD_id36005956"></a>Name of the queue</p></li><li class="listitem"><p><a id="ACD_id36005960"></a><a id="ACD_id36005962"></a>Name of bridged channel</p></li><li class="listitem"><p><a id="ACD_id36005966"></a><a id="ACD_id36005968"></a>Type of event</p></li><li class="listitem"><p><a id="ACD_id36005973"></a><a id="ACD_id36005975"></a>Zero or more event parameters</p></li></ul></div><p><a id="ACD_id36005980"></a>The information contained in the event
    parameters depends on the type of event. A sample <code class="filename">queue_log</code> file might look something like the
    following:</p><p><a id="ACD_id36005987"></a><a id="ACD_id36005988"></a></p><pre class="programlisting">1292281046|psy1-1292281041.87|7100|NONE|ENTERQUEUE||4165551212|1
1292281046|psy1-1292281041.87|7100|Local/9996@MemberConnector|RINGNOANSWER|0
1292281048|psy1-1292281041.87|7100|Local/9990@MemberConnector|CONNECT|2
|psy1-1292281046.90|0

1292284121|psy1-1292281041.87|7100|Local/9990@MemberConnector|COMPLETECALLER|2|3073|1
1292284222|MANAGER|7100|Local/9990@MemberConnector|REMOVEMEMBER|
1292284222|MANAGER|7200|Local/9990@MemberConnector|REMOVEMEMBER|
1292284491|MANAGER|7100|Local/9990@MemberConnector|ADDMEMBER|
1292284491|MANAGER|7200|Local/9990@MemberConnector|ADDMEMBER|
1292284519|psy1-1292284515.93|7100|NONE|ENTERQUEUE||4165551212|1
1292284519|psy1-1292284515.93|7100|Local/9996@MemberConnector|RINGNOANSWER|0
1292284521|psy1-1292284515.93|7100|Local/9990@MemberConnector|CONNECT|2
|psy1-1292284519.96|0

1292284552|MANAGER|7100|Local/9990@MemberConnector|REMOVEMEMBER|
1292284552|MANAGER|7200|Local/9990@MemberConnector|REMOVEMEMBER|
1292284562|psy1-1292284515.93|7100|Local/9990@MemberConnector|COMPLETECALLER|2|41|1
</pre><p>As you can see from this example, there might not always be a
    unique ID for the event. In some cases external services, such as the
    Asterisk Manager Interface (AMI), perform actions on the queue; in this
    case you’ll see something like <code class="literal">MANAGER</code>
    in the Unique ID field.</p><p><a id="ACD_id36005998"></a>The available events and the information they
    provide are described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289031" title="Table 13.9. Events in the Asterisk queue log">Table&nbsp;13.9, “Events in the Asterisk queue log”</a>.</p><p><a id="ACD_id36006006"></a></p><div class="table"><a id="ACD_id289031"></a><p class="title"><strong>Table&nbsp;13.9.&nbsp;Events in the Asterisk queue log</strong></p><div class="table-contents"><table summary="Events in the Asterisk queue log" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Event</th><th align="center">Information provided</th></tr></thead><tbody><tr><td><code class="literal">ABANDON</code></td><td><a id="I_indexterm13_d1e30563" class="indexterm"></a>Written when a caller in a queue hangs up before
              his call is answered by an agent. Three parameters are provided
              for <code class="literal">ABANDON</code>: the position of
              the caller at hangup, the original position of the caller when
              entering the queue, and the amount of time the caller waited
              prior to hanging up.</td></tr><tr><td><code class="literal">ADDMEMBER</code></td><td><a id="I_indexterm13_d1e30575" class="indexterm"></a>Written when a member is added to the queue. The
              bridged channel name will be populated with the name of the
              channel added to the queue.</td></tr><tr><td><code class="literal">AGENTDUMP</code></td><td><a id="I_indexterm13_d1e30584" class="indexterm"></a>Indicates that the agent hung up on the caller
              while the queue announcement was being played, prior to them
              being bridged together.</td></tr><tr><td><code class="literal">AGENTLOGIN</code></td><td><a id="I_indexterm13_d1e30593" class="indexterm"></a>Recorded when an agent logs in. The bridged
              channel field will contain something like <code class="literal">Agent/9994</code> if logging in with <code class="literal">chan_agent</code>, and the first parameter
              field will contain the channel logging in (e.g., <code class="literal">SIP/0000FFFF0001</code>).</td></tr><tr><td><code class="literal">AGENTLOGOFF</code></td><td><a id="I_indexterm13_d1e30611" class="indexterm"></a>Logged when an agent logs off, along with a
              parameter indicating how long the agent was logged in
              for.</td></tr><tr><td><code class="literal">COMPLETEAGENT</code></td><td><a id="I_indexterm13_d1e30620" class="indexterm"></a>Recorded when a call is bridged to an agent and
              the agent hangs up, along with parameters indicating the amount
              of time the caller was held in the queue, the length of the call
              with the agent, and the original position at which the caller
              entered the queue.</td></tr><tr><td><code class="literal">COMPLETECALLER</code></td><td><a id="I_indexterm13_d1e30629" class="indexterm"></a>Same as <code class="literal">COMPLETEAGENT</code>, except the caller hung
              up and not the agent.</td></tr><tr><td><code class="literal">CONFIGRELOAD</code></td><td><a id="I_indexterm13_d1e30641" class="indexterm"></a>Indicates that the queue configuration was
              reloaded (e.g., via <span class="command"><strong>module reload
              app_queue.so</strong></span>).</td></tr><tr><td><code class="literal">CONNECT</code></td><td><a id="I_indexterm13_d1e30653" class="indexterm"></a>Written when the caller and the agent are bridged
              together. Three parameters are also written: the amount of time
              the caller waited in the queue, the unique ID of the queue
              member’s channel to which the caller was bridged, and the amount
              of time the queue member’s phone rang prior to being
              answered.</td></tr><tr><td><code class="literal">ENTERQUEUE</code></td><td><a id="I_indexterm13_d1e30662" class="indexterm"></a>Written when a caller enters the queue. Two
              parameters are also written: the URL (if specified) and the
              caller ID of the caller.</td></tr><tr><td><code class="literal">EXITEMPTY</code></td><td><a id="I_indexterm13_d1e30671" class="indexterm"></a>Written when the caller is removed from the queue
              due to a lack of agents available to answer the call (as
              specified by the <code class="literal">leavewhenempty</code> parameter). Three
              parameters are also written: the position of the caller in the
              queue, the original position at which the caller entered the
              queue, and the amount of time the caller was held in the
              queue.</td></tr><tr><td><code class="literal">EXITWITHKEY</code></td><td><a id="I_indexterm13_d1e30684" class="indexterm"></a>Written when the caller exits the queue by
              pressing a single DTMF key on his phone to exit the queue and
              continue in the dialplan (as enabled by the <code class="literal">context</code> parameter in <code class="filename">queues.conf</code>). Four parameters are
              recorded: the key used to exit the queue, the position of the
              caller in the queue upon exit, the original position the caller
              entered the queue at, and the amount of time the caller was
              waiting in the queue.</td></tr><tr><td><code class="literal">EXITWITHTIMEOUT</code></td><td><a id="I_indexterm13_d1e30699" class="indexterm"></a>Written when the caller is removed from the queue
              due to timeout (as specified by the <code class="literal">timeout</code> parameter to <code class="literal">Queue()</code>). Three parameters are also
              recorded: the position the caller was in when exiting the queue,
              the original position of the caller when entering the queue, and
              the amount of time the caller waited in the queue.</td></tr><tr><td><code class="literal">PAUSE</code></td><td><a id="I_indexterm13_d1e30714" class="indexterm"></a>Written when a queue member is paused.</td></tr><tr><td><code class="literal">PAUSEALL</code></td><td><a id="I_indexterm13_d1e30723" class="indexterm"></a>Written when all members of a queue are
              paused.</td></tr><tr><td><code class="literal">UNPAUSE</code></td><td><a id="I_indexterm13_d1e30732" class="indexterm"></a>Written when a queue member is unpaused.</td></tr><tr><td><code class="literal">UNPAUSEALL</code></td><td><a id="I_indexterm13_d1e30741" class="indexterm"></a>Written when all members of a queue are
              unpaused.</td></tr><tr><td><code class="literal">PENALTY</code></td><td><a id="I_indexterm13_d1e30750" class="indexterm"></a>Written when a member’s penalty is modified. The
              penalty can be changed through several means, such as the
              <code class="literal">QUEUE_MEMBER_PENALTY()</code>
              function, through using Asterisk Manager Interface, or the
              Asterisk CLI commands.</td></tr><tr><td><code class="literal">REMOVEMEMBER</code></td><td><a id="I_indexterm13_d1e30762" class="indexterm"></a>Written when a queue member is removed from the
              queue. The bridge channel field will contain the name of the
              member removed from the queue.</td></tr><tr><td><code class="literal">RINGNOANSWER</code></td><td><a id="I_indexterm13_d1e30771" class="indexterm"></a>Logged when a queue member is rung for a period of
              time, and the timeout value for ringing the queue member is
              exceeded. A single parameter will also be written indicating the
              amount of time the member’s extension rang.</td></tr><tr><td><code class="literal">TRANSFER</code></td><td><a id="I_indexterm13_d1e30780" class="indexterm"></a>Written when a caller is transferred to another
              extension. Additional parameters are also written, which
              include: the extension and context the caller was transferred
              to, the hold time of the caller in the queue, the amount of time
              the caller was speaking to a member of the queue, and the
              original position of the caller when he entered the
              queue.<sup>[<a id="id593100" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id593100" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">SYSCOMPAT</code></td><td><a id="I_indexterm13_d1e30798" class="indexterm"></a>Recorded if an agent attempts to answer a call,
              but the call cannot be set up due to incompatibilities in the
              media setup.<a id="I_indexterm13_d1e30802" class="indexterm"></a><a id="I_indexterm13_d1e30803" class="indexterm"></a><a id="I_indexterm13_d1e30804" class="indexterm"></a></td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.id593100" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id593100" class="para">a</a>] </sup>Please note that when the caller
                  is transferred using SIP transfers (rather than the built-in
                  transfers triggered by DTMF and configured in <code class="filename">features.conf</code>), the <code class="literal">TRANSFER</code> event may not be
                  reliable.</p></div></td></tr></tbody></table></div></div><p><br class="table-break"></p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ACD_id289208"></a>Conclusion</h2></div></div></div><p><a id="ACD_id289213"></a>We started this chapter with a look at basic call
    queues, discussing what they are, how they work, and when you might want
    to use one. After building a simple queue, we explored how to control
    queue members through various means (including the use of Local channels,
    which provide the ability to perform some dialplan logic just prior to
    connecting to a queue member). We also explored all the options available
    to us in the <code class="filename">queues.conf</code>, <code class="filename">agents.conf</code>, and <code class="filename">queuerules.conf</code> files, which offer us
    fine-grained control over any queues we configure. Of course, we need the
    ability to monitor what our queues are doing, so we looked finally at the
    queue log and the myriad of events and event parameters written when
    various things happen in our queues.</p><p><a id="ACD_id36006356"></a>With the knowledge provided in this chapter, you
    should be well on your way to implementing a successful set of queues for
    your company.<a id="I_indexterm13_d1e30821" class="indexterm"></a><a id="I_indexterm13_d1e30822" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id580381" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id580381" class="para">126</a>] </sup>It is a common misconception that a queue can allow you to handle
      more calls. This is not strictly true, in that your callers will still
      want to speak to a live person, and they will only be willing to wait
      for so long. In other words, if you are short-staffed, your queue could
      end up being nothing more than an obstacle to your callers. The ideal
      queue is invisible to the callers, since their calls get answered
      immediately without them having to hold.</p></div><div class="footnote"><p><sup>[<a id="ftn.id580459" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id580459" class="para">127</a>] </sup>There are several books available that discuss call center metrics
      and available queuing strategies, such as James C. Abbott’s
      <span class="emphasis"><em>The Executive Guide to Call Center Metrics</em></span> (Robert
      Houston Smith).</p></div><div class="footnote"><p><sup>[<a id="ftn.id580871" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id580871" class="para">128</a>] </sup>Wrapup time is used for agents who may need to perform some sort
        of logging or other function once a call is done. It gives them a
        grace period of several seconds in order to perform this task before
        taking another call.</p></div><div class="footnote"><p><sup>[<a id="ftn.id590291" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id590291" class="para">129</a>] </sup>Callers’ positions and hold times are only announced if more
          than one person is holding in the queue.</p></div><div class="footnote"><p><sup>[<a id="ftn.id591183" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id591183" class="para">130</a>] </sup>If the priority n+1 from where the <code class="literal">Queue()</code> application was called is not
            defined, the call will be hung up.</p></div></div></div><div class="chapter" title="Chapter 14. Device States"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-DeviceStates"></a>Chapter&nbsp;14.&nbsp;Device States</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id262632">Checking Device States</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265377">Extension States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265385">Hints</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#usingCustomDeviceStates">Using Custom Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025906">An Example</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265044">Distributed Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052">Using OpenAIS</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025793">Installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025485">OpenAIS configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025387">Asterisk configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060344">Creating XMPP accounts</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060384">Asterisk configuration</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#SLA">Shared Line Appearances</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289480">Configuration Overview</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061103">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061311">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289498">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="DeviceStates_id250891"></a>Out of clutter, find simplicity.</p><div class="attribution"><span>—<span class="attribution">Albert Einstein</span></span></div></div><p><a id="DeviceStates_id270698"></a><a id="index-062P852GR4T" class="indexterm"></a><a id="index-322L420UA3R" class="indexterm"></a>It is often useful to be able to determine the state of the
  devices that are attached to a <span class="application">telephone</span> system.
  For example, a receptionist might require the ability to see the statuses of
  all the people in the office in order to determine whether somebody can take
  a phone call. Asterisk itself needs this same information. As another
  example, if you were building a call queue, as discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD" title="Chapter 13. Automatic Call Distribution (ACD) Queues">Chapter&nbsp;13, <em>Automatic Call Distribution (ACD) Queues</em></a>, Asterisk needs to know when an agent is available
  so that another call can be delivered. This chapter discusses device state
  concepts in Asterisk, as well as how devices and applications use and access
  this information.</p><div class="sect1" title="Device States"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceStates_id267818"></a>Device States</h2></div></div></div><p><a id="DeviceStates_id259905"></a><a id="I_indexterm14_d1e30850" class="indexterm"></a>There are two types of devices that device states refer to:
    real devices and virtual devices. Real devices are telephony endpoints
    that can make or receive calls, such as SIP phones. Virtual devices
    include things that are inside of Asterisk, but provide useful state
    information. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#table-virtualDevices" title="Table 14.1. Virtual devices in Asterisk">Table&nbsp;14.1, “Virtual devices in Asterisk”</a> lists the available
    virtual devices in Asterisk.<a id="I_indexterm14_d1e30858" class="indexterm"></a></p><div class="table"><a id="table-virtualDevices"></a><p class="title"><strong>Table&nbsp;14.1.&nbsp;Virtual devices in Asterisk</strong></p><div class="table-contents"><table summary="Virtual devices in Asterisk" border="1"><colgroup><col><col></colgroup><thead><tr><th>Virtual device</th><th>Description</th></tr></thead><tbody><tr><td>
              <code class="literal">MeetMe:<a id="I_indexterm14_d1e30876" class="indexterm"></a><em class="replaceable"><code>&lt;conference
            bridge&gt;</code></em></code>
            </td><td>The state of a MeetMe conference bridge. The state will
            reflect whether or not the conference bridge currently has
            participants called in. More information on using
            <code class="literal">MeetMe()</code> for call conferencing can be found in
            <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing" title="Conferencing with MeetMe()">the section called “Conferencing with MeetMe()”</a>.</td></tr><tr><td>
              <code class="literal">SLA:<em class="replaceable"><code>&lt;shared
            line&gt;</code></em></code>
            </td><td><a id="I_indexterm14_d1e30895" class="indexterm"></a>Shared Line Appearance state information. This state
            is manipulated by the <code class="literal">SLATrunk()</code> and
            <code class="literal">SLAStation()</code> applications. More detail can be
            found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#SLA" title="Shared Line Appearances">the section called “Shared Line Appearances”</a>.</td></tr><tr><td>
              <code class="literal">Custom:<em class="replaceable"><code>&lt;custom
            name&gt;</code></em></code>
            </td><td><a id="I_indexterm14_d1e30914" class="indexterm"></a>Custom device states. These states have custom names
            and are modified using the <code class="literal">DEVICE_STATE()</code>
            function. Example usage can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#usingCustomDeviceStates" title="Using Custom Device States">the section called “Using Custom Device States”</a>.</td></tr><tr><td>
              <code class="literal">Park:<em class="replaceable"><code>&lt;exten@context&gt;</code></em></code>
            </td><td><a id="I_indexterm14_d1e30930" class="indexterm"></a>The state of a spot in a call parking lot. The state
            information will reflect whether or not a caller is currently
            parked at that extension. More information about call parking in
            Asterisk can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots" title="Parking Lots">the section called “Parking Lots”</a>.</td></tr><tr><td>
              <code class="literal">Calendar:<em class="replaceable"><code>&lt;calendar
            name&gt;</code></em></code>
            </td><td><a id="I_indexterm14_d1e30943" class="indexterm"></a>Calendar state. Asterisk will use the contents of
            the named calendar to set the state to
            <code class="literal">available</code> or <code class="literal">busy</code>. More
            information about calendar integration in Asterisk can be found in
            <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="DeviceStates_id205407"></a>A device state is a simple one-to-one
    mapping to a device. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265356" title="Figure 14.1. Device state mappings">Figure&nbsp;14.1, “Device state mappings”</a> shows this
    <span class="keep-together">mapping</span>.</p><div class="figure-float"><div class="figure"><a id="DeviceStates_id265356"></a><p class="title"><strong>Figure&nbsp;14.1.&nbsp;Device state mappings</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject14_d1e30965"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1401.png" alt="Device state mappings"></div></div></div><br class="figure-break"></div><div class="sect2" title="Checking Device States"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id262632"></a>Checking Device States</h3></div></div></div><p><a id="DeviceStates_id265354"></a>The <code class="literal">DEVICE_STATE()</code>
      dialplan function <a id="I_indexterm14_d1e30978" class="indexterm"></a><a id="I_indexterm14_d1e30981" class="indexterm"></a>can be used to read the current state of a device. Here is
      a simple example of it being used in the dialplan:</p><a id="DeviceStates_id190226"></a><pre class="programlisting">exten =&gt; 7012,1,Answer()

; *** This line should not have any line breaks
    same =&gt; n,Verbose(3,The state of SIP/0004F2060EB4 is 
${DEVICE_STATE(SIP/0004F2060EB4)})
    same =&gt; n,Hangup()</pre><p><a id="DeviceStates_id36026668"></a>If we call extension 7012 from the
      same device that we are checking the state of, the following verbose
      message comes up on the Asterisk console:</p><a id="DeviceStates_id36026672"></a><pre class="programlisting">    -- The state of SIP/0004F2060EB4 is INUSE</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceStates_id190231"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>
        discusses the Asterisk Manager Interface (AMI). The
        <code class="literal">GetVar</code> manager action can be used to retrieve
        device state values in an external program. You can use it to get the
        value of either a normal variable or a dialplan function, such as
        <code class="literal">DEVICE_STATE()</code>.</p></div><p><a id="DeviceStates_id180853"></a>The following list includes the
      possible values that will come back from the
      <code class="literal">DEVICE_STATE()</code> function:</p><div class="itemizedlist"><a id="DeviceStates_id180859"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id180862"></a><a id="DeviceStates_id180864"></a>
            <code class="literal">UNKNOWN</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180869"></a><a id="DeviceStates_id180871"></a>
            <code class="literal">NOT_INUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180876"></a><a id="DeviceStates_id180879"></a>
            <code class="literal">INUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180884"></a><a id="DeviceStates_id180886"></a>
            <code class="literal">BUSY</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180891"></a><a id="DeviceStates_id180894"></a>
            <code class="literal">INVALID</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180899"></a><a id="DeviceStates_id180901"></a>
            <code class="literal">UNAVAILABLE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180906"></a><a id="DeviceStates_id180908"></a>
            <code class="literal">RINGING</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id180914"></a><a id="DeviceStates_id159821"></a>
            <code class="literal">RINGINUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id159826"></a><a id="DeviceStates_id159828"></a>
            <code class="literal">ONHOLD</code>
          </p></li></ul></div></div></div><div class="sect1" title="Extension States"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceStates_id265377"></a>Extension States</h2></div></div></div><p><a id="DeviceStates_id265383"></a><a id="index-332C167JV3O" class="indexterm"></a><a id="index-613R438IB3E" class="indexterm"></a><a id="index-730D331JE2G" class="indexterm"></a>Extension states are another important concept in
    <span class="application">Asterisk</span>. Extension states are what SIP devices
    subscribe to for presence information. (SIP presence is discussed in more
    detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1" title="SIP Presence">the section called “SIP Presence”</a>). The state of
    an extension is determined by checking the state of one or more devices.
    The list of devices that map to extension states is defined in the
    Asterisk dialplan, <code class="filename">/etc/asterisk/extensions.conf</code>,
    using a special <code class="literal">hint</code> directive. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265402" title="Figure 14.2. Extension state mappings">Figure&nbsp;14.2, “Extension state mappings”</a> shows the mapping between devices,
    device states, and <span class="keep-together">extension</span>
    states.</p><div class="figure"><a id="DeviceStates_id265402"></a><p class="title"><strong>Figure&nbsp;14.2.&nbsp;Extension state mappings</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject14_d1e31083"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1402.png" alt="Extension state mappings"></div></div></div><br class="figure-break"><div class="sect2" title="Hints"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id265385"></a>Hints</h3></div></div></div><p><a id="DeviceStates_id265390"></a><a id="I_indexterm14_d1e31092" class="indexterm"></a>To define an extension state hint in the dialplan, the
      keyword <code class="literal">hint</code> is used in place of a priority. Here is
      a simple example dialplan that relates to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265402" title="Figure 14.2. Extension state mappings">Figure&nbsp;14.2, “Extension state mappings”</a>:</p><a id="DeviceStates_id36026485"></a><pre class="programlisting">[default]

exten =&gt; 1234,hint,SIP/phoneA&amp;SIP/phoneB&amp;SIP/phoneC

exten =&gt; 5555,hint,DAHDI/1

exten =&gt; 31337,hint,MeetMe:31337</pre><p><a id="DeviceStates_id36026490"></a>Typically, hints are simply defined
      along with the rest of the extension. This next example adds simple
      extension entries for what would happen if each of these extensions were
      called:</p><a id="DeviceStates_id36026495"></a><pre class="programlisting">[default]

exten =&gt; 1234,hint,SIP/phoneA&amp;SIP/phoneB&amp;SIP/phoneC
exten =&gt; 1234,1,Dial(SIP/phoneA&amp;SIP/phoneB&amp;SIP/phoneC)

exten =&gt; 5555,hint,DAHDI/1
exten =&gt; 5555,1,Dial(DAHDI/1)

exten =&gt; 31337,hint,MeetMe:31337
exten =&gt; 31337,1,MeetMe(31337,dM)</pre><p><a id="DeviceStates_id36026501"></a>In our example we’ve made a direct
      correlation between the hint’s extension number and the extension number
      being dialed, although there is no requirement that that be the
      case.</p></div><div class="sect2" title="Checking Extension States"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id265394"></a>Checking Extension States</h3></div></div></div><p><a id="DeviceStates_id265399"></a>The easiest way to check the current
      state of an extension is at the Asterisk CLI. The <span class="command"><strong>core show
      hints </strong></span>command <a id="I_indexterm14_d1e31117" class="indexterm"></a><a id="I_indexterm14_d1e31120" class="indexterm"></a>will show you all currently configured hints. Consider the
      following hint definition:</p><a id="DeviceStates_id36026522"></a><pre class="programlisting">[phones]

exten =&gt; 7001,hint,SIP/0004F2060EB4</pre><p><a id="DeviceStates_id36026526"></a>When <span class="command"><strong>core show
      hints</strong></span> is executed at the <span class="application">Asterisk</span>
      CLI, the following output is presented when the device is currently in
      use:</p><a id="DeviceStates_id36026414"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core show hints</code></strong>

    -= Registered Asterisk Dial Plan Hints =-
           7001@phones   : SIP/0004F2060EB4    State:InUse    Watchers  0
----------------
- 1 hints registered</pre><p><a id="DeviceStates_id36026396"></a>In addition to showing you the state
      of the extension, the output of <span class="command"><strong>core show hints</strong></span> also
      provides a count of watchers. A <span class="emphasis"><em>watcher</em></span> is
      something in <span class="application">Asterisk</span> that has subscribed to
      receive updates on the state of this extension. If a SIP phone
      subscribes to the state of an extension, the watcher count will be
      increased.</p><p><a id="DeviceStates_id36026327"></a>Extension state can also be retrieved
      with a dialplan function,
      <code class="literal">EXTENSION_STATE()</code>.<a id="I_indexterm14_d1e31159" class="indexterm"></a><a id="I_indexterm14_d1e31162" class="indexterm"></a> This function operates similarly to the
      <code class="literal">DEVICE_STATE()</code> function described in the preceding
      section. The following example shows an extension that will print the
      current state of another extension to the
      <span class="application">Asterisk</span> console:</p><a id="DeviceStates_id36026344"></a><pre class="programlisting">exten =&gt; 7013,1,Answer()
    same =&gt; n,Verbose(3,The state of 7001@phones is ${EXTENSION_STATE(7001@phones)})
    same =&gt; n,Hangup()</pre><p><a id="DeviceStates_id36026350"></a>When this extension is called, this
      is the verbose message that shows up on the
      <span class="application">Asterisk</span> console:</p><a id="DeviceStates_id36026356"></a><pre class="programlisting">    -- The state of 7001@phones is INUSE</pre><p><a id="DeviceStates_id36026360"></a>The following list includes the
      possible values that may be returned back from the
      <code class="literal">EXTENSION_STATE()</code> function:<a id="I_indexterm14_d1e31188" class="indexterm"></a><a id="I_indexterm14_d1e31189" class="indexterm"></a><a id="I_indexterm14_d1e31190" class="indexterm"></a></p><div class="itemizedlist"><a id="DeviceStates_id36026366"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id36026368"></a><a id="DeviceStates_id36026370"></a>
            <code class="literal">UNKNOWN</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026376"></a><a id="DeviceStates_id36026378"></a>
            <code class="literal">NOT_INUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026383"></a><a id="DeviceStates_id36026385"></a>
            <code class="literal">INUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026166"></a><a id="DeviceStates_id36026168"></a>
            <code class="literal">BUSY</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026174"></a><a id="DeviceStates_id36026176"></a>
            <code class="literal">UNAVAILABLE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026181"></a><a id="DeviceStates_id36026183"></a>
            <code class="literal">RINGING</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026189"></a><a id="DeviceStates_id36026191"></a>
            <code class="literal">RINGINUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026196"></a><a id="DeviceStates_id36026198"></a>
            <code class="literal">HOLDINUSE</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36026204"></a><a id="DeviceStates_id36026206"></a>
            <code class="literal">ONHOLD</code>
          </p></li></ul></div></div></div><div class="sect1" title="SIP Presence"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-DeviceStates-SECT-1"></a>SIP Presence</h2></div></div></div><p><a id="DeviceStates_id265012"></a><span class="application"><a id="I_indexterm14_d1e31234" class="indexterm"></a><a id="I_indexterm14_d1e31241" class="indexterm"></a>Asterisk</span> provides the ability for devices to
    subscribe to extension state using the SIP protocol. This functionality is
    often referred to as BLF (Busy Lamp Field).<a id="I_indexterm14_d1e31248" class="indexterm"></a><a id="I_indexterm14_d1e31251" class="indexterm"></a><sup>[<a id="id594772" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id594772" class="footnote">131</a>]</sup></p><div class="sect2" title="Asterisk Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id265023"></a>Asterisk Configuration</h3></div></div></div><p><a id="DeviceStates_id265029"></a><a id="I_indexterm14_d1e31261" class="indexterm"></a>To get this working, hints must be defined in
      <span class="emphasis"><em>/etc/asterisk/extensions.conf</em></span> (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265385" title="Hints">the section called “Hints”</a> for more information on configuring
      hints in the dialplan). Additionally, there are some important options
      that must be set in the configuration file for the SIP channel driver,
      which is <span class="emphasis"><em>/etc/asterisk/sip.conf</em></span>. The following list
      discusses these options:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">callcounter</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31282" class="indexterm"></a>Enables/disables call counters. This must be enabled
            for Asterisk to be able to provide state information for SIP
            devices. This option may be set either in the
            <code class="literal">[general]</code> section or in peer-specific sections
            of <code class="filename">sip.conf</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceStates_id36026260"></a>If you would like device
              states to work for SIP devices, you must at least set the
              <code class="literal">callcounter</code> option to <code class="literal">yes</code>.
              Otherwise, the SIP channel driver will not bother tracking calls
              to and from devices and will provide no state information about
              them.</p></div></dd><dt><span class="term">
            <code class="literal">busylevel</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31307" class="indexterm"></a>Sets the number of calls that must be in progress
            for Asterisk to report that a device is busy. This option may only
            be set in peer-specific sections of <code class="filename">sip.conf</code>.
            By default, this option is not set. This means that Asterisk will
            report that a device is in use, but never busy.</p></dd><dt><span class="term">
            <code class="literal">call-limit</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31320" class="indexterm"></a>This option has been deprecated in favor of using
            the <code class="literal">GROUP()</code> and
            <code class="literal">GROUP_COUNT()</code> functions in the Asterisk
            dialplan. You may find older documentation that suggests that this
            option is required for SIP presence to work. That used to be the
            case, but this option has been replaced by the
            <code class="literal">callcounter</code> option for that purpose.</p></dd><dt><span class="term">
            <code class="literal">allowsubscribe</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31339" class="indexterm"></a>Allows you to disable support for subscriptions. If
            this option has not been set, subscriptions will be enabled. To
            disable subscription support completely, set
            <code class="literal">allowsubscribe</code> to <code class="literal">no</code> in the
            <code class="literal">[general]</code> section of
            <code class="filename">sip.conf</code>.</p></dd><dt><span class="term">
            <code class="literal">subscribecontext</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31361" class="indexterm"></a>Allows you to set a specific context for
            subscriptions. Without this set, the context defined by the
            <code class="literal">context</code> option will be used. This option may be
            set either in the <code class="literal">[general]</code> section or in
            peer-specific sections of <code class="filename">sip.conf</code>.</p></dd><dt><span class="term">
            <code class="literal">notifyringing</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31380" class="indexterm"></a>Controls whether or not a notification will be sent
            when an extension goes into a ringing state. This option is set to
            <code class="literal">yes</code> by default. It only has an effect on
            subscriptions that use the <span class="emphasis"><em>dialog-info</em></span> event
            package. This option can only be set globally in the
            <code class="literal">[general]</code> section of
            <code class="filename">sip.conf</code>.</p></dd><dt><span class="term">
            <code class="literal">notifyhold</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31402" class="indexterm"></a>Allows <code class="literal">chan_sip</code> to set SIP
            devices’ states to <code class="literal">ONHOLD</code>. This is set to
            <code class="literal">yes</code> by default. This option can only be set
            globally in the <code class="literal">[general]</code> section of
            <code class="filename">sip.conf</code>.</p></dd><dt><span class="term">
            <code class="literal">notifycid</code>
          </span></dt><dd><p><a id="I_indexterm14_d1e31427" class="indexterm"></a>Enables/disables sending of an inbound call’s caller
            ID information to an extension. This option applies to devices
            that subscribe to <code class="literal">dialog-info+xml</code>-based
            extension state notifications, such as Snom phones. Displaying
            caller ID information can be useful to help an agent decide
            whether to execute a pickup on an incoming call. This option is
            set to <code class="literal">no</code> by default.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceStates_id36026125"></a>This magic pickup only works
              if the extension and context of the hint are the same as the
              extension and context of the incoming call. Notably, the usage
              of the <code class="literal">subscribecontext</code> option usually breaks
              this option. This option can also be set to the value
              <code class="literal">ignore-context</code>. This will bypass the context
              issue, but should only be used in an environment where there is
              only a single instance of the extension that has been subscribed
              to. Otherwise, you might accidentally pick up calls that you did
              not mean to pick up.</p></div></dd></dl></div></div></div><div class="sect1" title="Using Custom Device States"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="usingCustomDeviceStates"></a>Using Custom Device States</h2></div></div></div><p><a id="DeviceStates_id265041"></a><a id="I_indexterm14_d1e31450" class="indexterm"></a>Asterisk provides the ability to create custom device
    states. This lends itself to the development of some interesting custom
    applications. We’ll start by showing the basic syntax for controlling
    custom device states, and then we’ll build an example that uses
    them.</p><p><a id="DeviceStates_id36025932"></a>Custom device states all start with a
    prefix of <code class="literal">Custom:</code>. The text that comes after the prefix
    can be anything you want. To set or read the value of a custom device
    state, use the <code class="literal">DEVICE_STATE()</code> dialplan function. For
    example, to set a custom device state:</p><a id="DeviceStates_id36025943"></a><pre class="programlisting">exten =&gt; example,1,Set(DEVICE_STATE(Custom:example)=BUSY)</pre><p><a id="DeviceStates_id36025947"></a>Similarly, to read the current value of
    a custom device state:</p><a id="DeviceStates_id36025951"></a><pre class="programlisting">exten =&gt; Verbose(1,The state of Custom:example is ${DEVICE_STATE(Custom:example)})</pre><p><a id="DeviceStates_id36025955"></a>Custom device states can be used as a
    way to directly control the state shown on a device that has subscribed to
    the state of an extension. Just map an extension to a custom device state
    using a hint in the dialplan:</p><a id="DeviceStates_id36025902"></a><pre class="programlisting">exten =&gt; example,hint,Custom:example</pre><div class="sect2" title="An Example"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id36025906"></a>An Example</h3></div></div></div><p><a id="DeviceStates_id36025911"></a>There are a number of interesting use
      cases for custom device states. In this section we will build an example
      that implements a custom “do not disturb” (DND) button on a SIP phone.
      This same approach could be applied to many other things that you might
      like to be able to toggle at the touch of a button. For example, this
      approach could be used to let members know if they are currently logged
      into a queue or not.</p><p><a id="DeviceStates_id36025872"></a>The first piece of the example is the
      hint in the dialplan. This is required so BLF can be configured on a SIP
      phone to subscribe to this extension. In this case, the phone must be
      configured to subscribe to the state of
      <code class="literal">DND_7015</code>:</p><a id="DeviceStates_id36025880"></a><pre class="programlisting">exten =&gt; DND_7015,hint,Custom:DND_7015</pre><p><a id="DeviceStates_id36025884"></a>Next, we will create an extension
      that will be called when the user presses the key associated with the
      custom DND feature. It is interesting to note that this extension does
      nothing with audio. In fact, the user of the phone most likely will not
      even know that a call is placed when he presses the button. As far as
      the user is concerned, pressing that key simply turns on or off the
      light next to the button that reflects whether or not DND is enabled.
      The extension should look like this:</p><a id="DeviceStates_id36025891"></a><pre class="programlisting">exten =&gt; DND_7015,1,Answer()
    same =&gt; n,GotoIf($["${DEVICE_STATE(Custom:DND_7015)}"="BUSY"]?turn_off:turn_on)

    same =&gt; n(turn_off),Set(DEVICE_STATE(Custom:DND_7015)=NOT_INUSE)
    same =&gt; n,Hangup()

    same =&gt; n(turn_on),Set(DEVICE_STATE(Custom:DND_7015)=BUSY)
    same =&gt; n,Hangup()</pre><p><a id="DeviceStates_id36025857"></a>The final part of this example shows
      how the DND state is used in the dialplan. If DND is enabled, a message
      is played to the caller saying that the agent is unavailable. If it is
      disabled, a call will be made to a SIP device:</p><a id="DeviceStates_id36025862"></a><pre class="programlisting">exten =&gt; 7015,1,GotoIf($["${DEVICE_STATE(Custom:DND_7015)}"="BUSY"]?busy:available)
    same =&gt; n(available),Verbose(3,DND is currently off for 7015.)
    same =&gt; n,Dial(SIP/exampledevice)
    same =&gt; n,Hangup()

    same =&gt; n(busy),Verbose(3,DND is on for 7015.)
    same =&gt; n,Playback(vm-theperson)
    same =&gt; n,Playback(digits/7&amp;digits/0&amp;digits/1&amp;digits/5)
    same =&gt; n,Playback(vm-isunavail)
    same =&gt; n,Playback(vm-goodbye)
    same =&gt; n,Hangup()</pre><p><a id="DeviceStates_id36025869"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#custom-devstate-example" title="Example 14.1. Custom “do not disturb” functionality using custom device states">Example&nbsp;14.1, “Custom “do not disturb” functionality using custom device
        states”</a> shows the full example as it would
      appear in <code class="filename">/etc/asterisk/extensions.conf</code>.</p><div class="example"><a id="custom-devstate-example"></a><p class="title"><strong>Example&nbsp;14.1.&nbsp;Custom “do not disturb” functionality using custom device
        states</strong></p><div class="example-contents"><a id="DeviceStates_id36025718"></a><pre class="programlisting">;
; A hint so a phone can use BLF to signal the DND state.
;
exten =&gt; DND_7015,hint,Custom:DND_7015

;
; An extension to dial when the user presses the custom DND
; key on his phone.  This will toggle the state and will result
; in the light on the phone turning on or off.
;
exten =&gt; DND_7015,1,Answer()
    same =&gt; n,GotoIf($["${DEVICE_STATE(Custom:DND_7015)}"="BUSY"]?turn_off:turn_on)

    same =&gt; n(turn_off),Set(DEVICE_STATE(Custom:DND_7015)=NOT_INUSE)
    same =&gt; n,Hangup()

    same =&gt; n(turn_on),Set(DEVICE_STATE(Custom:DND_7015)=BUSY)
    same =&gt; n,Hangup()


;
; Example usage of the DND state.
;
exten =&gt; 7015,1,GotoIf($["${DEVICE_STATE(Custom:DND_7015)}"="BUSY"]?busy:available)
    same =&gt; n(available),Verbose(3,DND is currently off for 7015.)
    same =&gt; n,Dial(SIP/exampledevice)
    same =&gt; n,Hangup()

    same =&gt; n(busy),Verbose(3,DND is on for 7015.)
    same =&gt; n,Playback(vm-theperson)
    same =&gt; n,Playback(digits/7&amp;digits/0&amp;digits/1&amp;digits/5)
    same =&gt; n,Playback(vm-isunavail)
    same =&gt; n,Playback(vm-goodbye)
    same =&gt; n,Hangup()</pre></div></div><br class="example-break"></div></div><div class="sect1" title="Distributed Device States"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceStates_id265044"></a>Distributed Device States</h2></div></div></div><p><a id="DeviceStates_id265050"></a><a id="index-658U014KE7U" class="indexterm"></a><a id="index-066A506MV3Q" class="indexterm"></a>Asterisk is primarily designed to run on a single system.
    However, as requirements for scalability <a id="I_indexterm14_d1e31518" class="indexterm"></a>increase, it is common for deployments to require multiple
    Asterisk servers. Since that has become increasingly common, some features
    have been added to make it easier to coordinate multiple Asterisk servers.
    One of those features is <span class="emphasis"><em>distributed device state</em></span>
    support.</p><p><a id="DeviceStates_id36025740"></a>What this means is that if a device is
    on a call on one Asterisk server, the state of that device on all servers
    reflects that. To be more specific, the way this works is that every
    server knows the state of each device from the perspective of each server.
    Using this collection of states, each server will calculate what the
    overall device state value is to report to the rest of Asterisk.</p><p><a id="DeviceStates_id36025747"></a>To accomplish distributed device state,
    some sort of messaging mechanism must be used for the servers to
    communicate with each other. Two such mechanisms are supported as of
    Asterisk 1.8: AIS and XMPP.</p><div class="sect2" title="Using OpenAIS"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id265052"></a>Using OpenAIS</h3></div></div></div><p><a id="DeviceStates_id265057"></a><a id="index-884F161SK1F" class="indexterm"></a><a id="index-364N562WA6B" class="indexterm"></a><a id="index-647D218TQ2G" class="indexterm"></a>The Application Interface Specification (AIS) is a
      standardized set of messaging middleware APIs. The definition for the
      APIs is provided by the <a class="ulink" href="http://www.saforum.org/" target="_top">Service
      Availability Forum</a>. The open source implementation of AIS that
      was used for the development and testing of this functionality is <a class="ulink" href="http://www.openais.org/" target="_top">OpenAIS</a>, which is built on <a class="ulink" href="http://www.corosync.org/" target="_top">Corosync</a>.</p><p><a id="DeviceStates_id36025782"></a>Corosync, and thus OpenAIS, is built
      in such a way that nodes must be located on the same high-speed,
      low-latency LAN. If your deployment is geographically distributed, you
      should use the XMPP-based distributed device state support, which is
      discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061" title="Using XMPP">the section called “Using XMPP”</a>.</p><div class="sect3" title="Installation"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36025793"></a>Installation</h4></div></div></div><p><a id="DeviceStates_id36025799"></a><a id="I_indexterm14_d1e31566" class="indexterm"></a><a id="I_indexterm14_d1e31573" class="indexterm"></a><a id="I_indexterm14_d1e31578" class="indexterm"></a>The first step to getting the necessary components
        installed is to install Corosync and OpenAIS. Corosync depends on the
        NSS library. Install the <span class="command"><strong>libnss3-dev</strong></span> package on
        Ubuntu or the <span class="command"><strong>nss-devel</strong></span> package on CentOS.</p><p><a id="DeviceStates_id36025810"></a>Next, install Corosync and OpenAIS.
        There may be packages available, but they are also fairly
        straightforward to install from source. Download the latest releases
        from the Corosync and OpenAIS home pages. Then, execute the following
        commands to compile and install each package:</p><a id="DeviceStates_id36025816"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>tar xvzf corosync-1.2.8.tar.gz</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd corosync-1.2.8</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong>

<code class="prompt">$</code> <strong class="userinput"><code>tar xvzf openais-1.1.4.tar.gz</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd openais-1.1.4</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong></pre><p><a id="DeviceStates_id36025656"></a>If you installed Asterisk prior to
        installing <span class="application">Corosync</span> and
        <span class="application">OpenAIS</span>, you will need to re-compile and
        reinstall <span class="application">Asterisk</span> to get AIS support.
        Start by running the <span class="application">Asterisk</span>
        <span class="command"><strong>configure</strong></span> script. The <span class="command"><strong>configure</strong></span>
        script is responsible for inspecting the system to find out which
        optional dependencies can be found so that the build system knows
        which modules can be built:</p><a id="DeviceStates_id36025676"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /path/to/asterisk</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong></pre><p><a id="DeviceStates_id36025689"></a>After running the
        <span class="command"><strong>configure</strong></span> script, run the
        <span class="command"><strong>menuselect</strong></span> tool to ensure that
        <span class="application">Asterisk</span> has been told to build the
        <code class="literal">res_ais</code> module (this module can be found in the
        <span class="emphasis"><em>Resource Modules</em></span> section of
        <span class="command"><strong>menuselect</strong></span>):</p><a id="DeviceStates_id36025570"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make menuselect</code></strong></pre><p><a id="DeviceStates_id36025577"></a>Finally, compile and install
        <span class="application">Asterisk</span>:</p><a id="DeviceStates_id36025584"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceStates_id36025600"></a>This is a pretty quick and crude
          set of instructions for compiling and installing
          <span class="application">Asterisk</span>. For a much more complete set of
          instructions, please see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>.</p></div></div><div class="sect3" title="OpenAIS configuration"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36025485"></a>OpenAIS configuration</h4></div></div></div><p><a id="DeviceStates_id36025490"></a><a id="I_indexterm14_d1e31744" class="indexterm"></a><a id="I_indexterm14_d1e31751" class="indexterm"></a><a id="I_indexterm14_d1e31756" class="indexterm"></a>Now that OpenAIS has been installed, it needs to be
        configured. There is a configuration file for both OpenAIS and
        Corosync that must be put in place. Check to see if
        <code class="filename">/etc/ais/openais.conf</code> and
        <code class="filename">/etc/corosync/corosync.conf</code> exist. If they do not
        exist, copy in the sample configuration files:</p><a id="DeviceStates_id36025502"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo mkdir -p /etc/ais</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd openais-1.1.4</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo cp conf/openais.conf.sample /etc/ais/openais.conf</code></strong>

<code class="prompt">$</code> <strong class="userinput"><code>sudo mkdir -p /etc/corosync</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd corosync-1.2.8</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo cp conf/corosync.conf.sample /etc/corosync/corosync.conf</code></strong></pre><p><a id="DeviceStates_id36025542"></a>Next, you will need to edit both
        the <code class="filename">openais.conf</code> and
        <code class="filename">corosync.conf</code> files. There are a number of
        options here, but the most important one that must be changed is the
        <code class="literal">bindnetaddr</code> option in the
        <code class="literal">totem-interface</code> section. This must be set to the IP
        address of the network interface that this node will use to
        communicate with the rest of the cluster:</p><a id="DeviceStates_id36025561"></a><pre class="programlisting">totem {
    ...
    interface {
        ringnumber: 0
        bindnetaddr: 10.24.22.144
        mcastaddr: 226.94.1.1
        mcastport: 5405
    }
}</pre><p><a id="DeviceStates_id36025425"></a>For detailed documentation on the
        rest of the options in these configuration files, see the associated
        manpages:</p><a id="DeviceStates_id36025430"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>man openais.conf</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>man corosync.conf</code></strong></pre><p><a id="DeviceStates_id36025443"></a>To get started with testing out
        basic OpenAIS connectivity, try starting the
        <span class="command"><strong>aisexec</strong></span> application in the foreground and watching
        the output:</p><a id="DeviceStates_id36025451"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo aisexec -f</code></strong></pre><p><a id="DeviceStates_id36025459"></a>For example, if you watch the
        output of <span class="command"><strong>aisexec</strong></span> on the first node while you bring
        up the second node, you should see output that reflects that the
        cluster now has two connected nodes:</p><a id="DeviceStates_id36025467"></a><pre class="screen">Nov 13 06:55:30 corosync [CLM   ] CLM CONFIGURATION CHANGE
Nov 13 06:55:30 corosync [CLM   ] New Configuration:
Nov 13 06:55:30 corosync [CLM   ]       r(0) ip(10.24.22.144) 
Nov 13 06:55:30 corosync [CLM   ]       r(0) ip(10.24.22.242) 
Nov 13 06:55:30 corosync [CLM   ] Members Left:
Nov 13 06:55:30 corosync [CLM   ] Members Joined:
Nov 13 06:55:30 corosync [CLM   ]       r(0) ip(10.24.22.242) 
Nov 13 06:55:30 corosync [TOTEM ] A processor joined or left the membership and a new 
membership was formed.
Nov 13 06:55:30 corosync [MAIN  ] Completed service synchronization, ready to provide
service.</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DeviceStates_id36025379"></a>If you have any trouble getting
          the nodes to sync up with each other, one thing to check is that
          there are no firewall rules on the nodes that are blocking the
          multicast traffic that is used for the nodes to communicate with
          each other.</p></div></div><div class="sect3" title="Asterisk configuration"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36025387"></a>Asterisk configuration</h4></div></div></div><p><a id="DeviceStates_id36025392"></a><a id="I_indexterm14_d1e31861" class="indexterm"></a><a id="I_indexterm14_d1e31868" class="indexterm"></a>The <code class="literal">res_ais</code> module for
        <span class="application">Asterisk</span> has a single configuration file,
        <code class="filename">/etc/asterisk/ais.conf</code>. One short section is
        required in this file to enable distributed device state in an AIS
        cluster. Place the following contents in the
        <code class="filename">/etc/asterisk/ais.conf</code> file:</p><a id="DeviceStates_id36025410"></a><pre class="programlisting">[device_state]

type = event_channel
publish_event = device_state
subscribe_event = device_state</pre><p><a id="DeviceStates_id36025413"></a>There is an Asterisk CLI command
        that can be used to ensure that this configuration has been loaded
        properly:</p><a id="DeviceStates_id36025417"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>ais evt show event channels</code></strong> 

=============================================================
=== Event Channels ==========================================
=============================================================
===
=== ---------------------------------------------------------
=== Event Channel Name: device_state
=== ==&gt; Publishing Event Type: device_state
=== ==&gt; Subscribing to Event Type: device_state
=== ---------------------------------------------------------
===
=============================================================</pre><p><a id="DeviceStates_id36025323"></a>Another useful
        <span class="application">Asterisk</span> CLI command provided by the
        <code class="literal">res_ais</code> module is used to list the members of the
        AIS cluster:</p><a id="DeviceStates_id36025333"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>ais clm show members</code></strong> 

=============================================================
=== Cluster Members =========================================
=============================================================
===
=== ---------------------------------------------------------
=== Node Name: 10.24.22.144
=== ==&gt; ID: 0x9016180a
=== ==&gt; Address: 10.24.22.144
=== ==&gt; Member: Yes
=== ---------------------------------------------------------
===
=== ---------------------------------------------------------
=== Node Name: 10.24.22.242
=== ==&gt; ID: 0xf216180a
=== ==&gt; Address: 10.24.22.242
=== ==&gt; Member: Yes
=== ---------------------------------------------------------
===
=============================================================</pre></div><div class="sect3" title="Testing device state changes"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36025342"></a>Testing device state changes</h4></div></div></div><p><a id="DeviceStates_id36025348"></a><a id="I_indexterm14_d1e31918" class="indexterm"></a><a id="I_indexterm14_d1e31925" class="indexterm"></a><a id="I_indexterm14_d1e31930" class="indexterm"></a>Now that you’ve set up and configured distributed device
        state using OpenAIS, there are some simple tests that can be done
        using custom device states to ensure that device states are being
        communicated between the servers. Start by creating a test hint in the
        Asterisk dialplan,
        <code class="filename">/etc/asterisk/extensions.conf</code>:</p><a id="DeviceStates_id36025357"></a><pre class="programlisting">[devstate_test]

exten =&gt; foo,hint,Custom:abc</pre><p><a id="DeviceStates_id36025361"></a>Now, you can adjust the custom
        device state from the <span class="application">Asterisk</span> CLI using
        the <span class="command"><strong>dialplan set global</strong></span> CLI command <a id="I_indexterm14_d1e31949" class="indexterm"></a><a id="I_indexterm14_d1e31952" class="indexterm"></a>and then check the state on each server using the
        <span class="command"><strong>core show hints</strong></span> command.<a id="I_indexterm14_d1e31961" class="indexterm"></a><a id="I_indexterm14_d1e31965" class="indexterm"></a> For example, we can use this command to set the state
        on one server:</p><a id="DeviceStates_id36025210"></a><pre class="screen"><code class="prompt">pbx1*CLI&gt;</code> <strong class="userinput"><code>dialplan set global DEVICE_STATE(Custom:abc) INUSE</code></strong>

    -- Global variable 'DEVICE_STATE(Custom:abc)' set to 'INUSE'</pre><p><a id="DeviceStates_id36025220"></a>and then, check the state on
        another server using this command:</p><a id="DeviceStates_id36025224"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core show hints</code></strong>

-= Registered Asterisk Dial Plan Hints =-
   foo@devstatetest        : Custom:abc        State:InUse       Watchers  0</pre><p><a id="DeviceStates_id36025233"></a>If you would like to dive deeper
        into the processing of distributed device state changes, there are
        some useful debug messages that can be enabled. First, enable debug on
        the Asterisk console in
        <code class="filename">/etc/asterisk/logger.conf</code>. Then, enable debugging
        at the Asterisk CLI:</p><a id="DeviceStates_id36025242"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core set debug 1</code></strong></pre><p><a id="DeviceStates_id36025250"></a>With the debug output enabled, you
        will see some messages that show how
        <span class="application">Asterisk</span> is processing each state change.
        When the state of a device changes on one server,
        <span class="application">Asterisk</span> checks the state information it
        has for that device on all servers and determines the overall device
        state. The following examples illustrate:<a id="I_indexterm14_d1e32006" class="indexterm"></a><a id="I_indexterm14_d1e32007" class="indexterm"></a><a id="I_indexterm14_d1e32008" class="indexterm"></a></p><a id="DeviceStates_id36025262"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>dialplan set global DEVICE_STATE(Custom:abc) NOT_INUSE</code></strong>

    -- Global variable 'DEVICE_STATE(Custom:abc)' set to 'NOT_INUSE'

[Nov 13 13:27:12] DEBUG[14801]: devicestate.c:652 
handle_devstate_change: Processing device state change for 'Custom:abc'
[Nov 13 13:27:12] DEBUG[14801]: devicestate.c:602 
process_collection: Adding per-server state of 'Not in use' for 'Custom:abc'
[Nov 13 13:27:12] DEBUG[14801]: devicestate.c:602 
process_collection: Adding per-server state of 'Not in use' for 'Custom:abc'
[Nov 13 13:27:12] DEBUG[14801]: devicestate.c:609 
process_collection: Aggregate devstate result is 'Not in use' for 'Custom:abc'
[Nov 13 13:27:12] DEBUG[14801]: devicestate.c:631 
process_collection: Aggregate state for device 'Custom:abc' has changed to 
'Not in use'

<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>dialplan set global DEVICE_STATE(Custom:abc) INUSE</code></strong>

    -- Global variable 'DEVICE_STATE(Custom:abc)' set to 'INUSE'

[Nov 13 13:29:30] DEBUG[14801]: devicestate.c:652 handle_devstate_change: 
Processing device state change for 'Custom:abc'
[Nov 13 13:29:30] DEBUG[14801]: devicestate.c:602 process_collection: 
Adding per-server state of 'Not in use' for 'Custom:abc'
[Nov 13 13:29:30] DEBUG[14801]: devicestate.c:602 process_collection: 
Adding per-server state of 'In use' for 'Custom:abc'
[Nov 13 13:29:30] DEBUG[14801]: devicestate.c:609 process_collection: 
Aggregate devstate result is 'In use' for 'Custom:abc'
[Nov 13 13:29:30] DEBUG[14801]: devicestate.c:631 process_collection: 
Aggregate state for device 'Custom:abc' has changed to 'In use'</pre></div></div><div class="sect2" title="Using XMPP"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id265061"></a>Using XMPP</h3></div></div></div><p><a id="DeviceStates_id265066"></a><a class="ulink" href="http://www.xmpp.org/" target="_top">The
      eXtensible Messaging and Presence Protocol (XMPP)</a>,<a id="index-864B663HW7S" class="indexterm"></a><a id="index-284E524UV5W" class="indexterm"></a><a id="index-278S156CN3Q" class="indexterm"></a> formerly (and still commonly) known as
      <span class="emphasis"><em>Jabber</em></span><a id="I_indexterm14_d1e32047" class="indexterm"></a>, is an IETF standardized communications protocol. It is
      most commonly known as an IM protocol, but it can be used for a number
      of other interesting applications as well. The XMPP Standards Foundation
      (XSF) works to standardize extensions to the XMPP protocol. One such
      extension, referred to as PubSub, provides a publish/subscribe
      mechanism.</p><p><a id="DeviceStates_id36025138"></a>Asterisk has the ability to use XMPP
      PubSub to distribute device state information. One of the nice things
      about using XMPP to accomplish this is that it works very well for
      geographically distributed Asterisk servers.</p><div class="sect3" title="Installation"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36060186"></a>Installation</h4></div></div></div><p><a id="DeviceStates_id36060191"></a><a id="I_indexterm14_d1e32057" class="indexterm"></a><a id="I_indexterm14_d1e32064" class="indexterm"></a><a id="I_indexterm14_d1e32069" class="indexterm"></a>To distribute device states using XMPP, you will need an
        XMPP server that supports PubSub. One such server that has been
        successfully tested against Asterisk is <a class="ulink" href="http://www.tigase.org/" target="_top">Tigase</a><a id="I_indexterm14_d1e32077" class="indexterm"></a>.</p><p><a id="DeviceStates_id36060206"></a>The Tigase website has instructions
        for installing and configuring the Tigase server. We suggest that you
        follow those instructions (or the instructions provided for whatever
        other server you may choose to use) and come back to this book when
        you’re ready to work on the Asterisk-specific parts.</p><p><a id="DeviceStates_id36060211"></a>On the Asterisk side of things, you
        will need to ensure that you have installed the
        <code class="literal">res_jabber</code> module. You can check to see if it is
        already loaded at the <span class="application">Asterisk</span> CLI:</p><a id="DeviceStates_id36060222"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module show like jabber</code></strong>

Module                         Description                              Use Count 
res_jabber.so                  AJI - Asterisk Jabber Interface          0         
1 modules loaded</pre><p><a id="DeviceStates_id36060232"></a>If you are using a custom
        <code class="filename">/etc/asterisk/modules.conf</code> file that lists only
        specific modules to be loaded, you can also check the filesystem to
        see if the module was compiled and installed:</p><a id="DeviceStates_id36060240"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ls -l /usr/lib/asterisk/modules/res_jabber.so</code></strong>

-rwxr-xr-x 1 root root 837436 2010-11-12 15:33 /usr/lib/asterisk/modules/res_jabber.so</pre><p><a id="DeviceStates_id36060249"></a>If you do not yet have
        <code class="literal">res_jabber</code> installed, you will need to install the
        <span class="application"><code class="literal">iksemel</code></span> and
        <span class="application">OpenSSL</span> libraries. Then, you will need to
        recompile and reinstall <span class="application">Asterisk</span>. Start by
        running the <span class="application">Asterisk</span>
        <span class="command"><strong>configure</strong></span> script, which is responsible for
        inspecting the system and locating optional dependencies, so that the
        build system knows which modules can be built:</p><a id="DeviceStates_id36060268"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /path/to/asterisk</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong></pre><p><a id="DeviceStates_id36060282"></a>After running the
        <span class="command"><strong>configure</strong></span> script, run the
        <span class="command"><strong>menuselect</strong></span> tool to ensure that
        <span class="application">Asterisk</span> has been told to build the
        <code class="literal">res_jabber</code> module. This module can be found in the
        <span class="emphasis"><em>Resource Modules</em></span> section of
        <span class="command"><strong>menuselect</strong></span>:</p><a id="DeviceStates_id36060296"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make menuselect</code></strong></pre><p><a id="DeviceStates_id36060304"></a>Finally, compile and install
        <span class="application">Asterisk</span>:</p><a id="DeviceStates_id36060310"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DeviceStates_id36060326"></a>This is a pretty quick and crude
          set of instructions for compiling and installing
          <span class="application">Asterisk</span>. For a much more complete set of
          instructions, please see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>.</p></div></div><div class="sect3" title="Creating XMPP accounts"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36060344"></a>Creating XMPP accounts</h4></div></div></div><p><a id="DeviceStates_id36060349"></a><a id="I_indexterm14_d1e32202" class="indexterm"></a><a id="I_indexterm14_d1e32209" class="indexterm"></a><a id="I_indexterm14_d1e32214" class="indexterm"></a>Unfortunately, Asterisk is currently not able to
        register new accounts on an XMPP server. You will have to create an
        account for each server via some other mechanism. The method we used
        while testing was to use an XMPP client such as <a class="ulink" href="http://www.pidgin.im/" target="_top">Pidgin</a> to complete the account
        registration process. After account registration is complete, the XMPP
        client is no longer needed. For the rest of the examples, we will use
        the following two buddies, both of which are on the server
        <span class="emphasis"><em>jabber.shifteight.org</em></span>:</p><div class="itemizedlist"><a id="DeviceStates_id36060365"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id36060367"></a><a id="DeviceStates_id36060369"></a>
              <code class="literal">server1@jabber.shifteight.org/astvoip1</code>
            </p></li><li class="listitem"><p><a id="DeviceStates_id36060375"></a><a id="DeviceStates_id36060377"></a>
              <code class="literal">server2@jabber.shifteight.org/astvoip2</code>
            </p></li></ul></div></div><div class="sect3" title="Asterisk configuration"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36060384"></a>Asterisk configuration</h4></div></div></div><p><a id="DeviceStates_id36060390"></a><a id="I_indexterm14_d1e32239" class="indexterm"></a><a id="I_indexterm14_d1e32246" class="indexterm"></a><a id="I_indexterm14_d1e32251" class="indexterm"></a>The <code class="filename">/etc/asterisk/jabber.conf</code> file
        will need to be configured on each server. We will show the
        configuration for a two-server setup here, but the configuration can
        easily be expanded to more servers as needed. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#jabberconf-server1" title="Example 14.2. jabber.conf for server1">Example&nbsp;14.2, “jabber.conf for server1”</a> shows the contents of the
        configuration file for server 1 and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#jabberconf-server2" title="Example 14.3. jabber.conf for server2">Example&nbsp;14.3, “jabber.conf for server2”</a> shows the contents of the
        configuration file for server 2. For additional information on the
        <code class="filename">jabber.conf</code> options associated with distributed
        device states, see the <code class="filename">configs/jabber.conf.sample</code>
        file that is included in the Asterisk source tree.</p><div class="example"><a id="jabberconf-server1"></a><p class="title"><strong>Example&nbsp;14.2.&nbsp;jabber.conf for server1</strong></p><div class="example-contents"><a id="DeviceStates_id36060421"></a><pre class="programlisting">[general]
autoregister = yes

[asterisk]
type = client
serverhost = jabber.shifteight.org
pubsub_node = pubsub.jabber.shifteight.org
username = server1@jabber.shifteight.org/astvoip1
secret = mypassword
distribute_events = yes
status = available
usetls = no
usesasl = yes
buddy = server2@jabber.shifteight.org/astvoip2</pre></div></div><br class="example-break"><div class="example"><a id="jabberconf-server2"></a><p class="title"><strong>Example&nbsp;14.3.&nbsp;jabber.conf for server2</strong></p><div class="example-contents"><a id="DeviceStates_id36060437"></a><pre class="programlisting">[general]
autoregister = yes

[asterisk]
type = client
serverhost = jabber.shifteight.org
pubsub_node = pubsub.jabber.shifteight.org
username = server2@jabber.shifteight.org/astvoip2
secret = mypassword
distribute_events = yes
status = available
usetls = no
usesasl = yes
buddy = server1@jabber.shifteight.org/astvoip1</pre></div></div><br class="example-break"></div><div class="sect3" title="Testing"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36025143"></a>Testing</h4></div></div></div><p><a id="DeviceStates_id36025148"></a><a id="I_indexterm14_d1e32285" class="indexterm"></a><a id="I_indexterm14_d1e32292" class="indexterm"></a><a id="I_indexterm14_d1e32297" class="indexterm"></a>To ensure that everything is working properly, start by
        doing some verification of the <code class="filename">jabber.conf</code>
        settings on each server. There are a couple of relevant
        <span class="application">Asterisk</span> CLI commands that can be used
        here. The first is the <span class="command"><strong>jabber show connected</strong></span>
        command,<a id="I_indexterm14_d1e32312" class="indexterm"></a><a id="I_indexterm14_d1e32316" class="indexterm"></a> which will verify that Asterisk has successfully logged
        in with an account on the <span class="emphasis"><em>jabber</em></span> server. The
        output of this command on the first server shows:</p><a id="DeviceStates_id36060471"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>jabber show connected</code></strong>

Jabber Users and their status:
       User: server1@jabber.shifteight.org/astvoip1     - Connected
----
   Number of users: 1</pre><p><a id="DeviceStates_id36060481"></a>Meanwhile, if <span class="command"><strong>jabber show
        connected</strong></span> is executed on the second server, it shows:</p><a id="DeviceStates_id36060488"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>jabber show connected</code></strong>

Jabber Users and their status:
       User: server2@jabber.shifteight.org/astvoip2     - Connected
----
   Number of users: 1</pre><p><a id="DeviceStates_id36060497"></a>The next useful command for
        verifying the setup is <span class="command"><strong>jabber show
        buddies</strong></span><a id="I_indexterm14_d1e32348" class="indexterm"></a><a id="I_indexterm14_d1e32351" class="indexterm"></a>. This command allows you to verify that the other
        server is correctly listed on your buddy list. It also lets you see if
        the other server is seen as currently connected. If you were to run
        this command on the first server without
        <span class="application">Asterisk</span> currently running on the second
        server, the output would look like this:</p><a id="DeviceStates_id36060510"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>jabber show buddies</code></strong>

Jabber buddy lists
Client: server1@jabber.shifteight.org/astvoip1
    Buddy: server2@jabber.shifteight.org
           Resource: None
    Buddy: server2@jabber.shifteight.org/astvoip2
           Resource: None</pre><p><a id="DeviceStates_id36060521"></a>Next, start Asterisk on the second
        server and run <span class="command"><strong>jabber show buddies</strong></span> on that server.
        The output will contain more information, since the second server will
        see the first server online:</p><a id="DeviceStates_id36060529"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>jabber show buddies</code></strong>

Jabber buddy lists
Client: server2@jabber.shifteight.org/astvoip2
    Buddy: server1@jabber.shifteight.org
           Resource: astvoip1
               node: http://www.asterisk.org/xmpp/client/caps
               version: asterisk-xmpp
               Jingle capable: yes
           Status: 1
           Priority: 0
    Buddy: server1@jabber.shifteight.org/astvoip1
           Resource: None</pre><p><a id="DeviceStates_id36060541"></a>At this point, you should be ready
        to test out the distribution of device states. The procedure is the
        same as that for testing device states over AIS, which can be found in
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342" title="Testing device state changes">the section called “Testing device state changes”</a>.<a id="I_indexterm14_d1e32384" class="indexterm"></a><a id="I_indexterm14_d1e32385" class="indexterm"></a><a id="I_indexterm14_d1e32386" class="indexterm"></a><a id="I_indexterm14_d1e32387" class="indexterm"></a><a id="I_indexterm14_d1e32388" class="indexterm"></a></p></div></div></div><div class="sect1" title="Shared Line Appearances"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="SLA"></a>Shared Line Appearances</h2></div></div></div><p><a id="DeviceStates_id265078"></a><a id="index-053Q285EE6A" class="indexterm"></a><a id="index-225K471VL7U" class="indexterm"></a>In Asterisk, Shared Line Appearances (SLA)—sometimes also
    referred to in the industry as Bridged Line Appearances (BLA)—can be used.
    This functionality can be used to satisfy two primary use cases, which
    include emulating a simple key system and creating shared extensions on a
    PBX.</p><p><a id="DeviceStates_id36060568"></a>Building key system emulation is the
    use case for which these applications were primarily designed. In this
    environment, you have some small number of trunks coming into the PBX,
    such as analog phone lines, and each phone has a dedicated button for
    calls on that trunk. You may refer to these trunks as line 1, line 2, and
    line 3, for example.</p><p><a id="DeviceStates_id36060575"></a>The second primary use case is for
    creating shared extensions on your PBX. This use case seems to be the most
    common these days. There are many reasons you might want to do this. One
    example is that you may want an extension to appear on both the phones of
    an executive and her administrative assistant. Another example would be if
    you want the same extension to appear on all of the phones in the same
    lab.</p><p><a id="DeviceStates_id36060582"></a>While these use cases are supported to
    an extent, there are limitations. There is still more work to be done in
    <span class="application">Asterisk</span> to make these features work really
    well for what people want to do with them. These limitations are discussed
    in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations" title="Limitations">the section called “Limitations”</a>.</p><div class="sect2" title="Installing the SLA Applications"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id289471"></a>Installing the SLA Applications</h3></div></div></div><p><a id="DeviceStates_id289477"></a><a id="I_indexterm14_d1e32417" class="indexterm"></a><a id="I_indexterm14_d1e32424" class="indexterm"></a><a id="I_indexterm14_d1e32429" class="indexterm"></a><a id="I_indexterm14_d1e32434" class="indexterm"></a>The SLA applications are built on two key technologies in
      <span class="application">Asterisk</span>. The first is device state
      processing, and the second is conferencing. Specifically, the
      conferencing used by these applications is the
      <code class="literal">MeetMe()</code> application. The SLA applications come with
      the same module as the <code class="literal">MeetMe()</code> application, so you
      must install the <code class="literal">app_meetme</code> module.</p><p><a id="DeviceStates_id36060622"></a>You can check at the Asterisk CLI to
      see if you already have the module:</p><a id="DeviceStates_id36060626"></a><pre class="screen"><code class="prompt">pbx*CLI&gt;</code> <strong class="userinput"><code>module show like app_meetme.so</code></strong>

Module                         Description                              Use Count 
0 modules loaded</pre><p><a id="DeviceStates_id36060636"></a>In this case, the module is not
      present. The most common reason that an
      <span class="application">Asterisk</span> system does not have the
      <code class="literal">app_meetme</code> module is because
      <span class="application">DAHDI</span> has not been installed. The
      <code class="literal">MeetMe()</code> application <a id="I_indexterm14_d1e32476" class="indexterm"></a><a id="I_indexterm14_d1e32479" class="indexterm"></a>uses <span class="application">DAHDI</span> to perform
      conference mixing. Once DAHDI is installed (refer to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a> for installation information), rerun the
      Asterisk <span class="command"><strong>configure</strong></span> script, recompile, and reinstall.
      Once the module has been properly installed, you should be able to see
      it at the CLI:</p><a id="DeviceStates_id36060662"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module show like app_meetme.so</code></strong>

Module                         Description                              Use Count 
app_meetme.so                  MeetMe conference bridge                 0         
1 modules loaded</pre><p><a id="DeviceStates_id36060672"></a>Once the
      <code class="literal">app_meetme</code> module is loaded, you should have both the
      <code class="literal">SLAStation()</code> and <code class="literal">SLATrunk()</code>
      applications available:</p><a id="DeviceStates_id36060685"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core show applications like SLA</code></strong>

    -= Matching Asterisk Applications =-
            SLAStation: Shared Line Appearance Station. 
              SLATrunk: Shared Line Appearance Trunk. 
    -= 2 Applications Matching =-</pre></div><div class="sect2" title="Configuration Overview"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id289480"></a>Configuration Overview</h3></div></div></div><p><a id="DeviceStates_id289485"></a><a id="I_indexterm14_d1e32523" class="indexterm"></a><a id="I_indexterm14_d1e32530" class="indexterm"></a><a id="I_indexterm14_d1e32535" class="indexterm"></a>The two main configuration files that must be edited to
      set up SLA are <code class="filename">/etc/asterisk/extensions.conf</code> and
      <code class="filename">/etc/asterisk/sla.conf</code>. The
      <code class="filename">sla.conf</code> file is used for defining trunks and
      stations. A station is any SIP phone that will be using SLA. Trunks are
      the literal trunks or shared extensions that will be appearing on two or
      more stations. The Asterisk <span class="keep-together">dialplan</span>,
      <code class="filename">extensions.conf</code>, provides some important glue that
      pulls an SLA configuration together. The dialplan includes some
      extension state hints and extensions that define how calls get into and
      out of an SLA setup. The next few sections provide detailed examples of
      the configuration for a few different use cases.</p></div><div class="sect2" title="Key System Example with Analog Trunks"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id289488"></a>Key System Example with Analog Trunks</h3></div></div></div><p><a id="DeviceStates_id289494"></a><a id="index-668K777HG3Q" class="indexterm"></a><a id="index-436K561DW8D" class="indexterm"></a><a id="index-583P308TV8B" class="indexterm"></a><a id="index-740N305GJ6S" class="indexterm"></a><a id="index-074W522CH8W" class="indexterm"></a>This usage of SLA comes with the simplest
      configuration.<sup>[<a id="id598521" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id598521" class="footnote">132</a>]</sup> This scenario would typically be used for a fairly small
      installation, where you have a few analog lines and SIP phones that all
      have line keys directly associated with the analog lines. For the
      purposes of this example, we will say we have two analog lines and four
      SIP phones. Each SIP phone will have a button for
      <code class="literal">line1</code> and a button for <code class="literal">line2</code>. This
      section will assume that you have done some configuration up front,
      including:</p><div class="itemizedlist"><a id="DeviceStates_id36061022"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id36061024"></a><a id="DeviceStates_id36061026"></a>Configuring the four SIP phones.
          For more information on setting up SIP phones, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a>.</p></li><li class="listitem"><p><a id="DeviceStates_id36061035"></a><a id="DeviceStates_id36061037"></a>Configuring the two analog lines.
          Fore more information on setting up analog lines with
          <span class="application">Asterisk</span>, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p></li></ul></div><p><a id="DeviceStates_id36061050"></a>For this example, we will use the
      following device names for the SIP phones and analog lines. Be sure to
      adapt the examples to match your own configuration:</p><div class="itemizedlist"><a id="DeviceStates_id36061055"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id36061057"></a><a id="DeviceStates_id36061059"></a>
            <code class="literal">SIP/station1</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36061065"></a><a id="DeviceStates_id36061067"></a>
            <code class="literal">SIP/station2</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36061072"></a><a id="DeviceStates_id36061074"></a>
            <code class="literal">SIP/station3</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36061080"></a><a id="DeviceStates_id36061082"></a>
            <code class="literal">SIP/station4</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36061087"></a><a id="DeviceStates_id36061089"></a>
            <code class="literal">DAHDI/1</code>
          </p></li><li class="listitem"><p><a id="DeviceStates_id36061095"></a><a id="DeviceStates_id36061097"></a>
            <code class="literal">DAHDI/2</code>
          </p></li></ul></div><div class="sect3" title="sla.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061103"></a>sla.conf</h4></div></div></div><p><a id="DeviceStates_id36061110"></a><a id="I_indexterm14_d1e32643" class="indexterm"></a><a id="I_indexterm14_d1e32646" class="indexterm"></a>As mentioned previously, <code class="filename">sla.conf</code>
        contains configuration that maps devices to trunks and stations. For
        this example, we will start by defining the two trunks:</p><a id="DeviceStates_id36061117"></a><pre class="programlisting">[line1]
type = trunk
device = DAHDI/1

[line2]
type = trunk
device = DAHDI/2</pre><p><a id="DeviceStates_id36061121"></a>Next, we will set up the station
        definitions. We have four SIP phones, which will each use both trunks.
        Note that the section names in <code class="filename">sla.conf</code> for
        stations do not need to match the SIP device names, but it is done
        that way here for convenience:</p><a id="DeviceStates_id36061130"></a><pre class="programlisting">[station1]
type = station
device = SIP/station1
trunk = line1
trunk = line2

[station2]
type = station
device = SIP/station2
trunk = line1
trunk = line2

[station3]
type = station
device = SIP/station3
trunk = line1
trunk = line2

[station4]
type = station
device = SIP/station4
trunk = line1
trunk = line2</pre><p><a id="DeviceStates_id36061136"></a>The station configuration is a bit
        repetitive. Asterisk configuration file template sections come in
        handy here to collapse the configuration down a bit. Here is the
        station configuration again, but this time using a template:</p><a id="DeviceStates_id36061141"></a><pre class="programlisting">[station](!)
type = trunk
trunk = line1
trunk = line2

[station1](station)
device = SIP/station1

[station2](station)
device = SIP/station2

[station3](station)
device = SIP/station3

[station4](station)
device = SIP/station4</pre></div><div class="sect3" title="extensions.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061147"></a>extensions.conf</h4></div></div></div><p><a id="DeviceStates_id36061154"></a><a id="I_indexterm14_d1e32672" class="indexterm"></a><a id="I_indexterm14_d1e32675" class="indexterm"></a>The next configuration file required for this example is
        <code class="filename">/etc/asterisk/extensions.conf</code>. There are three
        contexts. First, we have the <code class="literal">line1</code> and
        <code class="literal">line2</code> contexts. When a call comes in on one of the
        analog lines, it will come in to one of these contexts in the dialplan
        and execute the <code class="literal">SLATrunk()</code> application.<a id="I_indexterm14_d1e32694" class="indexterm"></a><a id="I_indexterm14_d1e32697" class="indexterm"></a> This application will take care of ringing all of the
        appropriate stations:</p><a id="DeviceStates_id36061173"></a><pre class="programlisting">[line1]

exten =&gt; s,1,SLATrunk(line1)

[line2]

exten =&gt; s,1,SLATrunk(line2)</pre><p><a id="DeviceStates_id36061178"></a>The next section of the dialplan is
        the <code class="literal">sla_stations</code> context. All calls from the SIP
        phones should be sent to this context. Further, the SIP phones should
        be configured such that as soon as they go off-hook, they immediately
        make a call to the <code class="literal">station1</code> extension (or
        <code class="literal">station2</code>, <code class="literal">station3</code>, etc., as
        appropriate). If the <code class="literal">line1</code> key on the phone is
        pressed, a call should be sent to the
        <code class="literal">station1_line1</code> extension (or
        <code class="literal">station2_line1</code>, etc.).</p><p><a id="DeviceStates_id36061206"></a>Any time that a phone goes off-hook
        or a line key is pressed, the call that is made will immediately
        connect it to one of the analog lines. For a line that is not already
        in use, the analog line will be providing a dialtone, and the user
        will be able to send digits to make a call. If a user presses a line
        key for a line that is already in use, that user will be bridged into
        the existing call on that line. The <code class="literal">sla_stations</code>
        context looks like this:</p><a id="DeviceStates_id36061213"></a><pre class="programlisting">[sla_stations]

exten =&gt; station1,1,SLAStation(station1)
exten =&gt; station1_line1,hint,SLA:station1_line1
exten =&gt; station1_line1,1,SLAStation(station1_line1)
exten =&gt; station1_line2,hint,SLA:station1_line2
exten =&gt; station1_line2,1,SLAStation(station1_line2)

exten =&gt; station2,1,SLAStation(station2)
exten =&gt; station2_line1,hint,SLA:station2_line1
exten =&gt; station2_line1,1,SLAStation(station2_line1)
exten =&gt; station2_line2,hint,SLA:station2_line2
exten =&gt; station2_line2,1,SLAStation(station2_line2)

exten =&gt; station3,1,SLAStation(station3)
exten =&gt; station3_line1,hint,SLA:station3_line1
exten =&gt; station3_line1,1,SLAStation(station3_line1)
exten =&gt; station3_line2,hint,SLA:station3_line2
exten =&gt; station3_line2,1,SLAStation(station3_line2)

exten =&gt; station4,1,SLAStation(station4)
exten =&gt; station4_line1,hint,SLA:station4_line1
exten =&gt; station4_line1,1,SLAStation(station4_line1)
exten =&gt; station4_line2,hint,SLA:station4_line2
exten =&gt; station4_line2,1,SLAStation(station4_line2)</pre></div><div class="sect3" title="Additional phone configuration tasks"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061217"></a>Additional phone configuration tasks</h4></div></div></div><p><a id="DeviceStates_id36061232"></a>The previous section covered the
        dialplan for trunks and stations. There are some specific things to
        keep in mind when setting up phones for use with this setup. First,
        each phone should be configured to send a call as soon as it is taken
        off-hook.</p><p><a id="DeviceStates_id36061237"></a>The other important item is the
        configuration of the line keys. Asterisk uses extension state
        subscriptions to control the LEDs next to the line buttons. Beyond
        that, each line key should be configured as a speed-dial. Use the
        following checklist for your line key configuration (how you
        accomplish these tasks will depend on the specific phones you are
        using):</p><div class="itemizedlist"><a id="DeviceStates_id36061244"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="DeviceStates_id36061246"></a><a id="DeviceStates_id36061248"></a>Set the label of the key to be
            <span class="emphasis"><em>Line 1</em></span> (etc.), or whatever you deem
            appropriate.</p></li><li class="listitem"><p><a id="DeviceStates_id36061256"></a><a id="DeviceStates_id36061258"></a>Set up the keys such that the
            <span class="emphasis"><em>Line 1</em></span> key on <code class="literal">station1</code>
            subscribes to the state of <code class="literal">station1_line1</code>, and
            so on. This is required so Asterisk can make the LEDs reflect the
            state of the lines.</p></li><li class="listitem"><p><a id="DeviceStates_id36061272"></a><a id="DeviceStates_id36061274"></a>Ensure that if the
            <span class="emphasis"><em>Line 1</em></span> key on <code class="literal">station1</code> is
            pressed a call is sent to the <code class="literal">station1_line1</code>
            extension, and so on.<a id="I_indexterm14_d1e32774" class="indexterm"></a><a id="I_indexterm14_d1e32775" class="indexterm"></a><a id="I_indexterm14_d1e32776" class="indexterm"></a><a id="I_indexterm14_d1e32777" class="indexterm"></a><a id="I_indexterm14_d1e32779" class="indexterm"></a></p></li></ul></div></div></div><div class="sect2" title="Key System Example with SIP Trunks"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id36061292"></a>Key System Example with SIP Trunks</h3></div></div></div><p><a id="DeviceStates_id36061297"></a><a id="I_indexterm14_d1e32784" class="indexterm"></a><a id="I_indexterm14_d1e32791" class="indexterm"></a><a id="I_indexterm14_d1e32796" class="indexterm"></a><a id="I_indexterm14_d1e32803" class="indexterm"></a>This example is intended to be identical in functionality
      to the previous example. The difference is that instead of using analog
      lines as trunks, we will use a connection to a SIP provider that will
      terminate the calls to the PSTN. For more information on setting up
      Asterisk to connect to a SIP provider, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p><div class="sect3" title="sla.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061311"></a>sla.conf</h4></div></div></div><p><a id="DeviceStates_id36061318"></a><a id="I_indexterm14_d1e32815" class="indexterm"></a><a id="I_indexterm14_d1e32818" class="indexterm"></a>The <code class="filename">sla.conf</code> file for this scenario
        is a bit tricky.<sup>[<a id="id599339" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id599339" class="footnote">133</a>]</sup> You might expect to see the device line in the trunk
        configuration have a SIP channel listed, but instead we’re going to
        use a Local channel. This will allow us to use some additional
        dialplan logic for call processing. The purpose of the Local channel
        will become clearer in the next section, when the dialplan example is
        discussed. Here are the trunk configurations:</p><a id="DeviceStates_id36061331"></a><pre class="programlisting">[line1]
type = trunk
device = Local/disa@line1_outbound

[line2]
type = trunk
device = Local/disa@line2_outbound</pre><p><a id="DeviceStates_id36061335"></a>The station configuration is
        identical to the last example, so let’s get right to it:</p><a id="DeviceStates_id36061339"></a><pre class="programlisting">[station](!)
type = trunk
trunk = line1
trunk = line2

[station1](station)
device = SIP/station1

[station2](station)
device = SIP/station2

[station3](station)
device = SIP/station3

[station4](station)
device = SIP/station4</pre></div><div class="sect3" title="extensions.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061345"></a>extensions.conf</h4></div></div></div><p><a id="DeviceStates_id36061352"></a><a id="I_indexterm14_d1e32842" class="indexterm"></a><a id="I_indexterm14_d1e32845" class="indexterm"></a>As in the last example, you will need
        <code class="literal">line1</code> and <code class="literal">line2</code> contexts to
        process incoming calls on these trunks:</p><a id="DeviceStates_id36061362"></a><pre class="programlisting">[line1]

exten =&gt; s,1,SLATrunk(line1)

;
; If the provider specifies your phone number when sending you
; a call, you will need another rule in the dialplan to match that.
;
exten =&gt; _X.,1,Goto(s,1)

[line2]

exten =&gt; s,1,SLATrunk(line2)

exten =&gt; _X.,1,Goto(s,1)</pre><p><a id="DeviceStates_id36061369"></a>This example requires an
        <code class="literal">sla_stations</code> context, as well. This is for all
        calls coming from the phones. It’s the same as it was in the last
        example:</p><a id="DeviceStates_id36061376"></a><pre class="programlisting">[sla_stations]

exten =&gt; station1,1,SLAStation(station1)
exten =&gt; station1_line1,hint,SLA:station1_line1
exten =&gt; station1_line1,1,SLAStation(station1_line1)
exten =&gt; station1_line2,hint,SLA:station1_line2
exten =&gt; station1_line2,1,SLAStation(station1_line2)

exten =&gt; station2,1,SLAStation(station2)
exten =&gt; station2_line1,hint,SLA:station2_line1
exten =&gt; station2_line1,1,SLAStation(station2_line1)
exten =&gt; station2_line2,hint,SLA:station2_line2
exten =&gt; station2_line2,1,SLAStation(station2_line2)

exten =&gt; station3,1,SLAStation(station3)
exten =&gt; station3_line1,hint,SLA:station3_line1
exten =&gt; station3_line1,1,SLAStation(station3_line1)
exten =&gt; station3_line2,hint,SLA:station3_line2
exten =&gt; station3_line2,1,SLAStation(station3_line2)

exten =&gt; station4,1,SLAStation(station4)
exten =&gt; station4_line1,hint,SLA:station4_line1
exten =&gt; station4_line1,1,SLAStation(station4_line1)
exten =&gt; station4_line2,hint,SLA:station4_line2
exten =&gt; station4_line2,1,SLAStation(station4_line2)</pre><p><a id="DeviceStates_id36061380"></a>The last piece of the dialplan that
        is required is the implementation of the
        <code class="literal">line1_outbound</code> and
        <code class="literal">line2_outbound</code> contexts. This is what the SLA
        applications use when they want to send calls out to a SIP provider.
        The key to this setup is the usage of the <code class="literal">DISA()</code>
        application.<a id="I_indexterm14_d1e32877" class="indexterm"></a><a id="I_indexterm14_d1e32880" class="indexterm"></a> In the last example, phones were directly connected to
        an analog line. This allowed the upstream switch to provide a
        dialtone, collect digits, and then complete the call. In this example,
        we use the <code class="literal">DISA()</code> application locally to provide a
        dialtone and collect digits. Once a complete number has been dialed,
        the call will proceed to go out to a SIP provider:</p><a id="DeviceStates_id36061410"></a><pre class="programlisting">[line1_outbound]

exten =&gt; disa,1,DISA(no-password,line1_outbound)

;
; Add extensions for whatever numbers you would like to
; allow to be dialed.
;
exten =&gt; _1NXXNXXXXXX,1,Dial(SIP/${EXTEN}@myprovider)

[line2_outbound]

exten =&gt; disa,1,DISA(no-password,line2_outbound)

exten =&gt; _1NXXNXXXXXX,1,Dial(SIP/${EXTEN}@myprovider)</pre></div></div><div class="sect2" title="Shared Extension Example"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id36061419"></a>Shared Extension Example</h3></div></div></div><p><a id="DeviceStates_id36061424"></a><a id="I_indexterm14_d1e32895" class="indexterm"></a><a id="I_indexterm14_d1e32902" class="indexterm"></a><a id="I_indexterm14_d1e32907" class="indexterm"></a>The previous two examples were for small key system
      emulation. For this example, we’ll try something quite different. Many
      PBX vendors offer the ability to have the same extension shared across
      multiple phones. This is not simply a matter of having multiple phones
      ring when an extension is called: it is deeper integration than that.
      The behavior of the line key for a shared extension is similar to that
      of a line key on a key system. For example, you can simply put a call on
      hold from one phone and pick it up from another. Also, if multiple
      phones press the key for the shared extension, they will all be bridged
      into the same call. That is why this functionality is often also
      referred to as Bridged Line Appearances (BLA)<a id="I_indexterm14_d1e32911" class="indexterm"></a>.</p><p><a id="DeviceStates_id36061434"></a>In the previous two examples, we had
      two trunks and four stations. For this example, we’re going to set up a
      single shared extension on two phones. The shared extension will be
      referred to as extension <code class="literal">5001</code>.</p><div class="sect3" title="sla.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061439"></a>sla.conf</h4></div></div></div><p><a id="DeviceStates_id36061446"></a><a id="I_indexterm14_d1e32924" class="indexterm"></a><a id="I_indexterm14_d1e32927" class="indexterm"></a>Every usage of the SLA applications requires trunk and
        station definitions. This example, like the previous ones, will be
        making use of the <code class="literal">DISA()</code> application <a id="I_indexterm14_d1e32936" class="indexterm"></a><a id="I_indexterm14_d1e32939" class="indexterm"></a>and the <code class="filename">sla.conf</code> file will look
        very similar:</p><a id="DeviceStates_id36061457"></a><pre class="programlisting">[5001]
type = trunk
device = Local/disa@5001_outbound

[5001_phone1]
device = SIP/5001_phone1
trunk = 5001

[5001_phone2]
device = SIP/5001_phone2
trunk = 5001</pre></div><div class="sect3" title="extensions.conf"><div class="titlepage"><div><div><h4 class="title"><a id="DeviceStates_id36061463"></a>extensions.conf</h4></div></div></div><p><a id="DeviceStates_id36061469"></a><a id="I_indexterm14_d1e32954" class="indexterm"></a><a id="I_indexterm14_d1e32957" class="indexterm"></a>The first part of the dialplan that is required is what
        will be executed when extension <code class="literal">5001</code> is dialed on
        the PBX. Normally, to call a phone you would use the
        <code class="literal">Dial()</code> <span class="keep-together">application</span>. In this case, we’re going
        to use the <code class="literal">SLATrunk()</code> application.<a id="I_indexterm14_d1e32976" class="indexterm"></a><a id="I_indexterm14_d1e32979" class="indexterm"></a> This will take care of ringing both phones and keeping
        them bridged together:</p><a id="DeviceStates_id36061481"></a><pre class="programlisting">exten =&gt; 5001,1,SLATrunk(5001)</pre><p><a id="DeviceStates_id36061485"></a>Next, we will need a context that
        will be used for making outbound calls from this shared extension.
        This assumes that <code class="literal">5001_phone1</code> and
        <code class="literal">5001_phone2</code> have been configured with their
        <code class="literal">context</code> options set to <code class="literal">5001</code> in
        <code class="filename">sip.conf</code>:</p><a id="DeviceStates_id36061503"></a><pre class="programlisting">[5001]

;
; This extension is needed if you want the shared extension to
; be used by default. In that case, have this extension dialed
; when the phone goes off-hook.
;
exten =&gt; 5001_phone1,1,SLAStation(5001_phone1)
;
; This is the extension that should be dialed when the 5001 key is
; pressed on 5001_phone1.
;
exten =&gt; 5001_phone1_5001,hint,SLA:5001_phone1_5001
exten =&gt; 5001_phone1_5001,1,SLAStation(5001_phone1_5001)

exten =&gt; 5001_phone2,1,SLAStation(5001_phone2)
exten =&gt; 5001_phone2_5001,hint,SLA:5001_phone2_5001
exten =&gt; 5001_phone2_5001,1,SLAStation(5001_phone2_5001)</pre><p><a id="DeviceStates_id36061513"></a>Finally, we need an implementation
        of the <code class="literal">5001_outbound</code> context. This will be used to
        provide a dialtone and collect digits on the bridged line:</p><a id="DeviceStates_id36061521"></a><pre class="programlisting">[5001_outbound]

exten =&gt; disa,1,DISA(no-password,5001_outbound)

;
; This context will also need to be able to see whatever
; extensions you would like to be reachable from this extension.
;
include =&gt; pbx_extensions</pre></div></div><div class="sect2" title="Additional Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="DeviceStates_id36061530"></a>Additional Configuration</h3></div></div></div><p><a id="DeviceStates_id36061535"></a><a id="I_indexterm14_d1e33019" class="indexterm"></a><a id="I_indexterm14_d1e33026" class="indexterm"></a>The <code class="filename">/etc/asterisk/sla.conf</code> file has
      some optional configuration parameters that were not used in any of the
      examples in this chapter. To give you an idea of what other behavior can
      be configured, the options are covered here. This file has a
      <code class="literal">[general]</code> section <a id="I_indexterm14_d1e33038" class="indexterm"></a>that is reserved for global configuration options.
      Currently, there is only a single option that can be specified in this
      section:</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">attemptcallerid <a id="I_indexterm14_d1e33049" class="indexterm"></a>=</code> <em class="replaceable"><code>yes</code></em></span></dt><dd><p>This option specifies whether or not the SLA applications
            should attempt to pass caller ID information. It is set to
            <code class="literal">no</code> by default. If this is enabled, the display
            of the phones may not be what you would expect in some
            situations.</p></dd></dl></div><p><a id="DeviceStates_id36061571"></a>The trunk definitions in the previous
      examples only specified the type and device. Here are some additional
      options that can be specified for a trunk:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">autocontext <a id="I_indexterm14_d1e33069" class="indexterm"></a>= line1</code>
          </span></dt><dd><p>If this option is set, Asterisk will automatically create a
            dialplan context using this name. The context will contain an
            <code class="literal">s</code> extension that executes the
            <code class="literal">SLATrunk()</code> application with the appropriate
            argument for this trunk. By default, all dialplan entries must be
            created manually.</p></dd><dt><span class="term">
            <code class="literal">ringtimeout <a id="I_indexterm14_d1e33086" class="indexterm"></a>= 20</code>
          </span></dt><dd><p>This option allows you to specify the number of seconds to
            allow an inbound call on this trunk to ring before the
            <code class="literal">SLATrunk()</code> application will exit and consider
            it an unanswered call. By default, this option is not set.</p></dd><dt><span class="term">
            <code class="literal">barge <a id="I_indexterm14_d1e33100" class="indexterm"></a>= no</code>
          </span></dt><dd><p>The <code class="literal">barge</code> option specifies whether or not
            other stations are allowed to join a call that is in progress on
            this trunk by pressing the same line button. Barging into a call
            on a trunk is allowed by default.</p></dd><dt><span class="term">
            <code class="literal">hold <a id="I_indexterm14_d1e33114" class="indexterm"></a>= private</code>
          </span></dt><dd><p>The <code class="literal">hold</code> option specifies hold
            permissions for this trunk. If this option is set to
            <code class="literal">open</code>, any station can place this trunk on hold
            and any other station is allowed to take it back off of hold. If
            this option is set to <code class="literal">private</code>, only the station
            that placed the trunk on hold is allowed to take it back off of
            hold. This option is set to <code class="literal">open</code> by
            default.</p></dd></dl></div><p><a id="DeviceStates_id413426"></a>When we defined the stations in the
      previous examples, we only supplied the <code class="literal">type</code>,
      <code class="literal">device</code>, and a list of trunks. However, station
      definitions accept some additional configuration options, as well. They
      are listed here:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">autocontext <a id="I_indexterm14_d1e33146" class="indexterm"></a>= sla_stations</code>
          </span></dt><dd><p>If this option is specified, Asterisk will automatically
            create the extensions required for calls coming from this station
            in the context specified. This is off by default, which means that
            all extensions must be specified manually.</p></dd><dt><span class="term">
            <code class="literal">ringtimeout <a id="I_indexterm14_d1e33157" class="indexterm"></a>= 20</code>
          </span></dt><dd><p>A timeout may be specified in seconds for how long this
            station will ring before the call is considered unanswered. There
            is no timeout set by default.</p></dd><dt><span class="term">
            <code class="literal">ringdelay <a id="I_indexterm14_d1e33168" class="indexterm"></a>= 5</code>
          </span></dt><dd><p>A ring delay in seconds can be specified for a station. If a
            delay is specified, this station will not start ringing until this
            number of seconds after the call first came in on this shared
            line. There is no delay set by default.</p></dd><dt><span class="term">
            <code class="literal">hold = private</code>
          </span></dt><dd><p>Hold permissions can be specified for a specific station as
            well. If this option is set to <code class="literal">private</code>, any
            trunks put on hold by this station can only be picked back up by
            this station. By default, this is set to
            <code class="literal">open</code>.</p></dd><dt><span class="term">
            <code class="literal">trunk <a id="I_indexterm14_d1e33192" class="indexterm"></a>= line1,ringtimeout=20</code>
          </span></dt><dd><p>A <code class="literal">ringtimeout</code> can be applied to calls
            coming from only a specific trunk.</p></dd><dt><span class="term">
            <code class="literal">trunk = line1,ringdelay=5</code>
          </span></dt><dd><p>A <code class="literal">ringdelay</code> can also be applied to calls
            from a specific trunk.</p></dd></dl></div></div><div class="sect2" title="Limitations"><div class="titlepage"><div><div><h3 class="title"><a id="sla-limitations"></a>Limitations</h3></div></div></div><p><a id="DeviceStates_id36060728"></a><a id="I_indexterm14_d1e33216" class="indexterm"></a><a id="I_indexterm14_d1e33223" class="indexterm"></a>While Asterisk makes many things easy, SLA is not one of
      them. Despite this functionality being intended to emulate simple
      features, the configuration required to make it work is fairly complex.
      Someone who is new to Asterisk and only wants a simple key system setup
      will have to learn a lot of complex Asterisk and SIP phone concepts to
      get it working.</p><p><a id="DeviceStates_id36061593"></a>Another feature that still needs some
      development work before it will work seamlessly with SLA is caller
      ID.<a id="I_indexterm14_d1e33231" class="indexterm"></a> At the time that this functionality was written, Asterisk
      did not have the appropriate infrastructure in place to be able to
      update caller ID information throughout the duration of the call. Based
      on how this functionality is implemented, this infrastructure is
      required to make the display on the phones useful. It does exist as of
      Asterisk 1.8 but the SLA applications have not yet been updated to use
      it. The end result is that you can either have no caller ID information
      at all, or you can enable it and understand that the phone displays are
      not always going to display correctly as changes happen throughout the
      duration of a call.</p><p><a id="DeviceStates_id36061603"></a>Another limitation, most relevant to
      usage of shared extensions, is that transfers do not work. The main
      reason is that transfers generally involve putting a call on hold for a
      short time. Call hold is processed in a special way with SLA, in that
      the held call is not controlled by the phone that initiated the hold.
      This breaks transfer processing.</p><p><a id="DeviceStates_id393846"></a>In summary, SLA is not necessarily
      simple to set up, and it comes with some significant limitations. With
      that said, if what does exist suits your needs, by all means go for
      it.<a id="I_indexterm14_d1e33241" class="indexterm"></a><a id="I_indexterm14_d1e33242" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DeviceStates_id289498"></a>Conclusion</h2></div></div></div><p><a id="DeviceStates_id289503"></a>This chapter discussed many aspects of
    device state handling in Asterisk. We started by discussing the core
    concepts of device states and extension states, and built up from there.
    We covered how SIP phones can subscribe to states, tools for creating
    custom states, and two mechanisms that can be used for distributing states
    among many servers. Finally, we covered one of the features in Asterisk,
    Shared Line Appearances, that relies heavily on the device state
    infrastructure in Asterisk to operate.<a id="I_indexterm14_d1e33249" class="indexterm"></a><a id="I_indexterm14_d1e33250" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id594772" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id594772" class="para">131</a>] </sup>Some also like to call these “blinky lamps” or “blinky lights”
        for their phones. Geeks and their LEDs…</p></div><div class="footnote"><p><sup>[<a id="ftn.id598521" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id598521" class="para">132</a>] </sup>Admittedly, none of the configuration for SLA is
          simple.</p></div><div class="footnote"><p><sup>[<a id="ftn.id599339" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id599339" class="para">133</a>] </sup>Read: a hack.</p></div></div></div><div class="chapter" title="Chapter 15. The Automated Attendant"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-AA"></a>Chapter&nbsp;15.&nbsp;The Automated Attendant</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA-SECT-1">An Auto Attendant Is Not an IVR</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id272753">Designing Your Auto Attendant</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id289543">The Greeting</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287786">The Main Menu</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287827">Selection 1</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287846">Selection 2</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287860">Selection #</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287873">Selection 3</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287887">Selection 9</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287906">Selection 0</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287920">Timeout</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287934">Invalid</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287946">Dial by Extension</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287976">Building Your Auto Attendant</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288137">The Dialplan</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288192">Delivering Incoming Calls to the Auto Attendant</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288230">IVR</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id36001995">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Autoattendant_id287091"></a>I don’t answer the phone. I get the
    feeling whenever I do that there will be someone on the other end.</p><div class="attribution"><span>—<span class="attribution">Fred Couples</span></span></div></div><p><a id="Autoattendant_id244387"></a><a id="index-400M142BR6M" class="indexterm"></a><a id="index-264C571CK2C" class="indexterm"></a>In many PBXs it is common to have a menuing system in place to
  answer incoming calls automatically, and allow the callers to direct
  themselves to various extensions and resources in the system through menu
  choices. This is known in the telecom industry as an automated attendant
  (AA). An auto attendant normally provides the following features:</p><div class="itemizedlist"><a id="Autoattendant_id260867"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Autoattendant_id267923"></a><a id="Autoattendant_id266522"></a>Transfer to extension</p></li><li class="listitem"><p><a id="Autoattendant_id285793"></a><a id="Autoattendant_id244854"></a>Transfer to voicemail</p></li><li class="listitem"><p><a id="Autoattendant_id258020"></a><a id="Autoattendant_id281282"></a>Transfer to a queue</p></li><li class="listitem"><p><a id="Autoattendant_id272344"></a><a id="Autoattendant_id258076"></a>Play message (e.g., “our address
      is…”)</p></li><li class="listitem"><p><a id="Autoattendant_id244451"></a><a id="Autoattendant_id287018"></a>Connect to a submenu (e.g., “for a
      listing of our departments...”)</p></li><li class="listitem"><p><a id="Autoattendant_id255319"></a><a id="Autoattendant_id270719"></a>Connect to reception</p></li><li class="listitem"><p><a id="Autoattendant_id281244"></a><a id="Autoattendant_id253707"></a>Repeat choices</p></li></ul></div><p><a id="Autoattendant_id244951"></a>For anything else—especially if there is
  external integration required, such as a database lookup—an Interactive
  Voice Response (IVR) would normally be needed.</p><div class="sect1" title="An Auto Attendant Is Not an IVR"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-AA-SECT-1"></a>An Auto Attendant Is Not an IVR</h2></div></div></div><p><a id="Autoattendant_id272698"></a><a id="I_indexterm15_d1e33297" class="indexterm"></a><a id="I_indexterm15_d1e33302" class="indexterm"></a>In the open source telecom community, you will often hear
    the term IVR used to describe an automated attendant. However, in the
    telecom industry, an IVR is distinct from an auto attendant. For this
    reason, when you are talking to somebody about any sort of telecom menu,
    you should ensure that you are talking about the same thing. To a telecom
    professional, the term IVR implies a relatively complex and involved
    development effort (and subsequent costs), whereas an automated attendant
    is a simple and inexpensive thing that is common to most PBXs.</p><p><a id="Autoattendant_id272738"></a>In this chapter we talk about building
    an automated attendant. In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR" title="Chapter 17. Interactive Voice Response">Chapter&nbsp;17, <em>Interactive Voice Response</em></a> we will discuss
    IVR.<sup>[<a id="id600874" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id600874" class="footnote">134</a>]</sup></p></div><div class="sect1" title="Designing Your Auto Attendant"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Autoattendant_id272753"></a>Designing Your Auto Attendant</h2></div></div></div><p><a id="Autoattendant_id262604"></a><a id="index-602Q868JA0K" class="indexterm"></a>The most common mistake beginners make when designing an AA
    is needless complexity. While there can be much joy and sense of
    accomplishment in the creation of a multilevel AA with dozens of nifty
    options and oodles of really cool prompts, your callers have a different
    agenda. The reason people make phone calls is primarily because they want
    to talk to someone. While people have become used to the reality of auto
    attendants, and in some cases they can speed things up, for the most part
    people would prefer to speak to somebody live. This means that there are
    two fundamental rules that every auto attendant should adhere
    to:</p><div class="orderedlist"><a id="Autoattendant_id262612"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Autoattendant_id262614"></a><a id="Autoattendant_id262616"></a>Keep it simple.</p></li><li class="listitem"><p><a id="Autoattendant_id262620"></a><a id="Autoattendant_id262622"></a>Make sure you always include a
          handler for the folks who are going to press <code class="literal">0</code> whenever they hear an auto attendant. If
          you do not want to have a <code class="literal">0</code>
          option, be aware that many people will be insulted by this, and they
          will hang up and not call back. In business, this is generally a bad
          thing.</p></li></ol></div><p><a id="Autoattendant_id262631"></a>Before you start to code your AA, it is
    wise to design it. You will need to define a call flow, and you will need
    to specify the prompts that will play at each step. Software diagramming
    tools can be useful for this, but there’s no need to get fancy. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id259349" title="Table 15.1. A basic automated attendant">Table&nbsp;15.1, “A basic automated attendant”</a> provides a good template for a basic
    auto attendant that will do what you need.</p><p><a id="Autoattendant_id259348"></a></p><div class="table"><a id="Autoattendant_id259349"></a><p class="title"><strong>Table&nbsp;15.1.&nbsp;A basic automated attendant</strong></p><div class="table-contents"><table summary="A basic automated attendant" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>Step or choice</th><th>Sample prompt</th><th>Notes</th><th>Filename</th></tr></thead><tbody><tr><td>Greeting—<span class="keep-together">business</span>
              hours</td><td>Thank you for calling ABC company.</td><td>Day greeting.</td><td><code class="filename">daygreeting.wav</code></td></tr><tr><td>Greeting—non-business hours</td><td>Thank you for calling ABC company. Our office is now
              closed.</td><td>Night greeting.</td><td><code class="filename">nightgreeting.wav</code></td></tr><tr><td>Main menu</td><td>If you know the extension of the person you wish to
              reach, please enter it now. For sales, please press 1, for
              service, press 2, for our company directory, press #. For our
              address and fax information, please press 3. To repeat these
              choices press 9, or you can remain on the line or press 0 to be
              connected to our operator.</td><td>Main menu prompt.</td><td><code class="filename">mainmenu.wav</code></td></tr><tr><td><code class="literal"> <code class="literal">1</code> </code></td><td>Please hold while we connect your calls.</td><td>Transfer to sales queues.</td><td><code class="filename">holdwhileweconnect.wav</code></td></tr><tr><td><code class="literal">2</code></td><td>Please hold while we connect your call.</td><td>Transfer to support queue.</td><td><code class="filename">holdwhileweconnect.wav</code></td></tr><tr><td><code class="literal">#</code></td><td>n/a</td><td>Run <code class="literal">Directory()</code>
              application</td><td>n/a</td></tr><tr><td><code class="literal">3</code></td><td>Our address is [address]. Our fax number is [fax number].
              etc.</td><td>Play a recording containing address and fax information.
              Return caller to menu prompt when done.</td><td><code class="filename">faxandaddress.wav</code></td></tr><tr><td><code class="literal">0</code></td><td>Transferring to our attendant. Please hold.</td><td>Transfer to reception/operator.</td><td><code class="filename">transfertoreception.wav</code></td></tr><tr><td><code class="literal">9</code></td><td>n/a</td><td>Repeat. Replay menu prompt (but not greeting).</td><td>n/a</td></tr><tr><td><code class="literal">t</code></td><td>n/a</td><td>Timeout. If the caller does not make a choice, treat the
              call as if caller has dialed <code class="literal">0</code>.</td><td>&nbsp;</td></tr><tr><td><code class="literal">i</code></td><td>You have made an invalid selection. Please try
              again.</td><td>Caller pressed an invalid digit: replay menu prompt (but
              not greeting).</td><td><code class="filename">invalid.wav</code></td></tr><tr><td><code class="literal">_XXX</code> <sup>[<a id="id601319" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id601319" class="footnote">a</a>]</sup></td><td>n/a</td><td>Transfer call to dialed extension.</td><td><code class="filename">holdwhileweconnect.wav</code></td></tr></tbody><tbody class="footnotes"><tr><td colspan="4"><div class="footnote"><p><sup>[<a id="ftn.id601319" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id601319" class="para">a</a>] </sup>This pattern match must be relevant to your extension
                  range.</p></div></td></tr></tbody></table></div></div><p><br class="table-break"></p><p><a id="Autoattendant_id289538"></a>Let’s go over the various components of
    this template. Then we’ll show you the dialplan code required to implement
    it, as well as how to create prompts for it.</p><div class="sect2" title="The Greeting"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id289543"></a>The Greeting</h3></div></div></div><p><a id="Autoattendant_id289548"></a><a id="I_indexterm15_d1e33503" class="indexterm"></a><a id="I_indexterm15_d1e33510" class="indexterm"></a>The first thing the caller hears is actually two
      prompts.</p><p><a id="Autoattendant_id287772"></a>The first prompt is the greeting. The
      only thing the greeting should do is greet the caller. Examples of a
      greeting might be “Thank you for calling Van Meggelen and Associates,”
      “Welcome to Leif’s School of Wisdom and T-Shirt Design,” or “You have
      reached the offices of Dewey, Cheetum, and Howe, Attorneys.” That’s
      it—the choices for the caller will come later. This allows you to record
      different greetings without having to record a whole new menu. For
      example, for a few weeks each year you might want your greeting to say
      “Season’s greetings” or whatever, but your menu will not need to change.
      Also, if you want to play a different recording after hours (“Thank you
      for calling. Our office is now closed.”), you can use different
      greetings, but the heart of the menu can stay the same. Finally, if you
      want to be able to return callers to the menu from a different part of
      the system, you will normally not want them to hear the greeting
      again.</p></div><div class="sect2" title="The Main Menu"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id287786"></a>The Main Menu</h3></div></div></div><p><a id="Autoattendant_id287791"></a><a id="I_indexterm15_d1e33520" class="indexterm"></a><a id="I_indexterm15_d1e33527" class="indexterm"></a>The main menu prompt is where you inform your callers of
      the choices available to them. You should speak this as quickly as
      possible (without sounding rushed).<sup>[<a id="id601474" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id601474" class="footnote">135</a>]</sup> When you record a choice, <span class="emphasis"><em>always tell the users
      the action that will be taken before giving them the digit option to
      take that action</em></span>. So, don’t say “press 1 for sales,” but
      rather say “for sales, press 1.” The reason for this is that most people
      will not pay full attention to the prompt until they hear the choice
      that is of interest to them. Once they hear their choice, you will have
      their full attention and can tell them what button to press to get them
      to where they want to go.</p><p><a id="Autoattendant_id287811"></a>Another point to consider is what
      order to put the choices in. A typical business, for example, will want
      sales to be the first menu choice, and most callers will expect this as
      well. The important thing is to think of your callers. For example, most
      people will not be interested in address and fax information, so don’t
      make that the first choice.<sup>[<a id="id601508" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id601508" class="footnote">136</a>]</sup> Think about the goal of getting the callers to their
      intended destinations as quickly as possible when you make your design
      choices. Ruthlessly cut anything that is not absolutely
      essential.</p><div class="sect3" title="Selection 1"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287827"></a>Selection 1</h4></div></div></div><p><a id="Autoattendant_id287833"></a>Option 1 in our example will be a
        simple transfer. Normally this would be to a resource located in
        another context, and it would typically have an internal extension
        number so that internal users could also transfer calls to it. In this
        example, we are going to use this option to send callers to the queue
        called <code class="literal">sales</code> that was created in
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD" title="Chapter 13. Automatic Call Distribution (ACD) Queues">Chapter&nbsp;13, <em>Automatic Call Distribution (ACD) Queues</em></a>.</p></div><div class="sect3" title="Selection 2"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287846"></a>Selection 2</h4></div></div></div><p><a id="Autoattendant_id287851"></a>Option 2 will be technically
        identical to option 1. Only the destination will be different. This
        selection will transfer callers to the <code class="literal">support</code> queue.</p></div><div class="sect3" title="Selection #"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287860"></a>Selection #</h4></div></div></div><p><a id="Autoattendant_id287865"></a>It’s good to have the option for the
        directory as close to the beginning of the recording as possible. Many
        people will use a directory if they know it is there, but can’t be
        bothered to listen to the whole menu prompt to find out about it.
        Impatient people will press <code class="literal">0</code>, so
        the sooner you tell them about the directory, the more chance you’ll
        have that they’ll use it, and thus reduce the workload on your
        receptionist.</p></div><div class="sect3" title="Selection 3"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287873"></a>Selection 3</h4></div></div></div><p><a id="Autoattendant_id287879"></a>When you have an option that does
        nothing but play a recording back to the caller (such as address and
        fax information), you can leave all the code for that in the same
        context as the menu, and simply return the caller to the main menu
        prompt at the end of the recording. In general, these sorts of options
        are not as useful as we would like to think they are, so in most cases
        you’ll probably want to leave this out.</p></div><div class="sect3" title="Selection 9"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287887"></a>Selection 9</h4></div></div></div><p><a id="Autoattendant_id287892"></a>It is very important to give the
        caller the option to hear the choices again. Many people will not be
        paying attention throughout the whole menu, and if you don’t give them
        the option to hear the choices again, they will most likely press
        <code class="literal">0</code>.</p><p><a id="Autoattendant_id287901"></a>Note that you do not have to play
        the greeting again, only the main menu prompt.</p></div><div class="sect3" title="Selection 0"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id287906"></a>Selection 0</h4></div></div></div><p><a id="Autoattendant_id287911"></a>As stated before, and whether you
        like it or not, this is the choice that many (possibly the majority)
        of your callers will select. If you really don’t want to have somebody
        handle these calls, you can send this extension to a mailbox, but we
        don’t recommend it. If you are a business, many of your callers will
        be your customers. You want to make it easy for them to get in touch
        with you. Trust us.</p></div></div><div class="sect2" title="Timeout"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id287920"></a>Timeout</h3></div></div></div><p><a id="Autoattendant_id287926"></a><a id="I_indexterm15_d1e33594" class="indexterm"></a><a id="I_indexterm15_d1e33601" class="indexterm"></a>Many people will call a number, and not pay too much
      attention to what is happening. They know that if they just wait on the
      line, they will eventually be transferred to the operator. Or perhaps
      they are in their cars, and really shouldn’t be pressing buttons on
      their phones. Either way, oblige them. If they don’t make any selection,
      don’t harass them and force them to do so. Connect them to the
      operator.</p></div><div class="sect2" title="Invalid"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id287934"></a>Invalid</h3></div></div></div><p><a id="Autoattendant_id287939"></a><a id="I_indexterm15_d1e33611" class="indexterm"></a><a id="I_indexterm15_d1e33618" class="indexterm"></a>People make mistakes. That’s OK. The invalid handler will
      let them know that whatever they have chosen is not a valid option and
      will return them to the menu prompt so that they can try again. Note
      that you should not play the greeting again, only the main menu
      prompt.</p></div><div class="sect2" title="Dial by Extension"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id287946"></a>Dial by Extension</h3></div></div></div><p><a id="Autoattendant_id287951"></a><a id="I_indexterm15_d1e33626" class="indexterm"></a><a id="I_indexterm15_d1e33633" class="indexterm"></a>If somebody calls your system and knows the extension she
      wants to reach, your automated attendant should have code in place to
      handle this.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Autoattendant_id287958"></a>Although Asterisk can handle an
        overlap between menu choices and extension numbers (i.e., you can have
        a menu choice 1 and extensions from 100–199), it is generally best to
        avoid this overlap. Otherwise, the dialplan will always have to wait
        for the interdigit timeout whenever somebody presses <code class="literal">1</code>, because it won’t know if they are
        planning to dial extension <code class="literal">123</code>. The
        interdigit timeout is the delay the system will allow between digits
        before it assumes the entire number has been input. This timer ensures
        callers have enough time to dial a multidigit extension, but it also
        causes a delay in the processing of single-digit inputs.<a id="I_indexterm15_d1e33646" class="indexterm"></a></p></div></div></div><div class="sect1" title="Building Your Auto Attendant"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Autoattendant_id287976"></a>Building Your Auto Attendant</h2></div></div></div><p><a id="Autoattendant_id287982"></a><a id="index-117K517QB8D" class="indexterm"></a>After you have designed your auto attendant, there are three
    things you need to do to make it work properly:</p><div class="itemizedlist"><a id="Autoattendant_id287986"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Autoattendant_id287988"></a><a id="Autoattendant_id287991"></a>Record prompts.</p></li><li class="listitem"><p><a id="Autoattendant_id287995"></a><a id="Autoattendant_id287997"></a>Build the dialplan for the
        menu.</p></li><li class="listitem"><p><a id="Autoattendant_id288002"></a><a id="Autoattendant_id288004"></a>Direct the incoming channels to the
        auto attendant context.</p></li></ul></div><p><a id="Autoattendant_id288010"></a>We will start by talking about
    recordings.</p><div class="sect2" title="Recording Prompts"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id288013"></a>Recording Prompts</h3></div></div></div><p><a id="Autoattendant_id288019"></a><a id="I_indexterm15_d1e33673" class="indexterm"></a><a id="I_indexterm15_d1e33680" class="indexterm"></a><a id="I_indexterm15_d1e33683" class="indexterm"></a>Recording prompts for a telephone system is a critical
      task. This is what your callers will hear when they interact with your
      system, and the quality and professionalism of these prompts will
      reflect on your organization.</p><p><a id="Autoattendant_id288024"></a>Asterisk is very flexible in this
      regard and can work with many different audio formats. We have found
      that, in general, the most useful format to use is WAV. Files saved in
      this format can be of many different kinds, but only one type of WAV
      file will work with Asterisk: files must be encoded in 16-bit, 8000 Hz,
      mono format.</p><div class="sidebar" title="Recommended Prompt File Format"><a id="Autoattendant_id288030"></a><div class="titlepage"><div><div><p class="title"><strong>Recommended Prompt File Format</strong></p></div></div></div><p><a id="Autoattendant_id288032"></a>The WAV file format <a id="I_indexterm15_d1e33696" class="indexterm"></a>we have recommended is useful for system prompts because
        it is a format that can easily be converted to any other format that
        your phones might use without distortion, and one that almost any
        computer can play without any special software. Thus, not only can
        Asterisk handle the file easily, but it is also easy to work with it
        on a PC (which can be useful). Asterisk can handle other file formats
        as well, and in some cases these may be more suitable to your needs,
        but in general we find 16-bit 8-kHz WAV files to be the easiest to
        work with and, most of the time, the best-possible quality.</p></div><p><a id="Autoattendant_id288043"></a>There are essentially two ways to get
      prompts into a system. One is to record sound files in a studio or on a
      PC, and then move those files into the system. A second way is to record
      the prompts directly onto the system using a telephone set. We prefer
      the second method.</p><p><a id="Autoattendant_id288049"></a>Our advice is this: don’t get hung up
      on the complexities of recording audio through a PC or in a
      studio.<sup>[<a id="id602128" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id602128" class="footnote">137</a>]</sup> It is generally not necessary. A telephone set will
      produce excellent-quality recordings, and the reasons are simple: the
      microphone and electronics in a telephone are carefully designed to
      capture the human voice in a format that is ideal for transmission on
      telephone networks, and therefore a phone set is also ideal for doing
      prompts. The set will capture the audio in the correct format, and will
      filter out background noise and normalize the decibel level.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Autoattendant_id288067"></a>Yes, a properly produced studio
        prompt <a id="I_indexterm15_d1e33711" class="indexterm"></a><a id="I_indexterm15_d1e33714" class="indexterm"></a>will be superior to a prompt recorded over a telephone,
        but if you don’t have the equipment or experience, take our advice and
        use a telephone to do your recordings, because a poorly produced
        studio prompt will be much worse.</p></div><div class="sect3" title="Using the dialplan to create recordings"><div class="titlepage"><div><div><h4 class="title"><a id="Autoattendant_id288074"></a>Using the dialplan to create recordings</h4></div></div></div><p><a id="Autoattendant_id288079"></a><a id="index-723B511WF2I" class="indexterm"></a>The simplest method of recording prompts is to use the
        <code class="literal">Record()</code> application. For <span class="keep-together">example</span>:</p><p><a id="Autoattendant_id288083"></a><a id="Autoattendant_id288084"></a></p><pre class="programlisting">[context_for_my_handset]
exten =&gt; 101,1,Playback(vm-intro)
exten =&gt; 101,n,Record(maingreeting.wav)
exten =&gt; 101,n,Wait(2)
exten =&gt; 101,n,Playback(maingreeting)
exten =&gt; 101,n,Hangup</pre><p>This extension plays a prompt, issues
        a beep, makes a recording, and plays that recording back.<sup>[<a id="id602249" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id602249" class="footnote">138</a>]</sup> It’s notable that the <code class="literal">Record()</code> application takes the entire
        filename as its argument, while the <code class="literal">Playback()</code> application <a id="I_indexterm15_d1e33753" class="indexterm"></a><a id="I_indexterm15_d1e33756" class="indexterm"></a>excludes the filetype extension (<code class="filename">.wav</code>, <code class="filename">.gsm</code>, etc.). This is because the <code class="literal">Record()</code> application <a id="I_indexterm15_d1e33772" class="indexterm"></a><a id="I_indexterm15_d1e33775" class="indexterm"></a>needs to know which format the recording should be made
        in, while the <code class="literal">Playback()</code>
        application does not. Instead, <code class="literal">Playback()</code> automatically selects the best
        audio format available, based upon the codec your handset is using and
        the formats available in the <span class="emphasis"><em>sounds</em></span> folder (for
        example, if you have a <code class="filename">maingreeting.wav</code> and a <code class="filename">maingreeting.gsm</code> file in your <code class="filename">sounds</code> folder, <code class="literal">Playback()</code> will select the one that requires
        the least CPU to play back to the caller).</p><p><a id="Autoattendant_id288127"></a>You’ll probably want a separate
        extension for recording each of the prompts, possibly hidden away from
        your normal set of extensions, to avoid a mistyped extension from
        wiping out any of your current menu prompts. If the number of prompts
        that you have is large, repeating this extension with slight
        modifications for each will get tedious, but there are ways around
        that. We’ll show you how to make your prompt recording more
        intelligent in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR" title="Chapter 17. Interactive Voice Response">Chapter&nbsp;17, <em>Interactive Voice Response</em></a>, but for now, this
        method will suffice.</p></div></div><div class="sect2" title="The Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id288137"></a>The Dialplan</h3></div></div></div><p><a id="Autoattendant_id288143"></a><a id="I_indexterm15_d1e33811" class="indexterm"></a>Here is the code required to create the auto attendant
      that we designed earlier. We will often use blank lines before labels
      within an extension in order to make the dialplan easier to read, but
      note that just because there is a blank line does not mean there is a
      different extension:</p><a id="Autoattendant_id288149"></a><pre class="programlisting">[main_menu]

exten =&gt; s,1,Verbose(1, Caller ${CALLERID(all)} has entered the auto attendant)
    same =&gt; n,Answer()

; this sets the inter-digit timer
    same =&gt; n,Set(TIMEOUT(digit)=2)

; wait one second to establish audio
    same =&gt; n,Wait(1)

; If Mon-Fri 9-5 goto label daygreeting
    same =&gt; n,GotoIfTime(9:00-17:00,mon-fri,*,*?daygreeting:afterhoursgreeting)

    same =&gt; n(afterhoursgreeting),Background(after-hours) ; AFTER HOURS GREETING
    same =&gt; n,Goto(menuprompt)

    same =&gt; n(daygreeting),Background(daytime)   ; DAY GREETING
    same =&gt; n,Goto(menuprompt)

    same =&gt; n(menuprompt),Background(main-menu) ; MAIN MENU PROMPT
    same =&gt; n,WaitExten(4)                      ; more than 4 seconds is probably
                                                ; too much
    same =&gt; n,Goto(0,1)                         ; Treat as if caller has pressed '0'

exten =&gt; 1,1,Verbose(1, Caller ${CALLERID(all)} has entered the sales queue)
    same =&gt; n,Goto(Queues,7002,1)     ; Sales Queue - see Chapter 13 for details

exten =&gt; 2,1,Verbose(1, Caller ${CALLERID(all)} has entered the service queue)
    same =&gt; n,Goto(Queues,7001,1)     ; Service Queue - see Chapter 13 for details

exten =&gt; 3,1,Verbose(1, Caller ${CALLERID(all)} has requested address and fax info)
    same =&gt; n,Background()            ; Address and fax info
    same =&gt; n,Goto(s,menuprompt)      ; Take caller back to main menu prompt

exten =&gt; #,1,Verbose(1, Caller ${CALLERID(all)} is entering the directory)
    same =&gt; n,Directory(default)   ; Send the caller to the directory.
                                   ; Use InternalSets as the dialing context

exten =&gt; 0,1,Verbose(1, Caller ${CALLERID(all)} is calling the operator)
    same =&gt; n,Dial(SIP/operator)      ; Operator extension/queue

exten =&gt; i,1,Verbose(1, Caller ${CALLERID(all)} has entered an invalid selection)
    same =&gt; n,Playback(invalid)
    same =&gt; n,Goto(s,menuprompt)

exten =&gt; t,1,Verbose(1, Caller ${CALLERID(all)} has timed out)
    same =&gt; n,Goto(0,1)


; You will want to have a pattern match for the various extensions
; that you'll allow external callers to dial
; BUT DON'T JUST INCLUDE THE LocalSets CONTEXT
; OR EXTERNAL CALLERS WILL BE ABLE TO MAKE CALLS OUT OF YOUR SYSTEM

; WHATEVER YOU DO HERE, TEST IT CAREFULLY TO ENSURE EXTERNAL CALLERS
; WILL NOT BE ABLE TO DO ANYTHING BUT DIAL INTERNAL EXTENSIONS

exten =&gt; _1XX,1,Verbose(1,Call to an extension starting with '1'
    same =&gt; n,Goto(InternalSets,${EXTEN},1)<a id="I_indexterm15_d1e33823" class="indexterm"></a>

</pre><p><a id="Autoattendant_id288189"></a></p></div><div class="sect2" title="Delivering Incoming Calls to the Auto Attendant"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id288192"></a>Delivering Incoming Calls to the Auto Attendant</h3></div></div></div><p><a id="Autoattendant_id288198"></a><a id="I_indexterm15_d1e33830" class="indexterm"></a><a id="I_indexterm15_d1e33837" class="indexterm"></a>Any call coming into the system will enter the dialplan in
      the context defined for whatever channel the call arrives on. In many
      cases this will be a context named <code class="literal">incoming</code>, or <code class="literal">from-pstn</code>, or something similar. The calls
      will arrive either with an extension (as would be the case with a DID)
      or without one (which would be the case with a traditional analog
      line).</p><p><a id="Autoattendant_id288211"></a>Whatever the name of the context, and
      whatever the name of the extension, you will want to send each incoming
      call to the menu. Here are a few examples:</p><p><a id="Autoattendant_id288216"></a><a id="Autoattendant_id288217"></a></p><pre class="programlisting">[from-pstn] ; an analog line that has context=from-pstn (typically a DAHDI channel)
exten =&gt; s,1,Goto(main_menu,s,1)</pre><p><a id="Autoattendant_id288221"></a></p><pre class="programlisting">[incoming] ; a DID coming in on a channel with context=incoming (PRI, SIP, or IAX)
exten =&gt; 4169671111,1,Goto(main_menu,s,1)
</pre><p>Depending on how you configure your incoming channels, you
      will generally want to use the <code class="literal">Goto()</code>
      application if you want to send the call to an auto attendant. This is
      far neater than just coding everything in the <code class="literal">incoming</code> context.</p></div><div class="sect2" title="IVR"><div class="titlepage"><div><div><h3 class="title"><a id="Autoattendant_id288230"></a>IVR</h3></div></div></div><p><a id="Autoattendant_id288235"></a>We’ll cover Interactive Voice Response
      (IVR) in more depth in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR" title="Chapter 17. Interactive Voice Response">Chapter&nbsp;17, <em>Interactive Voice Response</em></a> but before we do
      that, we’re going to talk about something that is essential to any IVR:
      database integration is the subject of the next chapter.<a id="I_indexterm15_d1e33868" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Autoattendant_id36001995"></a>Conclusion</h2></div></div></div><p><a id="Autoattendant_id36002001"></a>An automated attendant can provide a
    very useful service to callers. However, if it is not designed and
    implemented well, it can also be a barrier to your callers that may well
    drive them away. Take the time to carefully plan out your auto attendant,
    and keep it simple.<a id="I_indexterm15_d1e33874" class="indexterm"></a><a id="I_indexterm15_d1e33875" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id600874" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id600874" class="para">134</a>] </sup>It should be noted that Asterisk is an excellent IVR-creation
        tool. It’s not bad for building automated attendants either.</p></div><div class="footnote"><p><sup>[<a id="ftn.id601474" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id601474" class="para">135</a>] </sup>If necessary, you can use an audio editing program such as
          Audacity to remove silence, and even to speed up the recording a
          bit.</p></div><div class="footnote"><p><sup>[<a id="ftn.id601508" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id601508" class="para">136</a>] </sup>In fact, we don’t normally recommend this in an AA because it
          adds to what the caller has to listen to, and most people will go to
          a website for this sort of information.</p></div><div class="footnote"><p><sup>[<a id="ftn.id602128" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id602128" class="para">137</a>] </sup>Unless you are an expert in these areas, in which case go for
          it!</p></div><div class="footnote"><p><sup>[<a id="ftn.id602249" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id602249" class="para">138</a>] </sup>The <span class="emphasis"><em>vm-intro</em></span> prompt isn’t perfect (it
            asks you to leave a message), but it’s close enough for our
            purposes. The usage instructions at least are correct: press pound
            to end the recording. Once you’ve gotten the hang of recording
            prompts, you can go back, record a custom prompt, and change
            priority 1 to reflect more appropriate instructions for recording
            your own prompts.</p></div></div></div><div class="chapter" title="Chapter 16. Relational Database Integration"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-DB"></a>Chapter&nbsp;16.&nbsp;Relational Database Integration</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#managing_databases">Installing and Configuring PostgreSQL and MySQL</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database">Installing PostgreSQL for CentOS</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id254247">Installing PostgreSQL for Ubuntu</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id262627">Installing MySQL for CentOS</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id253003">Installing MySQL for Ubuntu</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql">Configuring PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc">Installing and Configuring ODBC</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#test">Configuring ODBC for PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246760">Configuring ODBC for MySQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247345">Managing Databases</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287575">Troubleshooting Database Issues</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287624">A Gentle Introduction to func_odbc</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578">ODBC Voicemail</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#psql_large_object_support">Creating the Large Object Type for PostgreSQL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276920">ODBC Voicemail Storage Table Layout</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1610">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Database_id264349"></a>Few things are harder to put up with than the
    annoyance of a good example.</p><div class="attribution"><span>—<span class="attribution">Mark Twain</span></span></div></div><p><a id="Database_id267961"></a><a id="index-401S100GL0U" class="indexterm"></a><a id="index-043I378SA1N" class="indexterm"></a>In this chapter we are going to explore integrating some
  Asterisk features and functions into a database. There are several databases
  available for Linux, but we have chosen to limit our discussion to the two
  most popular: PostgreSQL and MySQL.</p><p><a id="Database_id251400"></a>We will also explain how to configure Linux to
  connect to a Microsoft SQL database via ODBC; however, configuration of the
  Windows/Microsoft portion is beyond the scope of this book.</p><p><a id="Database_id251009"></a>Regardless of which database you use, this
  chapter focuses primarily on the ODBC connector,<a id="I_indexterm16_d1e33898" class="indexterm"></a> so as long as you have some familiarity with getting your
  favorite database ODBC-ready, you shouldn’t have any problems with this
  chapter.</p><p><a id="Database_id253988"></a>Integrating Asterisk with databases is one of
  the fundamental aspects of building a large clustered or distributed system.
  The power of the database will enable you to use dynamically changing data
  in your dialplans, for tasks such as sharing information across an array of
  Asterisk systems or integrating with web-based services. Our favorite
  <span class="keep-together">dial</span><span class="keep-together">plan</span> function, which we will cover later in
  this chapter, is <code class="literal">func_odbc</code>.</p><p><a id="Database_id290754"></a>While not all Asterisk deployments will require
  relational databases, understanding how to harness them opens a treasure
  chest full of new ways to design your telecom solution.</p><div class="sect1" title="Installing and Configuring PostgreSQL and MySQL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="managing_databases"></a>Installing and Configuring PostgreSQL and MySQL</h2></div></div></div><p><a id="Database_id253486"></a><a id="index-554H457UM3R" class="indexterm"></a>In the following sections we will show how to install and
    configure PostgreSQL and MySQL on both CentOS and Ubuntu.<sup>[<a id="id602908" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id602908" class="footnote">139</a>]</sup> It is recommended that you only install one database at a
    time while working through this section. Pick the database you are most
    comfortable with, as there is no wrong choice.</p><div class="sect2" title="Installing PostgreSQL for CentOS"><div class="titlepage"><div><div><h3 class="title"><a id="installing_the_database"></a>Installing PostgreSQL for CentOS</h3></div></div></div><p><a id="Database_id287168"></a><a id="I_indexterm16_d1e33933" class="indexterm"></a><a id="I_indexterm16_d1e33938" class="indexterm"></a><a id="I_indexterm16_d1e33943" class="indexterm"></a>The following command can be used to install the
      PostgreSQL server and its dependencies from the console:</p><p><a id="Database_id259670"></a><a id="Database_id267642"></a></p><pre class="screen"><strong class="userinput"><code><code class="prompt">$</code> sudo yum install -y postgresql-server</code></strong>
Install       3 Package(s)
Upgrade       0 Package(s)

Total download size: 6.9 M
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong></pre><p><a id="Database_id265952"></a>Then start the database, which will take a
      few seconds to initialize for the first time:</p><p><a id="Database_id264011"></a><a id="Database_id266565"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo service postgresql start</code></strong></pre><p>Now
      head to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql" title="Configuring PostgreSQL">the section called “Configuring PostgreSQL”</a> for
      instructions on how to perform the initial configuration.</p></div><div class="sect2" title="Installing PostgreSQL for Ubuntu"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id254247"></a>Installing PostgreSQL for Ubuntu</h3></div></div></div><p><a id="Database_id254253"></a><a id="I_indexterm16_d1e33974" class="indexterm"></a><a id="I_indexterm16_d1e33979" class="indexterm"></a><a id="I_indexterm16_d1e33984" class="indexterm"></a>To install PostgreSQL on Ubuntu, run the following
      command. You will be prompted to also install any additional packages
      that are dependencies of the application. Press <span class="keycap"><strong>Enter</strong></span> to accept the list of dependencies, at
      which point the packages will be installed and PostgreSQL will be
      automatically started and initialized:</p><p><a id="Database_id262605"></a><a id="Database_id262606"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install postgresql</code></strong>
...
<code class="computeroutput">After this operation, 19.1MB of additional disk space will be used.
Do you want to continue [Y/n]?</code> <strong class="userinput"><code>y</code></strong></pre><p>Now
      head to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql" title="Configuring PostgreSQL">the section called “Configuring PostgreSQL”</a> for
      instructions on how to perform the initial configuration.</p></div><div class="sect2" title="Installing MySQL for CentOS"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id262627"></a>Installing MySQL for CentOS</h3></div></div></div><p><a id="Database_id262633"></a><a id="I_indexterm16_d1e34014" class="indexterm"></a><a id="I_indexterm16_d1e34019" class="indexterm"></a><a id="I_indexterm16_d1e34024" class="indexterm"></a>To install MySQL on CentOS, run the following command. You
      will be prompted to install several dependencies. Press <span class="keycap"><strong>Enter</strong></span> to accept, and the MySQL server and
      dependency packages will be installed:</p><p><a id="Database_id252978"></a><a id="Database_id252979"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install mysql-server
</code></strong>Install       5 Package(s)
Upgrade       0 Package(s)

Total download size: 27 M
Is this ok [y/N]: <strong class="userinput"><code>y</code></strong></pre><p>Then start the MySQL database by running:</p><p><a id="Database_id252986"></a><a id="Database_id252987"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo service mysqld start</code></strong></pre><p><a id="Database_id252992"></a>Now head to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql" title="Configuring MySQL">the section called “Configuring MySQL”</a> to perform the initial
      configuration.</p></div><div class="sect2" title="Installing MySQL for Ubuntu"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id253003"></a>Installing MySQL for Ubuntu</h3></div></div></div><p><a id="Database_id253008"></a><a id="I_indexterm16_d1e34061" class="indexterm"></a><a id="I_indexterm16_d1e34066" class="indexterm"></a><a id="I_indexterm16_d1e34071" class="indexterm"></a>To install MySQL on Ubuntu, run the following command. You
      will be prompted to install several dependencies. Press <span class="keycap"><strong>Enter</strong></span> to accept, and the MySQL server and its
      dependency packages will be installed:</p><p><a id="Database_id265356"></a><a id="Database_id265357"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install mysql-server
</code></strong>Need to get 24.0MB of archives.
After this operation, 60.6MB of additional disk space will be used.
Do you want to continue [Y/n]? <strong class="userinput"><code>y</code></strong></pre><p>During
      the installation, you will be placed into a configuration wizard to help
      you through the initial configuration of the database. You will be
      prompted to enter a new password for the <span class="emphasis"><em>root</em></span> user.
      Type in a strong password and press <span class="keycap"><strong>Enter</strong></span>. You will then be asked to confirm the
      password. Type your strong password again, followed by <span class="keycap"><strong>Enter</strong></span>. You will then be returned to the
      console, where the installation will complete. The MySQL service will
      now be running.</p><p><a id="Database_id265380"></a>Now head to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql" title="Configuring MySQL">the section called “Configuring MySQL”</a> to perform the initial
      configuration.</p></div><div class="sect2" title="Configuring PostgreSQL"><div class="titlepage"><div><div><h3 class="title"><a id="database_configuring-postgresql"></a>Configuring PostgreSQL</h3></div></div></div><p><a id="Database_id265398"></a><a id="I_indexterm16_d1e34108" class="indexterm"></a><a id="I_indexterm16_d1e34113" class="indexterm"></a>Next, create a user called <span class="emphasis"><em>asterisk</em></span>,
      which you will use to connect to and manage the database. You can switch
      to the <span class="emphasis"><em>postgres</em></span> user by using the following
      command:</p><a id="Database_id265011"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo su - postgres</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id265001"></a>At the time of this writing, PostgreSQL
        version 8.1.<span class="emphasis"><em>x</em></span> is utilized on <span class="keep-together">CentOS</span>, and 8.4.x on Ubuntu.</p></div><p><a id="Database_id265017"></a>Then run the following commands to create
      the <span class="emphasis"><em>asterisk</em></span> user in the database and set up
      permissions:</p><p><a id="Database_id265028"></a><a id="Database_id265029"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>createuser -P</code></strong>
<code class="computeroutput">Enter name of user to add:</code> <strong class="userinput"><code>asterisk</code></strong>
<code class="computeroutput">Enter password for new user:</code>
<code class="computeroutput">Enter it again:</code>
<code class="computeroutput">Shall the new role be a superuser? (y/n)</code> <strong class="userinput"><code><strong class="userinput"><code>n</code></strong></code></strong>
<code class="computeroutput">Shall the new user be allowed to create databases? (y/n)</code> <strong class="userinput"><code>y</code></strong>
<code class="computeroutput">Shall the new user be allowed to create more new users? (y/n)</code> <strong class="userinput"><code>n</code></strong>
<code class="computeroutput">CREATE ROLE</code></pre><p><a id="Database_id265067"></a>Now, edit the <code class="filename">pg_hba.conf</code> file in order to allow the
      <span class="emphasis"><em>asterisk</em></span> user you just created to connect to the
      PostgreSQL server over the TCP/IP socket.</p><p>On CentOS, this file will be located at <code class="filename">/var/lib/pgsql/data/pg_hba.conf</code>. On Ubuntu,
      you will find it at <code class="filename">/etc/postgresql/8.4/main/pg_hba.conf</code>.</p><p><a id="Database_id289480"></a>At the end of the file, replace everything
      below this line:</p><a id="I_programlisting16_d1e34206"></a><pre class="programlisting"># TYPE DATABASE USER CIDR-ADDRESS METHOD</pre><p><a id="Database_id289488"></a>with the following:</p><p><a id="Database_id289491"></a><a id="Database_id289492"></a></p><pre class="programlisting"># TYPE  DATABASE USER     CIDR-ADDRESS  METHOD
host    all      asterisk 127.0.0.1/32  md5
local   all      asterisk               trust</pre><div class="sidebar" title="Configuring PostgreSQL Database Access via IPv6 localhost"><a id="Database_id289497"></a><div class="titlepage"><div><div><p class="title"><strong>Configuring PostgreSQL Database Access via IPv6
        localhost</strong></p></div></div></div><p><a id="Database_id289503"></a><a id="I_indexterm16_d1e34218" class="indexterm"></a>Also, on Ubuntu you will likely need to add the
        following line:</p><p><a id="Database_id289506"></a><a id="Database_id289507"></a></p><pre class="programlisting">host    all     asterisk          ::1/128                               md5</pre><p>Without
        it, when you get to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc" title="Validating the ODBC Connector">the section called “Validating the ODBC Connector”</a> you
        may end up with the following error when connecting:</p><p><a id="Database_id289519"></a><a id="Database_id289520"></a></p><pre class="screen">[28000][unixODBC]FATAL:  no pg_hba.conf entry for host "::1", user "asterisk", 
database "asterisk", SSL off
[ISQL]ERROR: Could not SQLConnect</pre></div><p><a id="Database_id289526"></a>Now you can create the database that we
      will use throughout this chapter. Call the database <code class="filename">asterisk</code> and set the owner to your
      <span class="emphasis"><em>asterisk</em></span> user:</p><a id="Database_id289538"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>createdb --owner=asterisk asterisk</code></strong>
<code class="computeroutput">CREATE DATABASE</code></pre><p><a id="Database_id289547"></a>You can set the password for the
      <span class="emphasis"><em>asterisk</em></span> user like so:</p><p><a id="Database_id327266"></a><a id="Database_id327267"></a></p><pre class="screen">$ <strong class="userinput"><code>psql -d template1</code></strong>
template1=# <strong class="userinput"><code>"ALTER USER asterisk WITH PASSWORD '<em class="replaceable"><code>password</code></em>'"</code></strong>
template1=# <strong class="userinput"><code>\q</code></strong></pre><p>Exit from the
      <span class="emphasis"><em>postgres</em></span> user:</p><p><a id="Database_id281663"></a><a id="Database_id281664"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>exit</code></strong></pre><p><a id="Database_id281670"></a>Then restart the PostgreSQL server. On
      CentOS:</p><p><a id="Database_id281673"></a><a id="Database_id281674"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo service postgresql restart</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id327289"></a>You need to restart the PostgreSQL
          service because you made changes to <code class="filename">pg_hba.conf</code>, not because you added a new
          user or changed the password.</p></div><p>On Ubuntu:</p><p><a id="Database_id281681"></a><a id="Database_id281682"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo /etc/init.d/postgresql-8.4 restart</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id305205"></a>On Ubuntu 10.10 and newer the version
          number seems to be dropped, so it may just be <span class="command"><strong>/etc/init.d/postgresql restart</strong></span>.</p></div><p>You can verify your connection to the PostgreSQL server via
      TCP/IP, like so:</p><p><a id="Database_id281689"></a><a id="I_programlisting12_tt1447"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>psql -h 127.0.0.1 -U asterisk</code></strong><code class="computeroutput"> 
Password for user asterisk:

Welcome to psql 8.1.21, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

<code class="prompt">asterisk=&gt;</code></code></pre><p>You’re
      now ready to move on to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc" title="Installing and Configuring ODBC">the section called “Installing and Configuring ODBC”</a>.</p></div><div class="sect2" title="Configuring MySQL"><div class="titlepage"><div><div><h3 class="title"><a id="database_configuring-mysql"></a>Configuring MySQL</h3></div></div></div><p><a id="Database_id281729"></a><a id="I_indexterm16_d1e34327" class="indexterm"></a><a id="I_indexterm16_d1e34332" class="indexterm"></a>With the MySQL database now running, you should secure
      your installation. Conveniently, there is a script you can execute that
      will allow you to enter a new password<sup>[<a id="id604093" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id604093" class="footnote">140</a>]</sup> for the <span class="emphasis"><em>root</em></span> user, along with some
      additional options. The script is pretty straightforward, and after
      entering and confirming your root password you can continue to select
      the defaults unless you have a specific reason not to.</p><p><a id="Database_id281753"></a>Execute the following script:</p><p><a id="Database_id281756"></a><a id="Database_id281757"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo /usr/bin/mysql_secure_installation</code></strong></pre><p><a id="Database_id281763"></a>Then connect to the database console so you
      can create your <span class="emphasis"><em>asterisk</em></span> user and set up
      permissions:</p><p><a id="Database_id281767"></a><a id="Database_id281768"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>mysql -u root -p</code></strong>
<code class="computeroutput">Enter password:</code></pre><p>After
      entering the password, you will be presented with the <code class="literal">mysql</code> console prompt. You can now create your
      <span class="emphasis"><em>asterisk</em></span> user by executing the <code class="literal">CREATE USER</code> command. The <code class="literal">%</code> is a wildcard indicating the
      <span class="emphasis"><em>asterisk</em></span> user can connect from any host and is
      <code class="literal">IDENTIFIED BY</code> the password
      <em class="replaceable"><code>some_secret_password</code></em> (which you should
      obviously change). Note the trailing semicolon:</p><p><a id="Database_id281802"></a><a id="Database_id281804"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>CREATE USER 'asterisk'@'%' IDENTIFIED BY 'some_secret_password';</code></strong><code class="computeroutput">
Query OK, 0 rows affected (0.00 sec)</code></pre><p>Let’s also
      create the initial database you’ll use throughout this chapter:</p><p><a id="Database_id281814"></a><a id="Database_id281815"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>CREATE DATABASE asterisk;</code></strong>
<code class="computeroutput">Query OK, 1 rows affected (0.00 sec)</code></pre><p>Now
      that you’ve created your user and database, you need to assign
      permissions for the <code class="filename">asterisk</code> user
      to access the <code class="filename">asterisk</code>
      database:</p><p><a id="Database_id281834"></a><a id="Database_id281835"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>GRANT ALL PRIVILEGES ON asterisk.* TO 'asterisk'@'%';</code></strong>
<code class="computeroutput">Query OK, 0 rows affected (0.00 sec)</code></pre><p>Finally,
      exit from the console and verify that your permissions are correct by
      logging back into the <span class="emphasis"><em>asterisk</em></span> database as the
      <span class="emphasis"><em>asterisk</em></span> user:</p><p><a id="Database_id281853"></a><a id="Database_id281854"></a></p><pre class="screen">mysql&gt; <strong class="userinput"><code>exit</code></strong>
<code class="computeroutput">Bye</code>
# <strong class="userinput"><code>mysql -u asterisk -p asterisk</code></strong>
<code class="computeroutput">Enter password:</code>

<code class="prompt">mysql&gt;</code></pre><p>You’re now ready to move on
      to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc" title="Installing and Configuring ODBC">the section called “Installing and Configuring ODBC”</a>.<a id="I_indexterm16_d1e34468" class="indexterm"></a></p></div></div><div class="sect1" title="Installing and Configuring ODBC"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="installing_configuring_odbc"></a>Installing and Configuring ODBC</h2></div></div></div><p><a id="Database_id281887"></a><a id="index-515B863KJ4E" class="indexterm"></a>The ODBC connector is a database abstraction layer that
    makes it possible for Asterisk to communicate with a wide range of
    databases without requiring the developers to create a separate database
    connector for every database Asterisk wants to support. This saves a lot
    of development effort and code maintenance. There is a slight performance
    cost, because we are adding another application layer between Asterisk and
    the database, but this can be mitigated with proper design and is well
    worth it when you need powerful, flexible database capabilities in your
    Asterisk system.</p><p><a id="Database_id281896"></a>Before you install the connector in Asterisk,
    you have to install ODBC into Linux <a id="I_indexterm16_d1e34481" class="indexterm"></a>itself. To install the ODBC drivers, use one of the
    following commands.</p><p><a id="Database_id281900"></a>On CentOS:</p><p><a id="Database_id281917"></a><a id="I_programlisting12_tt1451"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install unixODBC unixODBC-devel libtool-ltdl libtool-ltdl-devel</code></strong></pre><p>
    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id281907"></a>If you’re using a 64-bit installation,
        remember to add <code class="filename">.x86_64</code> to the
        end of your development packages to make sure the i386 packages are
        not also installed, as stability problems can result if Asterisk links
        against the wrong libraries.</p></div><p><a id="Database_id281931"></a>On Ubuntu:</p><p><a id="Database_id281934"></a><a id="Database_id281935"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install unixODBC unixODBC-dev</code></strong></pre><p><a id="Database_id281941"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id281944"></a>See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a>
        for the matrix of packages you should have installed.</p></div><p><a id="Database_id281955"></a>You’ll also need to install the
    <span class="emphasis"><em>unixODBC</em></span> development package, because Asterisk uses
    it to build the ODBC modules we will be using throughout this
    chapter.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Database_id281964"></a>The <span class="emphasis"><em>unixODBC</em></span> drivers
      shipped with distributions are often a few versions behind the
      officially released versions on the <a class="ulink" href="http://www.unixodbc.org/" target="_top">http://www.unixodbc.org</a> website. If you have stability
      issues while using <span class="emphasis"><em>unixODBC</em></span>, you may need to
      install from source. Just be sure to remove the
      <span class="emphasis"><em>unixODBC</em></span> drivers via your package manager first,
      and then update the paths in your <code class="filename">/etc/odbcinst.ini</code> file.</p></div><p><a id="Database_id281981"></a>By default, CentOS will install the drivers
    for connecting to PostgreSQL databases via ODBC. To install the drivers
    for MySQL, execute the following command:</p><p><a id="Database_id281986"></a><a id="Database_id281987"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install mysql-connector-odbc</code></strong></pre><p><a id="Database_id281990"></a>To install the PostgreSQL ODBC connector on
    Ubuntu:</p><p><a id="Database_id281994"></a><a id="Database_id281995"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install odbc-postgresql</code></strong></pre><p>Or
    to install the MySQL ODBC connector on Ubuntu:</p><a id="Database_id282000"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install libmyodbc</code></strong></pre><div class="sect2" title="Configuring ODBC for PostgreSQL"><div class="titlepage"><div><div><h3 class="title"><a id="test"></a>Configuring ODBC for PostgreSQL</h3></div></div></div><p><a id="Database_id282015"></a><a id="I_indexterm16_d1e34570" class="indexterm"></a><a id="I_indexterm16_d1e34575" class="indexterm"></a><a id="I_indexterm16_d1e34580" class="indexterm"></a>Configuration for the PostgreSQL ODBC driver is done in
      the <code class="filename">/etc/odbcinst.ini</code> file.</p><p><a id="Database_id282024"></a>On CentOS the default file already contains
      some data, including that for PostgreSQL, so just verify that the data
      exists. The file will look like the following:</p><p><a id="Database_id282029"></a><a id="I_programlisting12_tt1453"></a></p><pre class="programlisting">[PostgreSQL]
Description     = ODBC for PostgreSQL
Driver          = /usr/lib/libodbcpsql.so
Setup           = /usr/lib/libodbcpsqlS.so
FileUsage       = 1</pre><p><a id="Database_id282040"></a>On Ubuntu, the <code class="filename">/etc/odbcinst.ini</code> file will be blank, so
      you’ll need to add the data to that configuration file. Add the
      following to the <code class="filename">odbcinst.ini</code>
      file:</p><p><a id="Database_id282051"></a><a id="Database_id282052"></a></p><pre class="programlisting">[PostgreSQL]
Description     = ODBC for PostgreSQL
Driver          = /usr/lib/odbc/psqlodbca.so
Setup           = /usr/lib/odbc/libodbcpsqlS.so
FileUsage       = 1</pre><p><a id="Database_id282057"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id282060"></a>On 64-bit systems, you will need to
          change the path of the libraries from <code class="filename">/usr/lib/</code> to <code class="filename">/usr/lib64/</code> in order to access the
          correct library files.</p></div><p>In either case, you can use <span class="command"><strong>cat &gt;
      /etc/odbcinst.ini</strong></span> to write a clean configuration file, as
      we’ve done in other chapters. Just use <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span> to save the file once you’re done.</p><p><a id="Database_id282088"></a>Verify that the system is able to see the
      driver by running the following command. It should return the label name
      <code class="literal">PostgreSQL</code> if all is well:</p><p><a id="Database_id282098"></a><a id="I_programlisting12_tt1454"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>odbcinst -q -d</code></strong><code class="computeroutput">
[PostgreSQL]</code></pre><p>Next, configure the <code class="filename">/etc/odbc.ini</code> file, which is used to create
      an identifier that Asterisk will use to reference this configuration. If
      at any point in the future you need to change the database to something
      else, you simply need to reconfigure this file, allowing <span class="keep-together">Asterisk</span> to continue to point to the same
      place<sup>[<a id="id522490" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id522490" class="footnote">141</a>]</sup>:</p><p><a id="Database_id246743"></a><a id="I_programlisting12_tt1455"></a></p><pre class="programlisting">[asterisk-connector]
Description         = PostgreSQL connection to 'asterisk' database
Driver              = PostgreSQL
Database            = asterisk
Servername          = localhost
UserName            = asterisk
Password            = <em class="replaceable"><code>welcome</code></em>
Port                = 5432
Protocol            = 8.1
ReadOnly            = No
RowVersioning       = No
ShowSystemTables    = No
ShowOidColumn       = No
FakeOidIndex        = No
ConnSettings        =
</pre></div><div class="sect2" title="Configuring ODBC for MySQL"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id246760"></a>Configuring ODBC for MySQL</h3></div></div></div><p><a id="Database_id246766"></a><a id="I_indexterm16_d1e34678" class="indexterm"></a><a id="I_indexterm16_d1e34683" class="indexterm"></a><a id="I_indexterm16_d1e34688" class="indexterm"></a>Configuration for the MySQL ODBC driver is done in the
      <code class="filename">/etc/odbcinst.ini</code> file.</p><p><a id="Database_id246774"></a>On CentOS the default file already contains
      some data, including that for MySQL, but it needs to be uncommented and
      requires a couple of changes. Replace the existing text with the
      following:</p><p><a id="Database_id246780"></a><a id="Database_id246781"></a></p><pre class="programlisting">[MySQL]
Description = ODBC for MySQL
Driver = /usr/lib/libmyodbc3.so
Setup = /usr/lib/libodbcmyS.so
FileUsage = 1</pre><p><a id="Database_id246785"></a>On Ubuntu, the <code class="filename">/etc/odbcinst.ini</code> file will be blank, so
      you’ll need to add the data to that configuration file. Add the
      following to the <code class="filename">odbcinst.ini</code>
      file:</p><p><a id="Database_id246796"></a><a id="Database_id246797"></a></p><pre class="programlisting">[MySQL]
Description = ODBC for MySQL
Driver = /usr/lib/odbc/libmyodbc.so
Setup = /usr/lib/odbc/libodbcmyS.so
FileUsage = 1</pre><p><a id="Database_id246801"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id246804"></a>On 64-bit systems, you will need to
          change the path of the libraries from <code class="filename">/usr/lib/</code> to <code class="filename">/usr/lib64/</code> in order to access the
          correct library files.</p></div><p>In either case, you can use <span class="command"><strong>cat &gt;
      /etc/odbcinst.ini</strong></span> to write a clean configuration file, as
      we’ve done in other chapters. Just use <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span> to save the file once you’re done.</p><p><a id="Database_id246833"></a>Verify that the system is able to see the
      driver by running the following command. It should return the label name
      <code class="literal">MySQL</code> if all is well:</p><p><a id="Database_id246843"></a><a id="Database_id246844"></a></p><pre class="programlisting"># <strong class="userinput"><code>odbcinst -q -d</code></strong><code class="computeroutput">
[MySQL]</code></pre><p>Next, configure the <code class="filename">/etc/odbc.ini</code> file, which is used to create
      an identifier that Asterisk will use to reference this configuration. If
      at any point in the future you need to change the database to something
      else, you simply need to reconfigure this file, allowing <span class="keep-together">Asterisk</span> to continue to point to the same
      place:</p><p><a id="Database_id246903"></a><a id="Database_id246904"></a></p><pre class="programlisting">[asterisk-connector]
Description           = MySQL connection to 'asterisk' database
Driver                = MySQL
Database              = asterisk
Server                = localhost
UserName              = asterisk
Password              = <em class="replaceable"><code>welcome</code></em>
Port                  = 3306
Socket                = /var/lib/mysql/mysql.sock</pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id329592"></a>On Ubuntu 10.10, the socket location is
          <code class="filename">/var/run/mysqld/mysqld.sock</code>.</p></div></div><div class="sect2" title="Configuring ODBC for Microsoft SQL"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id246915"></a>Configuring ODBC for Microsoft SQL</h3></div></div></div><p><a id="Database_id246920"></a><a id="I_indexterm16_d1e34768" class="indexterm"></a><a id="I_indexterm16_d1e34773" class="indexterm"></a><a id="I_indexterm16_d1e34778" class="indexterm"></a>Connecting to Microsoft SQL (MS SQL) is similar to
      connecting to either MySQL or PostgreSQL, as we’ve previously discussed.
      The configuration of MS SQL is beyond the scope of this book, but the
      following information will get your Asterisk box configured to connect
      to your MS SQL database once you’ve enabled the appropriate permissions
      on your database.</p><p><a id="Database_id246930"></a>To connect to MS SQL, you need to install
      the FreeTDS drivers using the package manager (or by compiling via the
      source files available at <a class="ulink" href="http://www.freetds.org/" target="_top">http://www.freetds.org</a>).</p><p><a id="Database_id246940"></a>On CentOS:</p><p><a id="Database_id246943"></a><a id="Database_id246944"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install freetds</code></strong></pre><p>On
      Ubuntu:<a id="I_indexterm16_d1e34796" class="indexterm"></a></p><p><a id="Database_id246951"></a><a id="Database_id246952"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install freetds</code></strong></pre><p>After
      installing the drivers, you need to configure the <code class="filename">/etc/odbcinst.ini</code> file, which tells the
      system where the driver files are located.</p><p><a id="Database_id246964"></a>Insert the following text into the
      <code class="filename">/etc/odbcinst.ini</code> file with your
      favorite text editor or with the following command:</p><p><a id="Database_id246971"></a><a id="Database_id246972"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo cat &gt; /etc/odbcinst.ini</code></strong>
<strong class="userinput"><code>[FreeTDS]
Description = ODBC for Microsoft SQL
Driver      = /usr/lib/libtdsodbc.so
UsageCount  = 1
Threading   = 2</code></strong>
<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id246993"></a>If you compiled via source, the files
          may be located in <code class="filename">/usr/local/lib/</code> or (if you compiled on a
          64-bit system) <code class="filename">/usr/local/lib64/</code>.</p></div><p><a id="Database_id247005"></a>Verify that the system is able to see the
      driver by running the following command. It should return the label name
      <code class="literal">FreeTDS</code> if all is well:</p><p><a id="Database_id247015"></a><a id="Database_id247016"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>odbcinst -q -d</code></strong><code class="computeroutput">
[FreeTDS]</code></pre><p>Once you’ve configured the drivers, you need to modify the
      <code class="filename">/etc/odbc.ini</code> file to control how
      to connect to the database:</p><p><a id="Database_id247032"></a><a id="Database_id247033"></a></p><pre class="programlisting">[asterisk-connector]
Description     = MS SQL connection to 'asterisk' database
Driver          = FreeTDS
Database        = asterisk
Server          = 192.168.100.1
UserName        = asterisk
Password        = <em class="replaceable"><code>welcome</code></em>
Trace           = No
TDS_Version     = 7.0
Port            = 1433</pre><p><a id="Database_id247042"></a>In the next section, you will be able to
      validate your connection to the MS SQL server.</p></div><div class="sect2" title="Validating the ODBC Connector"><div class="titlepage"><div><div><h3 class="title"><a id="database_validating-odbc"></a>Validating the ODBC Connector</h3></div></div></div><p><a id="Database_id247062"></a><a id="I_indexterm16_d1e34875" class="indexterm"></a><a id="I_indexterm16_d1e34880" class="indexterm"></a>Now, verify that you can connect to your database using
      the <span class="command"><strong>isql</strong></span> application. <span class="command"><strong>echo</strong></span> the <code class="literal">select
      1</code> statement and pipe it into <span class="command"><strong>isql</strong></span>, which will then connect using the
      <code class="literal">asterisk-connector</code> section you added
      to <code class="filename">/etc/odbc.ini</code>. You should get
      the following output (or at least something similar; we’re looking for a
      result of <code class="literal">1 rows fetched</code>):</p><p><a id="Database_id247093"></a><a id="I_programlisting12_tt1456"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>echo "select 1" | isql -v asterisk-connector</code></strong>
<code class="computeroutput">+---------------------------------------+
| Connected!                            |
|                                       |
| sql-statement                         |
| help [tablename]                      |
| quit                                  |
|                                       |
+---------------------------------------+
SQL&gt; +------------+
| ?column?   |
+------------+
| 1          |
+------------+
SQLRowCount returns 1
1 rows fetched</code>
<code class="prompt">$</code> <strong class="userinput"><code>exit</code></strong></pre><p>With
      <span class="emphasis"><em>unixODBC</em></span> installed, configured, and verified to
      work, you need to recompile Asterisk so that the ODBC modules are
      created and installed. Change back to your Asterisk source directory and
      run the <code class="filename">./configure</code> script so it
      knows you have installed <span class="emphasis"><em>unixODBC</em></span>:</p><p><a id="Database_id247137"></a><a id="I_programlisting12_tt1457"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make menuselect</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make install</code></strong></pre><p><a id="Database_id247166"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id247169"></a>Almost everything in this chapter is
          turned on by default. You will want to run <span class="command"><strong>make menuselect</strong></span><a id="I_indexterm16_d1e34966" class="indexterm"></a><a id="I_indexterm16_d1e34969" class="indexterm"></a> to verify <a id="I_indexterm16_d1e34975" class="indexterm"></a>that the ODBC-related modules are enabled. These
          include <code class="literal">cdr_odbc</code>, <code class="literal">cdr_adaptive_odbc</code>, <code class="literal">func_odbc</code>, <code class="literal">func_realtime</code>, <code class="literal">pbx_realtime</code>, <code class="literal">res_config_odbc</code>, and <code class="literal">res_odbc</code>. For voicemail stored in an ODBC
          database, be sure to select <code class="literal">ODBC_STORAGE</code> from the <span class="emphasis"><em>Voicemail
          Build Options</em></span> menu. You can verify that the modules exist
          in the <code class="filename">/usr/lib/asterisk/modules/</code>
          directory.</p></div></div><div class="sect2" title="Configuring res_odbc to Allow Asterisk to Connect Through ODBC"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id247224"></a>Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</h3></div></div></div><p><a id="Database_id247230"></a><a id="I_indexterm16_d1e35017" class="indexterm"></a><a id="I_indexterm16_d1e35022" class="indexterm"></a><a id="I_indexterm16_d1e35027" class="indexterm"></a>Asterisk ODBC connections are configured in the <code class="filename">res_odbc.conf</code> file located in <code class="filename">/etc/asterisk</code>. The <code class="filename">res_odbc.conf</code> file sets the parameters that
      various Asterisk modules will use to connect to the database.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id247245"></a>The <code class="literal">pooling</code><a id="I_indexterm16_d1e35047" class="indexterm"></a> and <code class="literal">limit</code><a id="I_indexterm16_d1e35053" class="indexterm"></a> options are quite useful for MS SQL and Sybase
          databases. These permit you to establish multiple connections (up to
          <code class="literal">limit</code> connections) to a database
          while ensuring that each connection has only one statement executing
          at once (this is due to a limitation in the protocol used by these
          database servers).</p></div><p><a id="Database_id247268"></a>Modify the <code class="filename">res_odbc.conf</code> file so it looks like the
      following:</p><p><a id="Database_id247275"></a><a id="I_programlisting12_tt1461"></a></p><pre class="programlisting">[asterisk]
enabled =&gt; yes
dsn =&gt; asterisk-connector
username =&gt; asterisk
password =&gt; welcome
pooling =&gt; no
limit =&gt; 1
pre-connect =&gt; yes</pre><p>The <code class="literal">dsn</code> option points at the database connection
      you configured in <code class="filename">/etc/odbc.ini</code>,
      and the <code class="literal">pre-connect</code> option tells
      Asterisk to open up and maintain a connection to the database when
      loading the <code class="filename">res_odbc.so</code> module.
      This lowers some of the overhead that would come from repeatedly setting
      up and tearing down the connection to the <span class="keep-together">database</span>.</p><p><a id="Database_id247314"></a>Once you’ve configured <code class="filename">res_odbc.conf</code>, start Asterisk and verify the
      database connection with the <span class="command"><strong>odbc
      show</strong></span> CLI command:<a id="I_indexterm16_d1e35092" class="indexterm"></a><a id="I_indexterm16_d1e35097" class="indexterm"></a><a id="I_indexterm16_d1e35100" class="indexterm"></a></p><p><a id="Database_id247327"></a><a id="I_programlisting12_tt1464"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>odbc show</code></strong>

<code class="computeroutput">ODBC DSN Settings
-----------------

  Name:   asterisk
  DSN:    asterisk-connector

    Last connection attempt: 1969-12-31 19:00:00
  Pooled: No
  Connected: Yes</code></pre></div></div><div class="sect1" title="Managing Databases"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Database_id247345"></a>Managing Databases</h2></div></div></div><p><a id="Database_id247351"></a><a id="I_indexterm16_d1e35117" class="indexterm"></a>While it isn’t within the scope of this book to teach you
    about how to manage your databases, it is worth at least noting briefly
    some of the applications you could use to help with database management.
    Several exist, some of which are local client applications running from
    your computer and connecting to the database, and others of which are
    web-based applications that could be served from the same computer running
    the database itself, thereby allowing you to connect remotely.</p><p><a id="Database_id247358"></a>Some of the ones we’ve used include:</p><div class="itemizedlist"><a id="Database_id247362"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Database_id247364"></a><a id="Database_id247366"></a>phpMyAdmin (<a class="ulink" href="http://www.phpmyadmin.net/" target="_top">http://www.phpmyadmin.net</a>)</p></li><li class="listitem"><p><a id="Database_id287537"></a><a id="Database_id287539"></a>MySQL Workbench (<a class="ulink" href="http://wb.mysql.com/" target="_top">http://wb.mysql.com</a>)</p></li><li class="listitem"><p><a id="Database_id287549"></a><a id="Database_id287552"></a>pgAdmin (<a class="ulink" href="http://www.pgadmin.org/" target="_top">http://www.pgadmin.org</a>)</p></li><li class="listitem"><p><a id="Database_id287562"></a><a id="Database_id287564"></a>Navicat (commercial) (<a class="ulink" href="http://www.navicat.com/" target="_top">http://www.navicat.com</a>)</p></li></ul></div><div class="sect2" title="Troubleshooting Database Issues"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id287575"></a>Troubleshooting Database Issues</h3></div></div></div><p><a id="Database_id287580"></a><a id="I_indexterm16_d1e35151" class="indexterm"></a>When working with ODBC database connections and Asterisk,
      it is important to remember that the ODBC connection abstracts some of
      the information passed between Asterisk and the database. In cases where
      things are not working as expected, you may need to enable logging on
      your database platform to see what Asterisk is sending to the database
      (e.g., what <code class="literal">SELECT</code>, <code class="literal">INSERT</code>, or <code class="literal">UPDATE</code> statements are being triggered from
      <span class="keep-together">Asterisk</span>), what the database is
      seeing, and why the database may be rejecting the <span class="keep-together">statements</span>.</p><p><a id="Database_id287598"></a>For example, one of the most common
      problems found with ODBC database integration is an incorrectly defined
      table, or a missing column that Asterisk expects to exist. While great
      strides have been made in the form of adaptive modules, not all parts of
      Asterisk are adaptive. In the case of ODBC voicemail storage, you may
      have missed a column such as <code class="literal">flag</code>,
      which is a new column not previously found in versions of Asterisk prior
      to 1.8.<sup>[<a id="id605362" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605362" class="footnote">142</a>]</sup> In order to debug why your data is not being written to
      the database as expected, you should enable statement logging on the
      database side, and then determine what statement is being executed and
      why the database is rejecting it.</p></div></div><div class="sect1" title="A Gentle Introduction to func_odbc"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Database_id287624"></a>A Gentle Introduction to func_odbc</h2></div></div></div><p><a id="Database_id287630"></a><a id="index-532F111VS1J" class="indexterm"></a><a id="index-046S535WG7K" class="indexterm"></a>The very first use of <code class="literal">func_odbc</code>, which occurred while its author was
    still writing it, is also a good introduction to its use. A customer of
    one of the module’s authors noted that some people calling into his switch
    had figured out a way to make free calls with his system. While his
    eventual intent was to change his dialplan to avoid those problems, he
    needed to blacklist certain caller IDs in the meantime, and the database
    he wanted to use for this was a Microsoft SQL Server database. With a few
    exceptions, this is the actual dialplan<sup>[<a id="id605435" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605435" class="footnote">143</a>]</sup>:</p><p><a id="Database_id266435"></a><a id="Database_id266436"></a></p><pre class="programlisting">[span3pri]
exten =&gt; _50054XX,1,NoOp()
   same =&gt; n,Set(CDR(accountcode)=pricall)
   same =&gt; n,GotoIf($[${ODBC_ANIBLOCK(${CALLERID(number)})}]?busy)
   same =&gt; n(dial),Dial(DAHDI/G1/${EXTEN})
   same =&gt; n(busy),Busy(10)
   same =&gt; n,Hangup
</pre><p>This dialplan, in a nutshell, passes through all calls to
    another system for routing purposes, except those calls whose caller IDs
    are in a blacklist. The calls coming into this system used a block of 100
    7-digit DIDs. There is a mystery function in this dialplan, though:
    <code class="literal">ODBC_ANIBLOCK()</code>. This function is
    defined in another configuration file, <code class="filename">func_odbc.conf</code>, at runtime:</p><p><a id="Database_id266454"></a><a id="Database_id266455"></a></p><pre class="programlisting">[ANIBLOCK]
dsn=telesys
readsql=SELECT IF(COUNT(1)&gt;0, 1, 0) FROM Aniblock WHERE NUMBER='${ARG1}'</pre><p>So,
    your <code class="literal">ODBC_ANIBLOCK()</code><sup>[<a id="id605488" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605488" class="footnote">144</a>]</sup> connects to a listing in <code class="filename">res_odbc.conf</code> named <code class="varname">telesys</code>
    and selects a count of records that have the <code class="literal">NUMBER</code> specified by the argument, which is,
    referring to our dialplan above, the caller ID. Nominally, this function
    should return either a <code class="literal">1</code> (indicating
    the caller ID exists in the <code class="literal">Aniblock</code>
    table) or a <code class="literal">0</code> (if it does not). This
    value also evaluates directly to true or false, which means we don’t need
    to use an expression in our dialplan to complicate the logic.</p></div><div class="sect1" title="Getting Funky with func_odbc: Hot-Desking"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="getting_funky"></a>Getting Funky with func_odbc: Hot-Desking</h2></div></div></div><p><a id="Database_id287777"></a><a id="index-107G643BH8V" class="indexterm"></a>The <code class="literal">func_odbc</code> dialplan
    function is arguably the coolest and most powerful dialplan function in
    Asterisk. It allows you to create and use fairly simple dialplan functions
    that retrieve and use information from databases directly in the dialplan.
    There are all kinds of ways in which this might be used, such as for
    managing users or allowing the sharing of dynamic information within a
    clustered set of Asterisk machines.</p><p><a id="Database_id287789"></a>What <code class="literal">func_odbc</code> allows you to do is define SQL queries
    to which you assign function names. In effect, you are creating custom
    functions that obtain their results by executing queries against a
    database. The <code class="filename">func_odbc.conf</code> file is
    where you specify the relationships between the function names you create
    and the SQL statements you wish them to perform. By referring to the named
    functions in the dialplan, you can retrieve and update values in the
    database.</p><p><a id="Database_id287807"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id287810"></a>While using an external script <a id="I_indexterm16_d1e35279" class="indexterm"></a><a id="I_indexterm16_d1e35282" class="indexterm"></a>to interact with a database (from which a flat file is
        created that Asterisk will read) has advantages (if the database goes
        down, your system will continue to function and the script will simply
        not update any files until connectivity to the database is restored),
        it also has disadvantages. A major disadvantage is that any changes
        you make to a user will not be available until you run the update
        script. This is probably not a big issue on small systems, but on
        large systems waiting for changes to take effect can cause issues,
        such as pausing a live call while a large file is loaded and
        parsed.</p><p><a id="Database_id287819"></a>You can relieve some of this by utilizing
        a replicated database system. Asterisk 1.6.0 and newer provide the
        ability to fail over to another database system. This way, you can
        cluster the database backend utilizing a master-master relationship
        (for PostgreSQL, <a class="ulink" href="http://pgcluster.projects.postgresql.org/" target="_top">pgcluster</a> or
        <a class="ulink" href="http://postgres-r.org/" target="_top">Postgres-R</a>;<sup>[<a id="id605664" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605664" class="footnote">145</a>]</sup> for MySQL it’s native<sup>[<a id="id605674" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605674" class="footnote">146</a>]</sup>), or a master-slave (for PostgreSQL, <a class="ulink" href="http://www.slony.info/" target="_top">Slony-I</a>, for MySQL it’s native)
        replication system.</p></div><p><a id="Database_id287857"></a>In order to get you into the right frame of
    mind for what follows, we want you to picture a Dagwood sandwich.<sup>[<a id="id605695" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id605695" class="footnote">147</a>]</sup></p><p><a id="Database_id287868"></a>Can you relay the total experience of such a
    thing by showing someone a picture of a tomato, or by waving a slice of
    cheese about? Not hardly. That is the conundrum we faced when trying to
    give a useful example of why <code class="literal">func_odbc</code>
    is so powerful. So, we decided to build the whole sandwich for you. It’s
    quite a mouthful, but after a few bites of this, peanut butter and jelly
    is never going to be the same.</p><p><a id="Database_id287882"></a>For our example, we decided to implement
    something we think could have some practical uses. Picture a small company
    with a sales force of five people who have to share two desks. This is not
    as cruel as it seems, because these folks spend most of their time on the
    road, and they are each only in the office for at most one day each
    week.</p><p><a id="Database_id287891"></a>Still, when they do get into the office,
    they’d like the system to know which desks they are sitting at, so that
    their calls can be directed there. Also, the boss wants to be able to
    track when they are in the office and control calling privileges from
    those phones when no one is there.</p><p><a id="Database_id287900"></a>This need is typically solved by what is
    called a <span class="emphasis"><em>hot-desking</em></span> feature, so we have built one
    for you in order to show you the power of <code class="literal">func_odbc</code>.</p><p><a id="Database_id287912"></a>Lets start with the easy stuff, and create
    two desktop phones in the <code class="filename">sip.conf</code><a id="I_indexterm16_d1e35336" class="indexterm"></a> file:</p><p><a id="Database_id287921"></a><a id="I_programlisting12_tt1527"></a></p><pre class="programlisting">; sip.conf
; HOT DESK USERS
[0000FFFF0001]
type=friend
host=dynamic
secret=my_special_secret
context=hotdesk
qualify=yes

[0000FFFF0002]
type=friend
host=dynamic
secret=my_special_secret
context=hotdesk
qualify=yes

; END HOT DESK USERS</pre><p>These two desk phones both enter the
    dialplan at the <code class="literal">hotdesk</code> context in
    <code class="filename">extensions.conf</code><a id="I_indexterm16_d1e35350" class="indexterm"></a><a id="I_indexterm16_d1e35353" class="indexterm"></a>. If you want to have these devices actually work, you will
    of course need to set the appropriate parameters in the devices
    themselves, but we covered all that in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig" title="Chapter 5. User Device Configuration">Chapter&nbsp;5, <em>User Device Configuration</em></a>.</p><p><a id="Database_id287955"></a>That’s all for <code class="filename">sip.conf</code>. We’ve got two slices of bread, which
    is hardly a sandwich yet.</p><p><a id="Database_id287963"></a>Now let’s get the database part of it set up
    (we are assuming that you have an ODBC database created and working, as
    outlined in the earlier parts of this chapter). First, connect to the
    database console.</p><p><a id="Database_id287970"></a>For PostgreSQL:</p><p><a id="Database_id287974"></a><a id="Database_id287975"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo su - postgres</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>psql -U asterisk -h localhost asterisk</code></strong><code class="computeroutput">
Password:</code></pre><p>Then create the table with the following
    bit of SQL:</p><p><a id="Database_id287988"></a><a id="Database_id287989"></a></p><pre class="programlisting">CREATE TABLE ast_hotdesk
(
  id serial NOT NULL,
  extension int8,
  first_name text,
  last_name text,
  cid_name text,
  cid_number varchar(10),
  pin int4,
  context text,
  status bool DEFAULT false,
  "location" text,
  CONSTRAINT ast_hotdesk_id_pk PRIMARY KEY (id)
)
WITHOUT OIDS;</pre><p><a id="Database_id287996"></a>For MySQL:</p><p><a id="Database_id288000"></a><a id="Database_id288001"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>mysql -u asterisk -p asterisk</code></strong>
<code class="computeroutput">Enter password:</code></pre><p>Then
    create the table with the following bit of SQL:</p><p><a id="Database_id288012"></a><a id="Database_id288013"></a></p><pre class="programlisting">CREATE TABLE ast_hotdesk
(
  id serial NOT NULL,
  extension int8,
  first_name text,
  last_name text,
  cid_name text,
  cid_number varchar(10),
  pin int4,
  context text,
  status bool DEFAULT false,
  location text,
  CONSTRAINT ast_hotdesk_id_pk PRIMARY KEY (id)
);</pre><p><a id="Database_id288018"></a>The table information is summarized
    <a id="I_indexterm16_d1e35407" class="indexterm"></a>in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id288022" title="Table 16.1. Summary of ast_hotdesk table">Table&nbsp;16.1, “Summary of ast_hotdesk table”</a>.</p><div class="table"><a id="Database_id288022"></a><p class="title"><strong>Table&nbsp;16.1.&nbsp;Summary of ast_hotdesk table</strong></p><div class="table-contents"><table summary="Summary of ast_hotdesk table" border="1"><colgroup><col align="center"><col></colgroup><thead><tr><th align="center">Column name</th><th align="center">Column type</th></tr></thead><tbody><tr><td align="center"><code class="literal">id</code></td><td>Serial, auto-incrementing</td></tr><tr><td align="center"><code class="literal">extension</code></td><td>Integer</td></tr><tr><td align="center"><code class="literal">first_name</code></td><td>Text</td></tr><tr><td align="center"><code class="literal">last_name</code></td><td>Text</td></tr><tr><td align="center"><code class="literal">cid_name</code></td><td>Text</td></tr><tr><td align="center"><code class="literal">cid_number</code></td><td>Varchar 10</td></tr><tr><td align="center"><code class="literal">pin</code></td><td>Integer</td></tr><tr><td align="center"><code class="literal">context</code></td><td>Text</td></tr><tr><td align="center"><code class="literal">status</code></td><td>Boolean, default false</td></tr><tr><td align="center"><code class="literal">location</code></td><td>Text</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Database_id288154"></a>After that, populate the database with the
    following information (some of the values that you see actually will
    change only after the dialplan work is done, but we include it here by way
    of example).</p><p><a id="Database_id288159"></a>At the PostgreSQL console, run the following
    <span class="keep-together">commands</span>:</p><p><a id="Database_id288168"></a><a id="Database_id288169"></a></p><pre class="screen"><code class="prompt">asterisk=&gt;</code> <strong class="userinput"><code>INSERT INTO ast_hotdesk ('extension', 'first_name', 'last_name',\
'cid_name','cid_number', 'pin', 'context', 'location') \
VALUES (1101, 'Leif', 'Madsen', 'Leif Madsen', '4165551101', '555',\
'longdistance','0000FFFF0001');</code></strong></pre><p><a id="Database_id288176"></a>At the MySQL console, run the following
    commands:</p><p><a id="Database_id288180"></a><a id="Database_id288181"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>INSERT INTO ast_hotdesk (extension, first_name, last_name, cid_name, 
cid_number, pin, context, location)
VALUES (1101, 'Leif', 'Madsen', 'Leif Madsen', 
'4165551101', '555', 'longdistance', '0000FFFF0001');</code></strong></pre><p>Repeat
    these commands, changing the <code class="literal">VALUES</code> as
    needed, for all entries you wish to have in the database. You can view the
    data in the <code class="literal">ast_hotdesk</code> table by
    running a simple <code class="literal">SELECT</code> statement from
    the database console:</p><p><a id="Database_id288197"></a><a id="Database_id288198"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>SELECT * FROM ast_hotdesk;</code></strong></pre><p>which
    would give you something like the following output:<a id="Database_id288205"></a></p><pre class="programlisting"><code class="computeroutput">| id | extension | first_name | last_name      | cid_name           | cid_number   
|----+-----------+------------+----------------+--------------------+--------------
|  1 | 1101      | "Leif"     | "Madsen"       | "Leif Madsen"      | "4165551101" 
|  2 | 1102      | "Jim"      | "Van Meggelen" | "Jim Van Meggelen" | "4165551102" 
|  3 | 1103      | "Russell"  | "Bryant"       | "Russell Bryant"   | "4165551103" 
|  4 | 1104      | "Mark"     | "Spencer"      | "Mark Spencer"     | "4165551104" 
|  5 | 1105      | "Kevin"    | "Fleming"      | "Kevin Fleming"    | "4165551105" 

|  pin  | context         | status  | location       |$
+-------+-----------------+---------+----------------+
| "555" | "longdistance"  | "TRUE"  | "0000FFFF0001" |
| "556" | "longdistance"  | "FALSE" | ""             |
| "557" | "local"         | "FALSE" | ""             |
| "558" | "international" | "FALSE" | ""             |
| "559" | "local"         | "FALSE" | ""             |</code></pre><p><a id="Database_id288225"></a>We’ve got the condiments now, so let’s get to
    our dialplan. This is where the magic is going to happen.</p><p><a id="Database_id288231"></a>Somewhere in <code class="filename">extensions.conf </code>we are going to have to create
    the <code class="literal">hotdesk</code> context. To start, let’s
    define a pattern-match extension that will allow the users to log
    in:</p><p><a id="Database_id288257"></a><a id="Database_id288258"></a></p><pre class="programlisting">; extensions.conf
; Hot-Desking Feature
[hotdesk]
; Hot Desk Login
exten =&gt; _#110[1-5],1,NoOp()
   same =&gt; n,Set(E=${EXTEN:1})  ; strip off the leading hash (#) symbol
   same =&gt; n,Verbose(1,Hot Desk Extension ${E} is changing status)
   same =&gt; n,Verbose(1,Checking current status of extension ${E})
   same =&gt; n,Set(${E}_STATUS=${HOTDESK_INFO(status,${E})})
   same =&gt; n,Set(${E}_PIN=${HOTDESK_INFO(pin,${E})})</pre><p>We’re
    not done writing this extension yet, but let’s pause for a moment and see
    where we’re at so far.</p><p><a id="Database_id288268"></a>When a sales agent sits down at a desk, he
    logs in by dialing hash (#) plus his own extension number. In this case we
    have allowed the 1101 through 1105 extensions to log in with our pattern
    match of <code class="literal">_#110[1-5]</code>. You could just as
    easily make this less restrictive by using <code class="literal">_#11XX</code> (allowing 1100 through 1199). This
    extension uses <code class="literal">func_odbc</code> to perform a
    lookup with the <code class="literal">HOTDESK_INFO()</code> dialplan
    function. This custom function (which we will define in the <code class="filename">func_odbc.conf</code> file) performs an SQL statement
    and returns whatever is retrieved from the database.</p><p><a id="Database_id288302"></a>We would define the new function <code class="literal">HOTDESK_INFO()</code> in <code class="filename">func_odbc.conf</code> like so:</p><p><a id="Database_id288316"></a><a id="I_programlisting12_tt1536"></a></p><pre class="programlisting">[INFO]
prefix=HOTDESK
dsn=asterisk
readsql=SELECT ${ARG1} FROM ast_hotdesk WHERE extension = '${ARG2}'</pre><p>That’s
    a lot of stuff in just a few lines. Let’s quickly cover them before we
    move on.</p><p><a id="Database_id288494"></a>First of all, the <code class="literal">prefix</code> is optional. If you don’t configure the
    <code class="literal">prefix</code>, then Asterisk adds “<code class="literal">ODBC</code>” to the name of the function (in this case,
    <code class="literal">INFO</code>), which means this function would
    become <code class="literal">ODBC_INFO()</code>. This is not very
    descriptive of what the function is doing, so it can be helpful to assign
    a prefix that helps to relate your ODBC functions to the tasks they are
    performing. We chose <code class="literal">HOTDESK</code>, which
    means that this custom function will be named <code class="literal">HOTDESK_INFO()</code>.</p><p><a id="Database_id288532"></a>The <code class="literal">dsn</code>
    attribute tells Asterisk which connection to use from <code class="filename">res_odbc.conf</code>. Since several database
    connections could be configured in <code class="filename">res_odbc.conf</code>, we specify which one to use
    here. In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB-FIG-1" title="Figure 16.1. Relationships between func_odbc.conf, res_odbc.conf, /etc/odbc.ini (unixODBC), and the database connection">Figure&nbsp;16.1, “Relationships between func_odbc.conf, res_odbc.conf,
      /etc/odbc.ini (unixODBC), and the database connection”</a>, we show the relationship
    between the various file configurations and how they reference down the
    chain to connect to the database.</p><p><a id="Database_id288555"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id288558"></a>The <code class="filename">func_odbc.conf.sample</code><a id="I_indexterm16_d1e35617" class="indexterm"></a> file in the Asterisk source contains additional
        information about how to handle multiple databases and control the
        reading and writing of information to different DSN connections.
        Specifically, the <code class="literal">readhandle</code>,
        <code class="literal">writehandle</code>, <code class="literal">readsql</code>, and <code class="literal">writesql</code> arguments will provide you with
        great flexibility for database integration and control.</p></div><p>Finally, we define our SQL statement with the <code class="literal">readsql</code> attribute. Dialplan functions have two
    different formats that they can be called with: one for retrieving
    information, and one for setting information. The <code class="literal">readsql</code> attribute is used when we call the
    <code class="literal">HOTDESK_INFO()</code> function with the
    retrieve format (we could execute a separate SQL statement with the
    <code class="literal">writesql</code> attribute; we’ll discuss the
    format for that attribute a little bit later in this chapter).</p><p><a id="Database_id288597"></a>Reading values from this function would take
    this format in the dialplan:</p><p><a id="Database_id288601"></a><a id="I_programlisting12_tt1537"></a></p><pre class="programlisting">exten =&gt; s,n,Set(RETURNED_VALUE=${HOTDESK_INFO(status,1101)})</pre><p>This
    would return the value located in the database within the <code class="literal">status</code> column where the <code class="literal">extension</code> column equals <code class="literal">1101</code>. The <code class="literal">status</code> and <code class="literal">1101</code> we pass to the <code class="literal">HOTDESK_INFO()</code> function are then placed
    into the SQL statement we assigned to the <code class="literal">readsql</code> attribute, available as <code class="literal">${ARG1}</code> and <code class="literal">${ARG2}</code>, respectively. If we had passed a third
    option, this would have been available as <code class="literal">${ARG3}</code>.</p><div class="figure"><a id="asterisk-DB-FIG-1"></a><p class="title"><strong>Figure&nbsp;16.1.&nbsp;Relationships between func_odbc.conf, res_odbc.conf,
      /etc/odbc.ini (unixODBC), and the database connection</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject16_d1e35686"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1601.png" alt="Relationships between func_odbc.conf, res_odbc.conf, /etc/odbc.ini (unixODBC), and the database connection"></div></div></div><br class="figure-break"><div class="sidebar" title="Multirow Functionality with func_odbc"><a id="multirow_functionality_func_odbc"></a><div class="titlepage"><div><div><p class="title"><strong>Multirow Functionality with func_odbc</strong></p></div></div></div><p><a id="Database_id288674"></a><a id="I_indexterm16_d1e35695" class="indexterm"></a><a id="I_indexterm16_d1e35698" class="indexterm"></a>As of Asterisk branch 1.6.0, a mode exists that allows
      Asterisk to handle multiple rows of data returned from the database. For
      example, if we were to create a dialplan function in <code class="filename">func_odbc.conf</code> that returned all available
      extensions, we would need to enable multirow mode for the function. This
      would cause the function to work a little differently, returning an ID
      number that could then be passed to the <code class="literal">ODBC_FETCH()</code> function to return each row in
      turn.</p><p><a id="Database_id288687"></a>Prior to the 1.6.0 branch, we needed to use
      the SQL functions <code class="literal">LIMIT</code> and <code class="literal">OFFSET</code> in order to control data being returned
      to Asterisk for iteration. This was resource-intensive (at least in
      relation to multirow mode), as it required multiple queries to the
      database for each row.</p><p><a id="Database_id288700"></a>A simple example follows. Suppose we have
      the following <code class="filename">func_odbc.conf</code>:</p><p><a id="Database_id288708"></a><a id="Database_id288709"></a></p><pre class="programlisting">[ALL_AVAIL_EXTENS]
prefix=GET
dsn=asterisk-connector
mode=multirow
readsql=SELECT extension FROM ast_hotdesk WHERE status = '${ARG1}'</pre><p>and
      a dialplan in <code class="filename">extensions.conf</code> that
      looks something like this:</p><p><a id="Database_id288718"></a><a id="Database_id288719"></a></p><pre class="programlisting">[multirow_example]
exten =&gt; start,1,Verbose(1,Looping example)
   same =&gt; n,Set(ODBC_ID=${GET_ALL_AVAIL_EXTENS(1)})
   same =&gt; n,GotoIf($[${ODBCROWS} &lt; 1]?no_rows,1)
   same =&gt; n,Set(COUNTER=1)
   same =&gt; n,While($[${COUNTER} &lt;= ${ODBCROWS}])
   same =&gt; n,Set(AVAIL_EXTEN_${COUNTER}=${ODBC_FETCH(${ODBC_ID})})
   same =&gt; n,Set(COUNTER=$[${COUNTER + 1])
   same =&gt; n,EndWhile()
   same =&gt; n,ODBCFinish()

exten =&gt; no_rows,1,Verbose(1,No rows returned)
   same =&gt; n,Playback(silence/1&amp;invalid)
   same =&gt; n,Hangup()</pre><p>The <code class="literal">ODBC_FETCH()</code> function <a id="I_indexterm16_d1e35735" class="indexterm"></a><a id="I_indexterm16_d1e35738" class="indexterm"></a>will essentially treat the information as a stack, and
      each call to it with the passed <code class="literal">ODBC_ID</code> will pop the next row of information
      off the stack. We also have the option of using the <code class="literal">ODBC_FETCH_STATUS</code> channel variable, which is
      set once the <code class="literal">ODBC_FETCH()</code> function
      (which returns <code class="literal">SUCCESS</code> if additional
      rows are available or <code class="literal">FAILURE</code> if no
      additional rows are available) is called. This permits us to write a
      dialplan like the following, which does not use a counter, but still
      loops through the data. This may be useful if we’re looking for
      something specific and don’t need to look at all the data. Once we’re
      done, the <code class="literal">ODBCFinish()</code> dialplan
      application should be called to clean up any remaining data.</p><p><a id="Database_id288757"></a>Here’s another <code class="filename">extensions.conf</code> example:</p><p><a id="Database_id288763"></a><a id="Database_id288764"></a></p><pre class="programlisting">[multirow_example_2]
exten =&gt; start,1,Verbose(1,Looping example with break)
   same =&gt; n,Set(ODBC_ID=${GET_ALL_AVAIL_EXTENS(1)})
   same =&gt; n(loop_start),NoOp()
   same =&gt; n,Set(ROW_RESULT=${ODBC_FETCH(${ODBC_ID})})
   same =&gt; n,GotoIf($["${ODBC_FETCH_RESULT}" = "FAILURE"]?cleanup,1)
   same =&gt; n,GotoIf($["${ROW_RESULT}" = "1104"]?good_exten,1)
   same =&gt; n,Goto(loop_start)

exten =&gt; cleanup,1,Verbose(1,Cleaning up after all iterations)
   same =&gt; n,Verbose(1,We did not find the extension we wanted)
   same =&gt; n,ODBCFinish(${ODBC_ID})
   same =&gt; n,Hangup()

exten =&gt; good_exten,1,Verbose(1,Extension we want is available)
   same =&gt; n,ODBCFinish(${ODBC_ID})
   same =&gt; n,Verbose(1,Perform some action we wanted)
   same =&gt; n,Hangup()</pre><p>We’ll be using multirow mode for one
      of our functions later in this chapter.</p></div><p><a id="Database_id288781"></a>After the SQL statement is executed, the
    value returned (if any) is assigned to the <code class="literal">RETURNED_VALUE</code> channel variable.</p><div class="sidebar" title="Using the ARRAY() Function"><a id="I_sidebar12_tt1539"></a><div class="titlepage"><div><div><p class="title"><strong>Using the ARRAY() Function</strong></p></div></div></div><p><a id="Database_id288840"></a><a id="I_indexterm16_d1e35781" class="indexterm"></a><a id="I_indexterm16_d1e35784" class="indexterm"></a>In our example, we are utilizing two separate database
      calls and assigning those values to a pair of channel variables,
      <code class="literal">${E}_STATUS</code> and <code class="literal">${E}_PIN</code>. This was done to simplify the
      example:</p><p><a id="Database_id288855"></a><a id="I_programlisting12_tt1540"></a></p><pre class="programlisting">exten =&gt; _110[1-5],n,Set(${E}_STATUS=${HOTDESK_INFO(status,${E})})
   same =&gt; n,Set(${E}_PIN=${HOTDESK_INFO(pin,${E})})</pre><p>As an
      alternative, we could have returned multiple columns and saved them to
      separate variables utilizing the <code class="literal">ARRAY()</code> dialplan function. If we had defined
      our SQL statement in the <code class="filename">func_odbc.conf</code> file like so:</p><p><a id="Database_id288880"></a><a id="I_programlisting12_tt1541"></a></p><pre class="programlisting">readsql=SELECT pin,status FROM ast_hotdesk WHERE extension = '${E}'</pre><p><a id="Database_id288890"></a>we could have used the <code class="literal">ARRAY()</code> function to save each column of
      information for the row to its own variable with a single call to the
      database:</p><p><a id="Database_id288900"></a><a id="I_programlisting12_tt1543"></a></p><pre class="programlisting">exten =&gt; _110[1-5],n,Set(ARRAY(${E}_PIN,${E}_STATUS)=${HOTDESK_INFO(${E})})</pre><p>Using
      <code class="literal">ARRAY()</code> is handy any time you might
      get comma-separated values back and want to assign the values to
      separate variables, such as with <code class="literal">CURL()</code>.</p></div><p><a id="Database_id288912"></a>So, in the first two lines of the following
    block of code, we are passing the value <code class="literal">status</code> and the value contained in the
    <code class="literal">${E}</code> variable (e.g., <code class="literal">1101</code>) to the <code class="literal">HOTDESK_INFO()</code> function. The two values are then
    replaced in the SQL statement with <code class="literal">${ARG1}</code> and <code class="literal">${ARG2}</code>, respectively, and the SQL statement is
    executed. Finally the value returned is assigned to the <code class="literal">${E}_STATUS</code> channel variable.</p><p><a id="Database_id288952"></a>OK, let’s finish writing the pattern-match
    extension now:</p><p><a id="Database_id288956"></a><a id="I_programlisting12_tt1545"></a></p><pre class="programlisting">   same =&gt; n,Set(${E}_STATUS=${HOTDESK_INFO(status,${E})})
   same =&gt; n,Set(${E}_PIN=${HOTDESK_INFO(pin,${E})})
<strong class="userinput"><code>   same =&gt; n,GotoIf($[${ODBCROWS} &lt; 0]?invalid_user,1)
; check if ${E}_STATUS is NULL
   same =&gt; n,GotoIf($[${${E}_STATUS} = 1]?logout,1:login,1)</code></strong></pre><p>After
    assigning the value of the <code class="literal">status</code>
    column to the <code class="literal">${E}_STATUS</code> variable (if
    the user dials extension <code class="literal">1101</code>, the
    variable name will be <code class="literal">1101_STATUS</code>), we
    check if we’ve received a value back from the database (error checking)
    using the <code class="literal">${ODBCROWS}</code> channel
    variable.</p><p><a id="Database_id288993"></a>The last row in the block checks the status
    of the phone and, if the agent is currently logged in, logs him off. If
    the agent is not already logged in, it will go to extension <code class="literal">login</code>, priority <code class="literal">1</code> within the same context.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id402744"></a>Remember that in a traditional phone
        system all extensions <a id="I_indexterm16_d1e35883" class="indexterm"></a>must be numbers, but in Asterisk, extensions can have
        names as well. A possible advantage of using an extension that’s not a
        number is that it will be much harder for a user to dial it from her
        phone and, thus, more secure. We’re going to use several named
        extensions in this example. If you want to be absolutely sure that a
        malicious user cannot access those named extensions, simply use the
        trick that the AEL loader uses: <span class="emphasis"><em>start with a priority other
        than 1</em></span>. You can access the first line of the extension by
        assigning it a priority label and referencing it via the extension
        name/priority label combination.</p></div><p><a id="Database_id289023"></a>The <code class="literal">login</code>
    extension runs some initial checks to verify the pin code entered by the
    agent. We allow him three tries to enter the correct pin, and if all tries
    are invalid we send the call to the <code class="literal">login_fail</code> extension (which we will be writing
    later):<a id="I_programlisting12_tt1548"></a></p><pre class="programlisting">exten =&gt; login,1,NoOp() ; set initial counter values
   same =&gt; n,Set(PIN_TRIES=1)     ; pin tries counter 
   same =&gt; n,Set(MAX_PIN_TRIES=3) ; set max number of login attempts
   same =&gt; n,Playback(silence/1)  ; play back some silence so first prompt is 
                                  ; not cut off
   same =&gt; n(get_pin),NoOp()
   same =&gt; n,Set(PIN_TRIES=$[${PIN_TRIES} + 1])   ; increase pin try counter
   same =&gt; n,Read(PIN_ENTERED,enter-password,${LEN(${${E}_PIN})})
   same =&gt; n,GotoIf($["${PIN_ENTERED}" = "${${E}_PIN}"]?valid_login,1)
   same =&gt; n,Playback(pin-invalid)
   same =&gt; n,GotoIf($[${PIN_TRIES} &lt;= ${MAX_PIN_TRIES}]?get_pin:login_fail,1)
</pre><p><a id="Database_id289054"></a>If the pin entered matches, we validate the
    login with the <code class="literal">valid_login</code> extension.
    First we utilize the <code class="literal">CHANNEL</code> variable
    to figure out which phone device the agent is calling from. The <code class="literal">CHANNEL</code> variable is usually populated with
    something like <code class="literal">SIP/0000FFFF0001-ab4034c</code>, so we make use of the
    <code class="literal">CUT()</code> function to first pull off the
    <code class="literal">SIP/</code> portion of the string and assign
    that to <code class="literal">LOCATION</code>. We then strip off the
    <code class="literal">-ab4034c</code> part of the string, discard
    it, and assign the remainder (<code class="literal">0000FFFF0001</code>) to the <code class="literal">LOCATION</code> variable:<a id="I_programlisting12_tt1550"></a></p><pre class="programlisting">exten =&gt; valid_login,1,NoOp()
; CUT off the channel technology and assign it to the LOCATION variable
   same =&gt; n,Set(LOCATION=${CUT(CHANNEL,/,2)})
; CUT off the unique identifier and save the remainder to the LOCATION variable
   same =&gt; n,Set(LOCATION=${CUT(LOCATION,-,1)})</pre><p><a id="Database_id289124"></a>We utilize yet another custom function
    created in the <code class="filename">func_odbc.conf</code> file,
    <code class="literal">HOTDESK_CHECK_PHONE_LOGINS()</code>, to check
    if any other users were previously logged into this phone and forgot to
    log out. If the number of logged-in users is greater than <code class="literal">0</code> (it should never be more than <code class="literal">1</code>, but we check for higher values anyway and
    reset those, too), it runs the logic in the <code class="literal">logout_login</code> extension:</p><p><a id="Database_id289149"></a><a id="I_programlisting12_tt1564"></a></p><pre class="programlisting">; func_odbc.conf
[CHECK_PHONE_LOGINS]
prefix=HOTDESK
dsn=asterisk

; *** This line should have no line breaks
readsql=SELECT COUNT(status) FROM ast_hotdesk WHERE status = '1' AND 
location = '${ARG1}'</pre><p>If there are no other agents logged into
    the device, we update the login status for this user with the <code class="literal">HOTDESK_STATUS()</code> function:</p><p><a id="Database_id289168"></a><a id="I_programlisting12_tt1551"></a></p><pre class="programlisting">; Continuation of the valid_login extension below
   same =&gt; n,Set(USERS_LOGGED_IN=${HOTDESK_CHECK_PHONE_
LOGINS(${LOCATION})})
   same =&gt; n,GotoIf($[${USERS_LOGGED_IN} &gt; 0]?logout_login,1)
   same =&gt; n(set_login_status),NoOp()

; Set the status for the phone to '1' and where the agent is logged into
   same =&gt; n,Set(HOTDESK_STATUS(${E})=1,${LOCATION})
   same =&gt; n,GotoIf($[${ODBCROWS} &lt; 1]?error,1)
   same =&gt; n,Playback(agent-loginok)
   same =&gt; n,Hangup()</pre><p><a id="Database_id289184"></a>We create a write function in <code class="filename">func_odbc.conf</code> like so:</p><p><a id="Database_id289193"></a><a id="I_programlisting12_tt1552"></a></p><pre class="programlisting">[STATUS]
prefix=HOTDESK
dsn=asterisk

; *** This line should have no line breaks
writesql=UPDATE ast_hotdesk SET status = '${VAL1}', 
location = '${VAL2}' WHERE extension = '${ARG1}'</pre><p><a id="Database_id289204"></a>The syntax is very similar to the <code class="literal">readsql</code> syntax discussed earlier in the chapter,
    but there are a few new things here, so let’s discuss them before moving
    on.</p><p><a id="Database_id289214"></a>The first thing you may have noticed is that
    we now have both <code class="literal">${VAL</code><em class="replaceable"><code>x</code></em><code class="literal">} </code>and <code class="literal">${ARG</code><em class="replaceable"><code>x</code></em><code class="literal">} </code>variables in our SQL statement. These contain
    the values we pass to the function from the dialplan. In this case, we
    have two <code class="literal">VAL</code> variables and a single
    <code class="literal">ARG</code> variable that were set from the
    dialplan via this statement:</p><p><a id="Database_id289254"></a><a id="I_programlisting12_tt1553"></a></p><pre class="programlisting">Set(HOTDESK_STATUS(${E})=1,${LOCATION})</pre><p><a id="Database_id289264"></a>Notice the syntax is slightly different from
    that of the read-style function. This signals to Asterisk that you want to
    perform a write (this is the same syntax as that used for other dialplan
    functions).</p><p><a id="Database_id289268"></a>We are passing the value of the <code class="literal">${E}</code> variable to the <code class="literal">HOTDESK_STATUS()</code> function, whose value is then
    accessible in the SQL statement within <code class="filename">func_odbc.conf</code> with the <code class="literal">${ARG1}</code> variable. We then pass two values:
    <code class="literal">1</code> and <code class="literal">${LOCATION}</code>. These are available to the SQL
    statement in the <code class="literal">${VAL1}</code> and <code class="literal">${VAL2}</code> variables, respectively.</p><p><a id="Database_id242795"></a>As mentioned previously, if we had to log out
    one or more agents before logging this one in, we would check this with
    the <code class="literal">logout_login</code> extension. This
    dialplan logic will utilize the <code class="literal">ODBC_FETCH()</code> function to pop information off the
    information stack returned by the <code class="literal">HOTDESK_LOGGED_IN_USER()</code> function. More than
    likely this will execute only one loop, but it’s a good example of how you
    might update or parse multiple rows in the database.<sup>[<a id="id607463" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id607463" class="footnote">148</a>]</sup></p><p><a id="Database_id242829"></a>The first part of our dialplan returns an ID
    number that we can use with the <code class="literal">ODBC_FETCH()</code> function to iterate through the
    values returned. We’re going to assign this ID to the <code class="literal">LOGGED_IN_ID</code> channel variable:</p><p><a id="Database_id242841"></a><a id="Database_id242842"></a></p><pre class="programlisting">   same =&gt; n,Set(LOGGED_IN_ID=${HOTDESK_LOGGED_IN_USER(${LOCATION})})</pre><p>Here
    is the <code class="literal">logout_login</code> extension, which
    could potentially loop through multiple rows:</p><p><a id="Database_id242848"></a><a id="Database_id242849"></a></p><pre class="programlisting">exten =&gt; logout_login,1,NoOp()
; set all logged-in users on this device to logged-out status
   same =&gt; n,Set(LOGGED_IN_ID=${HOTDESK_LOGGED_IN_USER(${LOCATION})})
   same =&gt; n(start_loop),NoOp()
   same =&gt; n,Set(WHO=${ODBC_FETCH(${LOGGED_IN_ID})})
   same =&gt; n,GotoIf($["${ODBC_FETCH_STATUS}" = "FAILURE"]?cleanup)
   same =&gt; n,Set(HOTDESK_STATUS(${WHO})=0)           ; log out phone
   same =&gt; n,Goto(start_loop)
   same =&gt; n(cleanup),ODBCFinish(${LOGGED_IN_ID})
   same =&gt; n,Goto(valid_login,set_login_status)      ; return to logging in
</pre><p>We assign the first value returned from the database (e.g.,
    the extension <code class="literal">1101</code>) to the <code class="literal">WHO</code> channel. Before doing anything, though, we
    check to see if the <code class="literal">ODBC_FETCH()</code>
    function was successful in returning data. If the <code class="literal">ODBC_FETCH_STATUS</code> channel variable contains
    <code class="literal">FAILURE</code>, we have no data to work with,
    so we move to the <code class="literal">cleanup</code> priority
    label.</p><p><a id="Database_id242877"></a>If we have data, we then pass the value of
    <code class="literal">${WHO}</code> as an argument to the <code class="literal">HOTDESK</code><code class="literal">_</code><code class="literal">STATUS()</code> function, which contains a value
    of <code class="literal">0</code>. This is the first value passed to
    <code class="literal">HOTDESK</code><code class="literal">_</code><code class="literal">STATUS()</code> and is shown as <code class="literal">${VAL1}</code> in <code class="filename">func_odbc.conf</code>, where the function is
    declared.</p><p><a id="Database_id242905"></a>If you look at the <code class="literal">HOTDESK_STATUS()</code> function in <code class="filename">func_odbc.conf</code> you will see we could also pass
    a second value, but we’re not doing that here since we want to remove any
    values from that column in order to log out the user, which setting no
    value does <span class="keep-together">effectively</span>.</p><p><a id="Database_id242917"></a>After using <code class="literal">HOTDESK_STATUS()</code> to log out the user, we return
    to the <code class="literal">start_loop</code> priority label to
    loop through all values, which simply executes a <code class="literal">NoOp()</code>. After attempting to retrieve a value, we
    again check <code class="literal">ODBC_FETCH_STATUS</code> for
    <code class="literal">FAILURE</code>. If that value is found, we
    move to the <code class="literal">cleanup</code> priority label,
    where we execute the <code class="literal">ODBCFinish()</code>
    dialplan application to perform cleanup. We then return to the <code class="literal">valid_login</code> extension at the <code class="literal">set_login_status</code> priority label.</p><p><a id="Database_id242953"></a>The rest of the context should be fairly
    straightforward (if some of this doesn’t make sense, we suggest you go
    back and refresh your memory with Chapters <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics" title="Chapter 6. Dialplan Basics">6</a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper" title="Chapter 10. Deeper into the Dialplan">10</a>). The one
    trick you may be unfamiliar with could be the usage of the <code class="literal">${ODBCROWS}</code> channel variable, which is set by
    the <code class="literal">HOTDESK_STATUS()</code> function. This
    tells us how many rows were affected in the SQL <code class="literal">UPDATE</code>, which we assume to be <code class="literal">1</code>. If the value of <code class="literal">${ODBCROWS}</code> is less than <code class="literal">1</code>, we assume an error and handle it
    appropriately:</p><p><a id="Database_id242988"></a><a id="Database_id242989"></a></p><pre class="programlisting">exten =&gt; logout,1,NoOp()
   same =&gt; n,Set(HOTDESK_STATUS(${E})=0)
   same =&gt; n,GotoIf($[${ODBCROWS} &lt; 1]?error,1)
   same =&gt; n,Playback(silence/1&amp;agent-loggedoff)
   same =&gt; n,Hangup()

exten =&gt; login_fail,1,NoOp()
   same =&gt; n,Playback(silence/1&amp;login-fail)
   same =&gt; n,Hangup()

exten =&gt; error,1,NoOp()
   same =&gt; n,Playback(silence/1&amp;connection-failed)
   same =&gt; n,Hangup()

exten =&gt; invalid_user,1,NoOp()
   same =&gt; n,Verbose(1,Hot Desk extension ${E} does not exist)
   same =&gt; n,Playback(silence/2&amp;invalid)
   same =&gt; n,Hangup()</pre><p>We also include the <code class="literal">hotdesk_outbound</code> context, which will handle our
    outgoing calls after we have logged the agent into the system:</p><p><a id="Database_id243007"></a><a id="Database_id243008"></a></p><pre class="programlisting">include =&gt; hotdesk_outbound</pre><p>The
    <code class="literal">hotdesk_outbound</code> context utilizes many
    of the same principles discussed previously, so we won’t approach it quite
    so thoroughly; essentially, this context will catch all numbers dialed
    from the desk phones. We first set our <code class="literal">LOCATION</code> variable using the <code class="literal">CHANNEL</code> variable, then determine which extension
    (agent) is logged into the system and assign that value to the <code class="literal">WHO</code> variable. If this variable is <code class="literal">NULL</code>, we reject the outgoing call. If it is not
    <code class="literal">NULL</code>, then we get the agent information
    using the <code class="literal">HOTDESK_INFO()</code> function and
    assign it to several <code class="literal">CHANNEL</code> variables,
    including the context to handle the call with, where we perform a <code class="literal">Goto()</code> to the context we have been assigned
    (which controls our outbound access).</p><p><a id="Database_id243057"></a>We will make use of the <code class="literal">HOTDESK_PHONE_STATUS()</code> dialplan function, which
    you can define in <code class="filename">func_odbc.conf</code> like
    so:</p><p><a id="Database_id243067"></a><a id="Database_id243068"></a></p><pre class="programlisting">[PHONE_STATUS]
prefix=HOTDESK
dsn=asterisk
readsql=SELECT extension FROM ast_hotdesk WHERE status = '1'
readsql+= AND location = '${ARG1}'</pre><p>If we try to dial a number
    that is not handled by our context (or one of the transitive
    contexts—i.e., international contains long distance, which also contains
    local), the built-in extension <code class="literal">i</code> is
    executed, which plays back a message stating that the action cannot be
    performed and hangs up the call:</p><p><a id="Database_id243081"></a><a id="Database_id243082"></a></p><pre class="programlisting">[hotdesk_outbound]
exten =&gt; _X.,1,NoOp()
   same =&gt; n,Set(LOCATION=${CUT(CHANNEL,/,2)})
   same =&gt; n,Set(LOCATION=${CUT(LOCATION,-,1)})
   same =&gt; n,Set(WHO=${HOTDESK_PHONE_STATUS(${LOCATION})})
   same =&gt; n,GotoIf($[${ISNULL(${WHO})}]?no_outgoing,1)
   same =&gt; n,Set(${WHO}_CID_NAME=${HOTDESK_INFO(cid_name,${WHO})})
   same =&gt; n,Set(${WHO}_CID_NUMBER=${HOTDESK_INFO(cid_number,${WHO})})
   same =&gt; n,Set(${WHO}_CONTEXT=${HOTDESK_INFO(context,${WHO})})
   same =&gt; n,Goto(${${WHO}_CONTEXT},${EXTEN},1)

[international]
exten =&gt; _011.,1,NoOp()
   same =&gt; n,Set(E=${EXTEN})
   same =&gt; n,Goto(outgoing,call,1)

exten =&gt; i,1,NoOp()
   same =&gt; n,Playback(silence/2&amp;sorry-cant-let-you-do-that2)
   same =&gt; n,Hangup()

include =&gt; longdistance

[longdistance]
exten =&gt; _1NXXNXXXXXX,1,NoOp()
   same =&gt; n,Set(E=${EXTEN})
   same =&gt; n,Goto(outgoing,call,1)

exten =&gt; _NXXNXXXXXX,1,Goto(1${EXTEN},1)

exten =&gt; i,1,NoOp()
   same =&gt; n,Playback(silence/2&amp;sorry-cant-let-you-do-that2)
   same =&gt; n,Hangup()

include =&gt; local

[local]
exten =&gt; _416NXXXXXX,1,NoOp()
   same =&gt; n,Set(E=${EXTEN})
   same =&gt; n,Goto(outgoing,call,1)

exten =&gt; i,1,NoOp()
   same =&gt; n,Playback(silence/2&amp;sorry-cant-let-you-do-that2)
   same =&gt; n,Hangup()</pre><p>If the call is allowed to be
    executed, it is sent to the <code class="literal">[outgoing]</code>
    context for processing and the caller ID name and number are set with the
    <code class="literal">CALLERID()</code> <span class="keep-together">function</span>. The call is then placed via the
    SIP channel using the <code class="literal">service_provider</code>
    we created in the <code class="filename">sip.conf</code>
    file:</p><p><a id="Database_id243135"></a><a id="I_programlisting12_tt1571"></a></p><pre class="programlisting">[outgoing]
exten =&gt; call,1,NoOp()
   same =&gt; n,Set(CALLERID(name)=${${WHO}_CID_NAME})
   same =&gt; n,Set(CALLERID(number)=${${WHO}_CID_NUMBER})
   same =&gt; n,Dial(SIP/service_provider/${E})
   same =&gt; n,Playback(silence/2&amp;pls-try-call-later)
   same =&gt; n,Hangup()</pre><p>Our <code class="literal">service_provider</code> might look something like this
    in <code class="filename">sip.conf</code>:</p><p><a id="Database_id243160"></a><a id="I_programlisting12_tt1572"></a></p><pre class="programlisting">[service_provider]
type=friend
host=switch1.service_provider.net
defaultuser=my_username
fromuser=my_username
secret=welcome
context=incoming
canreinvite=no
disallow=all
allow=ulaw</pre><p><a id="Database_id243171"></a>Now that we’ve implemented a fairly complex
    feature in the dialplan with the help of <code class="literal">func_odbc</code> to retrieve and store data in a remote
    relational database, hopefully you’re starting to get why we think this is
    so cool. With a handful of self-defined dialplan functions in the
    <code class="filename">func_odbc.conf</code> file and a couple of
    tables in a database, we can create some fairly rich applications!</p><p><a id="Database_id243192"></a>How many things have you just thought of that
    you could apply <code class="literal">func_odbc</code> to?<a id="I_indexterm16_d1e36282" class="indexterm"></a><a id="I_indexterm16_d1e36283" class="indexterm"></a><a id="I_indexterm16_d1e36284" class="indexterm"></a></p></div><div class="sect1" title="Using Realtime"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="I_section12_tt1465"></a>Using Realtime</h2></div></div></div><p><a id="Database_id243208"></a><a id="index-034E856IK2P" class="indexterm"></a><a id="index-050V560HO4J" class="indexterm"></a>The Asterisk Realtime Architecture (ARA) enables you to
    store the configuration files (that would normally be found in <code class="filename">/etc/asterisk</code>) and their configuration options
    in a database table. There are two types of realtime:
    <span class="emphasis"><em>static</em></span><a id="I_indexterm16_d1e36303" class="indexterm"></a> and <span class="emphasis"><em>dynamic</em></span><a id="I_indexterm16_d1e36309" class="indexterm"></a>.</p><p><a id="Database_id243223"></a>The static version is similar to the
    traditional method of reading a configuration file, except that the data
    is read from the database instead.</p><p><a id="Database_id243228"></a>The dynamic realtime method, which loads and
    updates the information as it is required, is used for things such as
    SIP/IAX2 user and peer objects and voicemail.</p><p><a id="Database_id243232"></a>Making changes to static information requires
    a reload, just as if you had changed a text file on the system, but
    dynamic information is polled by Asterisk as needed, so no reload is
    required when changes are made to this data. Realtime is configured in the
    <code class="filename">extconfig.conf</code> file located in the
    <code class="filename">/etc/asterisk</code> directory. This file
    tells Asterisk what to load from the database and where to load it from,
    allowing certain files to be loaded from the database and other files to
    be loaded from the standard configuration files.</p><div class="sect2" title="Static Realtime"><div class="titlepage"><div><div><h3 class="title"><a id="static_realtime"></a>Static Realtime</h3></div></div></div><p><a id="Database_id243256"></a><a id="I_indexterm16_d1e36329" class="indexterm"></a><a id="I_indexterm16_d1e36336" class="indexterm"></a>Static realtime is useful when you want to load from a
      database the configuration that you would normally place in the
      configuration files in <code class="filename">/etc/asterisk</code>. The same rules that apply to
      flat files on your system still apply when using static realtime. For
      example, after making changes to the configuration you must either run
      the <span class="command"><strong>reload</strong></span> command <a id="I_indexterm16_d1e36348" class="indexterm"></a><a id="I_indexterm16_d1e36351" class="indexterm"></a>from the Asterisk CLI, or reload the module associated
      with the configuration file (e.g., using <code class="filename">module reload chan_sip.so</code>).</p><p><a id="Database_id243270"></a>When using static realtime, we tell
      Asterisk which files we want to load from the database using the
      following syntax in the <code class="filename">extconfig.conf</code> file:</p><p><a id="Database_id243277"></a><a id="Database_id243278"></a></p><pre class="programlisting">; /etc/asterisk/extconfig.conf
filename.conf =&gt; driver,database[,table]</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id243284"></a>If the table name is not specified,
          Asterisk will use the name of the file as the table name
          instead.</p></div><p>The static realtime module uses a specifically formatted table
      to read the configuration of static files in from the database. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id243292" title="Table 16.2. Table layout and description of ast_config">Table&nbsp;16.2, “Table layout and description of ast_config”</a> illustrates the columns as they should be
      defined in your database:</p><div class="table"><a id="Database_id243292"></a><p class="title"><strong>Table&nbsp;16.2.&nbsp;Table layout and description of ast_config</strong></p><div class="table-contents"><table summary="Table layout and description of ast_config" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Column name</th><th align="center">Column type</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">id</code></td><td>Serial, auto-<span class="keep-together">incrementing</span></td><td>An auto-incrementing unique value for each row in the
              table.</td></tr><tr><td><code class="literal">cat_metric</code></td><td>Integer</td><td>The weight of the category within the file. A lower
              metric means it appears higher in the file (see the sidebar
              <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#A_word_metrics_sidebar" title="A Word About Metrics"></a>).</td></tr><tr><td><code class="literal">var_metric</code></td><td>Integer</td><td>The weight of an item within a category. A lower metric
              means it appears higher in the list (see the sidebar <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#A_word_metrics_sidebar" title="A Word About Metrics"></a>). This is useful for things
              like codec order in <code class="filename">sip.conf</code>, or <code class="filename">iax.conf</code> where you want <code class="literal">disallow=all</code> to appear first (metric
              of <code class="literal">0</code>), followed by <code class="literal">allow=ulaw</code> (metric of <code class="literal">1</code>), then <code class="literal">allow=gsm</code> (metric of <code class="literal">2</code>).</td></tr><tr><td><code class="literal">filename</code></td><td>Varchar 128</td><td>The filename the module would normally read from the hard
              drive of your system (e.g., <code class="filename">musiconhold.conf</code>, <code class="filename">sip.conf</code>, <code class="filename">iax.conf</code>, etc.).</td></tr><tr><td><code class="literal">category</code></td><td>Varchar 128</td><td>The section name within the file, such as <code class="literal">[general]</code>. Do not include the square
              brackets around the name when saving to the database.</td></tr><tr><td><code class="literal">var_name</code></td><td>Varchar 128</td><td>The option on the left side of the equals sign (e.g.,
              <code class="literal">disallow</code> is the <code class="literal">var_name</code> in <code class="literal">disallow=all</code>).</td></tr><tr><td><code class="literal">var_val</code></td><td>Varchar 128</td><td>The value of an option on the right side of the equals
              sign (e.g., <code class="literal">all</code> is the
              <code class="literal">var_val</code> in <code class="literal">disallow=all</code>).</td></tr><tr><td><code class="literal">commented</code></td><td>Integer</td><td>Any value other than 0 will evaluate as if it were
              prefixed with a semicolon in the flat file (commented
              out).</td></tr></tbody></table></div></div><br class="table-break"><div class="sidebar" title="A Word About Metrics"><a id="A_word_metrics_sidebar"></a><div class="titlepage"><div><div><p class="title"><strong>A Word About Metrics</strong></p></div></div></div><p><a id="Database_id243535"></a>The metrics <a id="I_indexterm16_d1e36518" class="indexterm"></a>in static realtime are used to control the order in
        which objects are read into memory. Think of the <code class="literal">cat_metric</code> and <code class="literal">var_metric</code> as the original line numbers in
        the flat file. A higher <span class="emphasis"><em>cat_metric</em></span> is processed
        first, because Asterisk matches categories from bottom to top. Within
        a category, through, a lower <code class="literal">var_metric</code> is processed first, because
        Asterisk processes the options top-down (e.g., <code class="literal">disallow=all</code> should be set to a value lower
        than the <code class="literal">allow</code>’s value within a
        category to make sure it is processed first).</p></div><p><a id="Database_id243571"></a>A simple file we can load from static
      realtime is the <code class="filename">musiconhold.conf</code><sup>[<a id="id608622" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id608622" class="footnote">149</a>]</sup> file. Let’s start by moving this file to a temporary
      location:</p><p><a id="Database_id243586"></a><a id="I_programlisting12_tt1493"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /etc/asterisk</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>mv musiconhold.conf musiconhold.conf.old</code></strong></pre><p>In
      order for the classes to be removed from memory, we need to restart
      Asterisk. Then we can verify that our classes are blank by running
      <span class="command"><strong>moh show classes</strong></span>:</p><p><a id="Database_id243614"></a><a id="I_programlisting12_tt1494"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core restart now</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>moh show classes</code></strong>
<code class="prompt">*CLI&gt;</code></pre><p>Let’s put the <code class="literal">[default]</code> class back into Asterisk, but now
      we’ll load it from the database. Connect to your database and execute
      the following <code class="literal">INSERT</code>
      statements:</p><p><a id="Database_id243647"></a><a id="I_programlisting12_tt1495"></a></p><pre class="screen">&gt; <strong class="userinput"><code>INSERT INTO ast_config (filename,category,var_name,var_val)
  VALUES ('musiconhold.conf','default','mode','files');</code></strong>

&gt; <strong class="userinput"><code>INSERT INTO ast_config (filename,category,var_name,var_val)
  VALUES ('musiconhold.conf','default','directory','/var/lib/asterisk/moh');</code></strong></pre><p>You
      can verify that your values have made it into the database by running a
      <code class="literal">SELECT</code> statement:</p><p><a id="Database_id243666"></a><a id="I_programlisting12_tt1496"></a></p><pre class="screen"><code class="prompt">asterisk=#</code> <strong class="userinput"><code>SELECT filename,category,var_name,var_val FROM ast_config;</code></strong>

<code class="computeroutput"> filename         | category       | var_name     | var_val
------------------+----------------+--------------+------------------------
 musiconhold.conf | default        | mode         | files
 musiconhold.conf | default        | directory    | /var/lib/asterisk/moh
(2 rows)</code></pre><p>There’s one last thing to modify in the
      <code class="filename">extconfig.conf</code> file in the
      <code class="filename">/etc/asterisk</code> directory to tell
      Asterisk to get the data for <code class="filename">musiconhold.conf</code> from the database using the
      ODBC connection. The first column states that we’re using the ODBC
      drivers to connect (<code class="filename">res_odbc.conf</code>)
      and that the connection name is <code class="literal">asterisk</code> (as defined with <code class="literal">[asterisk]</code> in <code class="filename">res_odbc.conf</code>). Add the following line to the
      end of the <code class="filename">extconfig.conf</code> file, and
      then save it:</p><p><a id="Database_id243708"></a><a id="I_programlisting12_tt1497"></a></p><pre class="programlisting">musiconhold.conf =&gt; odbc,asterisk,ast_config</pre><p>Then
      connect to the Asterisk console and perform a reload:</p><p><a id="Database_id243721"></a><a id="I_programlisting12_tt1498"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload res_musiconhold.so</code></strong></pre><p>You
      can now verify that your music on hold classes are loading from the
      database by running<a id="I_indexterm16_d1e36653" class="indexterm"></a><a id="I_indexterm16_d1e36656" class="indexterm"></a> <span class="command"><strong>moh show
      classes</strong></span>:</p><p><a id="Database_id243743"></a><a id="I_programlisting12_tt1499"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>moh show classes</code></strong>
<code class="computeroutput">Class: general
        Mode: files
        Directory: /var/lib/asterisk/moh</code></pre><p>And there
      you go: <code class="filename">musiconhold.conf</code> loaded
      from the database. If you have issues with the reload of the module
      loading the data into memory, try restarting Asterisk. You can perform
      the same steps in order to load other flat files from the database, as
      needed.</p></div><div class="sect2" title="Dynamic Realtime"><div class="titlepage"><div><div><h3 class="title"><a id="dynamic_realtime"></a>Dynamic Realtime</h3></div></div></div><p><a id="Database_id243777"></a><a id="index-264A683LI3J" class="indexterm"></a><a id="index-007S770BM1W" class="indexterm"></a><a id="index-674S313DL8V" class="indexterm"></a>The dynamic realtime system is used to load objects that
      may change often, such as SIP/IAX2 users and peers, queues and their
      members, and voicemail messages. Likewise, when new records are likely
      to be added on a regular basis, we can utilize the power of the database
      to let us load this information on an as-needed basis.</p><p><a id="Database_id243784"></a>All of realtime is configured in the
      <code class="filename">/etc/asterisk/extconfig.conf</code><a id="I_indexterm16_d1e36701" class="indexterm"></a><a id="I_indexterm16_d1e36704" class="indexterm"></a> file, but dynamic realtime has well-defined configuration
      names. Defining something like SIP peers is done with the following
      format:</p><p><a id="Database_id243800"></a><a id="I_programlisting12_tt1502"></a></p><pre class="programlisting">; extconfig.conf
sippeers =&gt; <em class="replaceable"><code>driver</code></em>,<em class="replaceable"><code>database</code></em>[,<em class="replaceable"><code>table</code></em>]</pre><p>The
      table name is optional. If it is omitted, Asterisk will use the
      predefined name (i.e., <code class="literal">sippeers</code>) to
      identify the table in which to look up the data.</p><p><a id="Database_id243824"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id243828"></a>Remember that we have both SIP peers
          and SIP users: peers are end-points we send calls to, and a user is
          something we receive calls from. A friend is shorthand that defines
          both.</p></div><p>In our example, we’ll be using the <code class="literal">ast_sippeers</code> table to store our SIP peer
      information. So, to configure Asterisk to load all SIP peers from our
      database using realtime, we would define something like this:</p><p><a id="Database_id243836"></a><a id="I_programlisting12_tt1503"></a></p><pre class="programlisting">; extconfig.conf
sippeers =&gt; odbc,asterisk,ast_sipfriends</pre><p>To also load our
      SIP users from the database, we would define the <code class="literal">sipusers</code> object <span class="keep-together">like so</span>:</p><p><a id="Database_id243848"></a><a id="I_programlisting12_tt1504"></a></p><pre class="programlisting">sipusers =&gt; odbc,asterisk,ast_sipfriends</pre><p>You
      may have noticed we used the same table for both the <code class="literal">sippeers</code> and <code class="literal">sipusers</code>. This is because there will be a
      <code class="literal">type</code> field (just as if we were
      defining the type in the <span class="emphasis"><em>sip.conf </em></span>file) that will
      let us define a type of <code class="literal">user</code>,
      <code class="literal">peer</code>, or <code class="literal">friend</code>. If you unload <code class="filename">chan_sip.so</code> and then load it back into memory
      (i.e., using <span class="command"><strong>module unload
      chan_sip.so</strong></span> followed by <span class="command"><strong>module load
      chan_sip.so</strong></span>) after configuring <code class="filename">extconfig.conf</code>, you will be greeted with some
      warnings telling you which columns you’re missing for the realtime
      table. Since we’ve enabled <code class="literal">sippeers</code>
      and <code class="literal">sipusers</code> in <code class="filename">extconfig.conf</code>, we will get the following on
      the console (which has been trimmed due to space requirements):</p><p><a id="Database_id243906"></a><a id="Database_id243907"></a></p><pre class="screen">WARNING: Realtime table ast_sipfriends@asterisk requires column 
'name', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'ipaddr', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'port', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'regseconds', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'defaultuser', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'fullcontact', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'regserver', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'useragent', but that column does not exist!

WARNING: Realtime table ast_sipfriends@asterisk requires column 
'lastms', but that column does not exist!
</pre><p>As you can see, we are missing several columns from the table
      <code class="literal">ast_sipfriends</code>, which we’ve defined
      as connecting to the <code class="literal">asterisk</code> object
      as defined in <code class="filename">res_odbc.conf</code>. The
      next step is to create our <code class="literal">ast_sipfriends</code> table with all the columns
      listed by the warning messages, in addition to the following: the
      <code class="literal">type</code> column, which is required to
      define users, peers, and friends; the <code class="literal">secret</code> column, which is used for setting a
      password; and the <code class="literal">host</code> column, which
      allows us to define whether the peer is dynamically registering to us or
      has a static IP address. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id243940" title="Table 16.3. Minimal sippeers/sipusers realtime table">Table&nbsp;16.3, “Minimal sippeers/sipusers realtime table”</a> lists all
      of the columns that should appear in our table, and their types.</p><div class="table"><a id="Database_id243940"></a><p class="title"><strong>Table&nbsp;16.3.&nbsp;Minimal sippeers/sipusers realtime table</strong></p><div class="table-contents"><table summary="Minimal sippeers/sipusers realtime table" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Column name</th><th align="center">Column type</th></tr></thead><tbody><tr><td><code class="literal">type</code></td><td>Varchar 6</td></tr><tr><td><code class="literal">name</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">secret</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">context</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">host</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">ipaddr</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">port</code></td><td>Varchar 5</td></tr><tr><td><code class="literal">regseconds</code></td><td>Bigint</td></tr><tr><td><code class="literal">defaultuser</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">fullcontact</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">regserver</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">useragent</code></td><td>Varchar 128</td></tr><tr><td><code class="literal">lastms</code></td><td>Integer</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Database_id275977"></a>For each peer you want to register, you
      need to insert data in the columns <code class="literal">type</code>, <code class="literal">name</code>,
      <code class="literal">secret</code>, <code class="literal">context</code>, <code class="literal">host</code>, and <code class="literal">defaultuser</code>. The rest of the columns will be
      populated automatically when the peer registers.</p><p><a id="Database_id276001"></a>The <code class="literal">port</code>, <code class="literal">regseconds</code>, and <code class="literal">ipaddr</code> fields are required to let Asterisk
      store the registration information for the peer so it can determine
      where to send the calls. (Note that if the peer is <code class="literal">static</code>, you will have to populate the <code class="literal">ipaddr</code> field yourself.) The <code class="literal">port</code> field is optional and defaults to the
      standard port defined in the <code class="literal">[general]</code> section, and the <code class="literal">regseconds</code> will remain blank. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276054" title="Table 16.4. Example information used to populate the ast_sipfriends table">Table&nbsp;16.4, “Example information used to populate the ast_sipfriends
        table”</a> lists some sample values that we’ll use
      to populate our <code class="literal">ast_sipfriends</code>
      table.</p><div class="table"><a id="Database_id276054"></a><p class="title"><strong>Table&nbsp;16.4.&nbsp;Example information used to populate the ast_sipfriends
        table</strong></p><div class="table-contents"><table summary="Example information used to populate the ast_sipfriends
        table" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Column name</th><th align="center">Value</th></tr></thead><tbody><tr><td><code class="literal">type</code></td><td><code class="literal">friend</code></td></tr><tr><td><code class="literal">name</code></td><td><code class="literal">0000FFFF0008</code></td></tr><tr><td><code class="literal">defaultuser</code></td><td><code class="literal">0000FFFF0008</code></td></tr><tr><td><code class="literal">host</code></td><td><code class="literal">dynamic</code></td></tr><tr><td><code class="literal">secret</code></td><td><code class="literal">welcome</code></td></tr><tr><td><code class="literal">context</code></td><td><code class="literal">LocalSets</code></td></tr></tbody></table></div></div><br class="table-break"><p><a id="Database_id276144"></a>Prior to registering your peer, though, you
      need to enable realtime caching in <code class="filename">sip.conf</code>. Otherwise, the peer will not be
      loaded into memory, and the registration will not be remembered. If your
      peers only place calls and don’t need to register to your system, you
      don’t need to enable realtime caching because the peers will be checked
      against the database each time they place a call. However, if you load
      your peers into memory, the database will only need to be contacted on
      initial registration, and after the registration expires.</p><p><a id="Database_id276156"></a>Additional options in <code class="filename">sip.conf</code><a id="I_indexterm16_d1e37026" class="indexterm"></a> exist for realtime peers. These are defined in the
      <code class="literal">[general]</code>
      section <a id="I_indexterm16_d1e37033" class="indexterm"></a>and described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276166" title="Table 16.5. Realtime options in sip.conf">Table&nbsp;16.5, “Realtime options in sip.conf”</a>.</p><div class="table"><a id="Database_id276166"></a><p class="title"><strong>Table&nbsp;16.5.&nbsp;Realtime options in sip.conf</strong></p><div class="table-contents"><table summary="Realtime options in sip.conf" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center"><span class="keep-together">Configuration</span> option</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">rtcachefriends</code></td><td><a id="I_indexterm16_d1e37059" class="indexterm"></a>Caches peers in memory on an as-needed basis after
              they have contacted the server. That is, on Asterisk start, the
              peers are not loaded into memory automatically; only after a
              peer has contacted the server (e.g., via a registration or phone
              call) is it loaded in memory. Values are <code class="literal">yes</code> or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">rtsavesysname</code></td><td><a id="I_indexterm16_d1e37074" class="indexterm"></a>When a peer registers to the system, saves the
              <code class="literal">systemname</code> (as defined in
              <code class="filename">asterisk.conf</code>) into the
              <code class="literal">regserver</code> field within the
              database. (See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#setting_systemname" title="Setting the systemname for Globally Unique IDs">Setting the systemname for Globally Unique IDs</a> for more
              information.) Using <code class="literal">regserver</code>
              is useful when you have multiple servers registering peers to
              the same table. Values are <code class="literal">yes</code> or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">rtupdate</code></td><td><a id="I_indexterm16_d1e37104" class="indexterm"></a>Sends registration information such as the IP
              address, the origination port, the registration period, and the
              username of the <code class="literal">user-agent</code> to
              the database when a peer registers to Asterisk. Values are
              <code class="literal">yes</code> or <code class="literal">no</code>, and the default is <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">rtautoclear</code></td><td><a id="I_indexterm16_d1e37125" class="indexterm"></a>Automatically expires friends on the same schedule
              as if they had just registered. This causes a peer to be removed
              from memory when the registration period has expired, until that
              peer is requested again (e.g., via registration or placing a
              call). Values are <code class="literal">yes</code>,
              <code class="literal">no</code>, or an integer value that
              causes the peers to be removed from memory after that number of
              seconds instead of the registration interval.</td></tr><tr><td><code class="literal">ignoreregexpire</code></td><td><a id="I_indexterm16_d1e37140" class="indexterm"></a>When enabled, peers are not removed from memory
              when the registration period expires. Instead, the information
              is left in memory so that if a call is requested to an endpoint
              that has an expired registration, the last known information (IP
              address, port, etc.) will be tried.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Database_id276309"></a>After enabling <code class="literal">rtcachefriends=yes</code> in <code class="filename">sip.conf</code> and reloading <code class="filename">chan_sip.so</code> (using <span class="command"><strong>module reload chan_sip.so</strong></span>), you can register
      your peer to Asterisk using realtime, and the peer should then be
      populated into memory. You will be able to verify this by executing the
      <span class="command"><strong>sip show peers</strong></span> command on the
      Asterisk console:</p><p><a id="Database_id276331"></a><a id="Database_id276332"></a></p><pre class="screen">Name/username              Host         Dyn Port Status      Realtime
0000FFFF0008/0000FFFF0008  172.16.0.160  D  5060 Unmonitored Cached RT</pre><p>If
      you were to look at the table in the database directly, you would see
      something <span class="keep-together">like this</span>:</p><p><a id="Database_id276339"></a><a id="Database_id276340"></a></p><pre class="screen">+--------+--------------+---------+-----------+---------+--------------+
| type   | name         | secret  | context   | host    | ipaddr       |
+--------+--------------+---------+-----------+---------+--------------+
| friend | 0000FFFF0008 | welcome | LocalSets | dynamic | 172.16.0.160 | 
+--------+--------------+---------+-----------+---------+--------------+
+------+------------+--------------+-------------------------------------+
| port | regseconds | defaultuser  | fullcontact                         |
+------+------------+--------------+-------------------------------------+
| 5060 | 1283928895 | 0000FFFF0008 | sip:0000FFFF0008@172.16.0.160:52722 |
+------+------------+--------------+-------------------------------------+
+-----------+-----------------+--------+
| regserver | useragent       | lastms |
+-----------+-----------------+--------+
| NULL      | Zoiper rev.6739 |      0 | 
+-----------+-----------------+--------+</pre><p>There are many more options
      for that we can define for SIP friends, such as the caller ID; adding
      that information is as simple as adding a <code class="literal">callerid</code> column to the table. See the
      <code class="filename">sip.conf.sample</code> file for more options
      that can be defined for SIP friends.<a id="I_indexterm16_d1e37178" class="indexterm"></a><a id="I_indexterm16_d1e37179" class="indexterm"></a><a id="I_indexterm16_d1e37180" class="indexterm"></a><a id="I_indexterm16_d1e37181" class="indexterm"></a><a id="I_indexterm16_d1e37182" class="indexterm"></a></p></div></div><div class="sect1" title="Storing Call Detail Records (CDRs)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="database_storing-cdr"></a>Storing Call Detail Records (CDRs)</h2></div></div></div><p><a id="Database_id276379"></a><a id="I_indexterm16_d1e37187" class="indexterm"></a><a id="I_indexterm16_d1e37192" class="indexterm"></a>Call detail records (CDRs) contain information about calls
    that have passed through your Asterisk system. They are discussed further
    in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring" title="Chapter 24. System Monitoring and Logging">Chapter&nbsp;24, <em>System Monitoring and Logging</em></a>. Storing CDRs is a popular use
    of databases in Asterisk, because it makes them easier to manage (for
    example, you can keep track of many Asterisk systems in a single table).
    Also, by placing records into a database you open up many possibilities,
    including building your own web interface for tracking statistics such as
    call usage and most-called locations, billing, or phone company invoice
    verification.</p><div class="sidebar" title="Setting the systemname for Globally Unique IDs"><a id="setting_systemname"></a><div class="titlepage"><div><div><p class="title"><strong>Setting the systemname for Globally Unique IDs</strong></p></div></div></div><p><a id="Database_id276405"></a><a id="I_indexterm16_d1e37204" class="indexterm"></a><a id="I_indexterm16_d1e37207" class="indexterm"></a>A CDR consists of a unique identifier and several fields
      of information about the call (including the source and destination
      channel, length of call, last application executed, and so forth). In a
      clustered set of Asterisk boxes, it is theoretically possible to have
      duplication among unique identifiers, since each Asterisk system
      considers only itself. To address this, we can automatically append a
      system identifier to the front of the unique IDs by adding an option to
      <code class="filename">/etc/asterisk/asterisk.conf</code>. For
      each of your boxes, set an identifier by adding something
      like:<a id="I_programlisting12_tt1513"></a></p><pre class="programlisting">[options]
systemname=toronto</pre></div><p><a id="Database_id276431"></a>The best way to store your call detail
    records is via the <code class="literal">cdr_adaptive_odbc</code>
    module. This module allows you to choose which columns of data built into
    Asterisk are stored in your table, and permits you to add additional
    columns that you can populate with the <code class="literal">CDR()</code> dialplan function.<a id="I_indexterm16_d1e37224" class="indexterm"></a><a id="I_indexterm16_d1e37227" class="indexterm"></a> You can even store different parts of CDR data to different
    tables and databases, if that is required.</p><p><a id="Database_id276445"></a>More information about the standard CDR
    columns in Asterisk is available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#default_cdr_fields" title="Table 24.2. Default CDR fields">Table&nbsp;24.2, “Default CDR fields”</a>.
    You can define all or any subset of these records in the database, and
    Asterisk will work around what is available. You can also add additional
    columns to store other data relevant to the calls. For example, if you
    wanted to implement least cost routing (LCR), you could add columns for
    route, per-minute cost, and per-minute rate. Once you’ve added those
    columns, they can be populated via the dialplan by using the <code class="literal">CDR()</code> function (e.g., <code class="literal">Set(CDR(per_minute_rate)=0.01)</code>).</p><p><a id="Database_id276466"></a>After creating your table in the database
    (which we’ll assume you’ve called <code class="literal">cdr</code>),
    you need to configure the <code class="filename">cdr_adaptive_odbc.conf</code> file in the <code class="filename">/etc/asterisk/</code> folder. The following example
    will utilize the <code class="literal">asterisk</code> connection
    we’ve defined in <code class="filename">res_odbc.conf</code> and
    store the data in the <code class="literal">cdr</code> table:</p><p><a id="Database_id276491"></a><a id="Database_id276492"></a></p><pre class="screen">; cdr_adaptive_odbc.conf
[adaptive_connection]
connection=asterisk
table=cdr</pre><p>Yes, really, that’s all you need. After configuring
    <code class="filename">cdr_adaptive_odbc.conf</code>, just reload
    the <code class="filename">cdr_adaptive_odbc.so</code> module from
    the Asterisk console by running <span class="command"><strong>module reload
    cdr_adaptive_odbc.so</strong></span><a id="I_indexterm16_d1e37277" class="indexterm"></a><a id="I_indexterm16_d1e37280" class="indexterm"></a>. You can verify that the Adaptive ODBC backend has been
    loaded by running <span class="command"><strong>cdr show
    status</strong></span>:</p><p><a id="Database_id276507"></a><a id="Database_id276508"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>cdr show status</code></strong>

Call Detail Record (CDR) settings
----------------------------------
  Logging:                    Enabled
  Mode:                       Simple
  Log unanswered calls:       No

* Registered Backends
  -------------------
    cdr-syslog
    <strong class="userinput"><code>Adaptive ODBC</code></strong>
    cdr-custom
    csv
    cdr_manager</pre><p>Now place a call that gets answered (e.g., using
    <code class="literal">Playback()</code>, or <code class="literal">Dial()</code>ing another channel and answering it). You
    should get some CDRs stored into your database. You can check by running
    <code class="literal">SELECT * FROM CDR;</code> from your database
    console.</p><p><a id="Database_id276532"></a>With the basic CDR information stored into
    the database, you might want to add some additional information to the
    <code class="literal">cdr</code> table, such as the route rate. You
    can use the <code class="literal">ALTER TABLE</code> directive to
    add a column called <code class="literal">route_rate</code> to the
    table:</p><p><a id="Database_id276552"></a><a id="Database_id276553"></a></p><pre class="screen"><code class="prompt">sql&gt;</code> <strong class="userinput"><code>ALTER TABLE cdr ADD COLUMN route_rate varchar(10);</code></strong></pre><p>Now
    reload the <code class="filename">cdr_adaptive_odbc.so</code>
    module from the Asterisk console:</p><p><a id="Database_id276564"></a><a id="Database_id276565"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload cdr_adaptive_odbc.so</code></strong></pre><p>and
    populate the new column from the Asterisk dialplan using the <code class="literal">CDR()</code> function, <span class="keep-together">like so</span>:</p><p><a id="Database_id276575"></a><a id="Database_id276576"></a></p><pre class="programlisting">exten =&gt; _NXXNXXXXXX,1,Verbose(1,Example of adaptive ODBC usage)
   same =&gt; n,Set(CDR(route_rate)=0.01)
   same =&gt; n,Dial(SIP/my_itsp/${EXTEN})
   same =&gt; n,Hangup()</pre><p><a id="Database_id276581"></a>After the alteration to your database and
    dialplan, you can place a call and then look at your CDRs. You should see
    something like the following:</p><p><a id="Database_id276585"></a><a id="Database_id276586"></a></p><pre class="screen">+--------------+----------+---------+------------+
| src          | duration | billsec | route_rate |
+--------------+----------+---------+------------+
| 0000FFFF0008 | 37       | 30      | 0.01       | 
+--------------+----------+---------+------------+
</pre><p>You now have enough information to calculate how much the call should
    have cost you, which enables you to either bill customers or check your
    records against what the phone company is sending you, so you can do
    monthly auditing of your phone bills.</p><div class="sidebar" title="Additional Configuration Options for cdr_adaptive_odbc.conf"><a id="Database_id276595"></a><div class="titlepage"><div><div><p class="title"><strong>Additional Configuration Options for
      cdr_adaptive_odbc.conf</strong></p></div></div></div><p><a id="Database_id276601"></a><a id="I_indexterm16_d1e37360" class="indexterm"></a><a id="I_indexterm16_d1e37363" class="indexterm"></a>Some extra configuration options exist in the <code class="filename">cdr_adaptive_odbc.conf</code> file that may be
      useful. The first is that you can define multiple databases or tables to
      store information into, so if you have multiple databases that need the
      same information, you can simply define them in <code class="filename">res_odbc.conf</code>, create tables in the
      databases, and then refer to them in separate sections of the
      configuration:</p><p><a id="Database_id276608"></a><a id="Database_id276609"></a></p><pre class="programlisting">[mysql_connection]
connection=asterisk_mysql
table=cdr

[mssql_connection]
connection=production_mssql
table=call_records</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id276614"></a>If you specify multiple sections using
          the same connection and table, you will get duplicate
          records.</p></div><p>Beyond just configuring multiple connections and tables (which
      of course may or may not contain the same information; the CDR module
      we’re using is adaptive to situations like that), we can define aliases
      for the built-in variables, such as <code class="literal">accountcode</code>, <code class="literal">src</code>, <code class="literal">dst</code>,
      <code class="literal">billsec</code>, etc.</p><p><a id="Database_id276624"></a>If we were to add aliases for column names
      for our MS SQL connection, we might alter our connection definition like
      so:</p><p><a id="Database_id276628"></a><a id="Database_id276629"></a></p><pre class="programlisting">[mssql_connection]
connection=production_mssql
table=call_records
<strong class="userinput"><code>alias src =&gt; Source
alias dst =&gt; Destination
alias accountcode =&gt; AccountCode
alias billsec =&gt; BillableTime</code></strong></pre><p>In
      some situations you may specify a connection where you only want to log
      calls from a specific source, or to a specific destination. We can do
      this with filters:</p><p><a id="Database_id276640"></a><a id="Database_id276641"></a></p><pre class="programlisting">[logging_for_device_0000FFFF0008]
connection=asterisk_mysql
table=cdr_for_0000FFFF0008
<span class="emphasis"><em>filter src =&gt; 0000FFFF0008</em></span></pre><p>If you need
      to populate a certain column with information based on a section name,
      you can set it statically with the <code class="literal">static</code> option, which you may utilize with the
      <code class="literal">filter</code> option:</p><p><a id="Database_id276656"></a><a id="Database_id276657"></a></p><pre class="programlisting">[mysql_connection]
connection=asterisk_mysql
table=cdr

[filtered_mysql_connection]
connection=asterisk_mysql
table=cdr
filter src =&gt; 0000FFFF0008
static "DoNotCharge" =&gt; accountcode</pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id276664"></a>In the preceding example you will get
          duplicate records in the same table, but all the information will be
          the same except for the populated <code class="literal">accountcode</code> column, so you should be able
          to filter it out using SQL.</p></div></div></div><div class="sect1" title="ODBC Voicemail"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="I_section12_tt1578"></a>ODBC Voicemail</h2></div></div></div><p><a id="Database_id276699"></a><a id="index-248U187HA1S" class="indexterm"></a><a id="index-286V551SF4P" class="indexterm"></a><a id="index-728N657TD6R" class="indexterm"></a>Asterisk enables you to store voicemail inside the database
    using the ODBC connector. This is useful in a clustered environment where
    you want to abstract the voicemail data from the local system so that
    multiple Asterisk boxes have access to the same data. Of course, you have
    to take into consideration that you are centralizing a part of Asterisk,
    and you need to take actions to protect that data, such as making regular
    backups and possibly clustering the database backend using
    replication.</p><p><a id="Database_id276707"></a>Asterisk stores each voicemail message inside
    a Binary Large Object (BLOB). When retrieving the data, it pulls the
    information out of the BLOB and temporarily stores it on the hard drive
    while it is being played back to the user. Asterisk then removes the BLOB
    and the record from the database when the user deletes the voicemail. Many
    databases, such as MySQL, contain native support for BLOBs, but as you’ll
    see, with PostgreSQL a couple of extra steps are required to utilize this
    functionality that we’ll explore in this section. When you’re done, you’ll
    be able to record, play back, and delete voicemail data from the database
    just as if it were stored on the local hard drive.</p><p><a id="Database_id276722"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id276725"></a>This section builds upon previous
        configuration sections in this chapter. If you have not already done
        so, be sure to follow the steps in the sections <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database" title="Installing PostgreSQL for CentOS">the section called “Installing PostgreSQL for CentOS”</a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc" title="Installing and Configuring ODBC">the section called “Installing and Configuring ODBC”</a> before continuing. In the
        latter section, be sure you have enabled <code class="literal">ODBC_STORAGE</code> in the menuselect system under
        <span class="emphasis"><em>Voicemail Options</em></span>.</p></div><div class="sidebar" title="Alternate Centralization Method"><a id="Database_id276756"></a><div class="titlepage"><div><div><p class="title"><strong>Alternate Centralization Method</strong></p></div></div></div><p><a id="Database_id276762"></a>Storing voicemail in a database is one way
      to centralize voicemail. Another method is to run a standalone voicemail
      server, as we discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail" title="Chapter 8. Voicemail">Chapter&nbsp;8, <em>Voicemail</em></a>.</p></div><div class="sect2" title="Creating the Large Object Type for PostgreSQL"><div class="titlepage"><div><div><h3 class="title"><a id="psql_large_object_support"></a>Creating the Large Object Type for PostgreSQL</h3></div></div></div><p><a id="Database_id276785"></a><a id="I_indexterm16_d1e37471" class="indexterm"></a><a id="I_indexterm16_d1e37478" class="indexterm"></a><a id="I_indexterm16_d1e37485" class="indexterm"></a>While MySQL has a BLOB (Binary Large OBject) type, we have
      to tell PostgreSQL how to handle large objects. This includes creating a
      trigger to clean up the data when we delete from the database a record
      that references a large object.</p><p><a id="Database_id276790"></a>Connect to the database as the
      <span class="emphasis"><em>asterisk</em></span> user from the console:<a id="I_programlisting12_tt1583"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>psql -h localhost -U asterisk asterisk</code></strong>
Password:</pre><p><a id="Database_id276810"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id276813"></a>You must be a
          <span class="emphasis"><em>superuser</em></span> to execute the following code. Also,
          if you use the <code class="filename">postgres</code> user to
          create the table, you will need to use the <code class="literal">ALTER TABLE</code> SQL directive to change the
          owner to the <span class="emphasis"><em>asterisk</em></span> user.</p></div><p>At the PostgreSQL console, run the following script to create
      the large object type:</p><p><a id="Database_id276834"></a><a id="I_programlisting12_tt1584"></a></p><pre class="programlisting">CREATE FUNCTION loin (cstring) RETURNS lo AS 'oidin' LANGUAGE internal
IMMUTABLE STRICT;

CREATE FUNCTION loout (lo) RETURNS cstring AS 'oidout' LANGUAGE internal
IMMUTABLE STRICT;

CREATE FUNCTION lorecv (internal) RETURNS lo AS 'oidrecv' LANGUAGE internal
IMMUTABLE STRICT;

CREATE FUNCTION losend (lo) RETURNS bytea AS 'oidrecv' LANGUAGE internal
IMMUTABLE STRICT;

CREATE TYPE lo ( INPUT = loin, OUTPUT = loout, RECEIVE = lorecv, SEND = losend,
INTERNALLENGTH = 4, PASSEDBYVALUE );

CREATE CAST (lo AS oid) WITHOUT FUNCTION AS IMPLICIT;
CREATE CAST (oid AS lo) WITHOUT FUNCTION AS IMPLICIT;</pre><p>We’ll be
      making use of the PostgreSQL procedural language called pgSQL/PL to
      create a function. This function will be called from a trigger that gets
      executed whenever we modify or delete a record in the table used to
      store voicemail messages. This is so the data is cleaned up and not left
      as an orphan in the database:</p><p><a id="Database_id276859"></a><a id="I_programlisting12_tt1585"></a></p><pre class="programlisting">CREATE FUNCTION vm_lo_cleanup() RETURNS "trigger"
    AS $$
    declare
      msgcount INTEGER;
    begin
      -- raise notice 'Starting lo_cleanup function for large object with oid
         %',old.recording;
      -- If it is an update action but the BLOB (lo) field was not changed,
         don't do anything
      if (TG_OP = 'UPDATE') then
        if ((old.recording = new.recording) or (old.recording is NULL)) then
          raise notice 'Not cleaning up the large object table,
          as recording has not changed';
          return new;
        end if;
      end if;
      if (old.recording IS NOT NULL) then
        SELECT INTO msgcount COUNT(*) AS COUNT FROM voicemessages WHERE recording
        = old.recording;
        if (msgcount &gt; 0) then
          raise notice 'Not deleting record from the large object table, as object
          is still referenced';
          return new;
        else
          perform lo_unlink(old.recording);
          if found then
            raise notice 'Cleaning up the large object table';
            return new;
          else
            raise exception 'Failed to clean up the large object table';
            return old;
          end if;
        end if;
      else
        raise notice 'No need to clean up the large object table, 
        no recording on old row';

        return new;
      end if;
    end$$
    LANGUAGE plpgsql;</pre><p>We’re going to create a table called
      <code class="literal">voicemessages</code> where the voicemail
      information will be stored:</p><p><a id="Database_id276889"></a><a id="I_programlisting12_tt1586"></a></p><pre class="programlisting">CREATE TABLE voicemessages
(
  uniqueid serial PRIMARY KEY,
  msgnum int4,
  dir varchar(80),
  context varchar(80),
  macrocontext varchar(80),
  callerid varchar(40),
  origtime varchar(40),
  duration varchar(20),
  mailboxuser varchar(80),
  mailboxcontext varchar(80),
  recording lo,
  label varchar(30),
  "read" bool DEFAULT false,
  flag varchar(10)
);</pre><p>And now we need to associate a trigger with our newly
      created table in order to perform cleanup whenever we change or delete a
      record in the <code class="literal">voicemessages</code>
      table:</p><p><a id="Database_id276909"></a><a id="I_programlisting12_tt1587"></a></p><pre class="programlisting">CREATE TRIGGER vm_cleanup AFTER DELETE OR UPDATE ON voicemessages FOR EACH ROW
EXECUTE PROCEDURE vm_lo_cleanup();</pre></div><div class="sect2" title="ODBC Voicemail Storage Table Layout"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id276920"></a>ODBC Voicemail Storage Table Layout</h3></div></div></div><p><a id="Database_id276925"></a><a id="I_indexterm16_d1e37547" class="indexterm"></a><a id="I_indexterm16_d1e37554" class="indexterm"></a><a id="I_indexterm16_d1e37561" class="indexterm"></a>We’ll be utilizing the <code class="literal">voicemessages</code> table for storing our voicemail
      information in an ODBC-connected database. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276938" title="Table 16.6. ODBC voicemail storage table layout">Table&nbsp;16.6, “ODBC voicemail storage table layout”</a> describes the table configuration for
      ODBC voicemail storage. If you’re using a PostgreSQL database, the table
      definition and large object support were configured in the preceding
      section.</p><div class="table"><a id="Database_id276938"></a><p class="title"><strong>Table&nbsp;16.6.&nbsp;ODBC voicemail storage table layout</strong></p><div class="table-contents"><table summary="ODBC voicemail storage table layout" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Column name</th><th align="center">Column type</th></tr></thead><tbody><tr><td><code class="literal">uniqueid</code></td><td>Serial, primary key</td></tr><tr><td><code class="literal">dir</code></td><td>Varchar 80</td></tr><tr><td><code class="literal">msgnum</code></td><td>Integer</td></tr><tr><td><code class="literal">recording</code></td><td>BLOB (Binary Large OBject)</td></tr><tr><td><code class="literal">context</code></td><td>Varchar 80</td></tr><tr><td><code class="literal">macrocontext</code></td><td>Varchar 80</td></tr><tr><td><code class="literal">callerid</code></td><td>Varchar 40</td></tr><tr><td><code class="literal">origtime</code></td><td>Varchar 40</td></tr><tr><td><code class="literal">duration</code></td><td>Varchar 20</td></tr><tr><td><code class="literal">mailboxuser</code></td><td>Varchar 80</td></tr><tr><td><code class="literal">mailboxcontext</code></td><td>Varchar 80</td></tr><tr><td><code class="literal">label</code></td><td>Varchar 30</td></tr><tr><td><code class="literal">read</code></td><td>Boolean, default false<sup>[<a id="id611294" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id611294" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">flag</code></td><td>Varchar 10</td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.id611294" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id611294" class="para">a</a>] </sup><code class="literal">read</code> is a reserved word in both
                  MySQL and PostgreSQL (and likely other databases), which
                  means you need to escape the column name when you create it.
                  In MySQL this is done with backticks (<code class="literal">`</code>) around the word <code class="literal">read</code> when you create the table,
                  and in PostgreSQL with double quotes (<code class="literal">"</code>). In MS SQL you would use square
                  brackets, e.g., <code class="literal">[read]</code>.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Configuring voicemail.conf for ODBC Storage"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id277131"></a>Configuring voicemail.conf for ODBC Storage</h3></div></div></div><p><a id="Database_id277137"></a><a id="I_indexterm16_d1e37691" class="indexterm"></a><a id="I_indexterm16_d1e37698" class="indexterm"></a><a id="I_indexterm16_d1e37705" class="indexterm"></a><a id="I_indexterm16_d1e37712" class="indexterm"></a><a id="I_indexterm16_d1e37717" class="indexterm"></a>There isn’t much to add to the <code class="filename">voicemail.conf</code> file to enable the ODBC
      voicemail storage. In fact, it’s only three lines! Normally, you
      probably have multiple format types defined in the <code class="literal">[general]</code> section of <code class="filename">voicemail.conf</code>, but we need to set this to a
      single format because we can only save one file (format) to the
      database. The <code class="filename">wav49</code> format is a
      compressed WAV file format that should be playable on both Linux and
      Microsoft Windows desktops.</p><p><a id="Database_id277157"></a>The <code class="literal">odbcstorage</code> option <a id="I_indexterm16_d1e37741" class="indexterm"></a>points at the name you defined in the <code class="filename">res_odbc.conf</code><a id="I_indexterm16_d1e37747" class="indexterm"></a><a id="I_indexterm16_d1e37750" class="indexterm"></a> file (if you’ve been following along in this chapter,
      then we called it <span class="emphasis"><em>asterisk</em></span>). The <code class="literal">odbctable</code> option refers to the table where
      voicemail information should be stored. In the examples in this chapter
      we use the table named <code class="literal">voicemessages</code>:</p><p><a id="Database_id277185"></a><a id="I_programlisting12_tt1590"></a></p><pre class="programlisting">[general]
format=wav49
odbcstorage=asterisk
odbctable=voicemessages</pre><p>You may want to create a separate
      voicemail context, or you can utilize the <code class="literal">default</code> voicemail context. Alternatively, you
      can skip creating a new user and use an existing user, such as <code class="literal">0000FFFF0001</code>. We’ll define the mailbox in the
      default voicemail context like so:</p><p><a id="Database_id277205"></a><a id="I_programlisting12_tt1591"></a></p><pre class="programlisting">[default]
1000 =&gt; 1000,J.P. Wiser</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id277216"></a>You can also use the <code class="literal">voicemail</code> definition in <code class="filename">extconfig.conf</code><a id="I_indexterm16_d1e37787" class="indexterm"></a><a id="I_indexterm16_d1e37790" class="indexterm"></a> to load your users from the database. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime" title="Dynamic Realtime">the section called “Dynamic Realtime”</a> for more information about setting up
        certain module configuration options in the database, and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime" title="Static Realtime">the section called “Static Realtime”</a> for details on loading the rest of the
        configuration file.</p></div><p><a id="Database_id277241"></a>Now connect to your Asterisk console and
      unload then reload the <code class="filename">app_voicemail.so</code> module:</p><p><a id="Database_id277248"></a><a id="I_programlisting12_tt1592"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module unload app_voicemail.so</code></strong>
  == Unregistered application 'VoiceMail'
  == Unregistered application 'VoiceMailMain'
  == Unregistered application 'MailboxExists'
  == Unregistered application 'VMAuthenticate'

<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module load app_voicemail.so</code></strong>
 Loaded /usr/lib/asterisk/modules/app_voicemail.so =&gt; 
(Comedian Mail (Voicemail System))
  == Registered application 'VoiceMail'
  == Registered application 'VoiceMailMain'
  == Registered application 'MailboxExists'
  == Registered application 'VMAuthenticate'
  == Parsing '/etc/asterisk/voicemail.conf': Found</pre><p><a id="Database_id277279"></a>Then verify that your new mailbox loaded
      successfully:</p><p><a id="Database_id277282"></a><a id="I_programlisting12_tt1593"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>voicemail show users for default</code></strong>
Context    Mbox  User                      Zone       NewMsg
default    1000  J.P. Wiser                                0</pre></div><div class="sect2" title="Testing ODBC Voicemail"><div class="titlepage"><div><div><h3 class="title"><a id="Database_id277300"></a>Testing ODBC Voicemail</h3></div></div></div><p><a id="Database_id277305"></a><a id="index-063B376BL7R" class="indexterm"></a><a id="index-721V325QF5P" class="indexterm"></a><a id="index-455R374NP3D" class="indexterm"></a><a id="index-475H546BD2I" class="indexterm"></a>Let’s create some simple dialplan logic to leave and
      retrieve some voicemail from our test voicemail box. You can use the
      simple dialplan logic that follows (or, of course, any voicemail
      delivery and retrieval functionality you defined earlier in this
      book):</p><p><a id="Database_id277314"></a><a id="I_programlisting12_tt1594"></a></p><pre class="programlisting">[odbc_vm_test]
exten =&gt; 100,1,VoiceMail(1000@default)      ; leave a voicemail
exten =&gt; 200,1,VoiceMailMain(1000@default)  ; retrieve a voicemail</pre><p><a id="Database_id277325"></a>Once you’ve updated your <code class="filename">extensions.conf</code> file, be sure to reload the
      dialplan:</p><p><a id="Database_id277332"></a><a id="I_programlisting12_tt1596"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>dialplan reload</code></strong></pre><p>You can either
      <code class="literal">include</code> the <code class="literal">odbc_vm_test</code> context into a context accessible
      by an existing user, or create a separate user to test with. If you wish
      to do the latter, you could define a new SIP user in <code class="filename">sip.conf</code> like so (this will work assuming the
      phone is on the local LAN):</p><p><a id="Database_id277375"></a><a id="I_programlisting12_tt1597"></a></p><pre class="programlisting">[odbc_test_user]
type=friend
secret=supersecret
context=odbc_vm_test
host=dynamic
qualify=yes
disallow=all
allow=ulaw
allow=gsm</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Database_id277367"></a><a id="I_indexterm16_d1e37890" class="indexterm"></a><a id="I_indexterm16_d1e37895" class="indexterm"></a>One of the ways that unsavory folks get into systems
          is via test users that are not immediately removed from the system
          after testing. Whenever you’re utilizing a test extension, you
          should be doing it on a system that is removed from the Internet, or
          at the very least, place it into a context that does not have access
          to outbound dialing and has a strong <span class="keep-together">password</span>.</p></div><p>Don’t forget to reload the SIP module:</p><p><a id="Database_id277388"></a><a id="I_programlisting12_tt1598"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload chan_sip.so</code></strong></pre><p>And
      verify that the SIP user exists:</p><p><a id="Database_id277403"></a><a id="I_programlisting12_tt1599"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>sip show users like odbc_test_user</code></strong>
Username         Secret           Accountcode      Def.Context      ACL  NAT
odbc_test_user   supersecret                       odbc_vm_test     No   RFC3581</pre><p><a id="Database_id277420"></a>Then configure your phone or client with
      the username <span class="emphasis"><em>odbc_test_user</em></span> and password
      <span class="emphasis"><em>&lt;supersecret&gt;</em></span>, and place a call to extension
      <code class="literal">100</code> to leave a voicemail. If
      successful, you should see something like:</p><p><a id="Database_id277431"></a><a id="I_programlisting12_tt1600"></a></p><pre class="screen">    -- Executing VoiceMail("SIP/odbc_test_user-10228cac", "1000@default") in new 
       stack
    -- Playing 'vm-intro' (language 'en')
    -- Playing 'beep' (language 'en')
    -- Recording the message
    -- x=0, open writing:  /var/spool/asterisk/voicemail/default/1000/tmp/dlZunm
       format: wav49, 0x101f6534
    -- User ended message by pressing #
    -- Playing 'auth-thankyou' (language 'en')
  == Parsing '/var/spool/asterisk/voicemail/default/1000/INBOX/msg0000.txt': Found</pre><p><a id="Database_id277445"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id277448"></a>At this point you can check the
          database to verify that your data was successfully written. See the
          upcoming sections for more information.</p></div><p>Now that you’ve confirmed everything was stored in the database
      correctly, you can try listening to it via the <code class="literal">VoiceMailMain()</code> application by dialing
      extension <code class="literal">200</code>:</p><p><a id="Database_id277475"></a><a id="I_programlisting12_tt1609"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code>
    -- Executing VoiceMailMain("SIP/odbc_test_user-10228cac", 
       "1000@default") in new stack
    -- Playing 'vm-password' (language 'en')
    -- Playing 'vm-youhave' (language 'en')
    -- Playing 'digits/1' (language 'en')
    -- Playing 'vm-INBOX' (language 'en')
    -- Playing 'vm-message' (language 'en')
    -- Playing 'vm-onefor' (language 'en')
    -- Playing 'vm-INBOX' (language 'en')
    -- Playing 'vm-messages' (language 'en')
    -- Playing 'vm-opts' (language 'en')
    -- Playing 'vm-first' (language 'en')
    -- Playing 'vm-message' (language 'en')
  == Parsing '/var/spool/asterisk/voicemail/default/1000/INBOX/msg0000.txt': Found</pre><div class="sect3" title="Verifying binary data stored in PostgreSQL"><div class="titlepage"><div><div><h4 class="title"><a id="Database_id277496"></a>Verifying binary data stored in
        PostgreSQL</h4></div></div></div><p><a id="Database_id277504"></a><a id="I_indexterm16_d1e37955" class="indexterm"></a><a id="I_indexterm16_d1e37962" class="indexterm"></a><a id="I_indexterm16_d1e37967" class="indexterm"></a><a id="I_indexterm16_d1e37972" class="indexterm"></a>To make sure the recording really did make it into the
        database, use the <code class="filename">psql</code>
        application:</p><p><a id="Database_id277513"></a><a id="I_programlisting12_tt1601"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>psql -h localhost -U asterisk asterisk</code></strong>
<code class="computeroutput">Password:</code></pre><p>then run a <code class="literal">SELECT</code> statement
        to verify that you have some data in the <code class="literal">voicemessages</code> table:</p><p><a id="Database_id277540"></a><a id="I_programlisting12_tt1602"></a></p><pre class="screen"><code class="prompt">localhost=#</code> <strong class="userinput"><code>SELECT uniqueid,dir,callerid,mailboxcontext,recording FROM voicemessages;</code></strong>
uniqueid | dir                                              | callerid     
---------+--------------------------------------------------+--------------
1        | /var/spool/asterisk/voicemail/default/1000/INBOX | +18005551212 


| mailboxcontext | recording |
+----------------+-----------+
| default        | 47395     |
(1 row)</pre><p>If the recording was placed in the database, you should get a
        row back. You’ll notice that the <code class="literal">recording</code> column contains a number (which
        will most certainly be different from that listed here), which is
        really the object ID of the large object stored in a system table. You
        can verify that the large object exists in this system table with the
        <code class="literal">lo_list</code> <span class="keep-together">command</span>:</p><p><a id="Database_id277574"></a><a id="I_programlisting12_tt1604"></a></p><pre class="screen"><code class="prompt">localhost=#</code><strong class="userinput"><code> \lo_list</code></strong>
    Large objects
  ID   | Description
-------+-------------
 47395 |
(1 row)</pre><p>What you’re verifying is that the object ID in the <code class="literal">voicemessages</code> table matches that listed in
        the large object system table. You can also pull the data out of the
        database and store it to the hard drive:</p><p><a id="Database_id277599"></a><a id="I_programlisting12_tt1605"></a></p><pre class="screen"><code class="prompt">localhost=#</code> <strong class="userinput"><code>\lo_export 47395 /tmp/voicemail-47395.wav</code></strong>
lo_export</pre><p><a id="Database_id277614"></a>Then verify the audio with your favorite
        audio application, such as <span class="command"><strong>play</strong></span>:</p><p><a id="Database_id277623"></a><a id="I_programlisting12_tt1606"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>play /tmp/voicemail-47395.wav</code></strong>

Input Filename : /tmp/voicemail-47395.wav
Sample Size    : 8-bits
Sample Encoding: wav
Channels       : 1
Sample Rate    : 8000

Time: 00:06.22 [00:00.00] of 00:00.00 (  0.0%) Output Buffer: 298.36K

Done.</pre></div><div class="sect3" title="Verifying binary data stored in MySQL"><div class="titlepage"><div><div><h4 class="title"><a id="Database_id277640"></a>Verifying binary data stored in
        MySQL</h4></div></div></div><p><a id="Database_id277648"></a><a id="I_indexterm16_d1e38054" class="indexterm"></a><a id="I_indexterm16_d1e38061" class="indexterm"></a><a id="I_indexterm16_d1e38066" class="indexterm"></a><a id="I_indexterm16_d1e38071" class="indexterm"></a>To verify that your data is being written correctly, you
        can use the <code class="filename">mysql</code> application to
        log into your database and export the voicemail recording to a
        file:</p><p><a id="Database_id277653"></a><a id="Database_id277654"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>mysql -u asterisk -p asterisk</code></strong>
Enter password:</pre><p>Once logged into the database, you can use a <code class="literal">SELECT</code> statement to dump the contents of the
        recording to a file. First, though, make sure you have at least a
        single recording in your <code class="literal">voicemessages</code> table:</p><p><a id="Database_id277670"></a><a id="Database_id277671"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>SELECT uniqueid, msgnum, callerid, mailboxuser, mailboxcontext, `read`</code></strong>
<code class="prompt">    -&gt;</code> <strong class="userinput"><code>FROM voicemessages;</code></strong>
+----------+--------+------------------------------+-------------
| uniqueid | msgnum | callerid                     | mailboxuser 
+----------+--------+------------------------------+-------------
|        1 |      0 | "Leif Madsen" &lt;100&gt;          | 100         
|        2 |      1 | "Leif Madsen" &lt;100&gt;          | 100         
|        3 |      2 | "Leif Madsen" &lt;100&gt;          | 100         
|        5 |      0 | "Julie Bryant" &lt;12565551111&gt; | 100         
+----------+--------+------------------------------+-------------
+----------------+------+
| mailboxcontext | read |
+----------------+------+
| shifteight.org |    0 |
| shifteight.org |    0 |
| shifteight.org |    0 |
| default        |    0 |
+----------------+------+</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Database_id277697"></a>You can also add the <code class="literal">recording</code> column to the <code class="literal">SELECT</code> statement, but you’ll end up with a
          lot of gibberish on your screen.</p></div><p><a id="Database_id277709"></a>Having verified that you have data in
        your <code class="literal">voicemessages</code> table, you can
        export one of the recordings and play it back from the console.</p><p><a id="Database_id277741"></a><a id="Database_id277742"></a></p><pre class="screen"><code class="prompt">mysql&gt;</code> <strong class="userinput"><code>SELECT recording FROM voicemessages WHERE uniqueid = '5'</code></strong>
<code class="prompt">    -&gt;</code> <strong class="userinput"><code>DUMPFILE '/tmp/voicemail_recording.wav';</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Database_id277715"></a>The user you’re exporting data with
            needs to have the <code class="literal">FILE</code>
            permission in MySQL, which means it must have been granted
            <code class="literal">ALL</code> access. If you did not
            grant <code class="literal">ALL</code> privileges to the
            <span class="emphasis"><em>asterisk</em></span> user, you will need to utilize the
            <span class="emphasis"><em>root</em></span> user for file export.</p></div><p>Now exit the MySQL console, and use the
        <span class="emphasis"><em>play</em></span> application from the console (assuming you
        have speakers and a sound card configured on your Asterisk system,
        which you might if you are going to use it for overhead paging), or
        copy the file to another system and listen to it there:<a id="I_indexterm16_d1e38160" class="indexterm"></a><a id="I_indexterm16_d1e38161" class="indexterm"></a><a id="I_indexterm16_d1e38162" class="indexterm"></a><a id="I_indexterm16_d1e38163" class="indexterm"></a><a id="I_indexterm16_d1e38164" class="indexterm"></a><a id="I_indexterm16_d1e38165" class="indexterm"></a><a id="I_indexterm16_d1e38167" class="indexterm"></a></p><p><a id="Database_id277755"></a><a id="Database_id277756"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>play /tmp/voicemail_recording.wav</code></strong> 

voicemail_recording.wav:

 File Size: 7.28k     Bit Rate: 13.1k
  Encoding: GSM           
  Channels: 1 @ 16-bit   
Samplerate: 8000Hz       
Replaygain: off         
  Duration: 00:00:04.44  

In:100%  00:00:04.44 [00:00:00.00] Out:35.5k [      |      ] Hd:4.4 Clip:0    
Done.</pre></div></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="I_section12_tt1610"></a>Conclusion</h2></div></div></div><p><a id="Database_id277774"></a>In this chapter, we learned about several
    areas where Asterisk can integrate with a relational database. This is
    useful for systems where you need to start scaling by clustering multiple
    Asterisk boxes working with the same centralized information, or when you
    want to start building external applications to modify information without
    requiring a reload of the system (i.e., not requiring the modification of
    flat files).<a id="I_indexterm16_d1e38182" class="indexterm"></a><a id="I_indexterm16_d1e38183" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id602908" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id602908" class="para">139</a>] </sup>On a large, busy system you will want to install the database on
        a completely separate box from your Asterisk system.</p></div><div class="footnote"><p><sup>[<a id="ftn.id604093" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id604093" class="para">140</a>] </sup>If you installed on Ubuntu,<a id="I_indexterm16_d1e34341" class="indexterm"></a> you will have already set the <code class="literal">root</code> password. You will have to enter that
          password while executing the script, at which point it will say
          you’ve already set a <code class="literal">root</code>
          password, so you don’t need to change it.</p></div><div class="footnote"><p><sup>[<a id="ftn.id522490" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id522490" class="para">141</a>] </sup>Yes, this is excessively verbose. The only entries you really
          need are <code class="literal">Driver</code>, <code class="literal">Database</code>, and <code class="literal">Servername</code>. Even the <code class="literal">UserName</code> and <code class="literal">Password</code> are specified elsewhere, as
          you’ll see later (although these are required when testing, as in
          <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc" title="Validating the ODBC Connector">the section called “Validating the ODBC Connector”</a>).</p></div><div class="footnote"><p><sup>[<a id="ftn.id605362" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605362" class="para">142</a>] </sup>This was actually an issue one of the authors had while
          working on this book, and the <code class="literal">flag</code> column was found by looking at the
          statement logging during PostgreSQL testing.</p></div><div class="footnote"><p><sup>[<a id="ftn.id605435" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605435" class="para">143</a>] </sup>This system is unfortunately no longer in service. Thus, any
        changes have been made for the sake of simplicity, not to conceal the
        business for which it was designed.</p></div><div class="footnote"><p><sup>[<a id="ftn.id605488" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605488" class="para">144</a>] </sup>We’re using the <code class="literal">IF()</code> SQL
        function to make sure we return a value of <code class="literal">0</code> or <code class="literal">1</code>.
        This works on MySQL 5.1 or later. If it does not work on your SQL
        installation, you could also check the returned result in the dialplan
        using the <code class="literal">IF()</code> function
        there.</p></div><div class="footnote"><p><sup>[<a id="ftn.id605664" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605664" class="para">145</a>] </sup><span class="emphasis"><em>pgcluster</em></span> appears to be a dead project,
            and Postgres-R appears to be in its infancy, so there may
            currently be no good solution for master-master replication using
            PostgreSQL.</p></div><div class="footnote"><p><sup>[<a id="ftn.id605674" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605674" class="para">146</a>] </sup>There are several tutorials on the Web describing how to set
            up replication with MySQL.</p></div><div class="footnote"><p><sup>[<a id="ftn.id605695" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id605695" class="para">147</a>] </sup>And if you don’t know what a Dagwood is, that’s what Wikipedia
        is for. I am not that old.</p></div><div class="footnote"><p><sup>[<a id="ftn.id607463" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id607463" class="para">148</a>] </sup>Also see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#multirow_functionality_func_odbc" title="Multirow Functionality with func_odbc">Multirow Functionality with func_odbc</a> for
        more information and examples of parsing multiple rows returned from
        the database.</p></div><div class="footnote"><p><sup>[<a id="ftn.id608622" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id608622" class="para">149</a>] </sup>The <code class="filename">musiconhold.conf</code> file
          can also be loaded via dynamic realtime, but we’re using it
          statically as it’s a simple file that makes a good example.</p></div></div></div><div class="chapter" title="Chapter 17. Interactive Voice Response"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-IVR"></a>Chapter&nbsp;17.&nbsp;Interactive Voice Response</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR-SECT-1">What Is IVR?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289181">IVR Design Considerations</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289193">Do</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289222">Don’t</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246875">Asterisk Modules for Building IVRs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246881">CURL</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246897">func_odbc</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246909">AGI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246930">AMI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246940">A Simple IVR Using CURL</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247025">The Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247054">A Prompt-Recording Application</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247100">Speech Recognition and Text-to-Speech</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247129">Text-to-Speech</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247154">Speech Recognition</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247197">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="IVR_id268447"></a>One day Alice came to a fork in the road and saw a
    Cheshire cat in a tree. “Which road do I take?” <span class="keep-together">she asked</span>.</p><p><a id="IVR_id282564"></a>“Where do you want to go?” was his
    response.</p><p><a id="IVR_id268133"></a>“I don’t know,” Alice answered.</p><p><a id="IVR_id290022"></a>“Then,” said the cat, “it doesn’t matter.”</p><div class="attribution"><span>—<span class="attribution">Lewis Carroll</span></span></div></div><p><a id="IVR_id291190"></a><a id="index-217M070DG3V" class="indexterm"></a><a id="index-147C774OV2M" class="indexterm"></a>In this chapter we will talk about IVR. If what you want is an
  automated attendant, we have written a chapter for that as well (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a>). The term IVR is often misused to refer to an
  automated attendant, but the two are very different things.<sup>[<a id="id612932" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id612932" class="footnote">150</a>]</sup></p><div class="sect1" title="What Is IVR?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-IVR-SECT-1"></a>What Is IVR?</h2></div></div></div><p><a id="IVR_id266970"></a><a id="I_indexterm17_d1e38220" class="indexterm"></a>The purpose of an Interactive Voice Response (IVR) system is
    to take input from a caller, perform an action based on that input
    (commonly, looking up data in an external system such as a database), and
    return a result to the caller.<sup>[<a id="id612966" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id612966" class="footnote">151</a>]</sup> Traditionally, IVR systems have been complex, expensive, and
    annoying to implement. Asterisk changes all that.</p><div class="caution" title="Caution" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Caution</h3><p><a id="IVR_id266113"></a>Asterisk blurs the lines between traditional
      PBXs <a id="I_indexterm17_d1e38233" class="indexterm"></a>and IVR systems. The power and flexibility of the Asterisk
      dialplan results in a system where nearly every extension could be
      considered an IVR in the traditional sense of the term.</p></div></div><div class="sect1" title="Components of an IVR"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id290151"></a>Components of an IVR</h2></div></div></div><p><a id="IVR_id258972"></a><a id="I_indexterm17_d1e38241" class="indexterm"></a>The most basic elements of an IVR are quite similar to those
    of an automated attendant, though the goal is different. We need at least
    one prompt to tell the caller what the IVR expects from him, a method of
    receiving input from the caller, logic to verify that the caller’s
    response is valid input, logic to determine what the next step of the IVR
    should be, and finally, a storage mechanism for the responses, if
    applicable. We might think of an IVR as a decision tree, although it need
    not have any branches. For example, a survey may present exactly the same
    set of prompts to each caller, regardless of what choices the callers
    make, and the only routing logic involved is whether the responses given
    are valid for the questions.</p><p><a id="IVR_id249135"></a>From the caller’s perspective, every IVR needs to
    start with a prompt. This initial prompt will tell the caller what the IVR
    is for and ask the caller to provide the first input. We discussed prompts
    in the automated attendant in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a>. Later, we’ll
    create a dialplan that will allow you to better manage multiple voice
    prompts.</p><p><a id="IVR_id259649"></a>The second component of an IVR is a method for
    receiving input from the caller. Recall that in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a> we discussed the <code class="literal">Background()</code>
    and <code class="literal">WaitExten()</code> applications for receiving a new
    extension. While you could create an IVR using
    <code class="literal">Background()</code> and <code class="literal">WaitExten()</code>, it is
    generally easier and more practical to use the <code class="literal">Read()</code>
    application, which handles both the prompt and the capture of the
    response. The <code class="literal">Read()</code> application <a id="I_indexterm17_d1e38274" class="indexterm"></a><a id="I_indexterm17_d1e38277" class="indexterm"></a>was designed specifically for use with IVR systems. Its
    syntax is as follows:</p><a id="I_programlisting17_d1e38283"></a><pre class="programlisting">Read(<em class="replaceable"><code>variable</code></em>[,<em class="replaceable"><code>filename</code></em>[&amp;<em class="replaceable"><code>filename2</code></em>...]][,<em class="replaceable"><code>maxdigits</code></em>][,<em class="replaceable"><code>option</code></em>][,<em class="replaceable"><code>attempts</code></em>][,<em class="replaceable"><code>timeout</code></em>])</pre><p>The arguments are described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id245719" title="Table 17.1. The Read() application">Table&nbsp;17.1, “The Read() application”</a>.</p><div class="table"><a id="IVR_id245719"></a><p class="title"><strong>Table&nbsp;17.1.&nbsp;The Read() application</strong></p><div class="table-contents"><table summary="The Read() application" border="1"><colgroup><col><col class="_2"><col class="_3"></colgroup><thead><tr><th align="center">Argument</th><th colspan="2" align="center">Purpose</th></tr></thead><tbody><tr><td>
              <code class="literal">variable</code>
            </td><td colspan="2"><a id="I_indexterm17_d1e38329" class="indexterm"></a>The variable into which the caller’s response is
            stored. It is best practice to give each variable in your IVR a
            name that is similar to the prompt associated with that variable.
            This will help later if, for business reasons or ease of use, you
            need to reorder the steps of the IVR. Naming your variables
            <code class="literal">var1</code>, <code class="literal">var2</code>, etc. may seem
            easy in the short term, but later in your life cycle it will make
            fixing bugs more difficult.</td></tr><tr><td>
              <code class="literal">prompt</code>
            </td><td colspan="2"><a id="I_indexterm17_d1e38344" class="indexterm"></a>A file (or list of files, joined together with the
            <code class="literal">&amp;</code> character) to play for the caller,
            requesting input. Remember to omit the format extension on the end
            of each filename.</td></tr><tr><td>
              <code class="literal">maxdigits</code>
            </td><td colspan="2"><a id="I_indexterm17_d1e38356" class="indexterm"></a>The maximum number of characters to allow as input.
            In the case of yes/no and multiple choice questions, it’s best
            practice to limit this value to <code class="literal">1</code>. In the case
            of larger lengths, the caller may always terminate input by
            pressing the pound key.</td></tr><tr><td rowspan="3">
              <code class="literal">options</code>
            </td><td><code class="literal"><a id="I_indexterm17_d1e38369" class="indexterm"></a>s</code> (skip)</td><td>Exit immediately if the channel has not been <span class="keep-together">answered</span>.</td></tr><tr><td><code class="literal">i</code> (indication)</td><td>Rather than playing a prompt, play an indication tone of
            some sort (such as the dialtone).</td></tr><tr><td><code class="literal">n</code> (noanswer)</td><td>Read digits from the caller, even if the line is not yet
            answered.</td></tr><tr><td>
              <code class="literal">attempts</code>
            </td><td colspan="2"><a id="I_indexterm17_d1e38398" class="indexterm"></a>The number of times to play the prompt. If the
            caller fails to enter anything, the <code class="function">Read()</code>
            application can automatically re-prompt the user. The default is
            one attempt.</td></tr><tr><td>
              <code class="literal">timeout</code>
            </td><td colspan="2"><a id="I_indexterm17_d1e38410" class="indexterm"></a>The number of seconds the caller has to enter his
            input. The default value in Asterisk is 10 seconds, although it
            can be altered for a single prompt using this option, or for the
            entire session by assigning a value using the dialplan function
            <code class="function">TIMEOUT(response)</code>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="IVR_id265020"></a>Once the input is received, it must be validated.
    If you do not validate the input, you are most likely going to find your
    callers complaining of an unstable application. It is not enough to handle
    the inputs you are expecting; you also need to handle inputs you do not
    expect. For example, callers may get frustrated and dial
    <code class="literal">0</code> when in your IVR; if you’ve done a good job, you will
    handle this gracefully and connect them to somebody who can help them, or
    provide a useful alternative. A well-designed IVR (just like any program)
    will try to anticipate every possible input and provide mechanisms to
    gracefully handle that input.</p><p><a id="IVR_id265029"></a>Once the input is validated, you can submit it to
    an external resource for processing. This could be done via a database
    query, a submission to a URI, an AGI program, or many other things. This
    external application should produce a result, which you will want to relay
    back to the caller. This could be a detailed result, such as “Your account
    balance is…,” or a simple confirmation, such as “Your account has been
    updated.” We can’t think of any case where some sort of result returned to
    the caller is not required.</p><p><a id="IVR_id265042"></a>Sometimes the IVR may have multiple steps, and
    therefore a result might include a request for more information from the
    caller in order to move to the next step of the IVR application.</p><p><a id="IVR_id265046"></a>It is possible to design very complex IVR systems,
    with dozens or even hundreds of possible paths. We’ve said it before and
    we’ll say it again: people don’t like talking to your phone system,
    regardless of how clever it is. Keep your IVR simple for your callers, and
    they are much more likely to get some benefit from it.</p><div class="sidebar" title="A Perfectly Tasty IVR"><a id="IVR_id265055"></a><div class="titlepage"><div><div><p class="title"><strong>A Perfectly Tasty IVR</strong></p></div></div></div><p><a id="IVR_id265060"></a>An excellent example of an IVR that people love
      to use is one that many pizza delivery outfits use: when you call to
      place your order, an IVR looks up your caller ID and says “If you would
      like the exact same order as last time, press 1.”</p><p><a id="IVR_id265069"></a>That’s all it does, and it’s perfect.</p><p><a id="IVR_id265072"></a>Obviously, these companies could design
      massively complex IVRs that would allow you to select each and every
      detail of your pie (“for seven-grain crust, press 7”), but how many
      drunken frat boys are going to successfully navigate that?</p><p><a id="IVR_id265078"></a>The best IVRs are the ones that require the
      least input from the caller. Mash that <code class="literal">1</code> button and
      your ’za is on its way! Woo hoo!</p></div></div><div class="sect1" title="IVR Design Considerations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id289181"></a>IVR Design Considerations</h2></div></div></div><p><a id="IVR_id289186"></a><a id="I_indexterm17_d1e38447" class="indexterm"></a>When designing your own IVR, there are some important things
    to keep in mind. We’ve put together this list of some things to do, and
    things not to do in your IVR.</p><div class="sect2" title="Do"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id289193"></a>Do</h3></div></div></div><div class="itemizedlist"><a id="IVR_id289198"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="IVR_id289200"></a><a id="IVR_id289202"></a>Keep it simple.</p></li><li class="listitem"><p><a id="IVR_id289207"></a><a id="IVR_id289209"></a>Have an option to dial <code class="literal">0</code>
          to reach a live person.</p></li><li class="listitem"><p><a id="IVR_id289213"></a><a id="IVR_id289215"></a>Handle errors gracefully.</p></li></ul></div></div><div class="sect2" title="Don’t"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id289222"></a>Don’t</h3></div></div></div><div class="itemizedlist"><a id="IVR_id289227"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="IVR_id289230"></a><a id="IVR_id289232"></a>Think that an IVR can completely replace
          people.</p></li><li class="listitem"><p><a id="IVR_id289236"></a><a id="IVR_id289238"></a>Use your IVR to show people how clever you
          are.</p></li><li class="listitem"><p><a id="IVR_id289242"></a><a id="IVR_id289244"></a>Try to replicate your website with an
          IVR.</p></li><li class="listitem"><p><a id="IVR_id289249"></a><a id="IVR_id289251"></a>Bother building an IVR if you can’t take
          numeric input. Nobody wants to have to spell her name on the dialpad
          of her phone.<sup>[<a id="id613770" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id613770" class="footnote">152</a>]</sup></p></li><li class="listitem"><p><a id="IVR_id246857"></a><a id="IVR_id246859"></a>Force your callers to listen to advertising.
          Remember that they can hang up at any moment they wish.</p></li></ul></div></div></div><div class="sect1" title="Asterisk Modules for Building IVRs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id246875"></a>Asterisk Modules for Building IVRs</h2></div></div></div><p><a id="IVR_id302869"></a><a id="I_indexterm17_d1e38495" class="indexterm"></a>The “front end” of the IVR (the parts that interact with the
    callers) can be handled in the dialplan. In theory, it might be possible
    to build an IVR system using the dialplan alone (perhaps with the
    <code class="filename">astdb</code> to store and retrieve data). In practice, your
    IVR is going to need to communicate with something external to
    Asterisk.</p><div class="sect2" title="CURL"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id246881"></a>CURL</h3></div></div></div><p><a id="IVR_id246886"></a><a id="I_indexterm17_d1e38508" class="indexterm"></a><a id="I_indexterm17_d1e38511" class="indexterm"></a>The <code class="literal">CURL()</code> dialplan function in
      Asterisk allows you to span entire web applications with a single line
      of dialplan code. We’ll use it in our sample IVR later in this
      chapter.</p><p><a id="IVR_id246891"></a>While you’ll find <code class="literal">CURL()</code>
      itself to be quite simple to use, the creation of the web application
      will require experience with web development.</p></div><div class="sect2" title="func_odbc"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id246897"></a>func_odbc</h3></div></div></div><p><a id="IVR_id246902"></a><a id="I_indexterm17_d1e38529" class="indexterm"></a>Using <code class="literal">func_odbc</code>, it is possible to
      develop extremely complex applications in Asterisk using nothing more
      than dialplan code and database lookups. If you are not a strong
      programmer but are very adept with Asterisk dialplans and databases,
      you’ll love <code class="literal">func_odbc</code> just as much as we do. Check it
      out in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>.</p></div><div class="sect2" title="AGI"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id246909"></a>AGI</h3></div></div></div><p><a id="IVR_id246914"></a>The Asterisk Gateway Interface is such an
      important part of integrating external applications with Asterisk that
      we gave it its own chapter. You can find more information in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI" title="Chapter 21. Asterisk Gateway Interface (AGI)">Chapter&nbsp;21, <em>Asterisk Gateway Interface (AGI)</em></a>.</p></div><div class="sect2" title="AMI"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id246930"></a>AMI</h3></div></div></div><p><a id="IVR_id246935"></a><a id="I_indexterm17_d1e38552" class="indexterm"></a>The Asterisk Manager Interface is a socket interface that
      you can use to get configuration and status information, request actions
      to be performed, and get notified about things happening to calls. We’ve
      written an entire chapter on AMI, as well. You can find more information
      in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>.</p></div></div><div class="sect1" title="A Simple IVR Using CURL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id246940"></a>A Simple IVR Using CURL</h2></div></div></div><p><a id="IVR_id246945"></a><a id="I_indexterm17_d1e38564" class="indexterm"></a>The GNU/Linux program <span class="application">cURL</span> is
    useful for retrieving data from a URI. In Asterisk,
    <code class="literal">CURL()</code> is a dialplan function.</p><p><a id="IVR_id246955"></a>We’re going to use <code class="literal">CURL()</code> as an
    example of what an extremely simple IVR can look like. We’re going to
    request our external IP address from the website <a class="ulink" href="http://www.whatismyip.org/" target="_top">http://www.whatismyip.org</a>.</p><div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="IVR_id246963"></a>Important</h3><p><a id="IVR_id246965"></a>In reality, most IVR applications are going to
      be far more complex. Even most uses of <code class="literal">CURL()</code> will
      tend to be complex, since a URI can return a massive and highly variable
      amount of data, the vast majority of which will be incomprehensible to
      Asterisk. The point being that an IVR is not just about the dialplan; it
      is also very much about the external applications that are triggered by
      the dialplan, which are doing the real work of the IVR.</p></div><p><a id="IVR_id246977"></a>Before you can use <code class="literal">CURL()</code>, you
    have to ensure it is installed.</p><div class="sect2" title="Installing the cURL Module"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id246984"></a>Installing the cURL Module</h3></div></div></div><p><a id="IVR_id246990"></a><a id="I_indexterm17_d1e38598" class="indexterm"></a><a id="I_indexterm17_d1e38603" class="indexterm"></a>Installing cURL is easy. If it was not on your system when
      you last compiled Asterisk, after installing it you’ll need to recompile
      Asterisk so that it can locate the cURL dependencies and compile the
      <code class="filename">func_curl.so</code> module.</p><p>On CentOS:<a id="I_indexterm17_d1e38612" class="indexterm"></a></p><a id="IVR_id247000"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum -y install libcurl-devel</code></strong></pre><p>On Ubuntu:<a id="I_indexterm17_d1e38626" class="indexterm"></a></p><a id="IVR_id247015"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install libcurl4-openssl-dev</code></strong></pre></div><div class="sect2" title="The Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id247025"></a>The Dialplan</h3></div></div></div><p><a id="IVR_id247031"></a><a id="I_indexterm17_d1e38641" class="indexterm"></a><a id="I_indexterm17_d1e38646" class="indexterm"></a><a id="I_indexterm17_d1e38649" class="indexterm"></a>The dialplan for our example IVR is very simple. The
      <code class="literal">CURL()</code> function will retrieve our IP address from
      <a class="ulink" href="http://www.whatismyip.org/" target="_top">http://www.whatismyip.org</a>, and then
      <code class="literal">SayAlpha()</code> will speak the results to the
      caller:</p><p><a id="IVR_id247041"></a><a id="IVR_id247042"></a></p><pre class="programlisting">exten =&gt; *764,1,Verbose(2, Run CURL to get IP address from whatismyip.org)
    same =&gt; n,Answer()
    same =&gt; n,Set(MyIPAddressIs=${CURL(http://www.whatismyip.org/)})
    same =&gt; n,SayAlpha(${MyIPAddressIs})
    same =&gt; n,Hangup()
</pre><p>The simplicity of this is impossibly cool. In a traditional
      IVR system, this sort of thing could take days to program.</p></div></div><div class="sect1" title="A Prompt-Recording Application"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id247054"></a>A Prompt-Recording Application</h2></div></div></div><p><a id="IVR_id247059"></a><a id="I_indexterm17_d1e38671" class="indexterm"></a><a id="I_indexterm17_d1e38676" class="indexterm"></a><a id="I_indexterm17_d1e38681" class="indexterm"></a>In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA" title="Chapter 15. The Automated Attendant">Chapter&nbsp;15, <em>The Automated Attendant</em></a> we created a simple bit of
    dialplan to record prompts. It was fairly limited in that it only recorded
    one filename, and thus for each prompt the file needed to be copied before
    a new prompt could be recorded. Here, we expand upon that to create a
    complete menu for recording prompts:</p><p><a id="IVR_id247066"></a>
      <a id="IVR_id247067"></a></p><pre class="programlisting">[prompts]
exten =&gt; s,1,Answer
exten =&gt; s,n,Set(step1count=0) ; Initialize counters

; If we get no response after 3 times, we stop asking
   same =&gt; n(beginning),GotoIf($[${step1count} &gt; 2]?end)
   same =&gt; n,Read(which,prompt-instructions,3)
   same =&gt; n,Set(step1count=$[${step1count} + 1])

; All prompts must be 3 digits in length
   same =&gt; n,GotoIf($[${LEN(${which})} &lt; 3]?beginning) 
   same =&gt; n,Set(step1count=0) ; We have a successful response, so reset our counters
   same =&gt; n,Set(step2count=0)

   same =&gt; n(step2),Set(step2count=$[${step2count} + 1])
   same =&gt; n,GotoIf($[${step2count} &gt; 2]?beginning) ; No response after 3 tries

; If the file doesn't exist, then don't ask whether to play it
   same =&gt; n,GotoIf($[${STAT(f,${which}.wav)} = 0]?recordonly) 
   same =&gt; n,Background(prompt-tolisten)

   same =&gt; n(recordonly),Background(prompt-torecord)
   same =&gt; n,WaitExten(10) ; Wait 10 seconds for a response
   same =&gt; n,Goto(step2)

exten =&gt; 1,1,Set(step2count=0)
   same =&gt; n,Background(${which})
   same =&gt; n,Goto(s,step2)

exten =&gt; 2,1,Set(step2count=0)
   same =&gt; n,Playback(prompt-waitforbeep)
   same =&gt; n,Record(${CHANNEL(uniqueid)}.wav)

   same =&gt; n(listen),Playback(${CHANNEL(uniqueid)})
   same =&gt; n,Set(step3count=0)
   same =&gt; n,Read(saveornot,prompt-1tolisten-2tosave-3todiscard,1)
   same =&gt; n,GotoIf($["${saveornot}" = "1"]?listen)
   same =&gt; n,GotoIf($["${saveornot}" = "2"]?saveit)
   same =&gt; n,System(rm -f /var/lib/asterisk/sounds/${CHANNEL(uniqueid)}.wav)
   same =&gt; n,Goto(s,beginning)

   same =&gt; n(saveit),System(mv -f ${CHANNEL(uniqueid)}.wav ${which}.wav)
   same =&gt; n,Playback(prompt-saved)
   same =&gt; n,Goto(s,beginning)</pre><p>
    </p><p><a id="IVR_id247094"></a>In this system, the name of the prompt is no
    longer descriptive, but rather it is a number. This means that you can
    record a far greater variety of prompts using the same mechanism, but the
    tradeoff is that your prompts will no longer have descriptive
    names.</p></div><div class="sect1" title="Speech Recognition and Text-to-Speech"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id247100"></a>Speech Recognition and Text-to-Speech</h2></div></div></div><p><a id="IVR_id247106"></a><a id="I_indexterm17_d1e38696" class="indexterm"></a><a id="I_indexterm17_d1e38701" class="indexterm"></a><a id="I_indexterm17_d1e38706" class="indexterm"></a>Although in most cases an IVR system presents prerecorded
    prompts to the caller and accepts input by way of the dialpad, it is also
    possible to: a) generate prompts artificially, popularly known as
    text-to-speech; and b) accept verbal inputs through a speech recognition
    engine.</p><p><a id="IVR_id247112"></a>While the concept of being able to have an
    intelligent conversation with a machine is something sci-fi authors have
    been promising us for many long years, the actual science of this remains
    complex and error-prone. Despite their amazing capabilities, computers are
    ill-suited to the task of appreciating the subtle nuances of human
    speech.</p><p><a id="IVR_id247118"></a>Having said that, it should be noted that over the
    last 50 years or so, amazing advances have been made in both
    text-to-speech and speech recognition. A well-designed system created for
    a very specific purpose can work very well indeed.</p><p><a id="IVR_id247124"></a>Despite what the marketing people will say, your
    computer still can’t talk to you, and you need to bear this in mind if you
    are contemplating any sort of system that combines your telephone system
    with these technologies.</p><div class="sect2" title="Text-to-Speech"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id247129"></a>Text-to-Speech</h3></div></div></div><p><a id="IVR_id247134"></a>Text-to-speech (also known as speech synthesis)
      requires that a system be able to artificially construct speech from
      stored data. While it would be nice if we could simply assign a sound to
      a letter and have the computer produce each sound as it reads the
      letters, the written English language is not totally phonetic.</p><p><a id="IVR_id247144"></a>While on the surface, the idea of a speaking
      computer is very attractive, the reality is that it has limited
      usefulness. More information about integration of text-to-speech with
      Asterisk can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices" title="Chapter 18. External Services">Chapter&nbsp;18, <em>External Services</em></a>.</p></div><div class="sect2" title="Speech Recognition"><div class="titlepage"><div><div><h3 class="title"><a id="IVR_id247154"></a>Speech Recognition</h3></div></div></div><p><a id="IVR_id247160"></a>As soon as we’ve convinced computers to talk to
      us, we will naturally want to be able to talk to them.<sup>[<a id="id614557" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id614557" class="footnote">153</a>]</sup> Anyone who has tried to learn a foreign language can begin
      to recognize the complexity of teaching a computer to understand words;
      however, speech recognition also has to take into account the fact that
      before a computer can even attempt the task of understanding the words,
      it must first convert the audio into a digital format. This challenge is
      larger than one might at first think. For example, as humans we are
      naturally able to recognize speech as distinct from, say, the sound of a
      barking dog or a car horn. For a computer, this is a very complicated
      thing. Additionally, for a telephone-based speech recognition system,
      the audio that is received is always going to be of very low fidelity,
      and thus the computer will have that much less information to work
      with.<sup>[<a id="id614569" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id614569" class="footnote">154</a>]</sup></p><p><a id="IVR_id247186"></a>Asterisk does not have speech recognition built
      in, but there are many third-party speech recognition packages that
      integrate with Asterisk.</p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="IVR_id247197"></a>Conclusion</h2></div></div></div><p><a id="IVR_id247203"></a>Asterisk has become extremely popular as an IVR
    platform. While the media only really pays attention to Asterisk as a
    “free PBX,” the reality is that Asterisk is quietly taking the IVR
    industry by storm. Within any respectable-sized organization, it is very
    likely that the Linux system administrators are using Asterisk to solve
    telecom problems that previously were either unsolvable or impossibly
    expensive to solve. This is a stealthy revolution, but no less significant
    for its relative obscurity.</p><p><a id="IVR_id247210"></a>If you are in the IVR business, you need to get to
    know Asterisk.<a id="I_indexterm17_d1e38750" class="indexterm"></a><a id="I_indexterm17_d1e38751" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id612932" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id612932" class="para">150</a>] </sup>We suspect this is because “IVR” is much easier to say than
      “automated attendant.”</p></div><div class="footnote"><p><sup>[<a id="ftn.id612966" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id612966" class="para">151</a>] </sup>In contrast to an auto attendant, the purpose of which is to
        route calls.</p></div><div class="footnote"><p><sup>[<a id="ftn.id613770" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id613770" class="para">152</a>] </sup>Especially if it’s something like Van Meggelen.</p></div><div class="footnote"><p><sup>[<a id="ftn.id614557" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id614557" class="para">153</a>] </sup>Actually, most of us talk to our computers, but this is seldom
          polite.</p></div><div class="footnote"><p><sup>[<a id="ftn.id614569" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id614569" class="para">154</a>] </sup>If the speech recognition has to happen from a cell phone in a
          noisy conference hall, it becomes near-impossible.</p></div></div></div><div class="chapter" title="Chapter 18. External Services"><div class="titlepage"><div><div><h2 class="title"><a id="ExternalServices"></a>Chapter&nbsp;18.&nbsp;External Services</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices-SECT-1">Calendar Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id266014">Compiling Calendaring Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id259378">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262604">Ubuntu dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254192">Triggering a wakeup call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration">VoiceMail IMAP Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246986">Compiling IMAP VoiceMail Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247003">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247032">Ubuntu dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247065">Compiling the IMAP library</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#compiling-asterisk-imap-support">Compiling Asterisk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286256">Configuring Asterisk</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286789">Using XMPP (Jabber) with Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286804">Compiling Jabber Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286815">CentOS dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286850">Ubuntu dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#accepting_calls_from_google_talk">Accepting calls from Google Talk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285352">Accepting calls from Google Voice</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285398">Outgoing calls via Google Talk</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291565">Skype Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057654">Installation of Skype for Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057688">Using Skype for Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#placing_and_receiving_calls_via_skype">Placing and receiving calls via Skype</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291590">LDAP Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189890">Compiling LDAP Support into Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36041022">Ubuntu dependencies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040950">CentOS dependencies</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189907">Configuring Asterisk for LDAP Support</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040839">Configuring res_ldap.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040635">Configuring extconfig.conf</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291618">Text-to-Speech Utilities</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055967">Installing Festival on CentOS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055989">Installing Festival on Ubuntu</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291644">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="ExternalServices_id249012"></a>Correct me if I’m wrong—the gizmo is
    connected to the flingflang connected to the watzis, watzis connected to
    the doo-dad connected to the ding dong.</p><div class="attribution"><span>—<span class="attribution">Patrick B. Oliphant</span></span></div></div><p><a id="ExternalServices_id270592"></a><a id="index-886Q268NM3N" class="indexterm"></a><a id="index-458J501RT3U" class="indexterm"></a>Asterisk is pretty nifty all by itself, but one of the most
  powerful, industry-changing, revolutionary aspects of Asterisk is the sheer
  number of wonderful ways it may be connected to external applications and
  services. This is truly unprecedented in the world of telecom. In this
  chapter we’ll explore some popular services and applications that you can
  integrate with your Asterisk system. Here are some of the external
  connections we’ve decided to cover (Asterisk has more, but our editor is
  waiting for us to finish this edition, which is already the largest Asterisk
  book yet):</p><div class="itemizedlist"><a id="ExternalServices_id270854"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ExternalServices_id284712"></a><a id="ExternalServices_id256766"></a>If you use LDAP in your network
      (such as with Active Directory), we’ll show you how to load your SIP
      users from your LDAP services.</p></li><li class="listitem"><p><a id="ExternalServices_id250987"></a><a id="ExternalServices_id244793"></a>For the person on the go with a
      dynamically changing calendar, we’ll sample some ideas on how you can
      integrate Asterisk with your calendaring server (allowing for automatic
      call redirection based on your current status).</p></li><li class="listitem"><p><a id="ExternalServices_id267889"></a><a id="ExternalServices_id284537"></a>If you’re a fan of instant
      messaging, there is a section on how to communicate with Asterisk via
      the XMPP (Jabber) protocol.</p></li><li class="listitem"><p><a id="ExternalServices_id259182"></a><a id="ExternalServices_id256770"></a>Skype fans? Asterisk has a channel
      for that. We’ll show you how to get it going.</p></li><li class="listitem"><p><a id="ExternalServices_id268222"></a><a id="ExternalServices_id282420"></a>If you want to tie your voicemail
      into your IMAP server, we’ll take you through the basics.</p></li><li class="listitem"><p><a id="ExternalServices_id289690"></a><a id="ExternalServices_id248096"></a>Want to teach your phone system to
      read? We’ll cover the basics of text-to-speech.</p></li></ul></div><p><a id="ExternalServices_id248204"></a>There are many more external services
  that Asterisk can connect to, but these are the ones we feel will give you
  the best sense of what it takes to integrate an external service with
  Asterisk.</p><div class="sect1" title="Calendar Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices-SECT-1"></a>Calendar Integration</h2></div></div></div><p><a id="ExternalServices_id266000"></a><a id="index-050P156WN3C" class="indexterm"></a><a id="index-816E578WS1A" class="indexterm"></a>Asterisk can be integrated with several different kinds of
    calendar formats, such as iCal, CalDAV, MS Exchange (Exchange 2003), and
    MS Exchange Web Services (Exchange 2007 and later). Integrating Asterisk
    with your calendar gives you the ability to manipulate call routing based
    on your current calendar information. For example, if you’re not going to
    be in your office for the afternoon it may make sense for people ringing
    your desk phone to be routed directly to your voicemail.</p><p><a id="ExternalServices_id266007"></a>Another advantage to calendar
    integration is the ability to originate calls based on calendar
    information. For example, if you set up a meeting on your conference
    server, you can arrange to have a reminder call five minutes before the
    meeting starts, which then places you into the conference room. We think
    this type of flexibility and integration is pretty nifty and quite
    useful.</p><div class="sect2" title="Compiling Calendaring Support into Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id266014"></a>Compiling Calendaring Support into Asterisk</h3></div></div></div><p><a id="ExternalServices_id266020"></a><a id="I_indexterm18_d1e38810" class="indexterm"></a><a id="I_indexterm18_d1e38817" class="indexterm"></a><a id="I_indexterm18_d1e38822" class="indexterm"></a>As there are several modules for calendaring support
      (allowing us to provide support for different backends, such as MS
      Exchange, CalDAV, iCal, etc.), you’ll need to install the dependencies
      for the backends you want to support. This modularized setup has the
      advantage that you only need to install dependencies for the modules you
      need; also other backends can easily be integrated with the primary
      calendaring backend in the future.</p><p><a id="ExternalServices_id266031"></a>Because of the different
      dependencies of each module, we need to check <span class="command"><strong>menuselect</strong></span> for what needs to be installed for
      each of the calendaring modules we wish to support. All modules require
      the <code class="literal">neon</code> development library,
      available from <a class="ulink" href="http://www.webdav.org/neon/" target="_top">http://www.webdav.org/neon/</a>.
      <code class="literal">res_calendar_ews</code> (Exchange Web
      Services) requires version 0.29 or later, which means some distributions
      will require you to compile the <code class="literal">neon</code>
      library from source instead of using the precompiled package available
      from the distribution.</p><p><a id="ExternalServices_id259366"></a>While the configuration for all the
      calendaring modules is similar, we’ll be discussing CalDAV integration
      specifically since it is widely supported by a range of calendar
      software and servers.<sup>[<a id="id615032" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id615032" class="footnote">155</a>]</sup></p><div class="sect3" title="CentOS dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id259378"></a>CentOS dependencies</h4></div></div></div><p><a id="ExternalServices_id245659"></a><a id="I_indexterm18_d1e38853" class="indexterm"></a>Since all the modules require the <code class="literal">neon</code> library, we’ll install that first. Be
        sure to append <span class="emphasis"><em>.x86_64</em></span> to the end of the package
        name if installing on a 64-bit machine:</p><p><a id="ExternalServices_id245666"></a><a id="ExternalServices_id245667"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install neon-devel</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id245674"></a>If you are planning on
            compiling the <code class="literal">res_calendar_ews</code>
            module,<a id="I_indexterm18_d1e38878" class="indexterm"></a><a id="I_indexterm18_d1e38881" class="indexterm"></a> you will need to have a version of <code class="literal">neon</code> greater than or equal to 0.29.
            Currently CentOS is shipping with 0.25, so you will have to
            compile the <code class="literal">neon</code> library and
            link to it from the <span class="command"><strong>configure</strong></span>
            script. This can be done via <span class="emphasis"><em>./configure
            --with-neon29=<em class="replaceable"><code>&lt;path to
            neon&gt;</code></em>.</em></span></p></div><p>The next step is to install the <code class="literal">libical-devel</code> dependency. Unfortunately,
        this module is not shipped with CentOS and requires a third-party
        repository (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#third-party-repos" title="Third-Party Repositories">Third-Party Repositories</a>). In this case,
        we need to install <code class="literal">libical-devel</code>
        from the EPEL (Extra Packages for Enterprise Linux) repository:</p><p><a id="ExternalServices_id245702"></a><a id="ExternalServices_id245703"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum --enablerepo=epel install libical-devel</code></strong></pre><p>After
        installing our dependencies, we can run the <span class="command"><strong>configure</strong></span> script in our Asterisk source
        directory and enable both the <code class="literal">res_calendar</code> and <code class="literal">res_calendar_caldav</code> modules from within the
        <span class="emphasis"><em>Resource Modules</em></span> section of <span class="command"><strong>menuselect</strong></span>.</p></div><div class="sect3" title="Ubuntu dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id262604"></a>Ubuntu dependencies</h4></div></div></div><p><a id="ExternalServices_id262609"></a><a id="I_indexterm18_d1e38938" class="indexterm"></a>Because all the modules require the <code class="literal">neon</code> development library, we’re going to
        install that first. On Ubuntu, you will typically be given several
        different versions (e.g., on 10.04 we have the option of
        <span class="emphasis"><em>libneon</em></span> 2.5, 2.6, and 2.7). We’re going to
        install the latest version available to us:</p><p><a id="ExternalServices_id262618"></a><a id="ExternalServices_id262619"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install libneon27-dev</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id262626"></a>If you are planning on
            compiling the <code class="literal">res_calendar_ews</code>
            module, you will need to have <code class="literal">neon</code> 0.29 or greater. Currently Ubuntu
            is shipping with 0.27, so you will have to compile the <code class="literal">neon</code> library and link to it from the
            <span class="command"><strong>configure</strong></span> script. This can be
            done via <span class="emphasis"><em>./configure --with-neon29=<em class="replaceable"><code>&lt;path
            to neon&gt;</code></em></em></span>.</p></div><p>With <span class="emphasis"><em>libneon</em></span> installed, we can now
        install the <code class="filename">libical-dev</code> package
        and its dependencies with <span class="command"><strong>apt-get</strong></span>:</p><p><a id="ExternalServices_id262417"></a><a id="ExternalServices_id262418"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install libical-dev</code></strong></pre><p>After
        installing our dependencies, we can run the <span class="command"><strong>configure</strong></span> script in our Asterisk source
        directory and enable both the <code class="literal">res_calendar</code> and <code class="literal">res_calendar_caldav</code> modules from within the
        <span class="emphasis"><em>Resource Modules</em></span> section of <span class="command"><strong>menuselect</strong></span>.</p></div></div><div class="sect2" title="Configuring Calendar Support for Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id262442"></a>Configuring Calendar Support for Asterisk</h3></div></div></div><p><a id="ExternalServices_id262447"></a><a id="index-334P300BU5U" class="indexterm"></a><a id="index-170G730UE3K" class="indexterm"></a><a id="index-634P164KO8I" class="indexterm"></a>In this section we’re going to discuss how to connect your
      Asterisk system to a Google calendar. We’re using calendars from Google
      for the simple reason that they don’t require any other configuration
      (such as setting up a calendaring server), which gets us up and running
      far quicker. Of course, once you’re comfortable with configuring
      calendaring support in Asterisk, you can connect it to any calendaring
      server you desire.</p><p><a id="ExternalServices_id262458"></a>The first step is to make sure you
      have a Gmail (<a class="ulink" href="http://www.gmail.com/" target="_top">http://www.gmail.com</a>) account with
      Google, which will get you access to a calendaring server. Once you’ve
      logged into your Gmail account, there should be a link to your calendar
      in the upper-left corner. Click on the <span class="emphasis"><em>Calendar</em></span>
      link and insert a couple of items for the next hour or two. When we
      configure our <code class="filename">calendar.conf</code> file
      we’ll be instructing Asterisk to check for new events every 15 minutes,
      and pulling in 60 minutes’ worth of data.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id264999"></a>Be sure to verify the time on
        your server. If the time is not in sync with the rest of the
        world—e.g., if is not updated via the Network Time Protocol (NTP)—your
        events may not show, or may show at the wrong times. This tip is the
        result of running into this very issue while testing and documenting.
        : )</p></div><p><a id="ExternalServices_id265012"></a>The next step is to configure our
      <code class="filename">calendar.conf</code> file for polling our
      calendar server.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id265020"></a>The <code class="filename">calendar.conf.sample</code> file has several
        examples for calendaring servers, such as those supplied by Microsoft
        Exchange–, iCal-, and CalDAV-based calendar servers.</p></div><p><a id="ExternalServices_id265030"></a>The following configuration will
      connect to the Google calendaring server and poll for new events every
      15 minutes, retrieving 60 minutes’ worth of data. Feel free to change
      these settings as necessary, but be aware that pulling more data
      (especially if you have multiple calendars for people in your company)
      will utilize more memory:</p><p><a id="ExternalServices_id265036"></a><a id="ExternalServices_id265037"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cat &gt;&gt; calendar.conf
[myGoogleCal]
type=caldav
url=https://www.google.com/calendar/dav/<em class="replaceable"><code>&lt;Gmail Email Address&gt;</code></em>/events/
user=<em class="replaceable"><code>&lt;Gmail Email Address&gt;</code></em>
secret=<em class="replaceable"><code>&lt;Gmail Password&gt;</code></em>
refresh=15
timeframe=60</code></strong>
<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p>With your <code class="filename">calendar.conf</code> file configured, let’s load the
      calendaring modules into <span class="keep-together">Asterisk</span>.
      First we’ll load the <code class="filename">res_calendar.so</code> module into memory, then
      we’ll follow it up by doing a <span class="command"><strong>module
      reload</strong></span>, which will load the sister modules (such as <code class="filename">res_calendar_caldav.so</code>) correctly.<sup>[<a id="id615695" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id615695" class="footnote">156</a>]</sup></p><p><a id="ExternalServices_id281578"></a><a id="ExternalServices_id281579"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>asterisk -r</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module load res_calendar.so</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload</code></strong></pre><p><a id="ExternalServices_id281591"></a>After loading the modules we can
      check to make sure our calendar has connected to the server and been
      loaded into memory correctly, by executing <span class="command"><strong>calendar show </strong></span><span class="keep-together"><span class="command"><strong>calendars</strong></span>:</span></p><p><a id="ExternalServices_id281600"></a><a id="ExternalServices_id281601"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>calendar show calendars</code></strong>
Calendar             Type       Status
--------             ----       ------
myGoogleCal          caldav     busy</pre><p>Our status is currently set to
      <code class="literal">busy</code> (which doesn’t have any bearing
      on our dialplan at the moment, but simply means we have an event that
      has marked us as busy in the calendar), and we can see the currently
      loaded events for our time range by running <span class="command"><strong>calendar show calendar
      &lt;myGoogleCal&gt;</strong></span><a id="I_indexterm18_d1e39143" class="indexterm"></a><a id="I_indexterm18_d1e39146" class="indexterm"></a> from the Asterisk console:</p><p><a id="ExternalServices_id281618"></a><a id="ExternalServices_id281619"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>calendar show calendar myGoogleCal</code></strong>
Name              : myGoogleCal         
Notify channel    :                     
Notify context    :                     
Notify extension  :                     
Notify applicatio :                     
Notify appdata    :                     
Refresh time      : 15
Timeframe         : 60
Autoreminder      : 0
Events
------
Summary     : Awesome Call With Russell               
Description :                                         
Organizer   :                                         
Location    :                                         
Cartegories :                                         
Priority    : 0
UID         : hlfhcpi0j360j8fteop49cvk68@google.com   
Start       : 2010-09-28 08:30:00 AM -0400            
End         : 2010-09-28 09:00:00 AM -0400            
Alarm       : 2010-09-28 04:20:00 AM -0400  </pre><p>The first field in the
      top section is the <span class="emphasis"><em>Name</em></span> of our calendar. Following
      that are several <span class="emphasis"><em>Notify</em></span> fields, which are used to
      dial a destination upon the start of a meeting, that we’ll discuss in
      more detail shortly. The <span class="emphasis"><em>Refresh time</em></span> and
      <span class="emphasis"><em>Timeframe</em></span> fields are the values we configured for
      how often to check for new events and how long of a range we should look
      at for data, respectively. The <span class="emphasis"><em>Autoreminder</em></span> field
      controls how long prior to an event we should execute the
      <span class="emphasis"><em>Notify</em></span> options.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id281664"></a>If you have not configured any of
        the <span class="emphasis"><em>Notify</em></span> options but have an alarm set to
        remind you in the calendar, you may get a <code class="literal">WARNING</code> message such as:</p><a id="I_programlisting18_d1e39190"></a><pre class="programlisting">WARNING[5196]: res_calendar.c:648 do_notify: Channel should be in 
form Tech/Dest (was '')</pre><p><a id="ExternalServices_id281674"></a>The reason for the warning is
        that an alarm was set for notification about the start of the meeting,
        but Asterisk was unable to generate a call due to values not being
        configured to place the call. This warning message can be safely
        ignored if you don’t plan on placing calls for event <span class="keep-together">notifications</span>.</p></div><p><a id="ExternalServices_id254167"></a>The rest of the screen output is a
      listing of events available within our <span class="emphasis"><em>Timeframe</em></span>,
      along with information about the events. The next steps are to look at
      some dialplan examples of what you can do now that you have your
      calendaring information in Asterisk, and to configure dialing
      notifications to remind you about upcoming meetings.<a id="I_indexterm18_d1e39202" class="indexterm"></a><a id="I_indexterm18_d1e39203" class="indexterm"></a><a id="I_indexterm18_d1e39204" class="indexterm"></a></p></div><div class="sect2" title="Triggering Calendar Reminders to Your Phone"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id254178"></a>Triggering Calendar Reminders to Your Phone</h3></div></div></div><p><a id="ExternalServices_id254183"></a><a id="index-887F348WK0B" class="indexterm"></a><a id="index-343D431JH3B" class="indexterm"></a><a id="index-437D235VP8P" class="indexterm"></a><a id="index-608V536CA7F" class="indexterm"></a>In this section we’ll discuss how to configure the
      <code class="filename">calendar.conf</code> file to execute some
      simple dialplan that will call your phone prior to a calendar event.
      While the dialplan we’ll provide might not be ready for production, it
      certainly gives you a good taste of the possibilities that exist for
      triggering calls based on calendar state.</p><div class="sect3" title="Triggering a wakeup call"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id254192"></a>Triggering a wakeup call</h4></div></div></div><p><a id="ExternalServices_id254197"></a><a id="I_indexterm18_d1e39235" class="indexterm"></a>In our first example, we’re going to call a device and
        play back a reminder notice for a particular calendar event. It might
        be useful to get this type of reminder if you’re likely to be napping
        at your desk when your weekly Monday meeting rolls around. To set up a
        wakeup call reminder, we simply need to add the following lines to our
        calendar configuration in <code class="filename">calendar.conf</code>:</p><p><a id="ExternalServices_id254215"></a><a id="ExternalServices_id254216"></a></p><pre class="programlisting">channel=SIP/0000FFFF0001
app=Playback
appdata=this-is-yr-wakeup-call</pre><p> </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id254210"></a>In your calendar, you need to
            make sure the event you’re adding has an alarm or reminder
            associated with it. Otherwise, Asterisk won’t try to generate a
            call.</p></div><p><a id="ExternalServices_id254220"></a>After making this change, reload
        the <code class="filename">res_calendar.so</code> module from
        the Asterisk console:</p><p><a id="ExternalServices_id254227"></a><a id="ExternalServices_id254228"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload res_calendar.so</code></strong></pre><p>When the event rolls around, Asterisk
        will generate a call to you and play back the sound file <code class="filename">this-is-yr-wakeup-call</code>. The output on the
        console would look like this:</p><p><a id="ExternalServices_id281822"></a><a id="ExternalServices_id281823"></a></p><pre class="screen">    -- Dialing SIP/0000FFFF0001 for notification on calendar myGoogleCal
  == Using SIP RTP CoS mark 5
    -- Called 0000FFFF0001
    -- SIP/0000FFFF0001-00000001 is ringing
    -- SIP/0000FFFF0001-00000001 connected line has changed, passing it to 
       Calendar/myGoogleCal-5fd3c52
    -- SIP/0000FFFF0001-00000001 answered Calendar/myGoogleCal-5fd3c52
    -- &lt;SIP/0000FFFF0001-00000001&gt; Playing 'this-is-yr-wakeup-call.ulaw' 
       (language 'en')</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id281834"></a>If you modify the calendar
            event so it’s just a couple of minutes in the future, you can
            trigger the events quickly by unloading and then loading the
            <code class="filename">res_calendar_caldav.so</code> module
            from the Asterisk console. By doing that, you’ll trigger Asterisk
            to generate the call immediately.</p></div><p>Remember that our refresh rate is set to 15 minutes and we’re
        gathering 60 minutes’ worth of events. You might have to adjust these
        numbers if you wish to test this out on your development
        server.</p></div><div class="sect3" title="Scheduling calls between two participants"><div class="titlepage"><div><div><h4 class="title"><a id="sched_calls_two_parts"></a>Scheduling calls between two participants</h4></div></div></div><p><a id="ExternalServices_id281857"></a><a id="index-842H311NG2R" class="indexterm"></a>In this example we’re going to show how you can use a
        combination of some simple dialplan and the <code class="literal">CALENDAR_EVENT()</code> dialplan function
        <a id="I_indexterm18_d1e39287" class="indexterm"></a><a id="I_indexterm18_d1e39290" class="indexterm"></a>to generate a call between two participants based on the
        information in the location field. We’re going to fill in the location
        field with <code class="literal">0000FFFF0002</code>, which is
        the SIP device we wish to call after answering our reminder.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id281871"></a>We haven’t specified <code class="literal">SIP/0000FFFF0002</code> directly in the calendar
          event because we want to be a bit more secure with what we accept.
          Because we’re going to filter out anything but alphanumeric
          characters, we won’t be able to accept a forward slash as the
          separator between the technology and the location (e.g., <code class="literal">SIP/0000FFFF0001</code>). We could certainly
          allow this, but then we would run the risk of people making
          expensive outbound calls, especially if a user opens his calendar
          publicly or is compromised. With the method we’re going to employ,
          we simply limit our risk.</p></div><p><a id="ExternalServices_id281891"></a>Add the following dialplan to
        your <code class="filename">extensions.conf</code> file:</p><p><a id="ExternalServices_id281897"></a><a id="ExternalServices_id281898"></a></p><pre class="programlisting">[AutomatedMeetingSetup]
exten =&gt; start,1,Verbose(2,Triggering meeting setup for two participants)
   same =&gt; n,Set(DeviceToDial=${FILTER(0-9A-Za-z,${CALENDAR_EVENT(location)})})
   same =&gt; n,Dial(SIP/${DeviceToDial},30)
   same =&gt; n,Hangup()</pre><p>When the event time arrives, our
        device will receive a call, and when that call is answered another
        call will be placed to the endpoint with which we wish to have our
        meeting. The console output looks like the following:</p><p><a id="ExternalServices_id281907"></a><a id="ExternalServices_id281908"></a></p><pre class="screen"><span class="emphasis"><em>This is where our calendar triggers a call to our device</em></span>

    -- Dialing SIP/0000FFFF0001 for notification on calendar myGoogleCal
  == Using SIP RTP CoS mark 5
    -- Called 0000FFFF0001
    -- SIP/0000FFFF0001-00000004 is ringing

<span class="emphasis"><em>And now we have answered the call from Asterisk triggered by an event</em></span>

    -- SIP/0000FFFF0001-00000004 connected line has changed, passing it to 
       Calendar/myGoogleCal-347ec99
    -- SIP/0000FFFF0001-00000004 answered Calendar/myGoogleCal-347ec99

<span class="emphasis"><em>Upon answer, we trigger some dialplan that looks up the endpoint to call</em></span>

    -- Executing [start@AutomatedMeetingSetup:1] Verbose("SIP/0000FFFF0001-00000004", 
       "2,Triggering meeting setup for two participants") in new stack
  == Triggering meeting setup for two participants


<span class="emphasis"><em>This is where we used CALENDAR_EVENT(location) to get the remote device</em></span>

    -- Executing [start@AutomatedMeetingSetup:2] Set("SIP/0000FFFF0001-00000004", 
       "DeviceToDial=0000FFFF0002") in new stack

<span class="emphasis"><em>And now we're dialing that endpoint</em></span>

    -- Executing [start@AutomatedMeetingSetup:3] Dial("SIP/0000FFFF0001-00000004", 
       "SIP/0000FFFF0002,30") in new stack
  == Using SIP RTP CoS mark 5
    -- Called 0000FFFF0002
    -- SIP/0000FFFF0002-00000005 is ringing

<span class="emphasis"><em>The other end answered the call, and Asterisk bridged us together</em></span>

    -- SIP/0000FFFF0002-00000005 answered SIP/0000FFFF0001-00000004
    -- Locally bridging SIP/0000FFFF0001-00000004 and SIP/0000FFFF0002-00000005
</pre><p>Of course, the dialplan could be expanded to prompt the initial
        caller to acknowledge being ready for the meeting prior to calling the
        other party. Likewise, we could add some dialplan that plays a prompt
        to the other caller that lets her know that she has scheduled a
        meeting and that if she presses <code class="literal">1</code>
        she will be connected with the other party immediately. We could even
        have created a dialplan that would allow the original party to record
        a message to be played back to the other caller.</p><p><a id="ExternalServices_id281949"></a>Just for fun, we’ll show you an
        example of the functionality we just described. Feel free to modify it
        to your heart’s content:</p><p><a id="ExternalServices_id281961"></a><a id="ExternalServices_id281962"></a></p><pre class="programlisting">[AutomatedMeetingSetup]
exten =&gt; start,1,Verbose(2,Triggering meeting setup for two participants)

; *** This line should not have any line breaks
   same =&gt; n,Read(CheckMeetingAcceptance,to-confirm-wakeup&amp;press-1&amp;otherwise
&amp;press-2,,1)

   same =&gt; n,GotoIf($["${CheckMeetingAcceptance}" != "1"]?hangup,1)

   same =&gt; n,Playback(silence/1&amp;pls-rcrd-name-at-tone&amp;and-prs-pound-whn-finished)

; We set a random number and assign it to the end of the recording
; so that we have a unique filename in case this is used by multiple
; people at the same time.
;
; We also prefix it with a double underscore because the channel
; variable also needs to be available to the channel we're going to call
;
   same =&gt; n,Set(__RandomNumber=${RAND()})
   same =&gt; n,Record(/tmp/meeting-invite-${RandomNumber}.ulaw)

   same =&gt; n,Set(DeviceToDial=${FILTER(0-9A-Za-z,${CALENDAR_EVENT(location)})})
   same =&gt; n,Dial(SIP/${DeviceToDial},30,M(CheckConfirm))
   same =&gt; n,Hangup()

exten =&gt; hangup,1,Verbose(2,Call was rejected)
   same =&gt; n,Playback(vm-goodbye)
   same =&gt; n,Hangup()

[macro-CheckConfirm]
exten =&gt; s,1,Verbose(2,Allowing called party to accept or reject)
   same =&gt; n,Playback(/tmp/meeting-invite-${RandomNumber})

; *** This line should not have any line breaks
   same =&gt; n,Read(CheckMeetingAcceptance,to-confirm-wakeup&amp;press-1&amp;otherwise
&amp;press-2,,1)

   same =&gt; n,GotoIf($["${CheckMeetingAcceptance}" != "1"]?hangup,1)

exten =&gt; hangup,1,Verbose(2,Call was rejected by called party)
   same =&gt; n,Playback(vm-goodbye)
   same =&gt; n,Hangup()</pre><p>We hope you’ll be able to use this
        simple dialplan example as a jumping-off point. With a little
        creativity and some dialplan skills, the possibilities are
        endless!<a id="I_indexterm18_d1e39347" class="indexterm"></a></p></div><div class="sect3" title="Calling meeting participants and placing them into a conference"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id281985"></a>Calling meeting participants and placing them into a
        conference</h4></div></div></div><p><a id="ExternalServices_id281991"></a><a id="I_indexterm18_d1e39352" class="indexterm"></a>To expand upon the functionality in the previous
        section, we’re going to delve into the logic problem of how you might
        be able to place multiple participants into a meeting. Our goal is to
        use our calendar to call us when the meeting is scheduled to start,
        and then, when we answer, to place calls to all the other members of
        the conference. As the other participants answer their phones, they
        will be placed into a virtual conference room, where they will wait
        for the meeting organizer to join. After all participants have been
        dialed and answered (or perhaps not answered), the organizer will be
        placed into the call, at which point the meeting will start.</p><p><a id="ExternalServices_id282007"></a>This type of functionality
        increases the likelihood that the meeting will start on time, and it
        means the meeting organizer doesn’t have to continually perform roll
        call as new participants continue to join after the call is supposed
        to start (which invariably happens, with people’s schedules typically
        being fairly busy).</p><p><a id="ExternalServices_id246754"></a>The dialplan we’re going to show
        you isn’t necessarily a polished, production-ready installation (for
        example, the data returned from the calendar comes from the
        description field, only deals with device names, and assumes the
        technology is SIP). However, we’ve done the hard work for you by
        developing the Local channel usage, along with the <code class="literal">M()</code> flag (macro) usage with <code class="literal">Dial()</code>. With some testing and tweaks this
        code could certainly be developed more fully for your particular
        installation, but we’ve kept it general to allow for it to be usable
        for more people in more situations. The example dialplan looks like
        this:<a id="I_indexterm18_d1e39368" class="indexterm"></a><a id="I_indexterm18_d1e39369" class="indexterm"></a><a id="I_indexterm18_d1e39370" class="indexterm"></a><a id="I_indexterm18_d1e39371" class="indexterm"></a></p><p><a id="ExternalServices_id246778"></a><a id="ExternalServices_id246779"></a></p><pre class="programlisting">[AutomatedMeetingSetup]
exten =&gt; start,1,Verbose(2,Calling multiple people and placing into a conference)

; Get information from calendar and save that information. Prefix
; CalLocation with an underscore so it is available to the Local
; channel (variable inheritance).
;
   same =&gt; n,Set(CalDescription=${CALENDAR_EVENT(description)})
   same =&gt; n,Set(_CalLocation=${CALENDAR_EVENT(location)})
   same =&gt; n,Set(X=1)

; Our separator is a caret (^), so the description should be in the
; format of:    0000FFFF0001^0000FFFF0002^etc...
;
   same =&gt; n,Set(EndPoint=${CUT(CalDescription,^,${X})})

; This loop is used to build the ${ToDial} variable, which contains
; a list of Local channels to be dialed, thereby triggering the multiple
; Originate() actions simultaneously instead of linearly
;
   same =&gt; n,While($[${EXISTS(${EndPoint})}])

; This statement must be on a single line
   same =&gt; n,Set(ToDial=${IF($[${ISNULL(${ToDial})}]?
                     :${ToDial}&amp;)}Local/${EndPoint}@MeetingOriginator)
   same =&gt; n,Set(X=$[${X} + 1])
   same =&gt; n,Set(EndPoint=${CUT(CalDescription,^,${X})})
   same =&gt; n,EndWhile()

; If no values are passed back, then don't bother dialing
   same =&gt; n,GotoIf($[${ISNULL(${ToDial})}]?hangup)
   same =&gt; n,Dial(${ToDial})

; After our Dial() statement returns, we should be placed into
; the conference room. We are marked, so the conference can start
; (which is indicated by the 'A' flag to MeetMe).
;
   same =&gt; n,MeetMe(${CalLocation},dA)
   same =&gt; n(hangup),Hangup()

[MeetingOriginator]
exten =&gt; _[A-Za-z0-9].,1,NoOp()
   same =&gt; n,Set(Peer=${FILTER(A-Za-z0-9,${EXTEN})})

; Originate calls to a peer as passed to us from the Local channel. Upon
; answer, the called party should execute the dialplan located at the
; _meetme-XXXX extension, where XXXX is the conference room number.
;
   same =&gt; n,Originate(SIP/${Peer},exten,MeetingOriginator,meetme-${CalLocation},1)
   same =&gt; n,Hangup()

; Join the meeting; using the 'w' flag, which means 'wait for marked
; user to join before starting'
;
exten =&gt; _meetme-XXXX,1,Verbose(2,Joining a meeting)
   same =&gt; n,Answer()
   same =&gt; n,MeetMe(${EXTEN:7},dw)
   same =&gt; n,Hangup()</pre></div></div><div class="sect2" title="Controlling Calls Based on Calendar Information"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id246818"></a>Controlling Calls Based on Calendar Information</h3></div></div></div><p><a id="ExternalServices_id246824"></a><a id="I_indexterm18_d1e39379" class="indexterm"></a><a id="I_indexterm18_d1e39386" class="indexterm"></a>Sometimes it is useful to redirect calls automatically—for
      example, when you’re in a meeting, or on vacation. In this section we’ll
      be making use of the <code class="literal">CALENDAR_BUSY()</code>
      dialplan function,<a id="I_indexterm18_d1e39395" class="indexterm"></a><a id="I_indexterm18_d1e39398" class="indexterm"></a> which allows us to check the current status of our
      calendar to determine if we’re busy or not. A simple example of this
      would be to send all calls to voicemail using the busy message whenever
      an event that marks us as busy has been scheduled.</p><p><a id="ExternalServices_id246834"></a>The following dialplan shows a
      simple example where we check our calendar for busy status prior to
      sending a call to a device. Notice that a lot of the information in this
      example is static, and additional effort would be required to make it
      dynamic and suitable for production:</p><p><a id="ExternalServices_id246841"></a><a id="ExternalServices_id246842"></a></p><pre class="programlisting">exten =&gt; 3000,1,Verbose(2,Simple calendar busy check example)
   same =&gt; n,Set(CurrentExten=${EXTEN})
   same =&gt; n,Set(CalendarBusy=${CALENDAR_BUSY(myGoogleCal)})
   same =&gt; n,GotoIf($["${CalendarBusy}" = "1"]?voicemail,1)
   same =&gt; n,Dial(SIP/0000FFFF0002,30)
   same =&gt; n,Goto(voicemail,1)

exten =&gt; voicemail,1,Verbose(2,Caller sent to voicemail)

; *** This line should not have any line breaks
   same =&gt; n,GotoIf($["${DIALSTATUS}" = "BUSY" | 
"${CalendarBusy}" = "1"]?busy:unavail)

   same =&gt; n(busy),VoiceMail(${CurrentExten}@shifteight,b)
   same =&gt; n,Hangup()

   same =&gt; n(unavail),VoiceMail(${CurrentExten}@shifteight,u)
   same =&gt; n,Hangup()</pre><p>And here is a slightly more elaborate
      section of dialplan that utilizes a few of the tools we’ve learned
      throughout the book, including <code class="literal">DB_EXISTS()</code>, <code class="literal">GotoIf()</code>, and the <code class="literal">IF()</code> function:</p><p><a id="ExternalServices_id246866"></a><a id="ExternalServices_id246867"></a></p><pre class="programlisting">exten =&gt; _3XXX,1,Verbose(2,Simple calendar busy check example)
   same =&gt; n,Set(CurrentExten=${EXTEN})
   same =&gt; n,GotoIf($[${DB_EXISTS(extension/${CurrentExten}/device)}]?:no_device,1)
   same =&gt; n,Set(CurrentDevice=${DB_RESULT})
   same =&gt; n,GotoIf($[${DB_EXISTS(extension/${CurrentExten}/calendar)}]?:no_calendar)
   same =&gt; n,Set(CalendarBusy=${CALENDAR_BUSY(${DB_RESULT})})
   same =&gt; n,GotoIf($[${CalendarBusy}]?voicemail,1)
   same =&gt; n(no_calendar),Verbose(2,No calendar was found for this user)
   same =&gt; n,Dial(SIP/${CurrentDevice},30)
   same =&gt; n,Goto(voicemail,1)

exten =&gt; voicemail,1,Verbose(2,Sending caller to voicemail)

; *** This line should not have any line breaks
   same =&gt; n,GotoIf($[${DB_EXISTS(extension/${CurrentExten}/voicemail_context)}]
?:no_voicemail)

   same =&gt; n,Set(VoiceMailContext=${DB_RESULT})
; *** This line should not have any line breaks
   same =&gt; n,Set(VoiceMailStatus=${IF($["${DIALSTATUS}" = "BUSY" | 
0${CalendarBusy}]?b:u)})
   same =&gt; n,VoiceMail(${CurrentExten}@${VoiceMailContext},${VoiceMailStatus})
   same =&gt; n,Hangup()

   same =&gt; n(no_voicemail),Playback(number-not-answering)
   same =&gt; n,Hangup()

exten =&gt; no_device,1,Verbose(2,No device found in the DB)
   same =&gt; n,Playback(invalid)
   same =&gt; n,Hangup()</pre></div><div class="sect2" title="Writing Call Information to a Calendar"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id36060342"></a>Writing Call Information to a Calendar</h3></div></div></div><p><a id="ExternalServices_id36060347"></a><a id="index-216L457FO5K" class="indexterm"></a><a id="index-514W746AJ6A" class="indexterm"></a><a id="index-136I072EB6E" class="indexterm"></a>Using the <code class="literal">CALENDAR_WRITE()</code> function opens some other
      possibilities in terms of calendar integration. From the Asterisk
      dialplan, we can insert information into a calendar, which can be
      consumed by other devices and applications. Our next example is a
      calendar that tracks call logs. For anyone who may be on the phone a
      fair amount who needs to track time for clients, writing all calls to a
      calendar for a visual reference can be useful when verifying things at
      the end of the day.</p><p><a id="ExternalServices_id36018957"></a>We’re going to utilize the Google
      web calendar again for this example, but we’re going to create a new,
      separate calendar just for tracking calls. In order to write to the
      calendar, we’ll need to set up our <code class="filename">calendar.conf</code><a id="I_indexterm18_d1e39449" class="indexterm"></a><a id="I_indexterm18_d1e39452" class="indexterm"></a> file a little bit differently, by using the CalDAV
      calendar format. First, though, we need to create our new
      calendar.</p><p><a id="ExternalServices_id36023610"></a>On the left side of the Google
      calendar interface will be a link labeled <span class="emphasis"><em>Add</em></span>.
      Clicking on this will open a new window where you can create the
      calendar. Go ahead and do that now. We’ve called ours “Phone
      Calls.”</p><p><a id="ExternalServices_id36023005"></a>Now we need to enable CalDAV
      calendar syncing for our calendar. Information about how to do this is
      located at <a class="ulink" href="http://www.google.com/support/mobile/bin/answer.py?answer=151674" target="_top">http://www.google.com/support/mobile/bin/answer.py?answer=151674</a>.
      This page notes that only your primary calendar will be synced to the
      device, but we want to make sure our calls are logged to a separate
      calendar so we can easily hide them (and so our smartphone doesn’t
      synchronize the phone’s calls either, which may cause confusion). There
      are two links near the bottom of the page: one for regular Google
      calendar users, and the other for Google Apps users. Select the
      appropriate link and open it. You will then be presented with a page
      that contains your calendars. Select the <span class="emphasis"><em>Phone
      Calls</em></span> calendar and then select
      <span class="emphasis"><em>Save</em></span>.</p><p><a id="ExternalServices_id36024218"></a>Next up is configuring our
      <code class="filename">calendar.conf</code> file for Asterisk.
      One of the parameters we need is the link to the CalDAV calendar. There
      is a Calendar ID value that we need that will identify our calendar
      specifically. To find the calendar ID, click the down arrow beside the
      calendar name on the lefthand side of the calendar page and select
      <span class="emphasis"><em>Calendar Settings</em></span>. Near the bottom of the calendar
      settings will be two rows that contain the icons for sharing the
      calendar (XML, ICAL, HTML). Beside the first set of icons inside the
      <span class="emphasis"><em>Calendar Address</em></span> box will be the calendar ID. It
      will look like this:</p><p><a id="ExternalServices_id36021156"></a><a id="ExternalServices_id36021157"></a></p><pre class="programlisting">(Calendar ID: 2hfb6p5974gds924j61cmg4gfd@group.calendar.google.com)</pre><p><a id="ExternalServices_id36020079"></a>If you’re setting this up via
      Google Apps, the calendar ID will be prefixed with your domain name and
      an underscore (e.g., <code class="literal">shifteight.org_</code>). Make a note of this string,
      as we’re going to use it next.</p><p><a id="ExternalServices_id36019060"></a>Open up the <code class="filename">calendar.conf</code> file and add a new calendar
      section. In our case we’ve called it <code class="literal">[phone_call_calendar]</code>. You’ll recognize the
      formatting of the calendar from earlier, so we won’t go through all the
      settings here. The key setting to note is the <code class="literal">url</code> parameter. The format of this parameter
      is:</p><p><a id="ExternalServices_id36025221"></a><a id="ExternalServices_id36025222"></a></p><pre class="programlisting">https://www.google.com/calendar/dav/<em class="replaceable"><code>&lt;calendar_id&gt;</code></em>/events/</pre><p>We
      need to replace the <em class="replaceable"><code>&lt;calendar_id&gt;</code></em> with
      the calendar ID we recently made a note of. The full configuration then
      ends up looking like so:</p><p><a id="ExternalServices_id36022519"></a><a id="ExternalServices_id36022520"></a></p><pre class="programlisting">[phone_call_calendar]
type=caldav

; The URL must be on a single line
url=https://www.google.com/calendar/dav/
   shifteight.org_2hfb6p5974gds924j61cmg4gfd@group.calendar.google.com/events/

user = leif@shifteight.org
secret = <em class="replaceable"><code>my_secret_password</code></em>
refresh=15
timeframe=120
</pre><p>Now that we have our calendar configured, we need to load it
      into memory, which can be done by reloading the <code class="filename">res_calendar.so</code> module:</p><p><a id="ExternalServices_id36024332"></a><a id="ExternalServices_id36024333"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module reload res_calendar.so</code></strong></pre><p>Verify
      that the calendar has been loaded into memory successfully with the
      <span class="command"><strong>calendar show</strong></span> command:</p><p><a id="ExternalServices_id36024197"></a><a id="ExternalServices_id36024198"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>calendar show calendars</code></strong>
Calendar             Type       Status
--------             ----       ------
phone_call_calendar  caldav     free  </pre><p>With our calendar successfully
      loaded into memory, we can write some dialplan around our <code class="literal">Dial()</code> command to save our call information to
      the calendar with the <code class="literal">CALENDAR_WRITE()</code> function:</p><p><a id="ExternalServices_id36027175"></a><a id="ExternalServices_id36027176"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; _NXXNXXXXXX,1,Verbose(2,Outbound calls)
   same =&gt; n,Set(CalendarStart=${EPOCH}) ; Used by CALENDAR_WRITE()
   same =&gt; n,Set(X=${EXTEN})             ; Used by CALENDAR_WRITE()
   same =&gt; n,Dial(SIP/ITSP/${EXTEN},30)
   same =&gt; n,NoOp(Handle standard voicemail stuff here)
   same =&gt; n,Hangup()

exten =&gt; h,1,Verbose(2,Call cleanup)

; Everything that follows must be on a single line
   same =&gt; n,Set(CALENDAR_WRITE(phone_call_calendar,summary,description,start,end)=
      OUTBOUND: ${X},Phone call to ${X} lasted for ${CDR(billsec)} seconds.,
      ${CalendarStart},${EPOCH})</pre><p>In our dialplan we’ve created
      a simple scenario where we place an outbound call through our Internet
      Telephony Service Provider (ITSP), but prior to placing the call, we
      save the epoch<sup>[<a id="id617326" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id617326" class="footnote">157</a>]</sup> to a channel variable (so we can use it later when we
      write our calendar entry at the end of the call). After our call, we
      write our calendar entry to the <code class="literal">phone_call_calendar</code> with the <code class="literal">CALENDAR_WRITE()</code> dialplan function within the
      built-in <code class="literal">h</code> extension. There are
      several options we can pass to the calendar, such as the summary,
      description, and start and end times. All of this information is then
      saved to the <span class="keep-together">calendar</span>.</p><p><a id="ExternalServices_id36027115"></a>We’ve also used the <code class="literal">CDR()</code> dialplan function <a id="I_indexterm18_d1e39575" class="indexterm"></a><a id="I_indexterm18_d1e39578" class="indexterm"></a>in our description to show the number of seconds the
      answered portion of the call lasted for, so we can get a more accurate
      assessment of whether a call was answered and, if so, how long the
      answered portion lasted for. We could also be clever and only write to
      the calendar if <code class="literal">${CDR(billsec)}</code> was
      greater than 0 by wrapping the <code class="literal">Set()</code>
      application in an <code class="literal">ExecIf()</code>; e.g.,
      <code class="literal">same =&gt; n,ExecIf($[${CDR(billsec)} &gt;
      0]?Set(CALENDAR_WRITE...))</code>.</p><p><a id="ExternalServices_id36027136"></a>Many possibilities exist for the
      <code class="literal">CALENDAR_WRITE()</code> function; this is
      just one that we’ve implemented and enjoy.<a id="I_indexterm18_d1e39602" class="indexterm"></a><a id="I_indexterm18_d1e39603" class="indexterm"></a><a id="I_indexterm18_d1e39604" class="indexterm"></a></p></div><div class="sect2" title="Conclusion"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id246890"></a>Conclusion</h3></div></div></div><p><a id="ExternalServices_id246895"></a>In this section we’ve learned how
      to integrate Asterisk with an external calendar server such as that
      provided by Google, but the concepts for attaching to other calendaring
      servers remain the same. We explored how to set up a meeting between two
      participants, and how to set up a multiparty conference using
      information obtained from the description field in the calendar. We also
      looked at how to control calls using the <code class="literal">CALENDAR_BUSY()</code> function,<a id="I_indexterm18_d1e39613" class="indexterm"></a><a id="I_indexterm18_d1e39616" class="indexterm"></a> to redirect calls to voicemail when our current event
      describes us as busy. By implementing this type of functionality in
      Asterisk, you can see the power we have to control call flow using
      external services such as those supplied by a calendar server.</p><p><a id="ExternalServices_id36027082"></a>And we didn’t even get to dive
      into every use of the calendar implementation—there exist other calendar
      functions, such as <code class="literal">CALENDAR_QUERY()</code>,<a id="I_indexterm18_d1e39627" class="indexterm"></a><a id="I_indexterm18_d1e39630" class="indexterm"></a> which allows you to pull back a list of events within a
      given time period for a particular calendar, and <code class="literal">CALENDAR_QUERY_RESULT()</code>,<a id="I_indexterm18_d1e39639" class="indexterm"></a><a id="I_indexterm18_d1e39642" class="indexterm"></a> which allows you to access the specifics of those
      calendar events. Additionally, you could create functionality that
      writes events into your calendar with the <code class="literal">CALENDAR_WRITE()</code> function: for example, you
      may wish to develop some dialplan that allows you to set aside blocks of
      times in your calendar from your phone when you’re on the road without
      access to your laptop. Many possibilities exist, and all it takes is a
      little creativity.<a id="I_indexterm18_d1e39652" class="indexterm"></a><a id="I_indexterm18_d1e39653" class="indexterm"></a></p></div></div><div class="sect1" title="VoiceMail IMAP Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="voicemail_IMAP_integration"></a>VoiceMail IMAP Integration</h2></div></div></div><p><a id="ExternalServices_id246939"></a><a id="index-301B737LC4R" class="indexterm"></a><a id="index-654H370RT6J" class="indexterm"></a><a id="index-657K765SD4T" class="indexterm"></a>“Unified messaging” has been a buzzword in the
    telecommunications industry for ages. It’s all about integrating services
    together so users can access the same types of data in multiple locations,
    using different methods. One of the most touted applications is the
    integration of email and voicemail. Asterisk has been doing this for
    years, but many of the larger companies are still trying to get this
    right. Asterisk has had the ability to send users voicemails via email,
    using the Mail Transport Agent (MTA) in your Linux distro (this always
    used to be <span class="emphasis"><em>sendmail</em></span>, but Postfix has become
    increasingly popular as an MTA). Voicemail to email is one of the oldest
    features in Asterisk, and it normally works without any configuration at
    all.<sup>[<a id="id617745" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id617745" class="footnote">158</a>]</sup></p><p><a id="ExternalServices_id246969"></a>Internet Message Access Protocol
    (IMAP) integration has existed in Asterisk (and been steadily evolving)
    since version 1.4. IMAP voicemail integration means your users can access
    their voicemails via a folder within their email accounts, which gives
    them the ability to listen to, forward, and mark voicemail messages with
    the same flexibility that the Asterisk <code class="literal">VoiceMail()</code> dialplan application gives. Asterisk
    will be aware of the statuses of those messages when the users next log in
    via the phone system.</p><p><a id="ExternalServices_id246980"></a>As the number of administrators
    integrating Asterisk with their IMAP servers has increased, the number of
    bugs filed and fixed has first increased and then decreased, to the point
    where IMAP integration can be considered stable enough for production use.
    In this section we’ll discuss how to compile in IMAP voicemail support and
    connect your voicemail system to your IMAP server.</p><div class="sect2" title="Compiling IMAP VoiceMail Support into Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id246986"></a>Compiling IMAP VoiceMail Support into Asterisk</h3></div></div></div><p><a id="ExternalServices_id246992"></a><a id="index-884K777TN7N" class="indexterm"></a>To get IMAP voicemail support into Asterisk, we need to
      compile the University of Washington’s IMAP library. The UW IMAP toolkit
      will give us the functionality in Asterisk to connect to our IMAP
      server. Before compiling the software, though, we need to install some
      dependencies.</p><p><a id="ExternalServices_id246998"></a>The dependencies for building the
      IMAP library include the tools required to build Asterisk, but the way
      we’re building it also requires the development libraries for OpenSSL
      and Pluggable Authentication Modules (PAM). We’ve included instructions
      for both CentOS and Ubuntu.</p><div class="sect3" title="CentOS dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id247003"></a>CentOS dependencies</h4></div></div></div><p><a id="ExternalServices_id247009"></a><a id="I_indexterm18_d1e39703" class="indexterm"></a>Installing both the OpenSSL and PAM development
        libraries on CentOS can be done with the following command:</p><p><a id="ExternalServices_id247024"></a><a id="ExternalServices_id247025"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install openssl-devel pam-devel</code></strong></pre><p>
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id247015"></a>Remember to add
            <span class="emphasis"><em>.x86_64</em></span> to the name of each package if
            installing on a 64-bit machine.</p></div></div><div class="sect3" title="Ubuntu dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id247032"></a>Ubuntu dependencies</h4></div></div></div><p><a id="ExternalServices_id247037"></a><a id="I_indexterm18_d1e39726" class="indexterm"></a>Installing both the OpenSSL and PAM development
        libraries on Ubuntu can be done with the following command:</p><p><a id="ExternalServices_id247041"></a><a id="ExternalServices_id247042"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install libssl-dev libpam0g-dev</code></strong></pre><p>
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id247049"></a>If you try to install
            <code class="filename">libpam-dev</code> on Ubuntu, it will
            warn you that <code class="filename">libpam-dev</code> is a
            virtual package and that you should explicitly install one of the
            packages in the list it presents you with (which in our case
            contained only a single package). If <code class="filename">libpam0g-dev</code> is not the correct package
            on your version of Ubuntu, try installing the virtual package.
            This should give you a list of valid packages for the PAM
            development library.</p></div></div><div class="sect3" title="Compiling the IMAP library"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id247065"></a>Compiling the IMAP library</h4></div></div></div><p><a id="ExternalServices_id247071"></a><a id="I_indexterm18_d1e39755" class="indexterm"></a><a id="I_indexterm18_d1e39760" class="indexterm"></a>Now that we have our dependencies satisfied, we can
        compile the IMAP library that Asterisk will use to connect to our IMAP
        server.</p><p><a id="ExternalServices_id247075"></a>The first thing to do is change
        to the <code class="filename">thirdparty</code> directory
        located under the <code class="filename">asterisk-complete</code> directory. If you have
        not already created this directory, do so now:</p><p><a id="ExternalServices_id247087"></a><a id="ExternalServices_id247088"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>mkdir thirdparty</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd thirdparty</code></strong></pre><p>Next
        up is downloading the IMAP toolkit and compiling it. The next steps
        will get the latest version of the IMAP toolkit from the University of
        Washington’s server (more information about the toolkit is available
        at <a class="ulink" href="http://www.washington.edu/imap/" target="_top">http://www.washington.edu/imap/</a>):</p><p><a id="ExternalServices_id247101"></a><a id="ExternalServices_id247102"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>wget ftp://ftp.cac.washington.edu/mail/imap.tar.Z</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>tar zxvf imap.tar.Z</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd imap-2007e</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id247107"></a>The directory name <code class="filename">imap-2007e</code> may change as new versions
            of the toolkit become available.</p></div><p>There are a few options we need to pass to the <span class="command"><strong>make</strong></span> command when building the IMAP library,
        and the values you should pass will depend on what platform you’re
        building on (32-bit vs. 64-bit), if you need OpenSSL support, and
        whether you need IPv6 support or just IPv4. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247120" title="Table 18.1. IMAP library compile time options">Table&nbsp;18.1, “IMAP library compile time options”</a> shows some of the various
        options you could pass on different platforms.</p><div class="table"><a id="ExternalServices_id247120"></a><p class="title"><strong>Table&nbsp;18.1.&nbsp;IMAP library compile time options</strong></p><div class="table-contents"><table summary="IMAP library compile time options" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">EXTRACFLAGS="-fPIC"</code></td><td>Required when building on 64-bit platforms.</td></tr><tr><td><code class="literal">EXTRACFLAGS="-I/usr/include/openssl"</code></td><td>Used for building in OpenSSL support.</td></tr><tr><td><code class="literal">IP6=4</code></td><td>Many platforms that support IPv6 prefer that method of
                connection, which may not be desirable for all servers. If you
                would like to force IPv4 as the preferred connection method,
                set this option.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ExternalServices_id247187"></a>If you look in the <code class="filename">Makefile</code> shipped with the IMAP library, you
        will find a list of platforms for which the library can be compiled.
        In our case, we’ll be compiling for either CentOS or Ubuntu with PAM
        support. If you’re compiling on other systems, take a look in the
        <span class="emphasis"><em>Makefile</em></span> for the three-letter code that tells the
        library how to compile for your platform.</p><p><a id="ExternalServices_id247194"></a>To compile for a 64-bit platform
        with OpenSSL support and a preference for connecting via IPv4:</p><p><a id="ExternalServices_id247200"></a><a id="ExternalServices_id247201"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make lnp EXTRACFLAGS="-fPIC -I/usr/include/openssl" IP6=4</code></strong></pre><p>To
        compile for a 32-bit platform with OpenSSL support and a preference
        for connecting via IPv4:</p><p><a id="ExternalServices_id247210"></a><a id="ExternalServices_id247211"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make lnp EXTRACFLAGS="-I/usr/include/openssl" IP6=4</code></strong></pre><p>If
        you don’t wish to compile with OpenSSL support, simply remove the
        <code class="literal">-I/usr/include/openssl</code> from the
        <code class="literal">EXTRACFLAGS</code> option. If you would
        prefer connecting by IPv6 by default, simply don’t specify the
        <code class="literal">IP6=4</code> option.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id320289"></a>When installing IMAP support,
          we have always compiled the c-client library from source. However,
          it may be available as a package for your distribution. For example,
          Ubuntu has a <code class="filename">libc-client-dev</code>
          package available. It may work and save you some trouble, but we
          have not tested it.</p></div></div><div class="sect3" title="Compiling Asterisk"><div class="titlepage"><div><div><h4 class="title"><a id="compiling-asterisk-imap-support"></a>Compiling Asterisk</h4></div></div></div><p><a id="ExternalServices_id247239"></a>After compiling the IMAP library,
        we need to recompile the <code class="filename">app_voicemail.so</code> module with IMAP support.
        The first step is to run the <span class="command"><strong>configure</strong></span> script and pass it the
        <span class="emphasis"><em>--with-imap</em></span> option to tell it where the IMAP
        library exists:</p><p><a id="ExternalServices_id247254"></a><a id="ExternalServices_id247255"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8.0</code></strong>
$ <strong class="userinput"><code>./configure <em class="parameter"><code>--with-imap=~/src/asterisk-complete/thirdparty/imap-2007e/</code></em></code></strong></pre><p>Once
        the <span class="command"><strong>configure</strong></span> script has finished
        executing, we need to enable IMAP voicemail support in <span class="command"><strong>menuselect</strong></span>:</p><p><a id="ExternalServices_id247278"></a><a id="ExternalServices_id247279"></a></p><pre class="screen">$ <strong class="userinput"><code>make menuselect</code></strong></pre><p>From
        the <span class="command"><strong>menuselect</strong></span> interface, go to
        <span class="emphasis"><em>Voicemail Build Options</em></span>. Within that menu, you
        should have the option to select <code class="literal">IMAP_STORAGE</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id247298"></a>If you don’t have the ability
          to select that option, check to make sure your IMAP library was
          built successfully (i.e., that you have all the required
          dependencies installed and that it didn’t error out when building)
          and that you correctly specified the path to the IMAP library when
          running the <span class="command"><strong>configure</strong></span> script. You
          can also verify that the IMAP library was found correctly by looking
          in the <code class="filename">config.log</code> file (located
          in your Asterisk build directory) for IMAP.</p></div><p><a id="ExternalServices_id247314"></a>After selecting <code class="literal">IMAP_STORAGE</code>, save and exit from <span class="command"><strong>menuselect</strong></span> and run <span class="emphasis"><em>make
        install</em></span>, which will recompile the <code class="filename">app_voicemail.so</code> module and install it to
        the appropriate location. The next step is to configure the <code class="filename">voicemail.conf</code> file located in <code class="filename">/etc/asterisk/</code>.</p></div><div class="sect3" title="Configuring Asterisk"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id286256"></a>Configuring Asterisk</h4></div></div></div><p><a id="ExternalServices_id286262"></a><a id="I_indexterm18_d1e39977" class="indexterm"></a>Now that we’ve compiled IMAP support into Asterisk, we
        need to enable it by connecting to an IMAP-enabled server. There are
        many IMAP servers that you could use, including those supplied with
        Microsoft servers, <a class="ulink" href="http://www.dovecot.org/" target="_top">Dovecot</a>, and <a class="ulink" href="http://www.cyrusimap.org/" target="_top">Cyrus</a> on Unix, or a web-based
        IMAP server such as that supplied by Google’s <a class="ulink" href="http://www.gmail.com/" target="_top">Gmail</a>.<sup>[<a id="id618641" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id618641" class="footnote">159</a>]</sup> Our instructions are going to show how to connect
        Asterisk to a Gmail account with IMAP enabled, as it requires the
        least amount of effort to get up and running with IMAP voicemail, but
        these instructions can easily be adapted for use with any existing
        IMAP server.</p><div class="sect4" title="Enabling IMAP on your Gmail account"><div class="titlepage"><div><div><h5 class="title"><a id="enabling-gmail-imap"></a>Enabling IMAP on your Gmail account</h5></div></div></div><p><a id="ExternalServices_id286311"></a><a id="I_indexterm18_d1e40003" class="indexterm"></a><a id="I_indexterm18_d1e40008" class="indexterm"></a>Enabling IMAP support on your Gmail account is
          straightforward (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286334" title="Figure 18.1. Enabling Gmail IMAP">Figure&nbsp;18.1, “Enabling Gmail IMAP”</a>).
          Once logged into your account, select <span class="emphasis"><em>Settings</em></span>
          from the upper-right corner. Then select <span class="emphasis"><em>Forwarding and
          POP/IMAP</em></span> support from the task bar under the
          <span class="emphasis"><em>Settings</em></span> header. In the <span class="emphasis"><em>IMAP
          Access</em></span> section, enable IMAP support by selecting
          <span class="emphasis"><em>Enable IMAP</em></span>. After enabling it, click the
          <span class="emphasis"><em>Save Changes</em></span> button at the bottom of the
          screen.</p><div class="figure-float"><div class="figure"><a id="ExternalServices_id286334"></a><p class="title"><strong>Figure&nbsp;18.1.&nbsp;Enabling Gmail IMAP</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject18_d1e40036"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1801.png" alt="Enabling Gmail IMAP"></div></div></div><br class="figure-break"></div></div><div class="sect4" title="Configuring voicemail.conf for IMAP"><div class="titlepage"><div><div><h5 class="title"><a id="ExternalServices_id286355"></a>Configuring voicemail.conf for IMAP</h5></div></div></div><p><a id="ExternalServices_id286361"></a><a id="I_indexterm18_d1e40045" class="indexterm"></a><a id="I_indexterm18_d1e40050" class="indexterm"></a>To enable our voicemail system to connect to an IMAP
          system, we need to make sure IMAP support has been built into the
          <code class="filename">app_voicemail.so</code> module per the
          instructions in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#compiling-asterisk-imap-support" title="Compiling Asterisk">the section called “Compiling Asterisk”</a>.
          With IMAP support compiled into Asterisk, we just need to instruct
          the voicemail module how to connect to our IMAP server.</p><p><a id="ExternalServices_id286376"></a>We’re going to demonstrate how
          to connect to an IMAP-enabled Gmail account and use that to store
          and retrieve our voicemail messages. If you haven’t already, read
          the section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#enabling-gmail-imap" title="Enabling IMAP on your Gmail account"></a> before proceeding. The final step is
          configuring <code class="filename">voicemail.conf</code> to
          connect to the server.</p><p><a id="ExternalServices_id286388"></a>In
          <span class="emphasis"><em>voicemail.conf</em></span>, add the following lines to the
          <code class="literal">[general]</code> section. Be sure you
          only specify a single <code class="literal">format</code> (we
          recommend <code class="literal">wav49</code>) for voicemail
          recordings, and remove any references to ODBC voicemail storage if
          you’ve enabled that previously:</p><p><a id="ExternalServices_id286406"></a><a id="ExternalServices_id286407"></a></p><pre class="programlisting">[general]
format=wav49              ; format to store files
imapserver=imap.gmail.com ; IMAP server location
imapport=993              ; port IMAP server listens to
imapflags=ssl             ; flags required for connecting
expungeonhangup=yes       ; delete messages on hangup
pollmailboxes=yes         ; used for message waiting indication
pollfreq=30               ; how often to check for message changes</pre><p>Before
          we configure our user for connecting to the Gmail IMAP server, let’s
          discuss the options we’ve just set in the <code class="literal">[general]</code> section. These are the basic
          options that will get us started; we’ll do some more customization
          shortly, but let’s see what we’ve done <span class="keep-together">so far</span>.</p><p><a id="ExternalServices_id286420"></a>First, the <code class="literal">format=wav49</code> option has declared that
          we’re going to save our files as GSM with a WAV header, which can be
          played on most desktops (including Microsoft Windows) while
          retaining a small file size.</p><p><a id="ExternalServices_id286429"></a>Next, we’ve configured Asterisk
          to connect to an <code class="literal">imapserver</code>
          located at <code class="literal">imap.gmail.com</code> on
          <code class="literal">imapport</code> <code class="literal">993</code>. We’ve also set <code class="literal">imapflags</code><a id="I_indexterm18_d1e40113" class="indexterm"></a> to <code class="literal">ssl</code>, as Gmail
          requires a secure connection. Without the <code class="literal">ssl</code> IMAP flag being set, the server will
          reject our connection attempts (which is why it was important that
          we compiled our IMAP library with OpenSSL support). Another option
          that may be required on private IMAP servers such as Dovecot is to
          specify <code class="literal">novalidate-cert</code> for
          <code class="literal">imapflags</code> when an SSL connection
          is necessary, but the certificate is not generated by a certificate
          authority.</p><p><a id="ExternalServices_id286466"></a>Next, we’ve set <code class="literal">expungeonhangup=<a id="I_indexterm18_d1e40134" class="indexterm"></a>yes</code>, which causes messages marked for
          deletion to be removed from the server upon hangup from the <code class="literal">VoiceMail()</code> application. Without this
          option, messages are simply marked as read and left on the server
          until they have been removed via an email application or web
          interface.</p><p><a id="ExternalServices_id286478"></a>In order to get message waiting
          indication (MWI) updates correctly, we need to enable <code class="literal">pollmailboxes=<a id="I_indexterm18_d1e40146" class="indexterm"></a>yes</code>, which causes Asterisk to check with the
          server for any changes to the status of a message. For example, when
          someone leaves us a voicemail and we listen to it by opening the
          message via our email application, the message will be marked as
          read, but without polling the mailbox Asterisk will have no way of
          knowing this and will enable the MWI light on the associated device
          indefinitely. Finally, we’ve set the related option <code class="literal">pollfreq</code><a id="I_indexterm18_d1e40153" class="indexterm"></a> to <code class="literal">30</code> seconds.
          This option controls how often Asterisk will ask the server for the
          status of messages: set it appropriately to control the amount of
          traffic going to the voicemail server.</p><p><a id="ExternalServices_id286499"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286503" title="Table 18.2. Additional IMAP voicemail options">Table&nbsp;18.2, “Additional IMAP voicemail options”</a> shows some of the other
          options available to us.</p><div class="table"><a id="ExternalServices_id286503"></a><p class="title"><strong>Table&nbsp;18.2.&nbsp;Additional IMAP voicemail options</strong></p><div class="table-contents"><table summary="Additional IMAP voicemail options" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">imapfolder</code></td><td><a id="I_indexterm18_d1e40179" class="indexterm"></a>Provides the name of the folder in which to
                  store voicemail messages on your IMAP server. By default
                  they are stored in the <span class="emphasis"><em>INBOX</em></span>.<sup>[<a id="id619196" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id619196" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">imapgreetings</code></td><td><a id="I_indexterm18_d1e40203" class="indexterm"></a>Defines whether voicemail greetings are stored
                  on the IMAP server or stored locally on the server. Valid
                  values are <code class="literal">yes</code> or
                  <code class="literal">no</code>.</td></tr><tr><td><code class="literal">imapparentfolder</code></td><td><a id="I_indexterm18_d1e40218" class="indexterm"></a>Defines the parent folder on the IMAP server.
                  Usually this configured as <code class="filename">INBOX</code> on the server, but if it is
                  called something else, you can specify it here.</td></tr><tr><td><code class="literal">greetingfolder</code></td><td><a id="I_indexterm18_d1e40230" class="indexterm"></a>Specifies the folder in which to save the
                  voicemail greetings, if you’ve enabled the <code class="literal">imapgreetings</code> option by setting it
                  to <code class="literal">yes</code>. By default
                  greetings are saved in the <code class="filename">INBOX</code>.</td></tr><tr><td><code class="literal">authuser</code></td><td><a id="I_indexterm18_d1e40248" class="indexterm"></a>Specifies the master user to use for
                  connecting to your IMAP server, if the server is configured
                  with a single user that has access to all mailboxes.</td></tr><tr><td><code class="literal">authpassword</code></td><td><a id="I_indexterm18_d1e40257" class="indexterm"></a>Complement to the <code class="literal">authuser</code> directive. See <code class="literal">authuser</code> for more
                  information.</td></tr><tr><td><code class="literal">opentimeout</code></td><td><a id="I_indexterm18_d1e40272" class="indexterm"></a>Specifies the TCP open timeout (in
                  seconds).</td></tr><tr><td><code class="literal">closetimeout</code></td><td><a id="I_indexterm18_d1e40281" class="indexterm"></a>Specifies the TCP close timeout (in
                  seconds).</td></tr><tr><td><code class="literal">readtimeout</code></td><td><a id="I_indexterm18_d1e40290" class="indexterm"></a>Specifies the TCP read timeout (in
                  seconds).</td></tr><tr><td><code class="literal">writetimeout</code></td><td><a id="I_indexterm18_d1e40299" class="indexterm"></a>Specifies the TCP write timeout (in
                  seconds).</td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.id619196" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id619196" class="para">a</a>] </sup>It is important to
                      store your voicemail messages in a folder other than the
                      <span class="emphasis"><em>INBOX</em></span> if the number of messages
                      contained in the <span class="emphasis"><em>INBOX</em></span> could be
                      rather large. Asterisk will try to gather information
                      about all the emails contained in the
                      <span class="emphasis"><em>INBOX</em></span>, and could either time out
                      before retrieving all the information or just take a
                      very long time to store or retrieve voicemail messages,
                      which is not desirable.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="ExternalServices_id286651"></a>With our <code class="literal">[general]</code> section configured, let’s define
          a mailbox for connecting to the IMAP server.</p><p><a id="ExternalServices_id286658"></a>In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail" title="Chapter 8. Voicemail">Chapter&nbsp;8, <em>Voicemail</em></a> we defined some users in the
          <code class="literal">[shifteight]</code> voicemail context.
          Here is the original configuration as defined in that
          chapter:</p><p><a id="ExternalServices_id286672"></a><a id="ExternalServices_id286673"></a></p><pre class="programlisting">[shifteight]
100 =&gt; 0107,Leif Madsen,leif@shifteight.org
101 =&gt; 0523,Jim VanMeggelen,jim@shifteight.org,,attach=no|maxmsg=100
102 =&gt; 11042,Tilghman Lesher,,,attach=no|tz=central</pre><p>We’re
          going to modify mailbox 100 in such a way that it connects to the
          Gmail IMAP server to store and retrieve voicemail messages:</p><p><a id="ExternalServices_id286682"></a><a id="ExternalServices_id286683"></a></p><pre class="programlisting">[shifteight]
100 =&gt; 0107,Leif Madsen,,,|imapuser=leif@shifteight.org|imappassword=secret</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id286689"></a>The <code class="filename">voicemail.conf</code> file uses both commas
              <a id="I_indexterm18_d1e40329" class="indexterm"></a><a id="I_indexterm18_d1e40332" class="indexterm"></a><a id="I_indexterm18_d1e40335" class="indexterm"></a><a id="I_indexterm18_d1e40340" class="indexterm"></a>and pipes as separators, depending on which field
              is being used. The first few fields have specific settings in
              them, and the last field can contain extra information about the
              mailbox, which is separated by the pipe character (|).</p></div><p>We’ve removed the email address from the third field
          because we’re not going to use <span class="emphasis"><em>sendmail</em></span> to
          email us voicemails anymore: they are just going to be stored on the
          email server directly now. We’ve configured the mailbox to connect
          with the IMAP username of <code class="literal">leif@shifteight.org</code> (because we’ve enabled
          Google Apps for the domain that hosts our email) and are connecting
          using the IMAP password <code class="literal">secret</code>.</p><p><a id="ExternalServices_id286711"></a>After configuring Asterisk, we
          need to reload the <code class="filename">app_voicemail.so</code> module. If you enable
          console debugging, you should see output similar to the following
          upon connection to the voicemail server:</p><p><a id="ExternalServices_id286720"></a><a id="ExternalServices_id286721"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>core set debug 10</code></strong>
*CLI&gt; <strong class="userinput"><code>module reload app_voicemail.so</code></strong>
DEBUG[3293]: app_voicemail.c:2734 mm_log: IMAP Info: Trying IP address [74.125.53.109]
DEBUG[3293]: app_voicemail.c:2734 mm_log: IMAP Info: Gimap ready for requests 
             from 99.228.XXX.XXX 13if2973206wfc.0
DEBUG[3293]: app_voicemail.c:2757 mm_login: Entering callback mm_login
DEBUG[3293]: app_voicemail.c:2650 mm_exists: Entering EXISTS callback for message 7
DEBUG[3293]: app_voicemail.c:3074 set_update: User leif@shifteight.org mailbox set for 
update.
DEBUG[3293]: app_voicemail.c:2510 init_mailstream: Before mail_open, server: 
             {imap.gmail.com:993/imap/ssl/user=leif@shifteight.org}INBOX, box:0
DEBUG[3293]: app_voicemail.c:2734 mm_log: IMAP Info: Reusing connection to 
             gmail-imap.l.google.com/user="leif@shifteight.org"
</pre><p>If you get any <code class="literal">ERROR</code>s, check your
          configuration and verify that the IMAP library is compiled with SSL
          support. Once <code class="filename">app_voicemail.so</code>
          is connected, try leaving yourself a voicemail; then check your
          voicemail via the Gmail web interface and verify that your message
          is stored correctly. You should also have an MWI light on your
          device if it supports it, and if you’ve configured <code class="literal">mailbox=100@shifteight</code> for the device in
          <code class="filename">sip.conf</code>. If you load the
          voicemail message envelope and mark it as read, the MWI light should
          turn off within 30 seconds (or whatever value you set <code class="literal">pollfreq</code> to in <code class="filename">voicemail.conf</code>).<a id="I_indexterm18_d1e40390" class="indexterm"></a><a id="I_indexterm18_d1e40391" class="indexterm"></a><a id="I_indexterm18_d1e40392" class="indexterm"></a><a id="I_indexterm18_d1e40393" class="indexterm"></a></p></div></div></div></div><div class="sect1" title="Using XMPP (Jabber) with Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices_id286789"></a>Using XMPP (Jabber) with Asterisk</h2></div></div></div><p><a id="ExternalServices_id286795"></a><a id="index-257B545AA4E" class="indexterm"></a><a id="index-525G533QB6R" class="indexterm"></a>The eXtensible Messaging and Presence Protocol (XMPP)
    (formerly called Jabber) is used for instant messaging and communicating
    presence information across networks in near-realtime. Within Asterisk, it
    is also used for call setup (signaling). There are various cool things we
    can do with XMPP integration once it’s enabled, such as getting a message
    whenever someone calls us. We can even send messages back to Asterisk,
    redirecting our calls to voicemail or some other location. Additionally,
    with <code class="literal">chan_gtalk</code>, we can accept and
    place calls over the Google Voice network or accept calls from Google Talk
    users via the web client.</p><div class="sect2" title="Compiling Jabber Support into Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id286804"></a>Compiling Jabber Support into Asterisk</h3></div></div></div><p><a id="ExternalServices_id286809"></a><a id="I_indexterm18_d1e40414" class="indexterm"></a><a id="I_indexterm18_d1e40421" class="indexterm"></a>The <code class="literal">res_jabber</code> module
      contains various dialplan applications and functions that are useful
      from the Asterisk dialplan. It is also a dependency of the <code class="literal">chan_gtalk</code> and <code class="literal">chan_jingle</code> channel modules. To get started
      with XMPP integration in Asterisk, we need to compile <code class="literal">res_jabber</code>.</p><div class="sect3" title="CentOS dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id286815"></a>CentOS dependencies</h4></div></div></div><p><a id="ExternalServices_id286821"></a><a id="I_indexterm18_d1e40443" class="indexterm"></a>To install <code class="literal">res_jabber</code>, we need the <code class="literal">iksemel</code> development library (<a class="ulink" href="http://code.google.com/p/iksemel/" target="_top">http://code.google.com/p/iksemel/</a>). If the OpenSSL
        development library is installed, <code class="literal">res_jabber</code> will also utilize that for secure
        connections (this is recommended). We can install both on CentOS with
        the following command:</p><a id="ExternalServices_id286843"></a><pre class="screen">$ <strong class="userinput"><code>sudo yum install iksemel-devel openssl-devel</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id286835"></a>As always, be sure to append
          <code class="filename">.x86_64</code> to the module names if
          installing on a 64-bit machine.</p></div></div><div class="sect3" title="Ubuntu dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id286850"></a>Ubuntu dependencies</h4></div></div></div><p><a id="ExternalServices_id286856"></a><a id="I_indexterm18_d1e40474" class="indexterm"></a>To install <code class="literal">res_jabber</code>, we need the <code class="literal">iksemel</code> development library. If the OpenSSL
        development library is installed, <code class="literal">res_jabber</code> will also utilize that for secure
        connections (this is recommended). We can install both on Ubuntu with
        the following command:</p><a id="ExternalServices_id286861"></a><pre class="screen">$ <strong class="userinput"><code>sudo apt-get install libiksemel-dev libssl-dev</code></strong></pre></div></div><div class="sect2" title="Jabber Dialplan Commands"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id286869"></a>Jabber Dialplan Commands</h3></div></div></div><p><a id="ExternalServices_id255383"></a><a id="index-513S005UM1P" class="indexterm"></a><a id="index-553J374DB8I" class="indexterm"></a><a id="index-780L742TD4S" class="indexterm"></a><a id="index-814W382WC8E" class="indexterm"></a>Several dialplan applications and functions can be used
      for communication using the XMPP protocol via Asterisk. We’re going to
      explore how to connect Asterisk to an XMPP server, how to send messages
      to the client from the dialplan, and how to route calls based on
      responses to the initially sent messages. By sending a message via XMPP,
      we’re essentially creating a simple screen pop application to let users
      know when calls are coming to the system.</p><div class="sect3" title="Connecting to an XMPP server"><div class="titlepage"><div><div><h4 class="title"><a id="connecting_to_an_xmpp_server"></a>Connecting to an XMPP server</h4></div></div></div><p><a id="ExternalServices_id255400"></a><a id="I_indexterm18_d1e40522" class="indexterm"></a><a id="I_indexterm18_d1e40529" class="indexterm"></a><a id="I_indexterm18_d1e40534" class="indexterm"></a>Before we can start sending messages to our XMPP
        buddies, we need to connect to an XMPP-enabled server. We’re going to
        utilize the XMPP server at Google, as it is open and easily accessible
        by anyone. To do so, we need to configure the <code class="filename">jabber.conf</code> file in our <code class="filename">/etc/asterisk/</code> configuration directory. The
        following example will connect us to the XMPP server at Google.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id255415"></a>You must already have a Gmail
          account, which you can get at <a class="ulink" href="http://www.gmail.com/" target="_top">http://www.gmail.com</a>.</p></div><p><a id="ExternalServices_id255425"></a>Our <code class="filename">jabber.conf</code> file should look like
        this:</p><p><a id="ExternalServices_id255432"></a><a id="ExternalServices_id255433"></a></p><pre class="programlisting">[general]
debug=no
autoprune=no
autoregister=yes
auth_policy=accept

[asterisk]
type=client
serverhost=<em class="replaceable"><code>talk.google.com</code></em>
username=<em class="replaceable"><code>asterisk@shifteight.org</code></em>
secret=<em class="replaceable"><code>&lt;super_secret_password&gt;</code></em>
port=5222
usetls=yes
usesasl=yes
status=available
statusmessage="Ohai from Asterisk"</pre><p>Let’s take a quick look at
        some of the options we just set so you understand what is going on.
        The options are described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255450" title="Table 18.3. jabber.conf options">Table&nbsp;18.3, “jabber.conf options”</a>. Note that the first four
        options are set in the <code class="literal">[general]</code>
        section,<a id="I_indexterm18_d1e40576" class="indexterm"></a> and the others are set in the peer section.</p><div class="table"><a id="ExternalServices_id255450"></a><p class="title"><strong>Table&nbsp;18.3.&nbsp;jabber.conf options</strong></p><div class="table-contents"><table summary="jabber.conf options" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">debug</code></td><td><a id="I_indexterm18_d1e40598" class="indexterm"></a>Enables/disables XMPP message debugging (which
                can be quite verbose). Available options are <code class="literal">yes</code> or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">autoprune</code></td><td><a id="I_indexterm18_d1e40613" class="indexterm"></a>Enables/disables autoremoval of users from your
                buddy list each time <code class="filename">res_jabber.so</code> connects to your
                accounts. Do not use this for accounts you might use outside
                of Asterisk (e.g., your personal account). Available options
                are <code class="literal">yes</code> or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">autoregister</code></td><td><a id="I_indexterm18_d1e40631" class="indexterm"></a>Specifies whether to automatically register
                users from your buddy list into memory. Available options are
                <code class="literal">yes</code> or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">auth_policy</code></td><td><a id="I_indexterm18_d1e40646" class="indexterm"></a>Determines whether or not we should
                automatically accept subscription requests. Available options
                are <code class="literal">accept</code> or <code class="literal">deny</code>.</td></tr><tr><td><code class="literal">type</code></td><td><a id="I_indexterm18_d1e40661" class="indexterm"></a>Sets the type of client we will connect as.
                Available options are <code class="literal">client</code> or <code class="literal">component</code>. (You will almost always
                want <code class="literal">client</code>.)</td></tr><tr><td><code class="literal">serverhost</code></td><td><a id="I_indexterm18_d1e40679" class="indexterm"></a>Indicates which host this connection should
                connect to (e.g.,
                <span class="emphasis"><em>talk.google.com</em></span>).</td></tr><tr><td><code class="literal">username</code></td><td><a id="I_indexterm18_d1e40691" class="indexterm"></a>Provides the username that will be used to
                connect to the <code class="literal">serverhost</code>
                (e.g., <span class="emphasis"><em>asterisk@gmail.com</em></span>).</td></tr><tr><td><code class="literal">secret</code></td><td><a id="I_indexterm18_d1e40706" class="indexterm"></a>Specifies the password that will be used to
                connect to the <code class="literal">serverhost</code>.</td></tr><tr><td><code class="literal">port</code></td><td>Indicates which port we will attempt the connection to
                <code class="literal">serverhost</code> on (e.g.,
                <span class="emphasis"><em>5222</em></span>).</td></tr><tr><td><code class="literal">usetls</code></td><td><a id="I_indexterm18_d1e40730" class="indexterm"></a>Specifies whether to use TLS or not when
                connecting to <code class="literal">serverhost</code>.
                Available options are <code class="literal">yes</code>
                or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">usesasl</code></td><td><a id="I_indexterm18_d1e40748" class="indexterm"></a>Specifies whether to use SASL or not when
                connecting to <code class="literal">serverhost</code>.
                Available options are <code class="literal">yes</code>
                or <code class="literal">no</code>.</td></tr><tr><td><code class="literal">status</code></td><td><a id="I_indexterm18_d1e40767" class="indexterm"></a>Defines our default connection status when
                signed into our account. Available options are: <code class="literal">chat</code>, <code class="literal">available</code>, <code class="literal">away</code>, <code class="literal">xaway</code>, and <code class="literal">dnd</code>.</td></tr><tr><td><code class="literal">statusmessage</code></td><td><a id="I_indexterm18_d1e40791" class="indexterm"></a>Sets a custom status message to use when
                connected with Asterisk, such as <code class="literal">"Connected Via</code> <code class="literal">Asterisk"</code>. Use
                double quotes around the message.</td></tr><tr><td><code class="literal">buddy</code></td><td><a id="I_indexterm18_d1e40806" class="indexterm"></a>Used to manually add buddies to the list upon
                connection to the server. You can specify multiple buddies on
                multiple <code class="literal">buddy</code> lines (e.g.,
                <code class="literal">buddy=jim@shifteight.org</code>).</td></tr><tr><td><code class="literal">timeout</code></td><td><a id="I_indexterm18_d1e40821" class="indexterm"></a>Specifies the <code class="literal">timeout</code> (in seconds) that messages
                are stored on the message stack. Defaults to 5 seconds. This
                option only applies to incoming messages, which are intended
                to be processed by the <code class="literal">JABBER_RECEIVE()</code> dialplan
                function.</td></tr><tr><td><code class="literal">priority</code></td><td><a id="I_indexterm18_d1e40836" class="indexterm"></a>Defines the priority of this resource in
                relation to other resources. The lower the number, the higher
                the priority.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="ExternalServices_id255757"></a>After configuring our <code class="filename">jabber.conf</code> file, we can load (or reload)
        the <code class="filename">res_jabber.so</code> module. We can
        do this from the console with <span class="command"><strong>jabber
        reload</strong></span>:</p><a id="ExternalServices_id255771"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>jabber reload</code></strong>
Jabber Reloaded.</pre><p><a id="ExternalServices_id255778"></a>and check the connection with the
        <span class="command"><strong>jabber show connections</strong></span>
        command:</p><a id="ExternalServices_id255785"></a><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>jabber show connections</code></strong>
Jabber Users and their status:
       User: asterisk@shifteight.org    - Connected
----
   Number of users: 1</pre><p><a id="ExternalServices_id255793"></a>If you’re having problems getting
        connected, you can try unloading the module and then loading it back
        into memory. If you’re still having problems, you can run the <span class="command"><strong>jabber purge nodes</strong></span> command <a id="I_indexterm18_d1e40873" class="indexterm"></a><a id="I_indexterm18_d1e40876" class="indexterm"></a>to remove any existing or bad connections from memory.
        Beyond that, check your configuration and verify that you don’t have
        any configuration problems or typos. Once you’ve gotten connected, you
        can move on to the next sections, where the fun starts.</p></div><div class="sect3" title="Sending messages with JabberSend()"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id255805"></a>Sending messages with JabberSend()</h4></div></div></div><p><a id="ExternalServices_id255813"></a><a id="I_indexterm18_d1e40886" class="indexterm"></a><a id="I_indexterm18_d1e40893" class="indexterm"></a><a id="I_indexterm18_d1e40898" class="indexterm"></a><a id="I_indexterm18_d1e40903" class="indexterm"></a><a id="I_indexterm18_d1e40906" class="indexterm"></a>The <code class="literal">JabberSend()</code>
        dialplan application is used for sending messages to buddies from the
        Asterisk dialplan. You can use this application in any place that you
        would normally utilize the dialplan, which makes it quite flexible.
        We’re going to use it as a screen pop application for sending a
        message to a client prior to placing a call to the user’s phone.
        Depending on the client used, you may be able to have the message pop
        up on the user’s screen from the task bar.</p><p><a id="ExternalServices_id255828"></a>Here is a simple example to get
        us started:</p><a id="ExternalServices_id255831"></a><pre class="programlisting">[LocalSets]
exten =&gt; 104,1,Answer()

; *** This line should not have any line breaks
   same =&gt; n,<span class="emphasis"><em>JabberSend(asterisk,jim@shifteight.org,Incoming call from 
${CALLERID(all)})</em></span>

   same =&gt; n,Dial(SIP/0000FFFF0002,30)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id255841"></a>This example demonstrates how to
        use the <code class="literal">JabberSend()</code> application to
        send a message to someone prior to dialing a device. Let’s break down
        the values we’ve used. The first argument, <code class="literal">asterisk</code>, is the section header we defined
        in the <code class="filename">jabber.conf</code> file as
        <code class="literal">[asterisk]</code>. In
        our <code class="filename">jabber.conf</code> example, we set
        up a user called <span class="emphasis"><em>asterisk@shifteight.org</em></span> to send
        messages via the Google XMPP server, and <code class="literal">asterisk</code> is the section name we defined. The
        second argument, <code class="literal">jim@shifteight.org</code>, is the buddy we’re
        sending the message to. We can define any buddy here, either as a bare
        JID (as we’ve done above) or as a full JID with a resource (e.g.,
        <span class="emphasis"><em>jim@shifteight.org/laptop</em></span>). The third argument to
        <code class="literal">Jabber</code><code class="literal">Send()</code> is the message
        we want to send to the buddy. In this case we’re sending <code class="literal">Incoming call from ${CALLERID(all)}</code>, with
        the <code class="literal">CALLERID()</code> dialplan function
        being used to enter the caller ID information in the message.</p><p><a id="ExternalServices_id255893"></a>Obviously, we would have to
        further build out our dialplan to make this useful: specifically, we’d
        have to associate the buddy name (e.g., <code class="literal">jim@shifteight.org</code>) with the device we’re
        calling (<code class="literal">SIP/0000FFFF0002</code>) so that
        we’re sending the message to the correct buddy. You can save these
        associations in any one of several locations, such as the in AstDB, in
        a relational database retrieved with <code class="literal">func_odbc</code>, or even in a global
        variable.</p></div><div class="sect3" title="Receiving messages with JABBER_RECEIVE()"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id255908"></a>Receiving messages with JABBER_RECEIVE()</h4></div></div></div><p><a id="ExternalServices_id255916"></a><a id="I_indexterm18_d1e40980" class="indexterm"></a><a id="I_indexterm18_d1e40987" class="indexterm"></a><a id="I_indexterm18_d1e40992" class="indexterm"></a><a id="I_indexterm18_d1e40999" class="indexterm"></a><a id="I_indexterm18_d1e41002" class="indexterm"></a>The <code class="literal">JABBER_RECEIVE()</code>
        dialplan function allows us to receive responses via XMPP messages,
        capture those responses, and presumably act on them. We would
        typically use the <code class="literal">JABBER_RECEIVE()</code>
        function in conjunction with the <code class="literal">JabberSend()</code> dialplan application, as we are
        likely to need to send a message to someone and prompt him with the
        acceptable values he can return. We could use the <code class="literal">JABBER_RECEIVE()</code> function either personally,
        to direct calls to a particular device such as a cell phone or desk
        phone, or as a text version of an auto attendant to be used when
        people who are likely to have difficulty hearing the prompts dial in
        (e.g., users who are deaf or work at noisy job sites). In the latter
        case, the system would have to be preconfigured to know where to send
        the messages to, perhaps based on the caller ID of the person
        calling.</p><p><a id="ExternalServices_id255940"></a>Here is a simple example that
        sends a message to someone, waits for a response, and then routes the
        call based on the response:</p><p><a id="ExternalServices_id255944"></a><a id="ExternalServices_id255945"></a></p><pre class="programlisting">exten =&gt; 106,1,Answer()

   ; All text must be on a single line.
   same =&gt; n,JabberSend(asterisk,leif.madsen@gmail.com,Incoming call from
${CALLERID(all)}. Press 1 to route to desk. Press 2 to send to voicemail.)

   same =&gt; n,Set(JabberResponse=$<strong class="userinput"><code>{JABBER_RECEIVE(asterisk,leif@shifteight.org)}</code></strong>)
   same =&gt; n,GotoIf($["${JabberResponse}" = "1"]?dial,1)
   same =&gt; n,GotoIf($["${JabberResponse}" = "2"]?voicemail,1)
   same =&gt; n,Goto(dial,1)

exten =&gt; dial,1,Verbose(2,Calling our desk)
   same =&gt; n,Dial(SIP/0000FFFF0002,6)
   same =&gt; n,Goto(voicemail,1)

exten =&gt; voicemail,1,Verbose(2,VoiceMail)

; *** This line should not have any line breaks
   same =&gt; n,Set(VoiceMailStatus=${IF($[${ISNULL(${DIALSTATUS})} 
| "${DIALSTATUS}" = "BUSY"]?b:u)})

   same =&gt; n,Playback(silence/1)
   same =&gt; n,VoiceMail(100@lmentinc,${VoiceMailStatus})
   same =&gt; n,Hangup()
</pre><p><a id="ExternalServices_id255970"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id255973"></a>Unfortunately, the <code class="literal">JabberSend()</code> application requires all of
            the message to be sent on a single line. If you wish to break up
            the text onto multiple lines, you will need to send it as multiple
            messages on separate lines using <code class="literal">JabberSend()</code>.</p></div><p>Our simple dialplan first sends a message to a Jabber account
        (<span class="emphasis"><em>leif@shifteight.org</em></span>) via our systems’ Jabber
        account (<code class="literal">asterisk</code>), as configured
        in <code class="filename">jabber.conf</code>. We then use the
        <code class="literal">JABBER_RECEIVE()</code> dialplan function
        to wait for a response from <code class="filename">leif@shifteight.org</code>. The default timeout is
        5 seconds, but you can specify a different timeout with a third
        argument to <code class="literal">JABBER_RECEIVE()</code>. For
        example, to wait 10 seconds for a response, we could have used a line
        like this:</p><a id="I_programlisting18_d1e41059"></a><pre class="programlisting">Set(JabberResponse=${JABBER_RECEIVE(asterisk,leif@shifteight.org,10)})</pre><p><a id="ExternalServices_id284855"></a>Once we’ve either received a
        response or the timeout has expired, we move on to the next line of
        the dialplan, which starts checking the response saved to the <code class="literal">${Jabber</code><code class="literal">Response}</code> channel
        variable. If the value is <code class="literal">1</code>, we
        continue our dialplan at <code class="literal">dial,1</code> of
        the current context. If the response is <code class="literal">2</code>, we continue our dialplan at <code class="literal">voicemail,1</code>. If no response (or an unknown
        response) is received, we continue the dialplan at <span class="keep-together"><code class="literal">dial,1</code>.</span></p><p><a id="ExternalServices_id284878"></a>The dialplan at <code class="literal">dial,1</code> and <code class="literal">voicemail,1</code> should be fairly self-evident.
        This is a non-production example; some additional dialplan should be
        implemented to make the values dynamic.</p><p><a id="ExternalServices_id284889"></a>There is a disadvantage to the
        way we’ve implemented the <code class="literal">JABBER_RECEIVE()</code> function, though. Our
        function blocks, or waits, for a response from the endpoint. If we set
        the response value low to minimize delay, we don’t give the user we
        sent the message to much time to respond. However, if we set the
        response long enough to make it <span class="keep-together">comfortable</span> for the user to send a
        response, we cause unnecessary delay in calling a device or sending to
        voicemail.</p><p><a id="ExternalServices_id284900"></a>We can skirt around this issue by
        using a Local channel. This allows us to execute two sections of
        dialplan simultaneously, sending a call to the device at the same time
        we’re waiting for a response from <code class="literal">JABBER_RECEIVE()</code>. If we get a response from
        <code class="literal">JABBER_RECEIVE()</code> and we need to do
        something, we can <code class="literal">Answer()</code> the line
        and cause that section of dialplan to continue. If the device answers
        the phone, our dialplan with <code class="literal">JABBER_RECEIVE()</code> will just be hung up. Let’s
        take a look at a modified dialplan that implements the Local
        channel:</p><p><a id="ExternalServices_id284922"></a><a id="ExternalServices_id284923"></a></p><pre class="programlisting">exten =&gt; 106,1,Verbose(2,Example using the Local channel)
   <strong class="userinput"><code>same =&gt; n,Dial(Local/jabber@${CONTEXT}/n&amp;Local/dial@${CONTEXT}/n)</code></strong>

exten =&gt; jabber,1,Verbose(2,Send an XMPP message and expect a response)

; *** This line should not have any line breaks
   same =&gt; n,JabberSend(asterisk,leif.madsen@gmail.com,Incoming call from 
${CALLERID(all)}. Press 2 to send to voicemail.)

   same =&gt; n,Set(JabberResponse=${JABBER_RECEIVE(asterisk,leif@shifteight.org,6)})
   same =&gt; n,GotoIf($["${JabberResponse}" = "2"]?voicemail,1)
   same =&gt; n,Hangup()

exten =&gt; dial,1,Verbose(2,Calling our desk)
   same =&gt; n,Dial(SIP/0000FFFF0002,15)
   same =&gt; n,Goto(voicemail,1)

exten =&gt; voicemail,1,Verbose(2,VoiceMail)
   same =&gt; n,Answer()

; *** This line should not have any line breaks
   same =&gt; n,Set(VoiceMailStatus=${IF($[${ISNULL(${DIALSTATUS})} 
| "${DIALSTATUS}" = "BUSY"]?b:u)})

   same =&gt; n,Playback(silence/1)
   same =&gt; n,VoiceMail(100@lmentinc,${VoiceMailStatus})
   same =&gt; n,Hangup()
</pre><p>By adding a <code class="literal">Dial()</code>
        statement at the beginning and shifting our Jabber send and receive
        functionality into a new extension called <code class="literal">jabber</code>, we ensure that we can simultaneously
        call the <code class="literal">dial</code> extension and the
        <code class="literal">jabber</code> extension.</p><p><a id="ExternalServices_id284960"></a>Notice that we removed the
        <code class="literal">Answer()</code> application from the first
        line of the example. The reason for this is because we want to
        <code class="literal">Answer()</code> the line only after a
        device has answered (which causes the <code class="literal">jabber</code> extension to be hung up); otherwise,
        we want the <code class="literal">voicemail</code> extension to
        <code class="literal">Answer()</code> the line. If the <code class="literal">voicemail</code> extension has answered the line,
        that means either the <code class="literal">jabber</code>
        extension has received a response and was told to <code class="literal">Goto()</code> the <code class="literal">voicemail</code> extension, or the <code class="literal">Dial()</code> to our device timed out, causing the
        <code class="literal">voicemail</code> extension to be executed,
        thereby causing the line to be <code class="literal">Answer()</code>ed.</p><p><a id="ExternalServices_id285003"></a>With the examples provided here
        serving as a springboard, you should be able to develop rich
        applications that make use of sending and receiving messages via XMPP
        servers. Some other dialplan applications and functions exist that may
        help in the development of your application, such as <code class="literal">JABBER_STATUS()</code> (or the <code class="literal">JabberStatus()</code> dialplan application), which
        is used for checking on the status of a buddy; the <code class="literal">JabberJoin()</code> and <code class="literal">JabberLeave()</code> applications, which are used
        for joining and leaving XMPP conference rooms; and the <code class="literal">JabberSendGroup()</code> application, which allows
        you to send messages to an XMPP chat room.<a id="I_indexterm18_d1e41193" class="indexterm"></a><a id="I_indexterm18_d1e41194" class="indexterm"></a><a id="I_indexterm18_d1e41195" class="indexterm"></a><a id="I_indexterm18_d1e41196" class="indexterm"></a></p></div></div><div class="sect2" title="chan_gtalk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id285030"></a>chan_gtalk</h3></div></div></div><p><a id="ExternalServices_id285036"></a><a id="index-111T160CF6O" class="indexterm"></a><a id="index-481E574UQ0A" class="indexterm"></a><a id="index-537U633SC0G" class="indexterm"></a>The <code class="literal">chan_gtalk</code> module
      can be used for connecting to Google Talk (GTalk) clients or for sending
      and receiving calls via the Google Voice network, which is a <span class="keep-together">PSTN</span>-<span class="keep-together">connected</span> network where you can purchase
      minutes just like you would from any other ITSP. GTalk is the web-based
      voice system typically found in GMail web interfaces. Other clients and
      addons do exist for external applications such as Pidgin, but we’ll be
      testing with the web-based client from Google.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id285044"></a>As of the beginning of 2011, the
        Google Voice system can only be used in the US.</p></div><div class="sidebar" title="chan_gtalk’s Cousin, chan_jingle"><a id="ExternalServices_id285055"></a><div class="titlepage"><div><div><p class="title"><strong>chan_gtalk’s Cousin, chan_jingle</strong></p></div></div></div><p><a id="ExternalServices_id285060"></a>Another channel module that is
        similar to <code class="literal">chan_gtalk</code> exists, and
        that is <code class="literal">chan_jingle</code><a id="I_indexterm18_d1e41239" class="indexterm"></a>. Both modules utilize the same type of underlying
        system: XMPP signaling. However, the <code class="literal">chan_jingle</code> module was written long ago and
        implements a specification that is not widely supported. You may find
        the implementation of <code class="literal">chan_jingle</code>
        incompatible with many endpoints, and thus at this time you may not
        find it all that useful. However, work is being done to update
        <code class="literal">chan_jingle</code> to the current
        specifications, so it may be more useful in a future version of
        Asterisk.</p></div><p><a id="ExternalServices_id285070"></a>Before we can get connected to
      <code class="literal">chan_gtalk</code>, we need to make sure
      we’re connected via <code class="literal">res_jabber</code>, so if
      you haven’t already done so, review <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server" title="Connecting to an XMPP server">the section called “Connecting to an XMPP server”</a> for information about how to
      connect to the Google XMPP servers.</p><div class="sect3" title="Configuring gtalk.conf"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id285082"></a>Configuring gtalk.conf</h4></div></div></div><p><a id="ExternalServices_id285087"></a><a id="I_indexterm18_d1e41266" class="indexterm"></a><a id="I_indexterm18_d1e41271" class="indexterm"></a><a id="I_indexterm18_d1e41276" class="indexterm"></a>Once we’re connected via <code class="literal">res_jabber</code>, we can configure the <code class="filename">gtalk.conf</code> file, which is used for
        accepting incoming calls from the Google network. The following
        configuration enables the guest account, which is required to accept
        incoming calls. There is currently no support for authenticating
        incoming calls and then separating and sending them to different
        contexts, which you may be used to from the configuration of other
        channel drivers in Asterisk. For now <code class="literal">chan_gtalk</code> is fairly simple, but future
        versions of Asterisk may add this feature.</p><p>Our <code class="filename">gtalk.conf</code> file looks
        like this:</p><p><a id="ExternalServices_id285099"></a><a id="ExternalServices_id285100"></a></p><pre class="programlisting">[general]
bindaddr=0.0.0.0        ; Address to bind to
allowguests=yes         ; Allow calls from people not in contact list

; Optional arguments
; externip=<em class="replaceable"><code>&lt;external IP of server&gt;</code></em>
; stunaddr=<em class="replaceable"><code>&lt;stun.yourdomain.tld</code></em>&gt;

[guest]                 ; special account for options on guest account
disallow=all                            
allow=ulaw
context=gtalk_incoming
connection=asterisk     ; connection name defined in jabber.conf</pre><p>If
        your Asterisk system lives behind NAT, you may need to add some
        additional options to the <code class="literal">[general]</code>
        section in order to place the correct IP address into the headers. If
        you have a static external IP address, you can use the <code class="literal">externip</code> option to specify it.
        Alternatively, you could use the <code class="literal">stunaddr</code> option to specify the address of
        your STUN server, which will then look up your address from an
        external server and place that information into the headers.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id285131"></a>If you configure the <code class="literal">stunaddr</code> option <a id="I_indexterm18_d1e41323" class="indexterm"></a>in <code class="filename">gtalk.conf</code> and
          the lookup is successful, it will override any value specified in
          the <code class="literal">externip</code> option.</p></div><p><a id="ExternalServices_id285146"></a>Let’s discuss briefly the options
        we’ve configured in <code class="filename">gtalk.conf</code>.
        In the <code class="literal">[general]</code> section, we have
        set the <code class="literal">bindaddr</code> option to <code class="literal">0.0.0.0</code>, which means to listen on all
        interfaces.<sup>[<a id="id622471" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id622471" class="footnote">160</a>]</sup> You can also specify a single interface to listen on by
        specifying the IP address of that interface. The next line is <code class="literal">allowguests</code>, which can be set to either
        <code class="literal">yes</code> or <code class="literal">no</code> but is only useful when set to <code class="literal">yes</code>. Because the module does not offer the
        ability to specify different control mechanisms for different users,
        all users are treated as guests.<sup>[<a id="id622510" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id622510" class="footnote">161</a>]</sup></p><p><a id="ExternalServices_id285193"></a>Next we’ve specified the <code class="literal">[guest]</code> account, which will let us accept
        calls from Google Voice and Google Talk users. This account is only
        used for incoming calls. When placing outgoing calls, we’ll use the
        account specified in the <code class="filename">jabber.conf</code> file. Within the <code class="literal">[guest]</code> account, we’ve disabled all codecs
        with the <code class="literal">disallow=all</code> option, and
        then specifically enabled the ulaw codec with <code class="literal">allow=ulaw</code> on the following line. Incoming
        calls are then directed to the <code class="literal">gtalk_incoming</code> context with the <code class="literal">context</code> option. We <span class="keep-together">specify</span> which account calls will be
        coming from with the <code class="literal">connection</code>
        option, which we’ve set to the account created in <code class="filename">jabber.conf</code>.</p><p><a id="ExternalServices_id285240"></a>The <code class="literal">chan_gtalk</code> module does not support reloading
        the configuration. If you change the configuration, you will have to
        either restart Asterisk or unload and reload the module, which can
        only be done when no GTalk calls are up. You can do that using the
        following commands:</p><p><a id="ExternalServices_id285247"></a><a id="ExternalServices_id285248"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module unload chan_gtalk.so</code></strong>
<code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module load chan_gtalk.so</code></strong></pre></div><div class="sect3" title="Accepting calls from Google Talk"><div class="titlepage"><div><div><h4 class="title"><a id="accepting_calls_from_google_talk"></a>Accepting calls from Google Talk</h4></div></div></div><p><a id="ExternalServices_id285264"></a><a id="I_indexterm18_d1e41425" class="indexterm"></a><a id="I_indexterm18_d1e41428" class="indexterm"></a><a id="I_indexterm18_d1e41433" class="indexterm"></a>To allow calls from other Google Talk users, we need to
        configure our dialplan to accept incoming calls. Inside your <code class="filename">extensions.conf</code> file, add the <code class="literal">[gtalk_incoming]</code> context:</p><p><a id="ExternalServices_id285275"></a><a id="ExternalServices_id285276"></a></p><pre class="programlisting">[gtalk_incoming]
exten =&gt; s,1,Verbose(2,Incoming Gtalk call from ${CALLERID(all)})
   same =&gt; n,Answer()
   same =&gt; n,Dial(SIP/0000FFFF0001,30)
   same =&gt; n,Hangup()</pre><p>We’ve now configured a simple test
        dialplan that will send calls to the <code class="literal">SIP/0000FFFF0001</code> device and wait 30 seconds
        before hanging up the line. The <code class="literal">s</code>
        extension can be used to match any incoming call from Google Talk or
        Google Voice, but if you have multiple accounts that could be coming
        into this context, you can match different users by specifying the
        username portion of the Gmail email address as the extension. So, for
        example, if we had a user
        <span class="emphasis"><em>my_asterisk_user@gmail.com</em></span>, the username portion
        would be <code class="literal">my_asterisk_user</code>, and this
        is what we’d specify in <code class="literal">[gtalk_incoming]</code>:</p><p><a id="ExternalServices_id285301"></a><a id="ExternalServices_id285302"></a></p><pre class="programlisting">[gtalk_incoming]
exten =&gt; my_asterisk_user,1,Verbose(2,Gtalk call from ${CALLERID(all)})
   same =&gt; n,Answer()
   same =&gt; n,Dial(SIP/0000FFFF0001,3)
   same =&gt; n,Hangup()</pre><p>The order of rules used for matching
        incoming calls to <code class="literal">chan_gtalk</code>
        is:</p><div class="orderedlist"><a id="ExternalServices_id285310"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="ExternalServices_id285312"></a><a id="ExternalServices_id285314"></a>Match the username portion of
            the Gmail account in the context specified for the <code class="literal">[guest]</code> account.</p></li><li class="listitem"><p><a id="ExternalServices_id285323"></a><a id="ExternalServices_id285325"></a>Match the <code class="literal">s</code> extension in the context specified for
            the <code class="literal">[guest]</code> account.</p></li><li class="listitem"><p><a id="ExternalServices_id285336"></a><a id="ExternalServices_id285338"></a>Match the <code class="literal">s</code> extension in the <code class="literal">[default]</code> context.</p></li></ol></div></div><div class="sect3" title="Accepting calls from Google Voice"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id285352"></a>Accepting calls from Google Voice</h4></div></div></div><p><a id="ExternalServices_id285357"></a><a id="I_indexterm18_d1e41502" class="indexterm"></a><a id="I_indexterm18_d1e41505" class="indexterm"></a><a id="I_indexterm18_d1e41510" class="indexterm"></a>The configuration for accepting calls from Google Voice
        is similar (if not identical) to that for Google Talk, which we set up
        in the preceding section. A little tip, though, is that sometimes you
        can’t disable the call screening functionality (for some reason we
        still got it even when we’d disabled it in the Google Voice control
        panel). If you run into this problem but don’t want to have to screen
        your calls, you can automatically send the DTMF prior to ringing your
        device by adding the two boldface lines shown here prior to performing
        the <code class="literal">Dial()</code>:</p><a id="ExternalServices_id285371"></a><pre class="programlisting">[gtalk_incoming]
exten =&gt; s,1,Verbose(2,Incoming call from ${CALLERID(all)})
   same =&gt; n,Answer()
<strong class="userinput"><code>   same =&gt; n,Wait(2)
   same =&gt; n,SendDTMF(2)</code></strong>
   same =&gt; n,Dial(SIP/0000FFFF0001,30)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id285381"></a>Here, we’re using the <code class="literal">Wait()</code> and <code class="literal">SendDTMF()</code> applications to first wait 2
        seconds after answering the call (which is the time when the call
        screening message will start) and then accept the call automatically
        (by sending DTMF tones for the number 2). After that, we then send the
        call off to our device.</p></div><div class="sect3" title="Outgoing calls via Google Talk"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id285398"></a>Outgoing calls via Google Talk</h4></div></div></div><p><a id="ExternalServices_id285404"></a><a id="I_indexterm18_d1e41538" class="indexterm"></a><a id="I_indexterm18_d1e41541" class="indexterm"></a><a id="I_indexterm18_d1e41546" class="indexterm"></a>To place a call to a Google Talk user, configure your
        dialplan like so:</p><p><a id="ExternalServices_id285408"></a><a id="ExternalServices_id285409"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 123,1,Verbose(2,Extension 123 calling some_user@gmail.com)
   same =&gt; n,Dial(Gtalk/asterisk/some_user@gmail.com,30)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id285414"></a>The <code class="literal">Gtalk/asterisk/some_user@gmail.com</code> part of
        the <code class="literal">Dial()</code> line can be broken into
        three parts. The first part, <code class="literal">Gtalk</code>,
        is the protocol we’re using for placing the outgoing call. The second
        part, <code class="literal">asterisk</code>, is the account name
        as defined in the <code class="filename">jabber.conf</code>
        file. The last part, <code class="literal">some_user@gmail.com</code>, is the location we’re
        attempting to place a call to.</p></div><div class="sect3" title="Outgoing calls via Google Voice"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id285441"></a>Outgoing calls via Google Voice</h4></div></div></div><p><a id="ExternalServices_id285447"></a><a id="I_indexterm18_d1e41582" class="indexterm"></a><a id="I_indexterm18_d1e41585" class="indexterm"></a><a id="I_indexterm18_d1e41590" class="indexterm"></a>To place calls using Google Voice to PSTN numbers,
        create a dialplan like the following:</p><a id="ExternalServices_id285451"></a><pre class="programlisting">[LocalSets]
exten =&gt; _1NXXNXXXXXX,1,Verbose(2,Placing call to ${EXTEN} via Google Voice)
   same =&gt; n,Dial(Gtalk/asterisk/+${EXTEN}@voice.google.com)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id285456"></a>Let’s discuss the <code class="literal">Dial()</code> line briefly, so you understand what
        is going on. We start with <code class="literal">Gtalk</code>,
        which is the technology we’ll use to place the call. Following that,
        we have defined the <code class="literal">asterisk</code> user
        as the account we’ll use to authenticate with when placing our
        outgoing call (this is configured in <code class="filename">jabber.conf</code>). Next is the number we’re
        attempting to place a call to, as defined in the <code class="literal">${EXTEN}</code> channel variable. We’ve prefixed
        the <code class="literal">${EXTEN}</code>
        channel variable with a plus sign (<code class="literal">+</code>), as it’s required by the Google network
        when placing calls. We’ve also appended <code class="literal">@voice.google.com</code> to let the Google servers
        know this is a call that should be placed through Google
        Voice<sup>[<a id="id623266" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id623266" class="footnote">162</a>]</sup> as opposed to to another Google Talk user.<a id="I_indexterm18_d1e41631" class="indexterm"></a><a id="I_indexterm18_d1e41632" class="indexterm"></a><a id="I_indexterm18_d1e41633" class="indexterm"></a><a id="I_indexterm18_d1e41635" class="indexterm"></a><a id="I_indexterm18_d1e41636" class="indexterm"></a></p></div></div></div><div class="sect1" title="Skype Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices_id291565"></a>Skype Integration</h2></div></div></div><p><a id="ExternalServices_id291570"></a><a id="index-824T560PF5P" class="indexterm"></a><a id="index-723I073GC7S" class="indexterm"></a>Skype integration now exists with Asterisk through a
    commercial module from Digium called Skype for Asterisk (SFA).<sup>[<a id="id623392" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id623392" class="footnote">163</a>]</sup> The SFA module loads directly into Asterisk and allows
    communication with all users on the Skype network directly by using an
    account created on the Skype Manager. Previous methods were messy,
    requiring the use of a Windows-based computer running another instance of
    Skype controlled via an API (application programming interface) and
    directing media to a sound card and into Asterisk via <code class="literal">chan_oss</code> or <code class="literal">chan_alsa</code>. Now, two methods exist: SFA and Skype
    Connect (formerly known as Skype for SIP).</p><p><a id="ExternalServices_id36057647"></a>As an Asterisk module, Skype for
    Asterisk does have some features that Skype Connect does not, including
    text chat, presence updates, and the ability to call a Skype user directly
    rather an via SkypeIn number. Additionally, Skype for Asterisk utilizes
    Skype’s encryption for calls, which provides security benefits without the
    need to use SRTP (secure RTP) with SIP.</p><div class="sect2" title="Installation of Skype for Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id36057654"></a>Installation of Skype for Asterisk</h3></div></div></div><p><a id="ExternalServices_id36057659"></a><a id="I_indexterm18_d1e41666" class="indexterm"></a><a id="I_indexterm18_d1e41673" class="indexterm"></a><a id="I_indexterm18_d1e41678" class="indexterm"></a>Since Skype for Asterisk is a commercial product,
      documentation for installing and configuring the module is available
      from Digium directly. For the most up-to-date installation documentation
      and information about the Skype for Asterisk module, see <a class="ulink" href="http://www.digium.com/en/products/software/skypeforasterisk.php" target="_top">http://www.digium.com/en/products/software/skypeforasterisk.php</a>.</p><p><a id="ExternalServices_id36057671"></a>You can download the modules from
      <a class="ulink" href="http://downloads.digium.com/pub/telephony/skypeforasterisk" target="_top">http://downloads.digium.com/pub/telephony/skypeforasterisk</a>,
      and the registration utility for registering commercial modules from
      Digium is available at <a class="ulink" href="http://downloads.digium.com/pub/register" target="_top">http://downloads.digium.com/pub/register</a>.</p></div><div class="sect2" title="Using Skype for Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id36057688"></a>Using Skype for Asterisk</h3></div></div></div><p><a id="ExternalServices_id36057694"></a><a id="index-042W787KU1A" class="indexterm"></a><a id="index-623E158MC5K" class="indexterm"></a><a id="index-406P764RG8L" class="indexterm"></a>In this section we’ll explore the various ways we can
      utilize Skype from our dialplan, such as sending calls to and receiving
      calls from users on the Skype network and exchanging messages with our
      Skype buddies. We’ll also show you how to implement a clever dialplan
      that will make it easier to call your friends on the Skype network
      without having to assign everyone an extension number.</p><div class="sect3" title="Configuring chan_skype.conf"><div class="titlepage"><div><div><h4 class="title"><a id="configuring_chan_skype"></a>Configuring chan_skype.conf</h4></div></div></div><p><a id="ExternalServices_id36057709"></a><a id="I_indexterm18_d1e41718" class="indexterm"></a><a id="I_indexterm18_d1e41725" class="indexterm"></a><a id="I_indexterm18_d1e41732" class="indexterm"></a><a id="I_indexterm18_d1e41737" class="indexterm"></a><a id="I_indexterm18_d1e41740" class="indexterm"></a>While the <code class="filename">README</code>
        file that comes with the Skype module helps to document <span class="keep-together">the <code class="filename">chan_skype.conf</code></span> configuration, and
        the sample <code class="filename">chan_skype.conf</code> file
        is well-<span class="keep-together">documented</span>, it is worth
        showing a simple version of the configuration for the purposes of
        documenting the usage of Skype from the dialplan.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id332615"></a>Users <a id="I_indexterm18_d1e41764" class="indexterm"></a>configured in <code class="filename">chan_skype.conf</code> must be created with
            the Skype Manager interface. Personal Skype IDs are not
            allowed.</p></div><p><a id="ExternalServices_id36057724"></a>Our example Skype user will be
        <span class="emphasis"><em>pbx.shifteight.org</em></span>. We’ll configure this user in
        <code class="filename">chan_skype.conf</code>. There are
        additional options that could be set here, but for our purposes we’re
        keeping it simple:</p><p><a id="ExternalServices_id36057735"></a><a id="ExternalServices_id36057736"></a></p><pre class="programlisting">[general]
default_user=pbx.shifteight.org

[pbx.shifteight.org]
secret=my_secret_pass
context=skype_incoming
exten=start
buddy_autoadd=true</pre><p>The <code class="literal">default_user</code> option in the <code class="literal">[general]</code> section is used to control which
        account we should use when placing calls via Skype. If we had multiple
        accounts, the <code class="literal">default_user</code> would be
        used when placing calls unless we specified a different user to place
        the call as (we’ll discuss this further in the next section).</p><p><a id="ExternalServices_id36057754"></a>We’ve also defined the password
        (<code class="literal">secret</code>), the <code class="literal">context</code> incoming calls will enter into, and
        the extension (<code class="literal">exten</code>) that will be
        executed within the context. If we had multiple Skype users and wanted
        to control all of them from the same context, we could <span class="keep-together">give them each</span> different extension
        values, such as <code class="literal">exten=leifmadsen</code> or
        <code class="literal">exten=</code><code class="literal">russellbryant</code>.</p><p><a id="ExternalServices_id36057605"></a>Additionally, we’ve enabled the
        ability to automatically add people who contact us to our buddies
        list.</p></div><div class="sect3" title="Placing and receiving calls via Skype"><div class="titlepage"><div><div><h4 class="title"><a id="placing_and_receiving_calls_via_skype"></a>Placing and receiving calls via Skype</h4></div></div></div><p><a id="ExternalServices_id36057617"></a><a id="I_indexterm18_d1e41823" class="indexterm"></a><a id="I_indexterm18_d1e41830" class="indexterm"></a>Placing a call to a Skype buddy is relatively
        straightforward. Like with other channel types in Asterisk, the
        <code class="literal">Skype</code> channel type is used to place
        calls to endpoints on the Skype network.</p><p><a id="ExternalServices_id36057626"></a>Utilizing the <code class="literal">Dial()</code> application from the dialplan, we can
        place calls to other Skype users:</p><p><a id="ExternalServices_id36057634"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 100,1,Answer()
   same =&gt; n,Dial(Skype/vuc.me,30)
   same =&gt; n,Playback(silence/1&amp;user&amp;is-curntly-unavail)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id36057633"></a>Our dialplan simply answers the
        call and attempts to place a call to
        <span class="emphasis"><em>vuc.me</em></span>,<sup>[<a id="id623980" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id623980" class="footnote">164</a>]</sup> wait 30 seconds for that user to answer, and, if there
        is no answer, play back a message saying that the user is currently
        unavailable before hanging up. We could, of course, be more elaborate
        with our dialplan; for example, we could turn this into a <code class="literal">Macro()</code> or <code class="literal">GoSub()</code> routine so we just needed to pass in
        the name of the person we wish to call.</p><p><a id="ExternalServices_id36057518"></a>Unfortunately, if you’re
        utilizing a device that only has a number pad for dialing, you’ll need
        to assign extension numbers to all your favorite Skype buddies.
        However, we’ve come up with a clever way of reading back your online
        buddies to you, which we’ll describe in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens" title="Calling your Skype buddies without assigning extension numbers">the section called “Calling your Skype buddies without assigning extension
        numbers”</a>.</p><p><a id="ExternalServices_id36057528"></a>If you have a softphone,
        though, you should have the ability to place calls by dialing names
        directly. We can use this to our advantage by creating a pattern match
        in our dialplan with the prefix of <code class="literal">SKYPE</code>:</p><p><a id="ExternalServices_id36057533"></a><a id="ExternalServices_id36057534"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; _SKYPE-.,1,Verbose(2,Dialing via Skype)
   same =&gt; n,Set(NameToDial=${FILTER(a-zA-Z0-9.,${EXTEN:6})})
   same =&gt; n,Playback(silence/1&amp;pls-wait-connect-call)
   same =&gt; n,Dial(Skype/${NameToDial},30)
   same =&gt; n,Playback(user&amp;is-curntly-unavail)
   same =&gt; n,Hangup()</pre><p>By dialing <code class="literal">SKYPE-vuc.me</code>, we can dial the VoIP Users
        Conference via Skype from our softphone. The <code class="literal">FILTER()</code> function is used here to control
        what we’re allowed to pass to the <code class="literal">Dial()</code> application. If we didn’t do any
        filtering, someone could potentially send a string like <code class="literal">SKYPE-nobody&amp;SIP/my_itsp/<em class="replaceable"><code>4165551212</code></em></code>,
        replacing the number <em class="replaceable"><code>4165551212</code></em> with a
        number that is very expensive to call. By using <code class="literal">FILTER()</code>, we restrict the allowable
        characters to alphanumeric characters and periods.</p><p><a id="ExternalServices_id36057566"></a>After that, we’re simply
        passing the string to the <code class="literal">Dial()</code>
        application and waiting for an answer for 30 seconds. If no one
        answers, an audio message is played back to the caller stating that
        the user is unavailable and then the call is hung up.</p><p><a id="ExternalServices_id36057575"></a>To receive calls, you simply
        need to configure your user in the <code class="filename">chan_skype.conf</code> file as described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype" title="Configuring chan_skype.conf">the section called “Configuring chan_skype.conf”</a>. Once you’ve done that, you can
        configure your dialplan to answer calls like so:</p><p><a id="ExternalServices_id36057587"></a><a id="ExternalServices_id36057588"></a></p><pre class="programlisting">[skype_incoming]
exten =&gt; start,1,Verbose(2,Incoming Skype Call)
   same =&gt; n,Answer()
   same =&gt; n,Dial(SIP/0000FFFF0001,30)
   same =&gt; n,Playback(user&amp;is-curntly-unavail)
   same =&gt; n,Hangup()</pre><p>Obviously, you can change this
        section of the dialplan to be more elaborate; all we’ve done is
        configured the dialplan to call our SIP device at <code class="literal">0000FFFF0001</code>, wait for an answer for 30
        seconds, and then (if there is no answer or the device is busy or
        unavailable) play back a prompt that says the user is currently
        unavailable, followed by a hangup.</p><p><a id="ExternalServices_id36057288"></a>We’ve just shown you how to
        place and receive calls via Skype. The following sections will show
        you how to send and receive messages via the Skype network, and how to
        place calls to your Skype buddies without assigning extension numbers
        to them.</p></div><div class="sect3" title="Sending and receiving messages via Skype"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36057295"></a>Sending and receiving messages via Skype</h4></div></div></div><p><a id="ExternalServices_id36057300"></a><a id="I_indexterm18_d1e41927" class="indexterm"></a><a id="I_indexterm18_d1e41934" class="indexterm"></a>Sending and receiving messages via Skype is similar to
        doing this via XMPP (Jabber), which we described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805" title="Sending messages with JabberSend()">the section called “Sending messages with JabberSend()”</a> and <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908" title="Receiving messages with JABBER_RECEIVE()">the section called “Receiving messages with JABBER_RECEIVE()”</a>, so we won’t go into quite the
        detail in these sections as we did there. Please review the sections
        about XMPP messaging before continuing, as we’ll be using the same
        basic dialplans to accomplish sending and receiving of messages via
        Skype, while making adjustments to use the appropriate dialplan
        applications and functions.</p><p><a id="ExternalServices_id36057316"></a>The primary thing to remember
        is that messages are sent with the dialplan application <code class="literal">SkypeChatSend()</code> <a id="I_indexterm18_d1e41951" class="indexterm"></a><a id="I_indexterm18_d1e41954" class="indexterm"></a>and received with the dialplan function <code class="literal">SKYPE_CHAT_RECEIVE()</code><a id="I_indexterm18_d1e41962" class="indexterm"></a><a id="I_indexterm18_d1e41965" class="indexterm"></a>. Additionally, messages can only be received when the
        <code class="literal">SKYPE_CHAT_RECEIVE()</code> function has
        been called from the dialplan, and it blocks (does not continue in the
        dialplan) while waiting for a message.</p><p><a id="ExternalServices_id36057331"></a>Sending a message from the
        dialplan to a Skype buddy is relatively straightforward. Here is a
        simple dialplan we can use to send a message from Asterisk to someone
        on the Skype network:</p><a id="ExternalServices_id36057336"></a><pre class="programlisting">[LocalSets]
exten =&gt; 104,1,Answer()

; *** This line should not have any line breaks
   same =&gt; n,<strong class="userinput"><code>SkypeChatSend(pbx.shifteight.org,tfot.madsen,Incoming call from 
${CALLERID(all)})</code></strong>

   same =&gt; n,Dial(SIP/0000FFFF0002,30)
   same =&gt; n,Hangup()</pre><p><a id="ExternalServices_id36057346"></a>Our dialplan is simple. We
        created a test extension of <code class="literal">104</code>
        that answers the line, then sends a message to Skype user <code class="literal">tfot.madsen</code> from the <code class="literal">pbx.shifteight.org</code> account (which we
        configured in the <code class="filename">chan_skype.conf</code>
        file). The message sent is “Incoming call from ${CALLERID(all)}”,
        where the caller ID is provided by the <code class="literal">CALLERID()</code> function.<a id="I_indexterm18_d1e41999" class="indexterm"></a><a id="I_indexterm18_d1e42002" class="indexterm"></a> After sending our message, we then dial the device
        located at <code class="literal">0000FFFF0002</code> and hang up
        if no one answers within 30 seconds.</p><p><a id="ExternalServices_id36057368"></a>That’s it for sending messages
        via Skype. Now let’s look at some of the ways we can receive messages
        from Skype. Here is the simple example we explored in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908" title="Receiving messages with JABBER_RECEIVE()">the section called “Receiving messages with JABBER_RECEIVE()”</a>), with a few changes made to
        reflect the technology. This time, we’ll be replacing <code class="literal">JabberSend()</code> and <code class="literal">JABBER_RECEIVE()</code> with the <code class="literal">SkypeChatSend()</code> and <code class="literal">SKYPE_CHAT_RECEIVE()</code> dialplan application
        and function, <span class="keep-together">respectively</span>:</p><a id="ExternalServices_id36057394"></a><pre class="programlisting">exten =&gt; 106,1,Answer()

   ; All text must be on a single line.
   same =&gt; n,SkypeChatSend(pbx.shifteight.org,tfot.madsen,Incoming call from
${CALLERID(all)}. Press 1 to route to desk. Press 2 to send to voicemail.)

   ; Wait for a response for 6 seconds.
   ; *** This line should not have any line breaks
   <span class="emphasis"><em>same =&gt; n,Set(SkypeResponse=<strong class="userinput"><code>
${SKYPE_CHAT_RECEIVE(pbx.shifteight.org,tfot.madsen,6)}</code></strong>)</em></span>

   same =&gt; n,GotoIf($["${SkypeResponse}" = "1"]?dial,1)
   same =&gt; n,GotoIf($["${SkypeResponse}" = "2"]?voicemail,1)
   same =&gt; n,Goto(dial,1)

exten =&gt; dial,1,Verbose(2,Calling our desk)
   same =&gt; n,Dial(SIP/0000FFFF0002,6)
   same =&gt; n,Goto(voicemail,1)

exten =&gt; voicemail,1,Verbose(2,VoiceMail)

; *** This line should not have any line breaks
   same =&gt; n,Set(VoiceMailStatus=${IF($[${ISNULL(${DIALSTATUS})} 
| "${DIALSTATUS}" = "BUSY"]?b:u)})

   same =&gt; n,Playback(silence/1)
   same =&gt; n,VoiceMail(100@lmentinc,${VoiceMailStatus})
   same =&gt; n,Hangup()
</pre><p><a id="ExternalServices_id36057411"></a>There you have it—sending and
        receiving messages via the Skype network! </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id337985"></a>You can also send and receive
            messages with the Asterisk Manager Interface, the topic of Chapter
            <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">20</a>.</p></div><p>We’ve essentially implemented a screen pop solution for
        incoming calls, but by allowing messages to be sent back to Asterisk
        via Skype within a defined period of time, we’ve also created a
        solution for redirecting calls prior to ringing any devices. A more
        functional version of the dynamic routing dialplan we just explored
        was developed in the section about <code class="literal">JABBER_RECEIVE()</code> earlier in this chapter: it
        used the Local channel to get around the dialplan blocking issue,
        enabling calls can be routed even after a device has started to be
        rung.</p></div><div class="sect3" title="Calling your Skype buddies without assigning extension numbers"><div class="titlepage"><div><div><h4 class="title"><a id="calling_skype_buddies_without_extens"></a>Calling your Skype buddies without assigning extension
        numbers</h4></div></div></div><p><a id="ExternalServices_id36057432"></a><a id="I_indexterm18_d1e42054" class="indexterm"></a><a id="I_indexterm18_d1e42061" class="indexterm"></a>While working on this book, we had some issues with
        trying to come up with clever ways to use a text-to-speech engine. It
        seemed that dynamic data would need to be involved for text-to-speech
        to really make a lot of sense—otherwise, why not use prerecorded
        prompts instead? However, an idea finally came to us, based on the
        fact that having to assign extension numbers to each Skype user we
        wanted to call was not only cumbersome, but was a mental exercise we
        weren’t willing to take on.</p><p><a id="ExternalServices_id36057440"></a>The following dialplan makes
        use of the <code class="literal">SKYPE_BUDDIES()</code><a id="I_indexterm18_d1e42073" class="indexterm"></a><a id="I_indexterm18_d1e42076" class="indexterm"></a> and <code class="literal">SKYPE_BUDDY_FETCH()</code> <span class="keep-together">dialplan</span> functions<a id="I_indexterm18_d1e42088" class="indexterm"></a><a id="I_indexterm18_d1e42091" class="indexterm"></a> to retrieve all the Skype buddies in memory on the
        server, and to read those buddies’ names back to you along with their
        statuses. After each buddy name is read, a prompt asking if this is
        who you wish to call is presented, with the option of asking for
        another buddy from the list. We’ve utilized the <code class="literal">Festival()</code> application <a id="I_indexterm18_d1e42101" class="indexterm"></a><a id="I_indexterm18_d1e42104" class="indexterm"></a>for this example (the configuration and setup of which
        can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626" title="Festival">the section called “Festival”</a>) to read
        back the users’ names. Once a buddy has been marked as selected, it is
        then dialed using the <code class="literal">Dial()</code>
        application.<a id="I_indexterm18_d1e42115" class="indexterm"></a><a id="I_indexterm18_d1e42120" class="indexterm"></a></p><p><a id="ExternalServices_id36057469"></a>Our implementation is as
        follows:<a id="I_indexterm18_d1e42125" class="indexterm"></a><a id="I_indexterm18_d1e42126" class="indexterm"></a><a id="I_indexterm18_d1e42127" class="indexterm"></a><a id="I_indexterm18_d1e42128" class="indexterm"></a><a id="I_indexterm18_d1e42129" class="indexterm"></a></p><p><a id="ExternalServices_id36057472"></a><a id="ExternalServices_id36057473"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 75973,1,Verbose(2,Read off list of Skype accounts)
   same =&gt; n,Answer()
   same =&gt; n,Set(ID=${SKYPE_BUDDIES(<em class="replaceable"><code>pbx.shifteight.org</code></em>)})
   same =&gt; n(new_buddy),Set(ARRAY(buddy,status)=${SKYPE_BUDDY_FETCH(${ID})})
   same =&gt; n,GotoIf($[${ISNULL(${buddy})}]?no_more_buddies)
   <span class="emphasis"><em>same =&gt; n,Festival(${buddy} is ${status})</em></span>
   same =&gt; n,Read(Answer,if-correct-press&amp;digits/1&amp;otherwise-press&amp;digits/2,1)
   same =&gt; n,GotoIf($[${Answer} = 2]?new_buddy)
   same =&gt; n,Dial(Skype/${buddy},30)
   same =&gt; n,Playback(user&amp;is-curntly-unavail)
   same =&gt; n,Hangup()

exten =&gt; no_more_buddies,1,Verbose(2,No more buddies to find)
   same =&gt; n,Playback(dir-nomore)
   same =&gt; n,Hangup()
</pre></div></div></div><div class="sect1" title="LDAP Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices_id291590"></a>LDAP Integration</h2></div></div></div><p><a id="ExternalServices_id291595"></a><a id="index-011L423RQ6J" class="indexterm"></a><a id="index-881P116ED4V" class="indexterm"></a>Asterisk supports the ability to connect to an existing
    Lightweight Directory Access Protocol (LDAP) server to load information
    into your Asterisk server using the Asterisk Realtime Architecture (ARA).
    The advantage of integrating Asterisk and LDAP will become immediately
    obvious when you start centralizing your authentication mechanisms to the
    LDAP server and utilizing it for several applications: you significantly
    cut down the administrative overhead of managing your users by placing all
    their information into a central location.</p><p><a id="ExternalServices_id291603"></a>There are both commercial and open
    source LDAP servers available, the most popular commercial solution likely
    being that implemented by Microsoft Windows servers. A popular open source
    LDAP server is OpenLDAP (<a class="ulink" href="http://www.openldap.org/" target="_top">http://www.openldap.org</a>).
    We will not delve into the configuration of the LDAP server here, but we
    will show you the schema required to connect Asterisk to your server and
    to use it to provide SIP connections and voicemail service to your
    existing user base.</p><div class="sect2" title="Configuring OpenLDAP"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id200106"></a>Configuring OpenLDAP</h3></div></div></div><p><a id="ExternalServices_id200111"></a><a id="I_indexterm18_d1e42160" class="indexterm"></a><a id="I_indexterm18_d1e42167" class="indexterm"></a><a id="I_indexterm18_d1e42172" class="indexterm"></a><a id="I_indexterm18_d1e42175" class="indexterm"></a>While a discussion of the installation and configuration
      of an LDAP server is beyond the scope of this chapter, it is certainly
      applicable to show you how we expanded our initial LDAP schema to
      include the information required for Asterisk integration. Our initial
      installation followed instructions from the Ubuntu documentation page
      located at <a class="ulink" href="https://help.ubuntu.com/10.04/serverguide/C/openldap-server.html" target="_top">https://help.ubuntu.com/10.04/serverguide/C/openldap-server.html</a>.
      We only needed to follow the instructions up to and including the
      <code class="filename">backend.example.com.ldif</code> import;
      the next step after importing the backend configuration is installing
      the Asterisk-related schemas.</p><p><a id="ExternalServices_id200129"></a>If you’re following along, with the
      backend imported, change into your Asterisk source directory. Then copy
      the <code class="filename">asterisk.ldap-schema</code> file into
      the <code class="filename">/etc/ldap/schema/</code>
      directory:</p><p><a id="ExternalServices_id200140"></a><a id="ExternalServices_id200141"></a></p><pre class="screen">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8/contrib/scripts/</code></strong>
$ <strong class="userinput"><code>sudo cp asterisk.ldap-schema /etc/ldap/schema/asterisk.schema</code></strong></pre><p>With
      the schema file copied in, restart the OpenLDAP server:</p><p><a id="ExternalServices_id203207"></a><a id="ExternalServices_id203208"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo /etc/init.d/slapd restart</code></strong></pre><p>Now
      we’re ready to import the contents of <code class="filename">asterisk.ldif</code> into our OpenLDAP server. The
      <code class="filename">asterisk.ldif</code> file is located in
      the <code class="filename">contrib/scripts/</code> folder of the
      Asterisk source directory:</p><p><a id="ExternalServices_id203223"></a><a id="ExternalServices_id203224"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo ldapadd -Y EXTERNAL -H ldapi:/// -f asterisk.ldif</code></strong></pre><p><a id="ExternalServices_id203229"></a>We can now continue with the
      instructions at <a class="ulink" href="https://help.ubuntu.com/10.04/serverguide/C/openldap-server.html" target="_top">https://help.ubuntu.com/10.04/serverguide/C/openldap-server.html</a>
      and import the <code class="filename">frontend.example.com.ldif</code> file. Within that
      file is an initial user, which we can omit for now as we’re going to
      modify the user import portion to include an <code class="literal">objectClass</code> for Asterisk (i.e., in the example
      file, the section of text that starts with <code class="literal">uid=john</code> can be deleted).</p><p><a id="ExternalServices_id203249"></a>We’re going to create a user and
      add the configuration values that will allow the user to register his
      phone (which will likely be a softphone, since the hardphone on the
      user’s desk will, in most cases, be configured from a central location)
      via SIP by using his username and password, just as he would normally
      log in to check email and such.</p><p><a id="ExternalServices_id203256"></a>The configuration file we’ll create
      next will get imported with the <span class="command"><strong>ldapadd</strong></span> command <a id="I_indexterm18_d1e42243" class="indexterm"></a><a id="I_indexterm18_d1e42246" class="indexterm"></a>and will be added into the <code class="literal">people</code> object unit within the
      <span class="emphasis"><em>shifteight.org</em></span> space. Be sure to change the values
      to match those of the user you wish to set up in LDAP and to substitute
      <code class="literal">dc=shifteight,dc=org</code> with your own
      location.</p><p><a id="ExternalServices_id203275"></a>Before we create our file, though,
      we need to convert the password into an MD5 hash. Asterisk will not
      authenticate phones using plain-text passwords when connecting via LDAP.
      We can convert the password using the <span class="command"><strong>md5sum</strong></span> command:<a id="I_indexterm18_d1e42266" class="indexterm"></a><a id="I_indexterm18_d1e42271" class="indexterm"></a></p><p><a id="ExternalServices_id203283"></a><a id="ExternalServices_id203284"></a></p><pre class="screen">$ <strong class="userinput"><code>echo "my_secret_password" | md5sum</code></strong><code class="computeroutput">
a7be810a28ca1fc0668effb4ea982e58  -</code></pre><p>We’ll insert the returned value (without the hyphen) into the
      following file within the <code class="literal">userPassword</code> field, prefixed with <code class="literal">{md5}</code>:</p><p><a id="ExternalServices_id203305"></a><a id="ExternalServices_id203306"></a></p><pre class="screen">$ <strong class="userinput"><code>cat &gt; astuser.ldif

</code></strong><strong class="userinput"><code>dn: uid=rbryant,ou=people,dc=shifteight,dc=org
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
objectClass: AsteriskSIPUser
uid: rbryant
sn: Bryant
givenName: Russell
cn: RussellBryant
displayName: Russell Bryant
uidNumber: 1001
gidNumber: 10001
userPassword: {md5}a7be810a28ca1fc0668effb4ea982e58
gecos: Russell Bryant
loginShell: /bin/bash
homeDirectory: /home/russell
shadowExpire: -1
shadowFlag: 0
shadowWarning: 7
shadowMin: 8
shadowMax: 999999
shadowLastChange: 10877
mail: russell.bryant@shifteight.org
postalCode: 31000
l: Huntsville
o: shifteight
title: Asterisk User
postalAddress:
initials: RB
AstAccountCallerID: Russell Bryant
AstAccountContext: LocalSets
AstAccountDTMFMode: rfc2833
AstAccountMailbox: 101@shifteight
AstAccountNAT: yes
AstAccountQualify: yes
AstAccountType: friend
AstAccountDisallowedCodec: all
AstAccountAllowedCodec: ulaw
AstAccountMusicOnHold: default</code></strong>

<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id36041106"></a>The one field we should
          explicitly mention here is the <code class="literal">userPassword</code> field. We require that the
          value in the LDAP server contain the password we’re going to
          authenticate from the phone with to be in the format of an MD5 hash.
          In versions prior to Asterisk 1.8.0, the prefix of <code class="literal">{md5}</code> in front of the hash was required.
          While it is no longer necessary, it is still <span class="keep-together">recommended</span>.</p></div><p>With the file created, we can add the user to our LDAP
      server:</p><p><a id="ExternalServices_id203333"></a><a id="ExternalServices_id203334"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo ldapadd -x -D cn=admin,dc=shifteight,dc=org -f astusers.ldif -W</code></strong>
<code class="computeroutput">Enter LDAP Password: 
adding new entry "uid=rbryant,ou=people,dc=shifteight,dc=org"</code></pre><p>Our
      user has now been imported into LDAP. The next step is to configure
      Asterisk to connect to the LDAP server and allow users to authenticate
      and register their phones.</p></div><div class="sect2" title="Compiling LDAP Support into Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id189890"></a>Compiling LDAP Support into Asterisk</h3></div></div></div><p><a id="ExternalServices_id189895"></a><a id="I_indexterm18_d1e42332" class="indexterm"></a><a id="I_indexterm18_d1e42339" class="indexterm"></a>With our OpenLDAP server configured and the schema
      imported, we need to install the dependencies for Asterisk and compile
      the <code class="literal">res_config_ldap</code> module. This
      module is the key that will allow us to configure Asterisk realtime for
      accessing our peers <span class="keep-together">via
      LDAP</span>.</p><p><a id="ExternalServices_id36041008"></a>Once we’ve installed the
      dependency, we need to rerun the <span class="command"><strong>./configure</strong></span> script inside the Asterisk source
      directory, then verify that the <code class="literal">res_config_ldap</code> module is selected. Then we
      can run <span class="command"><strong>make install</strong></span> to compile and
      install the new module.</p><div class="sect3" title="Ubuntu dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36041022"></a>Ubuntu dependencies</h4></div></div></div><p><a id="ExternalServices_id36040996"></a><a id="I_indexterm18_d1e42366" class="indexterm"></a>On Ubuntu, we need to install the <code class="filename">openldap-dev</code> package to provide the
        dependency for the <code class="literal">res_config_ldap</code>
        module:</p><p><a id="ExternalServices_id36040942"></a><a id="ExternalServices_id36040943"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo apt-get install openldap-dev</code></strong></pre></div><div class="sect3" title="CentOS dependencies"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36040950"></a>CentOS dependencies</h4></div></div></div><p><a id="ExternalServices_id36040955"></a><a id="I_indexterm18_d1e42387" class="indexterm"></a>On CentOS, we need to install the <code class="filename">openldap-devel</code> package to provide the
        dependency for the <code class="literal">res_config_ldap</code>
        module:</p><p><a id="ExternalServices_id36040910"></a><a id="ExternalServices_id36040911"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo yum install openldap-devel</code></strong></pre></div></div><div class="sect2" title="Configuring Asterisk for LDAP Support"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id189907"></a>Configuring Asterisk for LDAP Support</h3></div></div></div><p><a id="ExternalServices_id189912"></a><a id="I_indexterm18_d1e42408" class="indexterm"></a><a id="I_indexterm18_d1e42415" class="indexterm"></a><a id="I_indexterm18_d1e42420" class="indexterm"></a>Now that we’ve configured our LDAP server and installed
      the <code class="literal">res_config_ldap</code> module, we need
      to configure Asterisk to support loading of peers from LDAP. To do this,
      we need to configure the <code class="filename">res_ldap.conf</code> file to connect to the LDAP
      server and the <code class="filename">extconfig.conf</code> file
      to tell Asterisk what information to get from the LDAP server, and how.
      Once that is done, we can configure any remaining module configuration
      files, such as <code class="filename">sip.conf</code>, <code class="filename">iax.conf</code>, <code class="filename">voicemail.conf</code>, and so on, where appropriate.
      In our example we’ll be configuring Asterisk to load our SIP peers from
      realtime using the LDAP server as our database.</p><div class="sect3" title="Configuring res_ldap.conf"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36040839"></a>Configuring res_ldap.conf</h4></div></div></div><p><a id="ExternalServices_id36040847"></a><a id="I_indexterm18_d1e42449" class="indexterm"></a><a id="I_indexterm18_d1e42452" class="indexterm"></a>The <code class="filename">res_ldap.conf.sample</code> file is a good place
        to start because it contains a good set of templates. At the top of
        the file, though, under the <code class="literal">[_general]</code> section, we need to configure how
        Asterisk is going to connect to our LDAP server. Our first option is
        <code class="literal">url</code>, which will determine how to
        connect to the server. We have defined a connection as <code class="literal">ldap://172.16.0.103:389</code>, which will connect
        to the LDAP server at IP address <code class="literal">172.16.0.103</code> on port <code class="literal">389</code>. If you have a secure connection to your
        LDAP server, you can replace <code class="literal">ldap://</code> with <code class="literal">ldaps://</code>. Additionally, we have set <code class="literal">protocol=3</code> to state that we’re connecting
        with protocol version 3, which in most (if not all) cases will be
        correct.</p><p><a id="ExternalServices_id36040790"></a>The last three options,
        <code class="literal">basedn</code>, <code class="literal">user</code>, and <code class="literal">pass</code>, are used for authenticating to our
        LDAP server. We need to specify:</p><div class="itemizedlist"><a id="ExternalServices_id36040803"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="ExternalServices_id36040805"></a><a id="ExternalServices_id36040808"></a>The <code class="literal">basedn</code> (<code class="literal">dc=shifteight,dc=org</code>), which is
            essentially our domain name</p></li><li class="listitem"><p><a id="ExternalServices_id36040819"></a><a id="ExternalServices_id36040762"></a>The <code class="literal">user</code> name we’re going to authenticate to
            the LDAP server as (<code class="literal">admin</code>)</p></li><li class="listitem"><p><a id="ExternalServices_id36040772"></a><a id="ExternalServices_id36040774"></a>The password for the user
            to authenticate with (<code class="literal">canada</code>)</p></li></ul></div><p><a id="ExternalServices_id36040739"></a>If we put it all together, we
        end up with something like the following:</p><p><a id="ExternalServices_id36040743"></a><a id="ExternalServices_id36040744"></a></p><pre class="programlisting">[_general]
url=ldap://172.16.0.103:389
protocol=3
basedn=dc=shifteight,dc=org
user=cn=admin,dc=shifteight,dc=org
pass=canada
</pre><p>Beyond this, in the rest of the sample configuration file
        we’ll see lots of templates we can use for mapping the information in
        Asterisk onto our LDAP schema. Lets take a look at the first lines of
        the <code class="literal">[sip]</code> template that we’ll be
        using to map the information of our SIP peers into the LDAP
        database:</p><p><a id="ExternalServices_id36040730"></a><a id="ExternalServices_id36040731"></a></p><pre class="programlisting">[sip]
name = cn
amaflags = AstAccountAMAFlags
callgroup = AstAccountCallGroup
callerid = AstAccountCallerID
...
lastms = AstAccountLastQualifyMilliseconds
useragent = AstAccountUserAgent
additionalFilter=(objectClass=AsteriskSIPUser)</pre><p>On the left
        side we have the field name Asterisk will be looking up, and on the
        right is the mapping to the LDAP schema for the request. Our first set
        of fields is mapping the <code class="literal">name</code> field
        to the <code class="literal">cn</code> field on the LDAP server.
        If you look back at the data we imported in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106" title="Configuring OpenLDAP">the section called “Configuring OpenLDAP”</a>, you’ll see that we have
        created a user and assigned the value of <code class="literal">RussellBryant</code> to the <code class="literal">cn</code> field. So, in this case, we’re mapping
        the authentication name (the <code class="literal">name</code>
        field) from the SIP user to the value of the <code class="literal">cn</code> field in the LDAP server (<code class="literal">RussellBryant</code>).</p><p><a id="ExternalServices_id36040691"></a>This goes for the rest of the
        values all the way down, with some fields (i.e., <code class="literal">useragent</code>, <code class="literal">lastms</code>, <code class="literal">ipaddr</code>, etc.) simply needing to exist so
        Asterisk can write information (e.g., registration information) to the
        LDAP server.</p></div><div class="sect3" title="Configuring extconfig.conf"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36040635"></a>Configuring extconfig.conf</h4></div></div></div><p><a id="ExternalServices_id36040643"></a><a id="I_indexterm18_d1e42574" class="indexterm"></a><a id="I_indexterm18_d1e42577" class="indexterm"></a>Our next step is to tell Asterisk what information to
        load via realtime and what technology to use. Using the <code class="filename">extconfig.conf</code> file, we have the option of
        loading several modules dynamically (and we can also load files
        statically). For more information about Asterisk realtime, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465" title="Using Realtime">the section called “Using Realtime”</a>.</p><p><a id="ExternalServices_id36040656"></a>For our example, we’re going to
        configure the <code class="literal">sipusers</code> and <code class="literal">sippeers</code> dynamic realtime objects to load
        our SIP peers from LDAP. In the following example, we have a line
        <span class="keep-together">like this</span>:</p><a id="I_programlisting18_d1e42599"></a><pre class="programlisting">          <code class="literal">ldap,"ou=people,dc=shifteight,dc=org",sip</code>
        </pre><p><a id="ExternalServices_id36040616"></a>We’ve specified three
        arguments. The first is <code class="literal">ldap</code>, which
        is the technology we’re going to use to connect to our realtime
        object. There are other technologies available, such as <code class="literal">odbc</code>, <code class="literal">pgsql</code>, <code class="literal">curl</code>, and so on. Our second argument,
        enclosed in double quotes, specifies which database we’re connecting
        to. In the case of LDAP, we’re connecting to the object-unit <code class="literal">people</code> within the domain <code class="literal">shifteight.org</code>. Lastly, our third argument,
        <code class="literal">sip</code>, defines which template we’re
        using (as defined in <code class="filename">res_ldap.conf</code>) to map the realtime data to
        the LDAP database.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="ExternalServices_id36040529"></a>Additionally, you can specify
          a fourth argument, which is the priority. If you define multiple
          realtime objects, such as when defining <code class="literal">queues</code> or <code class="literal">sippeers</code><a id="I_indexterm18_d1e42637" class="indexterm"></a>, you can utilize the priority argument to control
          failover if a particular storage engine becomes unavailable.
          Priorities must start at <code class="literal">1</code> and
          increment sequentially.</p></div><p><a id="ExternalServices_id36040545"></a>To define the use of <code class="literal">sipusers</code> and <code class="literal">sippeers</code> from the LDAP server, we would
        enable these lines in <code class="filename">extconfig.conf</code>: <a id="ExternalServices_id36040546"></a></p><pre class="programlisting">sipusers =&gt; ldap,"ou=people,dc=shifteight,dc=org",sip
sippeers =&gt; ldap,"ou=people,dc=shifteight,dc=org",sip</pre></div><div class="sect3" title="Configuring sip.conf for realtime"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36040514"></a>Configuring sip.conf for realtime</h4></div></div></div><p><a id="ExternalServices_id36040522"></a><a id="I_indexterm18_d1e42661" class="indexterm"></a><a id="I_indexterm18_d1e42664" class="indexterm"></a><a id="I_indexterm18_d1e42669" class="indexterm"></a>These steps are optional for configuring SIP for
        realtime, although you will likely expect things to work in the manner
        we’re going to describe. In the <code class="filename">sip.conf</code> file, we will enable a few
        realtime options that will cache information into memory as it is
        loaded from the database. By doing this, we’ll allow Asterisk to place
        calls to devices by simply looking at the information stored in
        memory. Not only does caching make realtime potentially more
        efficient, but things like device state updates simply can’t work
        unless the devices are cached in memory.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="ExternalServices_id36040458"></a>A peer is only loaded into
          memory upon registration of the device or placing a call to the
          device. If you run the command <span class="command"><strong>sip
          reload</strong></span> <a id="I_indexterm18_d1e42682" class="indexterm"></a><a id="I_indexterm18_d1e42685" class="indexterm"></a>on the console, the peers will be cleared from memory
          as well, so you may need to adjust your registration times if that
          could cause issues in your system.</p></div><p><a id="ExternalServices_id36040469"></a>To enable peer caching in
        Asterisk, use the <code class="literal">rtcachefriends</code>
        option in <code class="filename">sip.conf</code>:</p><p><a id="ExternalServices_id36040478"></a><a id="ExternalServices_id36040479"></a></p><pre class="programlisting">rtcachefriends=yes</pre><p><a id="ExternalServices_id36040483"></a>There are additional realtime
        options as well, such as <code class="literal">rtsavesysname</code>, <code class="literal">rtupdate</code>, <code class="literal">rtautoclear</code>, and <code class="literal">ignoreregexpire</code>. These are all explained in
        the <code class="filename">sip.conf.sample</code> file located
        within your Asterisk source.<a id="I_indexterm18_d1e42720" class="indexterm"></a><a id="I_indexterm18_d1e42721" class="indexterm"></a></p></div></div></div><div class="sect1" title="Text-to-Speech Utilities"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices_id291618"></a>Text-to-Speech Utilities</h2></div></div></div><p><a id="ExternalServices_id291623"></a><a id="index-736B345DH7B" class="indexterm"></a><a id="index-553S433WM8L" class="indexterm"></a>Text-to-speech utilities are used to convert strings of
    words into audio that can be played to your callers. Text-to-speech has
    been around for many years, and has been continually improving. While we
    can’t recommend text-to-speech utilities to take the place of
    professionally recorded prompts, they do offer some degree of usefulness
    in applications where dynamic data needs to be communicated to a
    caller.</p><div class="sect2" title="Festival"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id291626"></a>Festival</h3></div></div></div><p><a id="ExternalServices_id291631"></a>Festival <a id="I_indexterm18_d1e42742" class="indexterm"></a><a id="I_indexterm18_d1e42749" class="indexterm"></a><a id="I_indexterm18_d1e42752" class="indexterm"></a><a id="I_indexterm18_d1e42757" class="indexterm"></a>is one of the oldest running applications for
      text-to-speech on Linux. While the quality of Festival is not sufficient
      for us to recommend it for production use, it is certainly a useful way
      of testing a text-to-speech-based application. If a more polished sound
      is required for your application, we recommend you look at Cepstral
      (covered next).</p><div class="sect3" title="Installing Festival on CentOS"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36055967"></a>Installing Festival on CentOS</h4></div></div></div><p><a id="ExternalServices_id36055973"></a><a id="I_indexterm18_d1e42769" class="indexterm"></a><a id="I_indexterm18_d1e42774" class="indexterm"></a>Installing Festival and its dependencies on CentOS is
        straightforward. Simply use <span class="command"><strong>yum</strong></span> to
        install the <code class="filename">festival</code>
        package:</p><a id="ExternalServices_id36055983"></a><pre class="screen">$ <strong class="userinput"><code>sudo yum install festival</code></strong></pre></div><div class="sect3" title="Installing Festival on Ubuntu"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36055989"></a>Installing Festival on Ubuntu</h4></div></div></div><p><a id="ExternalServices_id36055995"></a><a id="I_indexterm18_d1e42794" class="indexterm"></a>To install Festival and its dependencies on Ubuntu,
        simply use <code class="filename">apt-get</code> to install the
        <code class="filename">festival</code> package:</p><a id="ExternalServices_id36056002"></a><pre class="screen">$ <strong class="userinput"><code>sudo apt-get install festival</code></strong></pre></div><div class="sect3" title="Using Festival with Asterisk"><div class="titlepage"><div><div><h4 class="title"><a id="ExternalServices_id36056008"></a>Using Festival with Asterisk</h4></div></div></div><p><a id="ExternalServices_id36056014"></a>With Festival installed, we
        need to modify the <code class="filename">festival.scm</code>
        file in order to enable <span class="keep-together">Asterisk</span>
        to connect to the Festival server. On both CentOS and Ubuntu, the file
        is located in <code class="filename">/usr/share/festival/</code>. Open the file and
        place the following text just above the last line, <code class="literal">(provide 'festival)</code>:</p><p><a id="ExternalServices_id36056029"></a><a id="ExternalServices_id36056030"></a></p><pre class="programlisting">(define (tts_textasterisk string mode)
"(tts_textasterisk STRING MODE)
Apply tts to STRING. This function is specifically designed for
use in server mode so a single function call may synthesize the string.
This function name may be added to the server safe functions."
(let ((wholeutt (utt.synth (eval (list 'Utterance 'Text string)))))
(utt.wave.resample wholeutt 8000)
(utt.wave.rescale wholeutt 5)
(utt.send.wave.client wholeutt)))</pre><p>After adding that, you need
        to start the Festival server:</p><p><a id="ExternalServices_id36056039"></a><a id="ExternalServices_id36056040"></a></p><pre class="screen">$ <strong class="userinput"><code>sudo festival_server 2&gt;&amp;1 &gt; /dev/null &amp;</code></strong></pre><p>Using
        <span class="command"><strong>menuselect</strong></span> from your Asterisk
        source directory, verify that the <code class="literal">app_festival</code> application has been selected
        under the <span class="emphasis"><em>Applications</em></span> heading. If it was not
        already selected, be sure to run <span class="command"><strong>make
        install</strong></span> after selecting it to install the <code class="literal">Festival()</code> dialplan application.</p><p><a id="ExternalServices_id36056061"></a>Before you can use the <code class="literal">Festival()</code> application, you need to tell
        Asterisk how to connect to the Festival server. The <code class="filename">festival.conf</code> file is used for controlling
        how Asterisk connects to and interacts with the Festival server. The
        sample <code class="filename">festival.conf</code> file located
        in the Asterisk source directory is a good place to start, so copy
        <code class="filename">festival.conf.sample</code> from the
        <code class="filename">configs/</code> subdirectory of your
        Asterisk source to the <code class="filename">/etc/asterisk/</code> configuration directory
        now:</p><p><a id="ExternalServices_id36056087"></a><a id="ExternalServices_id36056088"></a></p><pre class="screen">$ <strong class="userinput"><code>cp ~/asterisk-complete/asterisk/1.8/configs/festival.conf.sample \
/etc/asterisk/festival.conf</code></strong></pre><p><a id="ExternalServices_id36056094"></a>The default configuration is
        typically enough to connect to the Festival server running on the
        local machine, but you can optionally configure parameters such as the
        <code class="literal">host</code> where the Festival server is
        running (if remote), the <code class="literal">port</code> to
        connect to, whether to enable caching of files (defaults to <code class="literal">no</code>), the location of the cache directory
        (defaults to <code class="filename">/tmp</code>), and the
        command Asterisk passes to the Festival server.</p><p><a id="ExternalServices_id36056111"></a>You can verify that the
        <code class="literal">Festival()</code> dialplan application is
        accessible by running <span class="command"><strong>core show application
        festival</strong></span><a id="I_indexterm18_d1e42899" class="indexterm"></a><a id="I_indexterm18_d1e42902" class="indexterm"></a> from the Asterisk console:</p><a id="ExternalServices_id36056121"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>core show application festival</code></strong></pre><p><a id="ExternalServices_id36056126"></a>If you don’t get output, you
        may need to load the <code class="filename">app_festival.so</code> module:</p><p><a id="ExternalServices_id36056133"></a><a id="ExternalServices_id36056134"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>module load app_festival.so</code></strong></pre><p>Verify
        that the <code class="filename">app_festival.so</code> module
        exists in <code class="filename">/usr/lib/asterisk/modules/</code> if you’re still
        having issues with loading the module.</p><p><a id="ExternalServices_id36056151"></a>After loading the <code class="literal">Festival()</code> application into Asterisk, you
        need to create a test dialplan extension to verify that <code class="literal">Festival()</code> is working:</p><p><a id="ExternalServices_id36056162"></a><a id="ExternalServices_id36056163"></a></p><pre class="programlisting">[LocalSets]
exten =&gt; 203,1,Verbose(2,This is a Festival test)
   same =&gt; n,Answer()
   same =&gt; n,Playback(silence/1)
   same =&gt; n,Festival(Hello World)
   same =&gt; n,Hangup()</pre><p>Reload the dialplan with the <span class="command"><strong>dialplan reload</strong></span> command <a id="I_indexterm18_d1e42945" class="indexterm"></a><a id="I_indexterm18_d1e42948" class="indexterm"></a>from the Asterisk console, and test out the connection
        to Festival by dialing extension <code class="literal">203</code>.</p><p><a id="ExternalServices_id36056173"></a>Alternatively, if you’re having
        issues with the Festival server, you could use the following method to
        generate files with the <span class="command"><strong>text2wave</strong></span>
        application <a id="I_indexterm18_d1e42962" class="indexterm"></a><a id="I_indexterm18_d1e42965" class="indexterm"></a>supplied with the <code class="filename">festival</code> package:</p><p><a id="ExternalServices_id36056184"></a><a id="ExternalServices_id36056185"></a></p><pre class="programlisting">exten =&gt; 202,1,Verbose(2,Trying out Festival)
   same =&gt; n,Answer()

; *** This line should not have any line breaks
   same =&gt; n,System(echo "This is a test of Festival" 
| /usr/bin/text2wave -scale 1.5 -F 8000 -o /tmp/festival.wav)

   same =&gt; n,Playback(/tmp/festival)
   same =&gt; n,System(rm -f /tmp/festival.wav)
   same =&gt; n,Hangup()</pre><p>You should now have enough to get
        started with generating text-to-speech audio for your Asterisk system.
        The audio quality is not brilliant, and the speech generated is not
        clear enough to be easy to understand over a telephone, but for
        development and testing purposes Festival is an application that can
        fill the gap until you’re ready for a more professional-sounding
        text-to-speech generator such as Cepstral.</p></div></div><div class="sect2" title="Cepstral"><div class="titlepage"><div><div><h3 class="title"><a id="ExternalServices_id291634"></a>Cepstral</h3></div></div></div><p><a id="ExternalServices_id291639"></a><a id="I_indexterm18_d1e42982" class="indexterm"></a><a id="I_indexterm18_d1e42989" class="indexterm"></a><a id="I_indexterm18_d1e42996" class="indexterm"></a>Cepstral is a text-to-speech engine that works in a
      similar manner as the <code class="literal">Festival()</code>
      application in the dialplan, but produces much higher-quality sound. Not
      only is the quality significantly better, but Cepstral has developed a
      text-to-speech engine that emulates Allison’s voice, so your
      text-to-speech engine can sound the same as the English sound files that
      ship with Asterisk by default, to give a consistent experience to the
      caller.</p><p><a id="ExternalServices_id36021474"></a>Cepstral is commercial module,
      but for around $30 you can have a text-to-speech engine that is clearer,
      is more consistent with other sound prompts on your system, and provides
      a more pleasurable experience for your callers. The Cepstral software
      and installation instructions can be downloaded from the Digium.com
      webstore at <a class="ulink" href="http://www.digium.com/en/products/software/cepstral.php" target="_top">http://www.digium.com/en/products/software/cepstral.php</a>.<a id="I_indexterm18_d1e43007" class="indexterm"></a><a id="I_indexterm18_d1e43008" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="ExternalServices_id291644"></a>Conclusion</h2></div></div></div><p><a id="ExternalServices_id291649"></a>In this chapter we focused on
    integrating Asterisk with external services that may not be directly
    related to generating or handling calls, but do enable tighter coupling
    with existing services on your network by providing information for call
    routing, or information about your users from your existing
    infrastructure.<a id="I_indexterm18_d1e43015" class="indexterm"></a><a id="I_indexterm18_d1e43016" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id615032" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id615032" class="para">155</a>] </sup>And because the authors of this book do not have access to
          Exchange servers for testing. : )</p></div><div class="footnote"><p><sup>[<a id="ftn.id615695" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id615695" class="para">156</a>] </sup>As of this writing, there is a bug in the process of loading
          of the calendar modules after Asterisk has been started. It was
          filed as issue 18067 at <a class="ulink" href="https://issues.asterisk.org/" target="_top">https://issues.asterisk.org</a> and hopefully will have
          been resolved by the time you read this. If not, be aware that you
          may need to restart Asterisk to get the modules loaded into memory
          correctly.</p></div><div class="footnote"><p><sup>[<a id="ftn.id617326" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id617326" class="para">157</a>] </sup>In Unix, the epoch is the number of seconds that have elapsed
          since January 1, 1970, not counting leap seconds.</p></div><div class="footnote"><p><sup>[<a id="ftn.id617745" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id617745" class="para">158</a>] </sup>When we say “it works,” what we mean is that Asterisk will
        compose the email and submit it to the MTA, and the email will
        successfully be passed out of the system. What happens to it after it
        leaves the system is a bit more complicated, and will often involve
        spam filters treating the mail as suspect and not actually delivering
        it. This is not really Asterisk’s fault, but it’s something you’ll
        have to deal with.</p></div><div class="footnote"><p><sup>[<a id="ftn.id618641" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id618641" class="para">159</a>] </sup>We recently checked out the open source webmail project
            <a class="ulink" href="http://www.roundcube.net/" target="_top">roundcube</a> project as
            well, and we were quite impressed.</p></div><div class="footnote"><p><sup>[<a id="ftn.id622471" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id622471" class="para">160</a>] </sup>The <code class="literal">chan_gtalk</code> module
            only support IPv4 interfaces.</p></div><div class="footnote"><p><sup>[<a id="ftn.id622510" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id622510" class="para">161</a>] </sup>Future versions of Asterisk may offer more fine-grained
            control.</p></div><div class="footnote"><p><sup>[<a id="ftn.id623266" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id623266" class="para">162</a>] </sup>You may have to purchase credits from Google Voice in the
            control panel in order to place calls to certain
            destinations.</p></div><div class="footnote"><p><sup>[<a id="ftn.id623392" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id623392" class="para">163</a>] </sup>Skype for Asterisk currently retails for $66 per license, and
        includes a G.729 license. Each license permits one simultaneous
        call.</p></div><div class="footnote"><p><sup>[<a id="ftn.id623980" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id623980" class="para">164</a>] </sup>The VUC is the VoIP Users Conference, which runs weekly at
            12:00 noon Eastern time (–0500 GMT). More information is available
            at <a class="ulink" href="http://vuc.me/" target="_top">http://vuc.me</a>.</p></div></div></div><div class="chapter" title="Chapter 19. Fax"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Fax"></a>Chapter&nbsp;19.&nbsp;Fax</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax-SECT-1">What Is a Fax?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id290275">Ways to Handle Faxes in Asterisk</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id253868">spandsp</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329066">Obtaining spandsp</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id323352">Compiling and Installing spandsp</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337783">Adding the spandsp Library to Your libpath</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id345391">Recompiling Asterisk with spandsp Support</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337600">Disabling spandsp (Should You Want to Test Digium Fax)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id260129">Digium Fax For Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id307516">Obtaining Digium FFA</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id319736">Disabling Digium FFA (Should You Want to Test spandsp)</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id263810">Incoming Fax Handling</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259374">Fax to TIFF</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id265396">Outgoing Fax Handling</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36043799">Fax Pass-Through</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id405211">Using Fax Buffers in chan_dahdi.conf</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id245657">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Fax_id264424"></a>Have no fear of perfection. You’ll never reach
    it.</p><div class="attribution"><span>—<span class="attribution">Salvador Dali</span></span></div></div><p><a id="Fax_id246432"></a><a id="index-842H768EE5K" class="indexterm"></a><a id="index-257A853RL6H" class="indexterm"></a>The concept of facsimile transmission has been around for over
  100 years, but it was not until the 1980s that the use of fax machines
  became essential in business. This lasted for perhaps two decades. Then the
  Internet came along, and very shortly after that, the fax quickly became
  almost irrelevant.</p><div class="sect1" title="What Is a Fax?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Fax-SECT-1"></a>What Is a Fax?</h2></div></div></div><p><a id="Fax_id248223"></a><a id="I_indexterm19_d1e43040" class="indexterm"></a>A fax machine allows a facsimile (copy) of a document to be
    transmitted across a telephone line. In the Internet age, this sort of
    functionality seems useless; however, prior to ubiquitous Internet access,
    this was a very useful thing indeed. Fax machines scan a document into a
    digital format, transmit the digital information in a manner similar to
    that used by an analog modem, and then convert and print the received
    information on the other end.</p></div><div class="sect1" title="Ways to Handle Faxes in Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id290275"></a>Ways to Handle Faxes in Asterisk</h2></div></div></div><p><a id="Fax_id266187"></a><a id="I_indexterm19_d1e43050" class="indexterm"></a>Asterisk offers the ability to both send and receive faxes,
    but it should be noted that all Asterisk is doing is the basics of fax
    transport. This means that providing a complete experience to your users
    will require external programs and resources beyond what Asterisk
    delivers.</p><p><a id="Fax_id36061149"></a>Asterisk Fax can:</p><div class="itemizedlist"><a id="Fax_id36061152"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Fax_id36061154"></a><a id="Fax_id36061156"></a>Recognize an incoming fax connection, and
        negotiate a session</p></li><li class="listitem"><p><a id="Fax_id36061160"></a><a id="Fax_id36061162"></a>Store (receive) the incoming fax as a Tagged
        Image File Format (TIFF) file</p></li><li class="listitem"><p><a id="Fax_id36061167"></a><a id="Fax_id36061169"></a>Accept TIFF files in a fax-compatible
        format</p></li><li class="listitem"><p><a id="Fax_id36061173"></a><a id="Fax_id36061175"></a>Transmit TIFF files to another fax
        machine</p></li></ul></div><p><a id="Fax_id36061181"></a>Asterisk Fax cannot:</p><div class="itemizedlist"><a id="Fax_id36061184"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Fax_id36061186"></a><a id="Fax_id36061188"></a>Print faxes</p></li><li class="listitem"><p><a id="Fax_id36061192"></a><a id="Fax_id36061194"></a>Accept documents for transmission in any
        format other than TIFF</p></li></ul></div><p><a id="Fax_id36061200"></a>Receiving is relatively simple, since the format
    of the document is determined at the sending end, and thus all Asterisk
    needs to do is store the document.</p><p><a id="Fax_id36061207"></a>Transmitting is somewhat more complex, since the
    transmitting end is responsible for ensuring that the document to be sent
    is in the correct format for faxing. This typically places a burden on the
    user to understand how to create a properly formatted document, or
    requires complex client or server software to handle the formatting (for
    example, through a print driver installed on the local PC) and placement
    of the fax job in a location where the server can grab it and transmit
    it.</p></div><div class="sect1" title="spandsp"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id253868"></a>spandsp</h2></div></div></div><p><a id="Fax_id259029"></a><a id="I_indexterm19_d1e43088" class="indexterm"></a><a id="I_indexterm19_d1e43091" class="indexterm"></a><a id="I_indexterm19_d1e43096" class="indexterm"></a>Initially, the only way to handle faxing in Asterisk was
    through the <code class="literal">spandsp</code> library. spandsp provides a
    multitude of Digital Signal Processing (DSP) capabilities, but in this
    context all we are interested in is its fax functionality.</p><p><a id="Fax_id394417"></a>Asterisk has the hooks built in to make use of
    spandsp, but due to incompatible licenses, the spandsp libraries must be
    downloaded and compiled separately from Asterisk. Also, since spandsp was
    not written only for Asterisk, it will not assume that it is being
    installed for Asterisk. This means that a few extra steps will be required
    to ensure Asterisk can use spandsp.</p><div class="sect2" title="Obtaining spandsp"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id329066"></a>Obtaining spandsp</h3></div></div></div><p><a id="Fax_id329071"></a>As of this writing, the current version of
      spandsp is 0.0.6.</p><p><a id="Fax_id329075"></a>Download and extract the spandsp source code as
      follows:</p><p><a id="Fax_id329078"></a>
        <a id="Fax_id323317"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>mkdir ~/src/asterisk-complete/thirdparty</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/thirdparty</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>wget http://www.soft-switch.org/downloads/spandsp/spandsp-0.0.6pre17.tgz</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>tar zxvf spandsp-0.0.6pre17.tgz</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>cd spandsp-0.0.6</code></strong></pre><p>
      </p></div><div class="sect2" title="Compiling and Installing spandsp"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id323352"></a>Compiling and Installing spandsp</h3></div></div></div><p><a id="Fax_id337751"></a><a id="I_indexterm19_d1e43150" class="indexterm"></a><a id="I_indexterm19_d1e43155" class="indexterm"></a>The spandsp software should compile and install with the
      following commands:</p><p><a id="Fax_id337754"></a><a id="Fax_id337755"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>sudo make install</code></strong></pre><p>This will
      install the library in the <code class="filename">/usr/local/lib/</code> folder.
      On many Linux systems this folder is not automatically part of the
      library path (<code class="filename">libpath</code>), so it will need to be added
      manually.</p></div><div class="sect2" title="Adding the spandsp Library to Your libpath"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id337783"></a>Adding the spandsp Library to Your libpath</h3></div></div></div><p><a id="Fax_id338786"></a><a id="I_indexterm19_d1e43191" class="indexterm"></a>In order to make the <code class="literal">spandsp</code> library
      visible to all applications on the system, the folder where it is
      located must be added to the <code class="filename">libpath</code> for the
      system. This is typically done by editing files in the
      <code class="filename">/etc/ld.so.conf.d/</code> directory. You simply need to
      ensure that one of the files in that directory has
      <code class="literal">/usr/local/lib</code> listed. If not, the following command
      will create a suitable file for you:</p><a id="Fax_id338798"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo cat &gt;&gt; /etc/ld.so.conf.d/usrlocallib.conf
/usr/local/lib</code></strong>
</pre><p><a id="Fax_id338808"></a>Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span>
      to save the file, then run the <span class="command"><strong>ldconfig</strong></span> command to
      refresh the library paths:</p><a id="Fax_id345379"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo ldconfig</code></strong></pre><p><a id="Fax_id345386"></a>You are now ready to recompile Asterisk for
      spandsp support.</p></div><div class="sect2" title="Recompiling Asterisk with spandsp Support"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id345391"></a>Recompiling Asterisk with spandsp Support</h3></div></div></div><p><a id="Fax_id345396"></a><a id="I_indexterm19_d1e43237" class="indexterm"></a>Since the <code class="literal">spandsp</code> library was probably
      not installed on the system when Asterisk was first compiled, you will
      need to do a quick recompile of Asterisk in order to have the spandsp
      support added:</p><p><a id="Fax_id345401"></a><a id="Fax_id345402"></a></p><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8/</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>./configure</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make menuselect</code></strong></pre><p>Ensure that
      under the <span class="emphasis"><em>Resource Modules</em></span> heading, the section for
      spandsp looks like this:</p><p><a id="Fax_id324995"></a>
        <a id="Fax_id324996"></a></p><pre class="programlisting">[*] res_fax_spandsp</pre><p>
      </p><p><a id="Fax_id325000"></a>If you see this instead:</p><p><a id="Fax_id325003"></a>
        <a id="Fax_id325004"></a></p><pre class="programlisting">XXX res_fax_spandsp</pre><p>
      </p><p><a id="Fax_id325007"></a>It means that Asterisk was not able to find the
      <code class="literal">spandsp</code> library.</p><p><a id="Fax_id325011"></a>Once you have verified that Asterisk can see
      spandsp, you are ready to recompile. Save and exit from
      <span class="command"><strong>menuselect</strong></span>, and run the following:</p><a id="Fax_id325016"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>make install</code></strong></pre><p><a id="Fax_id337584"></a>You can verify that spandsp is working with
      Asterisk by issuing the following command from the Asterisk CLI:</p><p><a id="Fax_id337588"></a><a id="Fax_id337589"></a></p><pre class="screen"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>module show like res_fax_spandsp.so</code></strong></pre><p>At
      this point the <code class="literal">SendFAX()</code> and
      <code class="literal">ReceiveFAX()</code> dialplan applications will be available
      <span class="keep-together">to you</span>.</p></div><div class="sect2" title="Disabling spandsp (Should You Want to Test Digium Fax)"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id337600"></a>Disabling spandsp (Should You Want to Test Digium Fax)</h3></div></div></div><p><a id="Fax_id337606"></a><a id="I_indexterm19_d1e43322" class="indexterm"></a>The <code class="literal">spandsp</code> library and the Digium fax
      library, discussed in the next section, are mutually exclusive. If you
      want to try out the Digium fax product, you will need to ensure that
      spandsp does not load. To disable spandsp in Asterisk, simply edit your
      <code class="filename">/etc/asterisk/modules.conf</code> file as follows:</p><p><a id="Fax_id307490"></a><a id="Fax_id307491"></a></p><pre class="programlisting">noload =&gt; res_fax_spandsp.so
</pre><p>Save the changes and restart Asterisk.</p></div></div><div class="sect1" title="Digium Fax For Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id260129"></a>Digium Fax For Asterisk</h2></div></div></div><p><a id="Fax_id284727"></a><a id="I_indexterm19_d1e43342" class="indexterm"></a><a id="I_indexterm19_d1e43347" class="indexterm"></a>Digium Fax For Asterisk (FFA) was developed out of a strong
    desire from the Asterisk community to have a Digium-supported fax
    mechanism in Asterisk. Free for single-channel use, this product can also
    be licensed from Digium to handle more than one simultaneous fax
    channel.</p><div class="sect2" title="Obtaining Digium FFA"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id307516"></a>Obtaining Digium FFA</h3></div></div></div><p><a id="Fax_id307521"></a>Digium FFA can be obtained from the Digium
      website (<a class="ulink" href="http://www.digium.com/" target="_top">http://www.digium.com</a>). The process of
      downloading, installing, and registering this library is thoroughly
      documented in the <span class="emphasis"><em>Fax For Asterisk Administrator
      Manual</em></span>, which you can also download from Digium. You will
      need to register at the Digium website in order to obtain your free
      single-channel fax license key and download the admin manual. There is
      also a comprehensive <code class="filename">README</code> file included with the
      software, which details the steps necessary to get Digium FFA going on
      your system.</p></div><div class="sect2" title="Disabling Digium FFA (Should You Want to Test spandsp)"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id319736"></a>Disabling Digium FFA (Should You Want to Test spandsp)</h3></div></div></div><p><a id="Fax_id319742"></a><a id="I_indexterm19_d1e43370" class="indexterm"></a>The Digium FFA library and the <code class="literal">spandsp</code>
      library are mutually exclusive. If you want to try out spandsp, you will
      need to ensure that Digium FFA does not load. To disable FFA, simply
      edit your <code class="filename">/etc/</code><code class="filename">asterisk</code><code class="filename">/</code><code class="filename">modules.conf</code> file as follows:</p><a id="Fax_id319751"></a><pre class="programlisting">noload =&gt; res_fax_digium.so</pre><p><a id="Fax_id307524"></a>Save the changes and restart Asterisk.</p></div></div><div class="sect1" title="Incoming Fax Handling"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id263810"></a>Incoming Fax Handling</h2></div></div></div><p><a id="Fax_id272338"></a><a id="index-145C262NV8N" class="indexterm"></a><a id="index-427R841SH7I" class="indexterm"></a>Received faxes are commonly encoded in Tagged Image File
    Format (TIFF). This graphics file format, while not as well known as JPEG
    or GIF, is not as obscure as one might think. In fact, we suspect your
    computer (whether you’re running Windows, Linux, or MacOS) will already
    have the ability to interpret TIFF files built in. While it has become
    popular to offer PDF as a delivery format for received faxes, we’re not
    sure this is strictly required, since TIFF is so ubiquitous.</p><p><a id="Fax_id244941"></a>Received faxes will be stored by Asterisk as
    files. Where those files are stored will depend on several factors,
    including:</p><div class="itemizedlist"><a id="Fax_id255369"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Fax_id254027"></a><a id="Fax_id282177"></a>What software you are using to simulate a fax
        modem (e.g., IAXmodem, Digium ReceiveFAX, etc.)</p></li><li class="listitem"><p><a id="Fax_id259349"></a><a id="Fax_id259351"></a>The location in your filesystem that you have
        configured for storage of received faxes</p></li><li class="listitem"><p><a id="Fax_id259355"></a><a id="Fax_id259358"></a>Any post-receipt processing you have decided
        to perform on the files</p></li></ul></div><p><a id="Fax_id259363"></a>In the dialplan, you will need to build in enough
    intelligence to name faxes in such a way that they will be distinct from
    each other. There are many channel variables and functions that can be
    used for this purpose, such as the <code class="literal">STRFTIME()</code> function.
    Asterisk can easily handle capturing the fax to a file, but you will need
    to make sense out of what happens to that file once it is stored on the
    system.</p><div class="sect2" title="Fax to TIFF"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id259374"></a>Fax to TIFF</h3></div></div></div><p><a id="Fax_id259379"></a><a id="I_indexterm19_d1e43427" class="indexterm"></a><a id="I_indexterm19_d1e43434" class="indexterm"></a><a id="I_indexterm19_d1e43439" class="indexterm"></a>The Tagged Image File Format is not very well known, but
      it is actually more common than you might realize, and since it is
      natively supported on Windows, MacOS, and Linux, TIFF files can be
      viewed on pretty much any computer with the most basic graphics viewer.
      A subset of the TIFF file format has for a long time been the de facto
      file format used for faxes.</p><p><a id="Fax_id36060911"></a>Since Asterisk will receive and store faxes in
      TIFF format, there is no post-processing required. Once the incoming fax
      call has been completed, the resulting TIFF file can be opened directly
      from the folder where it was stored (or perhaps emailed to the intended
      user).</p></div><div class="sect2" title="Fax to Email"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id259365"></a>Fax to Email</h3></div></div></div><p><a id="Fax_id259370"></a><a id="I_indexterm19_d1e43449" class="indexterm"></a><a id="I_indexterm19_d1e43456" class="indexterm"></a><a id="I_indexterm19_d1e43461" class="indexterm"></a>Once Asterisk has received a fax, the resulting TIFF file
      needs a way to get to its final destination: a person.</p><p><a id="Fax_id329434"></a>The key consideration is that unless the
      information that Asterisk knows about the fax is sufficiently detailed,
      it may not be possible to deduce the intended recipient without having
      someone actually read the fax (it is common for a fax to have a cover
      page with the recipient’s information written on it, which even the most
      capable text recognition software would have a difficult time making
      sense of). In other words, unless you dedicate a DID to each user who
      might receive a fax, Asterisk isn’t going to be able to do much more
      than send all faxes to a single email address. You could code something
      in the dialplan to handle this, though, or have an external
      <code class="filename">cron</code> job or other daemon handle distributing the
      received faxes.</p><p><a id="Fax_id329443"></a>A simple dialplan to handle fax to email might
      look something like this (you will need the mail program
      <span class="command"><strong>mutt</strong></span> installed on your system):</p><p><a id="Fax_id329451"></a><a id="Fax_id329452"></a></p><pre class="programlisting">exten =&gt; fax,1,Verbose(3,Incoming fax)
; folder where your incoming faxes will initially be stored
  same =&gt; n,Set(FAXDEST=/tmp) 

; put a timestamp on this call so the resulting file is unique
  same =&gt; n,Set(tempfax=${STRFTIME(,,%C%y%m%d%H%M)}) 
  same =&gt; n,ReceiveFax(${FAXDEST}/${tempfax}.tif)
  same =&gt; n,Verbose(3,- Fax receipt completed with status: ${FAXSTATUS})

; *** This line should not have any line breaks
  same =&gt; n,System(echo | mutt -a ${FAXDEST}/${tempfax} 
-s "received fax" somebody@shifteight.org)
</pre><p>Obviously, this sample would not be suitable for production
      (for example, it does not handle fax failure); however, it would be
      enough to start prototyping a more fully featured incoming fax
      handler.</p><div class="sidebar" title="Fax to PDF"><a id="I_sidebar19_d1e43481"></a><div class="titlepage"><div><div><p class="title"><strong>Fax to PDF</strong></p></div></div></div><p><a id="Fax_id265392"></a><a id="I_indexterm19_d1e43485" class="indexterm"></a><a id="I_indexterm19_d1e43488" class="indexterm"></a>Delivering a fax to a user as a PDF is a popular
        request. Since PCs, Macs, and Linux desktops can natively read TIFF
        files without any conversion required, this isn’t strictly required.
        Nevertheless, many people insist on this functionality.</p><p><a id="Fax_id36060943"></a>You can use a utility such as
        <code class="filename">ghostscript</code> to perform the conversion.</p></div></div><div class="sect2" title="Fax Detection"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id314159"></a>Fax Detection</h3></div></div></div><p><a id="Fax_id314164"></a><a id="I_indexterm19_d1e43503" class="indexterm"></a><a id="I_indexterm19_d1e43510" class="indexterm"></a>You may have a dedicated phone number for receiving faxes.
      However, with Asterisk, that is not a requirement. Asterisk has the
      ability to detect that an incoming call is a fax and can handle it
      differently in the dialplan. Fax detection is available for both DAHDI
      and SIP channels. To enable it for DAHDI, set the
      <code class="literal">faxdetect</code> option in
      <code class="filename">/etc/asterisk/chan_dahdi.conf</code>. In most cases, you
      should set this option to <code class="literal">incoming</code>. <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dahdi_faxdetect" title="Table 19.1. Possible values for the faxdetect option in chan_dahdi.conf">Table&nbsp;19.1, “Possible values for the faxdetect option in
        chan_dahdi.conf”</a></span> lists
      the possible values for the <code class="literal">faxdetect</code> option in
      <code class="filename">chan_dahdi.conf</code>.<a id="I_indexterm19_d1e43535" class="indexterm"></a></p><div class="table"><a id="dahdi_faxdetect"></a><p class="title"><strong>Table&nbsp;19.1.&nbsp;Possible values for the faxdetect option in
        chan_dahdi.conf</strong></p><div class="table-contents"><table summary="Possible values for the faxdetect option in
        chan_dahdi.conf" border="1"><colgroup><col><col></colgroup><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>
                <code class="literal">incoming</code>
              </td><td>Enables fax detection on inbound calls. When a fax is
              detected, applies the <code class="literal">faxbuffers</code> option if it
              has been set and redirects the call to the
              <code class="literal">fax</code> extension in the dialplan. For more
              information on the <code class="literal">faxbuffers</code> option, see
              <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id405211" title="Using Fax Buffers in chan_dahdi.conf">the section called “Using Fax Buffers in chan_dahdi.conf”</a>.</td></tr><tr><td>
                <code class="literal">outgoing</code>
              </td><td>Enables fax detection on outbound calls. The dialplan is
              not executing on an outbound channel. If a fax is detected, the
              <code class="literal">faxbuffers</code> option will be applied and the
              channel will be redirected and start executing the dialplan at
              the <code class="literal">fax</code> extension.</td></tr><tr><td>
                <code class="literal">both</code>
              </td><td>Enables fax detection for both incoming and outgoing
              calls.</td></tr><tr><td>
                <code class="literal">no</code>
              </td><td>Disables fax detection. This is the default.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Fax_id318027"></a>To enable fax detection for SIP calls, you must
      set the <code class="literal">faxdetect</code> option in
      <code class="filename">/etc/asterisk/sip.conf</code>. This option may be set in
      the <code class="literal">[general]</code> section, or for a specific peer.
      <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sip_faxdetect" title="Table 19.2. Possible values for the faxdetect option in sip.conf">Table&nbsp;19.2, “Possible values for the faxdetect option in sip.conf”</a></span>
      covers the possible values for the <code class="literal">faxdetect</code> option
      in <code class="filename">sip.conf</code>.<a id="I_indexterm19_d1e43612" class="indexterm"></a></p><div class="table"><a id="sip_faxdetect"></a><p class="title"><strong>Table&nbsp;19.2.&nbsp;Possible values for the faxdetect option in sip.conf</strong></p><div class="table-contents"><table summary="Possible values for the faxdetect option in sip.conf" border="1"><colgroup><col><col></colgroup><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td>
                <code class="literal">cng</code>
              </td><td>Enables fax detection by watching the audio for a CNG
              tone. If a CNG tone is detected, redirects the call to the
              <code class="literal">fax</code> extension in the dialplan.</td></tr><tr><td>
                <code class="literal">t38</code>
              </td><td>Redirects the call to the <code class="literal">fax</code>
              extension in the dialplan if a T.38 reinvite is
              received.</td></tr><tr><td>
                <code class="literal">yes</code>
              </td><td>Enables both <code class="literal">cng</code> and
              <code class="literal">t38</code> fax detection.</td></tr><tr><td>
                <code class="literal">no</code>
              </td><td>Disables fax detection. This is the default.<a id="I_indexterm19_d1e43662" class="indexterm"></a><a id="I_indexterm19_d1e43663" class="indexterm"></a></td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="Outgoing Fax Handling"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id265396"></a>Outgoing Fax Handling</h2></div></div></div><p><a id="Fax_id265402"></a><a id="index-527E166JK1N" class="indexterm"></a><a id="index-040C830NV7A" class="indexterm"></a>Transmitting faxes from Asterisk is somewhat more difficult
    than receiving them. The reason for this is simply due to the fact that
    the preparation of the fax prior to transmission involves more work. There
    isn’t anything particularly complex about fax transmittal, but you will
    need to make some design decisions about things like:</p><div class="itemizedlist"><a id="Fax_id337562"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Fax_id337565"></a><a id="Fax_id337567"></a>How to get the source fax file formatted for
        Asterisk</p></li><li class="listitem"><p><a id="Fax_id337571"></a><a id="Fax_id337573"></a>How to get the source fax file onto the
        Asterisk system (specifically, into some folder where Asterisk can
        access it)</p></li><li class="listitem"><p><a id="Fax_id269327"></a><a id="Fax_id269329"></a>What to do with transmitted faxes (save them?
        delete them? move them somewhere?)</p></li><li class="listitem"><p><a id="Fax_id269335"></a><a id="Fax_id269337"></a>How to handle transmission errors</p></li></ul></div><div class="sect2" title="Transmitting a Fax from Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id36060960"></a>Transmitting a Fax from Asterisk</h3></div></div></div><p><a id="Fax_id36060965"></a><a id="I_indexterm19_d1e43695" class="indexterm"></a><a id="I_indexterm19_d1e43702" class="indexterm"></a>To transmit a fax from Asterisk, you must have a TIFF
      file. How you generate this TIFF is important, and may involve many
      steps. However, from Asterisk’s perspective the sending of a fax is
      fairly straightforward. You simply run the
      <span class="application"><code class="literal">SendFAX()</code></span> dialplan
      application,<a id="I_indexterm19_d1e43712" class="indexterm"></a><a id="I_indexterm19_d1e43715" class="indexterm"></a> passing it the path to a valid TIFF file:</p><p><a id="Fax_id36060973"></a><a id="Fax_id36060974"></a></p><pre class="programlisting">exten =&gt; faxthis,1,SendFAX(/path/to/fax/file,d)</pre><p>In
      practice, you will normally want to set some parameters prior to
      transmission, so a complete extension for sending a fax using Digium’s
      Fax For Asterisk might look something like this:</p><p><a id="Fax_id36060982"></a>
        <a id="Fax_id36060983"></a></p><pre class="programlisting">exten =&gt; faxthis,1,Verbose(2,Set options and transmit fax)

; some folder where your outgoing faxes will be found
  same =&gt; n,Set(faxlocation=/tmp) 

; In production you would probably not want to hardcode the filename
  same =&gt; n,Set(faxfile=faxfile.tif) 
  same =&gt; n,Set(FAXOPT(headerinfo)=Fax from ShiftEight.org)
  same =&gt; n,Set(FAXOPT(localstationid=4169671111)
  same =&gt; n,SendFax(${faxlocation}/${faxfile})
</pre><p>
      </p></div><div class="sect2" title="File Format for Faxing"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id418840"></a>File Format for Faxing</h3></div></div></div><p><a id="Fax_id418845"></a><a id="I_indexterm19_d1e43732" class="indexterm"></a><a id="I_indexterm19_d1e43739" class="indexterm"></a><a id="I_indexterm19_d1e43744" class="indexterm"></a>The real trick of sending a fax is having a source file
      that is in a format that the fax engine can handle. At a basic level,
      these files are known as TIFF files; however, the TIFF spec allows for
      all sorts of parameters, not all of which are compatible with fax and
      not many of which are documented in any useful way. Additionally, the
      types of TIFF formats that spandsp can handle are different from those
      Digium FFA will handle.</p><p><a id="Fax_id418851"></a>In the absence of one simple, clear
      specification of what TIFF file format will work for sending faxes from
      Asterisk, we will instead document what we know to work, and leave it up
      to the reader to perform any experimentation required to find other ways
      to generate the TIFF.<sup>[<a id="id629757" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id629757" class="footnote">165</a>]</sup></p><p><a id="Fax_id312196"></a>Digium’s <span class="emphasis"><em>Fax For Asterisk
      Administration Manual</em></span> documents a process for converting a
      PDF file into a TIFF using commonly available Linux command-line tools.
      While kludgy, this method should allow you to build Linux scripts to
      handle the file conversion, and your users will be able to submit PDFs
      as fax jobs.</p><p><a id="Fax_id312202"></a>You will need the <span class="command"><strong>ghostscript</strong></span>
      PDF interpreter,<a id="I_indexterm19_d1e43765" class="indexterm"></a> which can be installed in CentOS by the command:</p><a id="Fax_id312206"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum -y install ghostscript</code></strong></pre><p><a id="Fax_id332175"></a>and in Ubuntu with:</p><a id="Fax_id332178"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install ghostscript</code></strong></pre><p><a id="Fax_id393495"></a>Once installed, <span class="command"><strong>ghostscript</strong></span>
      can convert the PDF into an Asterisk-compatible TIFF file with the
      following command:</p><a id="Fax_id332196"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>gs -q -dNOPAUSE -dBATCH -sDEVICE=tiffg4 -sPAPERSIZE=letter -sOutputFile=<em class="replaceable"><code>&lt;dest&gt;</code></em> <em class="replaceable"><code>&lt;src&gt;</code></em></code></strong></pre><p><a id="Fax_id393497"></a>Replace <em class="replaceable"><code>&lt;dest&gt;</code></em>
      with the name of the output file, and specify the location of your
      source PDF with <em class="replaceable"><code>&lt;src&gt;</code></em>.</p><p><a id="Fax_id393499"></a>The <span class="command"><strong>ghostscript</strong></span> program
      should create a TIFF file from your PDF that will be suitable for
      transmission using Asterisk
      <span class="application"><code class="literal">SendFax()</code></span>.</p></div><div class="sect2" title="An Experiment in Email to Fax"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id329361"></a>An Experiment in Email to Fax</h3></div></div></div><p><a id="Fax_id329367"></a><a id="I_indexterm19_d1e43821" class="indexterm"></a><a id="I_indexterm19_d1e43828" class="indexterm"></a><a id="I_indexterm19_d1e43833" class="indexterm"></a>Many users would like to be able to send emails as fax
      documents. The primary challenge with this is ensuring that what the
      users submit is in a format suitable for faxing. This ultimately
      requires some form of application development, which is outside the
      scope of this book.</p><p><a id="Fax_id306531"></a>What we have done is provided a simple example
      of some methods that at least provide a starting point for delivering
      email to fax capabilities.</p><p><a id="Fax_id306536"></a>One of the first changes that you would need to
      make in order to handle this is a change to your
      <code class="filename">/etc/aliases</code> file, which will redirect incoming
      faxes to an application that can handle them. We are not actually aware
      of any app that can do this, so you’ll have to write one. The change to
      your <code class="filename">/etc/aliases</code> file would look something like
      this:</p><a id="Fax_id306548"></a><pre class="programlisting">fax:   "| <em class="replaceable"><code>/path/to/program/that/will/handle/incoming/fax/emails</code></em>"</pre><p><a id="Fax_id306551"></a>In our case, Russell built a little Python
      script called <code class="filename">fax.py</code>,<a id="I_indexterm19_d1e43859" class="indexterm"></a> so our <code class="filename">/etc/aliases</code> file would read
      something like this:</p><a id="Fax_id306561"></a><pre class="programlisting">fax:   "| /asteriskpbx/fax.py"</pre><p><a id="Fax_id306564"></a>We have included a copy of the Python script we
      developed for your reference in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#email-to-fax-python" title="Example 19.1. Proof of concept email to fax gateway, fax.py">Example&nbsp;19.1, “Proof of concept email to fax gateway, fax.py”</a>.
      Note that this file is not suitable for production, but merely serves as
      an example of how a very basic kind of email to fax functionality might
      be implemented.</p><div class="example"><a id="email-to-fax-python"></a><p class="title"><strong>Example&nbsp;19.1.&nbsp;Proof of concept email to fax gateway, fax.py</strong></p><div class="example-contents"><p><a id="Fax_id339915"></a>
          <a id="Fax_id339916"></a></p><pre class="programlisting">#!/usr/bin/env python
"""Poor Man's Email to Fax Gateway.

This is a proof of concept email to fax gateway.  There are multiple aspects
that would have to be improved for it to be used in a production environment.

Copyright (C) 2010 - Russell Bryant, Leif Madsen, Jim Van Meggelen
Asterisk: The Definitive Guide
"""

import sys
import os
import email
import base64
import shutil
import socket


AMI_HOST = "localhost"
AMI_PORT = 5038
AMI_USER = "hello"
AMI_PASS = "world"

# This script will pull a TIFF out of an email and save it off to disk to allow
# the SendFax() application in Asterisk to send it.  This is the location on
# disk where the TIFF will be stored.
TIFF_LOCATION = "/tmp/loremipsum.tif"


# Read an email from stdin and parse it.
msg = email.message_from_file(sys.stdin)

# For testing purposes, if you wanted to read an email from a file, you could
# do this, instead.
#try:
#    f = open("email.txt", "r")
#    msg = email.message_from_file(f)
#    f.close()
#except IOError:
#    print "Failed to open email input file."
#    sys.exit(1)

# This next part pulls out a TIFF file attachment from the email and saves it
# off to disk in a format that can be used by the SendFax() application.  This
# part of the script is incredibly non-flexible.  It assumes that the TIFF file
# will be in a specific location in the structure of the message (the second
# part of the payload, after the main body).  Further, it assumes that the
# encoding of the TIFF attachment is base64.  This was the case for the test
# email that we were using that we generated with mutt.  Emails sent by users'
# desktop email clients will vary in _many_ ways.  To be used with user-
# generated emails, this section would have to be much more flexible.
try:
    f2 = open(TIFF_LOCATION, "w")
    f2.write(base64.b64decode(msg.get_payload()[1].get_payload().replace("\n", "")))
    f2.close()
except IOError:
    print "Failed to open file for saving off TIFF attachment."
    sys.exit(1)

# Now that we have a TIFF file to fax, connect to the Asterisk Manager Interface
# to originate a call.
ami_commands = """Action: Login\r
Username: %s\r
Secret: %s\r
\r
Action: Originate\r
Channel: Local/s@sendfax/n\r
Context: receivefax\r
Extension: s\r
Priority: 1\r
SetVar: SUBJECT=%s\r
\r
Action: Logoff\r
\r
""" % (AMI_USER, AMI_PASS, msg['subject'])

print ami_commands

def my_send(s, data):
    """Ensure that we send out the whole data buffer.
    """
    sent = 0
    while sent &lt; len(data):
        res = s.send(data[sent:])
        if res == 0:
            break
        sent = sent + res

def my_recv(s):
    """Read input until there is nothing else to read.
    """
    while True:
        res = s.recv(4096)
        if len(res) == 0:
            break
        print res

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((AMI_HOST, AMI_PORT))
my_send(s, ami_commands)
my_recv(s)
s.shutdown(socket.SHUT_RDWR)
s.close()
</pre><p>
        </p></div></div><br class="example-break"><p><a id="Fax_id339920"></a>We tested this out at a very rudimentary level,
      and proved the basic concept. If you want to put email to fax into
      production, you need to understand that you will have more work to do on
      the application development side in order to deliver something that will
      actually be robust enough to turn over to an average group of
      users.<a id="I_indexterm19_d1e43880" class="indexterm"></a><a id="I_indexterm19_d1e43881" class="indexterm"></a></p></div></div><div class="sect1" title="Fax Pass-Through"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id36043799"></a>Fax Pass-Through</h2></div></div></div><p><a id="Fax_id36041486"></a><a id="I_indexterm19_d1e43888" class="indexterm"></a>In theory, it should be possible to connect a traditional
    fax machine to an FXS port of some sort and then pass incoming faxes to
    that device (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36038507" title="Figure 19.1. Typical fax pass-through">Figure&nbsp;19.1, “Typical fax pass-through”</a>). This concept is
    attractive for a few reasons:</p><div class="orderedlist"><a id="Fax_id36041322"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="Fax_id36041324"></a><a id="Fax_id36040877"></a>It allows you to integrate existing fax
        machines with your Asterisk system.</p></li><li class="listitem"><p><a id="Fax_id36040882"></a><a id="Fax_id36039813"></a>It requires far less configuration in the
        dialplan.</p></li></ol></div><p><a id="Fax_id36038501"></a>Unfortunately, fax pass-through is not the home
    run we would like it to be. The analog carrier signal that two fax
    machines use to communicate is a delicate thing, and any corruption of
    that signal will often cause a transmission failure. In an Asterisk system
    performing pass-through, internal timing issues, coupled with signal
    attenuation, can create an environment that is unstable for fax use,
    especially for larger (multipage) faxes.</p><p><a id="Fax_id36038506"></a>
      </p><div class="figure-float"><div class="figure"><a id="Fax_id36038507"></a><p class="title"><strong>Figure&nbsp;19.1.&nbsp;Typical fax pass-through</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject19_d1e43909"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_1901.png" alt="Typical fax pass-through"></div></div></div><br class="figure-break"></div><p>
    </p><p><a id="Fax_id405192"></a>If you are using fax on a casual basis (mostly
    noncritical, one-page faxes), this sort of setup can work well. If faxing
    is critical to your business, or you are often expecting multipage faxes,
    we must reluctantly recommend that you connect your fax machines directly
    to the PSTN and leave Asterisk out of it.</p><div class="sect2" title="Using Fax Buffers in chan_dahdi.conf"><div class="titlepage"><div><div><h3 class="title"><a id="Fax_id405211"></a>Using Fax Buffers in chan_dahdi.conf</h3></div></div></div><p><a id="Fax_id405217"></a>Many of the problems with fax pass-through are
      caused by inconsistent timing. Since faxes are more tolerant of latency
      than voice calls (a fax has to be able to travel halfway around the
      world, which takes a few dozen milliseconds), the introduction of a
      buffer in DAHDI (which is strictly used for faxes) has reportedly
      corrected many of the problems that have plagued fax
      pass-through.</p><p><a id="Fax_id405224"></a>As of this writing, this is a fairly new
      configuration option. The currently preferred setting is as
      follows:</p><a id="Fax_id347626"></a><pre class="programlisting">faxbuffers =&gt; 12,half</pre><p><a id="Fax_id406047"></a>This would be placed in your
      <code class="filename">/etc/asterisk/chan_dahdi.conf</code> file and would cause
      <code class="filename">chan_dahdi</code> to create a 96 ms buffer for fax calls
      and delay start of transmission until the buffer was half full.</p><p><a id="Fax_id406052"></a>You would also need to set
      <code class="literal">faxdetect</code>, since the fax buffers are part of the
      <code class="literal">faxdetect</code> functionality:</p><a id="Fax_id327817"></a><pre class="programlisting">faxdetect = both</pre><p><a id="Fax_id406061"></a>We have not extensively tested this capability
      yet, but anecdotal evidence suggests that this should greatly improve
      the performance of fax pass-through in Asterisk.</p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Fax_id245657"></a>Conclusion</h2></div></div></div><p><a id="Fax_id245663"></a>Fax is a technology whose days are behind it.
    Having said that, it remains popular. Asterisk has some interesting
    technology built into it that allows you some level of creativity in how
    you handle faxes. With careful planning and system design, and a patient
    prototyping and debugging phase, you can use your Asterisk system to
    handle faxing in creative ways.<a id="I_indexterm19_d1e43951" class="indexterm"></a><a id="I_indexterm19_d1e43952" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id629757" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id629757" class="para">165</a>] </sup>One format we tried was using the Microsoft Office Document
          Image Writer, which offers “TIFF-monochrome fax” as an output
          format. This seemed too good to be true, which is exactly what it
          turned out to be (neither spandsp nor Digium FFA could handle the
          resulting file). It would have been ideal to have found something
          common to Windows PCs that could be used by users to “print” an
          Asterisk-compatible TIFF file.</p></div></div></div><div class="chapter" title="Chapter 20. Asterisk Manager Interface (AMI)"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-AMI"></a>Chapter&nbsp;20.&nbsp;Asterisk Manager Interface (AMI)</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart">Quick Start</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-TCP">AMI over TCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-configuration">Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248378">Protocol Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248495">Message Encoding</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248511">Events</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-HTTP">AMI over HTTP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248633">Authentication and session handling</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248689">/rawman encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248704">/manager encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248743">/mxml encoding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248859">Development Frameworks</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283296">CSTA</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-applications">Interesting Applications</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283341">AsteriskGUI</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283424">Flash Operator Panel</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283482">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="AMI_id261958"></a>John Malkovich: I have seen a world that <span class="keep-together">NO man should see!</span></p><p><a id="AMI_id276510"></a>Craig Schwartz: Really? Because for most people
    it’s a rather enjoyable experience.</p><div class="attribution"><span>—<span class="attribution">
      <span class="emphasis"><em>Being John Malkovich</em></span>
    </span></span></div></div><p><a id="AMI_id267196"></a><a id="index-626B523OF3O" class="indexterm"></a><a id="index-184P437PW0P" class="indexterm"></a>The Asterisk Manager Interface (AMI) is a system monitoring
  and management interface provided by Asterisk. It allows live monitoring of
  events that occur in the system, as well enabling you to request that
  Asterisk perform some action. The actions that are available are
  wide-ranging and include things such as returning status information and
  originating new calls. Many interesting applications have been developed on
  top of Asterisk that take advantage of the AMI as their primary interface to
  Asterisk.</p><div class="sect1" title="Quick Start"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI-quickstart"></a>Quick Start</h2></div></div></div><p><a id="AMI_id244791"></a><a id="index-115I407NV0L" class="indexterm"></a>This section is for getting your hands dirty with the AMI as
    quickly as possible. First, put the following configuration in
    <code class="filename">/etc/asterisk/manager.conf</code>:</p><a id="AMI_id269468"></a><pre class="programlisting">;
; Turn on the AMI and ask it to only accept connections from localhost.
;
[general]
enabled = yes
webenabled = yes
bindaddr = 127.0.0.1

;
; Create an account called "hello", with a password of "world"
;
[hello]
secret=world
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AMI_id285737"></a>This sample configuration is set up to only
      allow local connections to the AMI. If you intend on making this
      interface available over a network, it is strongly recommended that you
      only do so using TLS. The use of TLS is discussed in more detail later
      in this chapter.</p></div><p><a id="AMI_id269725"></a>Once the AMI configuration is ready, enable the
    built-in HTTP server by putting the following contents in
    <code class="filename">/etc/asterisk/http.conf</code>:</p><a id="AMI_id281272"></a><pre class="programlisting">;
; Enable the built-in HTTP server, and only listen for connections on localhost.
;
[general]
enabled = yes
bindaddr = 127.0.0.1</pre><div class="sect2" title="AMI over TCP"><div class="titlepage"><div><div><h3 class="title"><a id="AMI-quickstart-TCP"></a>AMI over TCP</h3></div></div></div><p><a id="AMI_id256605"></a><a id="I_indexterm20_d1e44005" class="indexterm"></a><a id="I_indexterm20_d1e44012" class="indexterm"></a>There are multiple ways to connect to the AMI, but a TCP
      socket is the most common. We will use
      <span class="command"><strong>telnet</strong></span><a id="I_indexterm20_d1e44020" class="indexterm"></a> to demonstrate AMI connectivity. This example shows these
      steps:</p><div class="orderedlist"><a id="AMI_id256262"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="AMI_id267924"></a><a id="AMI_id244501"></a>Connect to the AMI over a TCP socket on port
          5038.</p></li><li class="listitem"><p><a id="AMI_id259350"></a><a id="AMI_id259352"></a>Log in using the <code class="literal">Login</code>
          action.</p></li><li class="listitem"><p><a id="AMI_id259360"></a><a id="AMI_id259362"></a>Execute the <code class="literal">Ping</code>
          action.</p></li><li class="listitem"><p><a id="AMI_id259369"></a><a id="AMI_id259371"></a>Log off using the <code class="literal">Logoff</code>
          action.</p></li></ol></div><p>Here’s how the AMI responds to those actions:</p><a id="AMI_id244524"></a><pre class="screen">$ <strong class="userinput"><code>telnet localhost 5038</code></strong>
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
Asterisk Call Manager/1.1
<strong class="userinput"><code>Action: Login
Username: hello
Secret: world
</code></strong>
Response: Success
Message: Authentication accepted

<strong class="userinput"><code>Action: Ping</code></strong>

Response: Success
Ping: Pong
Timestamp: 1282739190.454046

<strong class="userinput"><code>Action: Logoff</code></strong>

Response: Goodbye
Message: Thanks for all the fish.

Connection closed by foreign host.</pre><p><a id="AMI_id244542"></a>Once you have this working, you have verified
      that AMI is accepting connections via a TCP connection.</p></div><div class="sect2" title="AMI over HTTP"><div class="titlepage"><div><div><h3 class="title"><a id="AMI-quickstart-HTTP"></a>AMI over HTTP</h3></div></div></div><p><a id="AMI_id244556"></a><a id="I_indexterm20_d1e44068" class="indexterm"></a><a id="I_indexterm20_d1e44075" class="indexterm"></a>It is also possible to use the AMI over HTTP. In this
      section we will perform the same actions as before, but over HTTP
      instead of the native TCP interface to the AMI. The responses will be
      delivered over HTTP in the same format as the previous example, since
      the <code class="literal">rawman</code> encoding type is being used. AMI-over-HTTP
      responses can be encoded in other formats, such as XML. These
      response-formatting options are covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-HTTP" title="AMI over HTTP">the section called “AMI over HTTP”</a>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AMI_id262606"></a>Accounts used for connecting to the AMI over
        HTTP are the same accounts <a id="I_indexterm20_d1e44087" class="indexterm"></a>configured in
        <code class="filename">/etc/asterisk/manager.conf</code>.</p></div><p>This example demonstrates how to access the AMI over HTTP, log in,
      execute the <code class="literal">Ping</code> action, and log off:</p><a id="AMI_id262615"></a><pre class="screen">$ <strong class="userinput"><code>wget "http://localhost:8088/rawman?action=login&amp;username=hello&amp;secret=world" \
&gt; --save-cookies cookies.txt -O -</code></strong>

--2010-08-31 12:34:23--
Resolving localhost... 127.0.0.1
Connecting to localhost|127.0.0.1|:8088... connected.
HTTP request sent, awaiting response... 200 OK
Length: 55 [text/plain]
Saving to: `STDOUT'

Response: Success
Message: Authentication accepted

2010-08-31 12:34:23 (662 KB/s) - written to stdout [55/55]


$ <strong class="userinput"><code>wget "http://localhost:8088/rawman?action=ping" --load-cookies cookies.txt -O -</code></strong>

--2010-08-31 12:34:23--
Resolving localhost... 127.0.0.1
Connecting to localhost|127.0.0.1|:8088... connected.
HTTP request sent, awaiting response... 200 OK
Length: 63 [text/plain]
Saving to: `STDOUT'

Response: Success
Ping: Pong
Timestamp: 1283258063.040293

2010-08-31 12:34:23 (775 KB/s) - written to stdout [63/63]


$ <strong class="userinput"><code>wget "http://localhost:8088/rawman?action=logoff" --load-cookies cookies.txt -O -</code></strong>

--2010-08-31 12:34:23--
Resolving localhost... 127.0.0.1
Connecting to localhost|127.0.0.1|:8088... connected.
HTTP request sent, awaiting response... 200 OK
Length: 56 [text/plain]
Saving to: `STDOUT'

Response: Goodbye
Message: Thanks for all the fish.

2010-08-31 12:34:23 (696 KB/s) - written to stdout [56/56]
</pre><p><a id="AMI_id265359"></a>The HTTP interface to AMI lets you integrate
      Asterisk call control into a web service.<a id="I_indexterm20_d1e44114" class="indexterm"></a></p></div></div><div class="sect1" title="Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI-configuration"></a>Configuration</h2></div></div></div><p><a id="AMI_id265373"></a><a id="index-026A864GI7A" class="indexterm"></a><a id="index-166U360IK0I" class="indexterm"></a>The section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart" title="Quick Start">the section called “Quick Start”</a> showed a very
    basic set of configuration files to get you started. However, there are
    many more options available for the AMI.</p><div class="sect2" title="manager.conf"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id265383"></a>manager.conf</h3></div></div></div><p><a id="AMI_id265390"></a><a id="index-784W564QP2E" class="indexterm"></a><a id="index-442A544JS8T" class="indexterm"></a><a id="index-143I086IK8U" class="indexterm"></a><a id="index-715F171KV7I" class="indexterm"></a>The main configuration file for the AMI is
      <code class="filename">/etc/asterisk/manager.conf</code>. The
      <code class="literal">[general]</code> section contains options (listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265404" title="Table 20.1. Options in the manager.conf [general] section">Table&nbsp;20.1, “Options in the manager.conf [general] section”</a>) that control the overall operation of the
      AMI. Any other sections in the <code class="filename">manager.conf</code> file
      will define accounts for logging in and using the AMI.<a id="I_indexterm20_d1e44171" class="indexterm"></a></p><div class="table"><a id="AMI_id265404"></a><p class="title"><strong>Table&nbsp;20.1.&nbsp;Options in the manager.conf [general] section</strong></p><div class="table-contents"><table summary="Options in the manager.conf [general] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Description</th></tr></thead><tbody><tr><td>
                <code class="literal">enabled</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44195" class="indexterm"></a>yes</code>
              </td><td>Enables the AMI. The default is
              <code class="literal">no</code>.</td></tr><tr><td>
                <code class="literal">webenabled</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44210" class="indexterm"></a>yes</code>
              </td><td>Allows access to the AMI through the built-in HTTP
              server. The default is <code class="literal">no</code>.<sup>[<a id="id631296" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id631296" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">port</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44231" class="indexterm"></a>5038</code>
              </td><td>Sets the port number to listen on for AMI connections.
              The default is <code class="literal">5038</code>.</td></tr><tr><td>
                <code class="literal">bindaddr</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44246" class="indexterm"></a>127.0.0.1</code>
              </td><td>Sets the address to listen on for AMI connections. The
              default is to listen on all addresses
              (<code class="literal">0.0.0.0</code>). However, it is highly recommended
              to set this to <code class="literal">127.0.0.1</code>.</td></tr><tr><td>
                <code class="literal">tlsenable</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44264" class="indexterm"></a>yes</code>
              </td><td>Enables listening for AMI connections using TLS. The
              default is <code class="literal">no</code>. It is highly recommended to
              only expose connectivity via TLS outside of the local <span class="keep-together">machine</span>.<sup>[<a id="id631443" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id631443" class="footnote">b</a>]</sup></td></tr><tr><td>
                <code class="literal">tlsbindport</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44291" class="indexterm"></a>5039</code>
              </td><td>Sets the port to listen on for TLS connections to the
              AMI. The default is <code class="literal">5039</code>.</td></tr><tr><td>
                <code class="literal">tlsbindaddr</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44306" class="indexterm"></a>0.0.0.0</code>
              </td><td>Sets the address to listen on for TLS-based AMI
              connections. The default is to listen on all addresses
              (<code class="literal">0.0.0.0</code>).</td></tr><tr><td>
                <code class="literal">tlscertfile</code>
              </td><td>
                <code class="filename"><a id="I_indexterm20_d1e44321" class="indexterm"></a>/var/lib/asterisk/keys/asterisk.pem</code>
              </td><td>Sets the path to the server certificate for TLS. This is
              required if <code class="literal">tlsenable</code> is set to
              <code class="literal">yes</code>.</td></tr><tr><td>
                <code class="literal">tlsprivatekey</code>
              </td><td>
                <code class="filename"><a id="I_indexterm20_d1e44339" class="indexterm"></a>/var/lib/asterisk/keys/private.pem</code>
              </td><td>Sets the path to the private key for TLS. If this is not
              specified, the <code class="literal">tlscertfile</code> will be checked to
              see if it also contains the private key.</td></tr><tr><td>
                <code class="literal">tlscipher</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44354" class="indexterm"></a>&lt;cipher string&gt;</code>
              </td><td>Specifies a list of ciphers for
              <span class="application">OpenSSL</span> to use. Setting this is
              optional. To see a list of available ciphers, run
              <span class="command"><strong>openssl ciphers -v</strong></span> at the command
              line.</td></tr><tr><td>
                <code class="literal">allowmultiplelogin</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44372" class="indexterm"></a>no</code>
              </td><td>Allows the same account to make more than one connection
              at the same time. The default is <code class="literal">yes</code>.</td></tr><tr><td>
                <code class="literal">displayconnects</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44388" class="indexterm"></a>yes</code>
              </td><td>Reports connections to the AMI as verbose messages
              printed to the Asterisk console. This is usually useful, but it
              can get in the way on a system that uses scripts that make a lot
              of connections to the AMI. The default is
              <code class="literal">yes</code>.</td></tr><tr><td>
                <code class="literal">timestampevents</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44403" class="indexterm"></a>no</code>
              </td><td>Adds a Unix epoch-based timestamp to every event reported
              to the AMI. The default is <code class="literal">no</code>.</td></tr><tr><td>
                <code class="literal">brokeneventsaction</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44418" class="indexterm"></a>no</code>
              </td><td>Restores previously broken behavior for the
              <code class="literal">Events</code> AMI action, where a response would not
              be sent in some circumstances. This option is there for the sake
              of backward-compatibility for applications that worked around a
              bug and should not be used unless absolutely necessary. The
              default is <code class="literal">no</code>.</td></tr><tr><td>
                <code class="literal">channelvars</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44436" class="indexterm"></a>VAR1,VAR2,VAR3[,VAR4[...]]</code>
              </td><td>Specifies a list of channel variables to include with all
              manager events that are channel-oriented. The default is to
              include no channel variables.</td></tr><tr><td>
                <code class="literal">debug</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44448" class="indexterm"></a>no</code>
              </td><td>Enables some additional debugging in the AMI code. This
              is primarily there for developers of the Asterisk C code. The
              default is <code class="literal">no</code>.</td></tr><tr><td>
                <code class="literal">httptimeout</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44463" class="indexterm"></a>60</code>
              </td><td>Sets the HTTP timeout, in seconds. This timeout affects
              users of the AMI over HTTP: it sets the
              <code class="literal">Max-Age</code> of the HTTP cookie, sets how long
              events are cached to allow retrieval of the events over HTTP
              using the <code class="literal">WaitEvents</code> action, and the amount
              of time that the HTTP server keeps a session alive after
              completing an AMI action. The default is <code class="literal">60</code>
              seconds.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id631296" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id631296" class="para">a</a>] </sup>To access the AMI over HTTP, the
                  built-in HTTP server must also be configured in
                  <code class="filename">/etc/asterisk/http.conf</code>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id631443" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id631443" class="para">b</a>] </sup>The OpenSSL development package must
                  be installed for Asterisk to be able to use encryption. On
                  Ubuntu, the package is <code class="filename">libssl-dev</code>. On
                  CentOS, the package is
                  <code class="filename">openssl-devel</code>.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="AMI_id286542"></a>The <code class="filename">manager.conf</code>
      configuration file also contains the configuration of AMI user accounts.
      An account is created by adding a section with the username inside
      square brackets. Within each
      <code class="literal">[<em class="replaceable"><code>username</code></em>]</code> section there
      are options that can be set that will apply only to that account. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id286564" title="Table 20.2. Options for [username] sections">Table&nbsp;20.2, “Options for [username] sections”</a> lists the options available in a
      <code class="literal">[<em class="replaceable"><code>username</code></em>]</code>
      section.<a id="I_indexterm20_d1e44497" class="indexterm"></a></p><div class="table"><a id="AMI_id286564"></a><p class="title"><strong>Table&nbsp;20.2.&nbsp;Options for [username] sections</strong></p><div class="table-contents"><table summary="Options for [username] sections" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Description</th></tr></thead><tbody><tr><td>
                <code class="literal">secret</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44519" class="indexterm"></a>password</code>
              </td><td>Sets the password used for authentication. This must be
              set.</td></tr><tr><td>
                <code class="literal">deny</code>
              </td><td>
                <code class="literal">0.0.0.0/0.0.0.0</code>
              </td><td>Sets an IP address Access Control List (ACL) for
              addresses that should be denied the ability to authenticate as
              this user. By default this option is not set.</td></tr><tr><td>
                <code class="literal">permit</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44540" class="indexterm"></a>192.168.1.0/255.255.255.0</code>
              </td><td>Sets an IP address ACL for addresses that should be
              allowed to authenticate as this user. As with
              <code class="literal">deny</code>, by default this option is not set.
              Without these options set, any IP address that can reach the AMI
              will be allowed to authenticate as this user.</td></tr><tr><td>
                <code class="literal">writetimeout</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44555" class="indexterm"></a>100</code>
              </td><td>Sets the timeout used by Asterisk when writing data to
              the AMI connection for this user. This option is specified in
              milliseconds. The default value is
              <code class="literal">100</code>.</td></tr><tr><td>
                <code class="literal">display</code>
                <code class="literal">connects</code>
              </td><td><a id="I_indexterm20_d1e44571" class="indexterm"></a>yes</td><td>Also available in the <code class="literal">[general]</code>
              section (refer to <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265404" title="Table 20.1. Options in the manager.conf [general] section">Table&nbsp;20.1, “Options in the manager.conf [general] section”</a></span>), but can be controlled on a
              per-user basis.</td></tr><tr><td>
                <code class="literal">read</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44589" class="indexterm"></a>system,call[,...]</code>
              </td><td>Defines which manager events this user will receive. By
              default, the user will receive no events. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-readwriteopts" title="Table 20.3. Available values for AMI user account read/write options">Table&nbsp;20.3, “Available values for AMI user account read/write
        options”</a> covers the available permission
              types for the <code class="literal">read</code> and
              <code class="literal">write</code> options.</td></tr><tr><td>
                <code class="literal">write</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44609" class="indexterm"></a>system,call[,...]</code>
              </td><td>Defines which manager actions this user is allowed to
              execute. By default, the user will not be able to execute any
              actions. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-readwriteopts" title="Table 20.3. Available values for AMI user account read/write options">Table&nbsp;20.3, “Available values for AMI user account read/write
        options”</a> covers the
              available permission types for the <code class="literal">read</code> and
              <code class="literal">write</code> options.</td></tr><tr><td>
                <code class="literal">eventfilter</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e44629" class="indexterm"></a>!Channel: DAHDI*</code>
              </td><td>
                <p><a id="AMI_id286763"></a>Used to provide a whitelist- or
              blacklist-style filtering of manager events before they are
              delivered to the AMI client application. Filters are specified
              using a regular expression. A specified filter is a whitelist
              filter unless preceded by an exclamation point.<sup>[<a id="id632426" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id632426" class="footnote">a</a>]</sup></p>
              </td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id632426" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id632426" class="para">a</a>] </sup>If no filters are specified, all
                  events that are allowed based on the <code class="literal">read</code>
                  option will be delivered. If only whitelist filters have
                  been specified, only events that match one of the filters
                  will be delivered. If there are only blacklist-style
                  filters, all events that do not match any of the filters
                  will be delivered. Finally, if there is a mix of whitelist-
                  and blacklist-style filters, the whitelist filters will be
                  processed first, and then the blacklist filters.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="AMI_id286788"></a>As discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id286564" title="Table 20.2. Options for [username] sections">Table&nbsp;20.2, “Options for [username] sections”</a>,
      the <code class="literal">read</code> and <code class="literal">write</code> options set
      which manager actions and manager events a particular user has access
      to. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-readwriteopts" title="Table 20.3. Available values for AMI user account read/write options">Table&nbsp;20.3, “Available values for AMI user account read/write
        options”</a> shows the available permission
      values that can be specified for these options.<a id="I_indexterm20_d1e44654" class="indexterm"></a></p><div class="table"><a id="AMI-readwriteopts"></a><p class="title"><strong>Table&nbsp;20.3.&nbsp;Available values for AMI user account read/write
        options</strong></p><div class="table-contents"><table summary="Available values for AMI user account read/write
        options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center"><span class="keep-together">Permission</span> identifier</th><th align="center">read</th><th align="center">write</th></tr></thead><tbody><tr><td>
                <code class="literal">all</code>
              </td><td><a id="I_indexterm20_d1e44677" class="indexterm"></a>Shorthand way of specifying that this user should
              have access to all available privilege options.</td><td>Grants user all privilege options.</td></tr><tr><td>
                <code class="literal">system</code>
              </td><td><a id="I_indexterm20_d1e44688" class="indexterm"></a>Allows user to receive general system information,
              such as notifications of configuration reloads.</td><td>Allows user to perform system management commands such as
              <span class="command"><strong>Restart</strong></span>, <span class="command"><strong>Reload</strong></span>, or
              <span class="command"><strong>Shutdown</strong></span>.</td></tr><tr><td>
                <code class="literal">call</code>
              </td><td><a id="I_indexterm20_d1e44708" class="indexterm"></a>Allows user to receive events about channels on
              the system.</td><td>Allows user to set information on channels.</td></tr><tr><td>
                <code class="literal">log</code>
              </td><td><a id="I_indexterm20_d1e44719" class="indexterm"></a>Gives user access to logging information.<sup>[<a id="id632665" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id632665" class="footnote">a</a>]</sup></td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">verbose</code>
              </td><td><a id="I_indexterm20_d1e44735" class="indexterm"></a>Gives user access to verbose logging <span class="keep-together">information</span>.<sup>[<a id="id632712" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id632712" class="footnote">b</a>]</sup></td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">agent</code>
              </td><td><a id="I_indexterm20_d1e44754" class="indexterm"></a>Gives user access to events regarding the status
              of agents from the <code class="literal">app_queue</code> and
              <code class="literal">chan_agent</code> modules.</td><td>Enables user to perform actions for managing and
              retrieving the status of queues and agents.</td></tr><tr><td>
                <code class="literal">user</code>
              </td><td><a id="I_indexterm20_d1e44771" class="indexterm"></a>Grants access to user-defined events, as well as
              events about Jabber/XMPP users.</td><td>Lets user perform the <code class="literal">UserEvent</code>
              manager <span class="keep-together">action</span>, which
              provides the ability to request that <span class="keep-together">Asterisk</span> generate a user-defined
              event.<sup>[<a id="id632817" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id632817" class="footnote">c</a>]</sup></td></tr><tr><td>
                <code class="literal">config</code>
              </td><td><code class="literal"><a id="I_indexterm20_d1e44798" class="indexterm"></a>write</code>-only</td><td>Allows user to retrieve, update, and reload configuration
              files.</td></tr><tr><td>
                <code class="literal">command</code>
              </td><td><code class="literal"><a id="I_indexterm20_d1e44811" class="indexterm"></a>write</code>-only</td><td>Allows user to execute
              <span class="application">Asterisk</span> CLI commands over the
              AMI.</td></tr><tr><td>
                <code class="literal">dtmf</code>
              </td><td><a id="I_indexterm20_d1e44826" class="indexterm"></a>Allows user to receive events generated as DTMF
              passes through the <span class="application">Asterisk</span>
              core.<sup>[<a id="id632936" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id632936" class="footnote">d</a>]</sup></td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">reporting</code>
              </td><td><a id="I_indexterm20_d1e44851" class="indexterm"></a>Gives user access to call-quality events, such as
              jitterbuffer statistics or RTCP reports.</td><td>Enables user to execute a range of actions to retrieve
              statistics and status information from across the
              system.</td></tr><tr><td>
                <code class="literal">cdr</code>
              </td><td><a id="I_indexterm20_d1e44863" class="indexterm"></a>Grants user access to CDR records reported by the
              <code class="literal">cdr_manager</code> module.</td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">dialplan</code>
              </td><td><a id="I_indexterm20_d1e44879" class="indexterm"></a>Allows user to receive events generated when
              variables are set or new extensions are created.</td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">originate</code>
              </td><td><code class="literal"><a id="I_indexterm20_d1e44893" class="indexterm"></a>write</code>-only</td><td>Allows user to execute the <code class="literal">Originate</code>
              action, which allows an AMI client to request that
              <span class="application">Asterisk</span> create a new call.</td></tr><tr><td>
                <code class="literal">agi</code>
              </td><td><a id="I_indexterm20_d1e44911" class="indexterm"></a>Allows user to receive events generated when AGI
              commands are processed.</td><td>Enables user to perform actions for managing channels
              that are running AGI in its asynchronous mode. AGI is discussed
              in more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI" title="Chapter 21. Asterisk Gateway Interface (AGI)">Chapter&nbsp;21, <em>Asterisk Gateway Interface (AGI)</em></a>.</td></tr><tr><td>
                <code class="literal">cc</code>
              </td><td><a id="I_indexterm20_d1e44924" class="indexterm"></a>Allows user to receive events related to Call
              Completion Supplementary Services (CCSS).</td><td><code class="literal">read</code>-only</td></tr><tr><td>
                <code class="literal">aoc</code>
              </td><td><a id="I_indexterm20_d1e44937" class="indexterm"></a>Lets user see Advice of Charge events generated as
              AOC events are received.</td><td>Allows user to execute the <code class="literal">AOCMessage</code>
              manager action, for sending out AOC messages.<a id="I_indexterm20_d1e44946" class="indexterm"></a><a id="I_indexterm20_d1e44947" class="indexterm"></a><a id="I_indexterm20_d1e44948" class="indexterm"></a><a id="I_indexterm20_d1e44949" class="indexterm"></a></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id632665" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id632665" class="para">a</a>] </sup>This level has been defined, but it
                  is not currently used anywhere in Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id632712" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id632712" class="para">b</a>] </sup>This level has been defined, but it
                  is not currently used anywhere in Asterisk.</p></div><div class="footnote"><p><sup>[<a id="ftn.id632817" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id632817" class="para">c</a>] </sup>The <code class="literal">UserEvent</code>
                  action is a useful mechanism for having messages delivered
                  to other AMI clients.</p></div><div class="footnote"><p><sup>[<a id="ftn.id632936" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id632936" class="para">d</a>] </sup>DTMF events will not be generated in
                  a bridged call between two channels unless generic bridging
                  in the <span class="application">Asterisk</span> core is being
                  used. For example, if the DTMF is being transmitted with the
                  media stream and the media stream is flowing directly
                  between the two endpoints,
                  <span class="application">Asterisk</span> will not be able to
                  report the DTMF events.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="http.conf"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id273588"></a>http.conf</h3></div></div></div><p><a id="AMI_id273595"></a><a id="I_indexterm20_d1e44954" class="indexterm"></a><a id="I_indexterm20_d1e44961" class="indexterm"></a><a id="I_indexterm20_d1e44968" class="indexterm"></a><a id="I_indexterm20_d1e44971" class="indexterm"></a>As we’ve seen, the Asterisk Manager Interface can be
      accessed over HTTP as well as TCP. To make that work, a very simple HTTP
      server is embedded in Asterisk. All of the options relevant to the AMI
      go in the <code class="literal">[general]</code> section of
      <code class="filename">/etc/asterisk/http.conf</code>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AMI_id273608"></a>Enabling access to the AMI over HTTP
          requires both <code class="filename">/etc/asterisk/manager.conf</code> and
          <code class="filename">/etc/asterisk/http.conf</code>.
          The AMI must be enabled in <code class="filename">manager.conf</code>, with
          the <code class="literal">enabled</code> option set to <code class="literal">yes</code>,
          and the <code class="filename">manager.conf</code> option
          <code class="literal">webenabled</code> must be set to <code class="literal">yes</code>
          to allow access over HTTP. Finally, the <code class="literal">enabled</code>
          option in <code class="filename">http.conf</code> must be set to
          <code class="literal">yes</code> to turn on the HTTP server itself.</p></div><p>The available options are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273652" title="Table 20.4. Options in the http.conf [general] section">Table&nbsp;20.4, “Options in the http.conf [general] section”</a>:<a id="I_indexterm20_d1e45025" class="indexterm"></a></p><div class="table"><a id="AMI_id273652"></a><p class="title"><strong>Table&nbsp;20.4.&nbsp;Options in the http.conf [general] section</strong></p><div class="table-contents"><table summary="Options in the http.conf [general] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Description</th></tr></thead><tbody><tr><td>
                <code class="literal">enabled</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45049" class="indexterm"></a>yes</code>
              </td><td>Enables the built-in HTTP server. The default is
              <code class="literal">no</code>.</td></tr><tr><td>
                <code class="literal">bindport</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45064" class="indexterm"></a>8088</code>
              </td><td>Sets the port number to listen on for HTTP connections.
              The default is <code class="literal">8088</code>.</td></tr><tr><td>
                <code class="literal">bindaddr</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45079" class="indexterm"></a>127.0.0.1</code>
              </td><td>Sets the address to listen on for HTTP connections. The
              default is to listen on all addresses
              (<code class="literal">0.0.0.0</code>). However, it is highly recommended
              to set this to <code class="literal">127.0.0.1</code>.</td></tr><tr><td>
                <code class="literal">tlsenable</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45097" class="indexterm"></a>yes</code>
              </td><td>Enables listening for HTTPS connections. The default is
              <code class="literal">no</code>. It is highly recommended that you only
              use HTTPS if you wish to expose HTTP connectivity outside of the
              local machine.<sup>[<a id="id633663" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id633663" class="footnote">a</a>]</sup></td></tr><tr><td>
                <code class="literal">tlsbindport</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45121" class="indexterm"></a>8089</code>
              </td><td>Sets the port to listen on for HTTPS connections. The
              default is <code class="literal">8089</code>.</td></tr><tr><td>
                <code class="literal">tlsbindaddr</code>
              </td><td>
                <code class="literal"><a id="I_indexterm20_d1e45136" class="indexterm"></a>0.0.0.0</code>
              </td><td>Sets the address to listen on for TLS-enabled AMI
              connections. The default is to listen on all addresses
              (<code class="literal">0.0.0.0</code>).</td></tr><tr><td>
                <code class="literal">tlscertfile</code>
              </td><td>
                <a id="I_indexterm20_d1e45150" class="indexterm"></a>
                <code class="filename">/var/lib/</code>
                <code class="filename">asterisk</code>
                <code class="filename">/keys/</code>
                <code class="filename">asterisk</code>
                <code class="filename">.pem</code>
              </td><td>Sets the path to the HTTPS server certificate. This is
              required if <code class="literal">tlsenable</code> is set to
              <code class="literal">yes</code>.</td></tr><tr><td>
                <code class="literal">tlsprivatekey</code>
              </td><td>
                <a id="I_indexterm20_d1e45176" class="indexterm"></a>
                <code class="filename">/var/lib/</code>
                <code class="filename">asterisk</code>
                <code class="filename">/keys/</code>
                <code class="filename">private</code>
                <code class="filename">.pem</code>
              </td><td>Sets the path to the HTTPS private key. If this is not
              specified, the <code class="literal">tlscertfile</code> will be checked to
              see if it also contains the private key.</td></tr><tr><td>
                <code class="literal">tlscipher</code>
              </td><td>
                <em class="replaceable"><code>&lt;cipher string&gt;</code></em>
              </td><td><a id="I_indexterm20_d1e45202" class="indexterm"></a>Specifies a list of ciphers for
              <span class="application">OpenSSL</span> to use. Setting this is
              optional. To see a list of available ciphers, run
              <span class="command"><strong>openssl ciphers -v</strong></span> at the command
              line.<a id="I_indexterm20_d1e45212" class="indexterm"></a><a id="I_indexterm20_d1e45213" class="indexterm"></a></td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id633663" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id633663" class="para">a</a>] </sup>The OpenSSL development package must
                  be installed for Asterisk to be able to use encryption. On
                  Ubuntu, the package is <code class="filename">libssl-dev</code>. On
                  CentOS, the package is
                  <code class="filename">openssl-devel</code>.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="sect1" title="Protocol Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI_id248378"></a>Protocol Overview</h2></div></div></div><p><a id="AMI_id248383"></a><a id="index-350B073FB2T" class="indexterm"></a>There are two main types of messages on the Asterisk Manager
    Interface: manager events and manager actions.</p><p><a id="AMI_id248388"></a><span class="emphasis"><em>Manager events</em></span> are one-way
    messages sent from Asterisk to AMI clients to report something that has
    occurred on the system. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-events" title="Figure 20.1. Manager events">Figure&nbsp;20.1, “Manager events”</a> for a
    graphical representation of the transmission of manager events.</p><div class="figure-float"><div class="figure"><a id="AMI-fig-events"></a><p class="title"><strong>Figure&nbsp;20.1.&nbsp;Manager events</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject20_d1e45233"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2001.png" alt="Manager events"></div></div></div><br class="figure-break"></div><p><a id="AMI_id248422"></a><span class="emphasis"><em>Manager actions</em></span><a id="I_indexterm20_d1e45241" class="indexterm"></a> are requests from a client that have associated responses
    that come back from Asterisk. That is, a manager action may be a request
    that Asterisk perform some action and return the result. For example,
    there is an AMI action to originate a new call. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-actions" title="Figure 20.2. Manager actions">Figure&nbsp;20.2, “Manager actions”</a> for a graphical representation of a client
    sending manager actions and receiving responses.</p><div class="figure"><a id="AMI-fig-actions"></a><p class="title"><strong>Figure&nbsp;20.2.&nbsp;Manager actions</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject20_d1e45250"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2002.png" alt="Manager actions"></div></div></div><br class="figure-break"><p><a id="AMI_id248458"></a>Other manager actions are requests for data that
    Asterisk knows about. For example, there is a manager action to get a list
    of all active channels on the system: the details about each channel are
    delivered as a manager event. When the list of results is complete, a
    final message will be sent to indicate that the end has been reached. See
    <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-fig-actions2" title="Figure 20.3. Manager actions that return a list of data">Figure&nbsp;20.3, “Manager actions that return a list of data”</a> for a graphical representation of a
    client sending this type of manager action and receiving a list of
    responses.</p><div class="figure"><a id="AMI-fig-actions2"></a><p class="title"><strong>Figure&nbsp;20.3.&nbsp;Manager actions that return a list of data</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject20_d1e45262"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2003.png" alt="Manager actions that return a list of data"></div></div></div><br class="figure-break"><div class="sect2" title="Message Encoding"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id248495"></a>Message Encoding</h3></div></div></div><p><a id="AMI_id248501"></a><a id="I_indexterm20_d1e45271" class="indexterm"></a><a id="I_indexterm20_d1e45278" class="indexterm"></a>All AMI messages, including manager events, manager
      actions, and manager action responses, are encoded in the same way. The
      messages are text-based, with lines terminated by a carriage return and
      a line-feed character. A message is terminated by a blank line:</p><a id="AMI_id248506"></a><pre class="programlisting">Header1: This is the first header&lt;CR&gt;&lt;LF&gt;
Header2: This is the second header&lt;CR&gt;&lt;LF&gt;
Header3: This is the last header of this message&lt;CR&gt;&lt;LF&gt;
&lt;CR&gt;&lt;LF&gt;</pre><div class="sect3" title="Events"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248511"></a>Events</h4></div></div></div><p><a id="AMI_id248517"></a><a id="I_indexterm20_d1e45288" class="indexterm"></a>Manager events always have an <code class="literal">Event</code>
        header and a <code class="literal">Privilege</code> header. The
        <code class="literal">Event</code> header gives the name of the event, while the
        <code class="literal">Privilege</code> header lists the privilege levels
        associated with the event. Any other headers included with the event
        are specific to the event type. Here’s an example:</p><a id="AMI_id248535"></a><pre class="programlisting">          <code class="computeroutput">Event: Hangup
Privilege: call,all
Channel: SIP/0004F2060EB4-00000000
Uniqueid: 1283174108.0
CallerIDNum: 2565551212
CallerIDName: Russell Bryant
Cause: 16
Cause-txt: Normal Clearing</code>
        </pre></div><div class="sect3" title="Actions"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248542"></a>Actions</h4></div></div></div><p><a id="AMI_id248547"></a><a id="I_indexterm20_d1e45313" class="indexterm"></a>When executing a manager action, it
        <span class="emphasis"><em>must</em></span> include the <code class="literal">Action</code>
        header. The <code class="literal">Action</code> header identifies which manager
        action is being executed. The rest of the headers are arguments to the
        manager action. Some headers are required.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="AMI_id248565"></a>To get a list of the headers associated with
          a particular manager action, type <span class="command"><strong>manager show command
          &lt;Action&gt;</strong></span> <a id="I_indexterm20_d1e45332" class="indexterm"></a><a id="I_indexterm20_d1e45335" class="indexterm"></a>at the <span class="application">Asterisk</span> command
          line. To get a full list of manager actions supported by the version
          of Asterisk you are running, enter <span class="command"><strong>manager show
          commands</strong></span><a id="I_indexterm20_d1e45346" class="indexterm"></a><a id="I_indexterm20_d1e45349" class="indexterm"></a> at the <span class="application">Asterisk</span>
          CLI.</p></div><p><a id="AMI_id248587"></a>The final response to a manager action is
        typically a message that includes the <code class="literal">Response</code>
        header. The value of the <code class="literal">Response</code> header will be
        <code class="literal">Success</code> if the manager action was successfully
        executed. If the manager action was not successfully executed, the
        value of the <code class="literal">Response</code> header will be
        <code class="literal">Error</code>. For example:</p><a id="AMI_id248610"></a><pre class="programlisting"><strong class="userinput"><code>Action: Login
Username: russell
Secret: russell</code></strong>

<code class="computeroutput">Response: Success
Message: Authentication accepted</code></pre></div></div><div class="sect2" title="AMI over HTTP"><div class="titlepage"><div><div><h3 class="title"><a id="AMI-HTTP"></a>AMI over HTTP</h3></div></div></div><p><a id="AMI_id248627"></a><a id="index-482T072PJ8N" class="indexterm"></a><a id="index-643M588KK8P" class="indexterm"></a>In addition to the native TCP interface, it is also
      possible to access the Asterisk Manager Interface over HTTP. Programmers
      with previous experience writing applications that use web APIs will
      likely prefer this over the native TCP connectivity.</p><div class="sect3" title="Authentication and session handling"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248633"></a>Authentication and session handling</h4></div></div></div><p><a id="AMI_id248638"></a><a id="I_indexterm20_d1e45401" class="indexterm"></a><a id="I_indexterm20_d1e45406" class="indexterm"></a><a id="I_indexterm20_d1e45409" class="indexterm"></a>There are two methods of performing authentication
        against the AMI over HTTP. The first is to use the
        <code class="literal">Login</code> action, similar to authentication with the
        native TCP interface. This is the method that was used in the
        quick-start example, as seen in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP" title="AMI over HTTP">the section called “AMI over HTTP”</a>. The second authentication option is
        HTTP digest authentication.<sup>[<a id="id634632" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id634632" class="footnote">166</a>]</sup> The next three sections discuss each of the AMI over
        HTTP encoding options. To indicate that HTTP digest authentication
        should be used, prefix the encoding type with an
        <code class="literal">a</code>.</p><p><a id="AMI_id248663"></a>Once successfully authenticated,
        <span class="application">Asterisk</span> will provide a cookie that
        identifies the authenticated session. Here is an example response to
        the <code class="literal">Login</code> action that includes a session cookie
        from <span class="application">Asterisk</span>:</p><a id="AMI_id248674"></a><pre class="screen">$ <strong class="userinput"><code>curl -v "http://localhost:8088/rawman?action=login&amp;username=hello&amp;secret=world"</code></strong>

* About to connect() to localhost port 8088 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 8088 (#0)
&gt; GET /rawman?action=login&amp;username=hello&amp;secret=worlda HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-pc-linux-gnu) libcurl/7.19.7 
OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
&gt; Host: localhost:8088
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Server: Asterisk/1.8.0-beta4
&lt; Date: Tue, 07 Sep 2010 11:51:28 GMT
&lt; Connection: close
&lt; Cache-Control: no-cache, no-store
&lt; Content-Length: 55
&lt; Content-type: text/plain
&lt; Cache-Control: no-cache;
&lt; Set-Cookie: mansession_id="0e929e60"; Version=1; Max-Age=60
&lt; Pragma: SuppressEvents
&lt; 

Response: Success
Message: Authentication accepted
* Closing connection #0
</pre></div><div class="sect3" title="/rawman encoding"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248689"></a>/rawman encoding</h4></div></div></div><p><a id="AMI_id248694"></a><a id="I_indexterm20_d1e45450" class="indexterm"></a><a id="I_indexterm20_d1e45453" class="indexterm"></a>The <code class="literal">rawman</code> encoding type is what has
        been used in all the AMI over HTTP examples in this chapter so far.
        The responses received from requests using <code class="literal">rawman</code>
        are formatted in the exact same way that they would be if the requests
        were sent over a direct TCP connection to the AMI.</p></div><div class="sect3" title="/manager encoding"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248704"></a>/manager encoding</h4></div></div></div><p><a id="AMI_id248710"></a><a id="I_indexterm20_d1e45469" class="indexterm"></a><a id="I_indexterm20_d1e45472" class="indexterm"></a>The <code class="literal">manager</code> encoding type provides a
        response in simple HTML form. This interface is primarily useful for
        experimenting with the AMI. Here is an example
        <code class="literal">Login</code> using this encoding type:</p><a id="AMI_id248721"></a><pre class="screen">$ <strong class="userinput"><code>curl -v "http://localhost:8088/manager?action=login&amp;username=hello&amp;secret=world"</code></strong>

* About to connect() to localhost port 8088 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 8088 (#0)
&gt; GET /manager?action=login&amp;username=hello&amp;secret=world HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-pc-linux-gnu) libcurl/7.19.7 
OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
&gt; Host: localhost:8088
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Server: Asterisk/1.8.0-beta4
&lt; Date: Tue, 07 Sep 2010 12:19:05 GMT
&lt; Connection: close
&lt; Cache-Control: no-cache, no-store
&lt; Content-Length: 881
&lt; Content-type: text/html
&lt; Cache-Control: no-cache;
&lt; Set-Cookie: mansession_id="139deda7"; Version=1; Max-Age=60
&lt; Pragma: SuppressEvents
&lt; 

&lt;title&gt;Asterisk&amp;trade; Manager Interface&lt;/title&gt;&lt;body bgcolor="#ffffff"&gt;
&lt;table align=center bgcolor="#f1f1f1" width="500"&gt;
&lt;tr&gt;&lt;td colspan="2" bgcolor="#f1f1ff"&gt;&lt;h1&gt;Manager Tester&lt;/h1&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="2" bgcolor="#f1f1ff"&gt;&lt;form action="manager" method="post"&gt;
	Action: &lt;select name="action"&gt;
		&lt;option value=""&gt;-----&amp;gt;&lt;/option&gt;
		&lt;option value="login"&gt;login&lt;/option&gt;
		&lt;option value="command"&gt;Command&lt;/option&gt;
		&lt;option value="waitevent"&gt;waitevent&lt;/option&gt;
		&lt;option value="listcommands"&gt;listcommands&lt;/option&gt;
	&lt;/select&gt;
	or &lt;input name="action"&gt;&lt;br/&gt;
	CLI Command &lt;input name="command"&gt;&lt;br&gt;
	user &lt;input name="username"&gt; pass &lt;input type="password" name="secret"&gt;&lt;br&gt;
	&lt;input type="submit"&gt;
&lt;/form&gt;
&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Response&lt;/td&gt;&lt;td&gt;Success&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;Message&lt;/td&gt;&lt;td&gt;Authentication accepted&lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td colspan="2"&gt;&lt;hr&gt;&lt;/td&gt;&lt;/tr&gt;
* Closing connection #0
&lt;/table&gt;&lt;/body</pre></div><div class="sect3" title="/mxml encoding"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248743"></a>/mxml encoding</h4></div></div></div><p><a id="AMI_id248748"></a><a id="I_indexterm20_d1e45493" class="indexterm"></a><a id="I_indexterm20_d1e45496" class="indexterm"></a>The <code class="literal">mxml</code> encoding type provides
        responses to manager actions encoded in XML. Here is an example
        <code class="literal">Login</code> using the <code class="literal">mxml</code> encoding
        type:</p><a id="AMI_id248760"></a><pre class="screen">$ <strong class="userinput"><code>curl -v "http://localhost:8088/mxml?action=login&amp;username=hello&amp;secret=world"</code></strong>

* About to connect() to localhost port 8088 (#0)
*   Trying 127.0.0.1... connected
* Connected to localhost (127.0.0.1) port 8088 (#0)
&gt; GET /mxml?action=login&amp;username=hello&amp;secret=world HTTP/1.1
&gt; User-Agent: curl/7.19.7 (x86_64-pc-linux-gnu) libcurl/7.19.7 
OpenSSL/0.9.8k zlib/1.2.3.3 libidn/1.15
&gt; Host: localhost:8088
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Server: Asterisk/1.8.0-beta4
&lt; Date: Tue, 07 Sep 2010 12:26:58 GMT
&lt; Connection: close
&lt; Cache-Control: no-cache, no-store
&lt; Content-Length: 146
&lt; Content-type: text/xml
&lt; Cache-Control: no-cache;
&lt; Set-Cookie: mansession_id="536d17a4"; Version=1; Max-Age=60
&lt; Pragma: SuppressEvents
&lt; 

&lt;ajax-response&gt;
&lt;response type='object' id='unknown'&gt;
&lt;generic response='Success' message='Authentication accepted' /&gt;
&lt;/response&gt;
* Closing connection #0
&lt;/ajax-response&gt;</pre></div><div class="sect3" title="Manager events"><div class="titlepage"><div><div><h4 class="title"><a id="AMI_id248782"></a>Manager events</h4></div></div></div><p><a id="AMI_id248787"></a><a id="I_indexterm20_d1e45520" class="indexterm"></a><a id="I_indexterm20_d1e45525" class="indexterm"></a><a id="I_indexterm20_d1e45528" class="indexterm"></a>When connected to the native TCP interface for the AMI,
        manager events are delivered asynchronously. When using the AMI over
        HTTP, events must be retrieved by polling for them. Events are
        retrieved over HTTP by executing the <code class="literal">WaitEvent</code>
        manager action. The following example shows how events can be
        retrieved using the <code class="literal">WaitEvent</code> manager action. The
        steps are:</p><div class="orderedlist"><a id="AMI_id248800"></a><ol class="orderedlist" type="1"><li class="listitem"><p><a id="AMI_id248802"></a><a id="AMI_id248804"></a>Start an HTTP AMI session using the
            <code class="literal">Login</code> action.</p></li><li class="listitem"><p><a id="AMI_id248813"></a><a id="AMI_id248815"></a>Register a SIP phone to Asterisk to
            generate a manager event.</p></li><li class="listitem"><p><a id="AMI_id248820"></a><a id="AMI_id248822"></a>Retrieve the manager event using the
            <code class="literal">WaitEvent</code> action.</p></li></ol></div><p>The interaction looks like this:<a id="I_indexterm20_d1e45558" class="indexterm"></a><a id="I_indexterm20_d1e45559" class="indexterm"></a><a id="I_indexterm20_d1e45560" class="indexterm"></a></p><a id="AMI_id248830"></a><pre class="screen">$ <strong class="userinput"><code>wget --save-cookies cookies.txt \</code></strong>
&gt; <strong class="userinput"><code>"http://localhost:8088/mxml?action=login&amp;username=hello&amp;secret=world" -O -</code></strong>

&lt;ajax-response&gt;
&lt;response type='object' id='unknown'&gt;
    &lt;generic response='Success' message='Authentication accepted' /&gt;
&lt;/response&gt;
&lt;/ajax-response&gt;


$ <strong class="userinput"><code>wget --load-cookies cookies.txt "http://localhost:8088/mxml?action=waitevent" -O -</code></strong>

&lt;ajax-response&gt;
&lt;response type='object' id='unknown'&gt;
    &lt;generic response='Success' message='Waiting for Event completed.' /&gt;
&lt;/response&gt;
&lt;response type='object' id='unknown'&gt;
    &lt;generic event='PeerStatus' privilege='system,all' 
             channeltype='SIP' peer='SIP/0000FFFF0004' 
             peerstatus='Registered' address='172.16.0.160:5060' /&gt;
&lt;/response&gt;
&lt;response type='object' id='unknown'&gt;
    &lt;generic event='WaitEventComplete' /&gt;
&lt;/response&gt;
&lt;/ajax-response&gt;

</pre></div></div></div><div class="sect1" title="Development Frameworks"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI_id248859"></a>Development Frameworks</h2></div></div></div><p><a id="AMI_id248864"></a><a id="I_indexterm20_d1e45576" class="indexterm"></a>Many application developers write code that directly
    interfaces with the AMI. However, there are a number of existing libraries
    that aim to make writing AMI applications easier. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-frameworks" title="Table 20.5. AMI development frameworks">Table&nbsp;20.5, “AMI development frameworks”</a> lists a few that we know are being used
    successfully. If you search around for Asterisk libraries in any other
    popular programming language of your choice, you are likely to find one
    that exists.<a id="I_indexterm20_d1e45584" class="indexterm"></a></p><div class="table"><a id="AMI-frameworks"></a><p class="title"><strong>Table&nbsp;20.5.&nbsp;AMI development frameworks</strong></p><div class="table-contents"><table summary="AMI development frameworks" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Framework</th><th align="center">Language</th><th align="center">URL</th></tr></thead><tbody><tr><td>
              <span class="application">Adhearsion</span>
            </td><td>Ruby</td><td>
              <a class="ulink" href="http://adhearsion.com/" target="_top">http://adhearsion.com/</a>
            </td></tr><tr><td>
              <span class="application">StarPy</span>
            </td><td>Python</td><td>
              <a class="ulink" href="http://starpy.sourceforge.net/" target="_top">http://starpy.sourceforge.net/</a>
            </td></tr><tr><td>
              <span class="application">Asterisk-Java</span>
            </td><td>Java</td><td>
              <a class="ulink" href="http://asterisk-java.org/" target="_top">http://asterisk-java.org/</a>
            </td></tr></tbody></table></div></div><br class="table-break"><div class="sect2" title="CSTA"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id283296"></a>CSTA</h3></div></div></div><p><a id="AMI_id283302"></a><a id="I_indexterm20_d1e45630" class="indexterm"></a><a id="I_indexterm20_d1e45633" class="indexterm"></a>Computer-Supported Telecommunications Applications (CSTA)
      is a standard for Computer Telephony Integration (CTI). One of the
      biggest benefits of CSTA is that it is used by multiple manufacturers.
      Some of what is provided by CSTA can be mapped to operations available
      in the AMI. There have been multiple efforts to provide a CSTA interface
      to <span class="application">Asterisk</span>. One of these efforts is the
      <a class="ulink" href="http://opencsta.org/" target="_top">Open CSTA</a> project. While none
      of the authors have experience with this CSTA interface to
      <span class="application">Asterisk</span>, it is certainly worth considering
      if you have CSTA experience or an existing CSTA application you would
      like to integrate with <span class="application">Asterisk</span>.</p></div></div><div class="sect1" title="Interesting Applications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI-applications"></a>Interesting Applications</h2></div></div></div><p><a id="AMI_id283337"></a>Many useful applications have been developed that
    take advantage of the AMI. Here are a couple of examples.</p><div class="sect2" title="AsteriskGUI"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id283341"></a>AsteriskGUI</h3></div></div></div><p><a id="AMI_id283347"></a><a id="I_indexterm20_d1e45658" class="indexterm"></a><a id="I_indexterm20_d1e45663" class="indexterm"></a>The <span class="application">AsteriskGUI</span> is an open
      source PBX administration interface developed by Digium. It is intended
      for use on small installations. The
      <span class="application">AsteriskGUI</span> is written entirely in HTML and
      JavaScript and uses the AMI over HTTP for all interaction with
      <span class="application">Asterisk</span>. It has been especially popular for
      use in resource-constrained embedded <span class="application">Asterisk</span>
      environments, since it does not require additional software to run on
      the <span class="application">Asterisk</span> server. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-AsteriskGUI" title="Figure 20.4. AsteriskGUI">Figure&nbsp;20.4, “AsteriskGUI”</a> shows a page from the
      <span class="application">AsteriskGUI</span>.</p><p><a id="AMI_id283379"></a>The <span class="application">AsteriskGUI</span> can
      be obtained from the Digium subversion server:</p><a id="AMI_id283393"></a><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>svn co http://svn.digium.com/svn/asterisk-gui/branches/2.0</code></strong></pre><p>It is also bundled as an option with the <span class="application"><a class="ulink" href="http://www.asterisk.org/asterisknow/" target="_top">AsteriskNOW</a></span>
      distribution.</p><div class="figure-float"><div class="figure"><a id="AMI-AsteriskGUI"></a><p class="title"><strong>Figure&nbsp;20.4.&nbsp;AsteriskGUI</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject20_d1e45708"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2004.png" alt="AsteriskGUI"></div></div></div><br class="figure-break"></div></div><div class="sect2" title="Flash Operator Panel"><div class="titlepage"><div><div><h3 class="title"><a id="AMI_id283424"></a>Flash Operator Panel</h3></div></div></div><p><a id="AMI_id283429"></a><span class="application"><a id="I_indexterm20_d1e45719" class="indexterm"></a><a id="I_indexterm20_d1e45725" class="indexterm"></a><a id="I_indexterm20_d1e45729" class="indexterm"></a>Flash Operator Panel</span> is an application that
      runs in a web browser using <span class="application">Flash</span>. It is
      primarily used as an interface to see which extensions are currently
      ringing or in use. It also includes the ability to monitor conference
      room and call queue status. Some call actions can be performed as well,
      such as barging into a call and transferring calls. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-FOP" title="Figure 20.5. Flash Operator Panel">Figure&nbsp;20.5, “Flash Operator Panel”</a> shows a screenshot of the Flash Operator Panel
      interface.</p><p><a id="AMI_id283448"></a>Downloads and more detailed information on Flash
      Operator Panel can be found at <a class="ulink" href="http://www.asternic.org/" target="_top">http://www.asternic.org</a>.</p><div class="figure-float"><div class="figure"><a id="AMI-FOP"></a><p class="title"><strong>Figure&nbsp;20.5.&nbsp;Flash Operator Panel</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject20_d1e45746"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2005.png" alt="Flash Operator Panel"></div></div></div><br class="figure-break"></div></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AMI_id283482"></a>Conclusion</h2></div></div></div><p><a id="AMI_id283487"></a>The Asterisk Manager Interface provides an API for
    monitoring events from an Asterisk system, as well as requesting that
    Asterisk perform a wide range of actions. An HTTP interface has been
    provided and a number of frameworks have been developed that make it
    easier to develop applications. All of this information, as well as the
    examples we looked at at the end of this chapter, should help get you
    thinking about what new applications you might be able to build using the
    Asterisk Manager Interface.<a id="I_indexterm20_d1e45756" class="indexterm"></a><a id="I_indexterm20_d1e45757" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id634632" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id634632" class="para">166</a>] </sup>At the time of writing, there is a problem with HTTP digest
            authentication that prevents it from working properly. <a class="ulink" href="https://issues.asterisk.org/view.php?id=18598" target="_top">Issue
            18598</a> in the Asterisk project issue tracker has been
            opened for this problem. Hopefully it will be fixed by the time
            you read this.</p></div></div></div><div class="chapter" title="Chapter 21. Asterisk Gateway Interface (AGI)"><div class="titlepage"><div><div><h2 class="title"><a id="AGI"></a>Chapter&nbsp;21.&nbsp;Asterisk Gateway Interface (AGI)</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart">Quick Start</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-variants">AGI Variants</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262615">Process-Based AGI</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262406">EAGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id265035">DeadAGI Is Dead</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI">FastAGI—AGI over TCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-communication">AGI Communication Overview</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254321">Setting Up an AGI Session</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id268960">Async AGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242019">Ending an AGI Session</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242030">Process-based AGI/FastAGI</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254220">Async AGI</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id263225">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="AGI_id281339"></a>Caffeine. The gateway drug.</p><div class="attribution"><span>—<span class="attribution">Eddie Vedder</span></span></div></div><p><a id="AGI_id260160"></a><a id="index-114V426BO4U" class="indexterm"></a><a id="index-212L856FL0Q" class="indexterm"></a>The Asterisk dialplan has evolved into a simple yet powerful
  programming interface for call handling. However, many people, especially
  those with a prior programming background, still prefer implementing their
  custom call handling in a different programming language. Using another
  programming language may also allow you to utilize existing code for
  integration with other systems. The Asterisk Gateway Interface (AGI) allows
  the development of first-party call control in the programming language of
  your choice. If you are not interested in implementing call control outside
  of the native Asterisk dialplan, you may safely skip this chapter.</p><div class="sect1" title="Quick Start"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AGI-quickstart"></a>Quick Start</h2></div></div></div><p><a id="AGI_id275940"></a><a id="I_indexterm21_d1e45780" class="indexterm"></a>This section gives a quick example of using the AGI. First,
    add the following line to <code class="filename">/etc/asterisk/extensions.conf</code>:</p><a id="AGI_id253975"></a><pre class="programlisting">exten =&gt; 500,1,AGI(hello-world.sh)</pre><p><a id="AGI_id255116"></a>Next, create a <code class="filename">hello-world.sh</code> script in <code class="filename">/var/lib/asterisk/agi-bin/</code>, as shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-hello-world-example" title="Example 21.1. A sample AGI script, hello-world.sh">Example&nbsp;21.1, “A sample AGI script, hello-world.sh”</a>.</p><div class="example"><a id="AGI-hello-world-example"></a><p class="title"><strong>Example&nbsp;21.1.&nbsp;A sample AGI script, hello-world.sh</strong></p><div class="example-contents"><a id="AGI_id267015"></a><pre class="programlisting">#!/bin/bash

# Consume all variables sent by Asterisk
while read VAR &amp;&amp; [ -n ${VAR} ] ; do : ; done

# Answer the call.
echo "ANSWER"
read RESPONSE

# Say the letters of "Hello World"
echo 'SAY ALPHA "Hello World" ""'
read RESPONSE

exit 0

</pre></div></div><br class="example-break"><p><a id="AGI_id264487"></a>Now, call extension <code class="literal">500</code> with AGI debugging turned on and listen to
    Allison spell out <span class="emphasis"><em>“Hello World”</em></span>:</p><a id="AGI_id266198"></a><pre class="programlisting"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>agi set debug on</code></strong>
<code class="computeroutput">AGI Debugging Enabled

    -- Executing [500@phones:1] AGI("SIP/0004F2060EB4-00000009", 
       "hello-world.sh") in new stack
    -- Launched AGI Script /var/lib/asterisk/agi-bin/hello-world.sh
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_request: hello-world.sh
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_channel: SIP/0004F2060EB4-00000009
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_language: en
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_type: SIP
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_uniqueid: 1284382003.9
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_version: 1.8.0-beta4
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_callerid: 2563619899
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_calleridname: Russell Bryant
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_callingpres: 0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_callingani2: 0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_callington: 0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_callingtns: 0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_dnid: 7010
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_rdnis: unknown
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_context: phones
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_extension: 500
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_priority: 1
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_enhanced: 0.0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_accountcode: 
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; agi_threadid: 140071216785168
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; 
&lt;SIP/0004F2060EB4-00000009&gt;AGI Rx &lt;&lt; ANSWER
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; 200 result=0
&lt;SIP/0004F2060EB4-00000009&gt;AGI Rx &lt;&lt; SAY ALPHA "Hello World" ""
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/h.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/e.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/l.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/l.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/o.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/space.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/w.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/o.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/r.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/l.gsm' (language 'en')
    -- &lt;SIP/0004F2060EB4-00000009&gt; Playing 'letters/d.gsm' (language 'en')
&lt;SIP/0004F2060EB4-00000009&gt;AGI Tx &gt;&gt; 200 result=0
    -- &lt;SIP/0004F2060EB4-00000009&gt;AGI Script hello-world.sh completed, returning 0
</code></pre></div><div class="sect1" title="AGI Variants"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AGI-variants"></a>AGI Variants</h2></div></div></div><p><a id="AGI_id262606"></a><a id="index-416G647DJ8U" class="indexterm"></a>There are a few variants of AGI that differ primarily in the
    method used to communicate with <span class="application">Asterisk</span>. It is good to be aware of all of
    the options so you can make the best choice based on the needs of your
    application.</p><div class="sect2" title="Process-Based AGI"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id262615"></a>Process-Based AGI</h3></div></div></div><p><a id="AGI_id262620"></a><a id="I_indexterm21_d1e45840" class="indexterm"></a><a id="I_indexterm21_d1e45847" class="indexterm"></a>Process-based AGI is the simplest variant of AGI. The
      “quick-start” example at the beginning of this chapter was an example of
      a process-based AGI script. The AGI script is invoked by using the
      <code class="literal">AGI()</code> application <a id="I_indexterm21_d1e45854" class="indexterm"></a>from the <span class="application">Asterisk</span> dialplan. The application to run
      is specified as the first argument to <code class="literal">AGI()</code>. Unless a full path is specified, the
      application is expected to exist in the <code class="filename">/var/lib/asterisk/agi-bin/</code> directory.
      Arguments to be passed to your AGI application can be specified as
      additional arguments to the <code class="literal">AGI()</code>
      application in the <span class="application">Asterisk</span>
      dialplan. The syntax is:</p><a id="AGI_id287700"></a><pre class="programlisting">AGI(<em class="replaceable"><code>command</code></em>[,<em class="replaceable"><code>arg1</code></em>[,<em class="replaceable"><code>arg2</code></em>[,...]]])</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="AGI_id287705"></a>Ensure that your application has the proper
        permissions set such that the user the <span class="application">Asterisk</span> process is running as has
        permissions to execute it. Otherwise, <code class="literal">AGI()</code> will fail.</p></div><p><a id="AGI_id265352"></a>Once Asterisk executes your AGI application,
      communication between Asterisk and your application will take place over
      <span class="command"><strong>stdin</strong></span> and <span class="command"><strong>stdout</strong></span>. More details about this communication
      will be covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-communication" title="AGI Communication Overview">the section called “AGI Communication Overview”</a>. For more
      details about invoking <code class="literal">AGI()</code> from the
      dialplan, check the documentation built into <span class="application">Asterisk</span>:</p><a id="AGI_id265375"></a><pre class="programlisting"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core show application AGI</code></strong></pre><div class="variablelist"><dl><dt><span class="term">Pros of process-based AGI</span></dt><dd><p>It is the simplest form of AGI to implement.</p></dd><dt><span class="term">Cons of process-based AGI</span></dt><dd><p>It is the least efficient form of AGI with regard to
            resource consumption. Systems with high load should consider
            FastAGI, discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI" title="FastAGI—AGI over TCP">the section called “FastAGI—AGI over TCP”</a>, instead.</p></dd></dl></div><div class="sect3" title="EAGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id262406"></a>EAGI</h4></div></div></div><p><a id="AGI_id262412"></a><a id="I_indexterm21_d1e45937" class="indexterm"></a><a id="I_indexterm21_d1e45940" class="indexterm"></a>EAGI (Enhanced AGI) is a slight variant on <code class="literal">AGI()</code>. It is invoked in the <span class="application">Asterisk</span> dialplan as <code class="literal">EAGI()</code>. The difference is that in addition
        to the communication on <span class="command"><strong>stdin</strong></span> and
        <span class="command"><strong>stdout</strong></span>, <span class="application">Asterisk</span> also provides a unidirectional
        stream of audio coming from the channel on file descriptor 3. For more
        details on how to invoke <code class="literal">EAGI()</code>
        from the <span class="application">Asterisk</span> dialplan,
        check the documentation built into <span class="application">Asterisk</span>:</p><a id="AGI_id262446"></a><pre class="programlisting"><code class="prompt">*CLI&gt;</code> <strong class="userinput"><code>core show application EAGI</code></strong></pre><div class="variablelist"><dl><dt><span class="term">Pros of Enhanced AGI</span></dt><dd><p>It has the simplicity of process-based AGI, with the
              addition of a simple read-only stream of the channel’s audio.
              This is the only variant that offers this feature.</p></dd><dt><span class="term">Cons of Enhanced AGI</span></dt><dd><p>Since a new process must be spawned to run your
              application for every call, it has the same efficiency concerns
              as regular process-based AGI.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="AGI_id265010"></a>For an alternative way of getting
                access to the audio outside of Asterisk, consider using <a class="ulink" href="http://jackaudio.org/" target="_top">JACK</a>. Asterisk has a
                module for JACK integration, called <code class="literal">app_jack</code>. It provides the <code class="literal">JACK()</code> dialplan application and the
                <code class="literal">JACK_HOOK()</code> dialplan
                function.</p></div></dd></dl></div></div></div><div class="sect2" title="DeadAGI Is Dead"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id265035"></a>DeadAGI Is Dead</h3></div></div></div><p><a id="AGI_id265040"></a><a id="I_indexterm21_d1e46010" class="indexterm"></a><a id="I_indexterm21_d1e46017" class="indexterm"></a>In versions of Asterisk prior to 1.8, there was a dialplan
      application called <code class="literal">DeadAGI()</code>. Its
      purpose was similar to that of <code class="literal">AGI()</code>,
      except you used it on a channel that had already been hung up. This
      would usually be done in the special <code class="literal">h</code> extension, when you wanted to use an AGI
      application to aid in some type of post-call processing. Invoking
      <code class="literal">DeadAGI()</code> from the dialplan will
      still work, but you will get a <code class="literal">WARNING</code> message in the <span class="application">Asterisk</span> log. It has been deprecated in
      favor of using <code class="literal">AGI()</code> in all cases.
      The code for <code class="literal">AGI()</code> has been updated
      so it knows how to correctly adjust its operation after a channel has
      been hung up.</p><div class="variablelist"><dl><dt><span class="term">Pros of DeadAGI</span></dt><dd><p>None. It’s dead.</p></dd><dt><span class="term">Cons of DeadAGI</span></dt><dd><p>It’s dead. Really, don’t use it. If you do, your
            configuration may break if <code class="literal">DeadAGI()</code> is completely removed from
            <span class="application">Asterisk</span> in a future
            version.</p></dd></dl></div></div><div class="sect2" title="FastAGI—AGI over TCP"><div class="titlepage"><div><div><h3 class="title"><a id="FastAGI"></a>FastAGI—AGI over TCP</h3></div></div></div><p><a id="AGI_id272906"></a><span class="emphasis"><em>FastAGI</em></span> <a id="I_indexterm21_d1e46072" class="indexterm"></a><a id="I_indexterm21_d1e46079" class="indexterm"></a><a id="I_indexterm21_d1e46082" class="indexterm"></a>is the term used for AGI call control over a TCP
      connection. With process-based AGI, an instance of an AGI application is
      executed on the system for every call and communication with that
      application is done over <span class="command"><strong>stdin</strong></span> and
      <span class="command"><strong>stdout</strong></span>. With FastAGI, a TCP
      connection is made to a FastAGI server. Call control is done using the
      same AGI protocol, but the communication is over the TCP connection and
      does not require a new process to be started for every call. The AGI
      protocol is discussed in more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-communication" title="AGI Communication Overview">the section called “AGI Communication Overview”</a>. Using FastAGI is much more scalable than
      process-based AGI, though it is also more complex to implement.</p><p><a id="AGI_id272927"></a>FastAGI is used by invoking the <code class="literal">AGI()</code> application in the <span class="application">Asterisk</span> dialplan, but instead of
      providing the name of the application to execute, you provide an
      <code class="literal">agi://</code> URL. For example:</p><a id="AGI_id272941"></a><pre class="programlisting">exten =&gt; 1234,1,AGI(agi://127.0.0.1)</pre><p><a id="AGI_id272946"></a>The default port number for a FastAGI connection
      is <code class="literal">4573</code>. A different port number can
      be appended to the URL after a colon. For example:</p><a id="AGI_id272953"></a><pre class="programlisting">exten =&gt; 1234,1,AGI(agi://127.0.0.1:4574)</pre><p><a id="AGI_id272957"></a>Just as with process-based AGI, arguments can be
      passed to a FastAGI application. To do so, add them as additional
      arguments to the <code class="literal">AGI()</code> application,
      delimited by commas:</p><a id="AGI_id272965"></a><pre class="programlisting">exten =&gt; 1234,1,AGI(agi://192.168.1.199,<em class="replaceable"><code>arg1</code></em>,<em class="replaceable"><code>arg2</code></em>,<em class="replaceable"><code>arg3</code></em>)</pre><p><a id="AGI_id272969"></a>FastAGI also supports the usage of SRV records
      if you provide a URL in the form of <code class="literal">hagi://</code>. By using SRV records, you can list
      multiple hosts that Asterisk can attempt to connect to for purposes of
      high availability and load balancing. In the following example, to find
      a FastAGI server to connect to, Asterisk will do a DNS lookup for
      <code class="literal">_agi._tcp.shifteight.org</code>:</p><a id="AGI_id272983"></a><pre class="programlisting">exten =&gt; 1234,1,AGI(hagi://shifteight.org)</pre><div class="variablelist"><dl><dt><span class="term">Pros of FastAGI</span></dt><dd><p>It’s more efficient than process-based AGI. Instead of
            spawning a process per call, a FastAGI server can handle many
            calls.</p><p>DNS can be used to achieve high availability and load
            balancing among FastAGI servers to further enhance
            scalability.</p></dd><dt><span class="term">Cons of FastAGI</span></dt><dd><p>It is more complex to implement a FastAGI server than to
            implement a process-based AGI application. However, implementing a
            TCP server is something that has been done countless times before,
            so there are many examples available for virtually any programming
            language.</p></dd></dl></div></div><div class="sect2" title="Async AGI—AMI-Controlled AGI"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id273035"></a>Async AGI—AMI-Controlled AGI</h3></div></div></div><p><a id="AGI_id273041"></a><a id="I_indexterm21_d1e46161" class="indexterm"></a><a id="I_indexterm21_d1e46168" class="indexterm"></a><a id="I_indexterm21_d1e46171" class="indexterm"></a>Async AGI is a newer method of using AGI that was first
      introduced in <span class="application">Asterisk</span> 1.6.0.
      The purpose of async AGI is to allow an application that uses the
      Asterisk Manager Interface (AMI) to asynchronously queue up AGI commands
      to be executed on a channel. This can be especially useful if you are
      already making extensive use of the AMI and would like to take advantage
      of the same application to handle call control, as opposed to writing a
      detailed <span class="application">Asterisk</span> dialplan or
      developing a separate FastAGI server.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="AGI_id273057"></a>More information on the <span class="application">Asterisk</span> Manager Interface can be found
        in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>.</p></div><p><a id="AGI_id273070"></a>Async AGI is invoked by the <code class="literal">AGI()</code> application in the <span class="application">Asterisk</span> dialplan. The argument to
      <code class="literal">AGI()</code> should be <code class="literal">agi:async</code>, as shown in the following
      example:</p><a id="AGI_id273088"></a><pre class="programlisting">exten =&gt; 1234,1,AGI(agi:async)</pre><p><a id="AGI_id273092"></a>Additional information on how to use async AGI
      over the AMI can be found in the next section.</p><div class="variablelist"><dl><dt><span class="term">Pros of async AGI</span></dt><dd><p>An existing AMI application can be used to control calls
            using AGI commands.</p></dd><dt><span class="term">Cons of async AGI</span></dt><dd><p>It is the most complex method of using AGI to
            implement.</p></dd></dl></div><div class="sidebar" title="Setting Up /etc/asterisk/manager.conf for Async AGI"><a id="AGI_id273101"></a><div class="titlepage"><div><div><p class="title"><strong>Setting Up /etc/asterisk/manager.conf for Async AGI</strong></p></div></div></div><p><a id="AGI_id273110"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-configuration" title="Configuration">the section called “Configuration”</a> discusses
        the configuration options in <code class="filename">manager.conf</code> in detail. To make use of
        async AGI, an AMI account must have the <code class="literal">agi</code> permission for both <code class="literal">read</code> and <code class="literal">write</code>. For example, the following user
        defined in <code class="filename">manager.conf</code> would be
        able to both execute AGI manager actions and receive AGI manager
        events:<a id="I_indexterm21_d1e46244" class="indexterm"></a></p><a id="AGI_id273136"></a><pre class="programlisting">;
; Define a user called 'hello', with a password of 'world'.
; Give this user read/write permissions for AGI.
;
[hello]
secret = world
read = agi
write = agi</pre></div></div></div><div class="sect1" title="AGI Communication Overview"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AGI-communication"></a>AGI Communication Overview</h2></div></div></div><p><a id="AGI_id254309"></a><a id="index-077H354ML2R" class="indexterm"></a>The preceding section discussed the variations of AGI that
    can be used. This section goes into more detail about how your custom AGI
    application communicates with Asterisk once <code class="literal">AGI()</code> has been invoked.</p><div class="sect2" title="Setting Up an AGI Session"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id254321"></a>Setting Up an AGI Session</h3></div></div></div><p><a id="AGI_id254327"></a><a id="I_indexterm21_d1e46264" class="indexterm"></a>Once <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> has been invoked from the Asterisk
      dialplan, some information is passed to the AGI application to set up
      the AGI session. This section discusses what steps are taken at the
      beginning of an AGI session for the different variants of AGI.</p><div class="sect3" title="Process-based AGI/FastAGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id254339"></a>Process-based AGI/FastAGI</h4></div></div></div><p><a id="AGI_id254344"></a><a id="I_indexterm21_d1e46282" class="indexterm"></a><a id="I_indexterm21_d1e46285" class="indexterm"></a>For a process-based AGI application or a connection to a
        FastAGI server, the variables listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-variables" title="Table 21.1. AGI environment variables">Table&nbsp;21.1, “AGI environment variables”</a> will be the first pieces of information
        sent from Asterisk to your application. Each variable will be on its
        own line, in the form:<a id="I_indexterm21_d1e46291" class="indexterm"></a><a id="I_indexterm21_d1e46296" class="indexterm"></a></p><a id="AGI_id254356"></a><pre class="programlisting">agi_<em class="replaceable"><code>variable</code></em>: <em class="replaceable"><code>value</code></em></pre><div class="table"><a id="AGI-variables"></a><p class="title"><strong>Table&nbsp;21.1.&nbsp;AGI environment variables</strong></p><div class="table-contents"><table summary="AGI environment variables" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Variable</th><th align="center">Value / Example</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">agi_request</code></td><td><code class="literal">hello-world.sh</code></td><td>The first argument that was passed to the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application. For
                process-based AGI, this is the name of the AGI application
                that has been executed. For FastAGI, this would be the URL
                that was used to reach the FastAGI server.</td></tr><tr><td><code class="literal">agi_channel</code></td><td><code class="literal">SIP/0004F2060EB4-00000009</code></td><td>The name of the channel that has executed the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application.</td></tr><tr><td><code class="literal">agi_language</code></td><td><code class="literal">en</code></td><td>The language set on <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_type</code></td><td><code class="literal">SIP</code></td><td>The channel type for <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_uniqueid</code></td><td><code class="literal">1284382003.9</code></td><td>The <code class="literal">uniqueid</code> of
                <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_version</code></td><td><code class="literal">1.8.0-beta4</code></td><td>The <span class="application">Asterisk</span>
                version in use.</td></tr><tr><td><code class="literal">agi_callerid</code></td><td><code class="literal">12565551212</code></td><td>The full caller ID string that is set on <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_calleridname</code></td><td><code class="literal">Russell
                Bryant</code></td><td>The caller ID name that is set on <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_callingpres</code></td><td><code class="literal">0</code></td><td>The caller presentation associated with the caller ID
                set on <code class="literal">agi_channel</code>. For
                more information, see the output of <span class="command"><strong>core show function CALLERPRES</strong></span> at the
                <span class="application">Asterisk</span>
                CLI.</td></tr><tr><td><code class="literal">agi_callingani2</code></td><td><code class="literal">0</code></td><td>The caller ANI2 associated with <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_callington</code></td><td><code class="literal">0</code></td><td>The caller ID TON (Type of Number) associated with
                <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_callingtns</code></td><td><code class="literal">0</code></td><td>The dialed number TNS (Transit Network Select)
                associated with <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_dnid</code></td><td><code class="literal">7010</code></td><td>The dialed number associated with <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_rdnis</code></td><td><code class="literal">unknown</code></td><td>The redirecting number associated with <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_context</code></td><td><code class="literal">phones</code></td><td>The context of the dialplan that <code class="literal">agi_channel</code> was in when it executed
                the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application.</td></tr><tr><td><code class="literal">agi_extension</code></td><td><code class="literal">500</code></td><td>The extension in the dialplan that <code class="literal">agi_channel</code> was executing when it
                ran the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application.</td></tr><tr><td><code class="literal">agi_priority</code></td><td><code class="literal">1</code></td><td>The priority of <code class="literal">agi_extension</code> in <code class="literal">agi_context</code> that executed <code class="literal">AGI()</code> or <code class="literal">EAGI()</code>.</td></tr><tr><td><code class="literal">agi_enhanced</code></td><td><code class="literal">0.0</code></td><td>An indication of whether <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> was used from the dialplan.
                <code class="literal">0.0</code> indicates that <code class="literal">AGI()</code> was used. <code class="literal">1.0</code> indicates that <code class="literal">EAGI()</code> was used.</td></tr><tr><td><code class="literal">agi_accountcode</code></td><td><code class="literal">myaccount</code></td><td>The <code class="literal">accountcode</code>
                associated with <code class="literal">agi_channel</code>.</td></tr><tr><td><code class="literal">agi_threadid</code></td><td><code class="literal">140071216785168</code></td><td>The <code class="literal">threadid</code> of the
                thread in Asterisk that is running the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application. This may be
                useful for associating logs generated by the AGI application
                with logs generated by Asterisk, since the Asterisk logs
                contain thread IDs.</td></tr><tr><td><code class="literal">agi_arg_<em class="replaceable"><code>&lt;argument
                number&gt;</code></em></code></td><td><code class="literal">my argument</code></td><td>These variables provide the contents of the additional
                arguments provided to the <code class="literal">AGI()</code> or <code class="literal">EAGI()</code> application.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="AGI_id254363"></a>For an example of the variables that might be
        sent to an AGI application, see the AGI communication debug output in
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart" title="Quick Start">the section called “Quick Start”</a>. The end of the list of variables
        will be indicated by a blank line. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-hello-world-example" title="Example 21.1. A sample AGI script, hello-world.sh">Example&nbsp;21.1, “A sample AGI script, hello-world.sh”</a> handles these variables by
        reading lines of input in a loop until a blank line is received. At
        that point, the application continues and begins executing AGI
        commands.</p></div><div class="sect3" title="Async AGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id268960"></a>Async AGI</h4></div></div></div><p><a id="AGI_id268965"></a><a id="I_indexterm21_d1e46650" class="indexterm"></a>When you use async AGI, Asterisk will send out a manager
        event to initiate the async AGI session. Here is an example manager
        event sent out by <span class="application">Asterisk</span>:</p><a id="AGI_id268990"></a><pre class="programlisting">Event: AsyncAGI
Privilege: agi,all
SubEvent: Start
Channel: SIP/0000FFFF0001-00000000
Env: agi_request%3A%20async%0Aagi_channel%3A%20SIP%2F0000FFFF0001-00000000%0A \
     agi_language%3A%20en%0Aagi_type%3A%20SIP%0Aagi_uniqueid%3A%201285219743.0%0A \
     agi_version%3A%201.8.0-beta5%0Aagi_callerid%3A%2012565551111%0A \
     agi_calleridname%3A%20Julie%20Bryant%0Aagi_callingpres%3A%200%0A \
     agi_callingani2%3A%200%0Aagi_callington%3A%200%0Aagi_callingtns%3A%200%0A \
     agi_dnid%3A%20111%0Aagi_rdnis%3A%20unknown%0Aagi_context%3A%20LocalSets%0A \
     agi_extension%3A%20111%0Aagi_priority%3A%201%0Aagi_enhanced%3A%200.0%0A \
     agi_accountcode%3A%20%0Aagi_threadid%3A%20-1339524208%0A%0A
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AGI_id268978"></a>The value of the <code class="literal">Env</code> header in this <code class="literal">AsyncAGI</code> manager event is all on one line.
          The long value of the <code class="literal">Env</code> header
          has been URI encoded.</p></div></div></div><div class="sect2" title="Commands and Responses"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id269002"></a>Commands and Responses</h3></div></div></div><p><a id="AGI_id269007"></a><a id="index-418N404RV4Q" class="indexterm"></a>Once an AGI session has been set up, <span class="application">Asterisk</span> begins performing call processing
      in response to commands sent from the AGI application. As soon as an AGI
      command has been issued to Asterisk, no further commands will be
      processed on that channel until the current command has been completed.
      When it finishes processing a command, Asterisk will respond with the
      result.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="AGI_id269019"></a>The AGI processes commands in a serial manner.
        Once a command has been executed, no further commands can be executed
        until Asterisk has returned a response. Some commands can take a very
        long time to execute. For example, the <code class="literal">EXEC</code> AGI command executes an Asterisk
        application. If the command is <code class="literal">EXEC
        Dial</code>, AGI communication is blocked until the call is done.
        If your AGI application needs to interact further with Asterisk at
        this point, it can do so using the AMI, which is covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>.</p></div><p><a id="AGI_id269040"></a>A full list of available AGI commands <a id="I_indexterm21_d1e46699" class="indexterm"></a>can be retrieved from the Asterisk console by running the
      command <span class="command"><strong>agi show commands</strong></span>.<a id="I_indexterm21_d1e46708" class="indexterm"></a><a id="I_indexterm21_d1e46711" class="indexterm"></a> These commands are described in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-commands-table" title="Table 21.2. AGI commands">Table&nbsp;21.2, “AGI commands”</a>. To get more detailed information on a
      specific AGI command, including syntax information for any arguments
      that a command expects, use <span class="command"><strong>agi show commands
      topic &lt;COMMAND&gt;</strong></span>.<a id="I_indexterm21_d1e46723" class="indexterm"></a><a id="I_indexterm21_d1e46726" class="indexterm"></a> For example, to see the built-in documentation for the
      <code class="literal">ANSWER</code> AGI command, you would
      use<a id="I_indexterm21_d1e46735" class="indexterm"></a> <span class="command"><strong>agi show commands topic
      ANSWER</strong></span><a id="I_indexterm21_d1e46743" class="indexterm"></a>.</p><div class="table"><a id="AGI-commands-table"></a><p class="title"><strong>Table&nbsp;21.2.&nbsp;AGI commands</strong></p><div class="table-contents"><table summary="AGI commands" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">AGI command</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">ANSWER</code></td><td><a id="I_indexterm21_d1e46763" class="indexterm"></a>Answer the incoming call.</td></tr><tr><td><code class="literal">ASYNCAGI BREAK</code></td><td><a id="I_indexterm21_d1e46772" class="indexterm"></a>End an async AGI session and have the channel
              return to the <span class="application">Asterisk</span> dialplan.</td></tr><tr><td><code class="literal">CHANNEL</code> <code class="literal">STATUS</code></td><td><a id="I_indexterm21_d1e46787" class="indexterm"></a>Retrieve the status of the channel. This is used
              to retrieve the current state of the channel, such as up
              (answered), down (hung up), or ringing.</td></tr><tr><td><code class="literal">DATABASE DEL</code></td><td><a id="I_indexterm21_d1e46796" class="indexterm"></a>Delete a key/value pair from the built-in
              AstDB.</td></tr><tr><td><code class="literal">DATABASE
              DELTREE</code></td><td><a id="I_indexterm21_d1e46805" class="indexterm"></a>Delete a tree of key/value pairs from the built-in
              AstDB.</td></tr><tr><td><code class="literal">DATABASE GET</code></td><td><a id="I_indexterm21_d1e46814" class="indexterm"></a>Retrieve the value for a key in the AstDB.</td></tr><tr><td><code class="literal">DATABASE PUT</code></td><td><a id="I_indexterm21_d1e46823" class="indexterm"></a>Set the value for a key in the AstDB.</td></tr><tr><td><code class="literal">EXEC</code></td><td><a id="I_indexterm21_d1e46832" class="indexterm"></a>Execute an <span class="application">Asterisk</span> dialplan application on
              the channel. This command is very powerful in that between
              <code class="literal">EXEC</code> and <code class="literal">GET FULL VARIABLE</code>, you can do anything
              with the call that you can do from the Asterisk
              dialplan.</td></tr><tr><td><code class="literal">GET DATA</code></td><td><a id="I_indexterm21_d1e46850" class="indexterm"></a>Read digits from the caller.</td></tr><tr><td><code class="literal">GET
              FULL</code> <code class="literal">VARIABLE</code></td><td>Evaluate an Asterisk dialplan expression. You can send a
              string that contains variables and/or dialplan functions, and
              Asterisk will return the result after making the appropriate
              substitutions. This command is very powerful in that between
              <code class="literal">EXEC</code> and <code class="literal">GET FULL VARIABLE</code>, you can do anything
              with the call that you can do from the Asterisk
              dialplan.</td></tr><tr><td><code class="literal">GET OPTION</code></td><td><a id="I_indexterm21_d1e46874" class="indexterm"></a>Stream a sound file while waiting for a digit from
              the caller. This is similar to the <code class="literal">Background()</code> dialplan
              application.</td></tr><tr><td><code class="literal">GET VARIABLE</code></td><td>Retrieve the value of a channel variable.</td></tr><tr><td><code class="literal">HANGUP</code></td><td><a id="I_indexterm21_d1e46893" class="indexterm"></a>Hang up the channel.<sup>[<a id="id638752" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id638752" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">NOOP</code></td><td><a id="I_indexterm21_d1e46908" class="indexterm"></a>Do nothing. You will get a result response from
              this command, just like any other. It can be used as a simple
              test of the communication path with <span class="application">Asterisk</span>.</td></tr><tr><td><code class="literal">RECEIVE CHAR</code></td><td><a id="I_indexterm21_d1e46920" class="indexterm"></a>Receive a single character. This only works for
              channel types that support it, such as IAX2 using <code class="literal">TEXT</code> frames or SIP using the <code class="literal">MESSAGE</code> method.</td></tr><tr><td><code class="literal">RECEIVE TEXT</code></td><td><a id="I_indexterm21_d1e46935" class="indexterm"></a>Receive a text message. This only works in the
              same cases as <code class="literal">RECEIVE
              CHAR</code>.</td></tr><tr><td><code class="literal">RECORD FILE</code></td><td><a id="I_indexterm21_d1e46947" class="indexterm"></a>Record the audio from the caller to a file. This
              is a blocking operation similar to the <code class="literal">Record()</code> dialplan application. To
              record a call in the background while you perform other
              operations, use <code class="literal">EXEC</code> <code class="literal">Monitor</code> or <code class="literal">EXEC MixMonitor</code>.</td></tr><tr><td><code class="literal">SAY ALPHA</code></td><td><a id="I_indexterm21_d1e46968" class="indexterm"></a>Say a string of characters. You can find an
              example of this in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart" title="Quick Start">the section called “Quick Start”</a>. To get
              localized handling of this and the other <code class="literal">SAY</code> commands, set the channel language
              either in the device configuration file (e.g., <code class="filename">sip.conf</code>) or in the dialplan, by
              setting the <code class="literal">CHANNEL(language)</code>
              dialplan function.</td></tr><tr><td><code class="literal">SAY DIGITS</code></td><td><a id="I_indexterm21_d1e46988" class="indexterm"></a>Say a string of digits. For example, 100 would be
              said as “one zero zero” if the channel’s language is set to
              English.</td></tr><tr><td><code class="literal">SAY NUMBER</code></td><td><a id="I_indexterm21_d1e46997" class="indexterm"></a>Say a number. For example, 100 would be said as
              “one hundred” if the channel’s language is set to
              English.</td></tr><tr><td><code class="literal">SAY PHONETIC</code></td><td>Say a string of characters, but use a common word for
              each letter (Alpha, Bravo, Charlie…).</td></tr><tr><td><code class="literal">SAY DATE</code></td><td><a id="I_indexterm21_d1e47012" class="indexterm"></a>Say a given date.</td></tr><tr><td><code class="literal">SAY TIME</code></td><td><a id="I_indexterm21_d1e47022" class="indexterm"></a>Say a given time.</td></tr><tr><td><code class="literal">SAY DATETIME</code></td><td>Say a given date and time using a specified
              format.</td></tr><tr><td><code class="literal">SEND IMAGE</code></td><td><a id="I_indexterm21_d1e47037" class="indexterm"></a>Send an image to a channel. IAX2 supports this,
              but there are no actively developed IAX2 clients that support it
              that we know of.</td></tr><tr><td><code class="literal">SEND TEXT</code></td><td><a id="I_indexterm21_d1e47046" class="indexterm"></a>Send text to a channel that supports it. This can
              be used with SIP and IAX2 channels, at least.</td></tr><tr><td><code class="literal">SET AUTOHANGUP</code></td><td><a id="I_indexterm21_d1e47055" class="indexterm"></a>Schedule the channel to be hung up at a specified
              point in time in the future.</td></tr><tr><td><code class="literal">SET CALLERID</code></td><td><a id="I_indexterm21_d1e47064" class="indexterm"></a>Set the caller ID name and number on the
              channel.</td></tr><tr><td><code class="literal">SET CONTEXT</code></td><td><a id="I_indexterm21_d1e47073" class="indexterm"></a>Set the current dialplan context on the
              channel.</td></tr><tr><td><code class="literal">SET EXTENSION</code></td><td><a id="I_indexterm21_d1e47082" class="indexterm"></a>Set the current dialplan extension on the
              channel.</td></tr><tr><td><code class="literal">SET MUSIC</code></td><td><a id="I_indexterm21_d1e47091" class="indexterm"></a>Start or stop music on hold on the
              channel.</td></tr><tr><td><code class="literal">SET PRIORITY</code></td><td><a id="I_indexterm21_d1e47100" class="indexterm"></a>Set the current dialplan priority on the
              channel.</td></tr><tr><td><code class="literal">SET VARIABLE</code></td><td><a id="I_indexterm21_d1e47109" class="indexterm"></a>Set a channel variable to a given value.</td></tr><tr><td><code class="literal">STREAM FILE</code></td><td><a id="I_indexterm21_d1e47119" class="indexterm"></a>Stream the contents of a file to a
              channel.</td></tr><tr><td><code class="literal">CONTROL STREAM
              FILE</code></td><td><a id="I_indexterm21_d1e47128" class="indexterm"></a>Stream the contents of a file to a channel, but
              also allow the channel to control the stream. For example, the
              channel can pause, rewind, or fast forward the stream.</td></tr><tr><td><code class="literal">TDD MODE</code></td><td><a id="I_indexterm21_d1e47137" class="indexterm"></a>Toggle the TDD (Telecommunications Device for the
              Deaf) mode on the channel.</td></tr><tr><td><code class="literal">VERBOSE</code></td><td><a id="I_indexterm21_d1e47146" class="indexterm"></a>Send a message to the verbose logger channel.
              Verbose messages show up on the <span class="application">Asterisk</span> console if the verbose
              setting is set high enough. Verbose messages will also go to any
              log file that has been configured for the <code class="literal">verbose</code> logger channel in <code class="filename">/etc/asterisk/logger.conf</code>.</td></tr><tr><td><code class="literal">WAIT FOR DIGIT</code></td><td><a id="I_indexterm21_d1e47164" class="indexterm"></a>Wait for the caller to press a digit.</td></tr><tr><td><code class="literal">SPEECH CREATE</code></td><td><a id="I_indexterm21_d1e47173" class="indexterm"></a>Initialize speech recognition. This must be done
              before using other speech AGI commands.<sup>[<a id="id639514" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id639514" class="footnote">b</a>]</sup></td></tr><tr><td><code class="literal">SPEECH SET</code></td><td><a id="I_indexterm21_d1e47191" class="indexterm"></a>Set a speech engine setting. The settings that are
              available are specific to the speech recognition engine in
              use.</td></tr><tr><td><code class="literal">SPEECH DESTROY</code></td><td><a id="I_indexterm21_d1e47200" class="indexterm"></a>Destroy resources that were allocated for doing
              speech recognition. This command should be the last speech
              command executed.</td></tr><tr><td><code class="literal">SPEECH</code> <code class="literal">LOAD</code> <code class="literal">GRAMMAR</code></td><td><a id="I_indexterm21_d1e47215" class="indexterm"></a>Load a grammar.</td></tr><tr><td><code class="literal">SPEECH UNLOAD
              GRAMMAR</code></td><td><a id="I_indexterm21_d1e47224" class="indexterm"></a>Unload a grammar.</td></tr><tr><td><code class="literal">SPEECH</code> <code class="literal">ACTIVATE</code> <code class="literal">GRAMMAR</code></td><td><a id="I_indexterm21_d1e47239" class="indexterm"></a>Activate a grammar that has been loaded.</td></tr><tr><td><code class="literal">SPEECH</code> <code class="literal">DEACTIVATE</code> <code class="literal">GRAMMAR</code></td><td><a id="I_indexterm21_d1e47255" class="indexterm"></a>Deactivate a grammar.</td></tr><tr><td><code class="literal">SPEECH</code> <code class="literal">RECOGNIZE</code></td><td><a id="I_indexterm21_d1e47267" class="indexterm"></a>Play a prompt and perform speech recognition, as
              well as wait for digits to be pressed.</td></tr><tr><td><code class="literal">GOSUB</code></td><td><a id="I_indexterm21_d1e47276" class="indexterm"></a>Execute a dialplan subroutine. This will perform
              in the same way as the <code class="literal">GoSub()</code> dialplan application.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.id638752" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id638752" class="para">a</a>] </sup>When the <code class="literal">HANGUP</code> AGI command is used, the
                  channel is not immediately hung up. Instead, the channel is
                  marked as needing to be hung up. Your AGI application must
                  exit first before Asterisk will continue and perform the
                  actual hangup process.</p></div><div class="footnote"><p><sup>[<a id="ftn.id639514" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id639514" class="para">b</a>] </sup>While Asterisk includes a core API
                  for handling speech recognition, it does not come with a
                  module that provides a speech recognition engine. Digium
                  currently provides two commercial options for speech
                  recognition: <a class="ulink" href="http://www.digium.com/en/products/software/lumenvox.php" target="_top">Lumenvox</a>
                  and <a class="ulink" href="http://www.digium.com/en/products/software/vestec.php" target="_top">Vestec</a>.</p></div></td></tr></tbody></table></div></div><br class="table-break"><div class="sect3" title="Process-based AGI/FastAGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id241920"></a>Process-based AGI/FastAGI</h4></div></div></div><p><a id="AGI_id241926"></a><a id="I_indexterm21_d1e47287" class="indexterm"></a><a id="I_indexterm21_d1e47290" class="indexterm"></a>AGI commands are sent to Asterisk on a single line. The
        line must end with a single newline character. Once a command has been
        sent to Asterisk, no further commands will be processed until the last
        command has finished and a response has been sent back to the AGI
        application. Here is an example response to an AGI command:</p><a id="AGI_id241932"></a><pre class="programlisting">200 result=0</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="AGI_id241938"></a>The Asterisk console allows debugging the
          communications with an AGI application. To enable AGI communication
          debugging, run the <span class="command"><strong>agi set debug
          on</strong></span> command.<a id="I_indexterm21_d1e47302" class="indexterm"></a><a id="I_indexterm21_d1e47305" class="indexterm"></a> To turn debugging off, use <span class="command"><strong>agi set debug off</strong></span><a id="I_indexterm21_d1e47313" class="indexterm"></a><a id="I_indexterm21_d1e47316" class="indexterm"></a>. While this debugging mode is on, all communication
          to and from an AGI application will be printed out to the Asterisk
          console. An example of this output can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart" title="Quick Start">the section called “Quick Start”</a>.</p></div></div><div class="sect3" title="Async AGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id241958"></a>Async AGI</h4></div></div></div><p><a id="AGI_id241964"></a><a id="I_indexterm21_d1e47328" class="indexterm"></a>When you’re using async AGI, commands are issued by
        using the <code class="literal">AGI</code> manager action. To
        see the built-in documentation for the AGI manager action, run
        <span class="command"><strong>manager show command AGI</strong></span><a id="I_indexterm21_d1e47337" class="indexterm"></a><a id="I_indexterm21_d1e47340" class="indexterm"></a> at the <span class="application">Asterisk</span> CLI. A demonstration will help
        clarify how AGI commands are executed using the async AGI method.
        First, an extension is created in the dialplan that runs an async AGI
        session on a channel:</p><a id="AGI_id241981"></a><pre class="programlisting">exten =&gt; 7011,1,AGI(agi:async)
</pre><p><a id="AGI_id241985"></a>The following shows an example manager action
        execution and the manager events that are emitted during async AGI
        processing. After the initial execution of the <code class="literal">AGI</code> manager action, there is an immediate
        response to indicate that the command has been queued up for
        execution. Later, there is a manager event that indicates that the
        queued command has been executed. The <code class="literal">CommandID</code> header can be used to associate
        the initial request with the event that indicates that the command has
        been executed:</p><a id="AGI_id241999"></a><pre class="programlisting"><strong class="userinput"><code>Action: AGI
Channel: SIP/0004F2060EB4-00000013
ActionID: my-action-id
CommandID: my-command-id
Command:  VERBOSE "Puppies like cotton candy." 1</code></strong>

Response: Success
ActionID: my-action-id
Message: Added AGI command to queue

Event: AsyncAGI
Privilege: agi,all
SubEvent: Exec
Channel: SIP/0004F2060EB4-00000013
CommandID: my-command-id
Result: 200%20result%3D1%0A
</pre><p><a id="AGI_id242008"></a>The following output is what was seen on the
        Asterisk console during this async AGI session:<a id="I_indexterm21_d1e47365" class="indexterm"></a></p><a id="AGI_id242012"></a><pre class="screen">    -- Executing [7011@phones:1] AGI("SIP/0004F2060EB4-00000013", 
       "agi:async") in new stack
 agi:async: Puppies like cotton candy.
  == Spawn extension (phones, 7011, 1) exited non-zero on 'SIP/0004F2060EB4-00000013'
</pre></div></div><div class="sect2" title="Ending an AGI Session"><div class="titlepage"><div><div><h3 class="title"><a id="AGI_id242019"></a>Ending an AGI Session</h3></div></div></div><p><a id="AGI_id242025"></a><a id="I_indexterm21_d1e47372" class="indexterm"></a>An AGI session ends when your AGI application is ready for
      it to end. The details about how this happens depend on whether your
      application is using process-based AGI, FastAGI, or async AGI.</p><div class="sect3" title="Process-based AGI/FastAGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id242030"></a>Process-based AGI/FastAGI</h4></div></div></div><p><a id="AGI_id242035"></a><a id="I_indexterm21_d1e47384" class="indexterm"></a><a id="I_indexterm21_d1e47387" class="indexterm"></a>Your AGI application may exit or close its connection at
        any time. As long as the channel has not hung up before your
        application ends, dialplan execution will continue. If channel hangup
        occurs while your AGI session is still active, Asterisk will provide
        notification that this has occurred so that your application can
        adjust its operation as appropriate.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="AGI_id254168"></a>This is an area where behavior has changed
          since Asterisk 1.4. In <span class="keep-together">Asterisk</span> 1.4 and earlier versions, AGI
          would automatically exit and stop operation as soon as the channel
          hung up. It now gives your application the opportunity to continue
          running if needed.</p></div><p><a id="AGI_id254175"></a>If a channel hangs up while your AGI
        application is still executing, a couple of things will happen. If an
        AGI command is in the middle of executing, you may receive a result
        code of <code class="literal">-1</code>. You should not depend
        on this, though, since not all AGI commands require channel
        interaction. If the command being executed does not require channel
        interaction, the result will not reflect the hangup.</p><p><a id="AGI_id254182"></a>The next thing that happens after a channel
        hangs up is that an explicit notification of the hangup is sent to
        your application. For process-based AGI, the signal <code class="literal">SIGHUP</code> will be sent to the process to notify
        it of the hangup. For a FastAGI connection, Asterisk will send a line
        containing the word <code class="literal">HANGUP</code>. If you
        would like to disable having <span class="application">Asterisk</span> send the <code class="literal">SIGHUP</code> signal to your process-based AGI
        application or the <code class="literal">HANGUP</code> string to
        your FastAGI server, you can do so by setting the <code class="literal">AGISIGHUP</code> channel variable, as demonstrated
        in the following short example:</p><a id="AGI_id254203"></a><pre class="programlisting">;
; Don't send SIGHUP to an AGI process
; or the "HANGUP" string to a FastAGI server.
;
exten =&gt; 500,1,Set(AGISIGHUP=no)
    same =&gt; n,AGI(my-agi-application)</pre><p><a id="AGI_id254208"></a>At this point, Asterisk automatically adjusts
        its operation to be in DeadAGI mode. This just means that an AGI
        application can run on a channel that has been hung up. The only AGI
        commands that may be used at this point are those that do not require
        channel interaction. The documentation for the AGI commands built into
        <span class="application">Asterisk</span> includes an
        indication of whether or not each command can be used once the channel
        has been hung up.</p></div><div class="sect3" title="Async AGI"><div class="titlepage"><div><div><h4 class="title"><a id="AGI_id254220"></a>Async AGI</h4></div></div></div><p><a id="AGI_id254225"></a>When you’re using async AGI, the manager
        interface provides mechanisms to notify you about channel hangups.
        When you would like to end an async AGI session for a channel, you
        must execute the <code class="literal">ASYNCAGI BREAK</code>
        command. When the async AGI session ends, Asterisk will send an
        <code class="literal">AsyncAGI</code> manager event with a
        <code class="literal">SubEvent</code> of <code class="literal">End</code>. The following is an example of ending
        an async AGI session:</p><a id="AGI_id242053"></a><pre class="programlisting"><strong class="userinput"><code>Action: AGI
Channel: SIP/0004F2060EB4-0000001b
ActionID: my-action-id
CommandID: my-command-id
Command: ASYNCAGI BREAK</code></strong>

Response: Success
ActionID: my-action-id
Message: Added AGI command to queue

Event: AsyncAGI
Privilege: agi,all
SubEvent: End
Channel: SIP/0004F2060EB4-0000001b
</pre><p><a id="AGI_id242061"></a>At this point, the channel returns to the
        Asterisk dialplan if it has not yet been hung up.<a id="I_indexterm21_d1e47453" class="indexterm"></a></p></div></div></div><div class="sect1" title="Development Frameworks"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AGI_id242068"></a>Development Frameworks</h2></div></div></div><p><a id="AGI_id242074"></a><a id="I_indexterm21_d1e47459" class="indexterm"></a>There have been a number of efforts to create frameworks or
    libraries that make AGI programming easier. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-frameworks" title="Table 21.3. AGI development frameworks">Table&nbsp;21.3, “AGI development frameworks”</a> lists some of them. If you do not see a
    library listed here for your preferred programming language, do a quick
    search for it and you’re likely to find one, as others do exist.</p><div class="table"><a id="AGI-frameworks"></a><p class="title"><strong>Table&nbsp;21.3.&nbsp;AGI development frameworks</strong></p><div class="table-contents"><table summary="AGI development frameworks" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Framework</th><th align="center">Language</th><th align="center">URL</th></tr></thead><tbody><tr><td><span class="application">Adhearsion</span></td><td><a id="I_indexterm21_d1e47485" class="indexterm"></a>Ruby</td><td><a class="ulink" href="http://adhearsion.com/" target="_top">http://adhearsion.com/</a></td></tr><tr><td><span class="application">StarPy</span></td><td><a id="I_indexterm21_d1e47496" class="indexterm"></a>Python</td><td><a class="ulink" href="http://starpy.sourceforge.net/" target="_top">http://starpy.sourceforge.net/</a></td></tr><tr><td><span class="application">Asterisk-Java</span></td><td><a id="I_indexterm21_d1e47507" class="indexterm"></a>Java</td><td><a class="ulink" href="http://asterisk-java.org/" target="_top">http://asterisk-java.org/</a></td></tr><tr><td><span class="application">Asterisk-perl</span></td><td><a id="I_indexterm21_d1e47518" class="indexterm"></a>Perl</td><td><a class="ulink" href="http://asterisk.gnuinter.net/" target="_top">http://asterisk.gnuinter.net/</a></td></tr><tr><td><span class="application">PHPAGI</span></td><td><a id="I_indexterm21_d1e47529" class="indexterm"></a>PHP</td><td><a class="ulink" href="http://phpagi.sourceforge.net/" target="_top">http://phpagi.sourceforge.net/</a></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="AGI_id263225"></a>Conclusion</h2></div></div></div><p><a id="AGI_id263230"></a>AGI provides a powerful interface to Asterisk that
    allows you to implement first-party call control in the programming
    language of your choice. There are multiple approaches that you can take
    to implementing an AGI application. Some approaches can provide better
    performance, but at the cost of more complexity. AGI provides a
    programming environment that may make it easier to integrate Asterisk with
    other systems, or just provide a more comfortable call control programming
    environment for the experienced programmer.<a id="I_indexterm21_d1e47540" class="indexterm"></a><a id="I_indexterm21_d1e47541" class="indexterm"></a></p></div></div><div class="chapter" title="Chapter 22. Clustering"><div class="titlepage"><div><div><h2 class="title"><a id="Clustering"></a>Chapter&nbsp;22.&nbsp;Clustering</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering-SECT-1">Traditional Call Centers</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282177">Hybrid Systems</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id258940">Pure Asterisk, Nondistributed</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282554">Asterisk and Database Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061021">Single Database</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060921">Asterisk and Distributed Device States</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060610">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Clustering_id256278"></a>You cannot eat a cluster of grapes at once,
    but it is very easy if you eat them one by one.</p><div class="attribution"><span>—<span class="attribution">Jacques Roumain</span></span></div></div><p><a id="Clustering_id253886"></a><a id="index-144O432GR1J" class="indexterm"></a><a id="index-486B623AT4C" class="indexterm"></a>The word “clustering” can mean different things to different
  people. Some people would say clustering is simply having a replicated
  system on standby available to be turned on when the primary system fails.
  To others, clustering is having several systems working in concert with one
  another, with replicated data, fully redundant, and infinitely expandable.
  For most people, it’s probably somewhere between those two <span class="keep-together">extremes</span>.</p><p><a id="Clustering_id36061163"></a>In this chapter, we’re going to explore the
  possibilities for clustering that exist with Asterisk at a high level,
  giving you the knowledge and direction to start planning your system into
  the future. As examples, we’ll discuss some of the tools that we’ve used in
  our own large deployments; while there is no single way to go about building
  an Asterisk cluster, the topologies we’ll cover have proven reliable over
  the years.</p><p><a id="Clustering_id36061170"></a>Our examples will delve into building a
  distributed call center, one of the more popular reasons for building a
  distributed system. In some cases this is necessary simply because a company
  has satellite offices it wants to tie into the primary system. For others,
  the goal is to integrate remote employees, or to be able to handle a large
  number of seats. We’ll start by looking at a simple, traditional PBX system,
  and see how that system can eventually grow into something much
  larger.</p><div class="sect1" title="Traditional Call Centers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering-SECT-1"></a>Traditional Call Centers</h2></div></div></div><p><a id="Clustering_id36061184"></a><a id="I_indexterm22_d1e47571" class="indexterm"></a><a id="I_indexterm22_d1e47576" class="indexterm"></a>Most systems deployed before the year 2000 will look quite
    similar. They will involve a set of phone lines delivered either via a PRI
    or through an array of analog lines, which connect to a PBX system that
    delivers calls to handsets that are likely proprietary to the systems
    deployed. These systems will likely provide a basic set of functions, with
    extra functions such as voicemail and conferencing being provided through
    external modules that may cost thousands of dollars. This topology is
    illustrated in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061191" title="Figure 22.1. Traditional call center">Figure&nbsp;22.1, “Traditional call center”</a>.</p><div class="figure-float"><div class="figure"><a id="Clustering_id36061191"></a><p class="title"><strong>Figure&nbsp;22.1.&nbsp;Traditional call center</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47585"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2201.png" alt="Traditional call center"></div></div></div><br class="figure-break"></div><p><a id="Clustering_id36061208"></a>Such systems will utilize a set of rules
    for delivering calls to agents through the standard automatic call
    distribution (ACD) rules, and will have little flexibility. It will likely
    be either impossible or expensive to add remote agents, as the calls would
    need to be delivered over the PSTN, which utilizes two phone lines: one
    for the incoming caller to the queue, and another to be delivered to the
    remote agent (in most cases, the agents just need to reside at the same
    physical location as the PBX itself).</p><p><a id="Clustering_id36061216"></a>These traditional phone systems are
    slowly being phased out, though, as more people start clamoring for the
    features VoIP brings to the table. And even for systems that aren’t going
    to be using VoIP, solutions like Asterisk bring to the table features that
    once cost thousands of dollars as an included part of the software.</p><p><a id="Clustering_id36061222"></a>Of course, with the money invested in
    expensive hardware in traditional systems, it is natural that
    organizations with these systems will want to get as much use from them as
    possible. Plus, simply swapping out an existing system is not only
    expensive (wiring costs for SIP phones, replacement costs for proprietary
    handsets, etc.), but may be invasive to the call center, especially if it
    operates continuously.</p><p><a id="Clustering_id36061225"></a>Perhaps, though, the time to expand has
    come, and the existing system is no longer able to keep up with the number
    of lines required and the number of seats necessary to keep up with
    demand. In this case, it may be advantageous to look toward a hybrid
    system, where the existing hardware continues to be used, but new seats
    and features are added to the system using Asterisk.</p></div><div class="sect1" title="Hybrid Systems"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id282177"></a>Hybrid Systems</h2></div></div></div><p><a id="Clustering_id36061060"></a><a id="I_indexterm22_d1e47602" class="indexterm"></a><a id="I_indexterm22_d1e47607" class="indexterm"></a>A hybrid phone system (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061070" title="Figure 22.2. Remote hybrid system">Figure&nbsp;22.2, “Remote hybrid system”</a>) contains the same functionality and
    hardware as a traditional phone system, with the exception of another
    system such as Asterisk being attached to it, thereby providing additional
    capacity and functionality. Adding Asterisk to a traditional system is
    typically done via a PRI connection. From the viewpoint of the traditional
    system, Asterisk will look like another phone company (central office, or
    CO). Depending on the way the traditional system operates and the services
    available to or from the CO, either Asterisk will deliver calls from the
    PRI through itself and to the existing PBX, or the existing PBX will send
    calls over the PRI connection to Asterisk, which will then direct the
    calls to the new endpoints (phones).</p><div class="figure"><a id="Clustering_id36061070"></a><p class="title"><strong>Figure&nbsp;22.2.&nbsp;Remote hybrid system</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47616"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2202.png" alt="Remote hybrid system"></div></div></div><br class="figure-break"><p><a id="Clustering_id36061087"></a>With Asterisk in the picture,
    functionality can be moved piecemeal from the existing PBX system over to
    Asterisk, which can take on a greater role and command more of the system
    over time. Eventually the existing PBX system may simply be used as a
    method for sending calls to the existing handsets on the agents’ desks,
    with those being phased out over time and replaced with SIP-based phones,
    as the wiring is installed and phones are purchased.</p><p><a id="Clustering_id36061094"></a>By adding Asterisk to the existing
    system, we gain a new set of functionality and advantages, such as:</p><div class="itemizedlist"><a id="Clustering_id36061098"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Clustering_id36061100"></a><a id="Clustering_id36061102"></a>Support for remote employees: calls
        are delivered over the existing Internet <span class="keep-together">connection</span></p></li><li class="listitem"><p><a id="Clustering_id36061106"></a><a id="Clustering_id36061108"></a>Features such as conferencing and
        voicemail (with the possibility of users being notified via email of
        new messages)</p></li><li class="listitem"><p><a id="Clustering_id36061113"></a><a id="Clustering_id36061115"></a>Expanded phone lines using VoIP, and
        a reduction in long-distance costs</p></li></ul></div><p><a id="Clustering_id36061120"></a>Such a system still suffers from a few
    disadvantages, as all the hardware needs to reside at the call center
    facility, and we’re still restricted to using (relatively) expensive
    hardware in the Asterisk system for connecting to the traditional PBX.
    We’re moving in the right direction, though, and with the Asterisk system
    in place we can start the migration over time, limiting interruptions to
    the business and taking a more gradual approach to training users.</p></div><div class="sect1" title="Pure Asterisk, Nondistributed"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id258940"></a>Pure Asterisk, Nondistributed</h2></div></div></div><p><a id="Clustering_id249351"></a><a id="I_indexterm22_d1e47643" class="indexterm"></a>The next step in our journey is the pure Asterisk system. In
    this system we’ve successfully migrated away from the existing PBX system
    and are now handling all functionality through Asterisk. Our existing PRI
    has been attached to Asterisk, and we’ve expanded our capacity by
    integrating an Internet Telephony Service Provider (ITSP) into our system.
    All agents are now using SIP phones, and we’ve even added several remote
    employees. This topology is illustrated in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061143" title="Figure 22.3. Nondistributed Asterisk">Figure&nbsp;22.3, “Nondistributed Asterisk”</a>.</p><div class="figure-float"><div class="figure"><a id="Clustering_id36061143"></a><p class="title"><strong>Figure&nbsp;22.3.&nbsp;Nondistributed Asterisk</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47654"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2203.png" alt="Nondistributed Asterisk"></div></div></div><br class="figure-break"></div><p><a id="Clustering_id36060986"></a>Remote employees can be a great advantage
    for a company. Not only can letting your work from remote locations
    increase employee morale by alleviating the burden of a potentially long
    commute, but it allows employees to work in an environment they are
    comfortable in, which can make them more productive. Furthermore, the call
    center manager does not have any less control over statistics from
    employees; their calls can still be monitored for training purposes, and
    the statistical data gathered look no different to the manager than they
    do for employees residing at the facility.</p><p><a id="Clustering_id36060994"></a>A measurable advantage for the company is
    the reduction in the amount of hardware required to be purchased for each
    employee. If agents can utilize their existing computer systems,
    electrical grids, and Internet connections, the company can save a
    significant amount of money by supporting remote employees. Additionally,
    those employees can be located across the globe to expand the number of
    hours your agents are available, thereby allowing you to serve more time
    zones.</p><p><a id="Clustering_id36061001"></a>Using this system is simple and
    efficient, but as the company grows, the system may reach a capacity
    issue. We’ll look at how the system can be expanded later in this
    chapter.</p></div><div class="sect1" title="Asterisk and Database Integration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id282554"></a>Asterisk and Database Integration</h2></div></div></div><p><a id="Clustering_id287808"></a><a id="index-744T623VB0G" class="indexterm"></a>Integrating Asterisk with a database can add a great deal of
    functionality to your system. Additionally, it provides a way to build
    web-based configuration utilities to make the maintenance of an Asterisk
    system easier. What’s more, it allows instant access to information from
    the dialplan and other parts of the Asterisk system.</p><div class="sect2" title="Single Database"><div class="titlepage"><div><div><h3 class="title"><a id="Clustering_id36061021"></a>Single Database</h3></div></div></div><p><a id="Clustering_id36061026"></a><a id="I_indexterm22_d1e47679" class="indexterm"></a><a id="I_indexterm22_d1e47686" class="indexterm"></a>Adding database integration to Asterisk (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060940" title="Figure 22.4. Asterisk database integration, single server">Figure&nbsp;22.4, “Asterisk database integration, single server”</a>) is a powerful way of gaining access
      to information that can be manipulated by other means. For example, we
      can read information about the extensions and devices in the system from
      a database using the Asterisk Realtime Architecture (discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a>), and we can modify the information stored in
      the database via an external system, such as a web page.</p><p><a id="Clustering_id36061033"></a>The integration with the database adds
      a layer between Asterisk and the web interface that the web designer is
      familiar with, and allows the manipulation of data in a way that doesn’t
      require any additional skill sets. Knowledge of Asterisk itself is left
      to the Asterisk administrator, and the web developer can happily work
      with tools she is <span class="keep-together">familiar
      with</span>.</p><div class="figure"><a id="Clustering_id36060940"></a><p class="title"><strong>Figure&nbsp;22.4.&nbsp;Asterisk database integration, single server</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47704"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2204.png" alt="Asterisk database integration, single server"></div></div></div><br class="figure-break"><p><a id="Clustering_id36060957"></a>Of course, this makes the Asterisk
      system slightly more complex to build, but integration with a database
      via ODBC adds all sorts of possibilities (such as hot-desking, discussed
      in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky" title="Getting Funky with func_odbc: Hot-Desking">the section called “Getting Funky with func_odbc: Hot-Desking”</a>). <code class="literal">func_odbc</code> is a
      powerful tool for the Asterisk administrator, providing the ability to
      build a static dialplan using data that is dynamic in nature. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB" title="Chapter 16. Relational Database Integration">Chapter&nbsp;16, <em>Relational Database Integration</em></a> for more information about how to integrate
      Asterisk with a database, and the functionality it provides.</p><p><a id="Clustering_id36060967"></a>We’re also quite fond of the
      <code class="literal">func_curl</code> module, which provides integration with web
      services over HTTP directly from the dialplan.</p><p><a id="Clustering_id36060971"></a>With the data abstracted from Asterisk
      directly, we will now have an easier time moving toward a system that is
      getting ready to be clustered. We can use something like Linux-HA
      (<a class="ulink" href="http://www.linux-ha.org/wiki/Main_Page" target="_top">http://www.linux-ha.org/wiki/Main_Page</a>) to
      provide automatic failover between systems. While in the event of a
      failure the calls on the system that failed will be lost, the failover
      will take only moments (less than a second) to be detected, and the
      system will appear to its users to be immediately available again. In
      this configuration, since our data is abstracted outside of Asterisk, we
      can use applications such as <span class="command"><strong>unison</strong></span> <span class="keep-together">(<a class="ulink" href="http://www.cis.upenn.edu/~bcpierce/unison/" target="_top">http://www.cis.upenn.edu/~bcpierce/unison/</a>)</span> or
      <span class="command"><strong>rsync</strong></span> to keep the configuration files synchronized
      between the primary and the backup system. We could also use
      <span class="emphasis"><em>subversion</em></span> or <span class="emphasis"><em>git</em></span> to track
      changes to the configuration files, making it easy to roll back changes
      that don’t work out.</p><p><a id="Clustering_id36060843"></a>Of course, if our database goes away
      due to a failure of the hardware or the software, our system will be
      unavailable unless it is programmed in such a way as to be able to work
      without the database connection. This could be accomplished either
      through the use of a local database that simply updates itself
      periodically from the primary database, or through information
      programmed directly into the dialplan. In most cases the functionality
      of the system in this mode will be simpler than when the database was
      available, but at least the system will not be entirely unusable.</p><p><a id="Clustering_id36060852"></a>A better solution would be to use a
      replicated database, which allows data written to one database server to
      be written to another server at the same time. Asterisk can then fail
      over to the other database automatically if the primary server becomes
      unavailable.</p></div><div class="sect2" title="Replicated Databases"><div class="titlepage"><div><div><h3 class="title"><a id="Clustering_id36060859"></a>Replicated Databases</h3></div></div></div><p><a id="Clustering_id36060864"></a><a id="I_indexterm22_d1e47753" class="indexterm"></a><a id="I_indexterm22_d1e47760" class="indexterm"></a><a id="I_indexterm22_d1e47763" class="indexterm"></a>Using a replicated database provides some redundancy in
      the backend to help limit the amount of downtime callers and agents
      experience if a database failure occurs. A <span class="keep-together">master</span>-<span class="keep-together">master</span> database configuration is required
      so that data can be written to either database and be automatically
      replicated to the other system, ensuring that we have an exact copy of
      the data on two physical machines. Another advantage to this approach is
      that a single system no longer needs to handle all the transactions to
      the database; the load can be divided among the servers. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060872" title="Figure 22.5. Asterisk database integration, distributed database">Figure&nbsp;22.5, “Asterisk database integration, distributed database”</a> illustrates this distributed
      design.</p><div class="figure-float"><div class="figure"><a id="Clustering_id36060872"></a><p class="title"><strong>Figure&nbsp;22.5.&nbsp;Asterisk database integration, distributed database</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47780"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2205.png" alt="Asterisk database integration, distributed database"></div></div></div><br class="figure-break"></div><p><a id="Clustering_id36060890"></a>
        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>We’ve used MySQL master-master replication before, and it
          works quite well. It also isn’t all that difficult to set up, and
          several tutorials exist on the Internet. Other database systems will
          likely contain this functionality as well, especially if you’re
          using a commercial system such as Oracle or MS SQL.</p></div><p>
      </p><p><a id="Clustering_id36060895"></a>Failover <a id="I_indexterm22_d1e47791" class="indexterm"></a>can be done natively in Asterisk, as
      <code class="literal">res_odbc</code> and <code class="literal">func_odbc</code> do contain
      configuration options that allow you to specify multiple databases. In
      <code class="literal">res_odbc</code>, you can specify the preferred order for
      database connections in case one fails. In <code class="literal">func_odbc</code>,
      you can even specify different servers for reading data and writing data
      through the dialplan functions you create. All of this flexibility
      allows you to provide a system that works well for your business.</p><p><a id="Clustering_id36060903"></a>External programs can also be used for
      controlling failover between systems. The <span class="command"><strong>pen</strong></span>
      application (<a class="ulink" href="http://siag.nu/pen/" target="_top">http://siag.nu/pen/</a>) is a load
      balancer for simple TCP applications such as HTTP or SMTP, which allows
      several servers to appear as one. This means Asterisk only needs to be
      configured to connect to a single IP address (or hostname); the
      <span class="command"><strong>pen</strong></span> application will take care of controlling which
      server gets used for each request.<a id="I_indexterm22_d1e47817" class="indexterm"></a></p></div></div><div class="sect1" title="Asterisk and Distributed Device States"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id36060921"></a>Asterisk and Distributed Device States</h2></div></div></div><p><a id="Clustering_id36060926"></a><a id="index-075K683AL5Q" class="indexterm"></a><a id="index-017D800UW2B" class="indexterm"></a><a id="index-712R546ED7C" class="indexterm"></a>Device states in Asterisk are important both from a software
    standpoint (Asterisk might need to know the state of a device or the line
    on a device in order to know whether a call can be placed to it) and from
    a user’s perspective (for example, a light may be turned on or off to
    signify whether a particular line is in use, or whether an agent is
    available for any more calls). From the viewpoint of a queue, it is
    extremely important to know the status of the device an agent is using in
    order to determine whether the next caller in the queue can be distributed
    to that agent. Without knowledge of the device’s state, the queue would
    simply place multiple calls to the same endpoint.</p><p><a id="Clustering_id404846"></a>Once you start expanding your single system
    to multiple boxes (potentially in multiple physical locations, such as
    remote or satellite offices), you will need to distribute the device state
    of endpoints between the systems. The kind of implementation that is
    required will depend on whether you’re distributing them between systems
    on the same LAN (low-latency links) or over a WAN (higher-latency links).
    We’ll discuss two device state distribution methods in this section:
    OpenAIS for low-latency links, and XMPP for higher-latency links.</p><div class="sect2" title="Distributing Device States over a LAN"><div class="titlepage"><div><div><h3 class="title"><a id="Clustering_id36060930"></a>Distributing Device States over a LAN</h3></div></div></div><p><a id="Clustering_id404863"></a><a id="I_indexterm22_d1e47842" class="indexterm"></a><a id="I_indexterm22_d1e47849" class="indexterm"></a><a id="I_indexterm22_d1e47852" class="indexterm"></a><a id="I_indexterm22_d1e47857" class="indexterm"></a>The OpenAIS implementation (<a class="ulink" href="http://www.openais.org/doku.php" target="_top">http://www.openais.org/doku.php</a>) was first added to
      Asterisk in the 1.6.1 branch, to enable distribution of device state
      information across servers. The addition of OpenAIS <a id="I_indexterm22_d1e47863" class="indexterm"></a>provided great possibilities for distributed systems, as
      device state awareness is an important aspect of such systems. Previous
      methods required the use of <code class="literal">GROUP()</code> and
      <code class="literal">GROUP_COUNT()</code> for each channel, with that information
      queried for over DUNDi. While this approach is useful in some scenarios
      (we could use this functionality to look up the number of calls our
      systems are handling and direct calls intelligently to systems handling
      fewer calls), as a mechanism for determining device state information it
      is severely lacking.</p><div class="figure"><a id="Clustering_id36060787"></a><p class="title"><strong>Figure&nbsp;22.6.&nbsp;Device state distribution with OpenAIS</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47877"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2206.png" alt="Device state distribution with OpenAIS"></div></div></div><br class="figure-break"><p><a id="Clustering_id418148"></a>OpenAIS did give us the first
      implementation of a system that allows the state of devices and message
      waiting indications to be distributed among multiple Asterisk systems
      (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060787" title="Figure 22.6. Device state distribution with OpenAIS">Figure&nbsp;22.6, “Device state distribution with OpenAIS”</a>). The downside of the
      OpenAIS implementation is that it requires all the systems to live on
      low-latency links, which typically means they all need to reside in the
      same physical location, attached to the same switch. That said, while
      the OpenAIS library does not work across physically separate networks,
      it does allow a <code class="literal">Queue()</code> to reside on one system and
      queue members to reside on another system (or multiple systems). It does
      this without requiring us to use Local channels and test their
      availability through other methods, thereby limiting (or eliminating)
      the number of connection attempts made across the network, and multiple
      device ringing.</p><p><a id="Clustering_id417156"></a>Using OpenAIS has an advantage, in that
      it is relatively easy to configure and get working. The disadvantage is
      that it is not distributable over physical locations. As of Asterisk
      1.8, though, we can use XMPP for device state distribution over a wide
      area network, as you’ll see in the next section.</p><p><a id="Clustering_id417168"></a>More information about configuring
      distributed device states with OpenAIS is available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052" title="Using OpenAIS">the section called “Using OpenAIS”</a>.</p></div><div class="sect2" title="Distributing Device States over a WAN"><div class="titlepage"><div><div><h3 class="title"><a id="Clustering_id36060805"></a>Distributing Device States over a WAN</h3></div></div></div><p><a id="Clustering_id417188"></a><a id="I_indexterm22_d1e47899" class="indexterm"></a><a id="I_indexterm22_d1e47906" class="indexterm"></a><a id="I_indexterm22_d1e47911" class="indexterm"></a>As of Asterisk 1.8, an implementation that uses XMPP for
      device state distribution has been added. Because the XMPP protocol
      <a id="I_indexterm22_d1e47915" class="indexterm"></a>is designed for (or at least allows) usage across wide
      area networks, we can now have Asterisk systems at different physical
      locations distribute device state information to each other (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060551" title="Figure 22.7. Device state distribution with XMPP">Figure&nbsp;22.7, “Device state distribution with XMPP”</a>). With the OpenAIS implementation,
      the library would be used on each system, enabling them to distribute
      device state information. In the XMPP scenario, a central server (or
      cluster of servers) is used to distribute the state among all of the
      Asterisk boxes in the cluster. Currently the best application for doing
      this is the Tigase XMPP server <a id="I_indexterm22_d1e47923" class="indexterm"></a>(<a class="ulink" href="http://www.tigase.org/" target="_top">http://www.tigase.org</a>), because of
      its support for PubSub events. While other XMPP servers may be supported
      in the future, only Tigase is known to work at this time.</p><div class="figure-float"><div class="figure"><a id="Clustering_id36060551"></a><p class="title"><strong>Figure&nbsp;22.7.&nbsp;Device state distribution with XMPP</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47932"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2207.png" alt="Device state distribution with XMPP"></div></div></div><br class="figure-break"></div><p><a id="Clustering_id407760"></a>With XMPP, the queues can be located in
      different physical locations, and satellite offices can take calls from
      the primary office, or vice versa. This provides another layer of
      redundancy, because if the primary site goes offline and the ITSP is set
      up in such a way as to fail over to another office, the calls can be
      distributed among those satellite offices until the primary site goes
      back online. This is quite exciting for many people, as it adds a layer
      of functionality that was not previously available, and most of it can
      be done with relatively minimal configuration.</p><p><a id="Clustering_id414605"></a>The advantage to XMPP device state
      distribution is that it is possible to distribute state to multiple
      physical locations, which is not possible with OpenAIS. The disadvantage
      is that it is more complex to set up (since you need an external service
      running the Tigase XMPP server) than the OpenAIS implementation.</p><p><a id="Clustering_id414611"></a>More information about configuring
      distributed device states with XMPP can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061" title="Using XMPP">the section called “Using XMPP”</a>.<a id="I_indexterm22_d1e47945" class="indexterm"></a><a id="I_indexterm22_d1e47946" class="indexterm"></a><a id="I_indexterm22_d1e47947" class="indexterm"></a></p></div></div><div class="sect1" title="Multiple Queues, Multiple Sites"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id36060570"></a>Multiple Queues, Multiple Sites</h2></div></div></div><p><a id="Clustering_id414632"></a><a id="I_indexterm22_d1e47952" class="indexterm"></a><a id="I_indexterm22_d1e47957" class="indexterm"></a>Now, let’s get creative and use the various tools we’ve
    discussed in the previous sections to build a distributed queue
    infrastructure. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060591" title="Figure 22.8. Distributed queue infrastructure">Figure&nbsp;22.8, “Distributed queue infrastructure”</a> illustrates a
    sample setup where we have five Asterisk servers being fronted by another
    cluster used to distribute/route the calls to the various queues we have
    set up. Our ITSP sends calls to the routing cluster (which could be
    something like Kamailio, or even multiple Asterisk servers implementing
    DUNDi or some other method to route and distribute calls), which then
    sends the calls as appropriate to one of the three Asterisk systems we
    have our queues configured on. Each server handles a different queue, such
    as sales, technical support, and returns. These servers in turn use the
    agents located at two separate physical locations. The agents’ devices are
    registered to their own local registration servers (which may also perform
    other functionality).</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Clustering_id387782"></a>We are not showing all aspects of the
      system, in order to keep the diagram simple, but in this case we would
      be using the XMPP distributed device state system as we’re implying that
      the agents are distributed across multiple physical sites.</p></div><div class="figure"><a id="Clustering_id36060591"></a><p class="title"><strong>Figure&nbsp;22.8.&nbsp;Distributed queue infrastructure</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject22_d1e47971"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2208.png" alt="Distributed queue infrastructure"></div></div></div><br class="figure-break"><p><a id="Clustering_id387811"></a>All of the agents at the different
    locations can be loaded into one or more queues, and because we’re
    distributing device state information, each queue will know the current
    state of the agents in the queue and will only distribute callers to the
    agents as appropriate. Beyond that, we can configure penalties for the
    queues and/or for the agents in order to get the callers to the best
    agents if they are available, and only use the other agents when all the
    best agents are in use (for more information on penalties and priorities,
    refer to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288932" title="Advanced Queues">the section called “Advanced Queues”</a>).</p><p><a id="Clustering_id410651"></a>We can add more agents to the system by
    adding more servers to the cluster at either the same location or
    additional physical locations. We can also expand the number of queues we
    support by adding more servers, each handling a different queue or
    queues.</p><p>A disadvantage to using this system is the way the
    <code class="literal">Queue()</code> application <a id="I_indexterm22_d1e47987" class="indexterm"></a><a id="I_indexterm22_d1e47990" class="indexterm"></a>has been developed. <code class="literal">Queue()</code> is one of the
    older applications in Asterisk, and it has unfortunately not kept up with
    the pace of development in the realm of device state distribution, so
    there is no way to distribute the same <code class="literal">Queue()</code> across
    multiple boxes. For example, suppose you have sales queues on two systems.
    If a caller enters the sales queue on the first Asterisk system, and then
    another caller enters the sales queue on box two, no information will be
    distributed between those queues to indicate who is first and who is
    second in line. The two queues are effectively separate. Perhaps future
    versions of <span class="keep-together">Asterisk</span> will have the
    ability to do that, but at this time it is not supported. We mention this
    so you can plan your system accordingly.</p><p><a id="Clustering_id414636"></a>Since queues in some implementations (such
    as call centers) may be required to handle many calls at once, the
    processing and load requirements for a single system can be quite steep.
    Having the ability to tap into the same agent resources across multiple
    systems means that we can distribute our callers among multiple boxes,
    significantly lowering the processing requirements placed on any single
    system. No longer does one system need to do it all—we can break out
    various components of the system into different servers.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Clustering_id36060610"></a>Conclusion</h2></div></div></div><p><a id="Clustering_id407443"></a>In this chapter we explored how you can
    transition a traditional (non-Asterisk) telephony system into a
    distributed call center. Along the way, we’ve seen how a call center with
    just a few seats can grow into a system with hundreds of seats in
    different physical locations.</p><p><a id="Clustering_id407450"></a>While the ability to grow your business and
    plan for the future is crucial, it is also important to not build a system
    that is more complex than it needs to be. The larger you go, and the more
    distributed a system you build, the longer it will take to get off the
    ground and the harder it will be to do all the things that are important
    when changes occur, such as testing, implementing the changes, and keeping
    things synchronized. If your system is never going to grow beyond a
    40-seat call center, don’t build it for 500 seats. All you’re doing is
    adding additional costs and complexity to accommodate a system on a scale
    that may never be fully realized.</p><p><a id="Clustering_id407458"></a>Building a simple system now and planning
    for the future and how you’re going to get there (especially if you can do
    it in iterations, without having to rip your entire infrastructure apart
    or start from scratch) will get you up and running that much quicker. As
    you grow, you can add more pieces, determine if the approach you’re taking
    is correct, and, if not, go back and rework that particular piece. This
    kind of approach can save you a lot of headaches down the road, when you
    realize you don’t have to redo your entire complex system because of some
    new requirement that you didn’t foresee at the beginning.</p><p><a id="Clustering_id407467"></a>We also mentioned some advantages of having
    a distributed system with remote employees, such as improved employee
    morale and cost savings. You can use your employees’ existing Internet
    connections, hardware, and electricity, which can save the company money,
    and your employees will benefit by avoiding the aggravation and costs of
    commuting to an office every day. While not all situations allow this type
    of scenario, it is worth exploring whether adding support for remote
    employees will be useful to your business.</p><p><a id="Clustering_id407475"></a>Finally, distributed device state can open
    up a world of possibilities for your company, allowing it to grow beyond
    the single Asterisk system that does everything. Breaking out
    functionality to multiple boxes is now a reality, and can be approached
    with a measure of confidence not previously seen.<a id="I_indexterm22_d1e48021" class="indexterm"></a><a id="I_indexterm22_d1e48022" class="indexterm"></a></p></div></div><div class="chapter" title="Chapter 23. Distributed Universal Number Discovery (DUNDi)"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-CHP-5"></a>Chapter&nbsp;23.&nbsp;Distributed Universal Number Discovery (DUNDi)</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-14-SECT-6">How Does DUNDi Work?</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id417246">Configuring Asterisk for Use with DUNDi</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id378872">General Configuration</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id399131">Initial DUNDi Peer Definition</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses">Controlling Responses</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id337604">Using pattern matches</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36002807">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="DUNDi_id419196"></a>A community is like a ship; everyone ought to be
    <span class="keep-together">prepared</span> to take the helm.</p><div class="attribution"><span>—<span class="attribution">Henrik Ibsen</span></span></div></div><p><a id="DUNDi_id387768"></a><a id="index-404O660GC2M" class="indexterm"></a><a id="index-371J154EN7C" class="indexterm"></a>Distributed Universal Number Discovery, or DUNDi, is a service
  discovery protocol that can be used for locating resources at remote
  locations. The original intention of DUNDi was to permit decentralized
  routing among many peers using a General Peering Agreement (GPA). The GPA
  (available at <a class="ulink" href="http://dundi.com/PEERING.pdf" target="_top">http://dundi.com/PEERING.pdf</a>) is
  intended to take on the role of a centralized control authority with a
  document to create a trust relationship among the peers in the cloud. While
  the idea is interesting and sound, the GPA has not taken off. That doesn’t
  mean the DUNDi protocol itself hasn’t found a home though: the original
  intention of DUNDi has been expanded so that now it doesn’t just act as a
  location service, but can be used to request and pass information among
  peers.</p><div class="sect1" title="How Does DUNDi Work?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-14-SECT-6"></a>How Does DUNDi Work?</h2></div></div></div><p><a id="DUNDi_id410532"></a><a id="I_indexterm23_d1e48050" class="indexterm"></a>Think of DUNDi as a large phone book that allows you to ask
    peers if they know of an alternative VoIP route to an extension number or
    PSTN telephone number.</p><p><a id="DUNDi_id404360"></a>For example, assume that you are connected to
    another set of Asterisk boxes listening for and responding to DUNDi
    requests, and those boxes are in turn connected to other Asterisk boxes
    listening for and responding to DUNDi requests. Assume also that your
    system does not have direct access to request anything from the remote
    servers.</p><div class="figure"><a id="DUNDi_id36000936"></a><p class="title"><strong>Figure&nbsp;23.1.&nbsp;DUNDi peer-to-peer request system</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject23_d1e48061"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2301.png" alt="DUNDi peer-to-peer request system"></div></div></div><br class="figure-break"><p><a id="DUNDi_id36000953"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36000936" title="Figure 23.1. DUNDi peer-to-peer request system">Figure&nbsp;23.1, “DUNDi peer-to-peer request system”</a>
    illustrates how DUNDi works. You ask your friend Bob if he knows how to
    reach <code class="literal">4001</code>, an extension to which you have no direct
    access. Bob replies, “I don’t know how to reach that extension, but let me
    ask my peer, Sally.”</p><p><a id="DUNDi_id384565"></a>Bob asks Sally if she knows how to reach the
    requested extension, and she responds with, “You can reach that extension
    at <code class="literal">IAX2/dundi:</code><em class="replaceable"><code>very_long_password@hostname/extension</code></em>.”
    Bob then stores the address in his database and passes on to you the
    information about how to reach <code class="literal">4001</code>. With the newfound
    information, you can then make a separate request to actually place the
    call to Sally’s box in order to reach extension <code class="literal">4001</code>.
    (DUNDi only helps you find the information you need in order to connect;
    it does not actually place the call.)</p><p><a id="DUNDi_id378312"></a>Because Bob has stored the information he found,
    he’ll be able to provide it to any peers who later request the same number
    from him, so the lookup won’t have to go any further. This helps reduce
    the load on the network and decreases response times for numbers that are
    looked up often. (However, it should be noted that DUNDi creates a
    rotating key, and thus stored information is valid for a limited period of
    time.)</p><p><a id="DUNDi_id404350"></a>DUNDi performs lookups dynamically, either with
    a <code class="literal">switch =&gt;</code> statement in your
    <code class="filename">extensions.conf</code> file or with the use of the
    <code class="literal">DUNDILOOKUP()</code> dialplan function.</p><p><a id="DUNDi_id417236"></a>While DUNDi was originally designed and intended
    to be used as a peering fabric for the PSTN, it is used most frequently in
    private networks. If you’re the Asterisk administrator of a large
    enterprise installation (or even an installation with only a pair of
    Asterisk boxes at different physical locations), you may wish to simplify
    the administration of extension numbers. DUNDi is a fantastic tool for
    this, because it allows you to simply share the extensions that have been
    configured at each location dynamically, by requesting the extension
    numbers from the remote location when your local box doesn’t know how to
    reach them.</p><p><a id="DUNDi_id36001148"></a>Additionally, if one of the locations had a
    cheaper route to a PSTN number you wanted to dial, you could request that
    route in your DUNDi cloud. For example, if one box was located in
    Vancouver and the other in Toronto, the Vancouver office could send calls
    destined for the Toronto area across the network using VoIP and out the
    PRI in Toronto, so they can be placed locally on the PSTN. Likewise, the
    Toronto office could place calls destined for Vancouver out of the PRI at
    the Vancouver office.</p></div><div class="sect1" title="The dundi.conf File"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DUNDi_id36001157"></a>The dundi.conf File</h2></div></div></div><p><a id="DUNDi_id36001165"></a><a id="I_indexterm23_d1e48106" class="indexterm"></a><a id="I_indexterm23_d1e48111" class="indexterm"></a><a id="I_indexterm23_d1e48114" class="indexterm"></a>It is often useful to be aware of the options available to
    us prior to delving into the configuration file, but feel free to skip
    this section for now and come back to reference particular options after
    you’ve got your initial configuration up and working.</p><p><a id="DUNDi_id36001171"></a>There are three sections in the
    <code class="filename">dundi.conf</code> file: the <code class="literal">[general]</code>
    section, the <code class="literal">[mappings]</code> section, and the peer
    definitions, such as <code class="literal">[FF:FF:FF:FF:FF:FF]</code>. We’ll show
    the options available for each section in separate tables.</p><p><a id="DUNDi_id36001184"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_general" title="Table 23.1. Options available in the [general] section">Table&nbsp;23.1, “Options available in the [general] section”</a> lists the
    options available in the <code class="literal">[general]</code> section of
    <code class="filename">dundi.conf</code>.<a id="I_indexterm23_d1e48143" class="indexterm"></a></p><div class="table"><a id="options_general"></a><p class="title"><strong>Table&nbsp;23.1.&nbsp;Options available in the [general] section</strong></p><div class="table-contents"><table summary="Options available in the [general] section" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td>
              <code class="literal">department</code>
            </td><td><a id="I_indexterm23_d1e48164" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be: <code class="literal">Communications</code>.</td></tr><tr><td>
              <code class="literal">organization</code>
            </td><td><a id="I_indexterm23_d1e48176" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be: <code class="literal">ShiftEight.org</code>.</td></tr><tr><td>
              <code class="literal">locality</code>
            </td><td><a id="I_indexterm23_d1e48188" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be: <code class="literal">Toronto</code>.</td></tr><tr><td>
              <code class="literal">stateprov</code>
            </td><td><a id="I_indexterm23_d1e48200" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be:
            <code class="literal">Ontario</code>.</td></tr><tr><td>
              <code class="literal">country</code>
            </td><td><a id="I_indexterm23_d1e48212" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be:
            <code class="literal">Canada</code>.</td></tr><tr><td>
              <code class="literal">email</code>
            </td><td><a id="I_indexterm23_d1e48224" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be: <code class="literal">support@shifteight.org</code></td></tr><tr><td>
              <code class="literal">phone</code>
            </td><td><a id="I_indexterm23_d1e48235" class="indexterm"></a>Used when querying a remote system’s contact
            information. An example might be:
            <code class="literal">+1-416-555-1212</code></td></tr><tr><td>
              <code class="literal">bindaddr</code>
            </td><td><a id="I_indexterm23_d1e48246" class="indexterm"></a>Used to control which IP address the system will
            bind to. This can only be an IPv4 address. The default is
            <code class="literal">0.0.0.0</code>, meaning the system will listen (and
            respond) on all available interfaces.</td></tr><tr><td>
              <code class="literal">port</code>
            </td><td><a id="I_indexterm23_d1e48258" class="indexterm"></a>The port to listen for requests on. The default is
            <code class="literal">4520</code>.</td></tr><tr><td>
              <code class="literal">tos</code>
            </td><td><a id="I_indexterm23_d1e48270" class="indexterm"></a>The Terms of Service or Quality of Service (ToS/QoS)
            value to be used for requests. See <a class="ulink" href="https://wiki.asterisk.org/wiki/display/AST/IP+Quality+of+Service" target="_top">https://wiki.asterisk.org/wiki/display/AST/IP+Quality+of+Service</a>
            for more information about the values available and how to use
            them.</td></tr><tr><td>
              <code class="literal">entityid</code>
            </td><td><a id="I_indexterm23_d1e48281" class="indexterm"></a>The entity ID of the system. Should be an externally
            (network) facing MAC address. The format is
            <code class="literal">00:00:00:00:00:00</code>.</td></tr><tr><td>
              <code class="literal">cachetime</code>
            </td><td><a id="I_indexterm23_d1e48294" class="indexterm"></a>How long peers should cache our responses for, in
            seconds. The default is <code class="literal">3600</code>.</td></tr><tr><td>
              <code class="literal">ttl</code>
            </td><td><a id="I_indexterm23_d1e48306" class="indexterm"></a>The time-to-live, or, maximum depth to search the
            network for a response. The maximum wait time for a response is
            calculated using (2000 + 200 * ttl) ms.</td></tr><tr><td>
              <code class="literal">autokill</code>
            </td><td><a id="I_indexterm23_d1e48315" class="indexterm"></a>Used to control how long we wait for an
            <code class="literal">ACK</code> to our <code class="literal">DPDISCOVER</code>.
            Setting this timeout prevents the lookups from stalling due to a
            latent peer. This can be <code class="literal">yes</code>,
            <code class="literal">no</code>, or a numeric value representing the number
            of milliseconds to wait. You can use the
            <code class="literal">qualify</code> option to enable this per-peer.</td></tr><tr><td>
              <code class="literal">secretpath</code>
            </td><td><a id="I_indexterm23_d1e48339" class="indexterm"></a>A rotating key is created and stored within the
            AstDB. The value is stored in the key ’secret’ under the family
            defined by <code class="literal">secretpath</code>. The default
            <code class="literal">secretpath</code> is <code class="literal">dundi</code>,
            resulting in the key being stored in
            <code class="literal">dundi/secret</code> by default.</td></tr><tr><td>
              <code class="literal">storehistory</code>
            </td><td><a id="I_indexterm23_d1e48360" class="indexterm"></a>Used to indicate whether or not the history of the
            last several requests should be stored in memory, along with how
            long the requests took. Valid values are <code class="literal">yes</code>
            and <code class="literal">no</code> (also available using the CLI commands
            <span class="command"><strong>dundi store history</strong></span> and <span class="command"><strong>dundi no store
            history</strong></span>). This is a debugging tool that is disabled by
            default due to possible performance impacts.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="DUNDi_id36001352"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_mappings" title="Table 23.2. Options available in the [mappings] section">Table&nbsp;23.2, “Options available in the [mappings] section”</a> lists the
    options you can configure in the <code class="literal">[mappings]</code> section
    <a id="I_indexterm23_d1e48382" class="indexterm"></a>of <code class="filename">dundi.conf</code>.</p><div class="table"><a id="options_mappings"></a><p class="title"><strong>Table&nbsp;23.2.&nbsp;Options available in the [mappings] section</strong></p><div class="table-contents"><table summary="Options available in the [mappings] section" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td>
              <code class="literal">nounsolicited</code>
            </td><td><a id="I_indexterm23_d1e48405" class="indexterm"></a>Used for advertising no unsolicited calls to the
            returned result. Used in public networks.</td></tr><tr><td>
              <code class="literal">nocomunsolicit</code>
            </td><td><a id="I_indexterm23_d1e48414" class="indexterm"></a>Used for advertising no commercial unsolicited calls
            to the returned result. Used in public networks.</td></tr><tr><td>
              <code class="literal">residential</code>
            </td><td><a id="I_indexterm23_d1e48423" class="indexterm"></a>Used to define the route returned as being a
            residential location. Used in public networks.</td></tr><tr><td>
              <code class="literal">commercial</code>
            </td><td><a id="I_indexterm23_d1e48432" class="indexterm"></a>Used to define the route returned as being a
            commercial location. Used in public networks.</td></tr><tr><td>
              <code class="literal">mobile</code>
            </td><td><a id="I_indexterm23_d1e48441" class="indexterm"></a>Used to define the route returned as being a mobile
            phone. Used in public networks.</td></tr><tr><td>
              <code class="literal">nopartial</code>
            </td><td><a id="I_indexterm23_d1e48450" class="indexterm"></a>Used to prevent partial number lookups from being
            performed against this mapping.</td></tr><tr><td>
              <code class="literal">${NUMBER}</code>
            </td><td><a id="I_indexterm23_d1e48459" class="indexterm"></a>Variable that contains the value of the request
            being looked up.</td></tr><tr><td>
              <code class="literal">${IPADDR}</code>
            </td><td><a id="I_indexterm23_d1e48468" class="indexterm"></a>Variable that contains the IP address of the local
            system. Can be used to dynamically construct mapping responses.
            Not recommended.</td></tr><tr><td>
              <code class="literal">${SECRET}</code>
            </td><td><a id="I_indexterm23_d1e48477" class="indexterm"></a>Variable that contains the value of the rotating
            secret key as defined in the <code class="literal">secretpath</code>
            location within the AstDB.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="DUNDi_id36001464"></a>Finally, <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#options_peerdef" title="Table 23.3. Options available for peer definitions in dundi.conf">Table&nbsp;23.3, “Options available for peer definitions in dundi.conf”</a>
    lists the options available in the peer sections <a id="I_indexterm23_d1e48488" class="indexterm"></a>of <code class="filename">dundi.conf</code>.</p><div class="table"><a id="options_peerdef"></a><p class="title"><strong>Table&nbsp;23.3.&nbsp;Options available for peer definitions in dundi.conf</strong></p><div class="table-contents"><table summary="Options available for peer definitions in dundi.conf" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Description</th></tr></thead><tbody><tr><td>
              <code class="literal">inkey</code>
            </td><td><a id="I_indexterm23_d1e48511" class="indexterm"></a>The inbound authentication key.</td></tr><tr><td>
              <code class="literal">outkey</code>
            </td><td><a id="I_indexterm23_d1e48520" class="indexterm"></a>The key used for authentication to the remote
            peer.</td></tr><tr><td>
              <code class="literal">host</code>
            </td><td><a id="I_indexterm23_d1e48529" class="indexterm"></a>The hostname or IP address of the remote
            peer.</td></tr><tr><td>
              <code class="literal">port</code>
            </td><td><a id="I_indexterm23_d1e48538" class="indexterm"></a>The port on which to communicate with the remote
            peer.</td></tr><tr><td>
              <code class="literal">order</code>
            </td><td><a id="I_indexterm23_d1e48547" class="indexterm"></a>The search order associated with this peer. Values
            include <code class="literal">primary</code>, <code class="literal">secondary</code>,
            <code class="literal">tertiary</code>, and <code class="literal">quartiary</code>. Will only search primary
            peers unless none are available, in which case secondary peers
            will be searched, and so on.</td></tr><tr><td>
              <code class="literal">include</code>
            </td><td><a id="I_indexterm23_d1e48568" class="indexterm"></a>Used to control whether this peer is included in
            searches for the mapping defined. Can be set to the value of
            <code class="literal">all</code> if used for all mappings.</td></tr><tr><td>
              <code class="literal">noinclude</code>
            </td><td><a id="I_indexterm23_d1e48580" class="indexterm"></a>Used to control whether this peer is excluded from
            searches for the mapping defined. Can be set to
            <code class="literal">all</code> if this peer should be excluded from all
            lookups.</td></tr><tr><td>
              <code class="literal">permit</code>
            </td><td><a id="I_indexterm23_d1e48592" class="indexterm"></a>Used to control whether this peer can perform
            lookups against a particular mapping. If the value is set to
            <code class="literal">all</code>, this peer can search against all defined
            mappings.</td></tr><tr><td>
              <code class="literal">deny</code>
            </td><td><a id="I_indexterm23_d1e48604" class="indexterm"></a>Used to control which mappings this peer is
            restricted from searching. The value can be set to
            <code class="literal">all</code> to restrict this peer from being able to
            perform any lookups against defined mappings.</td></tr><tr><td>
              <code class="literal">model</code>
            </td><td><a id="I_indexterm23_d1e48616" class="indexterm"></a>Used to control whether this peer can receive
            requests (<code class="literal">inbound</code>), transmit requests
            (<code class="literal">outbound</code>) or do both
            (<code class="literal">symmetric</code>).</td></tr><tr><td>
              <code class="literal">precache</code>
            </td><td><a id="I_indexterm23_d1e48634" class="indexterm"></a>Typically used when we have a node with only a few
            routes that wants to push those values up to another node that is
            providing more responses (this is known as precaching, providing
            an answer when no request has been received). The values include
            <code class="literal">outgoing</code>, <code class="literal">incoming</code>, and
            <code class="literal">symmetric</code>. If this is set to
            <code class="literal">outgoing</code>, we push routes to this peer. If set
            to <code class="literal">incoming</code>, we receive routes from this peer.
            If set to <code class="literal">symmetric</code>, we do both.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect1" title="Configuring Asterisk for Use with DUNDi"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DUNDi_id417246"></a>Configuring Asterisk for Use with DUNDi</h2></div></div></div><p><a id="DUNDi_id417251"></a><a id="index-241V578NI6K" class="indexterm"></a><a id="index-225F745LG6E" class="indexterm"></a>There are three files that need to be configured for DUNDi:
    <code class="filename">dundi.conf</code>, <code class="filename">extensions.conf</code>, and
    <code class="filename">sip.conf</code>.<sup>[<a id="asterisk-CHP-14-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-14-FN-7" class="footnote">167</a>]</sup> The <code class="filename">dundi.conf</code> file controls the
    authentication of peers whom we allow to perform lookups through our
    system. This file also manages the list of peers to whom we might submit
    our own lookup requests. Since it is possible to run several different
    networks on the same box, it is necessary to define a different section
    for each peer, and then configure the networks in which those peers are
    allowed to perform lookups. Additionally, we need to define which peers we
    wish to use to perform <span class="keep-together">lookups</span>.</p><div class="sect2" title="General Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="DUNDi_id378872"></a>General Configuration</h3></div></div></div><p><a id="DUNDi_id395070"></a><a id="I_indexterm23_d1e48715" class="indexterm"></a><a id="I_indexterm23_d1e48722" class="indexterm"></a>The <code class="literal">[general]</code> section
      of <code class="filename">dundi.conf</code> contains parameters relating to the
      overall operation of the DUNDi client and server:</p><a id="I_programlisting14_tt1707"></a><pre class="programlisting">; DUNDi configuration file for Toronto
;
[general]
;
department=IT
organization=toronto.example.com
locality=Toronto
stateprov=ON
country=CA
email=support@toronto.example.com
phone=+14165551212
;
; Specify bind address and port number.  Default is port 4520.
;bindaddr=0.0.0.0
port=4520
entityid=FF:FF:FF:FF:FF:FF
ttl=32
autokill=yes
;secretpath=dundi</pre><p><a id="DUNDi_id384765"></a>The entity identifier defined by <code class="literal">entityid</code> should generally be the Media Access
      Control (MAC) address of an interface in the machine. The entity ID
      defaults to the first Ethernet address of the server, but you can
      override this with <code class="literal">entityid</code>, as long
      as it is set to the MAC address of <span class="emphasis"><em>something</em></span> you
      own. The MAC address of the primary external interface is recommended.
      This is the address that other peers will use to identify you.</p><p><a id="DUNDi_id384317"></a>The time-to-live (<code class="literal">ttl</code>) field defines how many hops away the
      peers we receive replies from can be and is used to break loops. Each
      time a request is passed on down the line because the requested number
      is not known, the value in the TTL field is decreased by one, much like
      the TTL field of an ICMP packet. The TTL field also defines the maximum
      number of seconds we are willing to wait for a reply.</p><p><a id="DUNDi_id377839"></a>When you request a number lookup, an initial
      query (called a <code class="literal">DPDISCOVER</code>) is sent
      to your peers requesting that number. If you do not receive an
      acknowledgment (<code class="literal">ACK</code>) of your query
      (<code class="literal">DPDISCOVER</code>) within 2000 ms (enough
      time for a single transmission only) and <code class="literal">autokill</code> is set to <code class="literal">yes</code>, Asterisk will send a <code class="literal">CANCEL</code> to the peers. (Note that an
      acknowledgment is not necessarily a reply to the query; it is just an
      acknowledgment that the peer has received the request.) The purpose of
      <code class="literal">autokill</code> is to keep the lookup from
      stalling due to hosts with high latency. In addition to the <code class="literal">yes</code> and <code class="literal">no</code>
      options, you may also specify the number of milliseconds to wait.</p><p><a id="DUNDi_id380112"></a>The <code class="literal">pbx_dundi</code> module
      creates a rotating key and stores it in the local Asterisk database
      (AstDB). The key name <code class="literal">secret</code> is
      stored in the <code class="literal">dundi</code> family. The value
      of the key can be viewed with the <span class="command"><strong>database show</strong></span>
      command at the Asterisk console. The database family can be overridden
      with the <code class="literal">secretpath</code> option.</p><p><a id="DUNDi_id36001817"></a>We need another peer to interact with, so
      here’s the configuration for the other node:</p><p><a id="DUNDi_id36001820"></a><a id="DUNDi_id36001821"></a></p><pre class="programlisting">; DUNDi configuration file for Vancouver
;
[general]
;
department=IT
organization=vancouver.example.com
locality=Vancouver
stateprov=BC
country=CA
email=support@vancouver.example.com
phone=+16135551212
;
; Specify bind address and port number.  Default port is 4520.
;bindaddr=0.0.0.0
port=4520
entityid=00:00:00:00:00:00
ttl=32
autokill=yes
;secretpath=dundi</pre><p>In the next section we’ll create our initial
      DUNDi peers.</p></div><div class="sect2" title="Initial DUNDi Peer Definition"><div class="titlepage"><div><div><h3 class="title"><a id="DUNDi_id399131"></a>Initial DUNDi Peer Definition</h3></div></div></div><p><a id="DUNDi_id399136"></a><a id="I_indexterm23_d1e48811" class="indexterm"></a><a id="I_indexterm23_d1e48818" class="indexterm"></a>A DUNDi peer is identified by the unique layer-two MAC
      address of an interface on the remote system. The
      <code class="filename">dundi.conf</code> file is where we define what context to
      search for peers requesting a lookup and which peers we want to use when
      doing a lookup for a particular network. The following configuration is
      defined in the <code class="filename">dundi.conf</code> file on our Toronto
      system:</p><a id="I_programlisting14_tt1722"></a><pre class="programlisting">[00:00:00:00:00:00] ; Vancouver Remote Office
model = symmetric
host = vancouver.example.com
inkey = vancouver
outkey = toronto
qualify = yes
dynamic=yes</pre><p><a id="DUNDi_id407441"></a>The remote peer’s identifier (MAC address) is
      enclosed in square brackets (<code class="literal">[]</code>). The
      <code class="literal">inkey</code> and <code class="literal">outkey</code> are the public/private key pairs that
      we use for authentication. Key pairs are generated with the <code class="filename">astgenkey</code> script, located in the <code class="filename">~/src/asterisk-complete/asterisk/1.8/contrib/scripts/</code>
      source directory. We use the <code class="filename">-n</code> flag so that we
      don’t have to initialize passwords every time we start Asterisk:</p><a id="I_programlisting14_tt1727"></a><pre class="screen">$ <strong class="userinput"><code>cd /var/lib/asterisk/keys</code></strong>
$ <strong class="userinput"><code>sh ~/src/asterisk-complete/asterisk/1.8/contrib/scripts/astgenkey -n toronto</code></strong></pre><p><a id="DUNDi_id417782"></a>We’ll place the resulting keys, <code class="filename">toronto.pub</code> and <code class="filename">toronto.key</code>, in our <code class="filename">/var/lib/asterisk/keys/</code> directory. The
      <code class="filename">toronto.pub</code> file is the public key,
      which we’ll post to a web server so that it is easily accessible for
      anyone with whom we wish to peer. When we peer, we can give our peers
      the HTTP-accessible public key, which they can then place in their
      <code class="filename">/var/lib/asterisk/keys/</code> directories
      (using something like <span class="command"><strong>wget</strong></span>).</p><p><a id="DUNDi_id36001946"></a>On the Vancouver box, we’ll use the
      following peer configuration in <code class="filename">dundi.conf</code>:</p><p><a id="DUNDi_id36001950"></a><a id="DUNDi_id36001951"></a></p><pre class="programlisting">[FF:FF:FF:FF:FF:FF] ; Toronto Remote Office
model = symmetric
host = toronto.example.com
inkey = toronto
outkey = vancouver
qualify = yes
dynamic=yes</pre><p>Then we’ll execute the same
      <code class="filename">astgenkey</code> script on the Vancouver box to generate
      the public and private <span class="emphasis"><em>vancouver</em></span> keys. Finally,
      we’ll place the <code class="filename">toronto.pub</code> key on the <span class="keep-together">Vancouver</span> server in
      <code class="filename">/var/lib/asterisk/keys/</code> and place the
      <code class="filename">vancouver.pub</code> file on the Toronto server in the
      same location.</p><p><a id="DUNDi_id413389"></a>After downloading the keys, we must reload the
      <code class="filename">res_crypto.so</code> and <code class="filename">pbx_dundi.so</code> modules in Asterisk:</p><a id="I_programlisting14_tt1730"></a><pre class="screen">toronto*CLI&gt; <strong class="userinput"><code>module reload res_crypto.so</code></strong> 
    -- Reloading module 'res_crypto.so' (Cryptographic Digital Signatures)
    -- Loaded PUBLIC key 'vancouver'
    -- Loaded PUBLIC key 'toronto'
    -- Loaded PRIVATE key 'toronto'</pre><a id="DUNDi_id36001999"></a><pre class="screen">vancouver*CLI&gt; <strong class="userinput"><code>module reload res_crypto.so</code></strong> 
    -- Reloading module 'res_crypto.so' (Cryptographic Digital Signatures)
    -- Loaded PUBLIC key 'toronto'
    -- Loaded PUBLIC key 'vancouver'
    -- Loaded PRIVATE key 'vancouver'</pre><p><a id="DUNDi_id36002007"></a>We can verify the keys so we know they’re
      ready to be loaded at any time with the <span class="command"><strong>keys show</strong></span> CLI
      command:</p><p><a id="DUNDi_id36002011"></a><a id="DUNDi_id36002012"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>keys show</code></strong>
Key Name           Type     Status           Sum                              
------------------ -------- ---------------- -------------------------------- 
vancouver          PRIVATE  [Loaded]         c02efb448c37f5386a546f03479f7d5e 
vancouver          PUBLIC   [Loaded]         0a5e53420ede5c88de95e5d908274fb1 
toronto            PUBLIC   [Loaded]         5f806860e0c8219f597f876caa6f2aff 

3 known RSA keys.</pre><p>With the keys loaded into memory, we can reload the
      <code class="filename">pbx_dundi.so</code> module on both systems in order to
      peer them together:</p><a id="DUNDi_id36002027"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>module reload pbx_dundi.so</code></strong>
    -- Reloading module 'pbx_dundi.so' (Distributed Universal Number 
       Discovery (DUNDi))
  == Parsing '/etc/asterisk/dundi.conf': Found</pre><p><a id="DUNDi_id393677"></a>Finally, we can verify that the systems have
      peered successfully with <span class="command"><strong>dundi show peers</strong></span>:</p><a id="DUNDi_id36002049"></a><pre class="screen">toronto*CLI&gt; <strong class="userinput"><code>dundi show peers</code></strong>
EID                  Host                Port   Model      AvgTime  Status         
00:00:00:00:00:00    172.16.0.104    (S) 4520   Symmetric  Unavail  OK (3 ms)      
1 dundi peers [1 online, 0 offline, 0 unmonitored]
</pre><p><a id="DUNDi_id36002057"></a>Now, with our peers configured and
      reachable, we need to create the mapping contexts that will control what
      information will be returned in a lookup.</p></div><div class="sect2" title="Creating Mapping Contexts"><div class="titlepage"><div><div><h3 class="title"><a id="DUNDi_id405996"></a>Creating Mapping Contexts</h3></div></div></div><p><a id="DUNDi_id406002"></a><a id="index-031B444IU5W" class="indexterm"></a><a id="index-353S706ND2K" class="indexterm"></a><a id="index-486V803IW3R" class="indexterm"></a><a id="index-346H314HB7P" class="indexterm"></a>The <code class="filename">dundi.conf</code> file defines DUNDi
      contexts that are mapped to dialplan contexts in your
      <code class="filename">extensions.conf</code> file. DUNDi contexts are a way of
      defining distinct and separate directory service groups. The contexts in
      the <code class="literal">[mapping]</code> section point to contexts in the
      <code class="filename">extensions.conf</code> file, which control the numbers
      that you advertise.</p><p><a id="DUNDi_id36002088"></a>When you create a peer, you need to define
      which mapping contexts you will allow this peer to search. You do this
      with the <code class="literal">permit</code> statement (each peer
      may contain multiple <code class="literal">permit</code>
      <span class="keep-together">statements</span>). Mapping contexts are
      related to dialplan contexts in the sense that they are a security
      boundary for your peers. We’ll enable our mapping in the next
      section.</p><p><a id="DUNDi_id411204"></a>All DUNDi mapping contexts take the form
      of:</p><a id="I_programlisting14_tt1715"></a><pre class="programlisting"><em class="replaceable"><code>dundi_context</code></em> =&gt; <em class="replaceable"><code>local_context</code></em>,<em class="replaceable"><code>weight</code></em>,<em class="replaceable"><code>technology</code></em>,<em class="replaceable"><code>destination</code></em>[,<em class="replaceable"><code>options</code></em>]]</pre><p><a id="DUNDi_id402334"></a>The following configuration creates a DUNDi
      mapping context that we’ll use to advertise our local extension numbers
      to the group. We’ll add this configuration to the
      <code class="filename">dundi.conf</code> file on the Toronto system under the
      <code class="literal">[mappings]</code> header. Note that this should all appear
      on one line:</p><a id="I_programlisting14_tt1716"></a><pre class="programlisting">[mappings]

; All on a single line
;
extensions =&gt; RegisteredDevices,0,SIP,dundi:<em class="replaceable"><code>very_secret_secret</code></em>@toronto.example.com/
${NUMBER},nopartial</pre><p><a id="DUNDi_id402352"></a>The configuration on the Vancouver system will
      look like this:</p><a id="DUNDi_id36002176"></a><pre class="programlisting">[mappings]

; All on a single line
;
extensions =&gt; RegisteredDevices,0,SIP,dundi:<em class="replaceable"><code>very_secret_secret</code></em>@vancouver.example.com/
${NUMBER},nopartial</pre><p><a id="DUNDi_id36002184"></a>In this example, the mapping context is
      <code class="literal">extensions</code>, which points to the
      <code class="literal">RegisteredDevices</code> context within
      <code class="filename">extensions.conf</code> (providing a listing of extension
      numbers to reply with: our phone book). Numbers that resolve to the PBX
      should be advertised with a <em class="replaceable"><code>weight</code></em> of zero
      (directly connected). Numbers higher than zero indicate an increased
      number of hops or paths to reach the final destination. This is useful
      when multiple replies for the same lookup are received at the end that
      initially requested the number; a path with a lower
      <em class="replaceable"><code>weight</code></em> will be preferred. We’ll look at how
      to control responses in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses" title="Controlling Responses">the section called “Controlling Responses”</a>.</p><p><a id="DUNDi_id414020"></a>If we can reply to a lookup, our response will
      contain the method by which the other end can connect to the system.
      This includes the technology to use (such as IAX2, SIP, H323, and so
      on), the username and password with which to authenticate, which host to
      send the authentication to, and finally the extension number.</p><p><a id="DUNDi_id414026"></a>Asterisk provides some shortcuts to allow us
      to create a “template” with which we can build our responses. The
      following channel variables can be used to construct the <span class="keep-together">template</span>:</p><div class="variablelist"><dl><dt><span class="term">
            <code class="literal">${SECRET}</code>
          </span></dt><dd><p><a id="DUNDi_id414045"></a><a id="DUNDi_id414047"></a>Replaced with the password stored in the
            local AstDB. Only used with <code class="filename">iax.conf</code>.</p></dd><dt><span class="term">
            <code class="literal">${NUMBER}</code>
          </span></dt><dd><p><a id="DUNDi_id372142"></a><a id="DUNDi_id372144"></a>The number being requested.</p></dd><dt><span class="term">
            <code class="literal">${IPADDR}</code>
          </span></dt><dd><p><a id="DUNDi_id385432"></a><a id="DUNDi_id385434"></a>The IP address to connect to.</p></dd></dl></div><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-CHP-14-NOTE-51"></a>Warning</h3><p><a id="DUNDi_id399113"></a>It is generally safest to statically
        configure the hostname, rather than make use of the <code class="literal">${IPADDR}</code> variable. The <code class="literal">${IPADDR}</code> variable will sometimes reply with
        an address in the private IP space, which is unreachable from the
        Internet.</p></div><p><a id="DUNDi_id36002328"></a>With our mapping configured, let’s create a
      simple dialplan context against which we can perform lookups for
      testing. We’ll make this more dynamic in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses" title="Controlling Responses">the section called “Controlling Responses”</a>.</p><p><a id="DUNDi_id36002336"></a>In <code class="filename">extensions.conf</code>, we
      can add the following on both systems:</p><p><a id="DUNDi_id36002343"></a><a id="DUNDi_id36002344"></a></p><pre class="programlisting">[RegisteredDevices]
exten =&gt; 1000,1,NoOp()</pre><p>With our dialplan and mappings
      configured, we need to load them into memory from the CLI:</p><p><a id="DUNDi_id36002349"></a><a id="DUNDi_id36002350"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>dialplan reload</code></strong>

*CLI&gt; <strong class="userinput"><code>module reload pbx_dundi.so</code></strong>
    -- Reloading module 'pbx_dundi.so' (Distributed Universal Number 
       Discovery (DUNDi))
  == Parsing '/etc/asterisk/dundi.conf':   == Found</pre><p>We can verify the
      mapping was loaded into memory with the <span class="command"><strong>dundi show
      mappings</strong></span> command:</p><a id="DUNDi_id36002365"></a><pre class="screen">toronto*CLI&gt; <strong class="userinput"><code>dundi show mappings</code></strong>
DUNDi Cntxt  Weight  Local Cntxt  Options    Tech  Destination              
extensions   0       RegisteredDe NONE       SIP   dundi:${SECRET}@172.16.0.
</pre><p><a id="DUNDi_id36002373"></a>With our simple dialplan and mappings
      configured, we need to define the mappings each of our peers is allowed
      to use. We’ll do this in the next section.</p></div><div class="sect2" title="Using Mapping Contexts with Peers"><div class="titlepage"><div><div><h3 class="title"><a id="using-mapping-contexts"></a>Using Mapping Contexts with Peers</h3></div></div></div><p><a id="DUNDi_id36002386"></a>With our mappings defined in the
      <code class="filename">dundi.conf</code> file, we need to give our peers
      permission to use them. Control of the various mappings is done via the
      <code class="literal">permit</code>, <code class="literal">deny</code>,
      <code class="literal">include</code>, and <code class="literal">noinclude</code> options
      within a peer definition. We use <code class="literal">permit</code> and
      <code class="literal">deny</code> to control whether the remote peer is allowed to
      search a particular mapping on our local system. We use
      <code class="literal">include</code> and <code class="literal">noinclude</code> to control
      which peers we will use to perform lookups with in a particular
      mapping.</p><p><a id="DUNDi_id36002419"></a>Since we only have a single mapping defined
      (<code class="literal">extensions</code>), we’re going to
      <code class="literal">permit</code> and <code class="literal">include extensions</code>
      within our peer definitions on both the Toronto and Vancouver
      systems.</p><p><a id="DUNDi_id36002436"></a>On Toronto, we’ll permit Vancouver to search
      the <code class="literal">extensions</code> mapping, and use Vancouver whenever
      we’re performing a lookup within the <code class="literal">extensions</code>
      mapping:</p><p><a id="DUNDi_id36002447"></a><a id="DUNDi_id36002448"></a></p><pre class="programlisting">[00:00:00:00:00:00] ; Vancouver Remote Office
model = symmetric
host = vancouver.example.com
inkey = vancouver
outkey = toronto
qualify = yes
dynamic=yes
<strong class="userinput"><code>permit=extensions
include=extensions</code></strong></pre><p>Similarly, we’ll
      <code class="literal">permit</code> and <code class="literal">include</code> the
      <code class="literal">extensions</code> mapping for the Toronto office on the
      Vancouver system:</p><a id="DUNDi_id36002466"></a><pre class="programlisting">[FF:FF:FF:FF:FF:FF] ; Toronto Remote Office
model = symmetric
host = toronto.example.com
inkey = toronto
outkey = vancouver
qualify = yes
dynamic=yes
<strong class="userinput"><code>permit=extensions
include=extensions</code></strong></pre><p><a id="DUNDi_id36002472"></a>After modifying the peers, we reload the
      <code class="filename">pbx_dundi.so</code> module to have the changes take
      effect:</p><p><a id="DUNDi_id36002479"></a><a id="DUNDi_id36002480"></a></p><pre class="screen">*CLI&gt; <strong class="userinput"><code>module reload pbx_dundi.so</code></strong></pre><p>The
      <code class="literal">include</code> and <code class="literal">permit</code> configuration
      can be verified via the <span class="command"><strong>dundi show peer</strong></span> command
      <a id="I_indexterm23_d1e49240" class="indexterm"></a><a id="I_indexterm23_d1e49243" class="indexterm"></a>on the Asterisk CLI:</p><a id="DUNDi_id36002496"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>dundi show peer 00:00:00:00:00:00</code></strong>
Peer:    00:00:00:00:00:00
Model:   Symmetric
Host:    172.16.0.104
Port:    4520
Dynamic: no
Reg:     No
In Key:  vancouver
Out Key: toronto
<strong class="userinput"><code>Include logic:
-- include extensions
Query logic:
-- permit extensions</code></strong></pre><p><a id="DUNDi_id36002506"></a>Now we can test our lookups. We can do this
      easily from the Asterisk CLI using the <span class="command"><strong>dundi lookup</strong></span>
      command.<a id="I_indexterm23_d1e49261" class="indexterm"></a><a id="I_indexterm23_d1e49264" class="indexterm"></a> If we perform a lookup from the Vancouver system, we’ll
      receive a response from the Toronto system with an address we can use to
      place a call. We’ve added the keyword <code class="literal">bypass</code> to the
      end of the lookup in order to bypass the cache (in case we wish to
      perform several tests):</p><a id="DUNDi_id36002519"></a><pre class="screen">vancouver*CLI&gt; <strong class="userinput"><code>dundi lookup 1000@extensions bypass</code></strong>
  1.     0 SIP/dundi:<em class="replaceable"><code>very_secret_secret</code></em>@172.16.0.161/1000 (EXISTS)
     from ff:ff:ff:ff:ff:ff, expires in 3600 s
DUNDi lookup completed in 12 ms</pre><p><a id="DUNDi_id36002530"></a>The response of
      <code class="literal">SIP/dundi:<em class="replaceable"><code>very_secret_secret</code></em>@172.16.0.161/1000</code>
      gives us an address that we can use to call extension
      <code class="literal">1000</code>. (Of course, we can’t use this address at the
      moment because we haven’t configured any peers on the Toronto (or
      Vancouver) system to actually receive the call, but at least we have the
      DUNDi lookup portion working now!) In the next section we’ll explore how
      to receive calls into our system after we’ve replied to a DUNDi
      response.<a id="I_indexterm23_d1e49293" class="indexterm"></a><a id="I_indexterm23_d1e49294" class="indexterm"></a><a id="I_indexterm23_d1e49295" class="indexterm"></a><a id="I_indexterm23_d1e49296" class="indexterm"></a></p></div><div class="sect2" title="Allowing Remote Connections"><div class="titlepage"><div><div><h3 class="title"><a id="DUNDi_id418721"></a>Allowing Remote Connections</h3></div></div></div><p><a id="DUNDi_id418432"></a><a id="I_indexterm23_d1e49301" class="indexterm"></a><a id="I_indexterm23_d1e49308" class="indexterm"></a><a id="I_indexterm23_d1e49315" class="indexterm"></a>Within our <code class="filename">sip.conf</code> file, we need to
      enable a peer that we can accept calls from and handle that peer’s calls
      in the dialplan appropriately. The authentication is done using a
      password as defined in the mapping within
      <code class="filename">dundi.conf</code>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DUNDi_id36002564"></a>If you’re using
        <code class="filename">iax.conf</code><a id="I_indexterm23_d1e49330" class="indexterm"></a><a id="I_indexterm23_d1e49333" class="indexterm"></a>, you can use the <code class="literal">${SECRET}</code> variable
        <a id="I_indexterm23_d1e49342" class="indexterm"></a>in the mapping in place of the password, which is
        dynamically replaced with a rotated key and is refreshed every 3600
        seconds (1 hour). The value of the secret key is stored in the
        Asterisk database and is accessed using the
        <code class="literal">dbsecret</code> option within the peer definition of
        <code class="filename">iax.conf</code>.</p></div><p><a id="DUNDi_id36002583"></a>Here is the user definition for the
      <code class="filename">dundi</code> user as defined in
      <code class="filename">sip.conf</code>:</p><a id="I_programlisting14_tt1732"></a><pre class="programlisting">[dundi]
type=user
secret=<em class="replaceable"><code>very_secret_secret</code></em>
context=DUNDi_Incoming
disallow=all
allow=ulaw
allow=alaw</pre><p><a id="DUNDi_id418450"></a>The <code class="literal">context</code>
      entry, <code class="literal">DUNDi_Incoming</code>, is where
      authorized callers are sent in <code class="filename">extensions.conf</code>. From there, we can control
      the call just as we would in the dialplan of any other incoming
      connection.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DUNDi_id36002629"></a>We could also use the
        <code class="literal">permit</code> and <code class="literal">deny</code> options for the
        peer in <code class="filename">sip.conf</code> to control which IP addresses
        we’ll accept calls from. Controlling the IP addresses will give us an
        extra layer of security if we’re only expecting calls from known
        endpoints, such as those within our organization.</p></div><p><a id="DUNDi_id36002645"></a>Be sure to reload
      <code class="filename">chan_sip.so</code> to enable the newly created user in
      <code class="filename">sip.conf</code>:</p><p><a id="DUNDi_id36002654"></a><a id="DUNDi_id36002655"></a></p><pre class="screen">toronto*CLI&gt; <strong class="userinput"><code>sip reload</code></strong></pre><p>To
      accept the incoming calls, define the
      <code class="literal">[DUNDi_Incoming]</code> context in
      <code class="filename">extensions.conf</code> and add the following to the
      Toronto system’s dialplan.</p><a id="DUNDi_id36002669"></a><pre class="programlisting">[DUNDi_Incoming]
exten =&gt; 1000,1,Verbose(2,Incoming call from the DUNDi peer)
   same =&gt; n,Answer()
   same =&gt; n,Playback(silence/1)
   same =&gt; n,Playback(tt-weasels)
   same =&gt; n,Hangup()</pre><p><a id="DUNDi_id36002675"></a>Reload the dialplan with <span class="command"><strong>dialplan
      reload</strong></span> <a id="I_indexterm23_d1e49416" class="indexterm"></a><a id="I_indexterm23_d1e49419" class="indexterm"></a>after saving your changes to
      <code class="filename">extensions.conf</code>.</p><p><a id="DUNDi_id36002684"></a>For our first test, we’ll create an
      extension in the <code class="literal">LocalSets</code> context and try placing a
      call to extension <code class="literal">1000</code> using the information provided
      via DUNDi:</p><a id="DUNDi_id36002689"></a><pre class="programlisting">[LocalSets]
exten =&gt; 1000,1,Verbose(2,Test extension to place call to remote server)
same =&gt; n,Dial(SIP/dundi:very_secret_secret@172.16.0.161/1000,30)
same =&gt; n,Hangup()</pre><p><a id="DUNDi_id36002694"></a>If we reload the dialplan and try testing
      the extension by dialing <code class="literal">1000</code>, we should be connected
      to the <code class="filename">tt-weasels</code> prompt on the remote machine.
      With our user configured correctly to accept incoming calls, let’s make
      our dialplan and responses more dynamic with some additional
      tools.</p><div class="sidebar" title="Using dbsecret with iax.conf"><a id="DUNDi_id324986"></a><div class="titlepage"><div><div><p class="title"><strong>Using dbsecret with iax.conf</strong></p></div></div></div><p><a id="DUNDi_id324997"></a><a id="I_indexterm23_d1e49451" class="indexterm"></a>If you use the <code class="filename">iax.conf</code><a id="I_indexterm23_d1e49457" class="indexterm"></a><a id="I_indexterm23_d1e49460" class="indexterm"></a> channel driver, you can authenticate incoming calls
        using the <code class="literal">dbsecret</code> directive in
        <code class="filename">iax.conf</code> along with the
        <code class="literal">${SECRET}</code> variable in your mapping. The use of the
        <code class="literal">${SECRET}</code> variable in the mapping causes a rotated
        password to be sent back in the response, which can then be used for
        authentication via IAX2. Here is an example of an authentication
        definition in the <code class="filename">iax.conf</code> file:</p><a id="DUNDi_id322279"></a><pre class="programlisting">[dundi]
type=friend
context=DUNDi_Incoming
dbsecret=dundi/secret
disallow=all
allow=ulaw
allow=alaw</pre><p><a id="DUNDi_id322278"></a>The password is stored in the AstDB and is
        rotated every 3600 seconds (1 hour). To use the password in your
        mappings, change the mappings in <code class="filename">dundi.conf</code> to
        use <code class="literal">${SECRET}</code> instead of
        <em class="replaceable"><code>very_secret_secret</code></em>. This is the mapping we
        configured on the Vancouver system:</p><a id="DUNDi_id322296"></a><pre class="programlisting">[mappings]

; All on a single line
;
extensions =&gt; RegisteredDevices,0,SIP,dundi:<span class="emphasis"><em>${SECRET}</em></span>@vancouver.example.com/
${NUMBER},nopartial</pre></div></div><div class="sect2" title="Controlling Responses"><div class="titlepage"><div><div><h3 class="title"><a id="controlling-responses"></a>Controlling Responses</h3></div></div></div><p><a id="DUNDi_id36002712"></a><a id="index-067L471UT7M" class="indexterm"></a><a id="index-617R511TM8L" class="indexterm"></a>Responses are controlled with the dialplan. Whenever an
      incoming request matches the dialplan configured for the mapping
      (whether the request is for a specific extension or a pattern match), a
      response will be sent. If the request does not match within the
      dialplan, no response is sent. In the example we’ve been building, the
      extension <code class="literal">1000</code> is the only extension that can be
      matched and thus generate a response.</p><p><a id="DUNDi_id323327"></a>In the next few sections we’ll look at some of
      the methods we can use to control what requests are responded to.</p><div class="sect3" title="Manually adding responses"><div class="titlepage"><div><div><h4 class="title"><a id="DUNDi_id323331"></a>Manually adding responses</h4></div></div></div><p><a id="DUNDi_id399530"></a>The <code class="filename">extensions.conf</code><a id="I_indexterm23_d1e49531" class="indexterm"></a><a id="I_indexterm23_d1e49534" class="indexterm"></a> file handles what numbers you advertise and what you do
        with the calls that connect to them.</p><p><a id="DUNDi_id337579"></a>The simple method to control responses is to
        simply add them manually to the <code class="literal">[RegisteredDevices]</code>
        context. If we had several extensions at one of our locations, we
        could add them all to that context:</p><p><a id="DUNDi_id337586"></a><a id="DUNDi_id337587"></a></p><pre class="programlisting">[RegisteredDevices]
exten =&gt; 1000,1,NoOp()

exten =&gt; 1001,1,NoOp()

exten =&gt; 1002,1,NoOp()</pre><p>The <code class="literal">NoOp()</code>
        dialplan application <a id="I_indexterm23_d1e49552" class="indexterm"></a><a id="I_indexterm23_d1e49555" class="indexterm"></a>is used here because the matching and responding is done
        only against the extension number, and no dialplan is executed. While
        we could overload this context and cause it to also be the destination
        for our calls, it’s not recommended. Other reasons for using the
        <code class="literal">NoOp()</code> application should become clear as we
        progress.</p></div><div class="sect3" title="Using pattern matches"><div class="titlepage"><div><div><h4 class="title"><a id="DUNDi_id337604"></a>Using pattern matches</h4></div></div></div><p><a id="DUNDi_id337610"></a><a id="I_indexterm23_d1e49568" class="indexterm"></a>Of course, adding everything we want to respond with
        manually would be silly, especially if we wanted to advertise a larger
        set of numbers, such as all numbers for an area code. As mentioned
        earlier, in our example we might wish to allow our Toronto and
        Vancouver offices to call out from one another when placing calls that
        are free or cheap to make from the other location.</p><p><a id="DUNDi_id329438"></a>We can respond with all of an area code
        using pattern matches, just as we do in other parts of the
        dialplan:</p><p><a id="DUNDi_id329442"></a>
          <a id="DUNDi_id329443"></a></p><pre class="programlisting">[RegisteredDevices]
exten =&gt; _416NXXXXXX,1,NoOp()
exten =&gt; _647NXXXXXX,1,NoOp()
exten =&gt; _905NXXXXXX,1,NoOp()</pre><p>
        </p><p><a id="DUNDi_id337613"></a>We could also advertise a full or partial
        range of extensions using pattern matches:</p><a id="DUNDi_id329450"></a><pre class="programlisting">[RegisteredDevices]
exten =&gt; _1[1-3]XX,1,NoOp()  ; extensions 1100-&gt;1399

exten =&gt; _1[7-9]XX,1,NoOp()  ; extensions 1700-&gt;1999</pre><p><a id="DUNDi_id329455"></a>Pattern matches are a good way of adding
        ranges of numbers, but these are still static. In the next section
        we’ll explore how we can add some fluidity to the <code class="literal">Registered</code><code class="literal">Devices</code> context.</p></div><div class="sect3" title="Dynamically adding extension numbers"><div class="titlepage"><div><div><h4 class="title"><a id="DUNDi_id329464"></a>Dynamically adding extension numbers</h4></div></div></div><p><a id="DUNDi_id329470"></a><a id="I_indexterm23_d1e49595" class="indexterm"></a><a id="I_indexterm23_d1e49598" class="indexterm"></a>In some cases, you might want to only advertise
        extensions at your location that are currently registered to the
        system. Perhaps we have a salesperson who flies between the Toronto
        and Vancouver offices, and plugs her laptop into the network and
        registers at whichever location she is currently at. In that case, we
        would want to make sure that calls to that person are routed to the
        appropriate office in order to avoid sending calls across the country
        unnecessarily.</p><p><a id="DUNDi_id307879"></a>The <code class="literal">regcontext</code> <a id="I_indexterm23_d1e49607" class="indexterm"></a>and <code class="literal">regexten</code> options<a id="I_indexterm23_d1e49614" class="indexterm"></a> in <code class="filename">iax.conf</code> and
        <code class="filename">sip.conf</code> are useful for this. When a peer
        registers the value associated with <code class="literal">regexten</code> for
        that peer, an extension of that value will be created in the context
        defined by <code class="literal">regcontext</code>. So, for example, if we
        define <code class="literal">regcontext</code> in the
        <code class="literal">[general]</code> section of <code class="filename">sip.conf</code>
        to contain <code class="literal">RegisteredDevices</code>, and we define the
        <code class="literal">regexten</code> for each peer to contain the extension
        number of that peer, when the peers register the
        <code class="literal">RegisteredDevices</code> context will be populated
        automatically for us. We’ll modify our <code class="filename">sip.conf</code>
        to look like this:</p><a id="DUNDi_id345199"></a><pre class="programlisting">[general]
regcontext=RegisteredDevices

[0000FFFF0001](office-phone)
regexten=1001</pre><p><a id="DUNDi_id345202"></a>and then reload
        <code class="filename">chan_sip.so</code>.</p><p><a id="DUNDi_id345219"></a>Now, we’ll register our device to the system
        and look at the <code class="literal">RegisteredDevices</code> context:</p><a id="DUNDi_id345226"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>dialplan show RegisteredDevices</code></strong>
[ Context 'RegisteredDevices' created by 'SIP' ]
  '1001' =&gt;         1. Noop(0000FFFF0001)                   [SIP]
  '1002' =&gt;         1. Noop(0000FFFF0002)                   [SIP]</pre><p><a id="DUNDi_id307299"></a>With our devices registered and the context
        used for determining when to respond populated, the only task left is
        to include the <code class="literal">LocalSets</code> context within the
        <code class="literal">DUNDi_</code><code class="literal">Incoming</code> context in order to permit
        routing of calls to the endpoints.</p></div><div class="sect3" title="Using dialplan functions in mappings"><div class="titlepage"><div><div><h4 class="title"><a id="DUNDi_id307312"></a>Using dialplan functions in mappings</h4></div></div></div><p><a id="DUNDi_id307317"></a><a id="I_indexterm23_d1e49684" class="indexterm"></a><a id="I_indexterm23_d1e49689" class="indexterm"></a><a id="I_indexterm23_d1e49694" class="indexterm"></a>Sometimes it’s useful to utilize a dialplan function
        within the mappings to control what a peer responds with. Throughout
        this book we’ve been touting the advantages of decoupling the user’s
        extension number from the device in order to permit hot-desking.
        Because the other end is just going to request an extension number and
        won’t necessarily know the location of the device on our system, we
        can use the <code class="literal">DB()</code> and <code class="literal">DB_EXISTS()</code>
        functions within the mapping to perform a lookup from our AstDB for
        the device to call.<sup>[<a id="id647201" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id647201" class="footnote">168</a>]</sup></p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="DUNDi_id306540"></a>Prior to Asterisk version 1.8.3, the
          maximum length of the <em class="replaceable"><code>destination</code></em> field
          (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996" title="Creating Mapping Contexts">the section called “Creating Mapping Contexts”</a>) was 80 characters, which
          made the use of nested dialplan functions nearly impossible. As of
          Asterisk 1.8.3, the maximum length is 512 characters.</p></div><p><a id="DUNDi_id306554"></a>First we need to make sure our database is
        populated with the information we might respond with. While this would
        normally be done by the dialplan written for the hot-desking
        implementation, we’ll just add the content directly from the Asterisk
        console for demonstration purposes:</p><a id="DUNDi_id306560"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>database put phones 1001/device 0000FFFF0001</code></strong>
Updated database successfully</pre><p><a id="DUNDi_id339896"></a>With our database populated, we need to
        modify our mapping to utilize some dialplan functions that will take
        the value requested, perform a lookup to our database for that value,
        and return a value. If no value exists in the database, we’ll return
        the value of <code class="literal">None</code>.</p><p><a id="DUNDi_id339905"></a>Our existing mapping looks like this:</p><a id="DUNDi_id339909"></a><pre class="programlisting">[mappings]
; The mapping exists on a single line
extensions =&gt; RegisteredDevices,0,SIP,
   dundi:very_secret_secret@toronto.example.com/${NUMBER},nopartial</pre><p><a id="DUNDi_id339916"></a>Our current example simply reflects back the
        same extension number that was requested, along with some
        authentication information. The number requested is the extension the
        peer is looking for. However, because we’re using hot-desking, the
        extension number may be located at various phone locations, so we may
        want to return the device identifier directly.<sup>[<a id="id647327" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id647327" class="footnote">169</a>]</sup> We can do this by being clever with the use of dialplan
        functions in our response. While we may not have the full power of the
        dialplan (multiple lines, complex logic, etc.) at our disposal, we can
        at least use some of the simpler dialplan functions, such as
        <code class="literal">DB()</code>, <code class="literal">DB_EXISTS()</code>, and
        <code class="literal">IF()</code>.</p><p><a id="DUNDi_id347306"></a>We’re going to replace
        <code class="literal">${NUMBER}</code> with the following bit of dialplan
        logic:</p><a id="DUNDi_id347312"></a><pre class="programlisting">${IF($[${DB_EXISTS(phones/${NUMBER}/device)}]?${DB(phones/${NUMBER}/device)}:None)}</pre><p><a id="DUNDi_id347316"></a>If we break this down, we end up with an
        <code class="literal">IF()</code> statement that will return either true or
        false. If false, we return the value of <code class="literal">None</code>. If
        true, we return the value located in the database at
        <code class="literal">phones/${NUMBER}/device</code> (where
        <code class="literal">${NUMBER}</code> contains the value of
        <code class="literal">1001</code> for our example) using the
        <code class="literal">DB()</code> function. To determine which value the
        <code class="literal">IF()</code> function will return, we use the
        <code class="literal">DB_EXISTS()</code> function. This function checks whether
        a value exists at <code class="literal">phones/${NUMBER}/device</code> within
        the AstDB, and returns either <code class="literal">1</code> or
        <code class="literal">0</code> (true or false).</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DUNDi_id347262"></a>The <code class="literal">DB_EXISTS()</code>
          function <a id="I_indexterm23_d1e49814" class="indexterm"></a><a id="I_indexterm23_d1e49817" class="indexterm"></a>not only returns <code class="literal">1</code> or
          <code class="literal">0</code>, but also sets the
          <code class="literal">${DB_RESULT}</code> channel variable that contains the
          value inside the database if the return value is
          <code class="literal">1</code>. However, we can’t use that value because the
          <code class="literal">IF()</code> function is evaluated prior to the condition
          field being evaluated, which means <code class="literal">${DB_RESULT}</code>
          will be blank. Thus, we need to use the <code class="literal">DB()</code>
          function to look up the value prior to the condition field being
          <span class="keep-together">evaluated</span>.</p></div><p><a id="DUNDi_id319435"></a>After reloading
        <code class="filename">pbx_dundi.so</code> from the console (<span class="command"><strong>module
        reload pbx_dundi.so</strong></span>), we can perform a lookup from another
        server and check out the result:</p><a id="DUNDi_id319446"></a><pre class="screen">vancouver*CLI&gt; <strong class="userinput"><code>dundi lookup 1001@extensions bypass</code></strong>
  1.     0 SIP/dundi:very_awesome_password/0000FFFF0001 (EXISTS)
     from ff:ff:ff:ff:ff:ff, expires in 3600 s
DUNDi lookup completed in 77 ms</pre><p><a id="DUNDi_id317784"></a>With dialplan functions, you can make the
        responses in your dialplans a lot more dynamic. In the next section
        we’ll look at how you can perform these lookups from the dialplan
        using the <code class="literal">DUNDILOOKUP()</code><a id="I_indexterm23_d1e49865" class="indexterm"></a><a id="I_indexterm23_d1e49868" class="indexterm"></a>, <code class="literal">DUNDIQUERY()</code><a id="I_indexterm23_d1e49876" class="indexterm"></a><a id="I_indexterm23_d1e49879" class="indexterm"></a>, and <code class="literal">DUNDIRESULT()</code>
        functions<a id="I_indexterm23_d1e49889" class="indexterm"></a><a id="I_indexterm23_d1e49892" class="indexterm"></a>.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="DUNDi_id317802"></a>When you perform lookups using the example
          in this chapter, because all the peers in your network will return a
          result (<code class="literal">None</code>, or the value you want), you’ll need
          to use the <code class="literal">DUNDIQUERY()</code> and
          <code class="literal">DUNDIRESULT()</code> functions to parse through the list
          of results returned. The alternative would be to try calling
          <code class="literal">SIP/dundi:very_long_pass@remote_server/None</code>, but
          this wouldn’t be very effective. You might even want to handle the
          extension <code class="literal">None</code> elegantly, in case it gets
          called.<a id="I_indexterm23_d1e49917" class="indexterm"></a><a id="I_indexterm23_d1e49918" class="indexterm"></a></p></div></div></div><div class="sect2" title="Performing Lookups from the Dialplan"><div class="titlepage"><div><div><h3 class="title"><a id="DUNDi_id301073"></a>Performing Lookups from the Dialplan</h3></div></div></div><p><a id="DUNDi_id301078"></a><a id="I_indexterm23_d1e49923" class="indexterm"></a><a id="I_indexterm23_d1e49930" class="indexterm"></a><a id="I_indexterm23_d1e49933" class="indexterm"></a><a id="I_indexterm23_d1e49938" class="indexterm"></a>Performing lookups from the dialplan is really the bread
      and butter of all of this, because it allows more dynamic routing from
      within the dialplan. With DUNDi, you can perform lookups and route calls
      within your cluster using either the <code class="literal">DUNDILOOKUP()</code> or
      <code class="literal">DUNDIQUERY()</code> and <code class="literal">DUNDIRESULT()</code>
      functions.</p><p><a id="DUNDi_id301094"></a>The <code class="literal">DUNDILOOKUP()</code> function
      <a id="I_indexterm23_d1e49960" class="indexterm"></a><a id="I_indexterm23_d1e49963" class="indexterm"></a>replaces the old <code class="literal">DUNDiLookup()</code> dialplan
      application, performing nearly the same functionality. With
      <code class="literal">DUNDILOOKUP()</code>, you perform your lookup like you would
      at the Asterisk console, and the result can then be saved into a channel
      variable, or used wherever you might use a dialplan function. Here is an
      example:</p><a id="DUNDi_id323481"></a><pre class="programlisting">[TestContext]
exten =&gt; 1001,1,Verbose(2,Look up extension 1001)
same =&gt; n,Set(DUNDi_Result=${DUNDILOOKUP(1001,extensions,b)})
same =&gt; n,Verbose(2,The result of the lookup was ${DUNDi_Result})
same =&gt; n,Hangup()</pre><p><a id="DUNDi_id323489"></a>The arguments passed to
      <code class="literal">DUNDILOOKUP()</code> are:
      <em class="replaceable"><code>extension</code></em>,<em class="replaceable"><code>context</code></em>,<em class="replaceable"><code>options</code></em>.
      Only one option, <code class="literal">b</code>, is available for the
      <code class="literal">DUNDILOOKUP()</code> function, and that is used to bypass
      the local cache. The advantage to using the
      <code class="literal">DUNDILOOKUP()</code> function is that it is straightforward
      and easy to use. The disadvantage is that it will only set the first
      value returned; if multiple values are returned, they will be
      discarded.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="DUNDi_id323520"></a>You won’t always want to use the bypass
        option when performing lookups, because the use of the cache is what
        will lower the number of requests over your network and limit the
        amount of resources required. We’re using it in our examples simply
        because it is useful for testing purposes, so that we know we’ve
        returned a result each time rather than just a cached value from the
        previous lookup.</p></div><p><a id="DUNDi_id309146"></a>To parse through multiple returned values, we
      need to use the <code class="literal">DUNDIQUERY()</code><a id="I_indexterm23_d1e50008" class="indexterm"></a><a id="I_indexterm23_d1e50011" class="indexterm"></a> and <code class="literal">DUNDIRESULT()</code> functions<a id="I_indexterm23_d1e50020" class="indexterm"></a><a id="I_indexterm23_d1e50023" class="indexterm"></a>. Each plays an important part in sifting through multiple
      returned values from a lookup. The <code class="literal">DUNDIQUERY()</code>
      function performs the initial lookup and saves the resulting hash into
      memory. An ID value is then returned, which can be stored in a channel
      variable. The ID value returned from the <code class="literal">DUNDIQUERY()</code>
      function can then be passed to the <code class="literal">DUNDIRESULT()</code>
      function to parse through the returned values from the query.</p><p><a id="DUNDi_id309168"></a>Lets take a look at some dialplan that uses
      these functions:</p><a id="DUNDi_id309171"></a><pre class="programlisting">[TestContext]
exten =&gt; _1XXX,1,Verbose(2,Looking up results for extension ${EXTEN})

; Perform our lookup and save the resulting ID to DUNDI_ID
   same =&gt; n,Set(DUNDI_ID=${DUNDIQUERY(${EXTEN},extensions,b)})
   same =&gt; n,Verbose(2,Showing all results returned from the DUNDi Query)

; The DUNDIRESULT() function can return the number of results using 'getnum'
   same =&gt; n,Set(NumberOfResults=${DUNDIRESULT(${DUNDI_ID},getnum)})
   same =&gt; n,Set(ResultCounter=1)

; If there is less than 1 result, no results were returned
   same =&gt; n,GotoIf($[${NumberOfResults} &lt; 1]?NoResults,1)

; The start of our loop showing the returned values
   same =&gt; n,While($[${ResultCounter} &lt;= ${NumberOfResults}])

; Save the returned result at position ${ResultCounter} to thisResult
   same =&gt; n,Set(thisResult=${DUNDIRESULT(${DUNDI_ID},${ResultCounter})})

; Show the current result on the console
   same =&gt; n,Verbose(2,One of the results returned was: ${thisResult})

; Increase the counter by one
   same =&gt; n,Set(ResultCounter=${INC(ResultCounter)})

; End of our loop
   same =&gt; n,EndWhile()
   same =&gt; n,Playback(silence/1)
   same =&gt; n,Playback(vm-goodbye)
   same =&gt; n,Hangup()

; If no results were found, execute this dialplan
exten =&gt; NoResults,1,Verbose(2,No results were found)
   same =&gt; n,Playback(silence/1)
   same =&gt; n,Playback(invalid)
   same =&gt; n,Hangup()</pre><p><a id="DUNDi_id309174"></a>Our example dialplan performs a lookup using
      the <code class="literal">DUNDIQUERY()</code> function and stores the resulting ID
      value in the <code class="literal">DUNDI_ID</code> channel variable. Using the
      <code class="literal">DUNDIRESULT()</code> function and the
      <code class="literal">getnum</code> option, we store the total number of returned
      results in the <code class="literal">NumberOfResults</code> channel variable. We
      then set the <code class="literal">ResultCounter</code> channel variable to
      <code class="literal">1</code> as our starting position in the loop.</p><p><a id="DUNDi_id337667"></a>Using <code class="literal">GotoIf()</code>, we check if
      the <code class="literal">${NumberOfResults}</code> returned is less than one and,
      if so, jump to the <code class="literal">NoResults</code> extension, where we
      <code class="literal">Playback()</code> “Invalid extension”. If at least one
      extension is found, we continue on in the dialplan.</p><p><a id="DUNDi_id300343"></a>Using the <code class="literal">While()</code>
      application, we check if the <code class="literal">${ResultCounter}</code> is less
      than or equal to the value of <code class="literal">${NumberOfResults}</code>. If
      that is true, we continue on in the dialplan, and otherwise, we jump to
      the <code class="literal">EndWhile()</code> application.</p><p><a id="DUNDi_id300361"></a>For each iteration of our loop, the
      <code class="literal">DUNDIRESULT()</code> function is used to save the value at
      position <code class="literal">${ResultCounter}</code> to the
      <code class="literal">thisResult</code> channel variable. After storing the value,
      we output it to the Asterisk console using the
      <code class="literal">Verbose()</code> application. Following that, we increase
      the value of <code class="literal">ResultCounter</code> by one using the
      <code class="literal">INC()</code> function. Our loop test is then done again
      within the <code class="literal">While()</code> loop, and the loop will continue
      while the value of <code class="literal">${ResultCounter}</code> is less than or
      equal to the value of <code class="literal">${Number OfResults}</code>.</p><p><a id="DUNDi_id309853"></a>Using the same type of logic, we could check
      for values other than <code class="literal">None</code> and, if such a value is
      found, <code class="literal">ExitWhile()</code> and continue in the dialplan to
      perform a call to the endpoint. The dialplan logic might look something
      like this:</p><p><a id="DUNDi_id309858"></a>
        <a id="DUNDi_id309859"></a></p><pre class="programlisting">[subLookupExtension]
exten =&gt; _1XXX,1,Verbose(2,Looking up results for extension ${EXTEN})

; Perform our lookup and save the resulting ID to DUNDI_ID
   same =&gt; n,Set(DUNDI_ID=${DUNDIQUERY(${EXTEN},extensions,b)})
   same =&gt; n,Set(NumberOfResults=${DUNDIRESULT(${DUNDI_ID},getnum)})
   same =&gt; n,Set(ResultCounter=1)

; If no results are found, return 'None'
   same =&gt; n,GotoIf($[${NumberOfResults} &lt; 1]?NoResults,1)

; Perform our loop
   same =&gt; n,While($[${ResultCounter} &lt;= ${NumberOfResults}])

; Get the current value
   same =&gt; n,Set(thisResult=${DUNDIRESULT(${DUNDI_ID},${ResultCounter})})

; If the current value returned is not None, we have a resulting
; location to call and we can exit the loop
   same =&gt; n,ExecIf($["${thisResult}" != "None"]?ExitWhile())

; If we made it this far, no value has been returned yet that we want to
; use, so increase the counter and try the next value.
   same =&gt; n,Set(ResultCounter=${INC(ResultCounter)})

; End of our loop
   same =&gt; n,EndWhile()

; We've made it here because we made it to the end of the loop or we found
; a value we want to return. Check to see which it is. If we just ran out of
; values, return 'None'.
;
   same =&gt; n,GotoIf($["${thisResult}" = "None"]?NoResults,1)

; If we make it here, we have a value we want to return.
   same =&gt; n,Return(${thisResult})

; If there were no acceptable results, return the value 'None'
   exten =&gt; NoResults,1,Verbose(2,No results were found)
same =&gt; n,Return(None)</pre><p>
      </p><p><a id="DUNDi_id309862"></a>With the <code class="literal">DUNDIQUERY()</code> and
      <code class="literal">DUNDIRESULT()</code> functions, you have a lot of power to
      control how to handle the results returned and perform routing logic
      with those values.<a id="I_indexterm23_d1e50145" class="indexterm"></a><a id="I_indexterm23_d1e50146" class="indexterm"></a></p></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="DUNDi_id36002807"></a>Conclusion</h2></div></div></div><p><a id="DUNDi_id36002812"></a>In this chapter we looked at how the DUNDi
    protocol helps you to perform lookups against the other Asterisk systems
    in your cluster, to perform dynamic routing. With the use of DUNDi, you
    can take multiple systems and control when and where calls are placed
    within them, providing toll-bypass capabilities and even giving your
    employees the ability to move between physical locations, while also
    limiting the number of out-of-system hops a call must take to find
    them.</p><p><a id="DUNDi_id332980"></a>While the original intention of DUNDi was to
    help us migrate away from centralized directory services—an intention that
    has yet to come to fruition—DUNDi is an extremely effective and useful
    tool that can be put to work in organizations to advertise and route calls
    dynamically between systems in a cloud environment. DUNDi is a tool that
    gives great power to Asterisk administrators looking to create a
    distributed <span class="keep-together">network</span>.<a id="I_indexterm23_d1e50157" class="indexterm"></a><a id="I_indexterm23_d1e50158" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-14-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-14-FN-7" class="para">167</a>] </sup>The <code class="filename">dundi.conf</code> and
        <code class="filename">extensions.conf</code> files must be configured. We have
        chosen to configure <code class="filename">sip.conf</code> for the purposes of
        address advertisement on our network, but DUNDi is protocol-agnostic,
        so <code class="filename">iax.conf</code>, <code class="filename">h323.conf</code>, or
        <code class="filename">mgcp.conf</code> could be used instead. DUNDi simply
        performs the lookups; the standard methods of placing calls are still
        required.</p></div><div class="footnote"><p><sup>[<a id="ftn.id647201" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id647201" class="para">168</a>] </sup>…or <code class="literal">func_odbc</code>, or
            <code class="literal">func_curl</code>, or <code class="literal">res_ldap</code>
            (using the <code class="literal">REALTIME_FIELD()</code> function).</p></div><div class="footnote"><p><sup>[<a id="ftn.id647327" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id647327" class="para">169</a>] </sup>We’ve also looked at using the <code class="literal">GROUP()</code>
            and <code class="literal">GROUP_COUNT()</code> functions for looking up the
            current channel usage on a remote system to determine which
            location to route calls to (the one with the lowest channel usage)
            as a simple load balancer.</p></div></div></div><div class="chapter" title="Chapter 24. System Monitoring and Logging"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Monitoring"></a>Chapter&nbsp;24.&nbsp;System Monitoring and Logging</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262409">Reviewing Asterisk Logs</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262478">Logging to the Linux syslog Daemon</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id265067">Verifying Logging</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin-SECT-1">Call Detail Records</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263137">Backends</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249846">cdr_manager</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249944">cdr_mysql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249958">cdr_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249972">cdr_pgsql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250127">cdr_sqlite</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250164">cdr_sqlite3_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250217">cdr_syslog</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_examples">Example Call Detail Records</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246856">Single-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246891">Two-party call</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246945">CEL (Channel Event Logging)</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255966">Backends</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291820">cel_manager</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291890">cel_pgsql</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292007">cel_sqlite3_custom</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292095">Example Channel Events</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292126">Single-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292161">Two-party call</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241628">SNMP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241664">Installing the SNMP Module for Asterisk</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241674">CentOS dependency</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241703">Ubuntu dependency</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#recompile-ast-with-snmp">Recompiling Asterisk with the res_snmp module</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241824">Installing OpenNMS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241885">Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS
        server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#editing-snmpd-conf">Editing /etc/snmp/snmpd.conf to work with your OpenNMS
        server</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id252037">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Monitoring_id291037"></a>Chaos is inherent in all compounded things.
    <span class="keep-together">Strive on with diligence.</span></p><div class="attribution"><span>—<span class="attribution">The Buddha</span></span></div></div><p><a id="Monitoring_id266979"></a><a id="index-702M486JJ4D" class="indexterm"></a><a id="index-074F158UL2C" class="indexterm"></a><a id="I_indexterm24_d1e50178" class="indexterm"></a>Asterisk comes with several subsystems that allow you to
  obtain detailed information about the workings of your system. Whether for
  troubleshooting or for tracking usage for billing or staffing purposes,
  Asterisk’s various monitoring modules can help you keep tabs on the inner
  workings of your system.</p><div class="sect1" title="logger.conf"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Monitoring_id264504"></a>logger.conf</h2></div></div></div><p><a id="Monitoring_id287695"></a><a id="index-814U221JA3R" class="indexterm"></a><a id="index-482H273RS1J" class="indexterm"></a>When troubleshooting issues in your Asterisk system, you
    will find it very helpful to refer to some sort of historical record of
    what was going on in the system at the time the reported issue occurred.
    The parameters for the storing of this information are defined in
    <code class="filename">/etc/asterisk/logger.conf</code>.</p><p><a id="Monitoring_id283663"></a>Ideally, one might want the system to store
    a record of each and every thing it does. However, there is a cost to
    doing this. On a busy system, with full debug logging enabled, it is
    possible to completely fill the hard drive with logged data within a day
    or so. It is therefore necessary to achieve a balance between detail and
    storage requirements.</p><p><a id="Monitoring_id246542"></a>The <code class="filename">/etc/asterisk/logger.conf</code> file allows you to
    define all sorts of different levels of logging, to multiple files if
    desired. This flexibility is excellent, but it can also be
    confusing.</p><p><a id="Monitoring_id268225"></a>The format of an entry in the <code class="filename">logger.conf</code> file is as follows:</p><a id="Monitoring_id282254"></a><pre class="programlisting"><em class="replaceable"><code>filename</code></em> =&gt; <em class="replaceable"><code>type</code></em>[,<em class="replaceable"><code>type</code></em>[,<em class="replaceable"><code>type</code></em>[,...]]]</pre><p><a id="Monitoring_id261725"></a>There is a sample <code class="filename">logger.conf</code> file that comes with the Asterisk
    source, but rather than just copying over the sample file, we recommend
    that you use the following for your initial <code class="filename">logger.conf</code> file:</p><p><a id="Monitoring_id254066"></a><a id="Monitoring_id285428"></a></p><pre class="programlisting">[general]

[logfiles]
console =&gt; notice,warning,error,dtmf
messages =&gt; notice,warning,error
;verbose =&gt; notice,warning,error,verbose</pre><p>When you have
    saved the file, you will need to reload the logger by issuing the
    following command from the shell:</p><a id="Monitoring_id256395"></a><pre class="programlisting">$ <strong class="userinput"><code><strong class="userinput"><code>asterisk -rx 'logger reload'</code></strong></code></strong></pre><p><a id="Monitoring_id258934"></a>or from the Asterisk CLI:</p><a id="Monitoring_id269120"></a><pre class="programlisting">*CLI&gt; <strong class="userinput"><code>logger reload</code></strong></pre><div class="sidebar" title="Verbose Logging: Useful but Dangerous"><a id="Monitoring_id259355"></a><div class="titlepage"><div><div><p class="title"><strong>Verbose Logging: Useful but Dangerous</strong></p></div></div></div><p><a id="Monitoring_id259361"></a><a id="I_indexterm24_d1e50254" class="indexterm"></a><a id="I_indexterm24_d1e50257" class="indexterm"></a>We struggled with whether to recommend adding the
      following line to your <code class="filename">logger.conf</code> file:</p><p><a id="Monitoring_id259367"></a><a id="Monitoring_id259368"></a></p><pre class="programlisting">verbose =&gt; notice,warning,error,verbose</pre><p>This
      is quite possibly one of the most useful debugging tools you have when
      building and troubleshooting a dialplan, and therefore it is highly
      recommended. The danger comes from the fact that if you forget to
      disable this when you are done with your debugging, what you will have
      done is leave a ticking time bomb in your Asterisk system, which will
      slowly fill up the hard drive and kill your system one day, several
      months or years from now, when you are least expecting it.</p><p><a id="Monitoring_id259378"></a>Use it. It’s fantastic. Just remember to
      turn it off when you’re done!</p></div><p><a id="Monitoring_id269136"></a>You can specify any filename you want, but
    the special filename <code class="filename">console</code> will in
    fact print the output to the Asterisk CLI, and not to any file on the hard
    drive. All other filenames will be stored in the filesystem in the
    directory <code class="filename">/var/log/asterisk</code>. The
    <code class="filename">logger.conf</code>
    types are outlined in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id269148" title="Table 24.1. logger.conf types">Table&nbsp;24.1, “logger.conf types”</a>.<a id="I_indexterm24_d1e50285" class="indexterm"></a></p><div class="table"><a id="Monitoring_id269148"></a><p class="title"><strong>Table&nbsp;24.1.&nbsp;logger.conf types</strong></p><div class="table-contents"><table summary="logger.conf types" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">Type</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">notice</code></td><td><a id="I_indexterm24_d1e50304" class="indexterm"></a>You will see a lot of these during a reload, but
            they will also happen during normal call flow. A notice is simply
            any event that Asterisk wishes to inform you of.</td></tr><tr><td><code class="literal">warning</code></td><td><a id="I_indexterm24_d1e50313" class="indexterm"></a>A warning represents a problem that could be severe
            enough to affect a call (including disconnecting a call because
            call flow cannot continue). Warnings need to be addressed.</td></tr><tr><td><code class="literal">error</code></td><td><a id="I_indexterm24_d1e50322" class="indexterm"></a>Errors represent significant problems in the system
            that must be addressed immediately.</td></tr><tr><td><code class="literal">debug</code></td><td><a id="I_indexterm24_d1e50331" class="indexterm"></a>Debugging is only useful if you are troubleshooting
            a problem with the Asterisk code itself. You would not use
            <code class="literal">debug</code> to troubleshoot your
            dialplan, but you would use it if the Asterisk developers asked
            you to provide logs for a problem you were reporting. Do not use
            <code class="literal">debug</code> in production, as the
            amount of detail stored can fill up a hard drive in a matter of
            days.<sup>[<a id="id649002" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id649002" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">verbose</code></td><td><a id="I_indexterm24_d1e50349" class="indexterm"></a>This is one of the most useful of the logging types,
            but it is also one of the more risky to leave unattended, due to
            the possibility of the output filling your hard drive.<sup>[<a id="id649035" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id649035" class="footnote">b</a>]</sup></td></tr><tr><td><code class="literal">dtmf</code></td><td><a id="I_indexterm24_d1e50364" class="indexterm"></a>Logging DTMF can be helpful if you are getting
            complaints that calls are not routing from the auto attendant
            correctly.</td></tr><tr><td><code class="literal">fax</code></td><td><a id="I_indexterm24_d1e50373" class="indexterm"></a>This type of logging causes fax-related messages
            from the fax technology backend (<code class="literal">res_fax_spandsp</code> or <code class="literal">res_fax_digium</code>) to be logged to the fax
            logger.</td></tr><tr><td><code class="literal">*</code></td><td><a id="I_indexterm24_d1e50388" class="indexterm"></a>This will log EVERYTHING (and we mean everything).
            Do not use this unless you understand the implications of storing
            this amount of data. It will not end well.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.id649002" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id649002" class="para">a</a>] </sup>This is not theory. It has happened to us. It was not
                fun.</p></div><div class="footnote"><p><sup>[<a id="ftn.id649035" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id649035" class="para">b</a>] </sup>It’s not as risky as <code class="literal">debug</code>, since it’ll take months to
                fill the hard drive, but the danger is that it will happen,
                say, a year later when you’re on summer vacation, and it will
                not immediately be obvious what the problem is. Not
                fun.</p></div></td></tr></tbody></table></div></div><br class="table-break"><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Monitoring_id272060"></a>There is a peculiarity in Asterisk’s
      logging system that will cause you some consternation if you are unaware
      of it. The level of logging for the <code class="literal">verbose</code> and <code class="literal">debug</code> logging types is tied to the verbosity
      as set in <span class="keep-together">the console</span>. What this
      means is that if you are logging to a file with the <code class="literal">verbose</code> or <code class="literal">debug</code> type, and somebody logs into the CLI and
      issues the command <span class="command"><strong>core set verbose
      0</strong></span><a id="I_indexterm24_d1e50413" class="indexterm"></a><a id="I_indexterm24_d1e50416" class="indexterm"></a>, or <span class="command"><strong>core set debug
      0</strong></span><a id="I_indexterm24_d1e50424" class="indexterm"></a><a id="I_indexterm24_d1e50427" class="indexterm"></a>, the logging of those details to your log file will
      stop.</p></div><div class="sect2" title="Reviewing Asterisk Logs"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id262409"></a>Reviewing Asterisk Logs</h3></div></div></div><p><a id="Monitoring_id262415"></a>Searching through log files can be a
      challenge. The trick is to be able to filter what you are seeing so that
      you are only presented with information that is relevant to what you are
      searching for.</p><p><a id="Monitoring_id262420"></a>To start with, you are going to need to
      have an approximate idea of the time when the trouble you are looking
      for occurred. Once you are oriented to the approximate time, you will
      need to find clues that will help you to identify the call in question.
      Obviously, the more information you have about the call, the faster you
      will be able to pin it down.</p><p><a id="Monitoring_id262426"></a>If, for example, you are doing verbose
      logging, you should note that each distinct call has a thread
      identifier, which, when used with <span class="command"><strong>grep</strong></span>, can often help you to filter out
      everything that does not relate to the call you are trying to debug. For
      example, in the following verbose log, we have more than one call in the
      log, and since the calls are happening at the same time, it can be very
      confusing to trace one call:</p><p><a id="Monitoring_id262437"></a><a id="Monitoring_id262438"></a></p><pre class="programlisting">$ <strong class="userinput"><code>tail -<em class="replaceable"><code>1000</code></em> verbose</code></strong>
</pre><p><a id="Monitoring_id262446"></a></p><pre class="screen">[Mar 11 09:38:35] VERBOSE[31362] logger.c:     -- IAX2/shifteight-4 answered Zap/1-1
[Mar 11 09:39:35] VERBOSE[2973] logger.c:     -- Starting simple switch on 'Zap/1-1'
[Mar 11 09:39:35] VERBOSE[31362] logger.c:   == Spawn extension (shifteight, s, 1) 
exited non-zero on 'Zap/1-1'
[Mar 11 09:39:35] VERBOSE[2973] logger.c:     -- Hungup 'Zap/1-1'
[Mar 11 09:39:35] VERBOSE[3680] logger.c:     -- Starting simple switch on 'Zap/1-1'
[Mar 11 09:39:35] VERBOSE[31362] logger.c:     -- Hungup 'Zap/1-1'</pre><p>To
      filter on one call specifically, we could grep on the thread ID. For
      example:</p><a id="Monitoring_id262456"></a><pre class="programlisting">$ <strong class="userinput"><code>grep <em class="replaceable"><code>31362</code></em> verbose</code></strong></pre><p><a id="Monitoring_id262464"></a>which would give us:</p><p><a id="Monitoring_id262468"></a><a id="Monitoring_id262469"></a></p><pre class="screen">[Mar 11 09:38:35] VERBOSE[31362] logger.c:     -- IAX2/shifteight-4 answered Zap/1-1
[Mar 11 09:39:35] VERBOSE[31362] logger.c:   == Spawn extension (shifteight, s, 1) 
exited non-zero on 'Zap/1-1'
[Mar 11 09:39:35] VERBOSE[31362] logger.c:     -- Hungup 'Zap/1-1'
</pre><p>This method does not guarantee that you will see everything relating
      to one call, since a call could in theory spawn additional threads, but
      for basic dialplan debugging we find this approach to be very
      useful.</p></div><div class="sect2" title="Logging to the Linux syslog Daemon"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id262478"></a>Logging to the Linux syslog Daemon</h3></div></div></div><p><a id="Monitoring_id265004"></a><a id="I_indexterm24_d1e50474" class="indexterm"></a><a id="I_indexterm24_d1e50477" class="indexterm"></a>Linux contains a very powerful logging engine, which
      Asterisk is capable of taking advantage of. While a discussion of all
      the various flavors of <span class="emphasis"><em>syslog</em></span> and all the possible
      ways to handle Asterisk logging would be beyond the scope of this book,
      suffice it to say that if you want to have Asterisk send logs to the
      <span class="emphasis"><em>syslog</em></span> daemon,<a id="I_indexterm24_d1e50489" class="indexterm"></a> you simply need to specify the following in your
      <code class="filename">/etc/asterisk/logger.conf</code>
      file:</p><p><a id="Monitoring_id265014"></a><a id="Monitoring_id265015"></a></p><pre class="programlisting">syslog.local0 =&gt; notice,warning,error ; or whatever type(s) you want to log</pre><p>You
      will need to have a designation in your <span class="emphasis"><em>syslog</em></span>
      configuration file<sup>[<a id="id649477" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id649477" class="footnote">170</a>]</sup> named <code class="literal">local0</code>, which
      should look something like:</p><p><a id="Monitoring_id265033"></a><a id="Monitoring_id265034"></a></p><pre class="programlisting">local0.*      /var/log/asterisk/syslog</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id265040"></a>You can use <code class="literal">local0</code> through <code class="literal">local7</code> for this, but check your <code class="filename">syslog.conf</code> file to ensure that nothing
        else is using one of those <span class="emphasis"><em>syslog</em></span>
        channels.</p></div><p><a id="Monitoring_id265055"></a><span class="emphasis"><em>syslog</em></span><sup>[<a id="id649551" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id649551" class="footnote">171</a>]</sup> will allow much more powerful logging, but it will also
      require more knowledge than simply allowing Asterisk to log to
      files.</p></div><div class="sect2" title="Verifying Logging"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id265067"></a>Verifying Logging</h3></div></div></div><p><a id="Monitoring_id265073"></a><a id="I_indexterm24_d1e50549" class="indexterm"></a>You can view the status of all your <code class="filename">logger.conf</code> settings through the Asterisk CLI
      by issuing the command:<a id="I_indexterm24_d1e50558" class="indexterm"></a><a id="I_indexterm24_d1e50559" class="indexterm"></a></p><p><a id="Monitoring_id262500"></a><a id="Monitoring_id262501"></a></p><pre class="programlisting">*CLI&gt; <strong class="userinput"><code>logger show channels</code></strong></pre><p>You
      should see output similar to:</p><p><a id="Monitoring_id262509"></a><a id="Monitoring_id262510"></a></p><pre class="screen">Channel                     Type     Status  Configuration
-------                     ----     ------  -------------
syslog.local0               Syslog   Enabled  - NOTICE WARNING ERROR VERBOSE
/var/log/asterisk/verbose   File     Enabled  - NOTICE WARNING ERROR VERBOSE
/var/log/asterisk/messages  File     Enabled  - NOTICE WARNING ERROR
                            Console  Enabled  - NOTICE WARNING ERROR DTMF
</pre></div></div><div class="sect1" title="Call Detail Records"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-SysAdmin-SECT-1"></a>Call Detail Records</h2></div></div></div><p><a id="Monitoring_id262528"></a><a id="index-070J623RW7K" class="indexterm"></a><a id="index-458H106VR5R" class="indexterm"></a>The CDR system in Asterisk is used to log the history of
    calls in the system. In some deployments, these records are used for
    billing purposes. In others, call records are used for analyzing call
    volumes over time. They can also be used as a debugging tool by Asterisk
    administrators.</p><div class="sect2" title="CDR Contents"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id262533"></a>CDR Contents</h3></div></div></div><p><a id="Monitoring_id262539"></a><a id="I_indexterm24_d1e50586" class="indexterm"></a><a id="I_indexterm24_d1e50593" class="indexterm"></a>A CDR has a number of fields that are included by default.
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#default_cdr_fields" title="Table 24.2. Default CDR fields">Table&nbsp;24.2, “Default CDR fields”</a> lists them.<a id="I_indexterm24_d1e50601" class="indexterm"></a></p><div class="table"><a id="default_cdr_fields"></a><p class="title"><strong>Table&nbsp;24.2.&nbsp;Default CDR fields</strong></p><div class="table-contents"><table summary="Default CDR fields" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">accountcode</code></td><td><code class="literal"><a id="I_indexterm24_d1e50625" class="indexterm"></a>12345</code></td><td>An account ID. This field is user-defined and is empty by
              default.</td></tr><tr><td><code class="literal">src</code></td><td><code class="literal"><a id="I_indexterm24_d1e50637" class="indexterm"></a>12565551212</code></td><td>The calling party’s caller ID number. It is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">dst</code></td><td><code class="literal"><a id="I_indexterm24_d1e50649" class="indexterm"></a>102</code></td><td>The destination extension for the call. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">dcontext</code></td><td><code class="literal"><a id="I_indexterm24_d1e50661" class="indexterm"></a>PublicExtensions</code></td><td>The destination context for the call. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">clid</code></td><td><code class="literal"><a id="I_indexterm24_d1e50673" class="indexterm"></a>"Big Bird" &lt;12565551212&gt;</code></td><td>The full caller ID, including the name, of the calling
              party. This field is set automatically and is read-only.</td></tr><tr><td><code class="literal">channel</code></td><td><code class="literal"><a id="I_indexterm24_d1e50685" class="indexterm"></a>SIP/0004F2040808-a1bc23ef</code></td><td>The calling party’s channel. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">dstchannel</code></td><td><code class="literal"><a id="I_indexterm24_d1e50697" class="indexterm"></a>SIP/0004F2046969-9786b0b0</code></td><td>The called party’s channel. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">lastapp</code></td><td><code class="literal"><a id="I_indexterm24_d1e50709" class="indexterm"></a>Dial</code></td><td>The last dialplan application that was executed. This
              field is set automatically and is read-only.</td></tr><tr><td><code class="literal">lastdata</code></td><td><code class="literal"><a id="I_indexterm24_d1e50721" class="indexterm"></a>SIP/0004F2046969,30,tT</code></td><td>The arguments passed to the <code class="literal">lastapp</code>. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">start</code></td><td><code class="literal"><a id="I_indexterm24_d1e50736" class="indexterm"></a>2010-10-26 12:00:00</code></td><td>The start time of the call. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">answer</code></td><td><code class="literal"><a id="I_indexterm24_d1e50748" class="indexterm"></a>2010-10-26 12:00:15</code></td><td>The answered time of the call. This field is set
              automatically and is read-only.</td></tr><tr><td><code class="literal">end</code></td><td><code class="literal"><a id="I_indexterm24_d1e50761" class="indexterm"></a>2010-10-26 12:03:15</code></td><td>The end time of the call. This field is set automatically
              and is read-only.</td></tr><tr><td><code class="literal">duration</code></td><td><code class="literal"><a id="I_indexterm24_d1e50773" class="indexterm"></a>195</code></td><td>The number of seconds between the <code class="literal">start</code> and <code class="literal">end</code> times for the call. This field is
              set automatically and is read-only.</td></tr><tr><td><code class="literal">billsec</code></td><td><code class="literal"><a id="I_indexterm24_d1e50791" class="indexterm"></a>180</code></td><td>The number of seconds between the <code class="literal">answer</code> and <code class="literal">end</code> times for the call. This field is
              set automatically and is read-only.</td></tr><tr><td><code class="literal">disposition</code></td><td><code class="literal"><a id="I_indexterm24_d1e50809" class="indexterm"></a>ANSWERED</code></td><td>An indication of what happened to the call. This may be
              <code class="literal">NO ANSWER</code>, <code class="literal">FAILED</code>, <code class="literal">BUSY</code>, <code class="literal">ANSWERED</code>, or <code class="literal">UNKNOWN</code>.</td></tr><tr><td><code class="literal">amaflags</code></td><td><code class="literal"><a id="I_indexterm24_d1e50836" class="indexterm"></a>DOCUMENTATION</code></td><td>The Automatic Message Accounting (AMA) flag associated
              with this call. This may be one of the following: <code class="literal">OMIT</code>, <code class="literal">BILLING</code>, <code class="literal">DOCUMENTATION</code>, or <code class="literal">Unknown</code>.</td></tr><tr><td><code class="literal">userfield</code></td><td><code class="literal"><a id="I_indexterm24_d1e50860" class="indexterm"></a>PerMinuteCharge:0.02</code></td><td>A general-purpose user field. This field is empty by
              default and can be set to a user-defined string.<sup>[<a id="id650475" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id650475" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">uniqueid</code></td><td><code class="literal"><a id="I_indexterm24_d1e50878" class="indexterm"></a>1288112400.1</code></td><td>The unique ID for the <code class="literal">src</code> channel. This field is set
              automatically and is read-only.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id650475" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id650475" class="para">a</a>] </sup>The <code class="literal">userfield</code> is not as relevant now
                  as it used to be. Custom CDR variables are a more flexible
                  way to get custom data into CDRs.</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id250623"></a>All fields of the CDR record can be
      accessed in the Asterisk dialplan by using the <code class="literal">CDR()</code> function. The <code class="literal">CDR()</code> function is also used to set the fields
      of the CDR that are user-defined.</p><a id="Monitoring_id250635"></a><pre class="programlisting">exten =&gt; 115,1,Verbose(Call start time: ${CDR(start)})
   same =&gt; n,Set(CDR(userfield)=zombie pancakes)</pre><p><a id="Monitoring_id250640"></a>In addition to the fields that are always
      included in a CDR, it is possible to add custom fields. This is done in
      the dialplan by using the <code class="literal">Set()</code>
      application with the <code class="literal">CDR()</code> <span class="keep-together">function</span>:</p><p><a id="Monitoring_id250659"></a><a id="Monitoring_id250660"></a></p><pre class="programlisting">exten =&gt; 115,1,NoOp()
   same =&gt; n,Set(CDR(mycustomfield)=coffee)
   same =&gt; n,Verbose(I need some more ${CDR(mycustomfield)})
</pre><p> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id250653"></a>If you choose to use custom CDR
          variables, make sure that the CDR backend that you choose is capable
          of logging them.</p></div><p>To view the built-in documentation for
      the <code class="literal">CDR()</code> function, run the following
      command at the Asterisk console:</p><a id="Monitoring_id250670"></a><pre class="programlisting"><code class="computeroutput">*CLI&gt;</code> <strong class="userinput"><code>core show function CDR</code></strong></pre><p><a id="Monitoring_id250678"></a>In addition to the <code class="literal">CDR()</code> function, there are some dialplan
      applications that may be used to influence CDR records. We’ll look at
      these next.</p></div><div class="sect2" title="Dialplan Applications"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id250686"></a>Dialplan Applications</h3></div></div></div><p><a id="Monitoring_id250692"></a><a id="I_indexterm24_d1e50935" class="indexterm"></a><a id="I_indexterm24_d1e50942" class="indexterm"></a><a id="I_indexterm24_d1e50947" class="indexterm"></a><a id="I_indexterm24_d1e50952" class="indexterm"></a>There are a few dialplan applications that can be used to
      influence CDRs for the current call. To get a list of the CDR
      applications that are loaded into the current version of Asterisk, we
      can use the following CLI command:</p><a id="Monitoring_id250697"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>core show applications like CDR</code></strong>
    -= Matching Asterisk Applications =-
               ForkCDR: Forks the Call Data Record. 
                 NoCDR: Tell Asterisk to not maintain a CDR for the current call 
              ResetCDR: Resets the Call Data Record. 
    -= 3 Applications Matching =-
</pre><p><a id="Monitoring_id250707"></a>Each application has documentation built
      into the Asterisk application, which can be viewed using the following
      command:</p><a id="Monitoring_id250711"></a><pre class="programlisting"><code class="computeroutput">*CLI&gt;</code> <strong class="userinput"><code>core show application <em class="replaceable"><code>&lt;application name&gt;</code></em></code></strong></pre></div><div class="sect2" title="cdr.conf"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id250722"></a>cdr.conf</h3></div></div></div><p><a id="Monitoring_id250728"></a><a id="I_indexterm24_d1e50977" class="indexterm"></a><a id="I_indexterm24_d1e50984" class="indexterm"></a><a id="I_indexterm24_d1e50989" class="indexterm"></a>The <code class="filename">cdr.conf</code> file has
      a <code class="literal">[general]</code> section that contains
      options that apply to the entire CDR system. Additional optional
      sections may exist in this file that apply to specific CDR logging
      backend modules. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250739" title="Table 24.3. cdr.conf [general] section">Table&nbsp;24.3, “cdr.conf [general] section”</a> lists the
      options available in the <code class="literal">[general]</code> section.<a id="I_indexterm24_d1e51005" class="indexterm"></a></p><div class="table"><a id="Monitoring_id250739"></a><p class="title"><strong>Table&nbsp;24.3.&nbsp;cdr.conf [general] section</strong></p><div class="table-contents"><table summary="cdr.conf [general] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value</span>/<span class="keep-together">Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">enable</code></td><td><code class="literal"><a id="I_indexterm24_d1e51033" class="indexterm"></a>yes</code></td><td>Enable CDR logging. The default is <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">unanswered</code></td><td><code class="literal"><a id="I_indexterm24_d1e51048" class="indexterm"></a>no</code></td><td>Log unanswered calls. Normally, only answered calls
              result in a CDR. Logging all call attempts can result in a large
              number of extra call records that most people do not care about.
              The default value is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">end</code> <code class="literal">before</code> <code class="literal">hexten</code></td><td><code class="literal"><a id="I_indexterm24_d1e51067" class="indexterm"></a>no</code></td><td>Close out CDRs before running the <code class="literal">h</code> extension in the Asterisk dialplan.
              Normally CDRs are not closed until the dialplan is completely
              finished running. The default value is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">initiated</code> <code class="literal">seconds</code></td><td><code class="literal"><a id="I_indexterm24_d1e51087" class="indexterm"></a>no</code></td><td>When calculating the <code class="literal">billsec</code> field, always round up. For
              example, if the difference between when the call was answered
              and when the call ended is 1 second and <span class="keep-together">1 microsecond</span>, <code class="literal">billsec</code> will be set to 2 seconds. This
              helps ensure that Asterisk’s CDRs match the behavior used by
              telcos. The default value is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">batch</code></td><td><code class="literal"><a id="I_indexterm24_d1e51111" class="indexterm"></a>no</code></td><td>Queue up CDRs to be logged in batches instead of logging
              synchronously at the end of every call. This prevents CDR
              logging from blocking the completion of the call teardown
              process within Asterisk. The default value is <code class="literal">no</code>, but we recommend turning it
              on.<sup>[<a id="id651194" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id651194" class="footnote">a</a>]</sup></td></tr><tr><td><code class="literal">size</code></td><td><code class="literal"><a id="I_indexterm24_d1e51132" class="indexterm"></a>100</code></td><td>Set the number of CDRs to queue up before they are logged
              during batch mode. The default value is <code class="literal">100</code>.</td></tr><tr><td><code class="literal">time</code></td><td><code class="literal"><a id="I_indexterm24_d1e51147" class="indexterm"></a>300</code></td><td>Set the maximum number of seconds that CDRs will wait in
              the batch queue before being logged. The CDR batch logging
              process will run at the end of this time period, even if
              <code class="literal">size</code> has not been reached.
              The default value is <code class="literal">300</code>
              seconds.</td></tr><tr><td><code class="literal">scheduler</code> <code class="literal">only</code></td><td><code class="literal"><a id="I_indexterm24_d1e51167" class="indexterm"></a>no</code></td><td>Set whether CDR batch processing should be done by
              spawning a new thread, or within the context of the CDR batch
              scheduler. The default value is <code class="literal">no</code>, and we recommend not changing
              it.</td></tr><tr><td><code class="literal">safe</code> <code class="literal">shutdown</code></td><td><code class="literal"><a id="I_indexterm24_d1e51184" class="indexterm"></a>yes</code></td><td>Block Asterisk shutdown to ensure that all queued CDR
              records are logged. The default is <code class="literal">yes</code>, and we recommend leaving it that
              way, as this option prevents important data loss.</td></tr></tbody><tbody class="footnotes"><tr><td colspan="3"><div class="footnote"><p><sup>[<a id="ftn.id651194" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id651194" class="para">a</a>] </sup>The disadvantage of enabling this option is that if
                  Asterisk were to crash or die for some reason, the CDR
                  records would be lost, as they are only stored in memory
                  while the Asterisk process exists. See <code class="literal">safeshutdown</code> for more
                  information.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Backends"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id263137"></a>Backends</h3></div></div></div><p><a id="Monitoring_id263142"></a><a id="index-423D263ON7M" class="indexterm"></a><a id="index-454E326OQ5F" class="indexterm"></a><a id="index-732O742UN4D" class="indexterm"></a>Asterisk CDR backend modules provide a way to log CDRs.
      Most CDR backends require specific configuration to get them
      going.</p><div class="sect3" title="cdr_adaptive_odbc"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id263146"></a>cdr_adaptive_odbc</h4></div></div></div><p><a id="Monitoring_id263152"></a><a id="I_indexterm24_d1e51217" class="indexterm"></a><a id="I_indexterm24_d1e51224" class="indexterm"></a><a id="I_indexterm24_d1e51231" class="indexterm"></a>As the name suggests, the <code class="literal">cdr_adaptive_odbc</code> module allows CDRs to be
        stored in a database through ODBC. The “adaptive” part of the name
        refers to the fact that it works to adapt to the table structure:
        there is no static table structure that must be used with this module.
        When the module is loaded (or reloaded), it reads the table structure.
        When logging CDRs, it looks for a CDR variable that matches each
        column name. This applies to both the built-in CDR variables and
        custom variables. If you want to log the built-in <code class="literal">channel</code> CDR variable, just create a column
        called <code class="literal">channel</code>.</p><p><a id="Monitoring_id263175"></a>Adding custom CDR content is as simple
        as setting it in the dialplan. For example, if we wanted to log the
        <code class="literal">User-Agent</code> that is provided by a
        SIP device, we could add that as a custom CDR variable:</p><a id="Monitoring_id263180"></a><pre class="programlisting">exten =&gt; 105,n,Set(CDR(useragent)=${CHANNEL(useragent)})</pre><p><a id="Monitoring_id263184"></a>To have this custom CDR variable
        inserted into the database by <code class="literal">cdr_adaptive_odbc</code>, all we have to do is
        create a column called <code class="literal">useragent</code>.</p><p><a id="Monitoring_id263195"></a>Multiple tables may be configured in
        the <code class="literal">cdr_adaptive_odbc</code> configuration
        file. Each goes into its own configuration section. The name of the
        section can be anything; the module does not use it. Here is an
        example of a simple table configuration:</p><a id="Monitoring_id263203"></a><pre class="programlisting">[mytable]

connection = asterisk
table = asterisk_cdr</pre><p><a id="Monitoring_id263207"></a>A more detailed example of setting up a
        database for logging CDRs can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr" title="Storing Call Detail Records (CDRs)">the section called “Storing Call Detail Records (CDRs)”</a>.</p><p><a id="Monitoring_id263318"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263326" title="Table 24.4. cdr_adaptive_odbc.conf table configuration options">Table&nbsp;24.4, “cdr_adaptive_odbc.conf table configuration options”</a>
        lists the options that can be specified in a table configuration
        section in the <code class="filename">cdr_adaptive_odbc.conf</code> file.<a id="I_indexterm24_d1e51276" class="indexterm"></a><a id="I_indexterm24_d1e51281" class="indexterm"></a></p><div class="table"><a id="Monitoring_id263326"></a><p class="title"><strong>Table&nbsp;24.4.&nbsp;cdr_adaptive_odbc.conf table configuration options</strong></p><div class="table-contents"><table summary="cdr_adaptive_odbc.conf table configuration options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together"><span class="keep-together">Value</span>/<span class="keep-together">Example</span></span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">connection</code></td><td><code class="literal">pgsql1</code></td><td>The database connection to be used. This is a reference
                to the configured connection in <code class="filename">res_odbc.conf</code>. This field is
                required.</td></tr><tr><td><code class="literal">table</code></td><td><code class="literal">asterisk_cdr</code></td><td>The table name. This field is required.</td></tr><tr><td><code class="literal">usegmtime</code></td><td><code class="literal">no</code></td><td>Indicates whether to log timestamps using GMT instead
                of local time. The default value for this option is <code class="literal">no</code>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id263413"></a>In addition to the key/value pair
        fields that are shown in the previous table, <code class="filename">cdr_adaptive_odbc.conf</code> allows for a few
        other configuration items. The first is a column alias. Normally, CDR
        variables are logged to columns of the same name. An <code class="literal">alias</code> allows the variable name to be mapped
        to a column with a different name. The syntax is:</p><a id="Monitoring_id263426"></a><pre class="programlisting">alias <em class="replaceable"><code>&lt;CDR variable&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;column name&gt;</code></em></pre><p><a id="Monitoring_id263436"></a>Here is an example column mapping using
        the <code class="literal">alias</code> option:</p><a id="Monitoring_id263442"></a><pre class="programlisting">alias src =&gt; source</pre><p><a id="Monitoring_id263446"></a>It is also possible to specify a
        content filter. This allows you to specify criteria that must match
        for records to be inserted into the table. The syntax is:</p><a id="Monitoring_id263451"></a><pre class="programlisting">filter <em class="replaceable"><code>&lt;CDR variable&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;content&gt;</code></em></pre><p><a id="Monitoring_id263460"></a>Here is an example content
        filter:</p><a id="Monitoring_id263464"></a><pre class="programlisting">filter accountcode =&gt; 123</pre><p><a id="Monitoring_id263467"></a>Finally, <code class="filename">cdr_adaptive_odbc.conf</code> allows static
        content for a column to be defined. This can be useful when used along
        with a set of <code class="literal">filter</code>s. This static
        content can help differentiate records that were inserted into the
        same table by different configuration sections. The syntax for static
        content is:</p><a id="Monitoring_id263480"></a><pre class="programlisting">static <em class="replaceable"><code>&lt;"Static Content Goes Here"&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;column name&gt;</code></em></pre><p><a id="Monitoring_id263490"></a>Here is an example of specifying static
        content to be inserted with CDRs:</p><a id="Monitoring_id263494"></a><pre class="programlisting">static "My Content" =&gt; my_identifier</pre></div><div class="sect3" title="cdr_csv"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id263499"></a>cdr_csv</h4></div></div></div><p><a id="Monitoring_id263504"></a><a id="I_indexterm24_d1e51394" class="indexterm"></a><a id="I_indexterm24_d1e51401" class="indexterm"></a><a id="I_indexterm24_d1e51408" class="indexterm"></a>The <code class="literal">cdr_csv</code> module is
        a very simple CDR backend that logs CDRs into a CSV (comma separated
        values) file. The file is <code class="filename">/var/log/asterisk/cdr-csv/Master.csv</code>. As
        long as CDR logging is enabled in <code class="filename">cdr.conf</code> and this module has been loaded,
        CDRs will be logged to the <code class="filename">Master.csv</code> file.</p><p><a id="Monitoring_id263523"></a>While no options are required to get
        this module working, there are some options that customize its
        behavior. These options, listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263534" title="Table 24.5. cdr.conf [csv] section options">Table&nbsp;24.5, “cdr.conf [csv] section options”</a>, are placed in the <code class="literal">[csv]</code> section of <code class="filename">cdr.conf</code>.</p><div class="table"><a id="Monitoring_id263534"></a><p class="title"><strong>Table&nbsp;24.5.&nbsp;cdr.conf [csv] section options</strong></p><div class="table-contents"><table summary="cdr.conf [csv] section options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">usegmtime</code></td><td><code class="literal"><a id="I_indexterm24_d1e51454" class="indexterm"></a>no</code></td><td>Log timestamps using GMT instead of local time. The
                default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">loguniqueid</code></td><td><code class="literal"><a id="I_indexterm24_d1e51469" class="indexterm"></a>no</code></td><td>Log the <code class="literal">uniqueid</code> CDR
                variable. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">loguserfield</code></td><td><code class="literal"><a id="I_indexterm24_d1e51487" class="indexterm"></a>no</code></td><td>Log the <code class="literal">userfield</code>
                CDR variable. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">accountlogs</code></td><td><code class="literal"><a id="I_indexterm24_d1e51505" class="indexterm"></a>yes</code></td><td>Create a separate CSV file for each different value of
                the <code class="literal">accountcode</code> CDR
                variable. The default is <code class="literal">yes</code>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id249752"></a>The order of CDR variables in CSV files
        created by the <code class="literal">cdr_csv</code> module
        is:</p><a id="Monitoring_id249760"></a><pre class="programlisting">&lt;<em class="replaceable"><code>accountcode</code></em>&gt;,&lt;<em class="replaceable"><code>src</code></em>&gt;,&lt;<em class="replaceable"><code>dst</code></em>&gt;,&lt;<em class="replaceable"><code>dcontext</code></em>&gt;,&lt;<em class="replaceable"><code>clid</code></em>&gt;,&lt;<em class="replaceable"><code>channel</code></em>&gt;,&lt;<em class="replaceable"><code>dstchannel</code></em>&gt;,&lt;<em class="replaceable"><code>lastapp</code></em>&gt;, \
    &lt;<em class="replaceable"><code>lastadata</code></em>&gt;,&lt;<em class="replaceable"><code>start</code></em>&gt;,&lt;<em class="replaceable"><code>answer</code></em>&gt;,&lt;<em class="replaceable"><code>end</code></em>&gt;,&lt;<em class="replaceable"><code>duration</code></em>&gt;,&lt;<em class="replaceable"><code>billsec</code></em>&gt;,&lt;<em class="replaceable"><code>disposition</code></em>&gt;, \
    &lt;<em class="replaceable"><code>amaflags</code></em>&gt;[,&lt;<em class="replaceable"><code>uniqueid</code></em>&gt;][,&lt;<em class="replaceable"><code>userfield</code></em>&gt;]
</pre></div><div class="sect3" title="cdr_custom"><div class="titlepage"><div><div><h4 class="title"><a id="cdr_custom"></a>cdr_custom</h4></div></div></div><p><a id="Monitoring_id249774"></a><a id="I_indexterm24_d1e51585" class="indexterm"></a><a id="I_indexterm24_d1e51592" class="indexterm"></a><a id="I_indexterm24_d1e51599" class="indexterm"></a>This CDR backend allows for custom formatting of CDR
        records in a log file. This module is most commonly used for
        customized CSV output. The configuration file used for this module is
        <code class="filename">/etc/asterisk/cdr_custom.conf</code>. A
        single section called <code class="literal">[mappings]</code> should exist in this file.
        The <code class="literal">[mappings]</code> section contains
        mappings between a filename and the custom template for a CDR. The
        template is specified using Asterisk dialplan functions.</p><p><a id="Monitoring_id249791"></a>The following example shows a sample
        configuration for <code class="literal">cdr_custom</code> that
        enables a single CDR log file, <code class="filename">Master.csv</code>. This file will be created as
        <code class="filename">/var/log/asterisk/cdr-custom/Master.csv</code>.
        The template that has been defined uses both the <code class="literal">CDR()</code> and <code class="literal">CSV_QUOTE()</code> dialplan functions<a id="I_indexterm24_d1e51630" class="indexterm"></a><a id="I_indexterm24_d1e51633" class="indexterm"></a>. The <code class="literal">CDR()</code> function
        retrieves values from the CDR being logged. The <code class="literal">CSV_QUOTE()</code> function ensures that the values
        are properly escaped for the CSV file <span class="keep-together">format</span>:</p><a id="Monitoring_id249831"></a><pre class="programlisting">[mappings]

Master.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},
   ${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},
   ${CSV_QUOTE(${CDR(channel)})},${CSV_QUOTE(${CDR(dstchannel)})},
   ${CSV_QUOTE(${CDR(lastapp)})},${CSV_QUOTE(${CDR(lastdata)})},
   ${CSV_QUOTE(${CDR(start)})},${CSV_QUOTE(${CDR(answer)})},
   ${CSV_QUOTE(${CDR(end)})},${CSV_QUOTE(${CDR(duration)})},
   ${CSV_QUOTE(${CDR(billsec)})},${CSV_QUOTE(${CDR(disposition)})},
   ${CSV_QUOTE(${CDR(amaflags)})},${CSV_QUOTE(${CDR(accountcode)})},
   ${CSV_QUOTE(${CDR(uniqueid)})},${CSV_QUOTE(${CDR(userfield)})}</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id249823"></a>In the actual configuration file, the
          value in the <code class="filename">Master.csv</code> mapping
          should be on a single line.</p></div></div><div class="sect3" title="cdr_manager"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id249846"></a>cdr_manager</h4></div></div></div><p><a id="Monitoring_id249851"></a><a id="I_indexterm24_d1e51660" class="indexterm"></a><a id="I_indexterm24_d1e51667" class="indexterm"></a><a id="I_indexterm24_d1e51674" class="indexterm"></a>The <code class="literal">cdr_manager</code>
        backend emits CDRs as events on the Asterisk Manager Interface (AMI),
        which we discussed in detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>. This
        module is configured in the <code class="filename">/etc/asterisk/cdr_manager.conf</code> file.
        The first section in this file is the <code class="literal">[general]</code> section, which contains a single
        option to enable this module (the default value is <code class="literal">no</code>):</p><a id="Monitoring_id249875"></a><pre class="programlisting">[general]

enabled = yes</pre><p><a id="Monitoring_id249879"></a>The other section in <code class="filename">cdr_manager.conf</code> is the <code class="literal">[mappings]</code> section. This allows for adding
        custom CDR variables to the manager event. The syntax is:</p><a id="Monitoring_id249890"></a><pre class="programlisting"><em class="replaceable"><code>&lt;CDR variable&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;Header name&gt;</code></em></pre><p><a id="Monitoring_id249898"></a>Here is an example of adding two custom
        CDR variables:</p><a id="Monitoring_id249902"></a><pre class="programlisting">[mappings]

rate =&gt; Rate
carrier =&gt; Carrier</pre><p><a id="Monitoring_id249906"></a>With this configuration in place, CDR
        records will appear as events on the manager interface. To generate an
        example manager event, we will use the following dialplan
        example:</p><a id="Monitoring_id249911"></a><pre class="programlisting">exten =&gt; 110,1,Answer()
    same =&gt; n,Set(CDR(rate)=0.02)
    same =&gt; n,Set(CDR(carrier)=BS&amp;S)
    same =&gt; n,Hangup()
</pre><p><a id="Monitoring_id249916"></a>This is the command used to execute
        this extension and generate a sample manager event:</p><a id="Monitoring_id249920"></a><pre class="programlisting"><code class="computeroutput">*CLI&gt;</code> <strong class="userinput"><code>console dial 110@testing</code></strong></pre><p><a id="Monitoring_id249928"></a>Finally, this is an example manager
        event produced as a result of this test call:</p><a id="Monitoring_id249932"></a><pre class="programlisting">Event: Cdr
Privilege: cdr,all
AccountCode: 
Source: 
Destination: 110
DestinationContext: testing
CallerID: 
Channel: Console/dsp
DestinationChannel: 
LastApplication: Hangup
LastData: 
StartTime: 2010-08-23 08:27:21
AnswerTime: 2010-08-23 08:27:21
EndTime: 2010-08-23 08:27:21
Duration: 0
BillableSeconds: 0
Disposition: ANSWERED
AMAFlags: DOCUMENTATION
UniqueID: 1282570041.3
UserField: 
Rate: 0.02
Carrier: BS&amp;S
</pre></div><div class="sect3" title="cdr_mysql"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id249944"></a>cdr_mysql</h4></div></div></div><p><a id="Monitoring_id249949"></a><a id="I_indexterm24_d1e51734" class="indexterm"></a><a id="I_indexterm24_d1e51741" class="indexterm"></a><a id="I_indexterm24_d1e51748" class="indexterm"></a>This module allows posting of CDRs to a MySQL database.
        We recommend that new installations use <code class="literal">cdr_adaptive_odbc</code> instead.</p></div><div class="sect3" title="cdr_odbc"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id249958"></a>cdr_odbc</h4></div></div></div><p><a id="Monitoring_id249963"></a><a id="I_indexterm24_d1e51759" class="indexterm"></a><a id="I_indexterm24_d1e51766" class="indexterm"></a><a id="I_indexterm24_d1e51773" class="indexterm"></a>This module enables the legacy ODBC interface for CDR
        logging. New installations should use <code class="literal">cdr_adaptive_odbc</code> instead.</p></div><div class="sect3" title="cdr_pgsql"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id249972"></a>cdr_pgsql</h4></div></div></div><p><a id="Monitoring_id249977"></a><a id="I_indexterm24_d1e51784" class="indexterm"></a><a id="I_indexterm24_d1e51791" class="indexterm"></a><a id="I_indexterm24_d1e51798" class="indexterm"></a>This module allows posting of CDRs to a PostgreSQL
        database. We recommend that new installations use <code class="literal">cdr_adaptive_odbc</code> instead.</p></div><div class="sect3" title="cdr_radius"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id249986"></a>cdr_radius</h4></div></div></div><p><a id="Monitoring_id249991"></a><a id="I_indexterm24_d1e51809" class="indexterm"></a><a id="I_indexterm24_d1e51816" class="indexterm"></a><a id="I_indexterm24_d1e51823" class="indexterm"></a>The <code class="literal">cdr_radius</code>
        backend allows posting of CDRs to a RADIUS server. When using this
        module, each CDR is reported to the RADIUS server as a single stop
        event. This module is configured in the <code class="filename">/etc/asterisk/cdr.conf</code> file. Options for
        this module are placed in a section called <code class="literal">[radius]</code>. The available options are listed
        in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250007" title="Table 24.6. cdr.conf [radius] section options">Table&nbsp;24.6, “cdr.conf [radius] section options”</a>.<a id="I_indexterm24_d1e51839" class="indexterm"></a></p><div class="table"><a id="Monitoring_id250007"></a><p class="title"><strong>Table&nbsp;24.6.&nbsp;cdr.conf [radius] section options</strong></p><div class="table-contents"><table summary="cdr.conf [radius] section options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">usegmtime</code></td><td><code class="literal"><a id="I_indexterm24_d1e51863" class="indexterm"></a>no</code></td><td>Enables logging of timestamps using GMT instead of
                local time. The default is <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">log</code> <code class="literal">unique</code> <code class="literal">id</code></td><td><code class="literal"><a id="I_indexterm24_d1e51882" class="indexterm"></a>no</code></td><td>Enables logging of the <code class="literal">uniqueid</code> CDR variable. The default
                is yes.</td></tr><tr><td><code class="literal">loguserfield</code></td><td><code class="literal"><a id="I_indexterm24_d1e51897" class="indexterm"></a>no</code></td><td>Enables logging of the <code class="literal">userfield</code> CDR variable. The default
                is <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">radiuscfg</code></td><td><a id="I_indexterm24_d1e51914" class="indexterm"></a> <code class="literal">/etc/</code>
                <code class="literal">radius</code>
                <code class="literal">client</code>
                <code class="literal">-ng/</code> <code class="literal">radius</code> <code class="literal">client</code> <code class="literal">.conf</code></td><td>Sets the location of the <code class="filename">radiusclient-ng</code> configuration file.
                The default is <code class="filename">/etc/radiusclient-ng/radiusclient.conf</code>.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect3" title="cdr_sqlite"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id250127"></a>cdr_sqlite</h4></div></div></div><p><a id="Monitoring_id250133"></a><a id="I_indexterm24_d1e51943" class="indexterm"></a><a id="I_indexterm24_d1e51950" class="indexterm"></a><a id="I_indexterm24_d1e51957" class="indexterm"></a>This module allows posting of CDRs to a <span class="application">SQLite</span> database using <span class="application">SQLite</span> version 2. Unless you have a
        specific need for <span class="application">SQLite</span>
        version 2 as opposed to version 3, we recommend that all new
        installations use <code class="literal">cdr_sqlite3_custom</code>.</p><p><a id="Monitoring_id250151"></a>This module requires no configuration
        to work. If the module has been compiled and loaded into Asterisk, it
        will insert CDRs into a table called <code class="filename">cdr</code> in a database located at <code class="filename">/var/log/asterisk/cdr.db</code>.</p></div><div class="sect3" title="cdr_sqlite3_custom"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id250164"></a>cdr_sqlite3_custom</h4></div></div></div><p><a id="Monitoring_id250170"></a><a id="I_indexterm24_d1e51986" class="indexterm"></a><a id="I_indexterm24_d1e51993" class="indexterm"></a><a id="I_indexterm24_d1e52000" class="indexterm"></a>This CDR backend inserts CDRs into a <span class="application">SQLite</span> database using <span class="application">SQLite</span> version 3. The database created
        by this module lives at <code class="filename">/var/log/asterisk/master.db</code>. This module
        requires a configuration file, <code class="filename">/etc/asterisk/cdr_sqlite3_custom.conf</code>. The
        configuration file identifies the table name, as well as customizes
        which CDR variables will be inserted into the database:</p><a id="Monitoring_id250206"></a><pre class="programlisting">[master]

table = cdr

;
; List the column names to use when inserting CDRs.
;
columns =&gt; calldate, clid, dcontext, channel, dstchannel, lastapp, lastdata,
    duration, billsec, disposition, amaflags, accountcode, uniqueid, userfield, 
    test


;
; Map CDR contents to the previously specified columns.
;
values =&gt; '${CDR(start)}','${CDR(clid)}','${CDR(dcontext)}','${CDR(channel)}',
    '${CDR(dstchannel)}','${CDR(lastapp)}','${CDR(lastdata)}','${CDR(duration)}',
    '${CDR(billsec)}','${CDR(disposition)}','${CDR(amaflags)}',
    '${CDR(accountcode)}','${CDR(uniqueid)}','${CDR(userfield)}','${CDR(test)}'
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id250192"></a>In the <code class="filename">cdr_sqlite3_custom.conf</code> file, the
          contents of the <code class="literal">columns</code> and
          <code class="literal">values</code> options must each be on a
          single line.</p></div></div><div class="sect3" title="cdr_syslog"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id250217"></a>cdr_syslog</h4></div></div></div><p><a id="Monitoring_id246750"></a><a id="I_indexterm24_d1e52034" class="indexterm"></a><a id="I_indexterm24_d1e52041" class="indexterm"></a><a id="I_indexterm24_d1e52048" class="indexterm"></a>This module allows logging of CDRs using <span class="application"><span class="emphasis"><em>syslog</em></span></span>. To enable
        this, first add an entry to the system’s <span class="application"><span class="emphasis"><em>syslog</em></span></span>
        configuration file, <code class="filename">/etc/syslog.conf</code>. For example:</p><a id="Monitoring_id246767"></a><pre class="programlisting">local4.*      /var/log/asterisk/asterisk-cdr.log</pre><p><a id="Monitoring_id246770"></a>The Asterisk module has a configuration
        file, as well. Add the following section to <code class="filename">/etc/asterisk/cdr_syslog.conf</code>:</p><a id="Monitoring_id246778"></a><pre class="programlisting">[cdr]

facility = local4
priority = info
template = "We received a call from ${CDR(src)}"
</pre><p><a id="Monitoring_id246782"></a>Here is an example
        <span class="emphasis"><em>syslog</em></span> entry using this configuration:</p><a id="Monitoring_id246786"></a><pre class="screen">$ <strong class="userinput"><code>cat /var/log/asterisk/asterisk-cdr.log</code></strong>

Aug 12 19:17:36 pbx cdr: "We received a call from 2565551212"
</pre></div><div class="sect3" title="cdr_tds"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id246794"></a>cdr_tds</h4></div></div></div><p><a id="Monitoring_id246800"></a><a id="I_indexterm24_d1e52087" class="indexterm"></a><a id="I_indexterm24_d1e52094" class="indexterm"></a><a id="I_indexterm24_d1e52101" class="indexterm"></a>The <code class="literal">cdr_tds</code> module
        uses the <span class="application">FreeTDS</span> library to
        post CDRs to a <span class="application">Microsoft SQL
        Server</span> or <span class="application">Sybase</span> database. It is possible to use
        <span class="application">FreeTDS</span> with <span class="application"><code class="filename">unixODBC</code></span>, so we recommend
        using <code class="literal">cdr_adaptive_odbc</code> instead of
        this module.<a id="I_indexterm24_d1e52128" class="indexterm"></a><a id="I_indexterm24_d1e52129" class="indexterm"></a><a id="I_indexterm24_d1e52130" class="indexterm"></a></p></div></div><div class="sect2" title="Example Call Detail Records"><div class="titlepage"><div><div><h3 class="title"><a id="cdr_examples"></a>Example Call Detail Records</h3></div></div></div><p><a id="Monitoring_id246838"></a><a id="I_indexterm24_d1e52135" class="indexterm"></a><a id="I_indexterm24_d1e52142" class="indexterm"></a>We will use the <code class="literal">cdr_custom</code> module to illustrate some example
      CDR records for different call scenarios. The configuration used for
      <code class="filename">/etc/asterisk/cdr_custom.conf</code> is
      shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom" title="cdr_custom">the section called “cdr_custom”</a>.</p><div class="sect3" title="Single-party call"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id246856"></a>Single-party call</h4></div></div></div><p><a id="Monitoring_id246861"></a><a id="I_indexterm24_d1e52160" class="indexterm"></a>In this example, we’ll show what a CDR looks like for a
        simple one-party call. Specifically, we will use the example of a user
        calling in to check her voicemail. Here is the extension from
        <code class="filename">/etc/asterisk/extensions.conf</code>:</p><a id="Monitoring_id246870"></a><pre class="programlisting">exten =&gt; *98,1,VoiceMailMain(@${GLOBAL(VOICEMAIL_CONTEXT)})</pre><p><a id="Monitoring_id246874"></a>This is the CDR from <code class="filename">/var/log/asterisk/cdr-custom/Master.csv</code>
        that was created as a result of calling this extension:</p><a id="Monitoring_id246882"></a><pre class="programlisting">"""Console"" &lt;2565551212&gt;","2565551212","*98","UserServices","Console/dsp","",
    "VoiceMailMain","@shifteight.org","2010-08-16 01:08:44","2010-08-16 01:08:44",
    "2010-08-16 01:08:53","9","9","ANSWERED","DOCUMENTATION","","1281935324.0","",0
</pre></div><div class="sect3" title="Two-party call"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id246891"></a>Two-party call</h4></div></div></div><p><a id="Monitoring_id246896"></a><a id="I_indexterm24_d1e52180" class="indexterm"></a>For this next example, we show what a CDR looks like for
        a simple two-party call. We’ll have one SIP phone place a call to
        another SIP phone. The call is answered and then hung up after a short
        period of time. Here is the extension that was dialed:</p><a id="Monitoring_id246902"></a><pre class="programlisting">exten =&gt; 101,1,Dial(SIP/0000FFFF0002)</pre><p><a id="Monitoring_id246906"></a>Here is the CDR that was logged to
        <code class="filename">Master.csv</code> as a result of this
        call:</p><a id="Monitoring_id246912"></a><pre class="programlisting">"""Console"" &lt;2565551212&gt;","2565551212","101","LocalSets","Console/dsp",
    "SIP/0000FFFF0002-00000000","Dial","SIP/0000FFFF0002","2010-08-16 01:16:10",
    "2010-08-16 01:16:16","2010-08-16 01:16:29","19","13","ANSWERED",
    "DOCUMENTATION","","1281935770.2","",2
</pre></div></div><div class="sect2" title="Caveats"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id246923"></a>Caveats</h3></div></div></div><p><a id="Monitoring_id246928"></a><a id="I_indexterm24_d1e52198" class="indexterm"></a><a id="I_indexterm24_d1e52205" class="indexterm"></a>The CDR system in Asterisk works very well for fairly
      simple call scenarios. However, as call scenarios get more complicated,
      involving calls to multiple parties, transfers, parking, and other such
      features, the CDR system starts to fall short. Many users report that
      the records do not show all of the information that they expect. Many
      bug fixes have been made to address some of the issues, but the cost of
      regressions or changes in behavior when making changes in this area is
      very high since these records are used for billing.</p><p><a id="Monitoring_id246936"></a>As a result, the Asterisk development
      team has become increasingly resistant to making additional changes to
      the CDR system. Instead, a new system, channel event logging (CEL), has
      been developed that is intended to help address logging of more complex
      call scenarios. Bear in mind that call detail records are simpler and
      easier to consume, though, so we still recommend using CDRs if they suit
      your needs.<a id="I_indexterm24_d1e52213" class="indexterm"></a><a id="I_indexterm24_d1e52214" class="indexterm"></a></p></div></div><div class="sect1" title="CEL (Channel Event Logging)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Monitoring_id246945"></a>CEL (Channel Event Logging)</h2></div></div></div><p><a id="Monitoring_id246951"></a><a id="index-348V703NL5Q" class="indexterm"></a><a id="index-231T213NQ5C" class="indexterm"></a>Channel event logging (CEL) is a new system that was created
    to provide a more flexible means of logging the details of complex call
    scenarios. Instead of collapsing a call down to a single log entry, a
    series of events are logged for the call. This provides a more accurate
    picture of what has happened to the call, at the expense of a more complex
    log.</p><div class="sect2" title="Channel Event Types"><div class="titlepage"><div><div><h3 class="title"><a id="cel_event_types"></a>Channel Event Types</h3></div></div></div><p><a id="Monitoring_id246965"></a><a id="I_indexterm24_d1e52232" class="indexterm"></a><a id="I_indexterm24_d1e52239" class="indexterm"></a><a id="index-408M887HJ3B" class="indexterm"></a>Each CEL record represents an event that occurred for a
      channel in the Asterisk system. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246970" title="Table 24.7. CEL event types">Table&nbsp;24.7, “CEL event types”</a>
      lists the events that are generated by Asterisk as calls are
      processed.</p><div class="table"><a id="Monitoring_id246970"></a><p class="title"><strong>Table&nbsp;24.7.&nbsp;CEL event types</strong></p><div class="table-contents"><table summary="CEL event types" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">CEL event type</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">CHAN_START</code></td><td><a id="I_indexterm24_d1e52268" class="indexterm"></a>A channel has been created.</td></tr><tr><td><code class="literal">CHAN_END</code></td><td><a id="I_indexterm24_d1e52277" class="indexterm"></a>A channel has been destroyed.</td></tr><tr><td><code class="literal">LINKEDID_END</code></td><td><a id="I_indexterm24_d1e52286" class="indexterm"></a>The last channel with a given <code class="literal">linkedid</code> has been destroyed.</td></tr><tr><td><code class="literal">ANSWER</code></td><td><a id="I_indexterm24_d1e52298" class="indexterm"></a>A channel has been answered. On a channel created
              for an outbound call, this event will be generated when the
              remote end answers.</td></tr><tr><td><code class="literal">HANGUP</code></td><td><a id="I_indexterm24_d1e52307" class="indexterm"></a>A channel has hung up. Generally, this event will
              be followed very shortly by a <code class="literal">CHAN_END</code> event. The difference is that
              this event occurs as soon as a hangup request is received,
              whereas <code class="literal">CHAN_END</code> occurs after
              Asterisk has completed post-call cleanup and all resources
              associated with that channel have been released.</td></tr><tr><td><code class="literal">APP_START</code></td><td><a id="I_indexterm24_d1e52322" class="indexterm"></a>A tracked application has started executing on a
              channel. Tracked applications are set in the main CEL
              configuration file, which is covered in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf" title="cel.conf">the section called “cel.conf”</a>.</td></tr><tr><td><code class="literal">APP_END</code></td><td><a id="I_indexterm24_d1e52333" class="indexterm"></a>A tracked application has stopped executing on a
              channel.</td></tr><tr><td><code class="literal">PARK<a id="I_indexterm24_d1e52341" class="indexterm"></a>_START</code></td><td>A channel has been parked.</td></tr><tr><td><code class="literal">PARK_END</code></td><td><a id="I_indexterm24_d1e52352" class="indexterm"></a>A channel has left the parking lot.</td></tr><tr><td><code class="literal">BRIDGE_START</code></td><td><a id="I_indexterm24_d1e52361" class="indexterm"></a>A channel bridge has started. This event occurs
              when two channels are bridged together by an application such as
              <code class="literal">Dial()</code> or <code class="literal">Queue()</code>.</td></tr><tr><td><code class="literal">BRIDGE_END</code></td><td><a id="I_indexterm24_d1e52376" class="indexterm"></a>A channel bridge has ended.</td></tr><tr><td><code class="literal">BRIDGE_UPDATE</code></td><td><a id="I_indexterm24_d1e52386" class="indexterm"></a>An update to a bridge has occurred. This event
              will reflect if a channel’s name or other information has
              changed during a bridge.</td></tr><tr><td><code class="literal">BLINDTRANSFER</code></td><td><a id="I_indexterm24_d1e52395" class="indexterm"></a>A channel has executed a blind transfer.</td></tr><tr><td><code class="literal">ATTENDEDTRANSFER</code></td><td><a id="I_indexterm24_d1e52404" class="indexterm"></a>A channel has executed an attended
              transfer.</td></tr><tr><td><code class="literal">USER_DEFINED</code></td><td><a id="I_indexterm24_d1e52413" class="indexterm"></a>A user-defined channel event has occurred. These
              events are generated by using the <code class="literal">CELGenUserEvent()</code> application.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id247205"></a>There are some more events that have been
      defined, but are not yet used anywhere in the Asterisk code. Presumably,
      some future version will generate these events in the right place. They
      are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id247217" title="Table 24.8. Defined but unused CEL event types">Table&nbsp;24.8, “Defined but unused CEL event types”</a>.<a id="I_indexterm24_d1e52424" class="indexterm"></a><sup>[<a id="id654919" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id654919" class="footnote">172</a>]</sup></p><div class="table"><a id="Monitoring_id247217"></a><p class="title"><strong>Table&nbsp;24.8.&nbsp;Defined but unused CEL event types</strong></p><div class="table-contents"><table summary="Defined but unused CEL event types" border="1"><colgroup><col><col></colgroup><thead><tr><th align="center">CEL event type</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">CONF_ENTER</code></td><td><a id="I_indexterm24_d1e52446" class="indexterm"></a>A channel has connected to a conference
              room.</td></tr><tr><td><code class="literal">CONF_EXIT</code></td><td><a id="I_indexterm24_d1e52455" class="indexterm"></a>A channel has left a conference room.</td></tr><tr><td><code class="literal">CONF_START</code></td><td><a id="I_indexterm24_d1e52464" class="indexterm"></a>A conference has started. This event occurs at the
              time the first channel enters a conference room.</td></tr><tr><td><code class="literal">CONF_END</code></td><td><a id="I_indexterm24_d1e52473" class="indexterm"></a>A conference has ended. This event occurs at the
              time the last channel leaves a conference room.</td></tr><tr><td><code class="literal">3WAY_START</code></td><td><a id="I_indexterm24_d1e52482" class="indexterm"></a>A three-way call has started.</td></tr><tr><td><code class="literal">3WAY_END</code></td><td><a id="I_indexterm24_d1e52491" class="indexterm"></a>A three-way call has ended.</td></tr><tr><td><code class="literal">TRANSFER</code></td><td><a id="I_indexterm24_d1e52500" class="indexterm"></a>A generic transfer has been executed.</td></tr><tr><td><code class="literal">HOOKFLASH</code></td><td><a id="I_indexterm24_d1e52509" class="indexterm"></a>A channel has reported a hookflash event.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect2" title="Channel Event Contents"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id255401"></a>Channel Event Contents</h3></div></div></div><p><a id="Monitoring_id255406"></a><a id="I_indexterm24_d1e52518" class="indexterm"></a><a id="I_indexterm24_d1e52525" class="indexterm"></a>Each CEL event contains the fields listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255410" title="Table 24.9. CEL event fields">Table&nbsp;24.9, “CEL event fields”</a>:</p><div class="table"><a id="Monitoring_id255410"></a><p class="title"><strong>Table&nbsp;24.9.&nbsp;CEL event fields</strong></p><div class="table-contents"><table summary="CEL event fields" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Field name</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">eventtype</code></td><td><code class="literal"><a id="I_indexterm24_d1e52552" class="indexterm"></a>CHAN_START</code></td><td>The name of the event. The list of events that may occur
              can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246970" title="Table 24.7. CEL event types">Table&nbsp;24.7, “CEL event types”</a>.</td></tr><tr><td><code class="literal">eventtime</code></td><td><code class="literal"><a id="I_indexterm24_d1e52566" class="indexterm"></a>2010-08-19 07:27:19</code></td><td>The time that the event occurred.</td></tr><tr><td><code class="literal">cidname</code></td><td><code class="literal"><a id="I_indexterm24_d1e52578" class="indexterm"></a>Julie Bryant</code></td><td>The caller ID name set on the channel associated with
              this event.</td></tr><tr><td><code class="literal">cidnum</code></td><td><code class="literal"><a id="I_indexterm24_d1e52590" class="indexterm"></a>18435551212</code></td><td>The caller ID number set on the channel associated with
              this event.</td></tr><tr><td><code class="literal">cidani</code></td><td><code class="literal">18435551212</code></td><td>The Automatic Number Identification (ANI) number set on
              the channel associated with this event.</td></tr><tr><td><code class="literal">cidrdnis</code></td><td><code class="literal"><a id="I_indexterm24_d1e52611" class="indexterm"></a>18435551234</code></td><td>The redirecting number set on the channel associated with
              this event.</td></tr><tr><td><code class="literal">ciddnid</code></td><td><code class="literal"><a id="I_indexterm24_d1e52623" class="indexterm"></a>18435550987</code></td><td>The dialed number set on the channel associated with this
              event.</td></tr><tr><td><code class="literal">exten</code></td><td><code class="literal"><a id="I_indexterm24_d1e52635" class="indexterm"></a>101</code></td><td>The extension in the dialplan that is currently being
              executed.</td></tr><tr><td><code class="literal">context</code></td><td><code class="literal"><a id="I_indexterm24_d1e52647" class="indexterm"></a>LocalSets</code></td><td>The context for the extension in the dialplan that is
              currently being executed.</td></tr><tr><td><code class="literal">channame</code></td><td><code class="literal"><a id="I_indexterm24_d1e52659" class="indexterm"></a>SIP/0004F2060EB4-00000010</code></td><td>The name of the channel associated with this
              event.</td></tr><tr><td><code class="literal">appname</code></td><td><code class="literal"><a id="I_indexterm24_d1e52671" class="indexterm"></a>Dial</code></td><td>The name of the dialplan application currently being
              executed.</td></tr><tr><td><code class="literal">appdata</code></td><td><code class="literal"><a id="I_indexterm24_d1e52684" class="indexterm"></a>SIP/0004F2060E55</code></td><td>The arguments that were passed to the dialplan
              application that is currently being executed.</td></tr><tr><td><code class="literal">amaflags</code></td><td><code class="literal"><a id="I_indexterm24_d1e52696" class="indexterm"></a>DOCUMENTATION</code></td><td>The Automatic Message Accounting (AMA) flag associated
              with this call. This may be one of the following: <code class="literal">OMIT</code>, <code class="literal">BILLING</code>, <code class="literal">DOCUMENTATION</code>, or <code class="literal">Unknown</code>.</td></tr><tr><td><code class="literal">accountcode</code></td><td><code class="literal"><a id="I_indexterm24_d1e52720" class="indexterm"></a>1234</code></td><td>An account ID. This field is user-defined and is empty by
              default.</td></tr><tr><td><code class="literal">uniqueid</code></td><td><code class="literal"><a id="I_indexterm24_d1e52732" class="indexterm"></a>1282218999.18</code></td><td>The unique ID for the channel that is associated with
              this event.</td></tr><tr><td><code class="literal">userfield</code></td><td><code class="literal"><a id="I_indexterm24_d1e52744" class="indexterm"></a>I like waffles!</code></td><td>User-defined event content.</td></tr><tr><td><code class="literal">linkedid</code></td><td><code class="literal"><a id="I_indexterm24_d1e52756" class="indexterm"></a>1282218999.18</code></td><td>The per-call ID. This ID helps tie together multiple
              events from multiple channels that are all a part of the same
              logical call. The ID comes from the <code class="literal">uniqueid</code> of the first channel in the
              call.</td></tr><tr><td><code class="literal">peer</code></td><td><code class="literal"><a id="I_indexterm24_d1e52771" class="indexterm"></a>SIP/0004F2060E55-00000020</code></td><td>The name of the channel bridged to the channel identified
              by <code class="literal">channame</code>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id255738"></a>Some of the contents of a CEL event are
      user-defined. For example, the <code class="literal">userfield</code> is user-defined and will be empty by
      default. To set it to something, use the <code class="literal">CHANNEL()</code> dialplan function. Here is an
      example of setting the <code class="literal">userfield</code> for
      a channel:<a id="I_indexterm24_d1e52791" class="indexterm"></a></p><a id="Monitoring_id255753"></a><pre class="programlisting">exten =&gt; 101,1,Set(CHANNEL(userfield)=I like waffles!)</pre></div><div class="sect2" title="Dialplan Applications"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id255758"></a>Dialplan Applications</h3></div></div></div><p><a id="Monitoring_id255764"></a><a id="I_indexterm24_d1e52798" class="indexterm"></a><a id="I_indexterm24_d1e52805" class="indexterm"></a><a id="I_indexterm24_d1e52810" class="indexterm"></a><a id="I_indexterm24_d1e52815" class="indexterm"></a>The CEL system includes a single dialplan application that
      lives in the <code class="filename">app_celgenuserevent.so</code>
      module. This application is used to generate custom user-defined events
      of the type <code class="literal">EV_USER_EVENT</code>. A
      practical example of using this would be for logging a caller’s choices
      in a menu:</p><a id="Monitoring_id255776"></a><pre class="programlisting">exten =&gt; 7,1,CELGenUserEvent(MENU_CHOICE,Caller chose option 7)</pre><p><a id="Monitoring_id255781"></a>For full current details on the syntax of
      the <code class="literal">CELGenUserEvent()</code> application,
      use the built-in documentation from the <span class="application">Asterisk</span> CLI:</p><a id="Monitoring_id255792"></a><pre class="screen">*CLI&gt; <strong class="userinput"><code>core show application CELGenUserEvent</code></strong></pre></div><div class="sect2" title="cel.conf"><div class="titlepage"><div><div><h3 class="title"><a id="cel_conf"></a>cel.conf</h3></div></div></div><p><a id="Monitoring_id255806"></a><a id="I_indexterm24_d1e52846" class="indexterm"></a><a id="I_indexterm24_d1e52853" class="indexterm"></a><a id="I_indexterm24_d1e52858" class="indexterm"></a><a id="I_indexterm24_d1e52861" class="indexterm"></a>The CEL system has a single configuration file, <code class="filename">/etc/asterisk/cel.conf</code>. All options set here
      affect CEL processing, regardless of which logging backend modules are
      in use. <span class="keep-together"><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255818" title="Table 24.10. cel.conf [general] section options">Table&nbsp;24.10, “cel.conf [general] section options”</a></span> shows the options that exist
      in this file. All options should be set in the <code class="literal">[general]</code> section <a id="I_indexterm24_d1e52877" class="indexterm"></a>of the configuration file.</p><div class="table"><a id="Monitoring_id255818"></a><p class="title"><strong>Table&nbsp;24.10.&nbsp;cel.conf [general] section options</strong></p><div class="table-contents"><table summary="cel.conf [general] section options" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">enable</code></td><td><code class="literal"><a id="I_indexterm24_d1e52902" class="indexterm"></a>yes</code></td><td>Enables/disables CEL. The default is <code class="literal">no</code>.</td></tr><tr><td><code class="literal">apps</code></td><td><code class="literal"><a id="I_indexterm24_d1e52917" class="indexterm"></a>dial,queue</code></td><td>Sets which dialplan applications to track. The default is
              to track no applications. <code class="literal">EV_APP_START</code> and <code class="literal">EV_APP_END</code> events will be generated
              when channels start and stop executing any tracked
              application.</td></tr><tr><td><code class="literal">events</code></td><td><code class="literal"><a id="I_indexterm24_d1e52935" class="indexterm"></a>CHAN_START,CHAN_END,
              ANSWER,HANGUP</code></td><td>Lists which events to generate. This is useful if you are
              only interested in a subset of the events generated by CEL. If
              you would like to see all events, set this option to <code class="literal">ALL</code>. The default value is to generate
              no events.</td></tr><tr><td><code class="literal">dateformat</code></td><td><code class="literal"><a id="I_indexterm24_d1e52950" class="indexterm"></a>%F %T</code></td><td>Specifies the format for the date when a CEL event
              includes a timestamp. For syntax information, see the manpage
              for <code class="literal">strftime</code> by running
              <span class="command"><strong>man strftime</strong></span> at the command
              line. The default format for the CEL timestamp is <code class="literal">seconds</code><code class="literal">.</code><code class="literal">micro</code><code class="literal">seconds</code> since the epoch.</td></tr></tbody></table></div></div><br class="table-break"><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Monitoring_id255949"></a>At a minimum, to start using CEL, you
        must set the <code class="literal">enable</code> and <code class="literal">events</code> options in <code class="filename">/etc/asterisk/cel.conf</code>.</p></div></div><div class="sect2" title="Backends"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id255966"></a>Backends</h3></div></div></div><p><a id="Monitoring_id255971"></a><a id="index-124T180LO3L" class="indexterm"></a><a id="index-345B388OK1W" class="indexterm"></a>As with the CDR system, there are a number of backend
      modules available for logging CEL events. In fact, all of the CEL
      backend modules were derived from CDR modules, so their configuration is
      very similar. In addition to the configuration options for <code class="filename">cel.conf</code>, which were described in the
      previous section, these modules require configuration to make them
      operate.</p><div class="sect3" title="cel_odbc"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id255986"></a>cel_odbc</h4></div></div></div><p><a id="Monitoring_id255992"></a><a id="I_indexterm24_d1e53007" class="indexterm"></a><a id="I_indexterm24_d1e53014" class="indexterm"></a><a id="I_indexterm24_d1e53021" class="indexterm"></a>The <code class="filename">cel_odbc.so</code>
        module provides the ability to log CEL events to a database using
        ODBC. This module is not quite as adaptive as the CDR adaptive ODBC
        backend. For CEL events, there are no custom variables. However, this
        module will still adapt to the structure of the database, in that it
        will log the fields of CEL events for which there are corresponding
        columns and will not produce an error if there is not a column for
        every field. The configuration for this module goes in <code class="filename">/etc/asterisk/cel_odbc.conf</code>.</p><p><a id="Monitoring_id254166"></a>Multiple tables may be configured in
        the <code class="literal">cel_odbc</code> configuration file.
        Each goes into its own configuration section. The name of the section
        can be anything; the module does not use it. Here is an example of a
        simple table configuration:</p><a id="Monitoring_id254174"></a><pre class="programlisting">[mytable]

connection = asterisk
table = asterisk_cel</pre><p><a id="Monitoring_id254178"></a>The <code class="literal">cel_odbc</code> module will use the following
        columns, if they exist (see the table following this list for a set of
        mappings between event types and their integer value that will be
        inserted into the database):</p><div class="itemizedlist"><a id="Monitoring_id254185"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Monitoring_id254187"></a><a id="Monitoring_id254189"></a><code class="literal">eventtype</code></p></li><li class="listitem"><p><a id="Monitoring_id254202"></a><a id="Monitoring_id254204"></a><code class="literal">eventtime</code></p></li><li class="listitem"><p><a id="Monitoring_id254210"></a><a id="Monitoring_id254212"></a><code class="literal">userdeftype</code></p></li><li class="listitem"><p><a id="Monitoring_id254217"></a><a id="Monitoring_id254219"></a><code class="literal">cid_name</code></p></li><li class="listitem"><p><a id="Monitoring_id254225"></a><a id="Monitoring_id254227"></a><code class="literal">cid_num</code></p></li><li class="listitem"><p><a id="Monitoring_id254232"></a><a id="Monitoring_id261096"></a><code class="literal">cid_ani</code></p></li><li class="listitem"><p><a id="Monitoring_id261101"></a><a id="Monitoring_id261103"></a><code class="literal">cid_rdnis</code></p></li><li class="listitem"><p><a id="Monitoring_id261108"></a><a id="Monitoring_id261111"></a><code class="literal">cid_dnid</code></p></li><li class="listitem"><p><a id="Monitoring_id261116"></a><a id="Monitoring_id261118"></a><code class="literal">exten</code></p></li><li class="listitem"><p><a id="Monitoring_id261123"></a><a id="Monitoring_id261126"></a><code class="literal">context</code></p></li><li class="listitem"><p><a id="Monitoring_id261131"></a><a id="Monitoring_id261133"></a><code class="literal">channame</code></p></li><li class="listitem"><p><a id="Monitoring_id261138"></a><a id="Monitoring_id261140"></a><code class="literal">appname</code></p></li><li class="listitem"><p><a id="Monitoring_id261146"></a><a id="Monitoring_id261148"></a><code class="literal">appdata</code></p></li><li class="listitem"><p><a id="Monitoring_id261153"></a><a id="Monitoring_id261155"></a><code class="literal">accountcode</code></p></li><li class="listitem"><p><a id="Monitoring_id261161"></a><a id="Monitoring_id261163"></a><code class="literal">peeraccount</code></p></li><li class="listitem"><p><a id="Monitoring_id261168"></a><a id="Monitoring_id261170"></a><code class="literal">uniqueid</code></p></li><li class="listitem"><p><a id="Monitoring_id261176"></a><a id="Monitoring_id261178"></a><code class="literal">linkedid</code></p></li><li class="listitem"><p><a id="Monitoring_id261183"></a><a id="Monitoring_id261185"></a><code class="literal">amaflags</code></p></li><li class="listitem"><p><a id="Monitoring_id261191"></a><a id="Monitoring_id261193"></a><code class="literal">userfield</code></p></li><li class="listitem"><p><a id="Monitoring_id261198"></a><a id="Monitoring_id261200"></a><code class="literal">peer</code></p></li></ul></div><p><a id="Monitoring_id261207"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id261215" title="Table 24.11. Event type to integer value mappings for the eventtype column">Table&nbsp;24.11, “Event type to integer value mappings for the eventtype
          column”</a>
        shows the mapping between event types and their integer values that
        will be inserted into the <code class="literal">eventtype</code>
        column of the database.</p><div class="table"><a id="Monitoring_id261215"></a><p class="title"><strong>Table&nbsp;24.11.&nbsp;Event type to integer value mappings for the eventtype
          column</strong></p><div class="table-contents"><table summary="Event type to integer value mappings for the eventtype
          column" border="1"><colgroup><col width="2.5in"><col width="1.5in"></colgroup><thead><tr><th>Event type</th><th>Integer value</th></tr></thead><tbody><tr><td><code class="literal">CHANNEL_START</code></td><td>1</td></tr><tr><td><code class="literal">CHANNEL_END</code></td><td>2</td></tr><tr><td><code class="literal">HANGUP</code></td><td>3</td></tr><tr><td><code class="literal">ANSWER</code></td><td>4</td></tr><tr><td><code class="literal">APP_START</code></td><td>5</td></tr><tr><td><code class="literal">APP_END</code></td><td>6</td></tr><tr><td><code class="literal">BRIDGE_START</code></td><td>7</td></tr><tr><td><code class="literal">BRIDGE_END</code></td><td>8</td></tr><tr><td><code class="literal">CONF_START</code></td><td>9</td></tr><tr><td><code class="literal">CONF_END</code></td><td>10</td></tr><tr><td><code class="literal">PARK_START</code></td><td>11</td></tr><tr><td><code class="literal">PARK_END</code></td><td>12</td></tr><tr><td><code class="literal">BLINDTRANSFER</code></td><td>13</td></tr><tr><td><code class="literal">ATTENDEDTRANSFER</code></td><td>14</td></tr><tr><td><code class="literal">TRANSFER</code></td><td>15</td></tr><tr><td><code class="literal">HOOKFLASH</code></td><td>16</td></tr><tr><td><code class="literal">3WAY_START</code></td><td>17</td></tr><tr><td><code class="literal">3WAY_END</code></td><td>18</td></tr><tr><td><code class="literal">CONF_ENTER</code></td><td>19</td></tr><tr><td><code class="literal">CONF_EXIT</code></td><td>20</td></tr><tr><td><code class="literal">USER_DEFINED</code></td><td>21</td></tr><tr><td><code class="literal">LINKEDID_END</code></td><td>22</td></tr><tr><td><code class="literal">BRIDGE_UPDATE</code></td><td>23</td></tr><tr><td><code class="literal">PICKUP</code></td><td>24</td></tr><tr><td><code class="literal">FORWARD</code></td><td>25</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id261522"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id261530" title="Table 24.12. cel_odbc.conf table configuration">Table&nbsp;24.12, “cel_odbc.conf table configuration”</a>
        shows the options that can be specified in a table configuration
        section in the <code class="filename">cel_odbc.conf</code>
        file.</p><div class="table"><a id="Monitoring_id261530"></a><p class="title"><strong>Table&nbsp;24.12.&nbsp;cel_odbc.conf table configuration</strong></p><div class="table-contents"><table summary="cel_odbc.conf table configuration" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center"><span class="keep-together">Value/Example</span></th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">connection</code></td><td><code class="literal"><a id="I_indexterm24_d1e53323" class="indexterm"></a>pgsql1</code></td><td>Specifies the database connection to be used. This is a
                reference to the configured connection in <code class="filename">res_odbc.conf</code>. This field is
                required.</td></tr><tr><td><code class="literal">table</code></td><td><code class="literal"><a id="I_indexterm24_d1e53338" class="indexterm"></a>asterisk_cdr</code></td><td>Specifies the table name. This field is
                required.</td></tr><tr><td><code class="literal">usegmtime</code></td><td><code class="literal"><a id="I_indexterm24_d1e53350" class="indexterm"></a>no</code></td><td>Enables/disables logging of timestamps using GMT
                instead of local time. The default value for this option is
                <code class="literal">no</code>.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id291560"></a>In addition to the key/value pair
        fields that are shown in the previous table, <code class="filename">cel_odbc.conf</code> allows for a few other
        configuration items. The first is a column alias. Normally, CEL fields
        are logged to columns of the same name. An <code class="literal">alias</code> allows the variable name to be mapped
        to a column with a different name. The syntax is:</p><a id="Monitoring_id291572"></a><pre class="programlisting">alias <em class="replaceable"><code>&lt;CEL field&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;column name&gt;</code></em></pre><p><a id="Monitoring_id291581"></a>Here is an example column mapping using
        the <code class="literal">alias</code> option:</p><a id="Monitoring_id291587"></a><pre class="programlisting">alias exten =&gt; extension</pre><p><a id="Monitoring_id291591"></a>It is also possible to specify a
        content filter. This allows you to specify criteria that must match
        for records to be inserted into the table. The syntax is:</p><a id="Monitoring_id291596"></a><pre class="programlisting">filter <em class="replaceable"><code>&lt;CEL field&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;content&gt;</code></em></pre><p><a id="Monitoring_id291605"></a>Here is an example content
        filter:</p><a id="Monitoring_id291608"></a><pre class="programlisting">filter appname =&gt; Dial</pre><p><a id="Monitoring_id291612"></a>Finally, <code class="filename">cel_odbc.conf</code> allows static content to be
        specified for a column. This can be useful when used along with a set
        of <code class="literal">filter</code>s. This static content can
        help differentiate records that were inserted into the same table by
        different configuration sections. The syntax for static content
        is:</p><a id="Monitoring_id291625"></a><pre class="programlisting">static <em class="replaceable"><code>&lt;"Static Content Goes Here"&gt;</code></em> =&gt; <em class="replaceable"><code>&lt;column name&gt;</code></em></pre><p><a id="Monitoring_id291634"></a>Here is an example of specifying static
        content to be inserted with a CEL event:</p><a id="Monitoring_id291639"></a><pre class="programlisting">static "My Content" =&gt; my_identifier</pre></div><div class="sect3" title="cel_custom"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring-cel_custom"></a>cel_custom</h4></div></div></div><p><a id="Monitoring_id291652"></a><a id="I_indexterm24_d1e53419" class="indexterm"></a><a id="I_indexterm24_d1e53426" class="indexterm"></a><a id="I_indexterm24_d1e53433" class="indexterm"></a>This CEL backend allows for custom formatting of CEL
        events in a log file. It is most commonly used for customized CSV
        output. The configuration file used for this module is <code class="filename">/etc/asterisk/cel_custom.conf</code>. A single
        section called <code class="literal">[mappings]</code> should
        exist in this file. This section contains mappings between filenames
        and the custom templates for CEL events. The templates are specified
        using Asterisk dialplan functions and a few special CEL
        variables.</p><p><a id="Monitoring_id291666"></a>The following example shows a sample
        configuration for <code class="literal">cel_custom</code> that
        enables a single CEL log file, <code class="filename">Master.csv</code>. This file will be created as
        <code class="filename">/var/log/asterisk/cel-custom/Master.csv</code>.
        The template that has been defined uses the <code class="literal">CHANNEL()</code>, <code class="literal">CALLERID()</code>, and <code class="literal">CSV_QUOTE()</code> dialplan functions. The <code class="literal">CSV_QUOTE()</code> function ensures that the values
        are properly escaped for the CSV file format. This example also
        references some special CEL variables, which are listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291696" title="Table 24.13. CEL variables available for use in [mappings]">Table&nbsp;24.13, “CEL variables available for use in [mappings]”</a>.</p><div class="table"><a id="Monitoring_id291696"></a><p class="title"><strong>Table&nbsp;24.13.&nbsp;CEL variables available for use in [mappings]</strong></p><div class="table-contents"><table summary="CEL variables available for use in [mappings]" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">CEL variable</th><th align="center">Value/Example</th><th align="center">Description</th></tr></thead><tbody><tr><td><code class="literal">${eventtype}</code></td><td><code class="literal"><a id="I_indexterm24_d1e53488" class="indexterm"></a>CHAN_START</code></td><td>The name of the CEL event.</td></tr><tr><td><code class="literal">${eventtime}</code></td><td><code class="literal"><a id="I_indexterm24_d1e53500" class="indexterm"></a>1281980238.660403</code></td><td>The timestamp of the CEL event. The timestamp is given
                in the default format in this example.</td></tr><tr><td><code class="literal">${eventextra}</code></td><td><code class="literal"><a id="I_indexterm24_d1e53512" class="indexterm"></a>Whiskey Tango Foxtrot</code></td><td>Custom data included with a CEL event. Extra data is
                usually included when <code class="literal">CELGenUserEvent()</code> is used.</td></tr></tbody></table></div></div><br class="table-break"><p><a id="Monitoring_id291786"></a>Here is the example <code class="filename">/etc/asterisk/cel_custom.conf</code> file:</p><a id="Monitoring_id291803"></a><pre class="programlisting">[mappings]

Master.csv =&gt; ${CSV_QUOTE(${eventtype})},${CSV_QUOTE(${eventtime})},
    ${CSV_QUOTE(${CALLERID(name)})},${CSV_QUOTE(${CALLERID(num)})},
    ${CSV_QUOTE(${CALLERID(ANI)})},${CSV_QUOTE(${CALLERID(RDNIS)})},
    ${CSV_QUOTE(${CALLERID(DNID)})},${CSV_QUOTE(${CHANNEL(exten)})},
    ${CSV_QUOTE(${CHANNEL(context)})},${CSV_QUOTE(${CHANNEL(channame)})},
    ${CSV_QUOTE(${CHANNEL(appname)})},${CSV_QUOTE(${CHANNEL(appdata)})},
    ${CSV_QUOTE(${CHANNEL(amaflags)})},${CSV_QUOTE(${CHANNEL(accountcode)})},
    ${CSV_QUOTE(${CHANNEL(uniqueid)})},${CSV_QUOTE(${CHANNEL(linkedid)})},
    ${CSV_QUOTE(${CHANNEL(peer)})},${CSV_QUOTE(${CHANNEL(userfield)})},
    ${CSV_QUOTE(${eventextra})}
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id291795"></a>In the actual configuration file, the
          value in the <code class="filename">Master.csv</code> mapping
          should be on a single line.</p></div></div><div class="sect3" title="cel_manager"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id291820"></a>cel_manager</h4></div></div></div><p><a id="Monitoring_id291825"></a><a id="I_indexterm24_d1e53538" class="indexterm"></a><a id="I_indexterm24_d1e53545" class="indexterm"></a><a id="I_indexterm24_d1e53552" class="indexterm"></a>The <code class="literal">cel_manager</code>
        backend emits CEL events on the Asterisk Manager Interface (we
        discussed the AMI in detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>). This module is configured in the <code class="filename">/etc/asterisk/cel.conf</code> file. This file
        should contain a single section called <code class="literal">[manager]</code>, which contains a single option to
        enable this module. The default value is <code class="literal">no</code>, but you can enable it as follows:</p><a id="Monitoring_id291849"></a><pre class="programlisting">[manager]

enabled = yes</pre><p><a id="Monitoring_id291852"></a>With this configuration in place, CEL
        events will appear as events on the manager interface. To generate
        example manager events, we will use the following dialplan <span class="keep-together">example</span>:</p><a id="Monitoring_id291857"></a><pre class="programlisting">exten =&gt; 111,1,Answer()
    same =&gt; n,CELGenUserEvent(Custom Event,Whiskey Tango Foxtrot)
    same =&gt; n,Hangup()
</pre><p><a id="Monitoring_id291863"></a>This is the command used to execute
        this extension and generate sample CEL events:</p><a id="Monitoring_id291867"></a><pre class="programlisting"><code class="computeroutput">*CLI&gt;</code> <strong class="userinput"><code>console dial 111@testing</code></strong></pre><p><a id="Monitoring_id291876"></a>Finally, this is one of the example
        manager events produced as a result of this test call:</p><a id="Monitoring_id291880"></a><pre class="programlisting">Event: CEL
Privilege: call,all
EventName: CHAN_START
AccountCode: 
CallerIDnum: 
CallerIDname: 
CallerIDani: 
CallerIDrdnis: 
CallerIDdnid: 
Exten: 111
Context: testing
Channel: Console/dsp
Application: 
AppData: 
EventTime: 2010-08-23 08:14:51
AMAFlags: NONE
UniqueID: 1282569291.1
LinkedID: 1282569291.1
Userfield: 
Peer: 
</pre></div><div class="sect3" title="cel_pgsql"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id291890"></a>cel_pgsql</h4></div></div></div><p><a id="Monitoring_id291895"></a><a id="I_indexterm24_d1e53597" class="indexterm"></a><a id="I_indexterm24_d1e53604" class="indexterm"></a><a id="I_indexterm24_d1e53611" class="indexterm"></a>This module allows posting of CEL events to a PostgreSQL
        database. We recommend that new installations use <code class="literal">cel_odbc</code> instead.</p></div><div class="sect3" title="cel_radius"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id291904"></a>cel_radius</h4></div></div></div><p><a id="Monitoring_id291909"></a><a id="I_indexterm24_d1e53622" class="indexterm"></a><a id="I_indexterm24_d1e53629" class="indexterm"></a><a id="I_indexterm24_d1e53636" class="indexterm"></a>The <code class="literal">cel_radius</code>
        backend allows posting of CEL events to a RADIUS server. When using
        this module, each CEL event is reported to the RADIUS server as a
        single stop event. This module is configured in the <code class="filename">/etc/asterisk/cel.conf</code> file. The options
        for this module, listed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291925" title="Table 24.14. Available options in the cel.conf [radius] section">Table&nbsp;24.14, “Available options in the cel.conf [radius] section”</a>, are
        placed in a section called <code class="literal">[radius]</code>.<a id="I_indexterm24_d1e53652" class="indexterm"></a></p><div class="table"><a id="Monitoring_id291925"></a><p class="title"><strong>Table&nbsp;24.14.&nbsp;Available options in the cel.conf [radius] section</strong></p><div class="table-contents"><table summary="Available options in the cel.conf [radius] section" border="1"><colgroup><col><col><col></colgroup><thead><tr><th align="center">Option</th><th align="center">Value/Example</th><th align="center">Notes</th></tr></thead><tbody><tr><td><code class="literal">usegmtime</code></td><td><code class="literal"><a id="I_indexterm24_d1e53676" class="indexterm"></a>no</code></td><td>Logs timestamps using GMT instead of local time. The
                default is <code class="literal">yes</code>.</td></tr><tr><td><code class="literal">radiuscfg</code></td><td><a id="I_indexterm24_d1e53690" class="indexterm"></a> <code class="literal">/etc/</code>
                <code class="literal">radius</code>
                <code class="literal">client</code>
                <code class="literal">-ng/</code> <code class="literal">radius</code> <code class="literal">client</code> <code class="literal">.conf</code></td><td>Sets the location of the <code class="literal">radiusclient-ng</code> configuration file.
                The default is <code class="filename">/etc/radiusclient-ng/radiusclient.conf</code>.</td></tr></tbody></table></div></div><br class="table-break"></div><div class="sect3" title="cel_sqlite3_custom"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id292007"></a>cel_sqlite3_custom</h4></div></div></div><p><a id="Monitoring_id292012"></a><a id="I_indexterm24_d1e53720" class="indexterm"></a><a id="I_indexterm24_d1e53727" class="indexterm"></a><a id="I_indexterm24_d1e53734" class="indexterm"></a>This CEL backend inserts CEL events into a <span class="application">SQLite</span> database using <span class="application">SQLite</span> version 3. The database created
        by this module lives at <code class="filename">/var/log/asterisk/master.db</code>. The
        configuration file for this module, <code class="filename">/etc/asterisk/cel_sqlite3_custom.conf</code>,
        identifies the table name, as well as customizes which CEL variables
        will be inserted into the database. It looks like this:</p><a id="Monitoring_id292049"></a><pre class="programlisting">[master]

table = cel

;
; List the column names to use when inserting CEL events.
;
columns =&gt; eventtype, eventtime, cidname, cidnum, cidani, cidrdnis, ciddnid,
    context, exten, channame, appname, appdata, amaflags, accountcode, uniqueid,
    userfield, peer

;
; Map CEL event contents to the previously specified columns.
;
values =&gt; '${eventtype}','${eventtime}','${CALLERID(name)}','${CALLERID(num)}',
    '${CALLERID(ANI)}','${CALLERID(RDNIS)}','${CALLERID(DNID)}',
    '${CHANNEL(context)}','${CHANNEL(exten)}','${CHANNEL(channame)}',
    '${CHANNEL(appname)}','${CHANNEL(appdata)}','${CHANNEL(amaflags)}',
    '${CHANNEL(accountcode)}','${CHANNEL(uniqueid)}','${CHANNEL(userfield)}',
    '${CHANNEL(peer)}'</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id292034"></a>In the <code class="filename">cel_sqlite3_custom.conf</code> file, the
          contents of the <code class="literal">columns</code> and
          <code class="literal">values</code> options must appear on a
          single line.</p></div></div><div class="sect3" title="cel_tds"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id292060"></a>cel_tds</h4></div></div></div><p><a id="Monitoring_id292066"></a><a id="I_indexterm24_d1e53768" class="indexterm"></a><a id="I_indexterm24_d1e53775" class="indexterm"></a><a id="I_indexterm24_d1e53782" class="indexterm"></a>The <code class="literal">cel_tds</code> module
        uses the <span class="application">FreeTDS</span> library to
        post CEL events to a <span class="application">Microsoft SQL
        Server</span> or <span class="application">Sybase</span> database. It is possible to use
        <span class="application">FreeTDS</span> with <span class="application"><span class="command"><strong>unixODBC</strong></span></span><a id="I_indexterm24_d1e53805" class="indexterm"></a>, so we recommend using <code class="literal">cel_odbc</code> instead of this module.<a id="I_indexterm24_d1e53812" class="indexterm"></a><a id="I_indexterm24_d1e53813" class="indexterm"></a></p></div></div><div class="sect2" title="Example Channel Events"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id292095"></a>Example Channel Events</h3></div></div></div><p><a id="Monitoring_id292101"></a><a id="index-163J717CD0J" class="indexterm"></a><a id="index-675D534DA3F" class="indexterm"></a>Now we will show you some example sets of call events from
      the CEL system. The <code class="literal">cel_custom</code> module
      will be used for its simplicity. The configuration used for <code class="filename">/etc/asterisk/cel_custom.conf</code> is the same as
      shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom" title="cel_custom">the section called “cel_custom”</a>. Additionally, the
      following configuration was used for <code class="filename">/etc/asterisk/cel.conf</code>:</p><a id="Monitoring_id292123"></a><pre class="programlisting">[general]

enable = yes
apps = Dial,Playback
events = ALL</pre><div class="sect3" title="Single-party call"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id292126"></a>Single-party call</h4></div></div></div><p><a id="Monitoring_id292132"></a><a id="I_indexterm24_d1e53848" class="indexterm"></a><a id="I_indexterm24_d1e53855" class="indexterm"></a>In this example, a single phone calls into an extension
        that plays back a prompt that says “Hello World.” This is the
        dialplan:</p><a id="Monitoring_id292137"></a><pre class="programlisting">exten =&gt; 200,1,Answer()
    same =&gt; n,Playback(hello-world)
    same =&gt; n,Hangup()
</pre><p><a id="Monitoring_id292141"></a>Here are the CEL events that are logged
        as a result of making this call:</p><a id="Monitoring_id292145"></a><pre class="programlisting">"CHAN_START","1282062437.436130","Julie Bryant","12565553333","","","","200",
   "LocalSets","SIP/0000FFFF0003-00000010","","","3","","1282062437.17",
   "1282062437.17","",""

"ANSWER","1282062437.436513","Julie Bryant","12565553333","12565553333","",
   "200","200","LocalSets","SIP/0000FFFF0003-00000010","Answer","","3","",
   "1282062437.17","1282062437.17","",""

"APP_START","1282062437.501868","Julie Bryant","12565553333","12565553333",
   "","200","200","LocalSets","SIP/0000FFFF0003-00000010","Playback",
   "hello-world","3","","1282062437.17","1282062437.17","",""

"APP_END","1282062439.008997","Julie Bryant","12565553333","12565553333","",
   "200","200","LocalSets","SIP/0000FFFF0003-00000010","Playback",
   "hello-world","3","","1282062437.17","1282062437.17","",""

"HANGUP","1282062439.009127","Julie Bryant","12565553333","12565553333","",
   "200","200","LocalSets","SIP/0000FFFF0003-00000010","","","3","",
   "1282062437.17","1282062437.17","",""

"CHAN_END","1282062439.009666","Julie Bryant","12565553333","12565553333",
   "","200","200","LocalSets","SIP/0000FFFF0003-00000010","","","3","",
   "1282062437.17","1282062437.17","",""

"LINKEDID_END","1282062439.009707","Julie Bryant","12565553333",
   "12565553333","","200","200","LocalSets","SIP/0000FFFF0003-00000010","",
   "","3","","1282062437.17","1282062437.17","",""</pre></div><div class="sect3" title="Two-party call"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id292161"></a>Two-party call</h4></div></div></div><p><a id="Monitoring_id292166"></a><a id="I_indexterm24_d1e53869" class="indexterm"></a><a id="I_indexterm24_d1e53876" class="indexterm"></a>For the second example, one phone will call another via
        extension <code class="literal">101</code>. This results in a
        call that has two channels that are bridged together. Here is the
        extension that was called in the dialplan:</p><a id="Monitoring_id292171"></a><pre class="programlisting">exten =&gt; 101,1,Dial(SIP/0000FFFF0001)</pre><p><a id="Monitoring_id292175"></a>Here are the CEL events that are
        generated as a result of making this call:</p><a id="Monitoring_id241463"></a><pre class="programlisting">"CHAN_START","1282062455.574611","Julie Bryant","12565553333","","","","101",
   "LocalSets","SIP/0000FFFF0003-00000011","","","3","","1282062455.18",
   "1282062455.18","",""

"APP_START","1282062455.574872","Julie Bryant","12565553333","12565553333","",
   "101","101","LocalSets","SIP/0000FFFF0003-00000011","Dial",
   "SIP/0000FFFF0001","3","","1282062455.18","1282062455.18","",""

"CHAN_START","1282062455.575044","Candice Yant","12565551111","","","","s",
   "LocalSets","SIP/0000FFFF0001-00000012","","","3","","1282062455.19",
   "1282062455.18","",""

"ANSWER","1282062458.068134","","101","12565551111","","","101","LocalSets",
   "SIP/0000FFFF0001-00000012","AppDial","(Outgoing Line)","3","",
   "1282062455.19","1282062455.18","",""

"ANSWER","1282062458.068361","Julie Bryant","12565553333","12565553333","",
   "101","101","LocalSets","SIP/0000FFFF0003-00000011","Dial",
   "SIP/0000FFFF0001","3","","1282062455.18","1282062455.18","",""

"BRIDGE_START","1282062458.068388","Julie Bryant","12565553333",
   "12565553333","","101","101","LocalSets","SIP/0000FFFF0003-00000011",
   "Dial","SIP/0000FFFF0001","3","","1282062455.18","1282062455.18","",""

"BRIDGE_END","1282062462.965704","Julie Bryant","12565553333","12565553333",
   "","101","101","LocalSets","SIP/0000FFFF0003-00000011","Dial",
   "SIP/0000FFFF0001","3","","1282062455.18","1282062455.18","",""

"HANGUP","1282062462.966097","","101","12565551111","","","","LocalSets",
   "SIP/0000FFFF0001-00000012","AppDial","(Outgoing Line)","3","",
   "1282062455.19","1282062455.18","",""

"CHAN_END","1282062462.966119","","101","12565551111","","","","LocalSets",
   "SIP/0000FFFF0001-00000012","AppDial","(Outgoing Line)","3","",
   "1282062455.19","1282062455.18","",""

"APP_END","1282062462.966156","Julie Bryant","12565553333","12565553333","",
   "101","101","LocalSets","SIP/0000FFFF0003-00000011","Dial",
   "SIP/0000FFFF0001","3","","1282062455.18","1282062455.18","",""

"HANGUP","1282062462.966215","Julie Bryant","12565553333","12565553333",
   "","101","101","LocalSets","SIP/0000FFFF0003-00000011","","","3","",
   "1282062455.18","1282062455.18","",""

"CHAN_END","1282062462.966418","Julie Bryant","12565553333","12565553333",
   "","101","101","LocalSets","SIP/0000FFFF0003-00000011","","","3","",
   "1282062455.18","1282062455.18","",""

"LINKEDID_END","1282062462.966441","Julie Bryant","12565553333",
   "12565553333","","101","101","LocalSets","SIP/0000FFFF0003-00000011",
   "","","3","","1282062455.18","1282062455.18","",""</pre></div><div class="sect3" title="Blind transfer"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id241510"></a>Blind transfer</h4></div></div></div><p><a id="Monitoring_id241515"></a><a id="I_indexterm24_d1e53893" class="indexterm"></a><a id="I_indexterm24_d1e53900" class="indexterm"></a>In this final example, a transfer will be executed. The
        call is started by calling a phone via extension <code class="literal">102</code>. That call is then transferred to
        another phone at extension <code class="literal">101</code>.
        Here is the relevant dialplan:</p><a id="Monitoring_id241521"></a><pre class="programlisting">exten =&gt; 101,1,Dial(SIP/0000FFFF0001)
exten =&gt; 102,1,Dial(SIP/0000FFFF0002)</pre><p><a id="Monitoring_id241525"></a>Here are the CEL events logged as a
        result of this call scenario:<a id="I_indexterm24_d1e53914" class="indexterm"></a><a id="I_indexterm24_d1e53915" class="indexterm"></a><a id="I_indexterm24_d1e53916" class="indexterm"></a><a id="I_indexterm24_d1e53917" class="indexterm"></a></p><a id="Monitoring_id241529"></a><pre class="programlisting">"CHAN_START","1282062488.028200","Julie Bryant","12565553333","","","",
   "102","LocalSets","SIP/0000FFFF0003-00000013","","","3","",
   "1282062488.20","1282062488.20","",""

"APP_START","1282062488.028464","Julie Bryant","12565553333","12565553333",
   "","102","102","LocalSets","SIP/0000FFFF0003-00000013","Dial",
   "SIP/0000FFFF0002","3","","1282062488.20","1282062488.20","",""

"CHAN_START","1282062488.028762","Brooke Brown","12565552222","","","",
   "s","LocalSets","SIP/0000FFFF0002-00000014","","","3","","1282062488.21",
   "1282062488.20","",""

"ANSWER","1282062492.565759","","102","12565552222","","","102","LocalSets",
   "SIP/0000FFFF0002-00000014","AppDial","(Outgoing Line)","3","",
   "1282062488.21","1282062488.20","",""

"ANSWER","1282062492.565973","Julie Bryant","12565553333","12565553333","",
   "102","102","LocalSets","SIP/0000FFFF0003-00000013","Dial",
   "SIP/0000FFFF0002","3","","1282062488.20","1282062488.20","",""

"BRIDGE_START","1282062492.566001","Julie Bryant","12565553333",
   "12565553333","","102","102","LocalSets","SIP/0000FFFF0003-00000013",
   "Dial","SIP/0000FFFF0002","3","","1282062488.20","1282062488.20","",""

"CHAN_START","1282062497.940687","","","","","","s","LocalSets",
   "AsyncGoto/SIP/0000FFFF0002-00000014","","","3","","1282062497.22",
   "1282062488.20","",""

"BLINDTRANSFER","1282062497.940925","Julie Bryant","12565553333","12565553333","",
   "102","102","LocalSets","SIP/0000FFFF0003-00000013","Dial","SIP/0000FFFF0002",
   "3","","1282062488.20","1282062488.20",
   "AsyncGoto/SIP/0000FFFF0002-00000014&lt;ZOMBIE&gt;",""

"BRIDGE_END","1282062497.940961","Julie Bryant","12565553333","12565553333","",
   "102","102","LocalSets","SIP/0000FFFF0003-00000013","Dial",
   "SIP/0000FFFF0002","3","","1282062488.20","1282062488.20","",""

"APP_START","1282062497.941021","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","Dial","SIP/0000FFFF0001","3","",
   "1282062497.22","1282062488.20","",""

"CHAN_START","1282062497.941207","Candice Yant","12565551111","","","","s",
   "LocalSets","SIP/0000FFFF0001-00000015","","","3","","1282062497.23",
   "1282062488.20","",""

"HANGUP","1282062497.941361","","","","","","","LocalSets",
   "AsyncGoto/SIP/0000FFFF0002-00000014&lt;ZOMBIE&gt;","AppDial",
   "(Outgoing Line)","3","","1282062488.21","1282062488.20","",""

"CHAN_END","1282062497.941380","","","","","","","LocalSets",
   "AsyncGoto/SIP/0000FFFF0002-00000014&lt;ZOMBIE&gt;","AppDial","(Outgoing Line)",
   "3","","1282062488.21","1282062488.20","",""

"APP_END","1282062497.941415","Julie Bryant","12565553333","12565553333","",
   "102","102","LocalSets","SIP/0000FFFF0003-00000013","Dial",
   "SIP/0000FFFF0002","3","","1282062488.20","1282062488.20","",""

"HANGUP","1282062497.941453","Julie Bryant","12565553333","12565553333",
   "","102","102","LocalSets","SIP/0000FFFF0003-00000013","","","3","",
   "1282062488.20","1282062488.20","",""

"CHAN_END","1282062497.941474","Julie Bryant","12565553333","12565553333",
   "","102","102","LocalSets","SIP/0000FFFF0003-00000013","","","3","",
   "1282062488.20","1282062488.20","",""

"ANSWER","1282062500.559578","","101","12565551111","","","101","LocalSets",
   "SIP/0000FFFF0001-00000015","AppDial","(Outgoing Line)","3","",
   "1282062497.23","1282062488.20","",""

"BRIDGE_START","1282062500.559720","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","Dial","SIP/0000FFFF0001","3","","1282062497.22",
   "1282062488.20","",""

"BRIDGE_END","1282062512.742600","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","Dial","SIP/0000FFFF0001","3","","1282062497.22",
   "1282062488.20","",""

"HANGUP","1282062512.743006","","101","12565551111","","","","LocalSets",
   "SIP/0000FFFF0001-00000015","AppDial","(Outgoing Line)","3","","1282062497.23",
   "1282062488.20","",""

"CHAN_END","1282062512.743211","","101","12565551111","","","","LocalSets",
   "SIP/0000FFFF0001-00000015","AppDial","(Outgoing Line)","3","","1282062497.23",
   "1282062488.20","",""

"APP_END","1282062512.743286","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","Dial","SIP/0000FFFF0001","3","","1282062497.22",
   "1282062488.20","",""

"HANGUP","1282062512.743346","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","","","3","","1282062497.22","1282062488.20",
   "",""

"CHAN_END","1282062512.743371","","102","12565552222","","","101","LocalSets",
   "SIP/0000FFFF0002-00000014","","","3","","1282062497.22","1282062488.20",
   "",""

"LINKEDID_END","1282062512.743391","","102","12565552222","","","101",
   "LocalSets","SIP/0000FFFF0002-00000014","","","3","","1282062497.22",
   "1282062488.20","",""
</pre></div></div></div><div class="sect1" title="SNMP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Monitoring_id241628"></a>SNMP</h2></div></div></div><p><a id="Monitoring_id241633"></a><a id="index-364B273DE8L" class="indexterm"></a><a id="index-240T615IS0L" class="indexterm"></a>The Simple Network Management Protocol (SNMP) is a
    standardized protocol for network management. It is very commonly used and
    implemented across many applications and network devices. Platforms such
    as <a class="ulink" href="http://www.opennms.org/" target="_top">OpenNMS</a><a id="I_indexterm24_d1e53936" class="indexterm"></a>,<sup>[<a id="id659487" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id659487" class="footnote">173</a>]</sup> an open source network management platform, use SNMP (among
    other things). Asterisk supports SNMP through the <code class="literal">res_snmp</code> module. This section discusses the
    installation and configuration of <code class="literal">res_snmp</code>, as well as how it can be utilized by a
    platform like OpenNMS.</p><div class="sect2" title="Installing the SNMP Module for Asterisk"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id241664"></a>Installing the SNMP Module for Asterisk</h3></div></div></div><p><a id="Monitoring_id241669"></a><a id="I_indexterm24_d1e53959" class="indexterm"></a><a id="I_indexterm24_d1e53966" class="indexterm"></a><a id="I_indexterm24_d1e53971" class="indexterm"></a>By default, Asterisk will not compile the SNMP development
      module, since a dependency needs to be satisfied first.</p><div class="sect3" title="CentOS dependency"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id241674"></a>CentOS dependency</h4></div></div></div><p><a id="Monitoring_id241679"></a><a id="I_indexterm24_d1e53981" class="indexterm"></a>In CentOS, you simply need to install the <code class="filename">net-snmp-devel</code> package:</p><a id="Monitoring_id241686"></a><pre class="programlisting">$ <strong class="userinput"><code>sudo yum install net-snmp-devel</code></strong></pre><p><a id="Monitoring_id241692"></a>See the upcoming section <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#recompile-ast-with-snmp" title="Recompiling Asterisk with the res_snmp module">the section called “Recompiling Asterisk with the res_snmp module”</a> for a description of
        how to recompile Asterisk with SNMP support.</p></div><div class="sect3" title="Ubuntu dependency"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id241703"></a>Ubuntu dependency</h4></div></div></div><p><a id="Monitoring_id241708"></a><a id="I_indexterm24_d1e54002" class="indexterm"></a>Under Ubuntu, the following package needs to be
        installed:</p><a id="Monitoring_id241740"></a><pre class="programlisting">$ <strong class="userinput"><code>sudo apt-get install snmp libsnmp-dev snmpd</code></strong></pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Monitoring_id241714"></a>Both the <code class="filename">snmp</code> and <code class="filename">snmpd</code> packages need to be installed
          explicitly on Ubuntu, as they are not dependencies of the SNMP
          development libraries, like they are on CentOS. The <code class="filename">snmp</code> package installs SNMP tools like
          <span class="command"><strong>snmpwalk</strong></span><a id="I_indexterm24_d1e54026" class="indexterm"></a> that we’ll need, and the <code class="filename">snmpd</code> package installs the SNMP
          daemon.</p></div><p><a id="Monitoring_id241745"></a>See the next section for a description
        of how to recompile Asterisk with SNMP support.</p></div><div class="sect3" title="Recompiling Asterisk with the res_snmp module"><div class="titlepage"><div><div><h4 class="title"><a id="recompile-ast-with-snmp"></a>Recompiling Asterisk with the res_snmp module</h4></div></div></div><p><a id="Monitoring_id241764"></a><a id="I_indexterm24_d1e54039" class="indexterm"></a><a id="I_indexterm24_d1e54042" class="indexterm"></a>Once you’ve satisfied the dependencies for SNMP, you can
        recompile Asterisk with SNMP support:</p><a id="Monitoring_id241768"></a><pre class="programlisting">$ <strong class="userinput"><code>cd ~/src/asterisk-complete/asterisk/1.8/</code></strong>
$ <strong class="userinput"><code>./configure</code></strong>
$ <strong class="userinput"><code>make menuselect</code></strong>  # verify that res_snmp is selected under Resource Modules 
$ <strong class="userinput"><code>sudo make install</code></strong>
</pre><p><a id="Monitoring_id241785"></a>You then need to copy the sample config
        file over to the <code class="filename">/etc/asterisk</code>
        folder:</p><p><a id="Monitoring_id241789"></a><a id="Monitoring_id241790"></a></p><pre class="programlisting">$ <strong class="userinput"><code>sudo cp ~/src/asterisk-complete/asterisk/1.8/configs/res_snmp.conf.sample \ 
/etc/asterisk/res_snmp.conf</code></strong></pre><p><a id="Monitoring_id241796"></a>We’ll talk about configuring this file
        for use with <a class="ulink" href="http://www.opennms.org/" target="_top">OpenNMS</a> in
        the next section.</p></div></div><div class="sect2" title="Configuring SNMP for Asterisk Using OpenNMS"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id241807"></a>Configuring SNMP for Asterisk Using OpenNMS</h3></div></div></div><p><a id="Monitoring_id241813"></a><a id="index-740M263WM6C" class="indexterm"></a><a id="index-612V244WR6V" class="indexterm"></a><a id="index-044F687MR5M" class="indexterm"></a><a id="index-262D681QD4S" class="indexterm"></a>The <a class="ulink" href="http://www.opennms.org/" target="_top">OpenNMS</a>
      project provides an open-source network management platform that has
      Asterisk support built right in. There are a few steps that must be
      taken to enable this support, though. In this section we’ll take you
      through what you need to do to get your Asterisk server talking to
      OpenNMS.</p><div class="sect3" title="Installing OpenNMS"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id241824"></a>Installing OpenNMS</h4></div></div></div><p><a id="Monitoring_id241829"></a><a id="I_indexterm24_d1e54111" class="indexterm"></a>The OpenNMS wiki has detailed instructions for
        installing OpenNMS, which you can find at <a class="ulink" href="http://opennms.org/wiki/Installation:Yum" target="_top">http://opennms.org/wiki/Installation:Yum</a>.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p><a id="Monitoring_id241844"></a>OpenNMS should normally not be
          installed on your Asterisk server. You will want to designate a
          separate machine as your OpenNMS server.</p></div><p><a id="Monitoring_id241850"></a>Since the OpenNMS wiki provides all the
        required instructions, we’ll leave it to the experts to lead you
        through the first part of the installation. Once you’ve installed
        OpenNMS, come back here and we’ll take you through how to configure it
        to work with Asterisk.</p><p><a id="Monitoring_id241856"></a>The instructions for installing OpenNMS
        on the wiki use SNMPv2c, which is not a secure method of abstracting
        data from the SNMP protocol. Since we want to build a secure system,
        our instructions will show you how to enable SNMPv3 support.<sup>[<a id="id660066" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id660066" class="footnote">174</a>]</sup></p><p><a id="Monitoring_id241873"></a>However, because SNMPv3 can be a bit of
        an unwieldy beast, and because you may not wish to enable SNMPv3 for
        some reason (e.g., if your version of SNMP was not compiled with
        OpenSSL support), we will provide instructions for configuring the
        SNMP daemon for both SNMPv2c and SNMPv3.</p><p><a id="Monitoring_id241879"></a>It tends to be easier to configure the
        system for SNMPv2c first and then update it to SNMPv3, as the steps to
        get SNMPv3 set up properly are more complex.</p></div><div class="sect3" title="Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS server"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id241885"></a>Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS
        server</h4></div></div></div><p><a id="Monitoring_id241894"></a><a id="I_indexterm24_d1e54139" class="indexterm"></a><a id="I_indexterm24_d1e54142" class="indexterm"></a>In the <code class="filename">/etc/asterisk/res_snmp.conf</code> file that
        you’ve copied over from your source directory, there are two lines you
        must uncomment:</p><p><a id="Monitoring_id241902"></a><a id="Monitoring_id241903"></a></p><pre class="programlisting">[general]
;subagent=yes
;enabled=yes</pre><p>Modify the <code class="filename">res_snmp.conf</code> file so both the SNMP client
        and the subagent are enabled:</p><p><a id="Monitoring_id241911"></a><a id="Monitoring_id241912"></a></p><pre class="programlisting">[general]
subagent=yes
enabled=yes</pre><p>After modifying this file, you will need to reload
        the <code class="filename">res_snmp.so</code> module in order
        for the changes to take effect:</p><p><a id="Monitoring_id241925"></a><a id="Monitoring_id241926"></a></p><pre class="programlisting">*CLI&gt; <strong class="userinput"><code>module unload res_snmp.so</code></strong>
</pre><p> <a id="Monitoring_id241932"></a></p><pre class="screen">Unloaded res_snmp.so
 Unloading [Sub]Agent Module
  == Terminating SubAgent
</pre><p> <a id="Monitoring_id241935"></a></p><pre class="programlisting">*CLI&gt; <strong class="userinput"><code>module load res_snmp.so</code></strong>
</pre><p> <a id="Monitoring_id241940"></a></p><pre class="screen">Loaded res_snmp.so
  == Parsing '/etc/asterisk/res_snmp.conf':   == Found
 Loading [Sub]Agent Module
 Loaded res_snmp.so =&gt; (SNMP [Sub]Agent for Asterisk)
  == Starting SubAgent</pre></div><div class="sect3" title="Editing /etc/snmp/snmpd.conf to work with your OpenNMS server"><div class="titlepage"><div><div><h4 class="title"><a id="editing-snmpd-conf"></a>Editing /etc/snmp/snmpd.conf to work with your OpenNMS
        server</h4></div></div></div><p><a id="Monitoring_id241959"></a>Now you can modify the <code class="filename">/etc/snmp/snmpd.conf</code> file for SNMP on the
        host machine. Rename the current example configuration file and create
        a new <code class="filename">snmpd.conf</code> file:</p><p><a id="Monitoring_id241970"></a><a id="Monitoring_id241971"></a></p><pre class="programlisting">$ <strong class="userinput"><code>cd /etc/snmp</code></strong>
$ <strong class="userinput"><code>sudo mv snmpd.conf snmpd.sample</code></strong></pre><p>The
        first thing to do is to add the permissions control to the file. We
        suggest you read the <code class="filename">/etc/snmpd/snmp.sample</code> file that you just
        renamed to get a better idea of how the permissions are being set up.
        Then, add the following to your <code class="filename">snmpd.conf</code> file:</p><p><a id="Monitoring_id241986"></a><a id="Monitoring_id241987"></a></p><pre class="programlisting">$ <strong class="userinput"><code>sudo cat &gt; snmpd.conf

com2sec notConfigUser  default       public

group   notConfigGroup v1           notConfigUser
group   notConfigGroup v2c           notConfigUser

view all    included  .1
view system included  .iso.org.dod.internet.mgmt.mib-2.system

access  notConfigGroup ""      any       noauth    exact  all    none none

syslocation Caledon, ON
syscontact Leif Madsen lmadsen@shifteight.org

</code></strong><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p><a id="Monitoring_id242007"></a></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Monitoring_id242010"></a>The <code class="literal">syslocation</code> and <code class="literal">syscontact</code> lines are not necessary, but
            they can make it easier to identify a particular server if you’re
            monitoring several nodes.</p></div><p><a id="Monitoring_id242023"></a>Now we need to enable the AgentX
        subagent support so information about our Asterisk system can be
        found:</p><p><a id="Monitoring_id242027"></a><a id="Monitoring_id242028"></a></p><pre class="programlisting">$ <strong class="userinput"><code>sudo cat &gt;&gt; snmpd.conf

master agentx
agentXSocket /var/agentx/master
agentXPerms 0660 0775 nobody root

sysObjectID .1.3.6.1.4.1.22736.1

</code></strong><span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>D</strong></span></pre><p><a id="Monitoring_id242050"></a>By adding the <code class="literal">master agentx</code> line and the <code class="literal">agentX</code> options, we’ve enabled Asterisk to
        communicate with the SNMP daemon. The <code class="literal">agentXPerms</code> option is stating that Asterisk
        is running as <span class="command"><strong>root</strong></span>. If your
        Asterisk system is running in a different group, change <span class="command"><strong>root</strong></span> to the group that Asterisk is running
        as.</p><p><a id="Monitoring_id242071"></a>Just below the AgentX configuration, we
        added the <code class="literal">sysObjectID</code> option. The
        purpose of adding the <code class="literal">sysObjectID</code>
        string is so OpenNMS will know that this host system is running
        Asterisk, allowing it to dynamically grab additional graphing
        information.</p><p><a id="Monitoring_id242083"></a>Once you’ve performed these
        configuration steps, you need to restart the SNMP daemon:</p><a id="Monitoring_id242087"></a><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo /etc/init.d/snmpd restart</code></strong></pre><p><a id="Monitoring_id242095"></a>To verify that the information can be
        polled correctly, utilize the <span class="command"><strong>snmpwalk</strong></span> application:</p><a id="Monitoring_id242102"></a><pre class="programlisting">$ <strong class="userinput"><code>snmpwalk -On -v2c -c public 127.0.0.1 .1.3.6.1.4.1.22736</code></strong></pre><p><a id="Monitoring_id242108"></a>You should get several lines of
        information flowing across your screen if your configuration is
        correct, much like the following:</p><a id="Monitoring_id242112"></a><pre class="screen">.1.3.6.1.4.1.22736.1.5.4.1.4.3 = INTEGER: 2
.1.3.6.1.4.1.22736.1.5.4.1.4.4 = INTEGER: 2
.1.3.6.1.4.1.22736.1.5.4.1.4.5 = INTEGER: 1
.1.3.6.1.4.1.22736.1.5.4.1.4.6 = INTEGER: 1
.1.3.6.1.4.1.22736.1.5.4.1.5.1 = INTEGER: 1
...etc</pre><p><a id="Monitoring_id242118"></a>At this point your host system should
        be ready for OpenNMS to connect and gather the information it needs.
        Proceed by adding a node to the system and filling in the appropriate
        information. After a period of time, OpenNMS will poll the host system
        and have access to the Asterisk statistics. You should be able to
        click on <span class="emphasis"><em>Resource Graphs</em></span> after selecting the node
        you created and see a selection of graphs available, such as SIP,
        DAHDI, Local, etc.</p></div><div class="sect3" title="Enabling SNMPv3"><div class="titlepage"><div><div><h4 class="title"><a id="Monitoring_id242129"></a>Enabling SNMPv3</h4></div></div></div><p><a id="Monitoring_id242135"></a><a id="I_indexterm24_d1e54294" class="indexterm"></a><a id="I_indexterm24_d1e54297" class="indexterm"></a>Enabling SNMPv3 allows you to securely connect and
        transmit data from the SNMP daemon to the SNMP client. This may not be
        necessary in a local environment, especially if the client and the
        daemon are running on the same machine. However, when traversing
        public networks it is important to secure this data.</p><p><a id="Monitoring_id251574"></a>First, you need to stop the SNMP
        daemon, using the <span class="command"><strong>init</strong></span> script or
        the <span class="application"><span class="command"><strong>service</strong></span></span> command:</p><a id="Monitoring_id251583"></a><pre class="programlisting">$ <strong class="userinput"><code>sudo /etc/init.d/snmpd stop</code></strong></pre><p><a id="Monitoring_id251589"></a>After stopping the daemon, you need to
        add the initial user to the <code class="filename">/var/net-snmp/snmpd.conf</code> file. This file is
        dynamic in nature and should only be modified when the SNMP daemon has
        been stopped.</p><p><a id="Monitoring_id251598"></a>You need to create a bootstrap user
        that you will be able to use to create the administration user in the
        next step. Add the following line to the <code class="filename">/var/net-snmp/snmpd.conf</code> file:</p><a id="Monitoring_id251607"></a><pre class="programlisting">createUser initial MD5 setup_passphrase DES</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id251623"></a>We’re modifying the <code class="filename">snmpd.conf</code> file we created in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#editing-snmpd-conf" title="Editing /etc/snmp/snmpd.conf to work with your OpenNMS server">the section called “Editing /etc/snmp/snmpd.conf to work with your OpenNMS
        server”</a>.</p></div><p><a id="Monitoring_id251606"></a>After adding it, save the file and
        exit. Next, you need to add permissions to the <code class="filename">/etc/snmp/snmpd.conf</code> file. Add the
        following line to give the <code class="filename">initial</code> user read/write <span class="keep-together">permissions</span>:</p><p><a id="Monitoring_id251637"></a><a id="Monitoring_id251638"></a></p><pre class="programlisting">rwuser initial</pre><p>After making
        these modifications, you can restart the SNMP daemon:</p><p><a id="Monitoring_id251643"></a><a id="Monitoring_id251644"></a></p><pre class="programlisting">$ <strong class="userinput"><code>sudo /etc/init.d/snmpd start</code></strong></pre><p><a id="Monitoring_id251649"></a></p><pre class="screen">Starting snmpd:                                            [  OK  ]</pre><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Monitoring_id251654"></a>If you don’t see the <code class="literal">[ OK ]</code> part after <code class="literal">Starting snmpd:</code>, you have likely made a
            mistake somewhere. Stop the daemon and try again.</p></div><p>Using your <span class="emphasis"><em>initial</em></span> user, you now need to
        create a user for OpenNMS to connect to. You’ll do this with
        the<a id="I_indexterm24_d1e54371" class="indexterm"></a> <span class="command"><strong>snmpusm</strong></span><sup>[<a id="id660844" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id660844" class="footnote">175</a>]</sup> application. Execute the following command, which will
        clone the <code class="filename">opennmsUser</code> user from
        the <code class="filename">initial</code> user. We configured
        the password <code class="literal">setup_passphrase</code> for
        the authentication and privacy settings when we added the <code class="filename">initial</code> user to the <code class="filename">/var/net-snmp/snmpd.conf</code> file:</p><p><a id="Monitoring_id251708"></a><a id="Monitoring_id251709"></a></p><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo snmpusm -v3 -u initial -n "" -l authPriv \
-a MD5 -A setup_passphrase \
-x DES -X setup_passphrase \
localhost create opennmsUser initial</code></strong></pre><p><a id="Monitoring_id251717"></a></p><pre class="screen">User successfully created.</pre><p>Now
        change the passphrase for the <code class="literal">opennmsUser</code> with the following
        command:</p><p><a id="Monitoring_id251725"></a><a id="Monitoring_id251726"></a></p><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo snmpusm -v 3 -u initial -n "" -l authPriv \
-a MD5 -A setup_passphrase \
-x DES -X setup_passphrase \
-Ca -Cx localhost passwd setup_passphrase \
<em class="replaceable"><code>0p3nNMSv3</code></em> opennmsUser</code></strong></pre><p>
        <a id="Monitoring_id251734"></a></p><pre class="screen">SNMPv3 Key(s) successfully changed.</pre><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>The password we’ve assigned to the <code class="literal">opennmsUser</code>, <code class="literal">0p3nNMSv3</code>, is intended solely as an
          example, and should definitely not be used. Change it to something
          else that is secure.</p></div><p><a id="Monitoring_id251746"></a>You can now test to make sure you’re
        getting results from your user by utilizing the <span class="command"><strong>snmpwalk</strong></span> application:<a id="Monitoring_id251753"></a></p><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo snmpwalk -v 3 -u opennmsUser -n "" -l authPriv \
-a MD5 -A 0p3nNMSv3 \
-x DES -X 0p3nNMSv3 \
localhost ifTable</code></strong></pre><p><a id="Monitoring_id251760"></a></p><pre class="screen">IF-MIB::ifIndex.1 = INTEGER: 1
IF-MIB::ifIndex.2 = INTEGER: 2
IF-MIB::ifIndex.3 = INTEGER: 3
IF-MIB::ifDescr.1 = STRING: lo
IF-MIB::ifDescr.2 = STRING: eth0
IF-MIB::ifDescr.3 = STRING: sit0
</pre><p>Now that you have data being returned, lock down the <code class="filename">/etc/snmp/snmpd.conf</code> file to make sure only
        the <code class="literal">opennmsUser</code> can read data from
        the SNMP daemon.</p><p><a id="Monitoring_id251774"></a>The file will look quite similar to the
        one in the previous section, for configuring SNMPv2c. We’ve commented
        out the lines you no longer need with the hash symbol (<code class="literal">#</code>) and added new <code class="literal">group</code> and <code class="literal">access</code> lines to control access to the SNMP
        daemon:</p><p><a id="Monitoring_id251807"></a><a id="Monitoring_id251808"></a></p><pre class="programlisting">com2sec notConfigUser  default       public

#group   notConfigGroup v1            notConfigUser
#group   notConfigGroup v2c           notConfigUser
group   notConfigGroup usm           opennmsUser

#view    systemview    included   .1.3.6.1.2.1.1
#view    systemview    included   .1.3.6.1.2.1.25.1.1
view    all           included   .1

#access  notConfigGroup ""      any       noauth    exact  all    none none
access  notConfigGroup ""       usm       priv      exact  all    none none


syslocation Caledon, ON
syscontact Leif Madsen lmadsen@shifteight.org


#rwuser initial

master agentx
agentXSocket /var/agentx/master
agentXPerms 0660 0775 nobody root

sysObjectID .1.3.6.1.4.1.22736.1
</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Monitoring_id251790"></a>You’ll also notice we’ve commented
            out the <code class="literal">rwuser initial</code> line as
            we no longer need to permit full read/write access to the SNMP
            daemon. Permitting read/write access to the <code class="filename">initial</code> user is only necessary when
            making changes using the <span class="application"><code class="filename">snmpusm</code></span>
            application.</p></div><p>On the <code class="literal">group</code> line, we’ve
        configured the system to use <code class="literal">usm</code>
        (the User-based Security Model) and permitted the <code class="literal">opennmsUser</code> to connect. We control how it
        can connect with the <code class="literal">access</code> line,
        where we’ve enabled access via the <code class="literal">notConfigGroup</code> using <code class="literal">usm</code> and the <code class="literal">priv</code> model, which makes sure we connect
        using both authentication and privacy settings. These in turn make
        sure that we authenticate securely and transmit data <span class="keep-together">encrypted</span>.</p><p><a id="Monitoring_id251843"></a>After modifying the <code class="filename">/etc/snmp/snmpd.conf</code> file, restart the SNMP
        daemon one last time:</p><a id="Monitoring_id251850"></a><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo /etc/init.d/snmpd restart</code></strong></pre><p><a id="Monitoring_id251858"></a>Then verify that you can still access
        data via <span class="command"><strong>snmpwalk</strong></span>:</p><p><a id="Monitoring_id251864"></a><a id="Monitoring_id251866"></a></p><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo snmpwalk -v 3 -u opennmsUser -n "" -l authPriv \
-a MD5 -A 0p3nNMSv3 \
-x DES -X 0p3nNMSv3 \
localhost ifTable</code></strong></pre><p>and that Asterisk is still able
        to connect via AgentX with <span class="command"><strong>snmpwalk</strong></span>:</p><p><a id="Monitoring_id251879"></a><a id="Monitoring_id251880"></a></p><pre class="programlisting"><code class="prompt">$</code> <strong class="userinput"><code>sudo snmpwalk -v 3 -u opennmsUser -n "" -l authPriv \
-a MD5 -A 0p3nNMSv3 \
-x DES -X 0p3nNMSv3 \
localhost .1.3.6.1.4.1.22736</code></strong></pre><p><a id="Monitoring_id251889"></a>If all goes well, you should get lots
        of lines back, including:</p><p><a id="Monitoring_id251893"></a><a id="Monitoring_id251894"></a></p><pre class="screen">SNMPv2-SMI::enterprises.22736.1.5.4.1.2.1 = STRING: "SIP"
SNMPv2-SMI::enterprises.22736.1.5.4.1.2.2 = STRING: "IAX2"
SNMPv2-SMI::enterprises.22736.1.5.4.1.2.3 = STRING: "Bridge"
SNMPv2-SMI::enterprises.22736.1.5.4.1.2.4 = STRING: "MulticastRTP"
SNMPv2-SMI::enterprises.22736.1.5.4.1.2.5 = STRING: "DAHDI"
SNMPv2-SMI::enterprises.22736.1.5.4.1.2.6 = STRING: "Local"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.1 = STRING: "Session Initiation Protocol(SIP)"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.2 = STRING: "Inter Asterisk eXchange Driver"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.3 = STRING: "Bridge Interaction Channel"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.4 = STRING: "Multicast RTP Paging Channel"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.5 = STRING: "DAHDI Telephony Driver"
SNMPv2-SMI::enterprises.22736.1.5.4.1.3.6 = STRING: "Local Proxy Channel Driver"</pre><p>If
        you don’t get data returned right away, it could be because the
        Asterisk <code class="filename">res_snmp.so</code> module has
        not reconnected to the SNMP daemon. You can force this either by
        restarting Asterisk, or by unloading and reloading the <code class="filename">res_snmp.so</code> module from the Asterisk
        CLI.<a id="I_indexterm24_d1e54553" class="indexterm"></a><a id="I_indexterm24_d1e54554" class="indexterm"></a><a id="I_indexterm24_d1e54555" class="indexterm"></a><a id="I_indexterm24_d1e54556" class="indexterm"></a></p></div></div><div class="sect2" title="Monitoring Asterisk with OpenNMS"><div class="titlepage"><div><div><h3 class="title"><a id="Monitoring_id251917"></a>Monitoring Asterisk with OpenNMS</h3></div></div></div><p><a id="Monitoring_id251922"></a><a id="I_indexterm24_d1e54561" class="indexterm"></a><a id="I_indexterm24_d1e54568" class="indexterm"></a><a id="I_indexterm24_d1e54573" class="indexterm"></a>Once <span class="application">you’ve installed
      OpenNMS</span> and configured <span class="application">Asterisk</span> with the <code class="literal">res_snmp</code> module, <span class="application">you can use OpenNMS</span> to monitor your
      <span class="application">Asterisk</span> server. You can
      configure what statistics are monitored, as well as what notifications
      you would like to receive based on those statistics. Exploring the
      capabilities of OpenNMS is left as an exercise for the reader. However,
      we have included a few graphs to demonstrate some of the basic
      information you can collect from an Asterisk server. These graphs come
      from an <span class="keep-together">Asterisk</span> server that is
      not very heavily loaded, but they still give a good indication of what
      you might see.</p><p><a id="Monitoring_id251948"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-channels" title="Figure 24.1. Graph of active Asterisk channels">Figure&nbsp;24.1, “Graph of active Asterisk channels”</a>
      contains a graph of how many channels were active in Asterisk at
      different times.</p><div class="figure-float"><div class="figure"><a id="OpenNMS-channels"></a><p class="title"><strong>Figure&nbsp;24.1.&nbsp;Graph of active Asterisk channels</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject24_d1e54604"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2401.png" alt="Graph of active Asterisk channels"></div></div></div><br class="figure-break"></div><p><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-DAHDI" title="Figure 24.2. Graph of active DAHDI channels">Figure&nbsp;24.2, “Graph of active DAHDI channels”</a> shows a graph of active channels
      of a specific type. In this case, we’re looking at how many DAHDI
      channels are active on the system. Monitoring DAHDI channels is
      particularly interesting, since DAHDI channels are generally mapped to
      physical resources, and a predefined number of channels are available.
      It would be very useful to monitor DAHDI channel utilization and get
      notified when usage passes a particular threshold, as this might be a
      signal that additional capacity needs to be added.</p><div class="figure-float"><div class="figure"><a id="OpenNMS-DAHDI"></a><p class="title"><strong>Figure&nbsp;24.2.&nbsp;Graph of active DAHDI channels</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject24_d1e54615"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2402.png" alt="Graph of active DAHDI channels"></div></div></div><br class="figure-break"></div><p>Finally, <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OpenNMS-traffic" title="Figure 24.3. Graph of traffic on a network interface">Figure&nbsp;24.3, “Graph of traffic on a network interface”</a> shows network
      interface utilization. As you can see, there were spikes in the traffic
      flowing into and out of the system when SIP calls were in
      progress.<a id="I_indexterm24_d1e54624" class="indexterm"></a><a id="I_indexterm24_d1e54625" class="indexterm"></a></p><div class="figure-float"><div class="figure"><a id="OpenNMS-traffic"></a><p class="title"><strong>Figure&nbsp;24.3.&nbsp;Graph of traffic on a network interface</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject24_d1e54629"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2403.png" alt="Graph of traffic on a network interface"></div></div></div><br class="figure-break"></div></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Monitoring_id252037"></a>Conclusion</h2></div></div></div><p><a id="Monitoring_id252042"></a>Asterisk is very good at allowing you to
    keep track of many different facets of its operation, from simple call
    detail records to full debugging of the running code. These various
    mechanisms will help you in your efforts to manage your Asterisk PBX, and
    they represent one of the ways in which Asterisk is vastly superior to
    most (if not all) traditional PBXs.<a id="I_indexterm24_d1e54639" class="indexterm"></a><a id="I_indexterm24_d1e54640" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id649477" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id649477" class="para">170</a>] </sup>Which will normally be found at <code class="filename">/etc/syslog.conf</code>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id649551" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id649551" class="para">171</a>] </sup>And <span class="command"><strong>rsyslog</strong></span>, <span class="command"><strong>syslog-ng</strong></span>, and what-all-else.</p></div><div class="footnote"><p><sup>[<a id="ftn.id654919" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id654919" class="para">172</a>] </sup>If you submit a patch to add any of these events to the code
          and reference this footnote, Russell will send you a free Asterisk
          t-shirt. Footnote bribery!</p></div><div class="footnote"><p><sup>[<a id="ftn.id659487" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id659487" class="para">173</a>] </sup>OpenNMS is certainly not the only platform that could be used
        with the <code class="literal">res_snmp</code> module. However,
        we chose to discuss it here for a number of reasons. First, OpenNMS is
        a very good network management platform that has Asterisk-specific
        integration. Second, it’s open source and 100% free. Lastly, Jeff
        Gehlbach of OpenNMS has contributed to the development of Asterisk,
        most notably making significant improvements to the SNMP support. He
        was also nice enough to help us get all of this stuff working so that
        we could document it.</p></div><div class="footnote"><p><sup>[<a id="ftn.id660066" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id660066" class="para">174</a>] </sup>Additionally, you can find a blog post on enabling SNMPv3
            for OpenNMS at <a class="ulink" href="http://www.opennms.org/wiki/SNMPv3_protocol_configuration" target="_top">http://www.opennms.org/wiki/SNMPv3_protocol_configuration</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id660844" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id660844" class="para">175</a>] </sup>USM means User-based Security Model.</p></div></div></div><div class="chapter" title="Chapter 25. Web Interfaces"><div class="titlepage"><div><div><h2 class="title"><a id="WebInterface"></a>Chapter&nbsp;25.&nbsp;Web Interfaces</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id285574">Flash Operator Panel</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id281371">Queue Status and Reporting</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36038569">Queue Status Display</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36041966">Queue Reporting</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36036769">Call Detail Records</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042327">A2Billing</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id247202">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="WebInterface_id270350"></a>A point of view can be a dangerous luxury
    when <span class="keep-together">substituted</span> for insight and
    understanding.</p><div class="attribution"><span>—<span class="attribution">Marshall McLuhan</span></span></div></div><p><a id="WebInterface_id270332"></a><a id="index-402J215SE7A" class="indexterm"></a><a id="index-537V881LU8K" class="indexterm"></a>Before you get too excited, this chapter is not going to talk
  about dialplan configuration GUIs such as FreePBX or Digium’s Asterisk-GUI.
  We recognize that much of the success of Asterisk is due to the success of
  FreePBX-based projects such as AsteriskNOW, Trixbox, and PBX in a Flash, but
  in this book our focus is on Asterisk. As such, we will not be discussing
  any GUIs that essentially remove your relationship with the dialplan. It’s
  not that we’re against these things, but simply that we have only so much
  space in this book, and our goal is to look at Asterisk from the bottom up.
  Most Asterisk GUI projects hide the inner workings of Asterisk behind an
  interface, and for this reason they are not compatible with the goals of
  this book.</p><p><a id="WebInterface_id36043750"></a>Our discussion of Asterisk web
  interfaces, therefore, will focus on interfaces to components other than the
  dialplan.</p><div class="sidebar" title="The FreePBX Dialplan GUI"><a id="WebInterface_id36041279"></a><div class="titlepage"><div><div><p class="title"><strong>The FreePBX Dialplan GUI</strong></p></div></div></div><p><a id="WebInterface_id288804"></a><a id="I_indexterm25_d1e54668" class="indexterm"></a>Now that we’ve promised not to talk about dialplan
    interfaces, we feel it would be wrong to say nothing at all about FreePBX,
    the juggernaut of the Asterisk community. This interface (which is at the
    heart of many of the most popular Asterisk distributions, such as
    AsteriskNOW, PBX in a Flash, and Trixbox), is unarguably a very large part
    of why Asterisk has been as successful as it has. With the FreePBX
    interface, you can configure and manage many aspects of an Asterisk system
    without touching a single configuration file. While we purists may like
    everyone to work only with the config files, we recognize that for many,
    learning Linux and editing these files by hand is simply not going to
    happen. For those folks, there is FreePBX, and it has our respect for the
    important contributions it has made to the success of Asterisk.</p></div><p><a id="WebInterface_id36042872"></a>What we will do in this chapter is
  introduce a few projects that provide web interfaces into other parts of the
  system, and a selection of web-driven applications that are significant,
  useful, or recommended. In general, we have tended to focus on free and open
  source applications, but we will mention some commercial products where we
  feel it’s warranted.</p><p><a id="WebInterface_id36039447"></a>There are many third-party applications
  that have been developed for Asterisk. The ones described here are among the
  best, at the time of this writing.</p><div class="sect1" title="Flash Operator Panel"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="WebInterface_id285574"></a>Flash Operator Panel</h2></div></div></div><p><a id="WebInterface_id277073"></a><a id="I_indexterm25_d1e54681" class="indexterm"></a><a id="I_indexterm25_d1e54686" class="indexterm"></a><a id="I_indexterm25_d1e54689" class="indexterm"></a>The Flash Operator Panel (or FOP, as it’s more commonly
    known) is an interface primarily for the use of switchboard operators. FOP
    uses Adobe Flash to present an interface through a web browser, and
    connects to Asterisk through the Asterisk Manager Interface (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a> for a discussion of the
    AMI).</p><p><a id="WebInterface_id36041697"></a>There are two versions of the Flash
    Operator Panel: the original release (which so far is at version 0.30, and
    is now a maintenance release only), and FOP2 (shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042163" title="Figure 25.1. FOP2">Figure&nbsp;25.1, “FOP2”</a>), which is a vast improvement over
    the original FOP, but requires the purchase of a license for any system
    with more than 15 extensions.</p><div class="figure-float"><div class="figure"><a id="WebInterface_id36042163"></a><p class="title"><strong>Figure&nbsp;25.1.&nbsp;FOP2</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject25_d1e54702"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2501.png" alt="FOP2"></div></div></div><br class="figure-break"></div><p><a id="WebInterface_id36041675"></a>You can find FOP at <a class="ulink" href="http://www.asternic.org/" target="_top">http://www.asternic.org</a>, and FOP2 at <a class="ulink" href="http://www.fop2.com/" target="_top">http://www.fop2.com</a>.</p></div><div class="sect1" title="Queue Status and Reporting"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="WebInterface_id281371"></a>Queue Status and Reporting</h2></div></div></div><p><a id="WebInterface_id272402"></a>In most call centers, it is not enough
    simply to be able to route calls correctly. Of equal importance to most
    queues is the ability for supervisory and management staff to determine
    how the queue and the agents are performing. For this, two things will be
    of benefit: live queue status information, and some manner of reporting
    package.</p><div class="sect2" title="Queue Status Display"><div class="titlepage"><div><div><h3 class="title"><a id="WebInterface_id36038569"></a>Queue Status Display</h3></div></div></div><p><a id="WebInterface_id36037327"></a><a id="I_indexterm25_d1e54722" class="indexterm"></a><a id="I_indexterm25_d1e54727" class="indexterm"></a><a id="I_indexterm25_d1e54732" class="indexterm"></a>Queue status will often be displayed on a large,
      wall-mounted panel or a reader board. Here are some of the kinds of
      information that might be included:</p><div class="itemizedlist"><a id="WebInterface_id36044639"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="WebInterface_id36044641"></a><a id="WebInterface_id36044479"></a>Number of agents logged in</p></li><li class="listitem"><p><a id="WebInterface_id36044483"></a><a id="WebInterface_id36043463"></a>Number of callers holding</p></li><li class="listitem"><p><a id="WebInterface_id36042815"></a><a id="WebInterface_id36042818"></a>Number of calls in
          progress</p></li><li class="listitem"><p><a id="WebInterface_id36040340"></a><a id="WebInterface_id36040343"></a>Current longest hold time</p></li><li class="listitem"><p><a id="WebInterface_id36039792"></a><a id="WebInterface_id36039794"></a>Average hold time</p></li><li class="listitem"><p><a id="WebInterface_id36037166"></a><a id="WebInterface_id36036089"></a>Abandon rate</p></li><li class="listitem"><p><a id="WebInterface_id36036093"></a><a id="WebInterface_id36041847"></a>Service level</p></li></ul></div><p><a id="WebInterface_id36040756"></a>Other information might be desired as
      well; the goal of a queue status display is to present to both
      supervisory staff and queue agents a quick visual indication of the
      state of the queue at this particular moment in time.</p><p><a id="WebInterface_id36037188"></a>Additionally, individual group or
      agent performance metrics may be displayed, as an informational
      tool.</p><p><a id="WebInterface_id36036260"></a>The Asternic Call Center Stats
      software is available in an open source “lite” version that provides a
      basic status display. There are also several commercial products that
      offer this functionality.</p></div><div class="sect2" title="Queue Reporting"><div class="titlepage"><div><div><h3 class="title"><a id="WebInterface_id36041966"></a>Queue Reporting</h3></div></div></div><p><a id="WebInterface_id36041160"></a><a id="I_indexterm25_d1e54768" class="indexterm"></a><a id="I_indexterm25_d1e54773" class="indexterm"></a><a id="I_indexterm25_d1e54778" class="indexterm"></a>Queue reporting consists of reports and graphs that
      supervisory personnel can use to look at queue and agent performance
      from a historical perspective. Many of the metrics will be similar to
      those of the status display; however, the goal of reporting is to allow
      management to monitor staffing levels, identify problems, and analyze
      trends.</p><p><a id="WebInterface_id36039709"></a>We discussed a few queue reporting
      interfaces in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD" title="Chapter 13. Automatic Call Distribution (ACD) Queues">Chapter&nbsp;13, <em>Automatic Call Distribution (ACD) Queues</em></a>.</p></div></div><div class="sect1" title="Call Detail Records"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="WebInterface_id36036769"></a>Call Detail Records</h2></div></div></div><p><a id="WebInterface_id36043967"></a><a id="I_indexterm25_d1e54790" class="indexterm"></a><a id="I_indexterm25_d1e54795" class="indexterm"></a>While Asterisk does a good-enough job of generating and
    storing CDRs, the records are in a very raw format, which makes it
    difficult to perform any sort of analysis on them.</p><p><a id="WebInterface_id36043549"></a>Enter the CDR reporting package. In the
    1990s, when long-distance rates were complex and expensive, an entire
    subindustry was spawned by companies looking to help other companies make
    sense out of complex long-distance rates. Nowadays, with long-distance
    being far less expensive, as well as generally simpler in terms of pricing
    model, there is less need for detailed analysis of call records.
    Nevertheless, many of these highly experienced companies have added
    support for Asterisk CDR analysis, and thus if you want excellent
    reporting capabilities, you will find a huge industry with many
    experienced participants.</p><p><a id="WebInterface_id36043551"></a>For a simple interface to the call
    records, a popular program is <a class="ulink" href="http://www.cdr-stats.org/" target="_top">CDR-Stats</a><a id="I_indexterm25_d1e54807" class="indexterm"></a>, which is the successor to the hugely popular Asterisk-Stat
    package. This open source reporting interface provides a simple way to
    examine call detail records, and some basic metrics on calling
    patterns.</p></div><div class="sect1" title="A2Billing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="WebInterface_id36042327"></a>A2Billing</h2></div></div></div><p><a id="WebInterface_id36041756"></a><a id="I_indexterm25_d1e54816" class="indexterm"></a><a id="I_indexterm25_d1e54821" class="indexterm"></a>The A2Billing project is not simply a billing interface for
    Asterisk: it is, in fact, a complete VoIP carrier-in-a-box. This complex
    and comprehensive product delivers much of the technology you would need
    to allow you to provide a VoIP reseller service.<sup>[<a id="id662401" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id662401" class="footnote">176</a>]</sup></p><p><a id="WebInterface_id36040548"></a>The A2Billing platform has been
    generously released under the AGPL as open source. The sponsor of the
    A2Billing project, Star2Billing, offers consultancy services to get you up
    to speed faster.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="WebInterface_id247202"></a>Conclusion</h2></div></div></div><p><a id="WebInterface_id264694"></a>In this brief chapter we have provided
    some pointers to popular graphical applications that can be used in
    conjunction with Asterisk. While we didn’t cover them in detail, we do
    acknowledge the importance of FreePBX and the AsteriskGUI, which are both
    GUI open source projects that provide a PBX configuration interface on top
    of Asterisk. If a full GUI solution for simple PBX configuration interests
    you, we encourage you to take a look at them. To give them a try, we
    recommend using the AsteriskNOW distribution, which provides both FreePBX
    and AsteriskGUI as GUI options.<a id="I_indexterm25_d1e54835" class="indexterm"></a><a id="I_indexterm25_d1e54836" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id662401" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id662401" class="para">176</a>] </sup>It cannot provide you with business savvy, experience in running
        a phone company, or automatic security, though, so please don’t think
        that all you have to do is download A2Billing and you can take on
        AT&amp;T!</p></div></div></div><div class="chapter" title="Chapter 26. Security"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-Security"></a>Chapter&nbsp;26.&nbsp;Security</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security-SECT-1">Scanning for Valid Accounts</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001183">Fail2ban</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001218">Installation</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001274">iptables</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001330">Sending email</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001503">Encrypted Media</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001664">Securing Asterisk Network APIs</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001703">Other Risk Mitigation</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001714">Resources</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id260063">Conclusion—A Better Idiot</a></span></dt></dl></div><div class="epigraph"><p><a id="Security_id243593"></a>We spend our time searching for security and
    <span class="keep-together">hate it when we get it</span>.</p><div class="attribution"><span>—<span class="attribution">John Steinbeck</span></span></div></div><p><a id="Security_id244814"></a><a id="index-511G725GH1Q" class="indexterm"></a><a id="index-625U843BP0C" class="indexterm"></a>Security for your Asterisk system is critical, especially if
  the system is exposed to the Internet. There is a lot of money to be made by
  attackers in exploiting systems to make free phone calls. This chapter
  provides advice on how to provide stronger security for your VoIP
  deployment.</p><div class="sect1" title="Scanning for Valid Accounts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-Security-SECT-1"></a>Scanning for Valid Accounts</h2></div></div></div><p><a id="Security_id36000912"></a><a id="I_indexterm26_d1e54862" class="indexterm"></a><a id="I_indexterm26_d1e54867" class="indexterm"></a><a id="I_indexterm26_d1e54872" class="indexterm"></a>If you expose your <span class="application">Asterisk</span> system to the public Internet, one
    of the things you will almost certainly see is a scan for valid accounts.
    <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#example-accountscan" title="Example 26.1. Log excerpts from account scanning">Example&nbsp;26.1, “Log excerpts from account scanning”</a> contains log entries from one of
    the authors’ production <span class="application">Asterisk</span> systems.<sup>[<a id="id662626" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id662626" class="footnote">177</a>]</sup> This scan began with checking various common usernames, then
    later went on to scan for numbered accounts. It is common for people to
    name SIP accounts the same as extensions on the PBX. This scan takes
    advantage of that fact. This leads to our first tip for Asterisk
    security:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #1:</em></span> Use non-numeric usernames for your
      VoIP accounts to make them harder to guess. For example, in parts of
      this book we use the MAC address of a SIP phone as its account name in
      Asterisk.</p></blockquote></div><div class="example"><a id="example-accountscan"></a><p class="title"><strong>Example&nbsp;26.1.&nbsp;Log excerpts from account scanning</strong></p><div class="example-contents"><a id="Security_id36000949"></a><pre class="programlisting">[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"123"&lt;sip:123@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"1234"&lt;sip:1234@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"12345"&lt;sip:12345@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"123456"&lt;sip:123456@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching 
peer found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"test"&lt;sip:test@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"sip"&lt;sip:sip@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:15] NOTICE[25690] chan_sip.c: Registration from 
'"user"&lt;sip:user@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"admin"&lt;sip:admin@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"pass"&lt;sip:pass@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"password"&lt;sip:password@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching 
peer found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"testing"&lt;sip:testing@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"guest"&lt;sip:guest@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"voip"&lt;sip:voip@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer 
found
[Aug 22 15:17:16] NOTICE[25690] chan_sip.c: Registration from 
'"account"&lt;sip:account@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching 
peer found

...

[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"100"&lt;sip:100@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"101"&lt;sip:101@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"102"&lt;sip:102@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"103"&lt;sip:103@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"104"&lt;sip:104@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found
[Aug 22 15:17:17] NOTICE[25690] chan_sip.c: Registration from 
'"105"&lt;sip:105@127.0.0.1&gt;' failed for '203.86.167.220:5061' - No matching peer found

</pre></div></div><br class="example-break"><p><a id="Security_id36000954"></a>These account scans take advantage of the
    fact that the response that comes back from the server for a registration
    attempt will differ depending on whether or not the account exists. If the
    account exists, the server will request authentication. If the account
    does not exist, the server will immediately deny the registration attempt.
    This behavior is just how the protocol is defined. This leads us to our
    second tip for Asterisk security:</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #2:</em></span> Set <code class="literal">alwaysauthreject</code> to <code class="literal">yes</code> in the <code class="literal">[general]</code> section of <code class="filename">/etc/asterisk/sip.conf</code>. This option tells
      Asterisk to respond as if every account is valid, which makes scanning
      for valid usernames useless.</p></blockquote></div></div><div class="sect1" title="Authentication Weaknesses"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id276435"></a>Authentication Weaknesses</h2></div></div></div><p><a id="Security_id260432"></a><a id="I_indexterm26_d1e54922" class="indexterm"></a><a id="I_indexterm26_d1e54927" class="indexterm"></a>The first section of this chapter discussed scanning for
    usernames. Even if you have usernames that are difficult to guess, it is
    critical that you have strong passwords as well. If an attacker is able to
    obtain a valid username, he will attempt to brute-force the password.
    Strong passwords make this much more difficult to do.</p><p><a id="Security_id36001131"></a>The default authentication scheme for both
    the SIP<a id="I_indexterm26_d1e54935" class="indexterm"></a> and IAX2 protocols <a id="I_indexterm26_d1e54941" class="indexterm"></a>is weak. Authentication is done using an MD5 challenge and
    response mechanism. If an attacker is able to capture any call traffic,
    such as a SIP call made from a laptop on an open wireless network, it will
    be much easier to work on brute-forcing the password since it will not
    require authentication requests to the server.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #3:</em></span> Use strong passwords.<a id="I_indexterm26_d1e54952" class="indexterm"></a><a id="I_indexterm26_d1e54957" class="indexterm"></a> There are countless resources available on the Internet
      that help define what constitutes a strong password. There are also many
      strong password generators available. Use them!</p></blockquote></div><p><a id="Security_id36001151"></a>IAX2 provides the option of using key-based
    authentication, as well as full encryption of a call. The SIP support in
    Asterisk includes TLS support, which provides encryption for the SIP
    signaling.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #4:</em></span> If you are using IAX2, use key-based
      authentication. This is a much stronger authentication method than the
      default MD5-based challenge-response method. For further enhanced
      security with IAX2, use the option to encrypt the entire call. If you
      are using SIP, use TLS to encrypt the SIP signaling. This will prevent
      an attacker from capturing a successful authentication exchange with the
      server.</p></blockquote></div><p><a id="Security_id36001176"></a>For more information about setting up IAX2
    or SIP encryption, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p></div><div class="sect1" title="Fail2ban"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001183"></a>Fail2ban</h2></div></div></div><p><a id="Security_id36001188"></a><a id="index-281B115RN2N" class="indexterm"></a><a id="index-277M841NR6L" class="indexterm"></a>The last two sections discussed attacks involving scanning
    for valid usernames and brute-forcing passwords. <a class="ulink" href="http://www.fail2ban.org/" target="_top">Fail2ban</a> is an application that can
    watch your <span class="application">Asterisk</span> logs and
    update firewall rules to block the source of an attack in response to too
    many failed authentication attempts.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #5:</em></span> Use <span class="application">Fail2ban</span> when exposing Voice over IP
      services on untrusted networks to automatically update the firewall
      rules to block the sources of attacks.</p></blockquote></div><div class="sect2" title="Installation"><div class="titlepage"><div><div><h3 class="title"><a id="Security_id36001218"></a>Installation</h3></div></div></div><p><a id="Security_id36001223"></a><a id="I_indexterm26_d1e55003" class="indexterm"></a><a id="I_indexterm26_d1e55008" class="indexterm"></a><a id="I_indexterm26_d1e55013" class="indexterm"></a>Fail2ban is available as a package in many distributions.
      Alternatively, you can install it from source by downloading it from the
      <span class="application">Fail2ban</span> website. To install
      it on Ubuntu, use the following command:</p><a id="Security_id36001230"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install fail2ban</code></strong></pre><p><a id="Security_id36001238"></a>To install <span class="application">Fail2ban</span> on CentOS, you must have the EPEL
      repository enabled. For more information on the EPEL repository, see
      <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#third-party-repos" title="Third-Party Repositories">Third-Party Repositories</a>. Once the repository is enabled,
      <span class="application">Fail2ban</span> can be installed by
      running the following command:</p><a id="Security_id36001252"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install fail2ban</code></strong></pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Security_id36001261"></a>The installation of <span class="application">Fail2ban</span> from a package will include an
        <code class="filename">init</code> script to ensure that it
        runs when the machine boots up. If you install from source, make sure
        that you take the necessary steps to ensure that <span class="application">Fail2ban</span> is always running.</p></div><div class="sect3" title="iptables"><div class="titlepage"><div><div><h4 class="title"><a id="Security_id36001274"></a>iptables</h4></div></div></div><p><a id="Security_id36001279"></a><a id="I_indexterm26_d1e55062" class="indexterm"></a>For <span class="application">Fail2ban</span>
        to be able to do anything useful after it detects an attack, you must
        also have <span class="application"><span class="command"><strong>iptables</strong></span></span> installed. To install
        it on Ubuntu, use the following command:</p><a id="Security_id36001289"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo apt-get install iptables</code></strong></pre><p><a id="Security_id36001296"></a>To install <span class="command"><strong>iptables</strong></span> on CentOS, use this command:</p><a id="Security_id36001299"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install iptables</code></strong></pre><p><a id="Security_id36001307"></a>You can verify that <span class="command"><strong>iptables</strong></span> has been installed by running the
        <span class="command"><strong>iptables</strong></span> command. The <span class="command"><strong>-L</strong></span> option requests that the current firewall
        rules be displayed. In this case, there are no rules
        configured:</p><a id="Security_id36001318"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo iptables -L</code></strong>

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination        </pre></div><div class="sect3" title="Sending email"><div class="titlepage"><div><div><h4 class="title"><a id="Security_id36001330"></a>Sending email</h4></div></div></div><p><a id="Security_id36001335"></a><a id="I_indexterm26_d1e55112" class="indexterm"></a><a id="I_indexterm26_d1e55117" class="indexterm"></a>It is interesting and useful to allow Fail2ban to email
        the system administrator when it bans an IP address. For this to work,
        an MTA must be installed. If you are not sure which one to use, the
        one used during testing for writing this chapter was <span class="application">Postfix</span>. To install Postfix on Ubuntu,
        use the following command. You may be asked to answer a couple of
        questions by the installer:</p><a id="Security_id36001345"></a><pre class="screen">          <code class="prompt">$</code>
          <strong class="userinput"><code> sudo apt-get install postfix</code></strong>
        </pre><p><a id="Security_id36001351"></a>To install Postfix on CentOS, use this
        command:</p><a id="Security_id36001354"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>sudo yum install postfix</code></strong></pre><p><a id="Security_id36001362"></a>To test the installation of your MTA,
        you can send a quick email using <span class="application"><span class="command"><strong>mutt</strong></span></span>. To install it, use the
        same installation commands as given for installing <span class="application">Postfix</span>, but substitute <span class="command"><strong>mutt</strong></span> for the package name. Then run the
        following commands to test the MTA:</p><a id="Security_id36001375"></a><pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>echo "Just testing." &gt; email.txt</code></strong>
<code class="prompt">$</code> <strong class="userinput"><code>mutt -s "Testing" youraddress@shifteight.org &lt; email.txt</code></strong></pre></div></div><div class="sect2" title="Configuration"><div class="titlepage"><div><div><h3 class="title"><a id="Security_id36001391"></a>Configuration</h3></div></div></div><p><a id="Security_id36001396"></a><a id="I_indexterm26_d1e55165" class="indexterm"></a><a id="I_indexterm26_d1e55172" class="indexterm"></a><a id="I_indexterm26_d1e55177" class="indexterm"></a>The first file that must be set up is the <span class="application">Asterisk</span> logging configuration file. Here
      are the contents of <code class="filename">/etc/asterisk/logger.conf</code> on a working
      system. Ensure that you at least have <code class="literal">dateformat</code> and <code class="literal">messages</code> set, as those are required for
      <span class="application">Fail2ban</span>:</p><a id="Security_id36001415"></a><pre class="programlisting">[general]

dateformat = %F %T

[logfiles]

console =&gt; notice,warning,error,debug
messages =&gt; notice,warning,error
</pre><p><a id="Security_id36001421"></a>The next configuration file that must be
      created is the one that teaches <span class="application">Fail2ban</span> what to watch out for in
      <span class="application">Asterisk</span> log files. Place the
      following contents in a new file called <code class="filename">/etc/fail2ban/filter.d/asterisk.conf</code>:</p><a id="Security_id36001434"></a><pre class="programlisting">[INCLUDES]

# Read common prefixes. If any customizations available -- read them from
# common.local
#before = common.conf


[Definition]

#_daemon = asterisk

# Option:  failregex
# Notes.:  regex to match the password failures messages in the logfile. The
#          host must be matched by a group named "host". The tag "&lt;HOST&gt;" can
#          be used for standard IP/hostname matching and is only an alias for
#          (?:::f{4,6}:)?(?P&lt;host&gt;\S+)
# Values:  TEXT
#

# *** All lines below should start with NOTICE
#     Some lines have been wrapped due to space requirements for
#     the book. All new lines should start with NOTICE.
#
failregex = NOTICE.* .*: Registration from '.*' failed for '&lt;HOST&gt;' 
 - Wrong password
            NOTICE.* .*: Registration from '.*' failed for '&lt;HOST&gt;' 
 - No matching peer found
            NOTICE.* .*: Registration from '.*' failed for '&lt;HOST&gt;' 
 - Username/auth name mismatch
            NOTICE.* .*: Registration from '.*' failed for '&lt;HOST&gt;' 
 - Device does not match ACL
            NOTICE.* &lt;HOST&gt; failed to authenticate as '.*'$
            NOTICE.* .*: No registration for peer '.*' \(from &lt;HOST&gt;\)
            NOTICE.* .*: Host &lt;HOST&gt; failed MD5 authentication for '.*' (.*)
            NOTICE.* .*: Failed to authenticate user .*@&lt;HOST&gt;.*

# Option:  ignoreregex
# Notes.:  regex to ignore. If this regex matches, the line is ignored.
# Values:  TEXT
#
ignoreregex =
</pre><p><a id="Security_id36001437"></a>Next, you must enable the new Asterisk
      filter that you just created. To do so, append the following contents to
      <code class="filename">/etc/fail2ban/jail.conf</code>. You will
      need to modify the <code class="literal">dest</code> and <code class="literal">sender</code> options to specify the appropriate
      email addresses for the <code class="literal">To</code> and
      <code class="literal">From</code> headers:</p><a id="Security_id36001458"></a><pre class="programlisting">[asterisk-iptables]

enabled  = true
filter   = asterisk
action   = iptables-allports[name=ASTERISK, protocol=all]
           sendmail-whois[name=ASTERISK, dest=me@shifteight.org, 
           sender=fail2ban@shifteight.org]
logpath  = /var/log/asterisk/messages
maxretry = 5
bantime = 259200
</pre><p><a id="Security_id36001463"></a>Finally, there are a couple of options in
      the <code class="literal">[DEFAULT]</code> section of <code class="filename">/etc/fail2ban/jail.conf</code> that<a id="I_indexterm26_d1e55241" class="indexterm"></a><a id="I_indexterm26_d1e55244" class="indexterm"></a> should be updated. The <code class="literal">ignoreip</code> option <a id="I_indexterm26_d1e55253" class="indexterm"></a>specifies a list of IP addresses that should never be
      blocked. It is a good idea to list your IP address(es) here so that you
      never accidentally block yourself if you make a mistake while trying to
      set up a phone, for example.<sup>[<a id="id663752" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id663752" class="footnote">178</a>]</sup> You should consider adding other IP addresses as well,
      such as that of your SIP provider. The whitelisting of good IP addresses
      protects you against abuse of your Fail2ban configuration. A clever
      attacker could cause a denial of service by crafting a series of packets
      that will result in Fail2ban blocking the IP address of their
      choice.</p><p><a id="Security_id36001546"></a>The <code class="literal">destemail</code> option <a id="I_indexterm26_d1e55267" class="indexterm"></a>should be set, as well. This address will be used for
      emails not specific to the <span class="application">Asterisk</span> filter such as the email
      <span class="application">Fail2ban</span> sends out when it
      first starts up. Here’s how you configure these options:<a id="I_indexterm26_d1e55277" class="indexterm"></a><a id="I_indexterm26_d1e55278" class="indexterm"></a></p><a id="Security_id36001496"></a><pre class="programlisting">[DEFAULT]

# Multiple addresses can be specified, separated by a space.
ignoreip = 127.0.0.1 10.1.1.1

destemail = youraddress@shifteight.org
</pre></div></div><div class="sect1" title="Encrypted Media"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001503"></a>Encrypted Media</h2></div></div></div><p><a id="Security_id36001508"></a><a id="I_indexterm26_d1e55285" class="indexterm"></a><a id="I_indexterm26_d1e55290" class="indexterm"></a><a id="I_indexterm26_d1e55293" class="indexterm"></a>Be aware that the audio for a Voice over IP call is
    typically transmitted in an unencrypted format. Anyone that can capture
    the traffic can listen to the audio of the phone call. Luckily,
    <span class="application">Asterisk</span> supports encrypting
    the media of VoIP calls. If you are using SIP, you can encrypt the media
    using SRTP. IAX2 supports fully encrypting calls, as well. Detailed
    information on encrypting media can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn" title="Chapter 7. Outside Connectivity">Chapter&nbsp;7, <em>Outside Connectivity</em></a>.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #6:</em></span> Encrypt the media for calls on
      untrusted networks using SRTP or IAX2 <span class="keep-together">encryption</span>.</p></blockquote></div></div><div class="sect1" title="Dialplan Vulnerabilities"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id245121"></a>Dialplan Vulnerabilities</h2></div></div></div><p><a id="Security_id36001541"></a><a id="I_indexterm26_d1e55316" class="indexterm"></a><a id="I_indexterm26_d1e55321" class="indexterm"></a>The Asterisk dialplan is another area where taking security
    into consideration is critical. The dialplan can be broken down into
    multiple contexts to provide access control to extensions. For example,
    you may want to allow your office phones to make calls out through your
    service provider. However, you do not want to allow anonymous callers that
    come into your main company menu to be able to then dial out through your
    service provider. Use contexts to ensure that only the callers you intend
    have access to services that cost you money.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #7:</em></span> Build dialplan <a id="I_indexterm26_d1e55332" class="indexterm"></a>contexts <a id="I_indexterm26_d1e55338" class="indexterm"></a>with great care. Also, avoid putting any extensions that
      could cost you money in the <code class="literal">[default]</code>
      context.</p></blockquote></div><p><a id="Security_id36001565"></a>One of the more recent Asterisk dialplan
    vulnerabilities to have been discovered and published is the idea of
    dialplan injection. A dialplan injection vulnerability begins with an
    extension that has a pattern that ends with the match-all character, a
    period. Take this extension as an example:</p><a id="Security_id36001571"></a><pre class="programlisting">exten =&gt; _X.,1,Dial(IAX2/otherserver/${EXTEN},30)</pre><p><a id="Security_id36001575"></a>The pattern for this extension matches all
    extensions (of any length) that begin with a digit. Patterns like this are
    pretty common and convenient. The extension then sends this call over to
    another server using the IAX2 protocol, with a dial timeout of 30 seconds.
    Note the usage of the <code class="literal">${EXTEN}</code> variable
    here. That’s where the vulnerability exists.</p><p><a id="Security_id36001584"></a>In the world of Voice over IP, there is no
    reason that a dialed extension must be numeric. In fact, it is quite
    common using SIP to be able to dial someone by name. Since it is possible
    for non-numeric characters to be a part of a dialed extension, what would
    happen if someone sent a call to this extension?</p><a id="Security_id36001590"></a><pre class="programlisting">1234&amp;DAHDI/g1/12565551212</pre><p><a id="Security_id36001593"></a>A call like this is an attempt at
    exploiting a dialplan injection vulnerability. In the previous extension
    definition, once <code class="literal">${EXTEN}</code> has been
    evaluated, the actual <code class="literal">Dial()</code> statement
    that will be executed is:</p><a id="Security_id36001604"></a><pre class="programlisting">exten =&gt; _X.,1,Dial(IAX2/otherserver/1234&amp;DAHDI/g1/12565551212,30)</pre><p><a id="Security_id36001607"></a>If the system has a PRI configured, this
    call will cause a call to go out on the PRI to a number chosen by the
    attacker, even though you did not explicitly grant access to the PRI to
    that caller. This problem can quickly cost you a whole lot of
    money.</p><p><a id="Security_id36001613"></a>There are (at least) two approaches for
    avoiding this problem. The first and easiest approach is to always use
    strict pattern matching. If you know the length of extensions you are
    expecting and only expect only numeric extensions, use a strict numeric
    pattern match. For example, this would work if you are expecting
    four-digit numeric extensions only:</p><a id="Security_id36001619"></a><pre class="programlisting">exten =&gt; _XXXX,1,Dial(IAX2/otherserver/${EXTEN},30)</pre><p><a id="Security_id36001623"></a>The other approach to mitigating dialplan
    injection vulnerabilities is by using the <code class="literal">FILTER()</code> dialplan function. Perhaps you would
    like to allow numeric extensions of any length. <code class="literal">FILTER()</code> makes that easy to achieve
    safely.</p><a id="Security_id36001633"></a><pre class="programlisting">exten =&gt; _X.,1,Set(SAFE_EXTEN=${FILTER(0-9,${EXTEN})})
    same =&gt; n,Dial(IAX2/otherserver/${SAFE_EXTEN},30)</pre><p><a id="Security_id36001637"></a>For more information about the syntax for
    the <code class="literal">FILTER()</code> dialplan function, see the
    output of the <span class="command"><strong>core show function FILTER</strong></span>
    command at the Asterisk CLI.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #8:</em></span> Be wary of dialplan injection
      vulnerabilities. Use strict pattern matching or use the <code class="literal">FILTER()</code> dialplan function to avoid these
      problems.</p></blockquote></div></div><div class="sect1" title="Securing Asterisk Network APIs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001664"></a>Securing Asterisk Network APIs</h2></div></div></div><p><a id="Security_id36001669"></a><a id="I_indexterm26_d1e55407" class="indexterm"></a><a id="I_indexterm26_d1e55412" class="indexterm"></a><a id="I_indexterm26_d1e55415" class="indexterm"></a>FastAGI and the AMI are two network-based APIs commonly used
    in Asterisk deployments. For more details on AGI, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI" title="Chapter 21. Asterisk Gateway Interface (AGI)">Chapter&nbsp;21, <em>Asterisk Gateway Interface (AGI)</em></a>. For more information on the AMI, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI" title="Chapter 20. Asterisk Manager Interface (AMI)">Chapter&nbsp;20, <em>Asterisk Manager Interface (AMI)</em></a>.</p><p><a id="Security_id36001680"></a>In the case of FastAGI, there is no
    encryption or authentication available. It is up to you as the
    administrator to ensure that the only communication allowed to the FastAGI
    server is from Asterisk.</p><p><a id="Security_id36001685"></a>The AMI protocol includes authentication,
    but it is very weak. Further, the data exchanged via the AMI is often
    sensitive, from a privacy standpoint. It is critical to secure AMI
    connectivity. It is best to only expose the AMI on trusted networks. If it
    must be exposed to an untrusted networks, we recommend only allowing
    connections <span class="keep-together">using SSL</span>.</p><p><a id="Security_id184537"></a>It is critical to understand what power the
    AMI provides. If an AMI user is granted all permissions that are
    available, that user will be able to run arbitrary commands on your
    system. If the account has the ability to update configuration files, it
    will be able to add an extension to the dialplan that runs the <code class="literal">System()</code> application, enabling it to run any
    command it wants. If it also has access to originate calls, it can
    originate a call to that extension, resulting in the execution of that
    command. Be careful when opening up AMI access on your system and restrict
    what permissions are granted to each account in <code class="filename">/etc/asterisk/manager.conf</code>.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #9:</em></span> Secure Asterisk network APIs. Use
      firewall rules to restrict access to your FastAGI server. Use encryption
      on the AMI. Restrict access provided to AMI accounts as much as
      possible.</p></blockquote></div></div><div class="sect1" title="IAX2 Denial of Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001692"></a>IAX2 Denial of Service</h2></div></div></div><p><a id="Security_id36001698"></a><a id="I_indexterm26_d1e55447" class="indexterm"></a><a id="I_indexterm26_d1e55452" class="indexterm"></a><a id="I_indexterm26_d1e55457" class="indexterm"></a>While SIP is a text-based protocol, IAX2 is a binary encoded
    protocol. The IAX2 standard is <a class="ulink" href="http://www.rfc-editor.org/rfc/rfc5456.txt" target="_top">RFC 5456</a>. Every
    IAX2 packet contains a call number that is used to associate the packet
    with an active call. This is analogous to the <code class="literal">Call-ID</code> header in SIP. An IAX2 call number, is a
    15-bit field. It is large enough to deal with the number of calls that
    will be practical on one system. Unfortunately, it is also small enough
    that it is pretty easy for an attacker to send enough small packets to
    consume all available call numbers on a system for a short period of time,
    resulting in a denial of service attack.</p><p><a id="Security_id36001822"></a>The IAX2 support in Asterisk has been
    modified to automatically protect against this type of attack. This
    protection is referred to as <span class="emphasis"><em>call token
    support</em></span><a id="I_indexterm26_d1e55471" class="indexterm"></a> and requires a three-way handshake to occur before a call
    number is allocated. However, older versions of Asterisk and some
    non-Asterisk IAX2 implementations may not support this, so there are a
    number of options that let you tweak the behavior.</p><p><a id="Security_id36001829"></a>By default, the security mechanisms are
    enabled and no configuration changes are required. If for some reason you
    would like to disable call token support completely, you can do so by
    using the following configuration in <code class="filename">/etc/asterisk/iax.conf</code>:</p><a id="Security_id36001838"></a><pre class="programlisting">[general]

calltokenoptional = 0.0.0.0/0.0.0.0 
maxcallnumbers = 16382
</pre><p><a id="Security_id36001842"></a>With the default configuration, a host that
    can pass the call token exchange can still consume the call number table.
    The call token exchange ensures that call numbers are only allocated once
    we know we have not received a request with a spoofed source IP address.
    Once we know a request is legitimate, enforcing resource limits per host
    is achievable. Consider the following options in <code class="filename">iax.conf</code><a id="I_indexterm26_d1e55486" class="indexterm"></a><a id="I_indexterm26_d1e55489" class="indexterm"></a>:</p><a id="Security_id36001852"></a><pre class="programlisting">[general]

; Set the default call number limit per host
maxcallnumbers = 16

[callnumberlimits]

; Set a different call number limit for all hosts in a
; specified range.
192.168.1.0/255.255.255.0 = 1024

[some_peer]

; A dynamic peer's address is not known until that peer
; registers. A call number limit can be specified in the
; peer's section instead of the callnumberlimits section.

type = peer
host = dynamic
maxcallnumbers = 512</pre><p><a id="Security_id36001858"></a>If a peer does not yet support call token
    validation, but you would like to turn it on as soon as you detect that
    the peer has been upgraded to support it, there is an option that allows
    for this behavior:</p><a id="Security_id36001864"></a><pre class="programlisting">[some_other_peer]

requirecalltoken = auto</pre><p><a id="Security_id36001867"></a>If you would like to allow guest access
    over IAX2, you will most likely want to disable call token validation for
    unauthenticated calls. This will ensure that the largest number of people
    can call your system over IAX2. However, if you do so, you should also set
    the option that provides a global limit to how many call numbers can be
    consumed by hosts that did not pass call token validation:</p><a id="Security_id36001873"></a><pre class="programlisting">[general]

maxcallnumbers_nonvalidated = 2048

[guest]

type = user
requirecalltoken = no</pre><p><a id="Security_id36001877"></a>If at any time you would like to see some
    statistics on call number usage on your system, execute the <span class="command"><strong>iax2 show callnumber usage</strong></span> command at the
    Asterisk CLI.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #10:</em></span> Be happy knowing that IAX2 has been
      updated to secure itself from denial of service attacks due to call
      number exhaustion. If you must turn off these security features in some
      cases, use the options provided to limit your exposure to an
      attack.</p></blockquote></div></div><div class="sect1" title="Other Risk Mitigation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001703"></a>Other Risk Mitigation</h2></div></div></div><p><a id="Security_id36001708"></a><a id="I_indexterm26_d1e55520" class="indexterm"></a>There are a couple more useful features in <span class="application">Asterisk</span> that can be used to mitigate the
    risk of attacks. The first is to make use of the <code class="literal">permit</code> and <code class="literal">deny</code> options to build access control lists
    (ACLs)<a id="I_indexterm26_d1e55535" class="indexterm"></a> for privileged accounts. Consider a PBX that has SIP phones
    on a local network, but also accepts SIP calls from the public Internet.
    Calls coming in over the Internet are only granted access to the main
    company menu, while local SIP phones have the ability to make outbound
    calls that cost you money. In this case, it is a very good idea to set
    ACLs to ensure that only devices on your local network can use the
    accounts for the phones. Here is an example of doing that in <code class="filename">/etc/asterisk/sip.conf</code>:</p><a id="Security_id184718"></a><pre class="programlisting">[phoneA] ; Use a better account name than this.

type = friend

; Start by denying everyone.
deny = 0.0.0.0/0.0.0.0

; Allow connections that originate from 192.168.X.X to attempt
; to authenticate against this account.
permit = 192.168.0.0/255.255.0.0</pre><p><a id="Security_id184724"></a>The <code class="literal">permit</code>
    and <code class="literal">deny</code> options are accepted almost
    everywhere that connections to IP services are configured. Another useful
    place for ACLs is in <code class="filename">/etc/asterisk/manager.conf</code>, to restrict AMI
    accounts to the single host that is supposed to be using the manager
    interface.</p><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #11:</em></span> Use ACLs when possible on all
      privileged accounts for network services.</p></blockquote></div><p><a id="Security_id184745"></a>Another way you can mitigate security risk is
    by configuring call limits. The recommended method for implementing call
    limits is to use the <code class="literal">GROUP()</code> and
    <code class="literal">GROUP_COUNT()</code> dialplan functions. Here
    is an example that limits the number of calls from each SIP peer to no
    more than two at a time:</p><a id="Security_id184757"></a><pre class="programlisting">exten =&gt; _X.,1,Set(GROUP(users)=${CHANNEL(peername)})

; *** This line should have no line breaks
    same =&gt; n,NoOp(There are ${GROUP_COUNT(${CHANNEL(peername)})} 
calls for account ${CHANNEL(peername)}.)

    same =&gt; n,GotoIf($[${GROUP_COUNT(${CHANNEL(peername)})} &gt; 2]?denied:continue)
    same =&gt; n(denied),NoOp(There are too many calls up already.  Hang up.)
    same =&gt; n,HangUp()
    same =&gt; n(continue),NoOp(continue processing call as normal here ...)
</pre><div class="blockquote"><blockquote class="blockquote"><p><span class="emphasis"><em>Tip #12:</em></span> Use call limits to ensure that if an
      account is compromised, it cannot be used to make hundreds of phone
      calls at a time.</p></blockquote></div></div><div class="sect1" title="Resources"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id36001714"></a>Resources</h2></div></div></div><p><a id="Security_id36001719"></a>Sometimes there are security
    vulnerabilities that require modifications to the Asterisk source code to
    resolve. When those issues are discovered, the Asterisk development team
    puts out new releases that contain only fixes for the security issues, to
    allow for quick and easy upgrades. When this occurs, the Asterisk
    development team also publishes a security advisory document that
    discusses the details of the vulnerability. We recommend that you
    subscribe to the <span class="emphasis"><em>asterisk-announce</em></span> <a class="ulink" href="http://lists.digium.com/mailman/listinfo/asterisk-announce" target="_top">http://lists.digium.com/mailman/listinfo/asterisk-announce</a>
    mailing list to make sure that you know about these issues when they come
    up.</p><p><a id="Security_id184806"></a>One of the most popular tools for SIP account
    scanning and password cracking is <a class="ulink" href="http://sipvicious.org/" target="_top">SIPVicious</a>. We strongly encourage that
    you take a look at it and use it to audit your own systems. If your system
    is exposed to the Internet, others will likely run it against your system,
    so make sure that you do it first.</p><p><a id="Security_id247864"></a>Another resource for all things VoIP
    security–related is the VOIPSEC mailing list on <a class="ulink" href="http://voipsa.org/" target="_top">VOIPSA.org</a>. The website contains some
    additional resources, <span class="keep-together">as
    well</span>.</p><p><a id="Security_id36002137"></a>Finally, <a class="ulink" href="http://www.infiltrated.net/voipabuse/" target="_top">http://www.infiltrated.net/voipabuse/</a> has some useful
    information. The author provides a list of addresses known to be the
    source of VoIP attacks, as well as instructions on how to block all
    addresses on this list. The author also provides a sample script called
    <a class="ulink" href="http://www.infiltrated.net/antitoll" target="_top">AntiToll</a>, which
    blocks all addresses outside of the United States.</p></div><div class="sect1" title="Conclusion—A Better Idiot"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Security_id260063"></a>Conclusion—A Better Idiot</h2></div></div></div><p><a id="Security_id271958"></a>There is a maxim in the technology industry
    that states, “As soon as something is made idiot-proof, nature will invent
    a better idiot.” The point of this statement is that there is no
    development effort that can be considered complete. There is always room
    for improvement.</p><p><a id="Security_id255372"></a>When it comes to security, you must always
    bear in mind that the people who are looking to take advantage of your
    system are highly motivated. No matter how secure your system is, somebody
    will always be looking to crack it.</p><p><a id="Security_id273475"></a>We’re not advocating paranoia, but we are
    suggesting that what we have written here is by no means the final word on
    VoIP security. While we have tried to be as comprehensive as we can be in
    this book, you must accept responsibility for the security of your
    system.</p><p><a id="Security_id269837"></a>As free Internet calling becomes more common,
    the criminals will be working hard to find weaknesses, and exploit
    them.<a id="I_indexterm26_d1e55617" class="indexterm"></a><a id="I_indexterm26_d1e55618" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id662626" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id662626" class="para">177</a>] </sup>The real IP address has been replaced with 127.0.0.1 in the log
        entries.</p></div><div class="footnote"><p><sup>[<a id="ftn.id663752" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id663752" class="para">178</a>] </sup>Leif learned this one the hard way. He thought his PBX was
          down, while Russell and Jim had no problems connecting to the
          conference bridge. It turned out that Fail2ban had banned him from
          his own PBX.</p></div></div></div><div class="chapter" title="Chapter 27. Asterisk: A Future for Telephony"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-CHP-11"></a>Chapter&nbsp;27.&nbsp;Asterisk: A Future for Telephony</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1">The Problems with Traditional Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.1">Closed Thinking</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.2">Limited Standards Compliancy</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.3">Slow Release Cycles</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.4">Refusing to Let Go of the Past and Embrace the Future</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-2">Paradigm Shift</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3">The Promise of Open Source Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.1">The Itch That Asterisk Scratches</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.2">Open Architecture</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.3">Standards Compliance</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.4">Lightning-Fast Response to New Technologies</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.5">Passionate Community</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6">Some Things That Are Now Possible</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.1">Legacy PBX migration gateway</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.3">Conference rooms</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4">The Future of Asterisk</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1">Speech Processing</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.1">Festival</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.2">Speech recognition</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.2">High-Fidelity Voice</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3">Video</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.1">The challenge of videoconferencing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.2">Why we love videoconferencing</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.3">Why videoconferencing may never totally replace voice</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4">Wireless</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.1">WiFi</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.2">WiMAX</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.5">Unified Messaging</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6">Peering</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.1">E.164</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.2">ENUM</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.3">e164.org</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7">Challenges</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.1">Too much change, too few standards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FutureTelephony_id337974">Toll fraud</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.2">VoIP spam</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.3">Fear, uncertainty, and doubt</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.4">Bottleneck engineering</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.6">Quality of service</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.7">Complexity</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8">Opportunities</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.1">Tailor-made private telecommunications networks</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.2">Low barrier to entry</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.3">Hosted solutions of similar complexity to corporate
        websites</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></span></dt></dl></dd></dl></dd></dl></div><div class="epigraph"><p><a id="FutureTelephony_id268741"></a>Now this is not the end. It is not
    even the beginning of the end. But it is, perhaps, the end of the
    beginning.</p><div class="attribution"><span>—<span class="attribution">Winston Churchill</span></span></div></div><p><a id="FutureTelephony_id329080"></a><a id="index-263V504VS0L" class="indexterm"></a><a id="index-110G318NC0Q" class="indexterm"></a>We have arrived at the final chapter of this book. We’ve
  covered a lot, but we hope that we have made it clear that this book has
  merely scratched the surface of this phenomenon called Asterisk. To wrap
  things up, we want to spend some time exploring what we might see from
  Asterisk and open source telephony in the near future.</p><p><a id="FutureTelephony_id305031"></a>When we wrote the first edition of
  <span class="emphasis"><em>Asterisk: The Future of Telephony</em></span>, we confidently
  asserted that open source communications engines such as Asterisk would
  cause a shift in thinking that would transform the telecommunications
  industry. In many ways, our belief has been proven correct. While the
  telecom industry still has much evolving to do, Asterisk has played a key
  role in fomenting a shift in thinking that has affected the entire
  industry.</p><div class="sect1" title="The Problems with Traditional Telephony"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-11-SECT-1"></a>The Problems with Traditional Telephony</h2></div></div></div><p><a id="FutureTelephony_id314982"></a><a id="I_indexterm27_d1e55646" class="indexterm"></a>Although Alexander Graham Bell is most famously remembered
    as the father of the telephone,<sup>[<a id="id665031" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id665031" class="footnote">179</a>]</sup> the reality is that during the latter half of the 1800s,
    dozens of minds were working toward the goal of carrying voice over
    telegraph lines. These people were mostly business-minded folks, looking
    to create a product through which they might make their fortunes.</p><p><a id="FutureTelephony_id335813"></a>We have come to think of traditional
    telephone companies as monopolies, but this was not true in their early
    days. The early history of telephone service took place in a very
    competitive environment, with new companies springing up all over the
    world, often with little or no respect for the patents they might be
    violating. Many famous monopolies got their start through the waging (and
    winning) of patent wars.</p><p><a id="FutureTelephony_id308539"></a>It’s interesting to contrast the
    history of the telephone with the history of Linux and the Internet. While
    the telephone was created as a commercial exercise, and the telecom
    industry was forged through lawsuits and corporate takeovers, Linux and
    the Internet arose out of the academic community, which has always valued
    the sharing of knowledge over profit.</p><p><a id="FutureTelephony_id335892"></a>The cultural differences are obvious.
    Telecommunications technologies tend to be closed, confusing, and
    expensive, while networking technologies are comparatively open, well
    documented, and competitive.</p><div class="sect2" title="Closed Thinking"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-1.1"></a>Closed Thinking</h3></div></div></div><p><a id="FutureTelephony_id340745"></a>If one compares the culture of the
      telecommunications industry to that of the Internet, it is sometimes
      difficult to believe the two are related. The technology of the Internet
      was designed in large part by academics and enthusiasts, whereas
      contributing to the development of the PSTN is impossible for any
      individual to contemplate. This is an exclusive club; membership is not
      open to just anyone.<sup>[<a id="asterisk-CHP-11-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-1" class="footnote">180</a>]</sup></p><p><a id="FutureTelephony_id303367"></a>Although the ITU is the United
      Nations’s sanctioned body responsible for international
      telecommunications, many of the VoIP protocols (SIP, MGCP, RTP, STUN)
      come not from the ITU, but rather from the IETF (which publishes all of
      its standards free to all, and allows anyone to submit an Internet Draft
      for consideration).</p><p><a id="FutureTelephony_id306999"></a>Open protocols such as SIP may have
      a tactical advantage over ITU protocols such as H.323 due to the ease
      with which one can obtain them.<sup>[<a id="id665126" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id665126" class="footnote">181</a>]</sup> Although H.323 is widely deployed by carriers as a VoIP
      protocol in the backbone, it is much more difficult to find H.323-based
      endpoints; newer products are far more likely to support SIP.</p><p><a id="FutureTelephony_id307013"></a>The success of the IETF’s open
      approach has not gone unnoticed by the ITU. Since the first edition of
      this book, the ITU has made all of the ITU-T and ITU-R recommendations
      available as free downloads in PDF form from its website (<a class="ulink" href="http://www.itu.int/" target="_top">http://www.itu.int</a>).</p><p><a id="FutureTelephony_id269206"></a>As for Asterisk, it embraces both
      the past and the future—H.323 support is available, although the
      community has for the most part shunned H.323 in favor of the IETF
      protocol SIP and the darling of the Asterisk community, IAX.</p></div><div class="sect2" title="Limited Standards Compliancy"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-1.2"></a>Limited Standards Compliancy</h3></div></div></div><p><a id="FutureTelephony_id303743"></a><a id="I_indexterm27_d1e55688" class="indexterm"></a>One of the oddest things about all the standards that
      exist in the world of legacy telecommunications is the various
      manufacturers’ seeming inability to implement them consistently. Each
      manufacturer desires a total monopoly, so the concept of
      interoperability tends to take a back seat to being first to market with
      a creative new idea.</p><p><a id="FutureTelephony_id303749"></a>The ISDN protocols are a classic
      example of this. Deployment of ISDN was (and in many ways still is) a
      painful and expensive proposition, as each manufacturer decided to
      implement it in a slightly different way. ISDN could very well have
      helped to usher in a massive public data network, 10 years before the
      Internet. Unfortunately, due to its cost, complexity, and compatibility
      issues, ISDN never delivered much more than voice, with the occasional
      video or data connection for those willing to pay. ISDN is quite common
      (especially in Europe, and in North America in larger PBX
      implementations), but it is not delivering anywhere near the
      capabilities that were envisioned <span class="keep-together">for
      it</span>.</p><p><a id="FutureTelephony_id303758"></a>As VoIP becomes more and more
      ubiquitous, the need for ISDN will disappear.</p></div><div class="sect2" title="Slow Release Cycles"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-1.3"></a>Slow Release Cycles</h3></div></div></div><p><a id="FutureTelephony_id346281"></a><a id="I_indexterm27_d1e55705" class="indexterm"></a>It can take months, or sometimes years, for the big guys
      to admit to a trend, let alone release a product that is compatible with
      it. It seems that before a new technology can be embraced, it must be
      analyzed to death, and then it must pass successfully through various
      layers of bureaucracy before it is even scheduled into the development
      cycle. Months or even years must pass before any useful product can be
      expected. When those products are finally released, they are often based
      on hardware that is obsolete; they also tend to be expensive and to
      offer no more than a minimal feature set.</p><p><a id="FutureTelephony_id346295"></a>These slow release cycles simply
      don’t work in today’s world of business communications. On the Internet,
      new ideas can take root in a matter of weeks and become viable in
      extremely short periods of time. Since every other technology must adapt
      to these changes, so too must telecommunications.</p><p><a id="FutureTelephony_id315414"></a>Open source development is
      inherently better able to adapt to rapid technological change, which
      gives it an enormous competitive advantage.</p><p><a id="FutureTelephony_id332284"></a>The spectacular crash of the telecom
      industry may have been caused in large part by an inability to change.
      Perhaps that continued inability is why recovery has been so slow. Now,
      there is no choice: change, or cease to be. Community-driven
      technologies such as Asterisk are seeing to that.</p></div><div class="sect2" title="Refusing to Let Go of the Past and Embrace the Future"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-1.4"></a>Refusing to Let Go of the Past and Embrace the Future</h3></div></div></div><p><a id="FutureTelephony_id337248"></a>Traditional telecommunications
      companies have lost touch with their customers. While the concept of
      adding functionality beyond the basic telephone is well understood, the
      idea that the user should be the one defining this functionality is
      not.</p><p><a id="FutureTelephony_id295266"></a>Nowadays, people have nearly
      limitless flexibility in every other form of communication. They simply
      cannot understand why telecommunications cannot be delivered as flexibly
      as the industry has been promising for so many years. The concept of
      flexibility is not familiar to the telecom industry, and very well might
      not be until open source products such as Asterisk begin to transform
      the fundamental nature of the industry. This is a revolution similar to
      the one Linux and the Internet willingly started over 10 years ago (and
      IBM unwittingly started with the PC, 15 years before that). What is this
      revolution? The commoditization of telephony hardware and software,
      enabling a proliferation of tailor-made telecommunications
      systems.</p></div></div><div class="sect1" title="Paradigm Shift"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-11-SECT-2"></a>Paradigm Shift</h2></div></div></div><p><a id="FutureTelephony_id303207"></a><a id="I_indexterm27_d1e55726" class="indexterm"></a><a id="I_indexterm27_d1e55729" class="indexterm"></a>In his article “Paradigm Shift” (<a class="ulink" href="http://tim.oreilly.com/articles/paradigmshift_0504.html" target="_top">http://tim.oreilly.com/articles/paradigmshift_0504.html</a>),
    Tim O’Reilly talks about a paradigm shift that is occurring in the way
    technology (both hardware and software) is delivered.<sup>[<a id="asterisk-CHP-11-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-4" class="footnote">182</a>]</sup> O’Reilly identifies three trends: <span class="emphasis"><em>the
    commoditization of software</em></span>, <span class="emphasis"><em>network-enabled
    collaboration</em></span>, and <span class="emphasis"><em>software customizability (software
    as a service)</em></span>. These three concepts provide evidence to suggest
    that open source telephony is an idea whose time has come.</p></div><div class="sect1" title="The Promise of Open Source Telephony"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-11-SECT-3"></a>The Promise of Open Source Telephony</h2></div></div></div><div class="blockquote"><a id="FutureTelephony_id323673"></a><blockquote class="blockquote"><p>Every good work of software starts
      by scratching a developer’s personal itch.</p><p>—Eric S. Raymond, <span class="emphasis"><em>The
      Cathedral and the Bazaar</em></span></p></blockquote></div><p><a id="FutureTelephony_id323685"></a><a id="index-052N651WV1U" class="indexterm"></a><a id="index-013E002LU7D" class="indexterm"></a>In his book <span class="emphasis"><em><a class="ulink" href="http://oreilly.com/catalog/9780596001087/" target="_top">The Cathedral and the
    Bazaar</a></em></span> (O’Reilly), Eric S. Raymond explains that “Given
    enough eyeballs, all bugs are shallow.” The reason open source software
    development produces such consistent quality is simple: crap can’t
    hide.</p><div class="sect2" title="The Itch That Asterisk Scratches"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.1"></a>The Itch That Asterisk Scratches</h3></div></div></div><p><a id="FutureTelephony_id333158"></a><a id="I_indexterm27_d1e55779" class="indexterm"></a><a id="I_indexterm27_d1e55786" class="indexterm"></a>In this era of custom database and website development,
      people are not only tired of hearing that their telephone system “can’t
      do that,” but quite frankly just don’t believe it. The creative needs of
      the customers, coupled with the limitations of the technology, have
      spawned a type of creativity born of necessity: telecom engineers are
      like contestants in an episode of <span class="emphasis"><em>Junkyard Wars</em></span>,
      trying to create functional devices out of a pile of mismatched
      components.</p><p><a id="FutureTelephony_id333166"></a>The development methodology of a
      proprietary telephone system dictates that it will have a huge number of
      features, and that the number of features will in large part determine
      the price. Manufacturers will tell you that their products give you
      hundreds of features, but if you only need five of them, who cares?
      Worse, if there’s one missing feature you really can’t do without, the
      value of that system will be diluted by the fact that it can’t
      completely address your needs.</p><p><a id="FutureTelephony_id333173"></a>The fact that a customer might only
      need five out of five hundred features is ignored, and that customer’s
      desire to have five unavailable features that address the needs of his
      business is dismissed as unreasonable.<sup>[<a id="asterisk-CHP-11-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-5" class="footnote">183</a>]</sup> Until flexibility becomes standard, telecom will remain
      stuck in the last century—all the VoIP in the world
      notwithstanding.</p><p><a id="FutureTelephony_id312884"></a>Asterisk addresses that problem
      directly, and solves it in a way that few other telecom systems can.
      This is extremely disruptive technology, in large part because it is
      based on concepts that have been proven time and time again: “the
      closed-source world cannot win an evolutionary arms race with
      open-source communities that can put orders of magnitude more skilled
      time into a problem.”<sup>[<a id="asterisk-CHP-11-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-6" class="footnote">184</a>]</sup></p></div><div class="sect2" title="Open Architecture"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.2"></a>Open Architecture</h3></div></div></div><p><a id="FutureTelephony_id321984"></a><a id="I_indexterm27_d1e55819" class="indexterm"></a><a id="I_indexterm27_d1e55826" class="indexterm"></a><a id="I_indexterm27_d1e55831" class="indexterm"></a>One of the stumbling blocks of the traditional
      telecommunications industry has been its apparent refusal to cooperate
      with itself. The big telecommunications giants have all been around for
      over a hundred years. The concept of closed, proprietary systems is so
      ingrained in their culture that even their attempts at standards
      compliancy are tainted by their desire to get the jump on the
      competition, by adding that one feature that no one else supports. For
      an example of this thinking, one simply has to look at the VoIP products
      being offered by the telecom industry today. While they claim standards
      compliance, the thought that you would actually expect to be able to
      connect a Cisco phone to a Nortel switch, or that an Avaya voicemail
      system could be integrated via IP to a Siemens PBX, is not one that
      bears discussing.</p><p><a id="FutureTelephony_id324726"></a>In the computer industry, things are
      different. Twenty years ago, if you bought an IBM server, you needed an
      IBM network and IBM terminals to talk to it. Now, that IBM server is
      likely to interconnect to Dell terminals though a Cisco network (and run
      Linux, of all things). Anyone can easily think of thousands of
      variations on this theme. If any one of these companies were to suggest
      that we could only use their products with whatever they told us, they
      would be laughed out of business.</p><p><a id="FutureTelephony_id324729"></a>The telecommunications industry is
      facing the same changes, but it’s in no hurry to accept them. Asterisk,
      on the other hand, is in a big hurry to not only accept change, but
      embrace it.</p><p><a id="FutureTelephony_id324734"></a>Cisco, Nortel, Avaya, and Polycom IP
      phones (to name just a few) have all been successfully connected to
      Asterisk systems. There is no other PBX in the world today that can make
      this claim. None.<span class="emphasis"><em> Openness is the power of
      Asterisk</em></span>.</p></div><div class="sect2" title="Standards Compliance"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.3"></a>Standards Compliance</h3></div></div></div><p><a id="FutureTelephony_id336950"></a><a id="I_indexterm27_d1e55848" class="indexterm"></a><a id="I_indexterm27_d1e55855" class="indexterm"></a><a id="I_indexterm27_d1e55860" class="indexterm"></a>In the past few years, it has become clear that standards
      evolve at such a rapid pace that to keep up with them requires an
      ability to quickly respond to emerging technology trends. Asterisk, by
      virtue of being an open source, community-driven development effort, is
      uniquely suited to the kind of rapid development that standards
      compliance demands.</p><p><a id="FutureTelephony_id314768"></a>Asterisk does not focus on
      cost-benefit analysis or market research. It evolves in response to
      whatever the community finds exciting—or necessary.</p></div><div class="sect2" title="Lightning-Fast Response to New Technologies"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.4"></a>Lightning-Fast Response to New Technologies</h3></div></div></div><p><a id="FutureTelephony_id314784"></a><a id="I_indexterm27_d1e55872" class="indexterm"></a><a id="I_indexterm27_d1e55879" class="indexterm"></a>After Mark Spencer attended his first SIP Interoperability
      Test (SIPIT) event, he had a rudimentary but working SIP stack for
      Asterisk coded within a few days. This was before SIP had emerged as the
      protocol of choice in the VoIP world, but he saw its value and momentum
      and ensured that Asterisk would be ready.</p><p><a id="FutureTelephony_id328504"></a>This kind of foresight and
      flexibility is typical in an open-source development community (and very
      unusual in a large corporation).</p></div><div class="sect2" title="Passionate Community"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.5"></a>Passionate Community</h3></div></div></div><p><a id="FutureTelephony_id328519"></a><a id="I_indexterm27_d1e55891" class="indexterm"></a><a id="I_indexterm27_d1e55898" class="indexterm"></a>The <span class="emphasis"><em>Asterisk-Users</em></span> list receives over
      three hundred email messages per day. Over ten thousand people are
      subscribed to it. This kind of community support is unheard of in the
      world of proprietary telecommunications, while in the open source world
      it is commonplace.</p><p><a id="FutureTelephony_id334799"></a>The very first AstriCon event was
      expected to attract one hundred participants. Nearly five hundred showed
      up (far more wanted to but couldn’t attend). This kind of community
      support virtually guarantees the success of an open source
      effort.</p></div><div class="sect2" title="Some Things That Are Now Possible"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-3.6"></a>Some Things That Are Now Possible</h3></div></div></div><p><a id="FutureTelephony_id343153"></a>So what sorts of things can be built
      using Asterisk? Let’s look at some of the things we’ve come up
      with.</p><div class="sect3" title="Legacy PBX migration gateway"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-3.6.1"></a>Legacy PBX migration gateway</h4></div></div></div><p><a id="FutureTelephony_id332761"></a><a id="I_indexterm27_d1e55918" class="indexterm"></a><a id="I_indexterm27_d1e55925" class="indexterm"></a><a id="I_indexterm27_d1e55930" class="indexterm"></a>Asterisk can be used as a fantastic bridge between an
        old PBX and the future. You can place it in front of the PBX as a
        gateway (and migrate users off the PBX as needs dictate), or you can
        put it behind the PBX as a peripheral application server. You can even
        do both at the same time, as shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-1" title="Figure 27.1. Asterisk as a PBX gateway">Figure&nbsp;27.1, “Asterisk as a PBX gateway”</a>.</p><div class="figure"><a id="asterisk-CHP-11-FIG-1"></a><p class="title"><strong>Figure&nbsp;27.1.&nbsp;Asterisk as a PBX gateway</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject27_d1e55939"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2701.png" alt="Asterisk as a PBX gateway"></div></div></div><br class="figure-break"><p><a id="FutureTelephony_id338863"></a>Here are some of the options you
        can implement:</p><div class="variablelist"><dl><dt><span class="term">
              <span class="emphasis"><em>Keep your old PBX, but evolve to
            IP</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id338357"></a><a id="FutureTelephony_id338359"></a>Companies that have spent
              vast sums of money in the past few years buying proprietary PBX
              equipment want a way out of proprietary jail, but they can’t
              stomach the thought of throwing away all of their otherwise
              functioning equipment. No problem—Asterisk can solve all kinds
              of problems, from replacing a voicemail system to providing a
              way to add IP-based users beyond the nominal capacity of the
              system.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Find-me-follow-me</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id344528"></a><a id="FutureTelephony_id344530"></a>Provide the PBX a list of
              numbers where you can be reached, and it will ring them all
              whenever a call to your DID (Direct Inward Dialing, a.k.a.
              phone) number arrives. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-2" title="Figure 27.2. Find-me-follow-me">Figure&nbsp;27.2, “Find-me-follow-me”</a>
              illustrates this technology.</p></dd><dt><span class="term">
              <span class="emphasis"><em>VoIP calling</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id321197"></a><a id="FutureTelephony_id321199"></a>If a legacy telephony
              connection from an Asterisk PBX to an old PBX can be
              established, Asterisk can provide access to VoIP services, while
              the old PBX continues to connect to the outside world as it
              always has. As a gateway, Asterisk simply needs to emulate the
              functions of the PSTN, and the old PBX won’t know that anything
              has changed. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FIG-3" title="Figure 27.3. VoIP-enabling a legacy PBX">Figure&nbsp;27.3, “VoIP-enabling a legacy PBX”</a> shows how
              you can use Asterisk to VoIP-enable a legacy PBX.</p></dd></dl></div><div class="figure"><a id="asterisk-CHP-11-FIG-2"></a><p class="title"><strong>Figure&nbsp;27.2.&nbsp;Find-me-follow-me</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject27_d1e55976"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2702.png" alt="Find-me-follow-me"></div></div></div><br class="figure-break"><div class="figure"><a id="asterisk-CHP-11-FIG-3"></a><p class="title"><strong>Figure&nbsp;27.3.&nbsp;VoIP-enabling a legacy PBX</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject27_d1e55984"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_2703.png" alt="VoIP-enabling a legacy PBX"></div></div></div><br class="figure-break"></div><div class="sect3" title="Low-barrier IVR"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-3.6.2"></a>Low-barrier IVR</h4></div></div></div><p><a id="FutureTelephony_id331068"></a><a id="I_indexterm27_d1e55993" class="indexterm"></a><a id="I_indexterm27_d1e56000" class="indexterm"></a><a id="I_indexterm27_d1e56005" class="indexterm"></a>Many people confuse Interactive Voice Response (IVR)
        systems with automated attendants (AAs). Since the automated attendant
        was the very first thing IVR was used for, this is understandable.
        Nevertheless, to the telecom industry, the term IVR represents far
        more than an AA. An AA generally does little more than present a way
        for callers to be transferred to extensions, and it is built into most
        proprietary voicemail systems—but IVR can be so much more.</p><p><a id="FutureTelephony_id331080"></a>IVR systems are generally very
        expensive, not only to purchase, but also to configure. A custom IVR
        system will usually require connectivity to an external database or
        application. Asterisk is arguably the perfect IVR, as it embraces the
        concepts of connectivity to databases and applications at its deepest
        level.</p><p><a id="FutureTelephony_id331086"></a>Here are a few examples of
        relatively simple IVRs an Asterisk system could be used to
        create:</p><div class="variablelist"><dl><dt><span class="term">
              <span class="emphasis"><em>Weather reporting</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id300967"></a><a id="FutureTelephony_id300969"></a><a id="I_indexterm27_d1e56021" class="indexterm"></a>Using the Internet, you can obtain text-based
              weather reports from around the world in a myriad of ways.
              Capturing these reports and running them through a purpose-built
              parser (Perl would probably eat this up) would allow the
              information to be available to the dialplan. Asterisk’s sound
              library already contains all the required prompts, so it would
              not be an onerous task to produce an interactive menu to play
              current forecasts for anywhere in the world.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Math programs</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id303914"></a><a id="FutureTelephony_id303916"></a><a id="I_indexterm27_d1e56031" class="indexterm"></a>Ed Guy (the architect of Pulver’s FWD network) did
              a presentation at AstriCon 2004 in which he talked about a
              little math program he’d cooked up for his daughter to use. The
              program took him no more than an hour to write. What it did was
              present her with a number of math questions, the answers to
              which she keyed into the telephone. When all the questions were
              tabulated, the system presented her with her score. This
              extremely simple Asterisk application would cost tens of
              thousands of dollars to implement on any closed PBX platform,
              assuming it could be done at all. As is so often the case,
              things that are simple for Asterisk would be either impossible
              or massively expensive with any other IVR system.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Distributed IVR</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id344577"></a><a id="FutureTelephony_id344579"></a><a id="I_indexterm27_d1e56041" class="indexterm"></a>The cost of a proprietary IVR system is such that
              when a company with many small retail locations wants to provide
              IVR, it is forced to transfer callers to a central server to
              process the transactions. With Asterisk, it becomes possible to
              distribute the application to each node, and thus handle the
              requests locally. Literally thousands of little Asterisk systems
              deployed at retail locations across the world could serve up IVR
              functionality in a way that would be impossible to achieve with
              any other system. No more long-distance transfers to a central
              IVR server, no more huge trunking facility dedicated to the
              task—more power with less expense.</p></dd></dl></div><p><a id="FutureTelephony_id337410"></a>These are three rather simple
        examples of the potential of Asterisk.</p></div><div class="sect3" title="Conference rooms"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-3.6.3"></a>Conference rooms</h4></div></div></div><p><a id="FutureTelephony_id324766"></a><a id="I_indexterm27_d1e56051" class="indexterm"></a><a id="I_indexterm27_d1e56058" class="indexterm"></a><a id="I_indexterm27_d1e56063" class="indexterm"></a>This little gem is going to end up being one of the
        killer functions of Asterisk. In the Asterisk community, people find
        themselves using conference rooms more and more, for purposes such as
        these:</p><div class="itemizedlist"><a id="FutureTelephony_id336018"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="FutureTelephony_id336020"></a><a id="FutureTelephony_id336022"></a>Small companies need an easy
            way for business partners to get together for a chat.</p></li><li class="listitem"><p><a id="FutureTelephony_id336026"></a><a id="FutureTelephony_id336028"></a>Sales teams want to have
            weekly meetings where reps can dial in from wherever they
            are.</p></li><li class="listitem"><p><a id="FutureTelephony_id336034"></a><a id="FutureTelephony_id336036"></a>Development teams need to
            designate a common place and time to update each other on
            progress.</p></li></ul></div></div><div class="sect3" title="Home automation"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-3.6.4"></a>Home automation</h4></div></div></div><p><a id="FutureTelephony_id325107"></a><a id="I_indexterm27_d1e56081" class="indexterm"></a><a id="I_indexterm27_d1e56088" class="indexterm"></a><a id="I_indexterm27_d1e56093" class="indexterm"></a>Asterisk is still too much of an über-geek’s tool to be
        able to serve in the average home, but with no more than average Linux
        and Asterisk skills, the following things become plausible:</p><div class="variablelist"><dl><dt><span class="term">
              <span class="emphasis"><em>Monitoring the kids</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id343967"></a><a id="FutureTelephony_id343969"></a><a id="I_indexterm27_d1e56104" class="indexterm"></a>Parents who want to check up on the babysitter (or
              the kids home alone) could dial an extension context protected
              by a password. Once authenticated, a two-way audio connection
              would be created to all the IP phones in the house, allowing Mom
              and Dad to listen for trouble. Creepy? Yes. But an interesting
              concept nonetheless.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Locking down your phones</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id343984"></a><a id="FutureTelephony_id343986"></a><a id="I_indexterm27_d1e56114" class="indexterm"></a>Going out for the night? Don’t want the babysitter
              tying up the phone? No problem! A simple tweak to the dialplan,
              and the only calls that can be made are to 911, your cell phone,
              and the pizza parlor. Any other call attempt will get the
              recording “We are paying you to babysit our kids, not make
              personal calls.”</p><p><a id="FutureTelephony_id347742"></a>Pretty evil, huh?</p></dd><dt><span class="term">
              <span class="emphasis"><em>Controlling the alarm system</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id347755"></a><a id="FutureTelephony_id347757"></a><a id="I_indexterm27_d1e56128" class="indexterm"></a>You get a call while on vacation from your mom who
              wants to borrow some cooking utensils. She forgot her key, and
              is standing in front of the house shivering. Piece of cake: a
              call to your Asterisk system, a quick digit string into the
              context you created for the purpose, and your alarm system is
              instructed to disable the alarm for 15 minutes. Mom better get
              her stuff and get out quick, though, or the cops’ll be showing
              up!</p></dd><dt><span class="term">
              <span class="emphasis"><em>Managing teenagers’ calls</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id318628"></a><a id="FutureTelephony_id318630"></a><a id="I_indexterm27_d1e56138" class="indexterm"></a>How about allocating a specific phone-time limit
              to your teenagers? To use the phone, they have to enter their
              access codes. They can earn extra minutes by doing chores,
              scoring all As, dumping that annoying bum with the bad
              haircut—you get the idea. Once they’ve used up their
              minutes…click…you get your phone back.</p><p><a id="FutureTelephony_id318640"></a>Incoming calls can be
              managed as well, via caller ID. “Donny, this is Suzy’s father.
              She is no longer interested in seeing you, as she has decided to
              raise her standards a bit. Also, you should consider getting a
              haircut.”<a id="I_indexterm27_d1e56144" class="indexterm"></a><a id="I_indexterm27_d1e56145" class="indexterm"></a></p></dd></dl></div></div></div></div><div class="sect1" title="The Future of Asterisk"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-CHP-11-SECT-4"></a>The Future of Asterisk</h2></div></div></div><p><a id="FutureTelephony_id312695"></a><a id="index-375P540VS6Q" class="indexterm"></a>We’ve come to love the Internet, both because it is so rich
    in content and inexpensive and, perhaps more importantly, because it
    allows us to define how we communicate. As its ability to carry richer
    forms of media advances, we’ll find ourselves using it more and more. Once
    Internet voice delivers quality that rivals (or betters) the capabilities
    of the PSTN, the phone company had better look for another line of
    business. The PSTN will cease to exist; all its complexity will be
    absorbed into the Internet, as just one more technology. As with most of
    the rest of the Internet, open source technologies will lead this
    transformation.</p><div class="sect2" title="Speech Processing"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.1"></a>Speech Processing</h3></div></div></div><p><a id="FutureTelephony_id311560"></a><a id="I_indexterm27_d1e56160" class="indexterm"></a><a id="I_indexterm27_d1e56167" class="indexterm"></a>The dream of having our technical inventions talk to us is
      older than the telephone itself. Each new advance in technology spurs a
      new wave of eager experimentation. Generally, results never quite meet
      expectations, possibly because as soon as a machine says something that
      <span class="emphasis"><em>sounds</em></span> intelligent, most people assume that it
      <span class="emphasis"><em>is</em></span> intelligent.</p><p><a id="FutureTelephony_id311572"></a>People who program and maintain
      computers realize their limitations, and thus tend to allow for their
      weaknesses. Everybody else just expects their computers and software to
      work. The amount of thinking a user must do to interact with a computer
      is often inversely proportional to the amount of thinking the design
      team did. Simple interfaces belie complex design decisions.</p><p><a id="FutureTelephony_id311578"></a>The challenge, therefore, is to
      design a system that has anticipated the most common desires of its
      users, and can also adroitly handle unexpected challenges.</p><div class="sect3" title="Festival"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.1.1"></a>Festival</h4></div></div></div><p><a id="FutureTelephony_id268704"></a><a id="I_indexterm27_d1e56185" class="indexterm"></a><a id="I_indexterm27_d1e56188" class="indexterm"></a>The Festival text-to-speech server can transform text
        into spoken words. While this is a whole lot of fun to play with,
        there are many challenges to overcome (for more on integrating
        Festival with Asterisk, refer back to <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291618" title="Text-to-Speech Utilities">the section called “Text-to-Speech Utilities”</a>).</p><p><a id="FutureTelephony_id268709"></a>For Asterisk, an obvious value of
        text-to-speech might be the ability to have your telephone system read
        your emails back to you. If you’ve noticed the somewhat poor grammar,
        punctuation, and spelling typically found in email messages these
        days, you can perhaps appreciate the challenges this poses.</p><p><a id="FutureTelephony_id345263"></a>One cannot help but wonder if the
        emergence of text-to-speech will inspire a new generation of people
        dedicated to proper writing. Seeing spelling and punctuation errors on
        the screen is frustrating enough—having to hear a computer speak such
        things will require a level of Zazen that few possess.</p></div><div class="sect3" title="Speech recognition"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.1.2"></a>Speech recognition</h4></div></div></div><p><a id="FutureTelephony_id340416"></a><a id="I_indexterm27_d1e56204" class="indexterm"></a>If text-to-speech is rocket science, speech recognition
        is science fiction.</p><p><a id="FutureTelephony_id340431"></a>Speech recognition can actually
        work very well, but unfortunately this is generally true only if you
        provide it with the right conditions—and the right conditions are not
        those found on a telephone network. Even a perfect PSTN connection is
        considered to be at the lowest acceptable limit for accurate speech
        recognition. Add in compressed and lossy VoIP connections, or a cell
        phone, and you will discover far more limitations <span class="keep-together">than uses</span>.</p><p><a id="FutureTelephony_id340434"></a>Asterisk now has an entire speech
        API, so that outside companies (or even open source projects) can tie
        their speech recognition engines into Asterisk. One company that has
        done this is LumenVox. By using LumenVox’s speech recognition engine
        along with Asterisk, you can make voice-driven menus and IVR systems
        in record time! For more information, see <a class="ulink" href="http://www.lumenvox.com/" target="_top">http://www.lumenvox.com</a>.</p></div></div><div class="sect2" title="High-Fidelity Voice"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.2"></a>High-Fidelity Voice</h3></div></div></div><p><a id="FutureTelephony_id326574"></a><a id="I_indexterm27_d1e56223" class="indexterm"></a><a id="I_indexterm27_d1e56230" class="indexterm"></a>As we gain access to more and more bandwidth, it becomes
      less and less easy to understand why we still use low-fidelity codecs.
      Many people do not realize that Skype provides higher fidelity than a
      telephone; it’s a large part of the reason why Skype has a reputation
      for sounding so good.</p><p><a id="FutureTelephony_id340489"></a>If you were ever to phone CNN,
      wouldn’t you love to hear James Earl Jones’s mellifluous voice saying
      “This is CNN,” instead of some tinny electronic recording? And if you
      think Allison Smith<sup>[<a id="asterisk-CHP-11-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-8" class="footnote">185</a>]</sup> sounds good through the phone, you should hear her in
      <span class="keep-together">person</span>!</p><p><a id="FutureTelephony_id340510"></a>In the future, we will expect, and
      get, high-fidelity voice through our communications equipment.</p><p><a id="FutureTelephony_id316037"></a>As more and more hardware vendors
      start building support for high-fidelity voice into their VoIP hardware,
      you’ll see more support in Asterisk for making better-than-PSTN-quality
      calls.</p></div><div class="sect2" title="Video"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.3"></a>Video</h3></div></div></div><p><a id="FutureTelephony_id302651"></a><a id="I_indexterm27_d1e56253" class="indexterm"></a><a id="I_indexterm27_d1e56260" class="indexterm"></a>While most of this book focuses on audio, video is also
      supported in many ways within Asterisk. Video support is not complete,
      however. The problem is not so much one of functionality as one of
      bandwidth and processing power. Asterisk 1.10 is expected to contain
      better support for handling media, including video.</p><div class="sect3" title="The challenge of videoconferencing"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.3.1"></a>The challenge of videoconferencing</h4></div></div></div><p><a id="FutureTelephony_id331719"></a><a id="I_indexterm27_d1e56268" class="indexterm"></a>The concept of videoconferencing has been around since
        the invention of the cathode ray tube. The telecom industry has been
        promising a videoconferencing device in every home for decades.</p><p><a id="FutureTelephony_id346860"></a>As with so many other
        communications technologies, if you have videoconferencing in your
        house, you are probably running it over the Internet, with a simple,
        inexpensive webcam. Still, it seems that people see videoconferencing
        as a bit gimmicky. Yes, you can see the person you’re talking to, but
        there’s something missing.</p></div><div class="sect3" title="Why we love videoconferencing"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.3.2"></a>Why we love videoconferencing</h4></div></div></div><p><a id="FutureTelephony_id346877"></a>Videoconferencing promises a
        richer communications experience than the telephone. Rather than
        simply hearing a disembodied voice, you have access to all the nuances
        of speech that come from face-to-face communication.</p></div><div class="sect3" title="Why videoconferencing may never totally replace voice"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.3.3"></a>Why videoconferencing may never totally replace voice</h4></div></div></div><p><a id="FutureTelephony_id324395"></a>There are some challenges to
        overcome, though, and not all of them are technical.</p><p><a id="FutureTelephony_id324399"></a>Consider this: using a plain
        telephone, people working from their home offices can have business
        conversations, unshowered, in their underwear, feet on the desk,
        coffee in hand—if they use a telephone. A similar video conversation
        would require half an hour of grooming to prepare for, and couldn’t
        happen in the kitchen, on the patio, or…well, you get the idea.</p><p><a id="FutureTelephony_id324410"></a>Also, the promise of eye-to-eye
        communication over video will never happen as long as the focal points
        of the participants are not in line with the cameras. If you look at
        the camera, your audience will see you looking at them, but you won’t
        see them. If you look at your screen to see whom you are talking to,
        the camera will show you looking down at something—not at your
        audience. That looks impersonal. Perhaps if a videophone could be
        designed like a Tele-Prompt-R, where the camera was behind the screen,
        it wouldn’t feel so unnatural. As it stands, there’s something
        psychological that’s missing. Video ends up being a gimmick.</p></div></div><div class="sect2" title="Wireless"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.4"></a>Wireless</h3></div></div></div><p><a id="FutureTelephony_id307442"></a><a id="I_indexterm27_d1e56292" class="indexterm"></a><a id="I_indexterm27_d1e56299" class="indexterm"></a>Since Asterisk is fully VoIP-enabled, wireless is all part
      of the package.</p><div class="sect3" title="WiFi"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.4.1"></a>WiFi</h4></div></div></div><p><a id="FutureTelephony_id300767"></a><a id="I_indexterm27_d1e56307" class="indexterm"></a>WiFi is going to be the office mobility solution for
        VoIP phones. This technology is already quite mature. The biggest
        hurdle is the cost of handsets, which can be expected to improve as
        competitive pressure from around the world drives down prices.</p></div><div class="sect3" title="WiMAX"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.4.2"></a>WiMAX</h4></div></div></div><p><a id="FutureTelephony_id316356"></a><a id="I_indexterm27_d1e56315" class="indexterm"></a>Since we are so bravely predicting so many things, it’s
        not hard to predict that WiMAX spells the beginning of the end for
        traditional cellular telephone networks.</p><p><a id="FutureTelephony_id316361"></a>With wireless Internet access
        within the reach of most communities, what value will there be in
        expensive cellular service?</p></div></div><div class="sect2" title="Unified Messaging"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.5"></a>Unified Messaging</h3></div></div></div><p><a id="FutureTelephony_id338808"></a><a id="I_indexterm27_d1e56326" class="indexterm"></a><a id="I_indexterm27_d1e56333" class="indexterm"></a><a id="I_indexterm27_d1e56336" class="indexterm"></a>This is a term that has been hyped by the telecom industry
      for years, but adoption has been far slower than predicted.</p><p><a id="FutureTelephony_id338813"></a>Unified messaging refers to the
      concept of tying voice and text-messaging systems into one. With
      Asterisk, the two don’t need to be artificially combined, as Asterisk
      already treats them the same way.</p><p><a id="FutureTelephony_id338818"></a>Just by examining the terms,
      <span class="emphasis"><em>unified</em></span> and <span class="emphasis"><em>messaging</em></span>, we can
      see that the integration of email and voicemail must be merely the
      beginning—unified messaging needs to do a lot more than just that if it
      is to deserve its name.</p><p><a id="FutureTelephony_id310642"></a>Perhaps we need to define
      “messaging” as communication that does not occur in real time. In other
      words, when you send a message, you expect that the reply may take
      moments, minutes, hours, or even days to arrive. You compose what you
      wish to say, and your audience is expected to compose a reply.</p><p><a id="FutureTelephony_id310648"></a>Contrast this with conversing, which
      happens in real time. When you talk to someone on a telephone
      connection, you expect no more than a few seconds’ delay before the
      response arrives.</p><p><a id="FutureTelephony_id310653"></a>Several years ago, Tim O’Reilly
      delivered a speech entitled “Watching the Alpha Geeks: OS X and the Next
      Big Thing” (<a class="ulink" href="http://www.macdevcenter.com/pub/a/mac/2002/05/14/oreilly_wwdc_keynote.html" target="_top">http://www.macdevcenter.com/pub/a/mac/2002/05/14/oreilly_wwdc_keynote.html</a>),
      in which he talked about someone piping IRC through a text-to-speech
      engine. One could imagine doing the reverse as well, allowing us to join
      an IRC or instant messaging chat over a WiFi phone, with our Asterisk
      PBX providing the speech-to-text-to-speech translations.</p></div><div class="sect2" title="Peering"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.6"></a>Peering</h3></div></div></div><p><a id="FutureTelephony_id301681"></a><a id="I_indexterm27_d1e56362" class="indexterm"></a><a id="I_indexterm27_d1e56369" class="indexterm"></a>As monopoly networks such as the PSTN give way to
      community-based networks like the Internet, there will be a period of
      time where it is necessary to interconnect the two. While the
      traditional providers would prefer that the existing model be carried
      into the new paradigm, it is increasingly likely that telephone calls
      will become little more than another application the Internet happily
      carries.</p><p><a id="FutureTelephony_id301688"></a>But a challenge remains: how to
      manage the telephone numbering plan with which we are all familiar and
      comfortable?</p><div class="sect3" title="E.164"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.6.1"></a>E.164</h4></div></div></div><p><a id="FutureTelephony_id308164"></a><a id="I_indexterm27_d1e56379" class="indexterm"></a>The ITU defined a numbering plan in its E.164
        specification. If you’ve used a telephone to make a call across the
        PSTN, you can confidently state that you are familiar with the concept
        of E.164 numbering. Prior to the advent of publicly available VoIP,
        nobody cared about E.164 except the telephone companies—nobody needed
        to.</p><p><a id="FutureTelephony_id268196"></a>Now that calls are hopping from
        PSTN to Internet to who-knows-what, some consideration must be given
        to E.164.</p></div><div class="sect3" title="ENUM"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.6.2"></a>ENUM</h4></div></div></div><p><a id="FutureTelephony_id268210"></a><a id="I_indexterm27_d1e56389" class="indexterm"></a>In response to this challenge, the IETF has sponsored
        the Electronic NUmber Mapping (ENUM) working group, the purpose of
        which is to map E.164 numbers into the Domain Name System
        (DNS).</p><p><a id="FutureTelephony_id268215"></a>While the concept of ENUM is
        sound, it requires cooperation from the telecom industry to achieve
        success. However, cooperation is not what the telecom industry is
        famous for, and thus far ENUM has foundered.</p></div><div class="sect3" title="e164.org"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.6.3"></a>e164.org</h4></div></div></div><p><a id="FutureTelephony_id340692"></a><a id="I_indexterm27_d1e56399" class="indexterm"></a>The folks at <a class="ulink" href="http://e164.org/" target="_top">http://e164.org</a> are
        trying to contribute to the success of ENUM. You can log onto this
        site, register your phone number, and inform the system of alternative
        methods of communicating with you. This means that someone who knows
        your phone number can connect a VoIP call to you, as the <a class="ulink" href="http://e164.org/" target="_top">http://e164.org</a> DNS zone will provide the IP addressing
        and protocol information needed to connect to your location.</p><p><a id="FutureTelephony_id317065"></a>As more and more people publish
        VoIP connectivity information, fewer and fewer calls will be connected
        through the PSTN.</p></div></div><div class="sect2" title="Challenges"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.7"></a>Challenges</h3></div></div></div><p><a id="FutureTelephony_id321012"></a>As is true with any worthwhile
      thing, Asterisk will face challenges. Let’s take a glance at what some
      of them may be.</p><div class="sect3" title="Too much change, too few standards"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.1"></a>Too much change, too few standards</h4></div></div></div><p><a id="FutureTelephony_id337966"></a><a id="I_indexterm27_d1e56418" class="indexterm"></a><a id="I_indexterm27_d1e56425" class="indexterm"></a>These days, the Internet is changing so fast, and offers
        so much diverse content, that it is impossible for even the most
        attentive geek to keep on top of it all. While this is as it should
        be, it also means that an enormous amount of technology churn is an
        inevitable part of keeping any communications system current.</p></div><div class="sect3" title="Toll fraud"><div class="titlepage"><div><div><h4 class="title"><a id="FutureTelephony_id337974"></a>Toll fraud</h4></div></div></div><p><a id="FutureTelephony_id337979"></a><a id="I_indexterm27_d1e56435" class="indexterm"></a><a id="I_indexterm27_d1e56442" class="indexterm"></a>As long as long-distance calls cost money, there will be
        criminals who will wish to steal. Toll fraud is nothing new, but with
        many unsecured Asterisk systems now on the Internet, the popularity of
        scripts to find these systems and compromise them has exploded.
        Administrators of Internet-connected telephone systems will need to
        carefully design their security to ensure that any calls made from
        their systems are made only by authorized users.</p></div><div class="sect3" title="VoIP spam"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.2"></a>VoIP spam</h4></div></div></div><p><a id="FutureTelephony_id346312"></a><a id="I_indexterm27_d1e56452" class="indexterm"></a><a id="I_indexterm27_d1e56459" class="indexterm"></a><a id="I_indexterm27_d1e56464" class="indexterm"></a>Yes, it’s coming. There will always be people who
        believe they have the right to inconvenience and harass others in
        their pursuit of money. Efforts are under way to try to address this,
        but only time will tell how efficacious they will be.</p></div><div class="sect3" title="Fear, uncertainty, and doubt"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.3"></a>Fear, uncertainty, and doubt</h4></div></div></div><p><a id="FutureTelephony_id320661"></a><a id="I_indexterm27_d1e56472" class="indexterm"></a>The industry is making the transition from ignorance to
        laughter. If Gandhi is correct, we can expect the fight to begin
        soon.</p><p><a id="FutureTelephony_id320666"></a>As their revenue streams become
        increasingly threatened by open source telephony, the traditional
        industry players are certain to mount a fear campaign, in hopes of
        undermining the revolution.</p></div><div class="sect3" title="Bottleneck engineering"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.4"></a>Bottleneck engineering</h4></div></div></div><p><a id="FutureTelephony_id320681"></a><a id="I_indexterm27_d1e56486" class="indexterm"></a><a id="I_indexterm27_d1e56493" class="indexterm"></a>There is a rumor that the major network providers will
        artificially cripple VoIP traffic by tagging and prioritizing the
        traffic of their premium VoIP services and, worse, detecting and
        bumping any VoIP traffic generated by services not approved by
        them.</p><p><a id="FutureTelephony_id320687"></a>Some of this is already taking
        place, with service providers blocking traffic of certain types
        through their networks, ostensibly as some public service (such as
        blocking popular file-sharing services to protect us from piracy). In
        the United States, the FCC has taken a clear stand on the matter and
        fined companies that engage in such practices. In the rest of the
        world, regulatory bodies are not always as accepting of VoIP.</p><p><a id="FutureTelephony_id348669"></a>What seems clear is that the
        community and the network will find ways around blockages, just as
        they always have.</p></div><div class="sect3" title="Regulatory wars"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.5"></a>Regulatory wars</h4></div></div></div><p><a id="FutureTelephony_id348683"></a><a id="I_indexterm27_d1e56505" class="indexterm"></a><a id="I_indexterm27_d1e56512" class="indexterm"></a>A former chairman of the United States Federal
        Communications Commission, <span class="keep-together">Michael</span> Powell delivered a gift that may
        well have altered the path of the VoIP revolution. Rather than
        attempting to regulate VoIP as a telecom service, he championed the
        concept that VoIP represents an entirely new way of communicating and
        requires its own regulatory space in which to evolve.</p><p><a id="FutureTelephony_id347074"></a>VoIP will become regulated, but
        not everywhere as a telephony service. Some of the regulations that
        may be created include:</p><div class="variablelist"><dl><dt><span class="term">
              <span class="emphasis"><em>Presence information for emergency
            services</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id347087"></a><a id="FutureTelephony_id347089"></a><a id="I_indexterm27_d1e56528" class="indexterm"></a>One of the characteristics of a traditional PSTN
              circuit is that it is always in the same location. This is very
              helpful to emergency services, as they can pinpoint the location
              of a caller by identifying the address of the circuit from which
              the call was placed. The proliferation of cell phones has made
              this much more difficult to <span class="keep-together">achieve</span>, since a cell phone does
              not have a known address. A cell phone can be plugged into any
              network and can register to any server. If the phone does not
              identify its physical location, an emergency call from it will
              provide no clue as to where the caller is. VoIP creates similar
              challenges.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Call monitoring for law enforcement
            agencies</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id332606"></a><a id="FutureTelephony_id332608"></a><a id="I_indexterm27_d1e56541" class="indexterm"></a>Law enforcement agencies have always been able to
              obtain wiretaps on traditional circuit-switched telephone lines.
              While regulations are being enacted that are designed to achieve
              the same end on the network, the technical challenges of
              delivering this functionality will probably never be completely
              solved. People value their privacy, and the more governments
              want to stifle it, the more effort will be put toward
              maintaining it.</p></dd><dt><span class="term">
              <span class="emphasis"><em>Anti-monopolistic practices</em></span>
            </span></dt><dd><p><a id="FutureTelephony_id332624"></a><a id="FutureTelephony_id332626"></a><a id="I_indexterm27_d1e56551" class="indexterm"></a>These practices are already being seen in the US,
              with fines being levied against network providers who attempt to
              filter traffic based on content.</p></dd></dl></div><p><a id="FutureTelephony_id304083"></a>When it comes to regulation,
        Asterisk is both a saint and a devil: a saint because it feeds the
        poor, and a devil because it empowers the phrackers and spammers like
        nothing ever has. The regulation of open source telephony may in part
        be determined by how well the community regulates itself. Concepts
        such as DUNDi, which incorporate anti-spam processes, are an excellent
        start. On the other hand, concepts such as caller ID–spoofing are ripe
        with opportunities for abuse.</p></div><div class="sect3" title="Quality of service"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.6"></a>Quality of service</h4></div></div></div><p><a id="FutureTelephony_id334486"></a><a id="I_indexterm27_d1e56561" class="indexterm"></a><a id="I_indexterm27_d1e56568" class="indexterm"></a>Due to the best-effort reality of the TCP/IP-based
        Internet, it is not yet known how increasing real-time VoIP traffic
        will affect overall network performance. Currently, there is so much
        excess bandwidth in the backbone that best-effort delivery is
        generally quite good indeed. Still, it has been proven time and time
        again that whenever we are provided with more bandwidth, we figure out
        a way to use it up. The 1-MB DSL connection undreamt of five years ago
        is now barely adequate.</p><p><a id="FutureTelephony_id334494"></a>Perhaps a corollary of Moore’s
        Law<sup>[<a id="asterisk-CHP-11-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-10" class="footnote">186</a>]</sup> will apply to network bandwidth. QoS may become moot,
        due to the network’s ability to deliver adequate performance without
        any special processing. Organizations that require higher levels of
        reliability may elect to pay a premium for a higher grade of service.
        Perhaps the era of paying by the minute for long-distance connections
        will give way to paying by the millisecond for guaranteed low latency,
        or by the percentage point for reduced packet loss. Premium services
        will offer the five-nines<sup>[<a id="asterisk-CHP-11-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-11-FN-11" class="footnote">187</a>]</sup> reliability the traditional telecom companies have
        always touted as their advantage over VoIP.</p></div><div class="sect3" title="Complexity"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.7.7"></a>Complexity</h4></div></div></div><p><a id="FutureTelephony_id346503"></a><a id="I_indexterm27_d1e56588" class="indexterm"></a>Open systems require new approaches to solution design.
        Just because the hardware and software are cheap doesn’t mean the
        solution will be. Asterisk does not come out of the box ready to run;
        an Asterisk system has to be designed and built, and then maintained.
        While the base software is free, and the hardware costs will be based
        on commodity pricing, it is fair to say that the configuration costs
        for a highly customized system will be a sizable part of the overall
        solution cost. In fact, in many cases, because of Asterisk’s high
        degree of complexity and configurability, the cost will be more than
        would be expected with a traditional PBX.</p><p><a id="FutureTelephony_id346517"></a>The rule of thumb is generally
        considered to be something like this: if it can be done in the
        dialplan, the system design will be roughly the same as for any
        similarly featured traditional PBX. Beyond that, only experience will
        allow one to accurately estimate the time required to build a
        system.</p><p><a id="FutureTelephony_id310823"></a>There is much to learn.</p></div></div><div class="sect2" title="Opportunities"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-CHP-11-SECT-4.8"></a>Opportunities</h3></div></div></div><p><a id="FutureTelephony_id310837"></a>Open source telephony creates
      limitless opportunities. Here are some of the more compelling
      ones.</p><div class="sect3" title="Tailor-made private telecommunications networks"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.8.1"></a>Tailor-made private telecommunications networks</h4></div></div></div><p><a id="FutureTelephony_id269244"></a><a id="I_indexterm27_d1e56609" class="indexterm"></a><a id="I_indexterm27_d1e56616" class="indexterm"></a>Some people will tell you that price is the key, but we
        believe that the real reason Asterisk will succeed is because it is
        now possible to build a telephone system as one would a website: with
        complete, total customization of each and every facet of the system.
        Customers have wanted this for years. Only Asterisk can
        deliver.</p></div><div class="sect3" title="Low barrier to entry"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.8.2"></a>Low barrier to entry</h4></div></div></div><p><a id="FutureTelephony_id331775"></a><a id="I_indexterm27_d1e56624" class="indexterm"></a><a id="I_indexterm27_d1e56631" class="indexterm"></a>Anyone can contribute to the future of communicating. It
        is now possible for someone with an old $200 PC to develop a
        communications system that has the intelligence to rival the most
        expensive proprietary systems. Granted, the hardware would not be
        production-ready, but there is no reason the software couldn’t be.
        This is one of the reasons why closed systems will have a hard time
        competing. The sheer number of people who have access to the required
        equipment is impossible to equal in a <span class="keep-together">closed shop</span>.</p></div><div class="sect3" title="Hosted solutions of similar complexity to corporate websites"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.8.3"></a>Hosted solutions of similar complexity to corporate
        websites</h4></div></div></div><p><a id="FutureTelephony_id331793"></a><a id="I_indexterm27_d1e56642" class="indexterm"></a>The design of a PBX was always a kind of art form, but
        before Asterisk, the art lay in finding creative ways to overcome the
        limitations of the technology. With limitless technology, those same
        creative skills can now be properly applied to the task of completely
        answering the needs of the customer. Open source telephony engines
        such as Asterisk will enable this. Telecom designers will dance for
        joy, as their considerable creative skills will now actually serve the
        needs of their customers, rather than being focused on managing
        kludge.</p></div><div class="sect3" title="Proper integration of communications technologies"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-CHP-11-SECT-4.8.4"></a>Proper integration of communications technologies</h4></div></div></div><p><a id="FutureTelephony_id305656"></a><a id="I_indexterm27_d1e56654" class="indexterm"></a>Ultimately, the promise of open source comes to nothing
        if it cannot fulfill the need people have to solve problems. The
        closed industries lost sight of the customer, and tried to fit the
        customer to the product.</p><p><a id="FutureTelephony_id342216"></a>Open source telephony brings voice
        communications in line with other information technologies. It is
        finally possible to properly begin the task of integrating email,
        voice, video, and anything else we might conceive of over flexible
        transport networks (whether wired or wireless), in response to the
        needs of the user, not the whims of monopolies.<a id="I_indexterm27_d1e56664" class="indexterm"></a><a id="I_indexterm27_d1e56665" class="indexterm"></a><a id="I_indexterm27_d1e56666" class="indexterm"></a></p><p><a id="FutureTelephony_id342222"></a>
          <span class="emphasis"><em>Welcome to the future of
        telecom!</em></span>
        </p></div></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id665031" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id665031" class="para">179</a>] </sup>Ever heard of Elisha Gray or Antonio Meucci?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-1" class="para">180</a>] </sup>Contrast this with the IETF’s membership page, which states:
          “The IETF is not a membership organization (no cards, no dues, no
          secret handshakes :-)…It is open to any interested
          individual…Welcome to the IETF.” Talk about community!</p></div><div class="footnote"><p><sup>[<a id="ftn.id665126" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id665126" class="para">181</a>] </sup>Many people who are familiar with both protocols suggest that
          H.323 is in fact technically superior. Betamax, anyone?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-4" class="para">182</a>] </sup>Much of the following section is merely our interpretation of
        O’Reilly’s article. To get the full gist of these ideas, the full read
        is highly recommended.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-5" class="para">183</a>] </sup>From the perspective of the closed-source industry, their
          attitude is understandable. In his book <span class="emphasis"><em>The Mythical
          Man-Month: Essays on Software Engineering</em></span>
          (Addison-Wesley), Fred Brooks opined that “the complexity and
          communication costs of a project rise with the square of the number
          of developers, while work done only rises linearly.” Without a
          community-based development methodology, it is very difficult to
          deliver products that at best are little more than incremental
          improvements over their predecessors, and at worst are merely
          collections of patches.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-6" class="para">184</a>] </sup>Eric S. Raymond, <span class="emphasis"><em><a class="ulink" href="http://oreilly.com/catalog/9780596001087/" target="_top">The Cathedral and
          the Bazaar</a></em></span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-8" class="para">185</a>] </sup>Allison Smith is The Voice of Asterisk—it is her voice in all
          of the system prompts. To have Allison produce your own prompt,
          simply visit <a class="ulink" href="http://www.theivrvoice.com/" target="_top">http://www.theivrvoice.com</a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-10" class="para">186</a>] </sup>Gordon Moore wrote a paper in 1965 that predicted the
            doubling of transistors on a processor every few years.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-11-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-FN-11" class="para">187</a>] </sup>This term refers to 99.999%, which is touted as the
            reliability of traditional telecom networks. Achieving five nines
            requires that service interruptions for an entire year total no
            more than 5 minutes and 15 seconds. Many people believe that VoIP
            will need to achieve this level of reliability before it can fully
            replace the PSTN. Many other people believe that the PSTN doesn’t
            even come close to five-nines reliability. This could have been an
            excellent term to describe high reliability, but marketing
            departments abuse it far too frequently.</p></div></div></div><div class="appendix" title="Appendix A. Understanding Telephony"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-UnderstandingTelephony"></a>Appendix&nbsp;A.&nbsp;Understanding Telephony</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1">Analog Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1">Parts of an Analog Telephone</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.1">Ringer</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.2">Dialpad</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3">Hybrid (or network)</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2">Digital Telephony</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1">Pulse-Code Modulation</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.1">Digitally encoding an analog waveform</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.2">Increasing the sampling resolution and rate</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.3">Nyquist’s Theorem</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.4">Logarithmic companding</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.5">Aliasing</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3">The Digital Circuit-Switched Telephone Network</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1">Circuit Types</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.1">The humble DS-0―The foundation of it all</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.2">T-carrier circuits</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.3">SONET and OC circuits</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2">Digital Signaling Protocols</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.1">Channel Associated Signaling (CAS)</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.2">ISDN</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-4">Packet-Switched Networks</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-5">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Understanding_Telephony_id289043"></a>Utility is when you have one
    telephone, luxury is when you have two, opulence is when you have
    three—and paradise is when you have none.</p><div class="attribution"><span>—<span class="attribution">Doug Larson</span></span></div></div><p><a id="Understanding_Telephony_id245140"></a><a id="index-838A850VQ4Q" class="indexterm"></a><a id="index-628I158QB2U" class="indexterm"></a>In this appendix, we are going to talk about some of the
  technologies of the traditional telephone network—especially those that
  people most commonly want to connect to Asterisk. (We’ll discuss Voice over
  IP in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.)</p><p><a id="Understanding_Telephony_id255262"></a>While tomes could be written
  about the technologies in use in telecom networks, the material included
  here was chosen based on our experiences in the community, which helped us
  to define the specific items that might be most useful. Although this
  knowledge may not be strictly required in order to configure your Asterisk
  system, it will be of great benefit when interconnecting to systems (and
  talking with people) from the world of traditional
  telecommunications.</p><div class="sect1" title="Analog Telephony"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingTelephony-SECT-1"></a>Analog Telephony</h2></div></div></div><p><a id="Understanding_Telephony_id245131"></a><a id="index-230M551GE0W" class="indexterm"></a><a id="index-102D163FR1Q" class="indexterm"></a>The purpose of the Public Switched Telephone Network (PSTN)
    is to establish and maintain audio connections between two endpoints in
    order to carry speech.</p><p><a id="Understanding_Telephony_id289726"></a>Although humans can perceive
    sound vibrations in the range of 20–20,000 Hz,<sup>[<a id="asterisk-UnderstandingTelephony-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-2" class="footnote">188</a>]</sup> most of the sounds we make when speaking tend to be in the
    range of 250–3,000 Hz. Since the purpose of the telephone network is to
    transmit the sounds of people speaking, it was designed with a bandwidth
    of somewhere in the range of 300–3,500 Hz. This limited bandwidth means
    that some sound quality will be lost (as anyone who’s had to listen to
    music on hold can attest to), especially in the higher frequencies.</p><div class="sect2" title="Parts of an Analog Telephone"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1"></a>Parts of an Analog Telephone</h3></div></div></div><p><a id="Understanding_Telephony_id246593"></a><a id="I_indexterm_d1e56715" class="indexterm"></a>An analog phone is composed of five parts: the ringer, the
      dialpad, the hybrid (or network), and the hook switch and handset (both
      of which are considered parts of the hybrid). The ringer, the dialpad,
      and the hybrid can operate completely independently of one
      another.</p><div class="sect3" title="Ringer"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1.1"></a>Ringer</h4></div></div></div><p><a id="Understanding_Telephony_id290925"></a><a id="I_indexterm_d1e56725" class="indexterm"></a>When the central office (CO) wants to signal an incoming
        call, it will connect an alternating current (AC) signal of roughly 90
        volts to your circuit. This will cause the bell in your telephone to
        produce a ringing sound. (In electronic telephones, this ringer may be
        a small electronic warbler rather than a bell. Ultimately, a ringer
        can be anything that is capable of reacting to the ringing voltage;
        for example, strobe lights are often employed in noisy environments
        such as factories.)</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingTelephony-NOTE-38"></a>Warning</h3><p><a id="Understanding_Telephony_id249146"></a>Ringing voltage can be
          hazardous. Be very careful to take precautions when working with an
          in-service telephone line.</p></div><p><a id="Understanding_Telephony_id246464"></a>Many people confuse the AC
        voltage that triggers the ringer with the direct current (DC) voltage
        that powers the phone. Remember that a ringer needs an alternating
        current in order to oscillate (just as a church bell won’t ring if you
        don’t supply the movement), and you’ve got it.</p><p><a id="Understanding_Telephony_id264563"></a>In North America, the
        number of ringers you can connect to your line is dependent on the
        Ringer Equivalence Number (REN) of your various devices. (The REN must
        be listed on each device.) The total REN for all devices connected to
        your line cannot exceed 5.0. An REN of 1.0 is equivalent to an
        old-fashioned analog set with an electromechanical ringer. Some
        electronic phones have RENs of 0.3 or even less. If you connect too
        many devices that require too much current, you will find that none of
        them will be able to ring.</p></div><div class="sect3" title="Dialpad"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1.2"></a>Dialpad</h4></div></div></div><p><a id="Understanding_Telephony_id267740"></a><a id="I_indexterm_d1e56740" class="indexterm"></a>When you place a telephone call, you need some way of
        letting the network know the address of the party you wish to reach.
        The dialpad is the portion of the phone that provides this
        functionality. In the early days of the PSTN, dialpads were in fact
        rotary devices that used pulses to indicate digits. This was a rather
        slow process, so the telephone companies eventually introduced
        touch-tone dialing. With touch-tone—also known as Dual-Tone Multi
        Frequency (DTMF)—dialing, the dialpad consists of 12 buttons. Each
        button has two frequencies assigned to it (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-1" title="Table A.1. DTMF digits">Table&nbsp;A.1, “DTMF digits”</a>).<a id="I_indexterm_d1e56746" class="indexterm"></a></p><div class="table"><a id="asterisk-UnderstandingTelephony-TABLE-1"></a><p class="title"><strong>Table&nbsp;A.1.&nbsp;DTMF digits</strong></p><div class="table-contents"><table summary="DTMF digits" border="1"><colgroup><col class="col1"><col class="col2"><col class="col3"><col class="col4"><col class="col5"></colgroup><thead><tr><th>&nbsp;</th><th align="left">
                  <p><a id="Understanding_Telephony_id245711"></a>1209 Hz</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id245717"></a>1336 Hz</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id262400"></a>1477 Hz</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id262406"></a>1633 Hz <sup>[<a id="id669055" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id669055" class="footnote">a</a>]</sup> </p>
                </th></tr></thead><tbody><tr><td align="left">
                  <p><a id="Understanding_Telephony_id262434"></a> <span class="strong"><strong>697 Hz</strong></span> </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id262446"></a>1</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id262452"></a>2</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id262458"></a>3</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id262465"></a>A</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id262474"></a> <span class="strong"><strong>770 Hz</strong></span> </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265006"></a>4</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265012"></a>5</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265018"></a>6</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265025"></a>B</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id265034"></a> <span class="strong"><strong>852 Hz</strong></span> </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265046"></a>7</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265052"></a>8</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265058"></a>9</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id265065"></a>C</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id265074"></a> <span class="strong"><strong>941 Hz</strong></span> </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id254376"></a>*</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id254382"></a>0</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id254388"></a>#</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id254395"></a>D</p>
                </td></tr></tbody><tbody class="footnotes"><tr><td colspan="5"><div class="footnote"><p><sup>[<a id="ftn.id669055" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id669055" class="para">a</a>] </sup>Notice that this column contains letters that are
                    not typically present as keys on a telephone dialpad. They
                    are part of the DTMF standard nonetheless, and any proper
                    telephone contains the electronics required to create
                    them, even if it doesn’t contain the buttons themselves.
                    (These buttons actually do exist on some telephones, which
                    are mostly used in military and government
                    applications.)</p></div></td></tr></tbody></table></div></div><br class="table-break"><p><a id="Understanding_Telephony_id254402"></a>When you press a button on
        your dialpad, the two corresponding frequencies are transmitted down
        the line. The far end can interpret these frequencies and note which
        digit was pressed.</p></div><div class="sect3" title="Hybrid (or network)"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1.3"></a>Hybrid (or network)</h4></div></div></div><p><a id="Understanding_Telephony_id254416"></a>The hybrid is a type of
        transformer <a id="I_indexterm_d1e56861" class="indexterm"></a>that handles the need to combine the signals transmitted
        and received across a single pair of wires in the PSTN and two pairs
        of wires in the handset. One of the functions the hybrid performs is
        regulating <span class="emphasis"><em>sidetone</em></span>, which is the amount of your
        transmitted signal that is returned to your earpiece; its purpose is
        to provide a more natural-sounding conversation. Too much sidetone,
        and your voice will sound too loud; too little, and you’ll think the
        line has gone dead.</p><div class="sect4" title="Hook switch (or switch hook)"><div class="titlepage"><div><div><h5 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1.3.1"></a>Hook switch (or switch hook)</h5></div></div></div><p><a id="Understanding_Telephony_id254469"></a><a id="I_indexterm_d1e56872" class="indexterm"></a><a id="I_indexterm_d1e56875" class="indexterm"></a>This device signals the state of the telephone circuit
          to the CO. When you pick up your telephone, the hook switch closes
          the loop between you and the CO, which is seen as a request for a
          dialtone. When you hang up, the hook switch opens the circuit, which
          indicates that the call has ended.<sup>[<a id="asterisk-UnderstandingTelephony-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-3" class="footnote">189</a>]</sup></p><p><a id="Understanding_Telephony_id254510"></a>The hook switch can also
          be used for signaling purposes. Some electronic analog phones have a
          button labeled <span class="emphasis"><em>Link</em></span> that causes an event called
          a <span class="emphasis"><em>flash</em></span>. You can perform a flash manually by
          depressing the hook switch for a duration of between 200 and 1,200
          milliseconds. If you leave it down for longer than that, the carrier
          may assume you’ve hung up. The purpose of the
          <span class="emphasis"><em>Link</em></span> button is to handle this timing for you.
          If you’ve ever used call waiting or three-way calling on an analog
          line, you have performed a hook-switch flash for the purpose of
          signaling the network.</p></div><div class="sect4" title="Handset"><div class="titlepage"><div><div><h5 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.1.3.2"></a>Handset</h5></div></div></div><p><a id="Understanding_Telephony_id254548"></a><a id="I_indexterm_d1e56898" class="indexterm"></a>The handset is composed of the transmitter and
          receiver. It performs the conversion between the sound energy humans
          use and the electrical energy the telephone network uses.</p></div></div></div><div class="sect2" title="Tip and Ring"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingTelephony-SECT-1.2"></a>Tip and Ring</h3></div></div></div><p><a id="Understanding_Telephony_id254575"></a><a id="I_indexterm_d1e56906" class="indexterm"></a><a id="I_indexterm_d1e56909" class="indexterm"></a>In an analog telephone circuit, there are two wires. In
      North America, these wires are referred to as Tip and Ring.<sup>[<a id="asterisk-UnderstandingTelephony-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-4" class="footnote">190</a>]</sup> This terminology comes from the days when telephone calls
      were connected by live operators sitting at cord boards. The plugs that
      they used had two contacts—one located at the tip of the plug and the
      other connected to the ring around the middle (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-1" title="Figure A.1. Tip and Ring">Figure&nbsp;A.1, “Tip and Ring”</a>).</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-1"></a><p class="title"><strong>Figure&nbsp;A.1.&nbsp;Tip and Ring</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e56924"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa01.png" alt="Tip and Ring"></div></div></div><br class="figure-break"></div><p><a id="Understanding_Telephony_id254652"></a>The Tip lead is the positive
      polarity wire. In North America, this wire is typically green and
      provides the return path. The Ring wire is the negative polarity wire.
      In North America, this wire is normally red. For modern Cat 5 and 6
      cables, the Tip is usually the white wire, and Ring is the colored wire.
      When your telephone is on-hook, this wire will have a potential of –48V
      DC with respect to Tip. Off-hook, this voltage drops to roughly –7V
      DC.<a id="I_indexterm_d1e56931" class="indexterm"></a><a id="I_indexterm_d1e56932" class="indexterm"></a></p></div></div><div class="sect1" title="Digital Telephony"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingTelephony-SECT-2"></a>Digital Telephony</h2></div></div></div><p><a id="Understanding_Telephony_id254674"></a><a id="index-062M287MF4L" class="indexterm"></a><a id="index-345U170WR2I" class="indexterm"></a>Analog telephony is almost dead.</p><p><a id="Understanding_Telephony_id254694"></a>In the PSTN, the famous Last
    Mile is the final remaining piece of the telephone network still using
    technology pioneered well over a hundred years ago.<sup>[<a id="asterisk-UnderstandingTelephony-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-5" class="footnote">191</a>]</sup></p><p><a id="Understanding_Telephony_id254718"></a>One of the primary challenges
    when transmitting analog signals is that all sorts of things can interfere
    with those signals, causing low volume, static, and all manner of other
    undesired effects. Instead of trying to preserve an analog waveform over
    distances that may span thousands of miles, why not simply measure the
    characteristics of the original sound and send that information to the far
    end? The original waveform wouldn’t get there, but all the information
    needed to reconstruct it would.</p><p><a id="Understanding_Telephony_id254750"></a>This is the principle of all
    digital audio (including telephony): sample the characteristics of the
    source waveform, store the measured information, and send that data to the
    far end. Then, at the far end, use the transmitted information to generate
    a completely new audio signal that has the same characteristics as the
    original. The reproduction is so good that the human ear can’t tell the
    difference.</p><p><a id="Understanding_Telephony_id254760"></a>The principal advantage of
    digital audio is that the sampled data can be mathematically checked for
    errors all along the route to its destination, ensuring that a perfect
    duplicate of the original arrives at the far end. Distance no longer
    affects quality, and interference can be detected and eliminated.</p><div class="sect2" title="Pulse-Code Modulation"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1"></a>Pulse-Code Modulation</h3></div></div></div><p><a id="Understanding_Telephony_id254774"></a><a id="I_indexterm_d1e56963" class="indexterm"></a>There are several ways to digitally encode audio, but the
      most common method (and the one used in telephony systems) is known as
      Pulse-Code Modulation (PCM). To illustrate how this works, let’s go
      through a few examples.</p><div class="sect3" title="Digitally encoding an analog waveform"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1.1"></a>Digitally encoding an analog waveform</h4></div></div></div><p><a id="Understanding_Telephony_id249784"></a><a id="I_indexterm_d1e56971" class="indexterm"></a>The principle of PCM is that the amplitude<sup>[<a id="id669839" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id669839" class="footnote">192</a>]</sup> of the analog waveform is sampled at specific intervals
        so that it can later be re-created. The amount of detail that is
        captured is dependent both on the bit resolution of each sample and on
        how frequently the samples are taken. A higher bit resolution and a
        higher sampling rate will provide greater accuracy, but more bandwidth
        will be required to transmit this more detailed information.</p><p><a id="Understanding_Telephony_id249825"></a>To get a better idea of
        how PCM works, consider the waveform displayed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-2" title="Figure A.2. A simple sinusoidal (sine) wave">Figure&nbsp;A.2, “A simple sinusoidal (sine) wave”</a>.</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-2"></a><p class="title"><strong>Figure&nbsp;A.2.&nbsp;A simple sinusoidal (sine) wave</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e56986"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa02.png" alt="A simple sinusoidal (sine) wave"></div></div></div><br class="figure-break"></div><p><a id="Understanding_Telephony_id249835"></a>To digitally encode the
        wave, it must be sampled on a regular basis, and the amplitude of the
        wave at each moment in time must be measured. The process of slicing
        up a waveform into moments in time and measuring the energy at each
        moment is called <span class="emphasis"><em>quantization</em></span>, or
        <span class="emphasis"><em>sampling</em></span>.</p><p><a id="Understanding_Telephony_id249869"></a>The samples will need to
        be taken frequently enough and will need to capture enough information
        to ensure that the far end can re-create a sufficiently similar
        waveform. To achieve a more accurate sample, more bits will be
        required. To explain this concept, we will start with a very low
        resolution, using 4 bits to represent our amplitude. This will make it
        easier to visualize both the quantization process itself and the
        effect that resolution has on quality.</p><p><a id="Understanding_Telephony_id249876"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-3" title="Figure A.3. Sampling our sine wave using four bits">Figure&nbsp;A.3, “Sampling our sine wave using four bits”</a> shows the
        information that will be captured when we sample our sine wave at
        4-bit resolution.</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-3"></a><p class="title"><strong>Figure&nbsp;A.3.&nbsp;Sampling our sine wave using four bits</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57007"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa03.png" alt="Sampling our sine wave using four bits"></div></div></div><br class="figure-break"></div><p><a id="Understanding_Telephony_id249978"></a>At each time interval, we
        measure the amplitude of the wave and record the corresponding
        intensity—in other words, we sample it. You will notice that the 4-bit
        resolution limits our accuracy. The first sample has to be rounded to
        <code class="literal">0011</code>, and the next quantization
        yields a sample of <code class="literal">0101</code>. Then comes
        <code class="literal">0100</code>, followed by <code class="literal">1001</code>, <code class="literal">1011</code>, and so forth. In total, we have 14
        samples (in reality, several thousand samples must be taken per
        second).</p><p><a id="Understanding_Telephony_id250013"></a>If we string together all
        the values, we can send them to the other side as:</p><a id="I_programlisting7_tt1038"></a><pre class="programlisting">0011 0101 0100 1001 1011 1011 1010 0001 0101 0101 0000 1100 1100 1010</pre><p><a id="Understanding_Telephony_id250025"></a>On the wire, this code
        might look something like <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-4" title="Figure A.4. PCM encoded waveform">Figure&nbsp;A.4, “PCM encoded waveform”</a>.</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-4"></a><p class="title"><strong>Figure&nbsp;A.4.&nbsp;PCM encoded waveform</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57041"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa04.png" alt="PCM encoded waveform"></div></div></div><br class="figure-break"><p><a id="Understanding_Telephony_id250075"></a>When the far end’s
        digital-to-analog (D/A) converter receives this signal, it can use the
        information to plot the samples, as shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-5" title="Figure A.5. Plotted PCM signal">Figure&nbsp;A.5, “Plotted PCM signal”</a>.</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-5"></a><p class="title"><strong>Figure&nbsp;A.5.&nbsp;Plotted PCM signal</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57053"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa05.png" alt="Plotted PCM signal"></div></div></div><br class="figure-break"><p><a id="Understanding_Telephony_id250139"></a>From this information, the
        waveform can be reconstructed (see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-6" title="Figure A.6. Delineated signal">Figure&nbsp;A.6, “Delineated signal”</a>).</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-6"></a><p class="title"><strong>Figure&nbsp;A.6.&nbsp;Delineated signal</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57065"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa06.png" alt="Delineated signal"></div></div></div><br class="figure-break"></div><p><a id="Understanding_Telephony_id250189"></a>As you can see if you
        compare <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-2" title="Figure A.2. A simple sinusoidal (sine) wave">Figure&nbsp;A.2, “A simple sinusoidal (sine) wave”</a> with
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-6" title="Figure A.6. Delineated signal">Figure&nbsp;A.6, “Delineated signal”</a>, this
        reconstruction of the waveform is not very accurate. This was done
        intentionally, to demonstrate an <span class="keep-together">important</span> point: the quality of the
        digitally encoded waveform is affected by the resolution and rate at
        which it is sampled. At too low a sampling rate, and with too low a
        sample resolution, the audio quality will not be acceptable.</p></div><div class="sect3" title="Increasing the sampling resolution and rate"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1.2"></a>Increasing the sampling resolution and rate</h4></div></div></div><p><a id="Understanding_Telephony_id250219"></a><a id="I_indexterm_d1e57083" class="indexterm"></a>Let’s take another look at our original waveform, this
        time using 5 bits to define our quantization intervals (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-7" title="Figure A.7. The same waveform, on a higher-resolution overlay">Figure&nbsp;A.7, “The same waveform, on a higher-resolution overlay”</a>).</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-7"></a><p class="title"><strong>Figure&nbsp;A.7.&nbsp;The same waveform, on a higher-resolution overlay</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57092"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa07.png" alt="The same waveform, on a higher-resolution overlay"></div></div></div><br class="figure-break"></div><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingTelephony-NOTE-39"></a>Tip</h3><p><a id="Understanding_Telephony_id241063"></a>In reality, there is no
          such thing as 5-bit PCM. In the telephone network, PCM samples are
          encoded using 8 bits. Other digital audio methods may employ 16 bits
          or more.</p></div><p><a id="Understanding_Telephony_id241078"></a>We’ll also double our
        sampling frequency. The points plotted this time are shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-8" title="Figure A.8. The same waveform at double the resolution">Figure&nbsp;A.8, “The same waveform at double the resolution”</a>.</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-8"></a><p class="title"><strong>Figure&nbsp;A.8.&nbsp;The same waveform at double the resolution</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57107"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa08.png" alt="The same waveform at double the resolution"></div></div></div><br class="figure-break"><p><a id="Understanding_Telephony_id241128"></a>We now have twice the
        number of samples, at twice the resolution. Here they are:</p><p><a id="Understanding_Telephony_id241132"></a><a id="I_programlisting7_tt1045"></a></p><pre class="programlisting">00111 01000 01001 01001 01000 00101 10110 11000 11001 11001 11000 10111 
10100 10001 00010 00111 01001 01010 01001 00111 00000 11000 11010 11010 
11001 11000 10110 10001</pre><p>When received at the other end, that
        information can now be plotted as shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-9" title="Figure A.9. Five-bit plotted PCM signal">Figure&nbsp;A.9, “Five-bit plotted PCM signal”</a>.</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-9"></a><p class="title"><strong>Figure&nbsp;A.9.&nbsp;Five-bit plotted PCM signal</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57123"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa09.png" alt="Five-bit plotted PCM signal"></div></div></div><br class="figure-break"><p><a id="Understanding_Telephony_id241192"></a>From this information, the
        waveform shown in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-10" title="Figure A.10. Waveform delineated from five-bit PCM">Figure&nbsp;A.10, “Waveform delineated from five-bit PCM”</a> can then be
        generated.</p><p><a id="Understanding_Telephony_id241202"></a>As you can see, the
        resultant waveform is a far more accurate representation of the
        original. However, you can also see that there is still room for
        improvement.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingTelephony-NOTE-40"></a>Tip</h3><p><a id="Understanding_Telephony_id241214"></a>Note that 40 bits were
          required to encode the waveform at 4-bit resolution, while 156 bits
          were needed to send the same waveform using 5-bit resolution (and
          also doubling the sampling rate). The point is, there is a tradeoff:
          the higher the quality of audio you wish to encode, the more bits
          are required to do it, and the more bits you wish to send (in real
          time, naturally), the more bandwidth you will need to
          consume.</p></div><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-10"></a><p class="title"><strong>Figure&nbsp;A.10.&nbsp;Waveform delineated from five-bit PCM</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57142"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa10.png" alt="Waveform delineated from five-bit PCM"></div></div></div><br class="figure-break"></div></div><div class="sect3" title="Nyquist’s Theorem"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1.3"></a>Nyquist’s Theorem</h4></div></div></div><p><a id="Understanding_Telephony_id241275"></a><a id="I_indexterm_d1e57151" class="indexterm"></a>So how much sampling is enough? That very same question
        was considered in the 1920s by an electrical engineer (and
        AT&amp;T/Bell employee) named Harry Nyquist. Nyquist’s Theorem states:
        “When sampling a signal, the <span class="emphasis"><em>sampling frequency</em></span>
        must be greater than twice the bandwidth of the input signal in order
        to be able to reconstruct the original perfectly from the sampled
        version.”<sup>[<a id="asterisk-UnderstandingTelephony-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-7" class="footnote">193</a>]</sup></p><p><a id="Understanding_Telephony_id241329"></a>In essence, what this
        means is that to accurately encode an analog signal you have to sample
        it twice as often as the total bandwidth you wish to reproduce. Since
        the <span class="keep-together">telephone</span> network will not
        carry frequencies below 300 Hz and above 4,000 Hz, a sampling
        frequency of 8,000 samples per second will be sufficient to reproduce
        any frequency within the bandwidth of an analog telephone. Keep that
        8,000 samples per second in mind; we’re going to talk about it more
        later.</p></div><div class="sect3" title="Logarithmic companding"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1.4"></a>Logarithmic companding</h4></div></div></div><p><a id="Understanding_Telephony_id241350"></a><a id="I_indexterm_d1e57170" class="indexterm"></a><a id="I_indexterm_d1e57173" class="indexterm"></a>So, we’ve gone over the basics of quantization, and
        we’ve discussed the fact that more quantization intervals (i.e., a
        higher sampling rate) give better quality but also require more
        bandwidth. Lastly, we’ve discussed the minimum sampling rate needed to
        accurately measure the range of frequencies we wish to be able to
        transmit (in the case of the telephone, it’s 8,000 Hz). This is all
        starting to add up to a fair bit of data being sent on the wire, so
        we’re going to want to talk about companding.</p><p><a id="Understanding_Telephony_id241382"></a><span class="emphasis"><em>Companding</em></span>
        is a method of improving the dynamic range of a sampling method
        without losing important accuracy. It works by quantizing higher
        amplitudes in a much coarser fashion than lower amplitudes. In other
        words, if you yell into your phone, you will not be sampled as cleanly
        as you will be when speaking normally. Yelling is also not good for
        your blood pressure, so it’s best to avoid it.</p><p><a id="Understanding_Telephony_id241394"></a>Two companding methods are
        commonly employed: μlaw<sup>[<a id="asterisk-UnderstandingTelephony-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-8" class="footnote">194</a>]</sup> in North America, and alaw in the rest of the world.
        They operate on the same principles but are otherwise not compatible
        with each other.</p><p><a id="Understanding_Telephony_id241430"></a>Companding divides the
        waveform into <span class="emphasis"><em>cords</em></span>, each of which has several
        <span class="emphasis"><em>steps</em></span>. Quantization involves matching the
        measured amplitude to an appropriate step within a cord. The value of
        the band and cord numbers (as well as the sign—positive or negative)
        becomes the signal. The following diagrams will give you a visual idea
        of what companding does. They are not based on any standard, but
        rather were made up for the purpose of illustration (again, in the
        telephone network, companding will be done at an 8-bit, not 5-bit,
        resolution).</p><p><a id="Understanding_Telephony_id241459"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-11" title="Figure A.11. Five-bit companding">Figure&nbsp;A.11, “Five-bit companding”</a> illustrates 5-bit
        companding. As you can see, amplitudes near the zero-crossing point
        will be sampled far more accurately than higher amplitudes (either
        positive or negative). However, since the human ear, the transmitter,
        and the receiver will also tend to distort loud signals, this isn’t
        really a problem.</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-11"></a><p class="title"><strong>Figure&nbsp;A.11.&nbsp;Five-bit companding</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57201"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa11.png" alt="Five-bit companding"></div></div></div><br class="figure-break"><p><a id="Understanding_Telephony_id258452"></a>A quantized sample might
        look like <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FIG-12" title="Figure A.12. Quantized and companded at 5-bit resolution">Figure&nbsp;A.12, “Quantized and companded at 5-bit resolution”</a>.
        It yields the following bit stream:</p><div class="figure"><a id="asterisk-UnderstandingTelephony-FIG-12"></a><p class="title"><strong>Figure&nbsp;A.12.&nbsp;Quantized and companded at 5-bit resolution</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject_d1e57213"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_aa12.png" alt="Quantized and companded at 5-bit resolution"></div></div></div><br class="figure-break"><a id="I_programlisting7_tt1056"></a><pre class="programlisting">00000 10011 10100 10101 01101 00001 00011 11010 00010 00001 01000 10011 
10100 10100 00101 00100 00101 10101 10011 10001 00011 00001 00000 10100 
10010 10101 01101 10100 00101 11010 00100 00000 01000</pre></div><div class="sect3" title="Aliasing"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-2.1.5"></a>Aliasing</h4></div></div></div><p><a id="Understanding_Telephony_id258521"></a><a id="I_indexterm_d1e57225" class="indexterm"></a>If you’ve ever watched the wheels on a wagon turn
        backward in an old Western movie, you’ve seen the effects of aliasing.
        The frame rate of the movie cannot keep up with the rotational
        frequency of the spokes, and a false rotation is perceived.</p><p><a id="Understanding_Telephony_id258541"></a>In a digital audio system
        (which the modern PSTN arguably is), aliasing always occurs if
        frequencies that are greater than one-half the sampling rate are
        presented to the analog-to-digital (A/D) converter. In the PSTN, that
        includes any audio frequencies above 4,000 Hz (half the sampling rate
        of 8,000 Hz). This problem is easily corrected by passing the audio
        through a low-pass filter<sup>[<a id="asterisk-UnderstandingTelephony-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-9" class="footnote">195</a>]</sup> before presenting it to the A/D converter.<a id="I_indexterm_d1e57235" class="indexterm"></a><a id="I_indexterm_d1e57236" class="indexterm"></a><sup>[<a id="id670978" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id670978" class="footnote">196</a>]</sup></p></div></div></div><div class="sect1" title="The Digital Circuit-Switched Telephone Network"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingTelephony-SECT-3"></a>The Digital Circuit-Switched Telephone Network</h2></div></div></div><p><a id="Understanding_Telephony_id258623"></a><a id="index-605W806TO4Q" class="indexterm"></a><a id="index-686K580JR8J" class="indexterm"></a><a id="index-745C754HW1T" class="indexterm"></a>For over a hundred years, telephone networks were
    exclusively circuit-switched. What this meant was that for every telephone
    call made, a dedicated connection was established between the two
    endpoints, with a fixed amount of bandwidth allocated to that circuit.
    Creating such a network was costly, and where distance was concerned,
    using that network was costly as well. Although we are all predicting the
    end of the circuit-switched network, many people still use it every day,
    and it really does work rather well.</p><div class="sect2" title="Circuit Types"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.1"></a>Circuit Types</h3></div></div></div><p><a id="Understanding_Telephony_id258673"></a><a id="I_indexterm_d1e57262" class="indexterm"></a>In the PSTN, there are many different sizes of circuits
      serving the various needs of the network. Between the central office and
      a subscriber, one or more analog circuits, or a few dozen channels
      delivered over a digital circuit, generally suffice. Between PSTN
      offices (and with larger customers), fiber-optic circuits are generally
      used.</p><div class="sect3" title="The humble DS-0―The foundation of it all"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.1.1"></a>The humble DS-0―The foundation of it all</h4></div></div></div><p><a id="Understanding_Telephony_id258699"></a><a id="I_indexterm_d1e57270" class="indexterm"></a>Since the standard method of digitizing a telephone call
        is to record an 8-bit sample 8,000 times per second, we can see that a
        PCM-encoded telephone circuit will need a bandwidth of eight times
        8,000 bits per second, or 64,000 bps. This 64-Kbps channel is referred
        to as a <span class="emphasis"><em>DS-0</em></span> (that’s “Dee-Ess-Zero”). The DS-0 is
        the fundamental building block of all digital telecommunications
        circuits.</p><p><a id="Understanding_Telephony_id258720"></a>Even the ubiquitous analog
        circuit is sampled into a DS-0 as soon as possible. Sometimes this
        happens where your circuit terminates at the central office, and
        sometimes well before.<sup>[<a id="id671141" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id671141" class="footnote">197</a>]</sup></p></div><div class="sect3" title="T-carrier circuits"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.1.2"></a>T-carrier circuits</h4></div></div></div><p><a id="Understanding_Telephony_id258741"></a><a id="I_indexterm_d1e57286" class="indexterm"></a>The venerable T1 is one of the more recognized digital
        telephony terms. A T1 is a digital circuit consisting of 24 DS-0s
        multiplexed together into a 1.544-Mbps bit stream.<sup>[<a id="asterisk-UnderstandingTelephony-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-10" class="footnote">198</a>]</sup> This bit stream is properly defined as a
        <span class="emphasis"><em>DS-1</em></span>. Voice is encoded on a T1 using the μlaw
        companding algorithm.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingTelephony-NOTE-41"></a>Tip</h3><p><a id="Understanding_Telephony_id258790"></a>The European version of
          the T1 was developed by the European Conference of Postal and
          Telecommunications Administrations<sup>[<a id="asterisk-UnderstandingTelephony-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-11" class="footnote">199</a>]</sup> (CEPT), and was first referred to as a
          <span class="emphasis"><em>CEPT-1</em></span>. It is now called an
          <span class="emphasis"><em>E1</em></span>.</p><p><a id="Understanding_Telephony_id258846"></a>The E1 is composed of 32
          DS-0s, but the method of PCM encoding is different: E1s use alaw
          companding. This means that connecting between an E1-based network
          and a T1-based network will always require a transcoding step. Note
          that an E1, although it has 32 channels, is also considered a
          <span class="emphasis"><em>DS-1</em></span>. It is likely that E1 is far more widely
          deployed, as it is used everywhere in the world except North America
          and Japan.</p></div><p><a id="Understanding_Telephony_id258858"></a>The various other
        T-carriers (T2, T3, and T4) are multiples of the T1, each based on the
        humble DS-0. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-2" title="Table A.2. T-carrier circuits">Table&nbsp;A.2, “T-carrier circuits”</a> illustrates the
        relationships between the different T-carrier circuits.</p><div class="table"><a id="asterisk-UnderstandingTelephony-TABLE-2"></a><p class="title"><strong>Table&nbsp;A.2.&nbsp;T-carrier circuits</strong></p><div class="table-contents"><table summary="T-carrier circuits" border="1"><colgroup><col class="col1"><col class="col2"><col class="col3"><col class="col4"></colgroup><thead><tr><th align="left">
                  <p><a id="Understanding_Telephony_id271638"></a>Carrier</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271644"></a>Equivalent data
                bitrate</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271650"></a>Number of
                DS-0s</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271656"></a>Data
                bitrate</p>
                </th></tr></thead><tbody><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271669"></a> T1 </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271680"></a>24 DS-0s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271687"></a>24</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271693"></a>1.544
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271702"></a> T2 </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271714"></a>4 T1s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271720"></a>96</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271726"></a>6.312
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271736"></a> T3 </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271747"></a>7 T2s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271754"></a>672</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271760"></a>44.736
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271769"></a> T4 </p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271781"></a>6 T3s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271787"></a>4,032</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271793"></a>274.176
                Mbps</p>
                </td></tr></tbody></table></div></div><br class="table-break"><p><a id="Understanding_Telephony_id271801"></a>At densities above T3, it
        is very uncommon to see a T-carrier circuit. For these speeds, optical
        carrier (OC) circuits may be used.</p></div><div class="sect3" title="SONET and OC circuits"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.1.3"></a>SONET and OC circuits</h4></div></div></div><p><a id="Understanding_Telephony_id271814"></a><a id="I_indexterm_d1e57400" class="indexterm"></a><a id="I_indexterm_d1e57403" class="indexterm"></a>The Synchronous Optical Network (SONET) was developed
        out of a desire to take the T-carrier system to the next technological
        level: fiber optics. SONET is based on the bandwidth of a T3 (44.736
        Mbps), with a slight overhead making it 51.84 Mbps. This is referred
        to as an <span class="emphasis"><em>OC-1</em></span> or <span class="emphasis"><em>STS-1</em></span>. As
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-TABLE-3" title="Table A.3. OC circuits">Table&nbsp;A.3, “OC circuits”</a> shows, all
        higher-speed OC circuits are multiples of this base rate.</p><div class="table"><a id="asterisk-UnderstandingTelephony-TABLE-3"></a><p class="title"><strong>Table&nbsp;A.3.&nbsp;OC circuits</strong></p><div class="table-contents"><table summary="OC circuits" border="1"><colgroup><col class="col1"><col class="col2"><col class="col3"><col class="col4"></colgroup><thead><tr><th align="left">
                  <p><a id="Understanding_Telephony_id271901"></a>Carrier</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271907"></a>Equivalent data
                bitrate</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271913"></a>Number of
                DS-0s</p>
                </th><th align="left">
                  <p><a id="Understanding_Telephony_id271919"></a>Data
                bitrate</p>
                </th></tr></thead><tbody><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271932"></a>OC-1</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271938"></a>1 DS-3 (plus
                overhead)</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271945"></a>672</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271951"></a>51.840
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271961"></a>OC-3</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271967"></a>3 DS-3s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271973"></a>2,016</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271980"></a>155.520
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id271989"></a>OC-12</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id271995"></a>12 DS-3s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272002"></a>8,064</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272008"></a>622.080
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id272017"></a>OC-48</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272024"></a>48 DS-3s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272030"></a>32,256</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272036"></a>2488.320
                Mbps</p>
                </td></tr><tr><td align="left">
                  <p><a id="Understanding_Telephony_id272046"></a>OC-192</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272052"></a>192 DS-3s</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272058"></a>129,024</p>
                </td><td align="left">
                  <p><a id="Understanding_Telephony_id272064"></a>9953.280
                Mbps</p>
                </td></tr></tbody></table></div></div><br class="table-break"><p><a id="Understanding_Telephony_id272072"></a>SONET was created in an
        effort to standardize optical circuits, but due to its high cost,
        coupled with the value offered by many newer schemes, such as Dense
        Wave Division Multiplexing (DWDM), there is some controversy
        surrounding its future.</p></div></div><div class="sect2" title="Digital Signaling Protocols"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2"></a>Digital Signaling Protocols</h3></div></div></div><p><a id="Understanding_Telephony_id272087"></a><a id="I_indexterm_d1e57510" class="indexterm"></a><a id="I_indexterm_d1e57513" class="indexterm"></a>As with any circuit, it is not enough for the circuits
      used in the PSTN to just carry (voice) data between endpoints.
      Mechanisms must also be provided to pass information about the state of
      the channel between the endpoints. (Disconnect and answer supervision
      are two examples of basic signaling that might need to take place;
      caller ID is an example of a more complex form of signaling.)</p><div class="sect3" title="Channel Associated Signaling (CAS)"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2.1"></a>Channel Associated Signaling (CAS)</h4></div></div></div><p><a id="Understanding_Telephony_id250372"></a><a id="I_indexterm_d1e57521" class="indexterm"></a><a id="I_indexterm_d1e57524" class="indexterm"></a>Also known as robbed-bit signaling,<a id="I_indexterm_d1e57528" class="indexterm"></a> CAS is what you will use to transmit voice on a T1 when
        ISDN is not available. Rather than taking advantage of the power of
        the digital circuit, CAS simulates analog channels. CAS works by
        stealing bits from the audio stream for signaling purposes. Although
        the effect on audio quality is not really noticeable, the lack of a
        powerful signaling channel limits your flexibility.</p><p><a id="Understanding_Telephony_id250391"></a>When configuring a CAS T1,
        the signaling options at each end must match. E&amp;M (Ear &amp; Mouth
        or recEive &amp; transMit) signaling is generally preferred, as it
        offers the best supervision. Having said that, in an Asterisk
        environment the most likely reason for you to use CAS would be for a
        channel bank, which means you are most likely going to have to use FXS
        signaling.</p><p><a id="Understanding_Telephony_id250434"></a>CAS is very rarely used on
        PSTN circuits anymore, due to the superiority of ISDN-PRI. One of the
        limitations of CAS is that it does not allow the dynamic assignment of
        channels to different functions. Also, caller ID information (which
        may not even be supported) has to be sent as part of the audio stream.
        CAS is commonly used on the T1 link in channel banks.</p></div><div class="sect3" title="ISDN"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2.2"></a>ISDN</h4></div></div></div><p><a id="Understanding_Telephony_id254175"></a><a id="I_indexterm_d1e57540" class="indexterm"></a>The Integrated Services Digital Network (ISDN) has been
        around for more than 20 years. Because it separates the channels that
        carry the traffic (the bearer channels, or B-channels) from the
        channel that carries the signaling information (the D-channel), ISDN
        allows for the delivery of a much richer set of features than
        CAS.</p><p><a id="Understanding_Telephony_id254207"></a>In the beginning, ISDN
        promised to deliver much the same sort of functionality that the
        Internet has given us, including advanced capabilities for voice,
        video, and data transfer. Unfortunately, rather than ratifying a
        standard and sticking to it, the respective telecommunications
        manufacturers all decided to add their own tweaks to the protocol, in
        the belief that their versions were superior and would eventually come
        to dominate the market. As a result, getting two ISDN-compliant
        systems to connect to each other was often a painful and expensive
        task. The carriers who had to implement and support this expensive
        technology, in turn, priced it so that it was not rapidly adopted.
        Currently, ISDN is rarely used for much more than basic trunking—in
        fact, the acronym ISDN has become a joke in the industry: “It Still
        Does Nothing.”</p><p><a id="Understanding_Telephony_id254222"></a>Having said that, ISDN has
        become quite popular for trunking, and it is now (mostly)
        standards-compliant. If you have a PBX with more than a dozen lines
        connected to the PSTN, there’s a very good chance that you’ll be
        running an ISDN-<span class="emphasis"><em>PRI</em></span> (Primary Rate Interface)
        circuit. Also, in places where DSL and cable access to the Internet
        are not available (or are too expensive), an
        ISDN-<span class="emphasis"><em>BRI</em></span> (Basic Rate Interface) circuit might
        provide you with an affordable 128-Kbps connection. In much of North
        America, the use of BRI for Internet connectivity has been deprecated
        in favor of DSL and cable modems (and it is never used for voice), but
        in many European countries it has almost totally replaced analog
        circuits.</p><div class="sect4" title="ISDN-BRI/BRA"><div class="titlepage"><div><div><h5 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2.2.1"></a>ISDN-BRI/BRA</h5></div></div></div><p><a id="Understanding_Telephony_id250593"></a>The Basic Rate Interface
          (or Basic Rate Access) flavor of ISDN is designed to service small
          endpoints such as workstations.</p><p><a id="Understanding_Telephony_id250619"></a>This flavor is often
          referred to simply as “ISDN,” but this can be a source of confusion,
          as ISDN is a protocol, not a type of circuit (not to mention that
          PRI circuits are also correctly referred to as ISDN!).</p><p><a id="Understanding_Telephony_id250626"></a>A Basic Rate ISDN
          circuit consists of two 64-Kbps B-channels controlled by a 16-Kbps
          D-channel, for a total of 144 Kbps.</p><p><a id="Understanding_Telephony_id250630"></a>Basic Rate ISDN has been
          a source of much confusion during its life, due to problems with
          standards compliance, technical complexity, and poor documentation.
          Still, many European telecos have widely implemented ISDN-BRI, and
          thus it is more popular in Europe than in North America.</p></div><div class="sect4" title="ISDN-PRI/PRA"><div class="titlepage"><div><div><h5 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2.2.2"></a>ISDN-PRI/PRA</h5></div></div></div><p><a id="Understanding_Telephony_id250645"></a>The Primary Rate
          Interface (or Primary Rate Access) flavor of ISDN is used to provide
          ISDN service over larger network connections. A Primary Rate ISDN
          circuit uses a single DS-0 channel as a signaling link (the
          D-channel); the remaining channels serve as B-channels.</p><p><a id="Understanding_Telephony_id250673"></a>In North America,
          Primary Rate ISDN is commonly carried on one or more T1 circuits.
          Since a T1 has 24 channels, a North American PRI circuit typically
          consists of 23 B-channels and 1 D-channel. For this reason, PRI is
          often referred to as 23B+D.<sup>[<a id="asterisk-UnderstandingTelephony-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingTelephony-FN-12" class="footnote">200</a>]</sup></p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingTelephony-NOTE-42"></a>Tip</h3><p><a id="Understanding_Telephony_id250707"></a>In Europe, a
            32-channel E1 circuit is used, so a Primary Rate ISDN <span class="keep-together">circuit</span> is referred to as 30B+D (the
            final channel is used for <span class="keep-together">synchronization</span>).</p></div><p><a id="Understanding_Telephony_id250718"></a>Primary Rate ISDN is
          very popular, due to its technical benefits and generally
          competitive pricing at higher densities. If you believe you will
          require more than a dozen or so PSTN lines, you should look into
          Primary Rate ISDN pricing.</p><p><a id="Understanding_Telephony_id250723"></a>From a technical
          perspective, ISDN-PRI is always preferable to CAS.</p></div></div><div class="sect3" title="Signaling System 7"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingTelephony-SECT-3.2.3"></a>Signaling System 7</h4></div></div></div><p><a id="Understanding_Telephony_id250737"></a><a id="I_indexterm_d1e57592" class="indexterm"></a><a id="I_indexterm_d1e57595" class="indexterm"></a>Signaling System 7 (SS7) is the signaling system used by
        carriers. It is conceptually similar to ISDN, and it is instrumental
        in providing a mechanism for the carriers to transmit the additional
        information ISDN endpoints typically need to pass. However, the
        technology of SS7 is different from that of ISDN; one big difference
        is that SS7 runs on a completely separate network than the actual
        trunks that carry the calls.</p><p><a id="Understanding_Telephony_id250766"></a>SS7 support in Asterisk is
        on the horizon, as there is much interest in making Asterisk
        compatible with the carrier networks. An open source version of SS7
        (<a class="ulink" href="http://www.openss7.org/" target="_top">http://www.openss7.org</a>) exists, but work is
        still needed for full SS7 compliance, and as of this writing it is not
        known whether this version will be integrated with Asterisk. Another
        promising source of SS7 support comes from Sangoma Technologies, which
        offers SS7 functionality in many of its products.</p><p><a id="Understanding_Telephony_id250782"></a>It should be noted that
        adding support for SS7 in Asterisk is not going to be as simple as
        writing a proper driver. Connecting equipment to an SS7 network will
        not be possible without that equipment having passed extremely
        rigorous certification processes. Even then, it seems doubtful that
        any traditional carrier is going to be in a hurry to allow such a
        thing to happen, mostly for strategic and political reasons.<a id="I_indexterm_d1e57605" class="indexterm"></a><a id="I_indexterm_d1e57606" class="indexterm"></a><a id="I_indexterm_d1e57607" class="indexterm"></a></p></div></div></div><div class="sect1" title="Packet-Switched Networks"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingTelephony-SECT-4"></a>Packet-Switched Networks</h2></div></div></div><p><a id="Understanding_Telephony_id250826"></a><a id="I_indexterm_d1e57612" class="indexterm"></a><a id="I_indexterm_d1e57617" class="indexterm"></a><a id="I_indexterm_d1e57622" class="indexterm"></a>In the mid-1990s, network performance improved to the point
    where it became possible to send a stream of media information in real
    time across a network connection. Because the media stream is chopped up
    into segments, which are then wrapped in an addressing envelope, such
    connections are referred to as <span class="emphasis"><em>packet-based</em></span>. The
    challenge, of course, is to send a flood of these packets between two
    endpoints, ensuring that the packets arrive in the same order in which
    they were sent, in less than 150 milliseconds, with none lost. This is the
    essence of Voice over IP.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingTelephony-SECT-5"></a>Conclusion</h2></div></div></div><p><a id="Understanding_Telephony_id272646"></a>This appendix has explored the
    technologies currently in use in the PSTN. In <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>, we will discuss protocols for
    VoIP: the carrying of telephone connections across IP-based networks.
    These protocols define different mechanisms for carrying telephone
    conversations, but their significance is far greater than just that.
    Bringing the telephone network into the data network will finally erase
    the line between telephones and computers, which holds the promise of a
    revolutionary evolution in the way we <span class="keep-together">communicate</span>.<a id="I_indexterm_d1e57642" class="indexterm"></a><a id="I_indexterm_d1e57643" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-2" class="para">188</a>] </sup>If you want to play around with what different frequencies look
        like on an oscilloscope, grab a copy of Sound Frequency Analyzer, from
        Reliable Software. It’s a really simple and fun way to visualize what
        sounds “look” like. The spectrograph gives a good picture of the
        complex harmonics our voices can generate, as well as an appreciation
        for the background sounds that always surround us. You should also try
        the delightfully annoying NCH Tone Generator, from NCH Swift
        Sound.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-3" class="para">189</a>] </sup>When referring to the state of an analog circuit, people
              often speak in terms of “off-hook” and “on-hook.” When your line
              is “off-hook,” your telephone is “on” a call. If your phone is
              “on-hook,” the telephone is essentially “off,” or idle.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-4" class="para">190</a>] </sup>They may have other names elsewhere in the world (such as “A”
          and “B”).</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-5" class="para">191</a>] </sup>“The Last Mile” is a term that was originally used to describe
        the only portion of the PSTN that had not been converted to fiber
        optics: the connection between the central office and the customer.
        The Last Mile is more than that, however, as it also has significance
        as a valuable asset of the traditional phone companies; they own a
        connection into your home. The Last Mile is becoming more and more
        difficult to describe in technical terms, as there are now so many
        ways to connect the network to the customer. As a thing of strategic
        value to telecom, cable, and other utilities, its importance is
        obvious.</p></div><div class="footnote"><p><sup>[<a id="ftn.id669839" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id669839" class="para">192</a>] </sup>Amplitude is essentially the power or strength of the
            signal. If you have ever held a skipping rope or garden hose and
            given it a whip, you have seen the resultant wave. The taller the
            wave, the greater the amplitude.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-7" class="para">193</a>] </sup>Nyquist published two papers, “Certain Factors Affecting
            Telegraph Speed” (1924) and “Certain Topics in Telegraph
            Transmission Theory” (1928), in which he postulated what became
            known as Nyquist’s Theorem. Proven in 1949 by Claude Shannon
            (“Communication in the Presence of Noise”), it is also referred to
            as the Nyquist-Shannon sampling theorem.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-8" class="para">194</a>] </sup>μlaw is often referred to as “ulaw” because, let’s face it,
            how many of us have μ keys on our keyboards? μ is in fact the
            Greek letter Mu; thus, you will also see μlaw written (more
            correctly) as “Mu-law.” When spoken, it is correct to confidently
            say “Mew-law,” but if folks look at you strangely, and you’re
            feeling generous, you can help them out and tell them it’s “ulaw.”
            Many people just don’t appreciate trivia.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-9" class="para">195</a>] </sup>A low-pass filter, as its name implies, allows through only
            frequencies that are lower than its cut off frequency. Other types
            of filters are high-pass filters (which remove low frequencies)
            and band-pass filters (which filter out both high and low
            frequencies).</p></div><div class="footnote"><p><sup>[<a id="ftn.id670978" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id670978" class="para">196</a>] </sup>If you ever have to do audio recordings for a system, you
            might want to take advantage of the band-pass filter that is built
            into most telephone sets. Doing a recording using even high-end
            recording equipment can pick up all kinds of background noise that
            you don’t even hear until you downsample, at which point the
            background noise produces aliasing (which can sound like all kinds
            of weird things). Conversely, the phone records in the correct
            format already, so the noise never enters the audio stream. Having
            said all that, no matter what you use to do recordings, avoid
            environments that have a lot of background noise. Typical offices
            can be a lot noisier than you’d think, as HVAC equipment can
            produce noise that we don’t even realize is there.</p></div><div class="footnote"><p><sup>[<a id="ftn.id671141" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id671141" class="para">197</a>] </sup>Digital telephone sets (including IP sets) do the
            analog-to-digital conversion right at the point where the handset
            plugs into the phone, so the DS-0 is created right at the phone
            set.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-10" class="para">198</a>] </sup>The 24 DS-0s use 1.536 Mbps, and the remaining .008 Mbps is
            used by framing bits.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-11" class="para">199</a>] </sup>Conférence Européenne des Administrations des Postes et
              des Télécommunications.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingTelephony-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-FN-12" class="para">200</a>] </sup>PRI is actually quite a bit more flexible than that, as it
              is possible to span a single PRI circuit across multiple T1
              spans. This can give rise, for example, to a 47B+D circuit
              (where a single D-channel serves two T1s) or a 46B+2D circuit
              (where primary and backup D-channels serve a pair of T1s). You
              will sometimes see PRI described as nB+nD, because the number of
              B- and D-channels is, in fact, quite variable. For this reason,
              you should never refer to a T1 carrying PRI as “a PRI.” For all
              you know, the PRI circuit spans multiple T1s, as is common in
              larger PBX deployments.</p></div></div></div><div class="appendix" title="Appendix B. Protocols for VoIP"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-UnderstandingVoIP"></a>Appendix&nbsp;B.&nbsp;Protocols for VoIP</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-1">The Need for VoIP Protocols</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2">VoIP Protocols</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1">IAX (The “Inter-Asterisk eXchange” Protocol)</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.4">IAX and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2">SIP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.4">SIP and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3">H.323</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.1">History</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.2">Future</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.3">Security considerations</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.4">H.323 and NAT</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.4">MGCP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5">Proprietary Protocols</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.1">Skinny/SCCP</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.2">UNISTIM</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.1">G.711</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.2">G.726</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.4">G.729A</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.5">GSM</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.6">iLBC</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.7">Speex</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id318733">G.722</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.8">MP3</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4">Quality of Service</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1">TCP, UDP, and SCTP</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.1">Transmission Control Protocol</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.2">User Datagram Protocol</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.3">Stream Control Transmission Protocol</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.2">Differentiated Service</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3">Guaranteed Service</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.1">MPLS</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.2">RSVP</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.4">Best Effort</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5">Echo</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.1">Why Echo Occurs</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.2">Managing Echo on DAHDI Channels</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6">Asterisk and VoIP</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1">Users and Peers and Friends—Oh My!</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.1">Users</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.2">Peers</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.3">Friends</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.2">register Statements</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect18_tt1164">VoIP Security</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241778">Spam over Internet Telephony (SPIT)</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241852">Spoofing</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241868">What Can Be Done?</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241880">Basic network security</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252454">Encryption</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-7">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Understanding_VoIP_id250989"></a><span class="emphasis"><em>The Internet is a
    telephone system that’s gotten uppity</em></span>.</p><div class="attribution"><span>—<span class="attribution">Clifford Stoll</span></span></div></div><p><a id="Understanding_VoIP_id287766"></a><a id="index-787P070FV8S" class="indexterm"></a>The telecommunications industry spans over 100 years, and
  Asterisk integrates <span class="keep-together">most—</span>if not all—of
  the major technologies that it has made use of over the last century. To
  make the most out of Asterisk, you need not be a professional in all areas,
  but understanding the differences between the various codecs and protocols
  will give you a greater appreciation and understanding of the system as a
  whole.</p><p><a id="Understanding_VoIP_id287682"></a>This appendix explains Voice over IP
  and what makes VoIP networks different from the traditional circuit-switched
  voice networks that were the topic of <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>. We will explore the need for
  VoIP protocols, outlining the history and potential future of each. We’ll
  also look at security considerations and these protocols’ abilities to work
  within topologies such as Network Address Translation (NAT). The following
  VoIP protocols will be discussed (some more briefly than others):</p><div class="itemizedlist"><a id="Understanding_VoIP_id259659"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Understanding_VoIP_id282638"></a><a id="Understanding_VoIP_id281869"></a>IAX</p></li><li class="listitem"><p><a id="Understanding_VoIP_id261683"></a><a id="Understanding_VoIP_id268239"></a>SIP</p></li><li class="listitem"><p><a id="Understanding_VoIP_id289611"></a><a id="Understanding_VoIP_id250999"></a>H.323</p></li><li class="listitem"><p><a id="Understanding_VoIP_id284674"></a><a id="Understanding_VoIP_id254468"></a>MGCP</p></li><li class="listitem"><p><a id="Understanding_VoIP_id254472"></a><a id="Understanding_VoIP_id254474"></a>Skinny/SCCP</p></li><li class="listitem"><p><a id="Understanding_VoIP_id254478"></a><a id="Understanding_VoIP_id254481"></a>UNISTIM</p></li></ul></div><p><a id="Understanding_VoIP_id254486"></a>Codecs are the means by which analog
  voice can be converted to a digital signal and carried across the Internet.
  Bandwidth at any location is finite, and the number of simultaneous
  conversations any connection can carry is directly related to the type of
  codec implemented. We’ll also explore the differences between the following
  codecs in regard to bandwidth requirements (compression level) and
  quality:</p><div class="itemizedlist"><a id="Understanding_VoIP_id284710"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Understanding_VoIP_id284712"></a><a id="Understanding_VoIP_id284714"></a>G.711</p></li><li class="listitem"><p><a id="Understanding_VoIP_id284718"></a><a id="Understanding_VoIP_id284721"></a>G.726</p></li><li class="listitem"><p><a id="Understanding_VoIP_id284725"></a><a id="Understanding_VoIP_id284727"></a>G.729A</p></li><li class="listitem"><p><a id="Understanding_VoIP_id284731"></a><a id="Understanding_VoIP_id249952"></a>GSM</p></li><li class="listitem"><p><a id="Understanding_VoIP_id249956"></a><a id="Understanding_VoIP_id249959"></a>iLBC</p></li><li class="listitem"><p><a id="Understanding_VoIP_id249963"></a><a id="Understanding_VoIP_id249965"></a>Speex</p></li><li class="listitem"><p><a id="Understanding_VoIP_id249969"></a><a id="Understanding_VoIP_id249971"></a>MP3</p></li></ul></div><p><a id="Understanding_VoIP_id249977"></a>We will then conclude the appendix
  with a discussion of how voice traffic can be routed reliably, what causes
  echo and how to deal with it, and how Asterisk controls the authentication
  of inbound and outbound calls.</p><div class="sect1" title="The Need for VoIP Protocols"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-1"></a>The Need for VoIP Protocols</h2></div></div></div><p><a id="Understanding_VoIP_id249990"></a>The basic premise of VoIP is the
    packetization<sup>[<a id="asterisk-UnderstandingVoIP-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-1" class="footnote">201</a>]</sup> of audio streams for transport over Internet Protocol-based
    networks. The challenges to accomplishing this relate to the manner in
    which humans communicate. Not only must the signal arrive in essentially
    the same form that it was transmitted in, but it needs to do so in less
    than 150 milliseconds. If packets are lost or delayed, there will be
    degradation to the quality of the communications experience, meaning that
    two people will have difficulty in carrying on a conversation.</p><p><a id="Understanding_VoIP_id262401"></a>The transport protocols that
    collectively are called “the Internet” were not originally designed with
    real-time streaming of media in mind. Endpoints were expected to resolve
    missing packets by waiting longer for them to arrive, requesting
    retransmission, or, in some cases, considering the information to be gone
    for good and simply carrying on without it. In a typical voice
    conversation, these mechanisms will not serve. Our conversations do not
    adapt well to the loss of letters or words, nor to any appreciable delay
    between transmittal and receipt.</p><p><a id="Understanding_VoIP_id262410"></a>The traditional PSTN was designed
    specifically for the purpose of voice transmission, and it is perfectly
    suited to the task from a technical standpoint. From a flexibility
    standpoint, however, its flaws are obvious to even people with a very
    limited understanding of the technology. VoIP holds the promise of
    incorporating voice communications into all of the other protocols we
    carry on our networks, but due to the special demands of a voice
    conversation, special skills are needed to design, build, and maintain
    these networks.</p><p><a id="Understanding_VoIP_id262418"></a>The problem with packet-based voice
    transmission stems from the fact that the way in which we speak is totally
    incompatible with the way in which IP transports data. Speaking and
    listening consist of the relaying of a stream of audio, whereas the
    Internet protocols are designed to chop everything up, encapsulate the
    bits of information into thousands of packages, and then deliver each
    package in whatever way possible to the far end. Clearly, some way of
    dealing with this is required.</p></div><div class="sect1" title="VoIP Protocols"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-2"></a>VoIP Protocols</h2></div></div></div><p><a id="Understanding_VoIP_id262445"></a><a id="index-660K105UH0W" class="indexterm"></a>The mechanism for carrying a VoIP connection generally
    involves a series of signaling transactions between the endpoints (and
    gateways in between), culminating in two persistent media streams (one for
    each direction) that carry the actual conversation. There are several
    protocols in existence to handle this. In this section, we will discuss
    some that are important to VoIP in general and to Asterisk
    specifically.</p><div class="sect2" title="IAX (The “Inter-Asterisk eXchange” Protocol)"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.1"></a>IAX (The “Inter-Asterisk eXchange” Protocol)</h3></div></div></div><p><a id="Understanding_VoIP_id262461"></a><a id="index-216B125PW0C" class="indexterm"></a><a id="index-688W728QS0O" class="indexterm"></a>If you claim to be one of the folks in the know when it
      comes to Asterisk, your test will come when you have to pronounce the
      name of this protocol. It would seem that you should say “eye-ay-ex,”
      but this hardly rolls off the tongue very well.<sup>[<a id="id673079" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id673079" class="footnote">202</a>]</sup> Fortunately, the proper pronunciation is in fact
      “eeks.”<sup>[<a id="id673085" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id673085" class="footnote">203</a>]</sup> IAX is an open protocol, meaning that anyone can download
      and develop for it.<sup>[<a id="asterisk-UnderstandingVoIP-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-2" class="footnote">204</a>]</sup></p><p><a id="Understanding_VoIP_id265035"></a>In Asterisk, IAX is supported by
      the <span class="emphasis"><em>chan_iax2.so</em></span> module.</p><div class="sect3" title="History"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.1.1"></a>History</h4></div></div></div><p><a id="Understanding_VoIP_id265050"></a>The IAX protocol was developed
        by Digium for the purpose of communicating with other Asterisk servers
        (hence the Inter-Asterisk eXchange protocol). It is very important to
        note that IAX is not at all limited to Asterisk. The standard is open
        for anyone to use, and it is supported by many other open source
        telecom projects, as well as by several hardware vendors. IAX is a
        transport protocol (much like SIP) that uses a single UDP port (4569)
        for both the channel signaling and media streams. As discussed later
        in this appendix, this makes it easier to manage when behind NATed
        firewalls.</p><p><a id="Understanding_VoIP_id265068"></a>IAX also has the unique ability
        to trunk multiple sessions into one dataflow, which can result in a
        tremendous bandwidth advantage when sending a lot of simultaneous
        channels to a remote box. Trunking allows multiple media streams to be
        represented with a single datagram header, which lowers the overhead
        associated with individual <span class="keep-together">channels</span>. This helps to lower latency
        and reduce the processing power and bandwidth required, allowing the
        protocol to scale much more easily with a large number of active
        channels between endpoints. If you have a large quantity of IP calls
        to pass between two endpoints, you should take a close look at IAX
        trunking.</p></div><div class="sect3" title="Future"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.1.2"></a>Future</h4></div></div></div><p><a id="Understanding_VoIP_id252885"></a>Since IAX was optimized for
        voice, it has received some criticism for not better supporting
        video—but in fact, IAX holds the potential to carry pretty much any
        media stream desired. Because it is an open protocol, future media
        types are certain to be incorporated as the community desires
        them.</p></div><div class="sect3" title="Security considerations"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.1.3"></a>Security considerations</h4></div></div></div><p><a id="Understanding_VoIP_id252903"></a><a id="I_indexterm_d1e57792" class="indexterm"></a>IAX includes the ability to authenticate in three ways:
        plain text, MD5 hashing, and RSA key exchange. This, of course, does
        nothing to encrypt the media path or headers between endpoints. Many
        solutions involve using a Virtual Private Network (VPN) appliance or
        software to encrypt the stream in another layer of technology, which
        requires the endpoints to pre-establish a method of configuring and
        opening these tunnels. However, IAX is now also able to encrypt the
        streams between endpoints with dynamic key exchange at call setup
        (using the configuration option <code class="literal">encryption=aes128</code>), allowing the use of
        automatic key rollover.</p></div><div class="sect3" title="IAX and NAT"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.1.4"></a>IAX and NAT</h4></div></div></div><p><a id="Understanding_VoIP_id252963"></a><a id="I_indexterm_d1e57805" class="indexterm"></a>The IAX2 protocol was deliberately designed to work from
        behind devices performing NAT. The use of a single UDP port for both
        signaling and transmission of media also keeps the number of holes
        required in your firewall to a minimum. These considerations have
        helped make IAX one of the easiest protocols (if not the easiest) to
        implement in secure networks.<a id="I_indexterm_d1e57811" class="indexterm"></a><a id="I_indexterm_d1e57812" class="indexterm"></a></p></div></div><div class="sect2" title="SIP"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.2"></a>SIP</h3></div></div></div><p><a id="Understanding_VoIP_id252980"></a><a id="index-865V635FS8Q" class="indexterm"></a><a id="index-177K621WS8A" class="indexterm"></a>The Session Initiation Protocol (SIP) has taken the
      telecommunications industry by storm. SIP has pretty much dethroned the
      once-mighty <span class="keep-together">H.323</span> as the VoIP
      protocol of choice—certainly at the endpoints of the network. The
      premise of SIP is that each end of a connection is a peer; the protocol
      negotiates capabilities between them. What makes SIP compelling is that
      it is a relatively simple protocol, with a syntax similar to that of
      other familiar protocols such as HTTP and SMTP. SIP is supported in
      Asterisk with the <span class="emphasis"><em>chan_sip.so</em></span> module.<sup>[<a id="id673350" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id673350" class="footnote">205</a>]</sup></p><div class="sect3" title="History"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.2.1"></a>History</h4></div></div></div><p><a id="Understanding_VoIP_id252058"></a>SIP was originally submitted to
        the Internet Engineering Task Force (IETF) in February 1996 as
        “draft-ietf-mmusic-sip-00.” The initial draft looked nothing like the
        SIP we know today and contained only a single request type: a call
        setup request. In March 1999, after 11 revisions, SIP RFC 2543 was
        born.</p><p><a id="Understanding_VoIP_id252087"></a>At first, SIP was all but
        ignored, as H.323 was considered the protocol of choice for VoIP
        transport negotiation. However, as the buzz grew, SIP began to gain in
        popularity, and while there may be a lot of different factors that
        accelerated its growth, we’d like to think that a large part of its
        success is due to its freely available specification.</p><p><a id="Understanding_VoIP_id252097"></a>SIP is an application-layer
        signaling protocol that uses the well-known port 5060 for
        communications. SIP can be transported with either the UDP or TCP
        transport-layer protocols. Asterisk does not currently have a TCP
        implementation for transporting SIP messages, but it is possible that
        future versions may support it (and patches to the code base are
        gladly accepted). SIP is used to “establish, modify, and terminate
        multimedia sessions such as Internet telephony calls.”<sup>[<a id="asterisk-CHP-4-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-CHP-4-FN-8" class="footnote">206</a>]</sup></p><p><a id="Understanding_VoIP_id252115"></a>SIP does not transport media
        (i.e., voice) between <span class="keep-together">endpoints</span>.
        Instead, the Real-time Transport Protocol (RTP) is used for this
        purpose. RTP uses high-numbered, unprivileged ports in Asterisk
        (10,000 through 20,000, by default).</p><p><a id="Understanding_VoIP_id252129"></a>A common topology to illustrate
        SIP and RTP, commonly referred to as the “SIP trapezoid,” is shown in
        <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FIG-1" title="Figure B.1. The SIP trapezoid">Figure&nbsp;B.1, “The SIP trapezoid”</a>. When Alice wants
        to call Bob, Alice’s phone contacts her proxy server, and the proxy
        tries to find Bob (often connecting through his proxy). Once the
        phones have started the call, they communicate directly with each
        other (if possible), so that the data doesn’t have to tie up the
        resources of the proxy.</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingVoIP-FIG-1"></a><p class="title"><strong>Figure&nbsp;B.1.&nbsp;The SIP trapezoid</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject8_tt1103"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_ab01.png" alt="The SIP trapezoid"></div></div></div><br class="figure-break"></div><p><a id="Understanding_VoIP_id252303"></a>SIP was not the first, and is
        not the only, VoIP protocol in use today (others include <span class="keep-together">H.323</span>, MGCP, IAX, and so on), but
        currently it seems to have the most momentum with hardware vendors.
        The advantages of the SIP protocol lie in its wide acceptance and
        architectural flexibility (and, we used to say, simplicity!).</p></div><div class="sect3" title="Future"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.2.2"></a>Future</h4></div></div></div><p><a id="Understanding_VoIP_id252319"></a>SIP has earned its place as the
        protocol that justified VoIP. All new user and enterprise products are
        expected to support SIP, and any existing products will now be a tough
        sell unless a migration path to SIP is offered. SIP is widely expected
        to deliver far more than VoIP capabilities, including the ability to
        transmit video, music, and any type of real-time multimedia. While its
        use as a ubiquitous general-purpose media transport mechanism seems
        doubtful, SIP is unarguably poised to deliver the majority of new
        voice applications for the next few years.</p></div><div class="sect3" title="Security considerations"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.2.3"></a>Security considerations</h4></div></div></div><p><a id="Understanding_VoIP_id252337"></a><a id="I_indexterm_d1e57880" class="indexterm"></a>SIP uses a challenge/response system to authenticate
        users. An initial <code class="literal">INVITE</code> is sent to
        the proxy with which the end device wishes to communicate. The proxy
        then sends back a 407 Proxy Authorization Request message, which
        contains a random set of characters referred to as a
        <span class="emphasis"><em>nonce</em></span>. This nonce is used along with the password
        to generate an MD5 hash, which is then sent back in the subsequent
        <code class="literal">INVITE</code>. Assuming the MD5 hash
        matches the one that the proxy generated, the client is then
        authenticated.</p><p><a id="Understanding_VoIP_id252368"></a>Denial of service (DoS) attacks
        are probably the most common type of attack on VoIP communications. A
        DoS attack can occur when a large number of invalid <code class="literal">INVITE</code> requests are sent to a proxy server
        in an attempt to overwhelm the system. These attacks are relatively
        simple to implement, and their effects on the users of the system are
        immediate. SIP has several methods of minimizing the effects of DoS
        attacks, but ultimately they are impossible to prevent.</p><p><a id="Understanding_VoIP_id265677"></a>SIP implements a scheme to
        guarantee that a secure, encrypted transport mechanism (namely
        Transport Layer Security, or TLS) is used to establish communication
        between the caller and the domain of the callee. Beyond that, the
        request is sent securely to the end device, based upon the local
        security policies of the network. Note that the encryption of the
        media (that is, the RTP stream) is beyond the scope of SIP itself and
        must be dealt with separately.</p><p><a id="Understanding_VoIP_id265703"></a>More information regarding SIP
        security considerations, including registration hijacking, server
        impersonation, and session teardown, can be found in Section 26 of
        <span class="keep-together">SIP RFC 3261</span>.</p></div><div class="sect3" title="SIP and NAT"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.2.4"></a>SIP and NAT</h4></div></div></div><p><a id="Understanding_VoIP_id265718"></a><a id="I_indexterm_d1e57911" class="indexterm"></a>Probably the biggest technical hurdle SIP has to conquer
        is the challenge of carrying out transactions across a NAT layer.
        Because SIP encapsulates addressing information in its data frames,
        and NAT happens at a lower network layer, the addressing information
        is not automatically modified, and thus the media streams will not
        have the correct addressing information needed to complete the
        connection when NAT is in place. In addition to this, the firewalls
        normally integrated with NAT will not consider the incoming media
        stream to be part of the SIP transaction, and will block the
        connection. Newer firewalls and session border controllers (SBCs) are
        SIP-aware, but this is still considered a shortcoming in this
        protocol, and it causes no end of trouble to network professionals
        needing to connect SIP endpoints using existing network <span class="keep-together">infrastructure</span>.<a id="I_indexterm_d1e57920" class="indexterm"></a><a id="I_indexterm_d1e57921" class="indexterm"></a></p></div></div><div class="sect2" title="H.323"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.3"></a>H.323</h3></div></div></div><p><a id="Understanding_VoIP_id265769"></a><a id="index-838D480GB1O" class="indexterm"></a><a id="index-736S347SJ5Q" class="indexterm"></a>This International Telecommunication Union (ITU) protocol
      was originally designed to provide an IP transport mechanism for
      videoconferencing. It has become the standard in IP-based
      video-conferencing equipment, and it briefly enjoyed fame as a VoIP
      protocol as well. While there is much heated debate over whether SIP or
      H.323 (or IAX) will come to dominate the VoIP protocol world, in
      Asterisk, H.323 has largely been deprecated in favor of IAX and SIP.
      H.323 has not enjoyed much success among users and enterprises, although
      it might still be the most widely used VoIP protocol among
      carriers.</p><p><a id="Understanding_VoIP_id241212"></a>The three versions of H.323
      supported in Asterisk are handled by the modules <code class="filename">chan_h323.so</code> (supplied with Asterisk),
      <code class="filename">chan_oh323.so</code> (available as a free
      addon), and <code class="filename">chan_ooh323.so</code>
      (supplied in <code class="filename">asterisk-addons</code>).</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingVoIP-NOTE-43"></a>Tip</h3><p><a id="Understanding_VoIP_id241250"></a>You have probably used H.323
        without even knowing it—Microsoft’s NetMeeting client is arguably the
        most widely deployed H.323 client.</p></div><div class="sect3" title="History"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.3.1"></a>History</h4></div></div></div><p><a id="Understanding_VoIP_id265943"></a>H.323 was developed by the ITU
        in May 1996 as a means to transmit voice, video, data, and fax
        communications across an IP-based network while maintaining
        connectivity with the PSTN. Since that time, H.323 has gone through
        several versions and annexes (which add functionality to the
        protocol), allowing it to operate in pure VoIP networks and more
        widely distributed networks.</p></div><div class="sect3" title="Future"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.3.2"></a>Future</h4></div></div></div><p><a id="Understanding_VoIP_id265960"></a>The future of H.323 is a
        subject of debate. If the media is any measure, it doesn’t look good
        for H.323; it hardly ever gets mentioned (certainly not with the
        regularity of SIP). H.323 is often regarded as technically superior to
        SIP, but, that sort of thing is seldom the deciding factor in whether
        a technology enjoys success. One of the factors that makes H.323
        unpopular is its complexity (although many argue that the once-simple
        SIP is starting to suffer from the same problem).</p><p><a id="Understanding_VoIP_id265970"></a>H.323 still carries by far the
        majority of worldwide carrier VoIP traffic, but as people become less
        and less dependent on traditional carriers for their telecom needs,
        the future of H.323 becomes more difficult to predict with any
        certainty. While H.323 may not be the protocol of choice for new
        implementations, we can certainly expect to have to deal with H.323
        interoperability issues for some time to come.</p></div><div class="sect3" title="Security considerations"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.3.3"></a>Security considerations</h4></div></div></div><p><a id="Understanding_VoIP_id265986"></a><a id="I_indexterm_d1e57968" class="indexterm"></a>H.323 is a relatively secure protocol and does not
        require many security considerations beyond those that are common to
        any network communicating with the Internet. Since H.323 uses the RTP
        protocol for media communications, it does not natively support
        encrypted media paths. The use of a VPN or other encrypted tunnel
        between endpoints is the most common way of securely encapsulating
        communications. Of course, this has the disadvantage of requiring the
        establishment of these secure tunnels between endpoints, which may not
        always be convenient (or even possible). As VoIP becomes used more
        often to communicate with financial institutions such as banks, we’re
        likely to require extensions to the most commonly used VoIP protocols
        to natively support strong encryption methods.</p></div><div class="sect3" title="H.323 and NAT"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.3.4"></a>H.323 and NAT</h4></div></div></div><p><a id="Understanding_VoIP_id266014"></a><a id="I_indexterm_d1e57978" class="indexterm"></a>The H.323 standard uses the Internet Engineering Task
        Force (IETF) RTP protocol to transport media between endpoints.
        Because of this, H.323 has the same issues as SIP when dealing with
        network topologies involving NAT. The easiest method is to simply
        forward the appropriate ports through your NAT device to the internal
        client.</p><p><a id="Understanding_VoIP_id266032"></a>To receive calls, you will
        always need to forward TCP port 1720 to the client. In addition, you
        will need to forward the UDP ports for the RTP media and RTCP control
        streams (see the manual for your device for the port range it
        requires). Older clients, such as Microsoft NetMeeting, will also
        require TCP ports forwarded for H.245 tunneling (again, see your
        client’s manual for the port number range).</p><p><a id="Understanding_VoIP_id266043"></a>If you have a number of clients
        behind the NAT device, you will need to use a
        <span class="emphasis"><em>gatekeeper</em></span> running in proxy mode. The gatekeeper
        will require an interface attached to the private IP subnet and the
        public Internet. Your H.323 client on the private IP subnet will then
        register to the gatekeeper, which will proxy calls on the clients’
        behalf. Note that any external clients that wish to call you will also
        be required to register with the proxy server.</p><p><a id="Understanding_VoIP_id266066"></a>At this time, Asterisk can’t
        act as an H.323 gatekeeper. You’ll have to use a separate application,
        such as the open source OpenH323 Gatekeeper (<a class="ulink" href="http://www.gnugk.org/" target="_top">http://www.gnugk.org</a>), for this purpose.<a id="I_indexterm_d1e57995" class="indexterm"></a><a id="I_indexterm_d1e57996" class="indexterm"></a></p></div></div><div class="sect2" title="MGCP"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.4"></a>MGCP</h3></div></div></div><p><a id="Understanding_VoIP_id257049"></a><a id="I_indexterm_d1e58001" class="indexterm"></a><a id="I_indexterm_d1e58006" class="indexterm"></a><a id="I_indexterm_d1e58009" class="indexterm"></a>The Media Gateway Control Protocol (MGCP) also comes to us
      from the IETF. While MGCP deployment is more widespread than one might
      think, it is quickly losing ground to protocols such as SIP and IAX.
      Still, Asterisk loves protocols, so naturally it has rudimentary support
      for it.</p><p><a id="Understanding_VoIP_id257072"></a>MGCP is defined in RFC
      3435.<sup>[<a id="asterisk-UnderstandingVoIP-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-3" class="footnote">207</a>]</sup> It was designed to make the end devices (such as phones)
      as simple as possible, and have all the call logic and processing
      handled by media gateways and call agents. Unlike SIP, MGCP uses a
      centralized model. MGCP phones cannot directly call other MGCP phones;
      they must always go through some type of controller.</p><p><a id="Understanding_VoIP_id257086"></a>Asterisk supports MGCP through
      the <span class="emphasis"><em>chan_mgcp.so</em></span> module, and the endpoints are
      defined in the configuration file <span class="emphasis"><em>mgcp.conf</em></span>. Since
      Asterisk provides only basic call agent services, it cannot emulate an
      MGCP phone (to register to another MGCP controller as a user agent, for
      example).</p><p><a id="Understanding_VoIP_id257098"></a>If you have some MGCP phones
      lying around, you will be able to use them with <span class="keep-together">Asterisk</span>. If you are planning to put MGCP
      phones into production on an Asterisk system, keep in mind that the
      community has moved on to more popular protocols, and you will therefore
      need to budget your software support needs accordingly. If possible (for
      example, with Cisco phones), you should upgrade MGCP phones to
      SIP.</p></div><div class="sect2" title="Proprietary Protocols"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.5"></a>Proprietary Protocols</h3></div></div></div><p><a id="Understanding_VoIP_id257114"></a>Finally, let’s take a look at two
      proprietary protocols that are supported in Asterisk.</p><div class="sect3" title="Skinny/SCCP"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.5.1"></a>Skinny/SCCP</h4></div></div></div><p><a id="Understanding_VoIP_id257136"></a><a id="I_indexterm_d1e58041" class="indexterm"></a><a id="I_indexterm_d1e58046" class="indexterm"></a><a id="I_indexterm_d1e58049" class="indexterm"></a>The Skinny Client Control Protocol (SCCP) is proprietary
        to Cisco VoIP equipment. It is the default protocol for endpoints on a
        Cisco Call Manager PBX.<sup>[<a id="id674196" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id674196" class="footnote">208</a>]</sup> Skinny is supported in Asterisk, but if you are
        connecting Cisco phones to Asterisk, it is generally recommended that
        you obtain SIP images for any phones that support this and connect via
        SIP instead.</p></div><div class="sect3" title="UNISTIM"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-2.5.2"></a>UNISTIM</h4></div></div></div><p><a id="Understanding_VoIP_id257193"></a><a id="I_indexterm_d1e58061" class="indexterm"></a><a id="I_indexterm_d1e58066" class="indexterm"></a>Asterisk’s Support for Nortel’s proprietary VoIP
        protocol, UNISTIM, makes it the first PBX in history to natively
        support proprietary IP terminals from the two biggest players in VoIP:
        Nortel and Cisco. UNISTIM support is totally experimental and does not
        yet work well enough to put it into production, but the fact that
        somebody has taken the trouble to implement it demonstrates the power
        of the Asterisk platform.<a id="I_indexterm_d1e58070" class="indexterm"></a></p></div></div></div><div class="sect1" title="Codecs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-3"></a>Codecs</h2></div></div></div><p><a id="Understanding_VoIP_id257225"></a><span class="emphasis"><em>Codecs</em></span><a id="index-086U713PM2U" class="indexterm"></a> are generally understood to be various mathematical models
    used to digitally encode (and compress) analog audio information. Many of
    these models take into account the human brain’s ability to form an
    impression from incomplete information. We’ve all seen optical illusions;
    likewise, voice-compression algorithms take advantage of our tendency to
    interpret what we <span class="emphasis"><em>believe</em></span> we should hear, rather than
    what we <span class="emphasis"><em>actually</em></span> hear.<sup>[<a id="asterisk-UnderstandingVoIP-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-4" class="footnote">209</a>]</sup> The purpose of the various encoding algorithms is to strike
    a balance between efficiency and quality.<sup>[<a id="asterisk-UnderstandingVoIP-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-5" class="footnote">210</a>]</sup></p><p><a id="Understanding_VoIP_id257292"></a>Originally, the term
    <span class="emphasis"><em>codec</em></span> referred to a COder/DECoder: a device that
    converts between analog and digital. Now, the term seems to relate more to
    COmpression/<span class="keep-together">DECompression</span>.</p><p><a id="Understanding_VoIP_id257305"></a>Before we dig into the individual
    codecs, take a look at <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-TABLE-1" title="Table B.1. Codec quick reference">Table&nbsp;B.1, “Codec quick reference”</a>—it’s a quick reference
    that you may want to refer back to.</p><div class="table"><a id="asterisk-UnderstandingVoIP-TABLE-1"></a><p class="title"><strong>Table&nbsp;B.1.&nbsp;Codec quick reference</strong></p><div class="table-contents"><table summary="Codec quick reference" border="1"><colgroup><col class="col1"><col class="col2"><col class="col3"></colgroup><thead><tr><th align="left">
              <p><a id="Understanding_VoIP_id257355"></a>Codec</p>
            </th><th align="left">
              <p><a id="Understanding_VoIP_id257364"></a>Data
            bitrate (Kbps)</p>
            </th><th align="left">
              <p><a id="Understanding_VoIP_id257372"></a>License
            required?</p>
            </th></tr></thead><tbody><tr><td align="left">
              <p><a id="Understanding_VoIP_id257388"></a>G.711
            <a id="I_indexterm_d1e58129" class="indexterm"></a><a id="I_indexterm_d1e58134" class="indexterm"></a></p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id257396"></a>64
            Kbps</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id257404"></a>No</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id257416"></a>G.726</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id257424"></a><a id="I_indexterm_d1e58149" class="indexterm"></a><a id="I_indexterm_d1e58152" class="indexterm"></a>16, 24, 32, or 40 Kbps</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id257433"></a>No</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id257445"></a>G.729A</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id257453"></a><a id="I_indexterm_d1e58167" class="indexterm"></a><a id="I_indexterm_d1e58170" class="indexterm"></a>8 Kbps</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243169"></a>Yes (no
            for pass-through)</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id243180"></a>GSM</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243189"></a><a id="I_indexterm_d1e58185" class="indexterm"></a><a id="I_indexterm_d1e58188" class="indexterm"></a>13 Kbps</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243197"></a>No</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id243209"></a>iLBC</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243217"></a><a id="I_indexterm_d1e58203" class="indexterm"></a>13.3 Kbps (30-ms frames) or 15.2 Kbps (20-ms
            frames)</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243226"></a>No</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id243237"></a>Speex</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243246"></a><a id="I_indexterm_d1e58218" class="indexterm"></a>Variable (between 2.15 and 22.4 Kbps)</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id243254"></a>No</p>
            </td></tr><tr><td align="left">
              <p><a id="Understanding_VoIP_id310865"></a>G.722</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id324887"></a><a id="I_indexterm_d1e58231" class="indexterm"></a><a id="I_indexterm_d1e58234" class="indexterm"></a>64 Kbps</p>
            </td><td align="left">
              <p><a id="Understanding_VoIP_id324894"></a>No</p>
            </td></tr></tbody></table></div></div><br class="table-break"><div class="sect2" title="G.711"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.1"></a>G.711</h3></div></div></div><p><a id="Understanding_VoIP_id243271"></a>G.711 is the fundamental codec of
      the PSTN. In fact, if someone refers to PCM (discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>) with respect to a
      telephone network, you are allowed to think of G.711. Two companding
      methods are used: μlaw in North America and alaw in the rest of the
      world. Either one delivers an 8-bit word transmitted 8,000 times per
      second. If you do the math, you will see that this requires 64,000 bits
      to be transmitted per second.</p><p><a id="Understanding_VoIP_id243291"></a>Many people will tell you that
      G.711 is an uncompressed codec. This is not exactly true, as companding
      is considered a form of compression. What is true is that G.711 is the
      base codec from which all of the others are derived.</p><p><a id="Understanding_VoIP_id243297"></a>G.711 imposes minimal (almost
      zero) load on the CPU.</p></div><div class="sect2" title="G.726"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.2"></a>G.726</h3></div></div></div><p><a id="Understanding_VoIP_id243310"></a><a id="I_indexterm_d1e58258" class="indexterm"></a><a id="I_indexterm_d1e58263" class="indexterm"></a>This codec has been around for some time (it used to be
      G.721, which is now obsolete), and it is one of the original compressed
      codecs. It is also known as Adaptive Differential Pulse-Code Modulation
      (ADPCM), and it can run at several bitrates. The most common rates are
      16 Kbps, 24 Kbps, and 32 Kbps. As of this writing, Asterisk supports
      only the ADPCM-32 rate, which is far and away the most popular rate for
      this codec.</p><p><a id="Understanding_VoIP_id243326"></a>G.726 offers nearly identical
      quality to G.711, but it uses only half the bandwidth. This is possible
      because rather than sending the result of the quantization measurement,
      it sends only enough information to describe the difference between the
      current sample and the previous one. G.726 fell from favor in the 1990s
      due to its inability to carry modem and fax signals, but because of its
      bandwidth/CPU performance ratio it is now making a comeback. G.726 is
      especially attractive because it does not require a lot of computational
      work from the system.</p></div><div class="sect2" title="G.729A"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.4"></a>G.729A</h3></div></div></div><p><a id="Understanding_VoIP_id243344"></a><a id="I_indexterm_d1e58273" class="indexterm"></a><a id="I_indexterm_d1e58278" class="indexterm"></a>Considering how little bandwidth it uses, G.729A delivers
      impressive sound quality. It does this through the use of
      Conjugate-Structure Algebraic-Code-Excited Linear Prediction
      (CS-ACELP).<sup>[<a id="asterisk-UnderstandingVoIP-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-6" class="footnote">211</a>]</sup> Because of patents, you can’t use G.729A without paying a
      licensing fee; however, it is extremely popular and is well supported on
      many different phones and systems.</p><p><a id="Understanding_VoIP_id243400"></a>To achieve its impressive
      compression ratio, this codec requires an equally impressive amount of
      effort from the CPU. In an Asterisk system, the use of heavily
      compressed codecs will quickly bog down the CPU.</p><p><a id="Understanding_VoIP_id243405"></a>G.729A uses 8 Kbps of
      bandwidth.</p></div><div class="sect2" title="GSM"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.5"></a>GSM</h3></div></div></div><p><a id="Understanding_VoIP_id243418"></a><a id="I_indexterm_d1e58299" class="indexterm"></a><a id="I_indexterm_d1e58304" class="indexterm"></a>The Global System for Mobile Communications (GSM) codec is
      the darling of Asterisk. This codec does not come encumbered with a
      licensing requirement the way that <span class="keep-together">G.729A</span> does, and it offers outstanding
      performance with respect to the demand it places on the CPU. The sound
      quality is generally considered to be of a lesser grade than that
      produced by G.729A, but much of this comes down to personal opinion; be
      sure to try it out. GSM operates at 13 Kbps.</p></div><div class="sect2" title="iLBC"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.6"></a>iLBC</h3></div></div></div><p><a id="Understanding_VoIP_id243443"></a><a id="I_indexterm_d1e58315" class="indexterm"></a><a id="I_indexterm_d1e58320" class="indexterm"></a>The Internet Low Bitrate Codec (iLBC) provides an
      attractive mix of low bandwidth usage and quality, and it is especially
      well suited to sustaining reasonable quality on lossy network
      links.</p><p><a id="Understanding_VoIP_id243465"></a>Naturally, Asterisk supports it
      (and support elsewhere is growing), but it is not as popular as the ITU
      codecs, and thus may not be compatible with common IP telephones and
      commercial VoIP systems. IETF RFCs 3951 and 3952 have been published in
      support of iLBC, and iLBC is on the IETF standards track.</p><p><a id="Understanding_VoIP_id243471"></a>Because iLBC uses complex
      algorithms to achieve its high levels of compression, it has a fairly
      high CPU cost in Asterisk.</p><p><a id="Understanding_VoIP_id243476"></a>While you are allowed to use iLBC
      without paying royalty fees, the holder of the iLBC patent, Global IP
      Sound (GIPS), wants to know whenever you use it in a commercial
      application. The way you do that is by downloading and printing a copy
      of the iLBC license, signing it, and returning it to GIPS. If you want
      to read about iLBC and its license, you can do so at <a class="ulink" href="http://www.ilbcfreeware.org/" target="_top">http://www.ilbcfreeware.org</a>.</p><p><a id="Understanding_VoIP_id243488"></a>iLBC operates at 13.3 Kbps (30-ms
      frames) and 15.2 Kbps (20-ms frames).</p></div><div class="sect2" title="Speex"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.7"></a>Speex</h3></div></div></div><p><a id="Understanding_VoIP_id243502"></a><a id="I_indexterm_d1e58340" class="indexterm"></a><a id="I_indexterm_d1e58345" class="indexterm"></a>Speex is a variable bitrate (VBR) codec, which means that
      it is able to dynamically modify its bitrate to respond to changing
      network conditions. It is offered in both narrowband and wideband
      versions, depending on whether you want telephone quality or
      better.</p><p><a id="Understanding_VoIP_id243516"></a>Speex is a totally free codec,
      licensed under the <span class="emphasis"><em>Xiph.org</em></span> variant of the BSD
      license.</p><p><a id="Understanding_VoIP_id243522"></a>An Internet draft for Speex is
      available, and more information about Speex can be found at its home
      page (<a class="ulink" href="http://www.speex.org/" target="_top">http://www.speex.org</a>).</p><p><a id="Understanding_VoIP_id243532"></a>Speex can operate at anywhere
      from 2.15 to 22.4 Kbps, due to its variable bitrate.</p></div><div class="sect2" title="G.722"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id318733"></a>G.722</h3></div></div></div><p><a id="Understanding_VoIP_id318738"></a><a id="I_indexterm_d1e58365" class="indexterm"></a><a id="I_indexterm_d1e58370" class="indexterm"></a>G.722 is an ITU-T standard codec that was approved in
      1988. The G.722 codec produces a much higher-quality voice in the same
      space as G.711 (64 Kbps) and is starting to become popular among VoIP
      device manufacturers. The patents for G.722 have expired, so it is
      freely available. If you have access to devices that support G.722,
      you’ll be impressed by the quality improvement.</p></div><div class="sect2" title="MP3"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-3.1.8"></a>MP3</h3></div></div></div><p><a id="Understanding_VoIP_id243546"></a><a id="I_indexterm_d1e58378" class="indexterm"></a><a id="I_indexterm_d1e58383" class="indexterm"></a>Sure thing, MP3 is a codec. Specifically, it’s the Moving
      Picture Experts Group Audio Layer 3 Encoding Standard.<sup>[<a id="asterisk-UnderstandingVoIP-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-7" class="footnote">212</a>]</sup> With a name like that, it’s no wonder we call it MP3! In
      Asterisk, the MP3 codec is typically used for music on hold (MoH). MP3
      is not a telephony codec, as it is optimized for music, not voice;
      nevertheless, it’s very popular with VoIP telephony systems as a method
      of delivering MoH.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingVoIP-NOTE-44"></a>Tip</h3><p><a id="Understanding_VoIP_id284834"></a>Be aware that music cannot
        usually be broadcast without a license. Many people assume that there
        is no legal problem with connecting a radio station or CD as a music
        on hold source, but this is very rarely true.<a id="I_indexterm_d1e58394" class="indexterm"></a></p></div></div></div><div class="sect1" title="Quality of Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-4"></a>Quality of Service</h2></div></div></div><p><a id="Understanding_VoIP_id284851"></a><a id="index-634N207JG2N" class="indexterm"></a>Quality of Service, or <span class="emphasis"><em>QoS</em></span> as it’s more
    popularly termed, refers to the challenge of delivering a time-sensitive
    stream of data across a network that was designed to deliver data in an ad
    hoc, best-effort sort of way. Although there is no hard rule, it is
    generally accepted that if you can deliver the sound produced by the
    speaker to the listener’s ear within 150 milliseconds, a normal flow of
    conversation is possible. When delay exceeds 300 milliseconds, it becomes
    difficult to avoid interrupting each other. Beyond 500 milliseconds,
    normal conversation becomes increasingly awkward and frustrating.</p><p><a id="Understanding_VoIP_id284879"></a>In addition to getting it there on
    time, it is also essential to ensure that the transmitted information
    arrives intact. Too many lost packets will prevent the far end from
    completely reproducing the sampled audio, and gaps in the data will be
    heard as static or, in severe cases, entire missed words or sentences.
    Even packet loss of 5 percent can severely impede a VoIP network.</p><div class="sect2" title="TCP, UDP, and SCTP"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.1"></a>TCP, UDP, and SCTP</h3></div></div></div><p><a id="Understanding_VoIP_id284894"></a>If you’re going to send data on
      an IP-based network, it will be transported using one of the three
      transport protocols discussed here.</p><div class="sect3" title="Transmission Control Protocol"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.1.1"></a>Transmission Control Protocol</h4></div></div></div><p><a id="Understanding_VoIP_id284908"></a><a id="I_indexterm_d1e58418" class="indexterm"></a><a id="I_indexterm_d1e58423" class="indexterm"></a>The Transmission Control Protocol (TCP) is almost never
        used for VoIP, for while it does have mechanisms in place to ensure
        delivery, it is not inherently in any hurry to do so. Unless there is
        an extremely low-latency interconnection between the two endpoints,
        TCP will tend to cause more problems than it solves.</p><p><a id="Understanding_VoIP_id284932"></a>The purpose of TCP is to
        guarantee the delivery of packets. In order to do this, several
        mechanisms are implemented, such as packet numbering (for
        reconstructing blocks of data), delivery acknowledgment, and
        re-requesting of lost packets. In the world of VoIP, getting the
        packets to the endpoint quickly is paramount—but 20 years of cellular
        telephony has trained us to tolerate a few lost packets.<sup>[<a id="asterisk-UnderstandingVoIP-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-8" class="footnote">213</a>]</sup></p><p><a id="Understanding_VoIP_id284956"></a>TCP’s high processing overhead,
        state management, and acknowledgment of arrival work well for
        transmitting large amounts of data, but they simply aren’t efficient
        enough for real-time media communications.</p></div><div class="sect3" title="User Datagram Protocol"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.1.2"></a>User Datagram Protocol</h4></div></div></div><p><a id="Understanding_VoIP_id284973"></a><a id="I_indexterm_d1e58440" class="indexterm"></a><a id="I_indexterm_d1e58445" class="indexterm"></a><a id="I_indexterm_d1e58448" class="indexterm"></a>Unlike TCP, the User Datagram Protocol (UDP) does not
        offer any sort of delivery guarantee. Packets are placed on the wire
        as quickly as possible and released into the world to find their way
        to their final destinations, with no word back as to whether they got
        there or not. Since UDP itself does not offer any kind of guarantee
        that the data will arrive,<sup>[<a id="asterisk-UnderstandingVoIP-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-9" class="footnote">214</a>]</sup> it achieves its efficiency by spending very little
        effort on what it is transporting.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-UnderstandingVoIP-NOTE-45"></a>Tip</h3><p><a id="Understanding_VoIP_id285015"></a>TCP is a more “socially
          responsible” protocol because the bandwidth is more evenly
          distributed to clients connecting to a server. As the percentage of
          UDP traffic increases, it is possible that a network could become
          overwhelmed.</p></div></div><div class="sect3" title="Stream Control Transmission Protocol"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.1.3"></a>Stream Control Transmission Protocol</h4></div></div></div><p><a id="Understanding_VoIP_id285033"></a><a id="I_indexterm_d1e58463" class="indexterm"></a><a id="I_indexterm_d1e58468" class="indexterm"></a>Approved by the IETF as a proposed standard in RFC 2960,
        SCTP is a relatively new transport protocol. From the ground up, it
        was designed to address the shortcomings of both TCP and UDP,
        especially as related to the types of services that used to be
        delivered over circuit-switched telephony networks.</p><p><a id="Understanding_VoIP_id285056"></a>Some of the goals of SCTP
        were:</p><div class="itemizedlist"><a id="Understanding_VoIP_id285059"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Understanding_VoIP_id285062"></a><a id="Understanding_VoIP_id285064"></a>Better congestion-avoidance
            techniques (specifically, avoiding denial of service <span class="keep-together">attacks</span>)</p></li><li class="listitem"><p><a id="Understanding_VoIP_id285069"></a><a id="Understanding_VoIP_id285071"></a>Strict sequencing of data
            delivery</p></li><li class="listitem"><p><a id="Understanding_VoIP_id285076"></a><a id="Understanding_VoIP_id285078"></a>Lower latency for improved
            real-time transmissions</p></li></ul></div><p><a id="Understanding_VoIP_id285083"></a>By addressing the major
        shortcomings of TCP and UDP, SCTP’s developers hoped to create a
        robust protocol for the transmission of SS7 and other types of PSTN
        signaling over an IP-based network.</p></div></div><div class="sect2" title="Differentiated Service"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.2"></a>Differentiated Service</h3></div></div></div><p><a id="Understanding_VoIP_id285099"></a><a id="I_indexterm_d1e58493" class="indexterm"></a><a id="I_indexterm_d1e58498" class="indexterm"></a>Differentiated service, or DiffServ, is not so much a QoS
      mechanism as a method by which traffic can be flagged and given specific
      treatment. Obviously, DiffServ can help to provide QoS by allowing
      certain types of packets to take precedence over others. While this will
      certainly increase the chance of a VoIP packet passing quickly through
      each link, it does not guarantee anything.</p></div><div class="sect2" title="Guaranteed Service"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.3"></a>Guaranteed Service</h3></div></div></div><p><a id="Understanding_VoIP_id285125"></a><a id="I_indexterm_d1e58506" class="indexterm"></a><a id="I_indexterm_d1e58511" class="indexterm"></a>The ultimate guarantee of QoS is provided by the PSTN. For
      each conversation, a 64-Kbps channel is completely dedicated to the
      call; the bandwidth is guaranteed. Similarly, protocols that offer
      guaranteed service can ensure that a required amount of bandwidth is
      dedicated to the connection being served. As with any packetized
      networking technology, these mechanisms generally operate best when
      traffic is below maximum levels. When a connection approaches its
      limits, it is next to impossible to eliminate degradation.</p><div class="sect3" title="MPLS"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.3.1"></a>MPLS</h4></div></div></div><p><a id="Understanding_VoIP_id285146"></a><a id="I_indexterm_d1e58519" class="indexterm"></a><a id="I_indexterm_d1e58522" class="indexterm"></a>Multiprotocol Label Switching (MPLS) is a method for
        engineering network traffic patterns independent of layer-3 routing
        tables. The protocol works by assigning short labels (MPLS frames) to
        network packets, which routers then use to forward the packets to the
        MPLS egress router, and ultimately to their final destinations.
        Traditionally, routers make an independent forwarding decision based
        on an IP table lookup at each hop in the network. In an MPLS network,
        this lookup is performed only once, when the packet enters the MPLS
        cloud at the ingress router. The packet is then assigned to a stream,
        referred to as a Label Switched Path (LSP), and identified by a label.
        The label is used as a lookup index in the MPLS forwarding table, and
        the packet traverses the LSP independent of layer-3 routing decisions.
        This allows the administrators of large networks to fine-tune routing
        decisions and make the best use of network resources. Additionally,
        information can be associated with a label to prioritize packet
        forwarding.</p></div><div class="sect3" title="RSVP"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.3.2"></a>RSVP</h4></div></div></div><p><a id="Understanding_VoIP_id285187"></a><a id="I_indexterm_d1e58530" class="indexterm"></a>MPLS contains no method to dynamically establish LSPs,
        but you can use the Reservation Protocol (RSVP) with MPLS. RSVP is a
        signaling protocol used to simplify the establishment of LSPs and to
        report problems to the MPLS ingress router. The advantage of using
        RSVP in conjunction with MPLS is the reduction in administrative
        overhead. If you don’t use RSVP with MPLS, you’ll have to go to every
        single router and configure the labels and each path manually. Using
        RSVP makes the network more dynamic by distributing control of labels
        to the routers. This enables the network to become more responsive to
        changing conditions, because it can be set up to change the paths
        based on certain conditions, such as a certain path going down
        (perhaps due to a faulty router). The configuration within the router
        will then be able to use RSVP to distribute new labels to the routers
        in the MPLS network, with no (or minimal) human intervention.</p></div></div><div class="sect2" title="Best Effort"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-4.4"></a>Best Effort</h3></div></div></div><p><a id="Understanding_VoIP_id285230"></a><a id="I_indexterm_d1e58538" class="indexterm"></a><a id="I_indexterm_d1e58543" class="indexterm"></a>The simplest, least expensive approach to QoS is not to
      provide it at all—the “best effort” method. While this might sound like
      a bad idea, it can in fact work very well. Any VoIP call that traverses
      the public Internet is almost certain to be best-effort, as QoS
      mechanisms are not yet common in this environment.<a id="I_indexterm_d1e58547" class="indexterm"></a></p></div></div><div class="sect1" title="Echo"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-5"></a>Echo</h2></div></div></div><p><a id="Understanding_VoIP_id245820"></a><a id="index-206N066QP6F" class="indexterm"></a>You may not realize it, but echo has been a problem in the
    PSTN for as long as there have been telephones. You probably haven’t often
    experienced it, because the telecom industry has spent large sums of money
    designing expensive echo-cancellation devices. Also, when the endpoints
    are physically close—e.g., when you phone your neighbor down the
    street—the delay is so minimal that anything you transmit will be returned
    back so quickly that it will be indistinguishable from the
    sidetone<sup>[<a id="asterisk-UnderstandingVoIP-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-10" class="footnote">215</a>]</sup> normally occurring in your telephone. So, the fact of the
    matter is that there is echo on your local calls much of the time, but you
    cannot perceive it with a regular telephone because it happens almost
    instantaneously. It may help you to understand this if you consider that
    when you stand in a room and speak, everything you say echos back to you
    off of the walls and ceiling (and possibly the floor, if it’s not
    carpeted), but this does not cause any problems because it happens so fast
    you do not perceive a delay.</p><p><a id="Understanding_VoIP_id245864"></a>The reason that VoIP telephone
    systems such as Asterisk can experience echo is that the addition of a
    VoIP telephone introduces a slight delay. It takes a few milliseconds for
    the packets to travel from your phone to the server (and vice versa).
    Suddenly there is an appreciable delay, which allows you to perceive the
    echo that was always there, but never really noticeable.</p><div class="sect2" title="Why Echo Occurs"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-5.1"></a>Why Echo Occurs</h3></div></div></div><p><a id="Understanding_VoIP_id245879"></a><a id="I_indexterm_d1e58568" class="indexterm"></a>Before we discuss measures to deal with echo, let’s first
      take a look at why echo occurs in the analog world.</p><p><a id="Understanding_VoIP_id245885"></a>If you hear echo, it’s not your
      phone that’s causing the problem; it’s the far end of the circuit.
      Conversely, echo heard on the far end is being generated at your end.
      Echo can be caused by the fact that an analog local loop circuit has to
      transmit and receive on the same pair of wires. If this circuit is not
      electrically balanced, or if a low-quality telephone is connected to the
      end of the circuit, signals it receives can be reflected back, becoming
      part of the return transmission. When this reflected circuit gets back
      to you, you will hear the words you spoke just moments before. Humans
      will perceive an echo beyond a certain amount of delay (possibly as low
      as 20 milliseconds for some people). This echo will become annoying as
      the delay increases.</p><p><a id="Understanding_VoIP_id245902"></a>In a cheap telephone, it is
      possible for echo to be generated in the body of the handset. This is
      why some cheap IP phones can cause echo even when the entire end-to-end
      connection does not contain an analog circuit.<sup>[<a id="asterisk-UnderstandingVoIP-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-11" class="footnote">216</a>]</sup> In the VoIP world, echo is usually introduced either by an
      analog circuit somewhere in the connection, or by a cheap endpoint
      reflecting back some of the signal (e.g., feedback through a hands-free
      or poorly designed handset or headset). The greater the latency on the
      network, the more annoying this echo can be.</p></div><div class="sect2" title="Managing Echo on DAHDI Channels"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-5.2"></a>Managing Echo on DAHDI Channels</h3></div></div></div><p><a id="Understanding_VoIP_id245965"></a><a id="I_indexterm_d1e58586" class="indexterm"></a><a id="I_indexterm_d1e58591" class="indexterm"></a>You can enable and disable echo cancellation for DAHDI
      interfaces in the <code class="filename">chan_dahdi.conf</code> file. The default
      configuration enables echo cancellation with <code class="literal">echocancel=yes</code>. <code class="literal">echocancelwhenbridged=yes</code> will enable echo
      cancellation for TDM bridged calls. While bridged calls should not
      require echo cancellation, this may improve call quality.</p><p><a id="Understanding_VoIP_id245985"></a>When echo cancellation is
      enabled, the echo canceller learns of echo on the line by listening for
      it throughout the duration of the call. Consequently, echo may be heard
      at the beginning of a call and lessen after a period of time. To avoid
      this situation, you can employ a method called <span class="emphasis"><em>echo
      training</em></span>, which will mute the line briefly at the beginning
      of a call, and send a tone from which the amount of echo on the line can
      be determined. This allows Asterisk to deal with the echo more quickly.
      Echo training can be enabled with <code class="literal">echotraining=yes</code>.</p></div><div class="sect2" title="Hardware Echo Cancellation"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id246002"></a>Hardware Echo Cancellation</h3></div></div></div><p><a id="Understanding_VoIP_id246008"></a><a id="I_indexterm_d1e58618" class="indexterm"></a><a id="I_indexterm_d1e58623" class="indexterm"></a><a id="I_indexterm_d1e58626" class="indexterm"></a>The most effective way to handle echo cancellation is not
      in software. If you are planning on deploying a good-quality system,
      spend the extra money and purchase cards for the system that have
      onboard hardware echo cancellation. These cards are a bit more
      expensive, but they quickly pay for themselves in terms of reduced load
      on the CPU, as well as reduced load on you due to fewer user
      complaints.<a id="I_indexterm_d1e58630" class="indexterm"></a></p></div></div><div class="sect1" title="Asterisk and VoIP"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-6"></a>Asterisk and VoIP</h2></div></div></div><p><a id="Understanding_VoIP_id246026"></a><a id="index-324M507LW0F" class="indexterm"></a>It should come as no surprise that Asterisk loves to talk
    VoIP. But in order to do so, Asterisk needs to know which function it is
    to perform: that of client, server, or both. One of the most complex and
    often confusing concepts in Asterisk is the configuration of inbound and
    outbound authentication.</p><div class="sect2" title="Users and Peers and Friends—Oh My!"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-6.1"></a>Users and Peers and Friends—Oh My!</h3></div></div></div><p><a id="Understanding_VoIP_id246041"></a><a id="I_indexterm_d1e58643" class="indexterm"></a><a id="I_indexterm_d1e58648" class="indexterm"></a>Connections that authenticate to us, or that we
      authenticate, are defined in the <span class="emphasis"><em>iax.conf</em></span> and
      <span class="emphasis"><em>sip.conf</em></span> files as <span class="emphasis"><em>users</em></span> and
      <span class="emphasis"><em>peers</em></span>. Connections that do both may be defined as
      <span class="emphasis"><em>friends</em></span>. When determining which way the
      authentication is occurring, it is always important to view the
      direction of the channels from Asterisk’s viewpoint, as connections are
      accepted and created by the Asterisk server.</p><div class="sect3" title="Users"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-6.1.1"></a>Users</h4></div></div></div><p><a id="Understanding_VoIP_id246091"></a><a id="I_indexterm_d1e58674" class="indexterm"></a>A connection defined as a <code class="literal">user</code> is any system/user/endpoint that we
        allow to connect to us. Keep in mind that a <code class="literal">user</code> definition does not provide a method
        with which to call that user; the <code class="literal">user</code> type is used simply to create a channel
        for incoming calls.<sup>[<a id="asterisk-UnderstandingVoIP-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-UnderstandingVoIP-FN-12" class="footnote">217</a>]</sup> A <code class="literal">user</code> definition
        will require a context name to be defined to indicate where the
        incoming authenticated call will enter the dialplan (in
        <span class="emphasis"><em>extensions.conf</em></span>).</p></div><div class="sect3" title="Peers"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-6.1.2"></a>Peers</h4></div></div></div><p><a id="Understanding_VoIP_id246172"></a><a id="I_indexterm_d1e58716" class="indexterm"></a>A connection defined as a <code class="literal">peer</code> type is an outgoing connection. Think
        of it this way: <span class="emphasis"><em>users</em></span> place calls to us, while we
        place calls to our <span class="emphasis"><em>peers</em></span>. Since peers do not
        place calls to us, a <code class="literal">peer</code>
        definition does not typically require the configuration of a context
        name. However, there is one exception: if calls that originate from
        your system are returned to your system in a loopback, the incoming
        calls (which originate from a SIP proxy, not a user agent) will be
        matched on the <code class="literal">peer</code> definition. The
        <code class="literal">default</code> context should handle these
        incoming calls appropriately, although it’s preferable for contexts to
        be defined for them on a per-peer basis.</p><p><a id="Understanding_VoIP_id246222"></a>In order to know where to send
        a call to a host, we must know its location in relation to the
        Internet (that is, its IP address). The location of a peer may be
        defined either statically or dynamically. A dynamic peer is configured
        with <code class="literal">host=dynamic</code> under the peer
        definition heading. Because the IP address of a dynamic peer may
        change <span class="keep-together">constantly</span>, it must
        register with the Asterisk box so calls can successfully be routed to
        it. If the remote end is another Asterisk box, the use of a <code class="literal">register</code> statement is required, as discussed
        in the next section.</p></div><div class="sect3" title="Friends"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-UnderstandingVoIP-SECT-6.1.3"></a>Friends</h4></div></div></div><p><a id="Understanding_VoIP_id241480"></a><a id="I_indexterm_d1e58754" class="indexterm"></a>Defining a type as a <code class="literal">friend</code> is a shortcut for defining it as both
        a <code class="literal">user</code> and a <code class="literal">peer</code>. However, connections that are both
        <code class="literal">user</code>s and <code class="literal">peer</code>s aren’t always defined this way,
        because defining each direction of call creation individually (using
        both a <code class="literal">user</code> and a <code class="literal">peer</code> definition) allows more granularity and
        control over the individual connections.</p><p><a id="Understanding_VoIP_id241532"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FIG-2" title="Figure B.2. Call origination relationships of users, peers, and friends to Asterisk">Figure&nbsp;B.2, “Call origination relationships of users, peers, and friends
          to Asterisk”</a> shows the flow of
        authentication control in relation to Asterisk.</p><div class="figure-float"><div class="figure"><a id="asterisk-UnderstandingVoIP-FIG-2"></a><p class="title"><strong>Figure&nbsp;B.2.&nbsp;Call origination relationships of users, peers, and friends
          to Asterisk</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject8_tt1161"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_ab02.png" alt="Call origination relationships of users, peers, and friends to Asterisk"></div></div></div><br class="figure-break"></div></div></div><div class="sect2" title="register Statements"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-UnderstandingVoIP-SECT-6.2"></a>register Statements</h3></div></div></div><p><a id="Understanding_VoIP_id241594"></a><a id="I_indexterm_d1e58795" class="indexterm"></a><a id="I_indexterm_d1e58800" class="indexterm"></a>A <code class="literal">register</code> statement is
      a way of telling a remote peer where your Asterisk box is in relation to
      the Internet. Asterisk uses <code class="literal">register</code>
      statements to authenticate to remote providers when you are employing a
      dynamic IP address, or when the provider does not have your IP address
      on record. There are situations when a <code class="literal">register</code> statement is not required, but to
      demonstrate when a <code class="literal">register</code> statement
      <span class="emphasis"><em>is</em></span> required, let’s look at an example.</p><p><a id="Understanding_VoIP_id241634"></a>Say you have a remote peer that
      is providing DID services to you. When someone calls the number
      +1-800-555-1212, the call goes over the physical PSTN network to your
      service provider and into its Asterisk server, possibly over its T1
      connection. This call is then routed to your Asterisk server via the
      Internet.</p><p><a id="Understanding_VoIP_id241640"></a>Your service provider will have a
      definition in either its <span class="emphasis"><em>sip.conf</em></span> or
      <span class="emphasis"><em>iax.conf</em></span> configuration file (depending on whether
      you are connecting with the SIP or IAX protocol, respectively) for your
      Asterisk server. If you only receive calls from this provider, you will
      define it as a <code class="literal">user</code> (if it is another Asterisk
      system, you might be defined in its system as a <code class="literal">peer</code>).</p><p><a id="Understanding_VoIP_id241658"></a>Now let’s say that your box is on
      your home Internet connection, with a dynamic IP address. Your service
      provider has a static IP address (or perhaps a fully qualified domain
      name), which you place in your configuration file. Since you have a
      dynamic address, your service provider specifies <code class="literal">host=dynamic</code> in its configuration file. In
      order to know where to route your +1-800-555-1212 call, your service
      provider needs to know where you are located in relation to the
      Internet. This is where the <code class="literal">register</code>
      statement comes into use.</p><p><a id="Understanding_VoIP_id241679"></a>The <code class="literal">register</code> statement is a way of authenticating
      and telling your <code class="literal">peer</code> where you are.
      In the <code class="literal">[general]</code> section of your
      configuration file, you place a statement similar to this:</p><a id="I_programlisting8_tt1163"></a><pre class="programlisting">register =&gt; username:secret@my_remote_peer</pre><p><a id="Understanding_VoIP_id241709"></a>You can verify a successful
      registration with the use of the <span class="command"><strong>iax2 show registry</strong></span>
      and <span class="command"><strong>sip show registry</strong></span> commands at the Asterisk
      console.<a id="I_indexterm_d1e58865" class="indexterm"></a></p></div></div><div class="sect1" title="VoIP Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="I_sect18_tt1164"></a>VoIP Security</h2></div></div></div><p><a id="Understanding_VoIP_id241734"></a><a id="index-211F027QE5A" class="indexterm"></a><a id="index-756D440TG3N" class="indexterm"></a>We can barely scratch the surface of the complex matter of
    VoIP security in this appendix; therefore, before we dig in, we want to
    steer you in the direction of the VoIP Security Alliance (<a class="ulink" href="http://www.voipsa.org/" target="_top">http://www.voipsa.org</a>). This fantastic resource contains an
    excellent mailing list, white papers, howtos, and a general compendium of
    all matters relating to VoIP security. Just as email has been abused by
    the selfish and criminal, so too will voice. The fine folks at VoIPSA are
    doing what they can to ensure that we address these challenges now, before
    they become an epidemic. In the realm of books on the subject, we
    recommend the most excellent <em class="citetitle">Hacking Exposed VoIP</em>
    by David Endler and Mark Collier (McGraw-Hill Osborne Media). If you are
    responsible for deploying any VoIP system, you need to be aware of this
    stuff.</p><div class="sect2" title="Spam over Internet Telephony (SPIT)"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id241778"></a>Spam over Internet Telephony (SPIT)</h3></div></div></div><p><a id="Understanding_VoIP_id241783"></a><a id="I_indexterm_d1e58890" class="indexterm"></a><a id="I_indexterm_d1e58897" class="indexterm"></a><a id="I_indexterm_d1e58900" class="indexterm"></a>We don’t want to think about this, but we know it’s
      coming. The simple fact is that there are people in this world who lack
      certain social skills, and that coupled with a kind of mindless greed,
      means that these folks think nothing of flooding the Internet with
      massive volumes of email. These same types of characters will think
      little of doing the same with voice. We already know what it’s like to
      get inundated with telemarketing calls; try to imagine what might happen
      when those telemarketers realize they can send voice spam at almost no
      cost. Regulation has not stopped email spam, and it will probably not
      stop voice spam, so it will be up to us to prevent it.</p></div><div class="sect2" title="Encrypting Audio with Secure RTP"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id241818"></a>Encrypting Audio with Secure RTP</h3></div></div></div><p><a id="Understanding_VoIP_id241824"></a><a id="I_indexterm_d1e58912" class="indexterm"></a><a id="I_indexterm_d1e58919" class="indexterm"></a><a id="I_indexterm_d1e58924" class="indexterm"></a><a id="I_indexterm_d1e58929" class="indexterm"></a><a id="I_indexterm_d1e58934" class="indexterm"></a>If you can sniff the packets coming out of an Asterisk
      system, you can extract the audio from the RTP streams. This data can be
      fed offline to a speech processing system, which can listen for keywords
      such as “credit card number” or “PIN” and present the data it gathers to
      someone who has an interest in it. The stream can also be evaluated to
      see if there are DTMF tones embedded in it, which is dangerous because
      many services ask for passwords and credit card information to be input
      via the dialpad. In business, strategic information could also be
      gleaned from captured audio.</p><p><a id="Understanding_VoIP_id241845"></a>Using Secure RTP can combat this
      problem by encrypting the RTP streams. More information about SRTP is
      available in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938" title="Encrypting SIP calls">the section called “Encrypting SIP calls”</a>.</p></div><div class="sect2" title="Spoofing"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id241852"></a>Spoofing</h3></div></div></div><p><a id="Understanding_VoIP_id241857"></a><a id="I_indexterm_d1e58950" class="indexterm"></a><a id="I_indexterm_d1e58957" class="indexterm"></a><a id="I_indexterm_d1e58964" class="indexterm"></a>In the traditional telephone network, it is very difficult
      to successfully adopt someone else’s identity. Your activities can (and
      will) be traced back to you, and the authorities will quickly put an end
      to the fun. In the world of IP, it is much easier to remain anonymous.
      As such, it is no stretch to imagine that there are hordes of
      enterprising criminals out there who will be only too happy to make
      calls to your credit card company or bank, pretending to be you. If a
      trusted mechanism is not discovered to combat spoofing, we will quickly
      learn that we cannot trust VoIP calls.</p></div><div class="sect2" title="What Can Be Done?"><div class="titlepage"><div><div><h3 class="title"><a id="Understanding_VoIP_id241868"></a>What Can Be Done?</h3></div></div></div><p><a id="Understanding_VoIP_id241874"></a>The first thing to keep in mind
      when considering security on a VoIP system is that VoIP is based on
      network protocols, and needs be evaluated from that perspective. This is
      not to say that traditional telecom security should be ignored, but we
      need to pay attention to the underlying network.</p><div class="sect3" title="Basic network security"><div class="titlepage"><div><div><h4 class="title"><a id="Understanding_VoIP_id241880"></a>Basic network security</h4></div></div></div><p><a id="Understanding_VoIP_id241885"></a>One of the most effective
        things that can be done is to secure access to the voice network. The
        use of firewalls and VLANs are examples of how this can be achieved.
        By default, the voice network should be accessible only to those
        things that have a need. For example, if you do not have any
        softphones in use, do not allow client PCs access to the voice
        network.</p><div class="sect4" title="Segregating voice and data traffic"><div class="titlepage"><div><div><h5 class="title"><a id="Understanding_VoIP_id252398"></a>Segregating voice and data traffic</h5></div></div></div><p><a id="Understanding_VoIP_id252404"></a><a id="I_indexterm_d1e58982" class="indexterm"></a><a id="I_indexterm_d1e58989" class="indexterm"></a><a id="I_indexterm_d1e58996" class="indexterm"></a>Unless there is a need to have voice and data on the
          same network, there may be some value in keeping them separate (this
          can have other benefits as well, such as simplifying QoS
          configurations). It is not unheard of to build the internal voice
          network on a totally separate LAN, using existing CAT3 cabling and
          terminating on inexpensive network switches. This configuration can
          even be less <span class="keep-together">expensive.</span></p></div><div class="sect4" title="DMZ"><div class="titlepage"><div><div><h5 class="title"><a id="Understanding_VoIP_id252412"></a>DMZ</h5></div></div></div><p><a id="Understanding_VoIP_id252418"></a><a id="I_indexterm_d1e59006" class="indexterm"></a><a id="I_indexterm_d1e59013" class="indexterm"></a><a id="I_indexterm_d1e59020" class="indexterm"></a><a id="I_indexterm_d1e59023" class="indexterm"></a>Placing your VoIP system in a demilitarized zone (DMZ)
          can provide an additional layer of protection for your LAN, while
          still allowing connectivity for relevant applications. Should your
          VoIP system be compromised, it will be much more difficult to use it
          to launch an attack on the rest of your network, since it is not
          trusted. Regardless of whether you deploy within a DMZ, any abnormal
          traffic coming out of the system should be considered
          suspect.</p></div><div class="sect4" title="Server hardening"><div class="titlepage"><div><div><h5 class="title"><a id="Understanding_VoIP_id252426"></a>Server hardening</h5></div></div></div><p><a id="Understanding_VoIP_id252432"></a><a id="I_indexterm_d1e59031" class="indexterm"></a><a id="I_indexterm_d1e59038" class="indexterm"></a><a id="I_indexterm_d1e59043" class="indexterm"></a><a id="I_indexterm_d1e59048" class="indexterm"></a>Hardening your Asterisk server is critical. Not only
          are there performance benefits to doing this (running nonessential
          processes can eat up valuable CPU and RAM resources), but the
          elimination of anything not required will reduce the chance that an
          exploited vulnerability in the operating system can be used to gain
          access and launch an attack on other parts of your network.</p><p><a id="Understanding_VoIP_id252438"></a>Running Asterisk as
          non-<span class="emphasis"><em>root</em></span> is an essential part of system
          hardening. See <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install" title="Chapter 3. Installing Asterisk">Chapter&nbsp;3, <em>Installing Asterisk</em></a> for more
          information.</p></div></div><div class="sect3" title="Encryption"><div class="titlepage"><div><div><h4 class="title"><a id="Understanding_VoIP_id252454"></a>Encryption</h4></div></div></div><p><a id="Understanding_VoIP_id252460"></a><a id="I_indexterm_d1e59067" class="indexterm"></a><a id="I_indexterm_d1e59074" class="indexterm"></a><a id="I_indexterm_d1e59081" class="indexterm"></a>Asterisk 1.8 includes the ability to use both SIP TLS
        for the encryption of signaling and SRTP for the encryption of the
        media between endpoints. More information about encrypting SIP calls
        can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938" title="Encrypting SIP calls">the section called “Encrypting SIP calls”</a>.
        Asterisk has also supported encryption between endpoints using IAX2
        since version 1.4). Information about enabling encryption across IAX2
        trunks can be found in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999" title="IAX encryption">the section called “IAX encryption”</a>.</p></div><div class="sect3" title="Physical security"><div class="titlepage"><div><div><h4 class="title"><a id="Understanding_VoIP_id252476"></a>Physical security</h4></div></div></div><p><a id="Understanding_VoIP_id252482"></a><a id="I_indexterm_d1e59095" class="indexterm"></a><a id="I_indexterm_d1e59102" class="indexterm"></a><a id="I_indexterm_d1e59109" class="indexterm"></a>Physical security should not be ignored. All terminating
        equipment (such as switches, routers, and the PBX itself) should be
        secured in an environment that can only be accessed by authorized
        persons. At the user end (such as under desks), it can be more
        difficult to deliver physical security, but if the network responds
        only to devices that it is familiar with (e.g., restricting DHCP to
        devices whose MAC addresses are known), the risk of unauthorized
        intrusions can be mitigated somewhat.<a id="I_indexterm_d1e59113" class="indexterm"></a><a id="I_indexterm_d1e59114" class="indexterm"></a></p></div></div></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-UnderstandingVoIP-SECT-7"></a>Conclusion</h2></div></div></div><p><a id="Understanding_VoIP_id252525"></a>Over the last couple of years the
    telecom industry has embraced VoIP, which sets <span class="keep-together">Asterisk</span> up to do quite well. While Asterisk
    has been doing VoIP for years (well over a decade now), the integration of
    VoIP and traditional telephony into a single, powerful platform has made
    Asterisk a major player in the telecommunications industry.<a id="I_indexterm_d1e59123" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-1" class="para">201</a>] </sup>This word hasn’t quite made it into the dictionary, but it is a
        term that is becoming more and more common. It refers to the process
        of chopping a steady stream of information into discrete chunks (or
        <span class="emphasis"><em>packets</em></span>), suitable for delivery independently of
        one another.</p></div><div class="footnote"><p><sup>[<a id="ftn.id673079" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id673079" class="para">202</a>] </sup>It sounds like the name of a Dutch football team.</p></div><div class="footnote"><p><sup>[<a id="ftn.id673085" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id673085" class="para">203</a>] </sup>Go ahead. Say it. That sounds much better, doesn’t it?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-2" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-2" class="para">204</a>] </sup>Officially, the current version is IAX2 (officially
          standardized by the IETF in RFC 5456), but all support for IAX1 has
          been dropped, so whether you say “IAX” or “IAX2,” it is expected
          that you are talking about <span class="keep-together">version
          2</span>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id673350" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id673350" class="para">205</a>] </sup>Having just called SIP simple, it should be noted that it is
          by no means lightweight. It has been said that if one were to read
          all of the IETF RFCs that are relevant to SIP, one would have more
          than 3,000 pages of reading to do. SIP is quickly earning a
          reputation for being far too bloated, but that does nothing to
          lessen its popularity.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-CHP-4-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-4-FN-8" class="para">206</a>] </sup>RFC 3261, “SIP: Session Initiation Protocol,” p. 9, Section
            2.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-3" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-3" class="para">207</a>] </sup>RFC 3435 obsoletes RFC 2705.</p></div><div class="footnote"><p><sup>[<a id="ftn.id674196" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id674196" class="para">208</a>] </sup>Cisco has recently announced that it will be migrating
            toward SIP in its future products.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-4" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-4" class="para">209</a>] </sup>Read the following: “Aoccdrnig to rsereach at an Elingsh
        uinervtisy, it deosn’t mttaer in waht oredr the ltteers in a wrod are,
        the olny iprmoetnt tihng is taht frist and lsat ltteres are in the
        rghit pclae. The rset can be a toatl mses and you can sitll raed it
        wouthit a porbelm. Tihs is bcuseae we do not raed ervey lteter by
        istlef, but the wrod as a wlohe.” (The source of this quote is
        unknown.) We do the same thing with sound: if there is enough
        information, our brains can fill in the gaps.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-5" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-5" class="para">210</a>] </sup>On an audio CD, quality is far more important than saving
        bandwidth, so the audio is quantized at 16 bits (times 2, as it’s
        stereo), with a sampling rate of 44,100 Hz. Considering that the CD
        was invented in the late 1970s, this was quite impressive stuff back
        then. The telephone network does not require this level of quality
        (and needs to optimize bandwidth), so telephone signals are encoded
        using 8 bits, at a sampling frequency of 8,000 Hz.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-6" class="para">211</a>] </sup>CELP is a popular method of compressing speech. By
          mathematically modeling the various ways humans make sounds, a
          codebook of sounds can be built. Rather than sending an actual
          sampled sound, a code corresponding to the sound is determined. CELP
          codecs take this information (which by itself would produce a very
          robot-like sound) and attempt to add the personality back in. (Of
          course, there is much more to it than that.) Jason Woodward’s
          <span class="emphasis"><em>Speech Coding</em></span> page (<a class="ulink" href="http://www-mobile.ecs.soton.ac.uk/speech_codecs/" target="_top">http://www-mobile.ecs.soton.ac.uk/speech_codecs/</a>) is
          a source of helpful information for the non-mathematically inclined.
          This is fairly heavy stuff, though, so wear your thinking
          cap.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-7" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-7" class="para">212</a>] </sup>If you want to learn all about MPEG audio, do a web search for
          Davis Pan’s paper titled “A Tutorial on MPEG/Audio
          Compression.”</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-8" class="para">213</a>] </sup>The order of arrival is important in voice communication,
            because the audio will be processed and sent to the caller ASAP.
            However, with a jitter buffer the order of arrival isn’t as
            important, as it provides a small window of time in which the
            packets can be reordered before being passed on to the
            caller.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-9" class="para">214</a>] </sup>Keep in mind that the upper-layer protocols or applications
            can implement their own packet-acknowledgment systems.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-10" class="para">215</a>] </sup>As discussed in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>, sidetone is a function
        in your telephone that returns part of what you say back to your own
        ear, to provide a more natural-sounding conversation.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-11" class="para">216</a>] </sup>Actually, the handset in any phone, be it traditional or VoIP,
          is an analog connection.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-UnderstandingVoIP-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-FN-12" class="para">217</a>] </sup>In SIP, this is not <span class="emphasis"><em>always</em></span> the case. If
            the endpoint is a SIP proxy service (as opposed to a user agent),
            Asterisk will authenticate based on the <code class="literal">peer</code> definition, matching the IP address
            and port in the <code class="literal">Contact</code> field
            of the SIP header against the hostname (and port, if specified)
            defined for the peer (if the port is not specified, the one
            defined in the <code class="literal">[general]</code>
            section will be used).</p></div></div></div><div class="appendix" title="Appendix C. Preparing a System for Asterisk"><div class="titlepage"><div><div><h2 class="title"><a id="asterisk-InstallationPlanning"></a>Appendix&nbsp;C.&nbsp;Preparing a System for Asterisk</h2></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1">Server Hardware Selection</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2">Choosing a Processor</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.1">Small systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.2">Medium systems</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.3">Large systems</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.3">Choosing a Motherboard</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4">Power Supply Requirements</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.1">Computer power supplies</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.2">Redundant power supplies</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2">Environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1">Power Conditioning and Uninterruptible Power Supplies</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1.1">Power-conditioned UPSs</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.2">Grounding</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.3">Electrical Circuits</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4">The Equipment Room</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.1">Humidity</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.2">Temperature</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.3">Dust</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3">Telephony Hardware</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1">Connecting to the PSTN</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.1">Analog interface cards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.2">Digital interface cards</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.3">Channel banks</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.4">Other types of PSTN interfaces</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.2">Connecting Exclusively to a Packet-Based Telephone
      Network</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.3">Echo Cancellation</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4">Types of Phones</a></span></dt><dd><dl><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1">Physical Telephones</a></span></dt><dd><dl><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.1">Analog telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.2">Proprietary digital telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.3">ISDN telephones</a></span></dt><dt><span class="sect3"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.4">IP telephones</a></span></dt></dl></dd><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.2">Softphones</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.3">Telephony Adaptors</a></span></dt><dt><span class="sect2"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.4">Communications Terminals</a></span></dt></dl></dd><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-5">Linux Considerations</a></span></dt><dt><span class="sect1"><a href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-6">Conclusion</a></span></dt></dl></div><div class="epigraph"><p><a id="Installation_Planning_id262563"></a>Very early on, I knew that
    someday in some “perfect” future out there over the horizon, it would be
    commonplace for computers to handle all of the necessary processing
    functionality internally, making the necessary external hardware to
    connect up to telecom interfaces <span class="emphasis"><em>very</em></span> inexpensive
    and, in some cases, trivial.</p><div class="attribution"><span>—<span class="attribution">Jim Dixon, “The History of Zapata Telephony and How It
    Relates to the Asterisk PBX”</span></span></div></div><p><a id="Installation_Planning_id290775"></a><a id="index-067E483JF5G" class="indexterm"></a><a id="index-355B756CS8I" class="indexterm"></a>By this point, you must be anxious to get your Asterisk system
  up and running. For a mission-critical deployment, however, some thought
  must be given to the environment in which the Asterisk system will run. Make
  no mistake: Asterisk, being a very flexible piece of software, will happily
  and successfully install on nearly any Linux platform you can conceive of,
  and several non-Linux platforms as well.<sup>[<a id="asterisk-InstallationPlanning-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-1" class="footnote">218</a>]</sup> However, to arm you with an understanding of the type of
  operating environment Asterisk will really thrive in, this appendix will
  discuss issues you need to be aware of in order to deliver a reliable,
  well-designed system.</p><p><a id="Installation_Planning_id254481"></a>In terms of its resource
  requirements, Asterisk’s needs are similar to those of an embedded,
  real-time application. This is due in large part to its need to have
  priority access to the processor and system buses. It is, therefore,
  imperative that any functions on the system not directly related to the
  call-processing tasks of Asterisk be run at a low priority, if at all. On
  smaller systems and hobby systems, this might not be as much of an issue.
  However, on high-capacity systems, performance shortcomings will manifest as
  audio quality problems for users, often experienced as echo, static, and the
  like. The symptoms will resemble those experienced on a cell phone when
  going out of range, although the underlying causes will be different. As
  loads increase, the system will have increasing difficulty maintaining
  connections. For a PBX, such a situation is nothing short of disastrous, so
  careful attention to performance requirements is a critical consideration
  during the platform selection process.</p><p><a id="Installation_Planning_id253967"></a><a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-TABLE-1" title="Table C.1. System requirement guidelines">Table&nbsp;C.1, “System requirement guidelines”</a> lists some very basic
  guidelines that you’ll want to keep in mind when planning your system. The
  next section takes a close look at the various design and implementation
  issues that will affect its performance. Keep in mind that no guide can tell
  you exactly how many calls a server can handle. There are an incredibly high
  number of variables that can affect the answer to the question of how many
  calls Asterisk can handle. The only way to figure out how many calls a
  server can handle is to test it yourself in your own environment.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installation_Planning_id276347"></a>The size of an Asterisk system
    is actually not dictated by the number of users or sets, but rather by the
    number of simultaneous calls it will be expected to support. These numbers
    are very conservative, so feel free to experiment and see what works for
    you.</p></div><div class="table"><a id="asterisk-InstallationPlanning-TABLE-1"></a><p class="title"><strong>Table&nbsp;C.1.&nbsp;System requirement guidelines</strong></p><div class="table-contents"><table summary="System requirement guidelines" border="1"><colgroup><col class="col1"><col class="col2"><col class="col3"></colgroup><thead><tr><th align="left">
            <p><a id="Installation_Planning_id249613"></a>Purpose</p>
          </th><th align="left">
            <p><a id="Installation_Planning_id249622"></a>Number
          of channels</p>
          </th><th align="left">
            <p><a id="Installation_Planning_id249630"></a>Minimum
          recommended</p>
          </th></tr></thead><tbody><tr><td align="left">
            <p><a id="Installation_Planning_id249645"></a>Hobby
          system</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id244228"></a>No
          more than 5</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id244236"></a>400-MHz x86, 256 MB
          RAM</p>
          </td></tr><tr><td align="left">
            <p><a id="Installation_Planning_id244248"></a>SOHO
          system (small office/home office—less than three lines and five
          sets)</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id244267"></a>5 to
          10</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id244275"></a>1-GHz
          x86, 512 MB RAM</p>
          </td></tr><tr><td align="left">
            <p><a id="Installation_Planning_id244287"></a>Small
          business system</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id265195"></a>Up to
          25</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id265203"></a>3-GHz
          x86, 1 GB RAM</p>
          </td></tr><tr><td align="left">
            <p><a id="Installation_Planning_id265215"></a>Medium
          to large system </p>
          </td><td align="left">
            <p><a id="Installation_Planning_id265223"></a>More
          than 25</p>
          </td><td align="left">
            <p><a id="Installation_Planning_id265232"></a>Dual
          CPUs, possibly also multiple servers in a distributed
          architecture</p>
          </td></tr></tbody></table></div></div><br class="table-break"><p><a id="Installation_Planning_id265240"></a>With large Asterisk installations,
  it is common to deploy functionality across several servers. One or more
  central units will be dedicated to call processing; these will be
  complemented by one or more ancillary servers handling peripherals (such as
  a database system, a voicemail system, a conferencing system, a management
  system, a web interface, a firewall, and so on). As is true in most Linux
  environments, Asterisk is well suited to growing with your needs: a small
  system that used to be able to handle all your call-processing and
  peripheral tasks can be distributed among several servers when increased
  demands exceed its abilities. Flexibility is a key reason why Asterisk is
  extremely cost-effective for rapidly growing businesses; there is no
  effective maximum or minimum size to consider when budgeting the initial
  purchase. While some scalability is possible with most telephone systems, we
  have yet to hear of one that can scale as flexibly as Asterisk. Having said
  that, distributed Asterisk systems are not simple to design—this is not a
  task for someone new to Asterisk.</p><p><a id="Installation_Planning_id265261"></a>
    </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p><a id="Installation_Planning_id265266"></a>If you are sure that you need
      to set up a distributed Asterisk system, you will want to study the
      DUNDi protocol, the Asterisk Realtime Architecture (ARA),
      <code class="literal">func_odbc</code>, and the various other database tools at
      your disposal. This will help you to abstract the data your system
      requires from the dialplan logic your Asterisk systems will utilize,
      creating a generic set of dialplan logic that can be used across
      multiple boxes. This in turn will enable you to scale more simply by
      adding additional boxes to the system. However, this is far beyond the
      scope of this book and will be left as an exercise for the reader. If
      you want a teaser of some tools you can use for scaling, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering" title="Chapter 22. Clustering">Chapter&nbsp;22, <em>Clustering</em></a>.</p></div><p>
  </p><div class="sect1" title="Server Hardware Selection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-1"></a>Server Hardware Selection</h2></div></div></div><p><a id="Installation_Planning_id269417"></a><a id="index-460V456GO5H" class="indexterm"></a><a id="index-230W026BD8S" class="indexterm"></a><a id="I_indexterm_d1e59247" class="indexterm"></a>The selection of a server is both simple and complicated:
    simple because, really, any x86-based platform will suffice, but
    complicated because the reliable performance of your system will depend on
    the care that is put into the platform design. When selecting your
    hardware, you must carefully consider the overall design of your system
    and what functionality you need to support. This will help you determine
    your requirements for the CPU, motherboard, and power supply. If you are
    simply setting up your first <span class="keep-together">Asterisk</span> system for the purpose of learning,
    you can safely ignore the information in this section. If, however, you
    are building a mission-critical system suitable for deployment, these are
    issues that require some thought.</p><div class="sect2" title="Performance Issues"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-1.1"></a>Performance Issues</h3></div></div></div><p><a id="Installation_Planning_id270493"></a><a id="I_indexterm_d1e59260" class="indexterm"></a>Among other considerations, when selecting the hardware
      for an Asterisk installation you must bear in mind this critical
      question: how powerful must the system be? This is not an easy question
      to answer, because the manner in which the system is to be used will
      play a big role in the resources it will consume. There is no such thing
      as an Asterisk performance-engineering matrix, so you will need to
      understand how Asterisk uses the system in order to make intelligent
      decisions about what kinds of resources will be required. You will need
      to consider several factors, including:</p><div class="variablelist"><dl><dt><span class="term">
            <span class="emphasis"><em>The maximum number of concurrent connections
          <a id="I_indexterm_d1e59271" class="indexterm"></a>the system will be expected to
          support</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270525"></a><a id="Installation_Planning_id270527"></a>Each connection will
            increase the workload on the system.</p></dd><dt><span class="term">The percentage of traffic that will require
          processor-intensive DSP of compressed codecs (such as G.729 and
          GSM)</span></dt><dd><p><a id="Installation_Planning_id270572"></a><a id="Installation_Planning_id270574"></a>The digital signal
            processing (DSP) work that Asterisk performs in software can have
            a staggering impact on the number of concurrent calls it will
            support. A system that might happily handle 50 concurrent G.711
            calls could be brought to its knees by a request to conference
            together 10 G.729 compressed channels. We talk more about G.729,
            GSM, G.711, and many other codecs in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Whether conferencing <a id="I_indexterm_d1e59290" class="indexterm"></a>will be provided, and what level of conferencing
          activity is expected</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270610"></a><a id="Installation_Planning_id270612"></a>Will the system be used
            heavily? Conferencing requires the system to transcode and mix
            each individual incoming audio stream into multiple outgoing
            streams. Mixing multiple audio streams in near-real time can place
            a significant load on <span class="keep-together">the
            CPU</span>.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Echo cancellation</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270629"></a><a id="Installation_Planning_id270631"></a>Echo cancellation
            <a id="I_indexterm_d1e59309" class="indexterm"></a>may be required on any call where a Public Switched
            Telephone Network (PSTN) interface is involved. Since echo
            cancellation is a mathematical function, the more of it the system
            has to perform, the higher the load on the CPU will be.<sup>[<a id="id678452" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id678452" class="footnote">219</a>]</sup> Some telephony hardware vendors offer hardware-based
            echo cancellation to remove the burden of this task from the host
            CPU. Echo cancellation is discussed briefly later in this appendix
            and in more depth in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Dialplan scripting logic</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270676"></a><a id="Installation_Planning_id270679"></a><a id="I_indexterm_d1e59327" class="indexterm"></a>Whenever Asterisk has to pass call control to an
            external program, there is a performance penalty. As much logic as
            possible should be built into the dialplan. If external scripts
            are used, they should be designed with performance and efficiency
            as critical considerations.</p></dd></dl></div><p><a id="Installation_Planning_id270700"></a>As for the exact performance
      impact of these factors, it’s difficult to know for sure. The effect of
      each is known in general terms, but an accurate performance calculator
      has not yet been successfully defined. This is partly because the effect
      of each component of the system is dependent on numerous variables, such
      as CPU power, motherboard chipset and overall quality, total traffic
      load on the system, Linux kernel optimizations, network traffic, number
      and type of PSTN interfaces, and PSTN traffic—not to mention any
      non-Asterisk services the system is performing concurrently. Let’s take
      a look at the effects of several key factors:</p><div class="variablelist"><dl><dt><span class="term">
            <span class="emphasis"><em>Codecs and transcoding</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270720"></a><a id="Installation_Planning_id270722"></a><a id="I_indexterm_d1e59340" class="indexterm"></a>Simply put, a <span class="emphasis"><em>codec</em></span><a id="I_indexterm_d1e59348" class="indexterm"></a> (short for coder/decoder, or
            compression/decompression) is a set of mathematical rules that
            define how an analog waveform will be digitized. The differences
            between the various codecs are due in large part to the levels of
            compression and quality that they offer. Generally speaking, the
            more compression that’s required, the more work the DSP must do to
            code or decode the signal. Uncompressed codecs, therefore, put far
            less strain on the CPU (but require more network bandwidth). Codec
            selection must strike a balance between bandwidth and processor
            usage. For more on codecs, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Central processing unit (and floating point
          unit)<a id="I_indexterm_d1e59360" class="indexterm"></a></em></span>
          </span></dt><dd><p><a id="Installation_Planning_id270787"></a><a id="Installation_Planning_id270789"></a>A CPU <a id="I_indexterm_d1e59366" class="indexterm"></a>is composed of several components, one of which is
            the floating point unit (FPU). The speed of the CPU, coupled with
            the efficiency of its FPU, will play a significant role in the
            number of concurrent connections a system can effectively support.
            The next section (<a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2" title="Choosing a Processor">the section called “Choosing a Processor”</a>) offers some
            general guidelines for choosing a CPU that will meet the needs of
            your system.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Other processes running concurrently on the
          system</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id257930"></a><a id="Installation_Planning_id257932"></a>Being Unix-like, Linux
            is designed to be able to multitask several different processes. A
            problem arises when one of those processes (such as Asterisk)
            demands a very high level of responsiveness from the system. By
            default, Linux will distribute resources fairly among every
            application that requests them. If you install a system with many
            different server applications, those applications will each be
            allowed their fair use of the CPU. Since Asterisk requires
            frequent high-priority access to the CPU, it does not get along
            well with other applications, and if Asterisk must coexist with
            other apps, the system may require special optimization. This
            primarily involves the assignment of priorities to various
            applications in the system and, during installation, careful
            attention to which applications are installed as services.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Kernel optimizations</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id257954"></a><a id="Installation_Planning_id257956"></a><a id="I_indexterm_d1e59385" class="indexterm"></a>A kernel optimized for the performance of one
            specific application is something that very few Linux
            distributions offer by default, and thus it requires some thought.
            At the very minimum—whichever distribution you choose—you should
            download and compile on your platform a fresh copy of the Linux
            kernel (available from <a class="ulink" href="http://www.kernel.org/" target="_top">http://www.kernel.org</a>). You may also be able to
            acquire patches that will yield performance improvements, but
            these are considered hacks to the officially supported
            kernels.</p></dd><dt><span class="term">
            <span class="emphasis"><em>IRQ latency</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id257993"></a><a id="Installation_Planning_id257995"></a><a id="I_indexterm_d1e59397" class="indexterm"></a><a id="I_indexterm_d1e59400" class="indexterm"></a>Interrupt request (IRQ) latency is basically the
            delay between the moment a peripheral card (such as a telephone
            interface card) requests the CPU to stop what it’s doing and the
            moment when the CPU actually responds and is ready to handle the
            task. Asterisk’s peripherals (especially the DAHDI cards) have
            historically been intolerant of IRQ latency, though there have
            been extensive improvements in DAHDI to help improve these issues.
            This is not due to any problem with the cards, but rather is part
            of the nature of how a software-based TDM engine has to work. If
            we buffer the TDM data and send it on the bus as a larger packet,
            that may be more efficient from a system perspective, but it will
            create a delay between the time the audio is received on the card,
            and when it is delivered to the CPU. This makes real-time
            processing of TDM data next to impossible. In the design of DAHDI,
            it was decided that sending the data every 1 ms would create the
            best tradeoff, but a side effect of this is that any card in the
            system that uses the DAHDI interface is going to ask the system to
            process an interrupt every millisecond. This used to be a factor
            on older motherboards, but it has largely ceased to be a cause for
            concern.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-InstallationPlanning-NOTE-3"></a>Tip</h3><p><a id="Installation_Planning_id258052"></a>Linux has historically
              had problems with its ability to service IRQs quickly; this
              problem has caused enough trouble for audio developers that
              several patches have been created to address this shortcoming.
              So far, there has been some mild controversy over how to
              incorporate these patches into the Linux kernel.</p></div></dd><dt><span class="term">
            <span class="emphasis"><em>Kernel version</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id258071"></a><a id="Installation_Planning_id258073"></a><a id="I_indexterm_d1e59413" class="indexterm"></a>Asterisk is officially supported on Linux version
            2.6. Almost all of Asterisk itself does not really care about the
            kernel version, but DAHDI requires 2.6.</p></dd><dt><span class="term">
            <span class="emphasis"><em>Linux distribution</em></span>
          </span></dt><dd><p><a id="Installation_Planning_id258087"></a><a id="Installation_Planning_id258089"></a>Linux <a id="I_indexterm_d1e59424" class="indexterm"></a>distributions are many and varied. Asterisk should
            work on all of them. Choose the one that you are most comfortable
            with.</p></dd></dl></div></div><div class="sect2" title="Choosing a Processor"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-1.2"></a>Choosing a Processor</h3></div></div></div><p><a id="Installation_Planning_id258130"></a><a id="I_indexterm_d1e59434" class="indexterm"></a>Since the performance demands of Asterisk will generally
      involve a large number of math calculations, it is essential that you
      select a processor with a powerful FPU. The signal processing that
      Asterisk performs can quickly demand a staggering quantity of complex
      mathematical computations from the CPU. The efficiency with which these
      tasks are carried out will be determined by the power of the FPU within
      the processor.</p><p><a id="Installation_Planning_id258185"></a>Actually naming a best
      processor for Asterisk in this book would fly in the face of Moore’s
      Law. Even in the time between the authoring and publishing of this book,
      processor speeds will undergo rapid improvements, as will Asterisk’s
      support for various architectures. Obviously, this is a good thing, but
      it also makes the giving of advice on the topic a thankless task.
      Naturally, the more powerful the FPU is, the more <span class="keep-together">concurrent</span> DSP tasks Asterisk will be able
      to handle, so that is the ultimate consideration. When you are selecting
      a processor, the raw clock speed is only part of the equation. How well
      it handles floating-point operations will be a key differentiator, as
      DSP operations in Asterisk will place a large demand on that
      process.</p><p><a id="Installation_Planning_id258203"></a>Both Intel and AMD CPUs have
      powerful FPUs. Current-generation chips from either of those
      manufacturers can be expected to perform well.<sup>[<a id="asterisk-InstallationPlanning-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-6" class="footnote">220</a>]</sup></p><p><a id="Installation_Planning_id258248"></a>The obvious conclusion is that
      you should get the most powerful CPU your budget will allow. However,
      don’t be too quick to buy the most expensive CPU out there. You’ll need
      to keep the requirements of your system in mind; after all, a Formula 1
      Ferrari is ill-suited to the rigors of rush-hour traffic. Slower CPUs
      will often run cooler, so you might be able to build a lower-powered,
      fanless Asterisk system for a small office, which could work well in a
      dusty environment, for example.</p><p><a id="Installation_Planning_id258258"></a>To attempt to provide you with
      a frame of reference from which you can contemplate your platform
      decision, we have chosen to define three sizes of Asterisk systems:
      small, medium, and large.</p><div class="sect3" title="Small systems"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-1.2.1"></a>Small systems</h4></div></div></div><p><a id="Installation_Planning_id258271"></a>Small systems (up to 10
        phones) are not immune to the performance requirements of Asterisk,
        but the typical load that will be placed on a smaller system will
        generally fall within the capabilities of a modern processor.</p><p><a id="Installation_Planning_id258285"></a>If you are building a small
        system from older components you have lying around, be aware that the
        resulting system cannot be expected to perform at the same level as a
        more powerful machine, and performance will begin to degrade under a
        much lighter load. Hobby systems can be run successfully on very
        low-powered hardware, although this is by no means recommended for
        anyone who is not a whiz at Linux performance tuning.<sup>[<a id="id679025" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id679025" class="footnote">221</a>]</sup></p><p><a id="Installation_Planning_id251595"></a>If you are setting up an
        Asterisk system for the purposes of learning, you will be able to
        build a fully featured platform using a relatively low-powered CPU.
        The authors of this book run several Asterisk lab systems with 433-MHz
        to 700-MHz Celeron processors, but the workload of these systems is
        minimal (never more than two concurrent calls).</p><div class="sidebar" title="AstLinux and Asterisk on OpenWRT"><a id="I_sidebar2_tt92"></a><div class="titlepage"><div><div><p class="title"><strong>AstLinux and Asterisk on OpenWRT</strong></p></div></div></div><p><a id="Installation_Planning_id251610"></a><a id="I_indexterm_d1e59472" class="indexterm"></a><a id="I_indexterm_d1e59475" class="indexterm"></a>If you are really comfortable working with Linux on
          embedded platforms, you will want to join the
          <span class="emphasis"><em>AstLinux</em></span> mailing list and run Kristian
          Kielhofner’s creation, AstLinux, or get yourself a Linksys WRT54GL
          and install Brian Capouch’s version of Asterisk for that
          platform.</p><p><a id="Installation_Planning_id251636"></a>These projects strip
          Asterisk down to its essentials, and allow incredibly powerful PBX
          applications to be deployed on very inexpensive hardware.</p><p><a id="Installation_Planning_id251640"></a>While both projects
          require a fair amount of knowledge and effort on your part, they
          also share a huge coolness factor, are extremely popular, and are of
          excellent quality.</p></div></div><div class="sect3" title="Medium systems"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-1.2.2"></a>Medium systems</h4></div></div></div><p><a id="Installation_Planning_id251655"></a>Medium-sized systems (from
        10 to 50 phones) are where performance considerations will be the most
        challenging to resolve. Generally, these systems will be deployed on
        one or two servers only, and thus each machine will be required to
        handle more than one specific task. As loads increase, the limits of
        the platform will become increasingly stressed. Users may begin to
        perceive quality problems without realizing that the system is not
        faulty in any way, but simply exceeding its capacity. These problems
        will get progressively worse as more and more load is placed on the
        system, with the user experience degrading accordingly. It is critical
        that performance problems be identified and addressed before users
        notice them.</p><p><a id="Installation_Planning_id251675"></a>Monitoring performance on
        these systems and quickly acting on any developing trends is key to
        ensuring that a quality telephony platform is provided.</p></div><div class="sect3" title="Large systems"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-1.2.3"></a>Large systems</h4></div></div></div><p><a id="Installation_Planning_id251688"></a>Large systems (more than 120
        channels) can be distributed across multiple systems and sites, and
        performance concerns can be managed through the addition of machines.
        Very large Asterisk systems have been created in this way.</p><p><a id="Installation_Planning_id251703"></a>Building a large system
        requires an advanced level of knowledge in many different disciplines.
        We will not discuss it in detail in this book, other than to say that
        the issues you’ll encounter will be similar to those encountered
        during any deployment of multiple servers handling a single,
        distributed task.</p></div></div><div class="sect2" title="Choosing a Motherboard"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-1.3"></a>Choosing a Motherboard</h3></div></div></div><p><a id="Installation_Planning_id251747"></a><a id="I_indexterm_d1e59504" class="indexterm"></a>Just to get any anticipation out of the way, we also
      cannot recommend specific motherboards in this book. With new
      motherboards coming out on a weekly basis, any recommendations we could
      make would be rendered moot by obsolescence before the published copy
      hit the shelves. Not only that, but motherboards are like automobiles:
      while they are all very similar in principle, the difference is in the
      details. And as Asterisk is a performance application, the details
      matter.</p><p><a id="Installation_Planning_id251779"></a>What we will do, therefore, is
      give you some idea of the kinds of motherboards that can be expected to
      work well with Asterisk, and the features that will make for a good
      motherboard. The key is to have both stability and high performance.
      Here are some guidelines to follow:</p><div class="itemizedlist"><a id="Installation_Planning_id251785"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installation_Planning_id251787"></a><a id="Installation_Planning_id251789"></a>The various system buses
          must provide the minimum possible latency. If you are planning a
          PSTN connection using analog or PRI interfaces (discussed later in
          this appendix), having DAHDI cards in the system will generate 1,000
          interrupt requests per second. Having devices on the bus that
          interfere with this process will result in degradation of call
          quality. Chipsets from Intel (for Intel CPUs) and nVidia nForce (for
          AMD CPUs) seem to score the best marks in this area. Review the
          specific chipset of any motherboard you are evaluating to ensure
          that it does not have known problems with IRQ latency.</p></li><li class="listitem"><p><a id="Installation_Planning_id251823"></a><a id="Installation_Planning_id251825"></a>If you are running DAHDI
          cards in your system, you will want to ensure that your BIOS allows
          you maximum control over IRQ assignment. As a rule, high-end
          motherboards will offer far greater flexibility with respect to BIOS
          tweaking; value-priced boards will generally offer very little
          control. This may be a moot point, however, as APIC-enabled
          motherboards turn IRQ control over to the operating system.</p></li><li class="listitem"><p><a id="Installation_Planning_id251833"></a><a id="Installation_Planning_id251836"></a>Server-class motherboards
          generally implement a different PCI standard than workstation-class
          motherboards. While there are many differences, the most obvious and
          well known is that the two versions have different voltages.
          Depending on which cards you purchase, you will need to know if you
          require 3.3V or 5V PCI slots.<sup>[<a id="id679275" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id679275" class="footnote">222</a>]</sup> <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FIG-1" title="Figure C.1. Visual identification of PCI slots">Figure&nbsp;C.1, “Visual identification of PCI slots”</a>
          shows the visual differences between 3.3V and 5V slots. Most server
          motherboards will have both types, but workstations will typically
          have only the 5V version.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p><a id="Installation_Planning_id251895"></a>There is some evidence
            that suggests connecting together two completely separate,
            single-CPU systems may provide far more benefits than simply using
            two processors in the same machine. You not only double your CPU
            power, but you also achieve a much better level of redundancy at a
            similar cost to a single-chassis, dual-CPU machine. Keep in mind,
            though, that a dual-server Asterisk solution will be more complex
            to design than a single-machine solution.</p></div></li></ul></div><div class="figure-float"><div class="figure"><a id="asterisk-InstallationPlanning-FIG-1"></a><p class="title"><strong>Figure&nbsp;C.1.&nbsp;Visual identification of PCI slots</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject2_tt104"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_ac01.png" alt="Visual identification of PCI slots"></div></div></div><br class="figure-break"></div><div class="itemizedlist"><a id="Installation_Planning_id251947"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installation_Planning_id251949"></a><a id="Installation_Planning_id251951"></a>Consider using multiple
          processors, or processors with multiple cores. This will provide an
          improvement in the system’s ability to handle multiple tasks. For
          <span class="keep-together">Asterisk</span>, this will be of
          special benefit in the area of floating-point operations.</p></li><li class="listitem"><p><a id="Installation_Planning_id280652"></a><a id="Installation_Planning_id280654"></a>If you need a modem,
          install an external unit that connects to a serial port. If you must
          have an internal modem, you will need to ensure that it is not a
          so-called “Win-modem”—it must be a completely self-sufficient unit
          (note that these are very difficult, if not impossible, to
          find).</p></li><li class="listitem"><p><a id="Installation_Planning_id280672"></a><a id="Installation_Planning_id280675"></a>Consider that with
          built-in networking, if you have a network component failure, the
          entire motherboard will need to be replaced. On the other hand, if
          you install a peripheral Network Interface Card (NIC), there may be
          an increased chance of failure due to the extra mechanical
          connections involved. It can also be useful to have separate network
          cards serving sets and users (the internal network) and VoIP
          providers and external sites (the external network). NICs are cheap;
          we suggest always having at least two.</p></li><li class="listitem"><p><a id="Installation_Planning_id280702"></a><a id="Installation_Planning_id280704"></a>The stability and quality
          of your Asterisk system will be dependent on the components you
          select for its architecture. Asterisk is a beast, and it expects to
          be fed the best. As with just about anything, high cost is not
          always synonymous with quality, but you will want to become a
          connoisseur of computer components.</p></li></ul></div><p><a id="Installation_Planning_id280712"></a>Having said all that, we need
      to get back to the original point: Asterisk can and will happily install
      on pretty much any system that will run Linux. The lab systems used to
      write this book, for example, included everything from a Linksys WRT to
      a dual-Xeon locomotive.<sup>[<a id="id679450" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id679450" class="footnote">223</a>]</sup> We have not experienced any performance or stability
      problems running less than five concurrent telephone connections. For
      the purposes of learning, do not be afraid to install Asterisk on
      whatever system you can scrounge up. When you are ready to put your
      system into production, however, you will need to understand the
      ramifications of the choices you make with respect to your
      hardware.</p></div><div class="sect2" title="Power Supply Requirements"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-1.4"></a>Power Supply Requirements</h3></div></div></div><p><a id="Installation_Planning_id280766"></a><a id="I_indexterm_d1e59566" class="indexterm"></a>One often-overlooked component in a PC is the power supply
      (and the supply of power). For a telecommunications system,<sup>[<a id="id679496" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id679496" class="footnote">224</a>]</sup> these components can play a significant role in the
      quality of the user experience.</p><div class="sect3" title="Computer power supplies"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-1.4.1"></a>Computer power supplies</h4></div></div></div><p><a id="Installation_Planning_id280793"></a>The power supply you select
        for your system will play a vital role in the stability of the entire
        platform. Asterisk is not a particularly power-hungry application, but
        anything relating to multimedia (whether it be telephony, professional
        audio, video, or the like) is generally sensitive to power
        <span class="emphasis"><em>quality</em></span>.</p><p><a id="Installation_Planning_id280811"></a>This oft-neglected component
        can turn an otherwise top-quality system into a poor performer. By the
        same token, a top-notch power supply might enable an otherwise cheap
        PC to perform like a champ.</p><p><a id="Installation_Planning_id280816"></a>The power supplied to a
        system must provide not only the energy a system needs to perform its
        tasks but also stable, clean signal lines for all of the voltages the
        system expects from it.</p><p><a id="Installation_Planning_id280822"></a>Spend the money and get a
        top-notch power supply (gamers are pretty passionate about this sort
        of thing, so there are lots of choices out there).</p></div><div class="sect3" title="Redundant power supplies"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-1.4.2"></a>Redundant power supplies</h4></div></div></div><p><a id="Installation_Planning_id280835"></a><a id="I_indexterm_d1e59592" class="indexterm"></a>In a carrier-grade or high-availability environment, it
        is common to deploy servers that use a redundant power supply.
        Essentially, this involves two completely independent power supplies,
        either one of which is capable of meeting the power requirements of
        the system.</p><p><a id="Installation_Planning_id280851"></a>If this is important to you,
        keep in mind that best practices suggest that to be properly
        redundant, these power supplies should be connected to completely
        independent uninterruptible power supplies (UPSs) that are in turn fed
        by totally separate electrical circuits. In truly mission-critical
        environments (such as hospitals), even the main electrical feeds into
        the building are redundant, and diesel-powered generators are on-site
        to generate electricity during extended power failures (such as the
        one that hit Northeastern North America on August 15, 2003).<a id="I_indexterm_d1e59598" class="indexterm"></a><a id="I_indexterm_d1e59599" class="indexterm"></a></p></div></div></div><div class="sect1" title="Environment"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-2"></a>Environment</h2></div></div></div><p><a id="Installation_Planning_id280895"></a><a id="index-766U883WU3V" class="indexterm"></a><a id="index-157I481MR1S" class="indexterm"></a>Your system’s environment consists of all of those factors
    that are not actually part of the server itself but nevertheless play a
    crucial role in the reliability and quality that can be expected from the
    system. Electrical supplies, room temperature and humidity, sources of
    interference, and security are all factors that should be
    contemplated.</p><div class="sect2" title="Power Conditioning and Uninterruptible Power Supplies"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-2.1"></a>Power Conditioning and Uninterruptible Power Supplies</h3></div></div></div><p><a id="Installation_Planning_id287955"></a><a id="I_indexterm_d1e59619" class="indexterm"></a><a id="I_indexterm_d1e59622" class="indexterm"></a>When selecting the power sources for your system,
      consideration should be given not only to the amount of power the system
      will use, but also to the manner in which this power is
      delivered.</p><p><a id="Installation_Planning_id287977"></a>Power is not as simple as
      voltage coming from the outlet in the wall, and you should never just
      plug a production system into whatever electrical source is near at
      hand.<sup>[<a id="asterisk-InstallationPlanning-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-8" class="footnote">225</a>]</sup> Giving some consideration to the supply of power to your
      system can ensure that you provide a far more stable power environment,
      leading to a far more stable system.</p><p><a id="Installation_Planning_id287997"></a>One of the benefits of clean
      power is a reduction in heat, which means less stress on components,
      leading to a longer life expectancy.</p><p><a id="Installation_Planning_id288002"></a>Properly grounded, conditioned
      power feeding a premium-quality power supply will ensure a clean
      <span class="emphasis"><em>logic ground</em></span> (a.k.a. 0-volt) reference<sup>[<a id="asterisk-InstallationPlanning-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-9" class="footnote">226</a>]</sup> for the system and keep electrical noise on the
      motherboard to a minimum. These are industry-standard best practices for
      this type of equipment, which should not be neglected. A relatively
      simple way to achieve this is through the use of a
      <span class="emphasis"><em>power-conditioned</em></span> UPS.<sup>[<a id="asterisk-InstallationPlanning-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-10" class="footnote">227</a>]</sup></p><div class="sect3" title="Power-conditioned UPSs"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-2.1.1"></a>Power-conditioned UPSs</h4></div></div></div><p><a id="Installation_Planning_id241180"></a><a id="I_indexterm_d1e59659" class="indexterm"></a>The UPS is well known for its role as a battery backup,
        but the power-conditioning benefits that high-end UPS units also
        provide are less well understood.</p><p><a id="Installation_Planning_id241185"></a>Power conditioning can
        provide a valuable level of protection from the electrical environment
        by regenerating clean power through an isolation transformer. A
        quality power conditioner in your UPS will eliminate most electrical
        noise from the power feed and help to ensure a rock-steady supply of
        power to your system.</p><p><a id="Installation_Planning_id241191"></a>Unfortunately, not all UPS
        units are created equal; many of the less expensive units do not
        provide clean power. What’s worse, manufacturers of these devices will
        often promise all kinds of protection from surges, spikes,
        overvoltages, and transients. While such devices may protect your
        system from getting fried in an electrical storm, they will not clean
        up the power being fed to your system, and thus will do nothing to
        contribute to stability.</p><p><a id="Installation_Planning_id241201"></a>Make sure your UPS is
        <span class="emphasis"><em>power conditioned</em></span>. If it doesn’t say exactly
        that, it isn’t.</p></div></div><div class="sect2" title="Grounding"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-2.2"></a>Grounding</h3></div></div></div><p><a id="Installation_Planning_id288166"></a><span class="emphasis"><em>Voltage</em></span>
      <a id="I_indexterm_d1e59679" class="indexterm"></a>is defined as the difference in electrical potential
      between two points. When considering a <span class="emphasis"><em>ground</em></span>
      (which is basically nothing more than an electrical path to earth), the
      common assumption is that it represents 0 volts. But if we do not define
      that 0V in <span class="emphasis"><em>relation</em></span> to something, we are in danger
      of assuming things that may not be so. If you measure the voltage
      between two grounding references, you’ll often find that there is a
      voltage potential between them. This voltage potential between grounding
      points can be significant enough to cause logic errors—or even damage—in
      a system where more than one path to ground is present.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-InstallationPlanning-NOTE-5"></a>Tip</h3><p><a id="Installation_Planning_id288212"></a>One of the authors recalls
        once frying a sound card he was trying to connect to a friend’s stereo
        system. Even though both the computer and the stereo were in the same
        room, more than 6 volts of difference was measured between the ground
        conductors of the two electrical outlets they were plugged into! The
        wire between the stereo and the PC (by way of the sound card) provided
        a path that the voltage eagerly followed, thus frying a sound card
        that was not designed to handle that much current on its signal leads.
        Connecting both the PC and the stereo to the same outlet fixed the
        problem.</p></div><p><a id="Installation_Planning_id288223"></a>When considering electrical
      regulations, the purpose of a ground is primarily human safety. In a
      computer, the ground is used as a 0V logic reference. An electrical
      system that provides proper safety will not always provide a proper
      logic reference—in fact, the goals of safety and power quality are
      sometimes in disagreement. Naturally, when a choice must be made, safety
      has to take precedence.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-InstallationPlanning-NOTE-6"></a>Tip</h3><p><a id="Installation_Planning_id288241"></a>Since the difference between
        a binary zero and a binary one is represented in computers by voltage
        differences of sometimes less than 3V, it is entirely possible for
        unstable power conditions caused by poor grounding or electrical noise
        to cause all kinds of intermittent system problems. Some power and
        grounding advocates estimate that more than 80 percent of unexplained
        computer glitches can be traced to power quality. Most of us blame
        Microsoft.</p></div><p><a id="Installation_Planning_id288250"></a>Modern switching power
      supplies are somewhat isolated from power quality issues, but any
      high-performance system will always benefit from a well-designed power
      environment. In mainframes, proprietary PBXs, and other expensive
      computing <span class="keep-together">platforms</span>, the grounding
      of the system is never left to chance. The electronics and frames of
      these systems are always provided with a dedicated ground that does not
      depend on the safety grounds supplied with the electrical feed.</p><p><a id="Installation_Planning_id288262"></a>Regardless of how much you are
      willing to invest in grounding, when you specify the electrical supply
      to any PBX, ensure that the electrical circuit is completely dedicated
      to your system (as discussed in the next section) and that an insulated,
      isolated grounding conductor is provided. This can be expensive to
      provision, but it will contribute greatly to a quality power environment
      for your system.<sup>[<a id="asterisk-InstallationPlanning-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-11" class="footnote">228</a>]</sup></p><p><a id="Installation_Planning_id288293"></a>It is also vital that each and
      every peripheral you connect to your system be connected to the same
      electrical receptacle (or, more specifically, the same ground
      reference). This will cut down on the occurrence of ground loops, which
      can cause anything from buzzing and humming noises to damaged or
      destroyed equipment.</p></div><div class="sect2" title="Electrical Circuits"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-2.3"></a>Electrical Circuits</h3></div></div></div><p><a id="Installation_Planning_id288309"></a><a id="I_indexterm_d1e59714" class="indexterm"></a>If you’ve ever seen the lights dim when an electrical
      appliance kicks in, you’ve seen the effect that a high-energy device can
      have on an electrical circuit. If you were to look at the effects of a
      multitude of such devices, each drawing power in its own way, you would
      see that the harmonically perfect 50- or 60-Hz sine wave you may think
      you’re getting with your power is anything but. Harmonic noise is
      extremely common on electrical circuits , and it can wreak havoc on
      sensitive electronic equipment. For a PBX, these problems can manifest
      as audio problems, logic errors, and system instability.</p><p><a id="Installation_Planning_id253301"></a>Ideally, you should never
      install a server on an electrical circuit that is shared with other
      devices. There should be only one outlet on the circuit, and you should
      connect only your telephone system (and associated peripherals) to it.
      The wire (including the ground) should be run unbroken directly back to
      the electrical panel. The grounding conductor should be insulated and
      isolated. There are far too many stories of photocopiers, air
      conditioners, and vacuum cleaners wreaking havoc with sensitive
      electronics to ignore this rule of thumb.</p><div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-InstallationPlanning-NOTE-7"></a>Warning</h3><p><a id="Installation_Planning_id253328"></a>The electrical regulations
        in your area must always take precedence over any ideas presented
        here. If in doubt, consult a power quality expert in your area on how
        to ensure that you adhere to electrical regulations. Remember,
        electrical regulations take into account the fact that human safety is
        far more important than the safety of the equipment.</p></div></div><div class="sect2" title="The Equipment Room"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-2.4"></a>The Equipment Room</h3></div></div></div><p><a id="Installation_Planning_id253345"></a><a id="I_indexterm_d1e59727" class="indexterm"></a>Environmental conditions can wreak havoc on systems, yet
      it is quite common to see critical systems deployed with little or no
      attention given to these matters. When the system is installed,
      everything works well, but after as little as six months, components
      begin to fail. Talk to anyone with experience in maintaining servers and
      systems, and it becomes obvious that attention to environmental factors
      can play a significant role in the stability and reliability of
      systems.</p><div class="sect3" title="Humidity"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-2.4.1"></a>Humidity</h4></div></div></div><p><a id="Installation_Planning_id253370"></a><a id="I_indexterm_d1e59735" class="indexterm"></a>Simply put, humidity is water in the air. Water is a
        disaster for electronics for two main reasons: 1) water is a catalyst
        for corrosion, and 2) water is conductive enough that it can cause
        short circuits. Do not install any electronic equipment in areas of
        high humidity without providing a means to remove the moisture.</p></div><div class="sect3" title="Temperature"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-2.4.2"></a>Temperature</h4></div></div></div><p><a id="Installation_Planning_id253394"></a><a id="I_indexterm_d1e59743" class="indexterm"></a>Heat is the enemy of electronics. The cooler you keep
        your system, the more reliably it will perform, and the longer it will
        last. If you cannot provide a properly cooled room for your system, at
        a minimum ensure that it is placed in a location that ensures a steady
        supply of clean, cool air. Also, keep the temperature steady. Changes
        in temperature can lead to condensation and other damaging
        changes.</p></div><div class="sect3" title="Dust"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-2.4.3"></a>Dust</h4></div></div></div><p><a id="Installation_Planning_id288027"></a><a id="I_indexterm_d1e59751" class="indexterm"></a>An old adage in the computer industry holds that dust
        bunnies inside of a computer are lucky. Let’s consider some of the
        realities of dust bunnies:</p><div class="itemizedlist"><a id="Installation_Planning_id288042"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installation_Planning_id288044"></a><a id="Installation_Planning_id288046"></a>Significant buildup of
            dust can restrict airflow inside the system, leading to increased
            levels of heat.</p></li><li class="listitem"><p><a id="Installation_Planning_id288052"></a><a id="Installation_Planning_id288054"></a>Dust can contain metal
            particles, which, in sufficient quantities, can contribute to
            signal degradation or shorts on circuit boards.</p></li></ul></div><p><a id="Installation_Planning_id288061"></a>Put critical servers in a
        filtered environment, and clean out dust bunnies regularly.</p></div><div class="sect3" title="Security"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-2.4.4"></a>Security</h4></div></div></div><p><a id="Installation_Planning_id288073"></a><a id="I_indexterm_d1e59768" class="indexterm"></a><a id="I_indexterm_d1e59773" class="indexterm"></a>Server security naturally involves protecting against
        network-originated intrusions, but the environment also plays a part
        in the security of a system. Telephone equipment should always be
        locked away, and only persons who have a need to access the equipment
        should be allowed near it.<a id="I_indexterm_d1e59779" class="indexterm"></a><a id="I_indexterm_d1e59780" class="indexterm"></a></p></div></div></div><div class="sect1" title="Telephony Hardware"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-3"></a>Telephony Hardware</h2></div></div></div><p><a id="Installation_Planning_id288113"></a><a id="index-156O153FN0H" class="indexterm"></a><a id="index-888O504CW8U" class="indexterm"></a>If you are going to connect Asterisk to any traditional
    telecommunications equipment, you will need the correct hardware. The
    hardware you require will be determined by what it is you want to
    achieve.</p><div class="sect2" title="Connecting to the PSTN"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-3.1"></a>Connecting to the PSTN</h3></div></div></div><p><a id="Installation_Planning_id288153"></a><a id="I_indexterm_d1e59801" class="indexterm"></a>Asterisk allows you to seamlessly bridge circuit-switched
      telecommunications networks<sup>[<a id="asterisk-InstallationPlanning-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-12" class="footnote">229</a>]</sup> with packet-switched data networks.<sup>[<a id="asterisk-InstallationPlanning-FN-13" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-13" class="footnote">230</a>]</sup></p><p>Because of Asterisk’s open architecture (and open source code), it
      is ultimately possible to connect any standards-compliant interface
      hardware. The selection of open source telephony interface boards is
      currently limited, but as interest in Asterisk grows, that will rapidly
      change.<sup>[<a id="asterisk-InstallationPlanning-FN-14" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-14" class="footnote">231</a>]</sup> At the moment, one of the most popular and cost-effective
      ways to connect to the PSTN is to use the <span class="keep-together">interface</span> cards that evolved from the work
      of the Zapata Telephony Project (<a class="ulink" href="http://www.zapatatelephony.org/" target="_top">http://www.zapatatelephony.org</a>), which has evolved into
      DAHDI.</p><div class="sect3" title="Analog interface cards"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-3.1.1"></a>Analog interface cards</h4></div></div></div><p><a id="Installation_Planning_id248555"></a><a id="I_indexterm_d1e59834" class="indexterm"></a>Unless you need a lot of channels (or a have lot of
        money to spend each month on telecommunications facilities), chances
        are that your PSTN interface will consist of one or more analog
        circuits, each of which will require a Foreign eXchange Office (FXO)
        port.</p><p><a id="Installation_Planning_id248593"></a>Digium, the company that
        sponsors Asterisk development, produces analog interface cards for
        Asterisk. Check out its website (<a class="ulink" href="http://www.digium.com/" target="_top">http://www.digium.com</a>) for details on its extensive
        line of analog cards, including the venerable TDM400P, the latest
        TDM800P, and the high-density TDM2400P. As an example, the TDM800P is
        an eight-port base card that allows for the insertion of up to two
        daughter cards, which each deliver either four FXO or four FXS
        ports.<sup>[<a id="asterisk-InstallationPlanning-FN-16" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-16" class="footnote">232</a>]</sup> The TDM800P can be purchased with these modules
        preinstalled, and a hardware echo-canceller can be added as
        well.</p><p><a id="Installation_Planning_id248681"></a>Other companies that produce
        Asterisk-compatible analog cards include:</p><div class="itemizedlist"><a id="Installation_Planning_id248709"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installation_Planning_id248711"></a><a id="Installation_Planning_id248713"></a>Rhino (<a class="ulink" href="http://www.rhinoequipment.com/" target="_top">http://www.rhinoequipment.com</a>)</p></li><li class="listitem"><p><a id="Installation_Planning_id248723"></a><a id="Installation_Planning_id248725"></a>Sangoma (<a class="ulink" href="http://www.sangoma.com/" target="_top">http://www.sangoma.com</a>)</p></li><li class="listitem"><p><a id="Installation_Planning_id248735"></a><a id="Installation_Planning_id248737"></a>Voicetronix (<a class="ulink" href="http://www.voicetronix.com/" target="_top">http://www.voicetronix.com</a>)</p></li><li class="listitem"><p><a id="Installation_Planning_id248748"></a><a id="Installation_Planning_id248750"></a>Pika <span class="keep-together">Technologies</span> (<a class="ulink" href="http://www.pikatechnologies.com/" target="_top">http://www.pikatechnologies.com</a>)</p></li></ul></div></div><div class="sect3" title="Digital interface cards"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-3.1.2"></a>Digital interface cards</h4></div></div></div><p><a id="Installation_Planning_id248787"></a><a id="I_indexterm_d1e59878" class="indexterm"></a>If you require more than 10 circuits, or require digital
        connectivity, chances are you’re going to be in the market for a T1 or
        E1 card.<sup>[<a id="asterisk-InstallationPlanning-FN-17" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-17" class="footnote">233</a>]</sup> Bear in mind, though, that the monthly charges for a
        digital PSTN circuit vary widely. In some places, as few as five
        circuits can justify a digital circuit; in others, the technology may
        never be cost-justifiable. The more competition there is in your area,
        the better chance you have of finding a good deal. Be sure to shop
        around.</p><p><a id="Installation_Planning_id248839"></a>The Zapata Telephony Project
        originally produced a T1 card, the Tormenta, that is the ancestor of
        most Asterisk-compatible T1 cards. The original Tormenta cards are now
        considered obsolete, but they do still work with Asterisk.</p><p><a id="Installation_Planning_id248865"></a>Digium makes several
        different digital circuit interface cards. The features on the cards
        are the same; the primary differences are whether they provide T1 or
        E1 interfaces, and how many spans each card provides. Digium has been
        producing DAHDI cards for Linux longer than anyone else; it was deeply
        involved with the development of DAHDI (formerly Zaptel) on Linux, and
        has been the driving force behind DAHDI development over the
        years.</p><p><a id="Installation_Planning_id286306"></a>Sangoma, which has been
        producing open source WAN cards for many years, added Asterisk support
        for its T1/E1 cards a few years ago.<sup>[<a id="asterisk-InstallationPlanning-FN-18" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-18" class="footnote">234</a>]</sup> Rhino has had T1 hardware for Asterisk for a while now,
        and there are many other companies that offer digital interface cards
        for Asterisk as well.</p></div><div class="sect3" title="Channel banks"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-3.1.3"></a>Channel banks</h4></div></div></div><p><a id="Installation_Planning_id286345"></a><a id="I_indexterm_d1e59904" class="indexterm"></a>A <span class="emphasis"><em>channel bank</em></span> is loosely defined
        as a device that allows a digital circuit to be de-multiplexed into
        several analog circuits (and vice versa). More specifically, a channel
        bank lets you connect analog telephones and lines into a system across
        a T1 line. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FIG-2" title="Figure C.2. One way you might connect a channel bank">Figure&nbsp;C.2, “One way you might connect a channel bank”</a>
        shows how a channel bank fits into a typical office phone
        system.</p><div class="figure-float"><div class="figure"><a id="asterisk-InstallationPlanning-FIG-2"></a><p class="title"><strong>Figure&nbsp;C.2.&nbsp;One way you might connect a channel bank</strong></p><div class="figure-contents"><div class="mediaobject"><a id="I_mediaobject2_tt154"></a><img src="./Asterisk™_ The Definitive Guide_files/adg3_ac02.png" alt="One way you might connect a channel bank"></div></div></div><br class="figure-break"></div><p><a id="Installation_Planning_id286412"></a>Although they can be
        expensive to purchase, many people feel very strongly that the only
        proper way to integrate analog circuits and devices into Asterisk is
        through a channel bank. Whether that is true or not depends on a lot
        of factors, but if you have the budget, they can be very
        useful.<sup>[<a id="id680831" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id680831" class="footnote">235</a>]</sup> You can often pick up used channel banks on eBay. Look
        for units from Adtran and Carrier Access Corp. (Rhino makes great
        channel banks, and they are very competitively priced, but they may be
        hard to find used.) Don’t forget that you will need a T1 card in order
        to connect a channel bank to Asterisk.</p></div><div class="sect3" title="Other types of PSTN interfaces"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-3.1.4"></a>Other types of PSTN interfaces</h4></div></div></div><p><a id="Installation_Planning_id286440"></a>Many VoIP gateways exist
        that can be configured to provide access to PSTN circuits. Generally
        speaking, these will be of most use in a smaller system (one or two
        lines). They can also be very complicated to configure, as grasping
        the interaction between the various networks and devices requires a
        solid understanding of both telephony and VoIP fundamentals. For that
        reason, we will not discuss these devices in detail in this book. They
        are worth looking into, however; popular units are made by Sipura,
        Grandstream, Digium, and many other companies.</p><p><a id="Installation_Planning_id286465"></a>Another way to connect to
        the PSTN is through the use of Basic Rate Interface (BRI) ISDN
        circuits. BRI is a digital telecom standard that specifies a
        two-channel circuit that can carry up to 144 Kbps of traffic.<sup>[<a id="id680874" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id680874" class="footnote">236</a>]</sup> Due to the variety of ways this technology has been
        implemented, and a lack of testing equipment, we will not be
        discussing BRI in very much detail in this book.</p></div></div><div class="sect2" title="Connecting Exclusively to a Packet-Based Telephone Network"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-3.2"></a>Connecting Exclusively to a Packet-Based Telephone
      Network</h3></div></div></div><p><a id="Installation_Planning_id286516"></a><a id="I_indexterm_d1e59942" class="indexterm"></a>If you do not need to connect to the PSTN, Asterisk
      requires no hardware other than a server with a Network Interface Card.
      However, you still may need to install the DAHDI kernel modules, as
      DAHDI is required for using the <code class="literal">MeetMe()</code> application
      for conferencing.</p></div><div class="sect2" title="Echo Cancellation"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-3.3"></a>Echo Cancellation</h3></div></div></div><p><a id="Installation_Planning_id286560"></a><a id="I_indexterm_d1e59955" class="indexterm"></a>One of the issues that can arise if you use analog
      interfaces on a VoIP system is echo. <span class="emphasis"><em>Echo</em></span> is simply
      what you say being reflected back to you a short time later. The echo is
      caused by the far end, but you are the one that hears it. It is a
      little-known fact that echo would be a massive problem in the PSTN were
      it not for the fact that the carriers employ complex (and expensive)
      strategies to eliminate it. We suggest that you consider adding
      echo-cancellation hardware to any card you purchase for use as a PSTN
      interface. While Asterisk can do some work with echo in software, it
      does not provide nearly enough power to deal with the problem. Also,
      echo cancellation in software imposes a load on the processor; hardware
      echo cancellers built into the PSTN card take this burden away from the
      CPU.</p><p><a id="Installation_Planning_id286595"></a>Hardware echo cancellation can
      add several hundred dollars to your equipment cost, but if you are
      serious about having a quality system, invest the extra money now
      instead of suffering later. Echo problems are not pleasant at all, and
      your users will hate the system if they experience it.</p><p><a id="Installation_Planning_id286601"></a>Several software echo
      cancellers have recently become available. We have not had a chance to
      evaluate any of them, but we know that they employ the same algorithms
      the hardware echo cancellers do. If you have a recently purchased Digium
      analog card, you can call Digium sales for a keycode to allow its latest
      software echo canceller to work with your system.<sup>[<a id="id680982" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id680982" class="footnote">237</a>]</sup> There are other software options available for other types
      of cards, but you will have to look into whether you have to purchase a
      license to use them.<sup>[<a id="id680995" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id680995" class="footnote">238</a>]</sup> Keep in mind that there is a performance cost to using
      software echo cancellers. They will place a measurable load on the CPU
      that needs to be taken into account when you design a system using these
      technologies.<a id="I_indexterm_d1e59976" class="indexterm"></a><a id="I_indexterm_d1e59977" class="indexterm"></a></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For more on the topic of echo cancellation, see <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.</p></div></div></div><div class="sect1" title="Types of Phones"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-4"></a>Types of Phones</h2></div></div></div><p><a id="Installation_Planning_id286663"></a><a id="index-687S378PH4S" class="indexterm"></a><a id="index-305E082GJ8G" class="indexterm"></a>We all know what a telephone is—but will it be the same five
    years from now? Part of the revolution that Asterisk is contributing to is
    the evolution of the telephone, from a simple audio communications device
    into a multimedia communications terminal providing all kinds of
    yet-to-be-imagined functions.</p><p><a id="Installation_Planning_id286707"></a>As an introduction to this
    exciting concept, we will briefly discuss the various kinds of devices we
    currently call “telephones” (any of which can easily be integrated with
    <span class="keep-together">Asterisk</span>). We will also discuss some
    ideas about what these devices may evolve into in the future (devices that
    will also easily integrate with Asterisk).</p><div class="sect2" title="Physical Telephones"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-4.1"></a>Physical Telephones</h3></div></div></div><p><a id="Installation_Planning_id268480"></a>Any physical device whose
      primary purpose is terminating an on-demand audio communications circuit
      between two points can be classified as a physical telephone. At a
      minimum, such a device has a handset and a dial pad; it may also have
      feature keys, a display screen, and various audio interfaces.</p><p><a id="Installation_Planning_id268486"></a>This section takes a brief
      look at the various user (or endpoint) devices you might want to connect
      to your Asterisk system. We delve more deeply into the mechanics of
      analog and digital telephony in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>.</p><div class="sect3" title="Analog telephones"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-4.1.1"></a>Analog telephones</h4></div></div></div><p><a id="Installation_Planning_id268506"></a><a id="I_indexterm_d1e60016" class="indexterm"></a>Analog phones have been around since the invention of
        the telephone. Up until about 20 years ago, all telephones were
        analog. Although analog phones have some technical differences in
        different countries, they all operate on similar principles.</p><p><a id="Installation_Planning_id268573"></a>When a human being speaks,
        the vocal cords, tongue, teeth, and lips create a complex variety of
        sounds. The purpose of the telephone is to capture these sounds and
        convert them into a format suitable for transmission over wires. In an
        analog telephone, the transmitted signal is
        <span class="emphasis"><em>analogous</em></span> to the sound waves produced by the
        person speaking. If you could see the sound waves passing from the
        mouth to the microphone, they would be proportional to the electrical
        signal you could measure on the wire.</p><p><a id="Installation_Planning_id268584"></a>Analog telephones are the
        only kind of phones that are commonly available in any retail
        electronics store. In the next few years, that can be expected to
        change dramatically.</p></div><div class="sect3" title="Proprietary digital telephones"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-4.1.2"></a>Proprietary digital telephones</h4></div></div></div><p><a id="Installation_Planning_id268598"></a><a id="I_indexterm_d1e60033" class="indexterm"></a>As digital switching systems developed in the 1980s and
        1990s, telecommunications companies developed digital private branch
        exchanges (PBXs) and key telephone systems (KTSs). The proprietary
        telephones developed for these systems were completely dependent on
        the systems to which they were connected and could not be used on any
        other systems. Even phones produced by the same manufacturer were not
        cross-compatible (for example, a Nortel Norstar set will not work on a
        Nortel Meridian 1 PBX). The proprietary nature of digital telephones
        limits their future. In this emerging era of standards-based
        communications, they will quickly be relegated to the dustbin of
        <span class="keep-together">history</span>.</p><p><a id="Installation_Planning_id268654"></a>The handset in a digital
        telephone is generally identical in function to the handset in an
        analog telephone, and they are often compatible with each other. Where
        the digital phone is different is that inside the telephone, the
        analog signal is sampled and converted into a digital signal—that is,
        a numerical representation of the analog waveform. We discuss digital
        signals in more detail in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>; for now, suffice it to
        say that the primary advantage of a digital signal is that it can be
        transmitted over limitless distances with no loss of signal
        quality.</p><p><a id="Installation_Planning_id268673"></a>The chances of anyone ever
        making a proprietary digital phone directly compatible with Asterisk
        are slim, but companies such as Citel (<a class="ulink" href="http://www.citel.com/" target="_top">http://www.citel.com</a>)<sup>[<a id="id681274" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id681274" class="footnote">239</a>]</sup> have created gateways that convert the proprietary
        signals to Session Initiation Protocol (SIP).<sup>[<a id="asterisk-InstallationPlanning-FN-19" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-19" class="footnote">240</a>]</sup></p></div><div class="sect3" title="ISDN telephones"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-4.1.3"></a>ISDN telephones</h4></div></div></div><p><a id="Installation_Planning_id268736"></a><a id="I_indexterm_d1e60061" class="indexterm"></a>Prior to VoIP, the closest thing to a standards-based
        digital telephone was an ISDN-BRI terminal. Developed in the early
        1980s, ISDN was expected to revolutionize the telecommunications
        industry in exactly the same way that VoIP promises to finally achieve
        today.</p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title"><a id="asterisk-InstallationPlanning-NOTE-9"></a>Tip</h3><p><a id="Installation_Planning_id268760"></a>There are two types of
          ISDN: <span class="emphasis"><em><span class="emphasis"><em>Primary Rate
          Interface</em></span></em></span> (PRI) and <span class="emphasis"><em><span class="emphasis"><em>Basic
          Rate Interface</em></span></em></span> (BRI). PRI is commonly used to
          provide trunking facilities between PBXs and the PSTN, and is widely
          deployed all over the world. BRI is not at all popular in North
          America, but is common in Europe.</p></div><p><a id="Installation_Planning_id268811"></a>While ISDN was widely
        deployed by the telephone companies, many consider the standard to
        have been a flop, as it generally failed to live up to its promises.
        The high costs of implementation, recurring charges, and lack of
        cooperation among the major industry players contributed to an
        environment that caused more problems than it solved.</p><p><a id="Installation_Planning_id268817"></a>BRI was intended to service
        terminal devices and smaller sites (a BRI loop provides two digital
        circuits). A wealth of BRI devices have been developed, but BRI has
        largely been deprecated in favor of faster, less expensive
        technologies such as ADSL, cable modems, and VoIP.</p><p><a id="Installation_Planning_id268823"></a>BRI is still very popular
        for use in videoconferencing equipment, as it provides a
        fixed-bandwidth link. Also, BRI does not have the type of quality of
        service issues a VoIP connection might, as it is
        circuit-switched.</p><p><a id="Installation_Planning_id268829"></a>BRI is still sometimes used
        in place of analog circuits to provide trunking to a PBX. Whether or
        not this is a good idea depends mostly on how your local phone company
        prices the service, and what features it is willing to
        provide.<sup>[<a id="id681395" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id681395" class="footnote">241</a>]</sup></p></div><div class="sect3" title="IP telephones"><div class="titlepage"><div><div><h4 class="title"><a id="asterisk-InstallationPlanning-SECT-4.1.4"></a>IP telephones</h4></div></div></div><p><a id="Installation_Planning_id268847"></a><a id="I_indexterm_d1e60091" class="indexterm"></a>IP telephones are heralds of the most exciting change in
        the telecommunications industry. Already, standards-based IP
        telephones are available in retail stores. The wealth of possibilities
        inherent in these devices will cause an explosion of interesting
        applications, from video phones to high-fidelity broadcasting devices
        to wireless mobility solutions to purpose-built sets for particular
        industries to flexible all-in-one multimedia systems.</p><p><a id="Installation_Planning_id268864"></a>The revolution that IP
        telephones will spawn has nothing to do with a new type of wire to
        connect your phone to, and everything to do with giving you the power
        to communicate the way you want.</p><p><a id="Installation_Planning_id268869"></a>The early-model IP phones
        that have been available for several years now do not represent the
        future of these exciting appliances. They are merely a stepping-stone,
        a familiar package in which to wrap a fantastic new way of
        thinking.</p><p><a id="Installation_Planning_id268875"></a>The future is far more
        promising.</p></div></div><div class="sect2" title="Softphones"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-4.2"></a>Softphones</h3></div></div></div><p><a id="Installation_Planning_id272649"></a><a id="I_indexterm_d1e60107" class="indexterm"></a>A <span class="emphasis"><em>softphone</em></span> is a software program
      that provides telephone functionality on a non-telephone device, such as
      a PC or PDA. So how do we recognize such a beast? What might at first
      glance seem a simple question actually raises many. A softphone should
      probably have some sort of dial pad, and it should provide an interface
      that reminds users of a telephone. But will this always be the
      case?</p><p><a id="Installation_Planning_id272667"></a>The term
      <span class="emphasis"><em>softphone</em></span> can be expected to evolve rapidly, as our
      concept of what exactly a telephone is undergoes a revolutionary
      metamorphosis.<sup>[<a id="id681509" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.id681509" class="footnote">242</a>]</sup> As an example of this evolution, consider the following:
      would we correctly define popular communication programs such as Instant
      Messenger as softphones? IM provides the ability to initiate and receive
      standards-based VoIP connections. Does this not qualify it as a
      softphone? Answering that question requires knowledge of the future that
      we do not yet possess. Suffice it to say that, while at this point in
      time softphones are expected to look and sound like traditional phones,
      that conception is likely to change in the very near future.</p><p><a id="Installation_Planning_id272683"></a>As standards evolve and we
      move away from the traditional telephone and toward a multimedia
      communications culture, the line between softphones and physical
      telephones will become blurred indeed. For example, we might purchase a
      communications terminal to serve as a telephone and install a softphone
      program onto it to provide the functions we desire.</p><p><a id="Installation_Planning_id272690"></a>Having thus muddied the
      waters, the best we can do at this point is to define what the term
      <span class="emphasis"><em>softphone</em></span> will refer to in relation to this book,
      with the understanding that the meaning of the term can be expected to
      undergo a massive change over the next few years. For our purposes, we
      will define a softphone as any device that runs on a personal computer,
      presents the look and feel of a telephone, and provides as its primary
      function the ability to make and receive full-duplex audio
      communications (formerly known as “phone calls”)<sup>[<a id="asterisk-InstallationPlanning-FN-21" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-21" class="footnote">243</a>]</sup> through E.164 addressing.<sup>[<a id="asterisk-InstallationPlanning-FN-22" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ftn.asterisk-InstallationPlanning-FN-22" class="footnote">244</a>]</sup></p></div><div class="sect2" title="Telephony Adaptors"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-4.3"></a>Telephony Adaptors</h3></div></div></div><p><a id="Installation_Planning_id272734"></a><a id="I_indexterm_d1e60144" class="indexterm"></a>A <span class="emphasis"><em>telephony adaptor</em></span> (usually referred
      to as an ATA, or Analog Terminal Adaptor) can loosely be described as an
      end-user device that converts communications circuits from one protocol
      to another. Most commonly, these devices are used to convert from some
      digital (IP or proprietary) signal to an analog connection that you can
      plug a standard telephone or fax machine into.</p><p><a id="Installation_Planning_id272782"></a>These adaptors could be
      described as gateways, for that is their function. However, popular
      usage of the term <span class="emphasis"><em>telephony gateway</em></span> would probably
      best describe a multiport telephony adaptor, generally with more
      complicated routing functions.</p><p><a id="Installation_Planning_id272802"></a>Telephony adaptors will be
      with us for as long as there is a need to connect incompatible standards
      and old devices to new networks. Eventually, our reliance on these
      devices will disappear, as did our reliance on the modem—obsolescence
      through irrelevance.</p></div><div class="sect2" title="Communications Terminals"><div class="titlepage"><div><div><h3 class="title"><a id="asterisk-InstallationPlanning-SECT-4.4"></a>Communications Terminals</h3></div></div></div><p><a id="Installation_Planning_id272820"></a><span class="emphasis"><em>Communications
      terminal</em></span> <a id="I_indexterm_d1e60165" class="indexterm"></a>is an old term that disappeared for a decade or two and is
      being reintroduced here, very possibly for no other reason than that it
      needs to be discussed so that it can eventually disappear again—once it
      becomes ubiquitous.</p><p><a id="Installation_Planning_id272839"></a>First, a little history. When
      digital PBX systems were first released, manufacturers of these machines
      realized that they could not refer to their endpoints as
      telephones—their proprietary nature prevented them from connecting to
      the PSTN. They were therefore called <span class="emphasis"><em>terminals</em></span>, or
      <span class="emphasis"><em>stations</em></span>. Users, of course, weren’t having any of
      it. It looked like a telephone and acted like a telephone, and therefore
      it <span class="emphasis"><em>was</em></span> a telephone. You will still occasionally
      find PBX sets referred to as terminals, but for the most part they are
      called telephones.</p><p><a id="Installation_Planning_id272877"></a>The renewed relevance of the
      term <span class="emphasis"><em>communications terminal</em></span> has nothing to do with
      anything proprietary—rather, it’s the opposite. As we develop more
      creative ways of communicating with each other, we gain access to many
      different devices that will allow us to connect. Consider the following
      scenarios:</p><div class="itemizedlist"><a id="Installation_Planning_id272889"></a><ul class="itemizedlist" type="disc"><li class="listitem"><p><a id="Installation_Planning_id272891"></a><a id="Installation_Planning_id272893"></a>If I use my PDA to connect
          to my voicemail and retrieve my voice messages (converted to text),
          does my PDA become a phone?</p></li><li class="listitem"><p><a id="Installation_Planning_id272899"></a><a id="Installation_Planning_id272901"></a>If I attach a video camera
          to my PC, connect to a company’s website, and request a live chat
          with a customer service rep, is my PC now a telephone?</p></li><li class="listitem"><p><a id="Installation_Planning_id272908"></a><a id="Installation_Planning_id272910"></a>If I use the IP phone in
          my kitchen to surf for recipes, is that a phone call?</p></li></ul></div><p><a id="Installation_Planning_id272917"></a>The point is simply this:
      we’ll probably always be “phoning” each other, but will we always use
      “telephones” to do so?<a id="I_indexterm_d1e60197" class="indexterm"></a><a id="I_indexterm_d1e60198" class="indexterm"></a></p></div></div><div class="sect1" title="Linux Considerations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-5"></a>Linux Considerations</h2></div></div></div><p><a id="Installation_Planning_id272959"></a><a id="I_indexterm_d1e60203" class="indexterm"></a><a id="I_indexterm_d1e60208" class="indexterm"></a>If you ask anyone at the Free Software Foundation, they will
    tell you that what we know as Linux is in fact GNU/Linux. All etymological
    arguments aside, there is some valuable truth to this statement. While the
    kernel of the operating system is indeed Linux, the vast majority of the
    utilities installed on a Linux system and used regularly are in fact GNU
    utilities. “Linux” is probably only 5 percent Linux, possibly 75 percent
    GNU, and perhaps 20 percent everything else.</p><p><a id="Installation_Planning_id272980"></a>Why does this matter? Well, the
    flexibility of Linux is both a blessing and a curse. It is a blessing
    because with Linux you can truly craft your very own operating system from
    scratch. Since very few people ever do this, the curse is in large part
    due to the responsibility you must bear in determining which of the GNU
    utilities to install, and how to configure the system.</p></div><div class="sect1" title="Conclusion"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="asterisk-InstallationPlanning-SECT-6"></a>Conclusion</h2></div></div></div><p><a id="Installation_Planning_id273004"></a>In this appendix, we’ve
    discussed all manner of issues that can contribute to the stability and
    quality of an Asterisk installation. How much time and effort you should
    devote to following the best practices and engineering tips in this
    appendix all depends on how much work you expect the Asterisk server to
    perform, and how much quality and reliability your system must provide. If
    you are experimenting with Asterisk, don’t worry too much; just be aware
    that any problems you have may not be the fault of the Asterisk
    system.</p><p><a id="Installation_Planning_id273028"></a>What we have attempted to do in
    this appendix is give you a feel for the kinds of best practices that will
    help to ensure that your Asterisk system will be built on a reliable,
    stable platform. Asterisk is quite willing to operate under far worse
    conditions, but the amount of effort and consideration you decide to give
    these matters will play a part in the stability of your PBX. Your decision
    should depend on how critical your Asterisk system will be.<a id="I_indexterm_d1e60223" class="indexterm"></a><a id="I_indexterm_d1e60224" class="indexterm"></a></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-1" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-1" class="para">218</a>] </sup>People have successfully compiled and run Asterisk on WRAP boards,
      Linksys WRT54G routers, Soekris systems, Pentium 100s, PDAs, Apple Macs,
      Sun SPARCs, laptops, and more. Of course, whether you would
      <span class="emphasis"><em>want</em></span> to put such a system into production is
      another matter entirely. (Actually, the AstLinux distribution, by
      Kristian Kielhofner, runs very well indeed on the Soekris 4801 board.
      Once you’ve grasped the basics of Asterisk, this is something worth
      looking into further. Check out <a class="ulink" href="http://www.astlinux.org/" target="_top">http://www.astlinux.org</a>.)</p></div><div class="footnote"><p><sup>[<a id="ftn.id678452" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id678452" class="para">219</a>] </sup>Roughly 30 MHz of CPU power per channel.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-6" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-6" class="para">220</a>] </sup>If you want to be completely up-to-the-minute on which CPUs
          are leading the performance race, surf on over to Tom’s Hardware
          (<a class="ulink" href="http://www.tomshardware.com/" target="_top">http://www.tomshardware.com</a>) or AnandTech
          (<a class="ulink" href="http://www.anandtech.com/" target="_top">http://www.anandtech.com</a>), where you will
          find a wealth of information about both current and out-of-date
          CPUs, motherboards, and chipsets.</p></div><div class="footnote"><p><sup>[<a id="ftn.id679025" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id679025" class="para">221</a>] </sup>Greg Boehnlein once compiled and ran Asterisk on a 133-MHz
            Pentium system, but that was mostly as an experiment. Performance
            problems are far more likely in such conditions, and properly
            configuring such a system requires an expert knowledge of Linux.
            We do not recommend running Asterisk on anything less than a
            500-MHz system (for a production system, 2 GHz might be a sensible
            minimum). Still, we think the fact that Asterisk is so flexible is
            remarkable.</p></div><div class="footnote"><p><sup>[<a id="ftn.id679275" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id679275" class="para">222</a>] </sup>With the advent of PCI-X and PCI-Express, it is becoming
              harder and harder to select a motherboard with the correct type
              of slots. Be very certain that the motherboard you select has
              the correct type and quantity of card slots for your hardware.
              Keep in mind that most companies that produce hardware cards for
              Asterisk offer PCI and PCI-Express versions, but it’s still up
              to you to make sure they make sense in whatever motherboard and
              chassis combination you choose.</p></div><div class="footnote"><p><sup>[<a id="ftn.id679450" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id679450" class="para">223</a>] </sup>OK, it wasn’t <span class="emphasis"><em>actually</em></span> a locomotive, but
          it sure sounded like one. Does anyone know where to get quiet CPU
          fans for Xeon processors? It’s getting too loud in the lab
          here.</p></div><div class="footnote"><p><sup>[<a id="ftn.id679496" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id679496" class="para">224</a>] </sup>Or any system that is expected to process audio.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-8" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-8" class="para">225</a>] </sup>Okay, look, you <span class="emphasis"><em>can</em></span> plug it in wherever
          you’d like, and it’ll probably work, but if your system has strange
          stability problems, please give this section another read.
          Deal?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-9" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-9" class="para">226</a>] </sup>In electronic devices, a binary zero (0) is generally related
          to a 0-volt signal, while a binary one (1) can be represented by
          many different voltages (commonly between 2.5 and 5 volts). The
          grounding reference that the system will consider 0 volts is often
          referred to as the <span class="emphasis"><em>logic ground</em></span>. A poorly
          grounded system might have electrical potential on the logic ground
          to such a degree that the electronics mistake a binary zero for a
          binary one. This can wreak havoc with the system’s ability to
          process instructions.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-10" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-10" class="para">227</a>] </sup>It is a common misconception that all UPSs provide clean
          power. This is not at all true.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-11" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-11" class="para">228</a>] </sup>On a hobby system, this is probably too much to ask, but if
          you are planning on using Asterisk for anything important, at least
          be sure to give it a fighting chance; don’t put anything like air
          conditioners, photocopiers, laser printers, or motors on the same
          circuit. The strain such items place on your power supply will
          shorten its life expectancy.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-12" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-12" class="para">229</a>] </sup>Often called <span class="emphasis"><em><span class="emphasis"><em>TDM
          networks</em></span></em></span>, due to the time division
          multiplexing used to carry traffic through the PSTN.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-13" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-13" class="para">230</a>] </sup>Popularly called VoIP networks, although Voice over IP is not
          the only method of transmitting voice over packet networks (Voice
          over Frame Relay was very popular in the late 1990s).</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-14" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-14" class="para">231</a>] </sup>The evolution of inexpensive, commodity-based telephony
          hardware is only slightly behind the telephony software revolution.
          New companies spring up on a weekly basis, each one bringing new and
          inexpensive standards-based devices into the market.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-16" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-16" class="para">232</a>] </sup>FXS and FXO refer to the opposing ends of an analog circuit.
            Which one you need will be determined by what you want to connect
            to. <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a> discusses
            these in more detail.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-17" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-17" class="para">233</a>] </sup>T1 and E1 are digital telephony circuits. We discuss them
            further in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony" title="Appendix A. Understanding Telephony">Appendix&nbsp;A, <em>Understanding Telephony</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-18" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-18" class="para">234</a>] </sup>It should be noted that a Sangoma Frame Relay card played a
            role in the original development of Asterisk (see <a class="ulink" href="http://linuxdevices.com/articles/AT8678310302.html" target="_top">http://linuxdevices.com/articles/AT8678310302.html</a>);
            Sangoma has a long history of supporting open source WAN
            interfaces with Linux.</p></div><div class="footnote"><p><sup>[<a id="ftn.id680831" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id680831" class="para">235</a>] </sup>We use channel banks to simulate a central office. One
            24-port channel bank off an Asterisk system can provide up to 24
            analog lines—perfect for a classroom or lab.</p></div><div class="footnote"><p><sup>[<a id="ftn.id680874" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id680874" class="para">236</a>] </sup>BRI is very rarely used in North America but is very popular
            in Europe, and Digium has produced the B410P card to address this
            need.</p></div><div class="footnote"><p><sup>[<a id="ftn.id680982" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id680982" class="para">237</a>] </sup>This software is not part of a normal Asterisk download
          because Digium has to pay to license it separately. Nevertheless, it
          has grandfathered it into all of its cards, so it is available for
          free to anyone who has a Digium analog card that is still under
          warranty. If you are running a non-Digium analog card, you can
          purchase a keycode for this software echo canceller from Digium’s
          website.</p></div><div class="footnote"><p><sup>[<a id="ftn.id680995" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id680995" class="para">238</a>] </sup>Sangoma also offers free software echo cancellation on its
          analog cards (up to six channels).</p></div><div class="footnote"><p><sup>[<a id="ftn.id681274" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id681274" class="para">239</a>] </sup>Citel has produced a fantastic product, but it is limited by
            the fact that it is too expensive. If you have old proprietary PBX
            telephones, and you want to use them with your Asterisk system,
            Citel’s technology can do the job, but make sure you understand
            how the per-port cost of these units stacks up against replacing
            the old sets with pure VoIP telephones.</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-19" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-19" class="para">240</a>] </sup>SIP is currently the most well-known and popular protocol
            for VoIP. We discuss it further in <a class="xref" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP" title="Appendix B. Protocols for VoIP">Appendix&nbsp;B, <em>Protocols for VoIP</em></a>.</p></div><div class="footnote"><p><sup>[<a id="ftn.id681395" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id681395" class="para">241</a>] </sup>If you are in North America, give up on this idea, unless
            you have a lot of patience and money and are a bit of a
            masochist.</p></div><div class="footnote"><p><sup>[<a id="ftn.id681509" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id681509" class="para">242</a>] </sup>Ever heard of Skype?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-21" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-21" class="para">243</a>] </sup>OK, so you think you know what a phone call is? So did we.
          Let’s just wait a few years, shall we?</p></div><div class="footnote"><p><sup>[<a id="ftn.asterisk-InstallationPlanning-FN-22" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-FN-22" class="para">244</a>] </sup>E.164 is the ITU standard that defines how phone numbers are
          assigned. If you’ve used a telephone, you’ve used E.164
          addressing.</p></div></div></div><div class="index" title="Index"><div class="titlepage"><div><div><h2 class="title"><a id="book_id192672"></a>Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>Symbols</h3><dl><dt>! (exclamation mark), in section name, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt># (hash symbol)</dt><dd><dl><dt>comment, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>delimiter between map names, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt></dl></dd><dt>$[] (dollar sign square brackets)</dt><dd><dl><dt>Asterisk expressions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></dt></dl></dd><dt>${DIALSTATUS} variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>${eventextra} CEL variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>${eventtime} CEL variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>${eventtype} CEL variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>${EXTEN} channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a></dt><dt>${IPADDR} option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>${NUMBER} option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>${SECRET} option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>${SECRET} variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt><dt>* (asterisk), Asterisk character separator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></dt><dt>* logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>, (comma), voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>/var mount point, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291135">Base system installation</a></dt><dt>3WAY_END event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>3WAY_START event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>9, accessing external lines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>=&gt; (same) operator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262049">The 'same =&gt;' operator</a></dt><dt>[] (square brackets) contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>_ (underscore), pattern matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></dt><dt>| (pipe character)</dt><dd><dl><dt>delimiter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></dt><dt>voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>A</h3><dl><dt>a(folder) (VoiceMailMain() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt><dt>A(x) (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>A2Billing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042327">A2Billing</a></dt><dt>AA (Automated Attendant), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA">The Automated Attendant</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id36001995">Conclusion</a></dt><dd><dl><dt>building, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287976">Building Your Auto Attendant</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288230">IVR</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288137">The Dialplan</a></dt><dt>incoming calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288192">Delivering Incoming Calls to the Auto Attendant</a></dt><dt>recording prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt></dl></dd><dt>compared to an IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA-SECT-1">An Auto Attendant Is Not an IVR</a></dt><dt>designing for you, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id272753">Designing Your Auto Attendant</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287946">Dial by Extension</a></dt><dd><dl><dt>dial by extension, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287946">Dial by Extension</a></dt><dt>greeting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id289543">The Greeting</a></dt><dt>invalid handler, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287934">Invalid</a></dt><dt>main menu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287786">The Main Menu</a></dt><dt>timeout, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287920">Timeout</a></dt></dl></dd></dl></dd><dt>Aastra, SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>ABANDON event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>accent of prompts, internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>acceptdtmf option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>accountcode CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>accountcode CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>accountlogs option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></dt><dt>accounts</dt><dd><dl><dt>connecting to the AMI over HTTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a></dt><dt>scanning for valid accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security-SECT-1">Scanning for Valid Accounts</a></dt><dt>XMPP accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060344">Creating XMPP accounts</a></dt></dl></dd><dt>ACD queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289208">Conclusion</a></dt><dd><dl><dt>agents.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>announcement control, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>changing penalties dynamically, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>local channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>overflow, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288963">Overflow</a></dt><dt>priority queue, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>queue member priority, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></dt><dt>queue members, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289508">Queue Members</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a></dt><dt>queues.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>simple ACD queue, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a></dt><dt>statistics: queue_log file, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt></dl></dd><dt>ackcall option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>ACLs (access control lists), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001703">Other Risk Mitigation</a></dt><dt>actions, AMI message encoding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></dt><dt>adaptors, VoIP paging adaptors, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257823">VoIP paging adaptors</a></dt><dt>ADDMEMBER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>addon modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>AddQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>Adhearsion, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>adsifdn option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>adsipark (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>adsisec option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>adsiver option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>agent option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>agent option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>AGENTDUMP event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>AGENTLOGIN event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>AGENTLOGOFF event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>agents header section, agents.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>agents, defined, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a></dt><dt>agents.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>AGI (Asterisk Gateway Interface), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI">Asterisk Gateway Interface (AGI)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id263225">Conclusion</a></dt><dd><dl><dt>AGI variants, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-variants">AGI Variants</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a></dt><dd><dl><dt>async AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a></dt><dt>DeadAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id265035">DeadAGI Is Dead</a></dt><dt>FastAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI">FastAGI—AGI over TCP</a></dt><dt>process-based AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262615">Process-Based AGI</a></dt></dl></dd><dt>communication overview, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-communication">AGI Communication Overview</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254220">Async AGI</a></dt><dd><dl><dt>AGI sessions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254321">Setting Up an AGI Session</a></dt><dt>commands and responses, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></dt><dt>ending an AGI session, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242019">Ending an AGI Session</a></dt></dl></dd><dt>development frameworks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>environment variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a></dt><dt>quick start overview, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI-quickstart">Quick Start</a></dt><dt>scripts: triggering with an application map, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt></dl></dd><dt>agi option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>agi set debug off command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></dt><dt>agi set debug on command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></dt><dt>agi show commands topic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>agi show commands topic ANSWER, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>alarm systems, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>aliasing, pulse-code modulation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.5">Aliasing</a></dt><dt>all option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>allow (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>allowguest (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>allowmultiplelogin option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>allowsubscribe option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>alwaysfork (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>amaflags CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>amaflags CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>AMI (Asterisk Manager Interface), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI">Asterisk Manager Interface (AMI)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283482">Conclusion</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246930">AMI</a></dt><dt>AMI-Controlled AGI: async AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a></dt><dt>AsteriskGUI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283341">AsteriskGUI</a></dt><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-configuration">Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dd><dl><dt>http.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt></dl></dd><dt>development frameworks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248859">Development Frameworks</a></dt><dt>FOP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283424">Flash Operator Panel</a></dt><dt>protocol overview, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248378">Protocol Overview</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt><dd><dl><dt>AMI over HTTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-HTTP">AMI over HTTP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt><dt>message encoding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248495">Message Encoding</a></dt></dl></dd><dt>quick start overview, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart">Quick Start</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a></dt><dd><dl><dt>AMI over HTTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a></dt><dt>AMI over TCP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-TCP">AMI over TCP</a></dt></dl></dd></dl></dd><dt>AMI over HTTP</dt><dd><dl><dt>authentication and session handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248633">Authentication and session handling</a></dt><dt>manager encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248704">/manager encoding</a></dt><dt>manager events, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt><dt>mxml encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248743">/mxml encoding</a></dt><dt>rawman encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248689">/rawman encoding</a></dt></dl></dd><dt>analog circuits</dt><dd><dl><dt>caller ID, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt></dl></dd><dt>analog interface cards, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.1">Analog interface cards</a></dt><dt>analog phones</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.1">Analog telephones</a></dt></dl></dd><dt>analog telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1">Analog Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></dt><dd><dl><dt>parts of an analog telephone, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1">Parts of an Analog Telephone</a></dt><dt>PSTN circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></dt><dt>Tip and Ring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></dt></dl></dd><dt>Analog Terminal Adaptors (see ATAs)</dt><dt>analog trunks, SLA key system example with analog
          trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></dt><dt>announce option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>announce-frequency option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>announce-holdtime option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>announce-holdtime option queues.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>announce-position option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>announce-position-limit option
                (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>announce-round-seconds option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>announcement control, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>ANSWER AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>answer CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>ANSWER CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>Answer() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>anti-monopolistic practices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></dt><dt>aoc option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>APIs, securing Asterisk network APIs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001664">Securing Asterisk Network APIs</a></dt><dt>app dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></dt><dt>appdata CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>application map grouping, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></dt><dt>[applicationmap] section,
          features.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt><dt>applications</dt><dd><dl><dt>AddQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>AGI() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262615">Process-Based AGI</a></dt><dt>dahdi_genconf application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></dt><dt>dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></dt><dt>Directory() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></dt><dt>DISA() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></dt><dt>Festival application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></dt><dt>GoSub() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub">GoSub()</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dt>GotoIf() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>GotoIfTime() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>Hangup() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>JabberSend() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></dt><dt>Macro() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></dt><dt>MeetMe() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>MeetMeCount() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></dt><dt>NoOp() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></dt><dt>Page() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></dt><dt>PauseQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></dt><dt>Playback() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></dt><dt>prompt-recording application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247054">A Prompt-Recording Application</a></dt><dt>Queue() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></dt><dt>Read() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>Record() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></dt><dt>RemoveQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>SendFAX() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></dt><dt>Set() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.2">Examples of Dialplan Functions</a></dt><dt>SIPAddHeader() voicemail application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>SLA applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>SLATrunk() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a></dt><dt>text2wave application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></dt><dt>UnpauseQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></dt><dt>VoiceMail() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></dt><dt>Zapateller() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></dt></dl></dd><dt>appname CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>apps option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>APP_END CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>app_mysql addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>app_saycountpl addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>app_set (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></dt><dt>APP_START CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>app_voicemail.so module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>ARA (Asterisk Realtime Architecture), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dd><dl><dt>dynamic realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>static realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt></dl></dd><dt>architecture, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294832">Conclusion</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294754">The Dialplan</a></dt><dt>file structure, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#file_structure">File Structure</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></dt><dd><dl><dt>configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294638">Configuration Files</a></dt><dt>logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294732">Logging</a></dt><dt>modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294666">Modules</a></dt><dt>resource library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></dt><dt>spool, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></dt></dl></dd><dt>hardware requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294803">Hardware</a></dt><dt>modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5-SECT-1">Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt><dd><dl><dt>addon modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>bridging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>CDR modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></dt><dt>channel drivers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>channel event logging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>codec translators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></dt><dt>dialplan functions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a></dt><dt>format interpreters, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>PBX modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>resource modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293876">Resource Modules</a></dt><dt>test modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt></dl></dd><dt>versioning, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning">Asterisk Versioning</a></dt></dl></dd><dt>arguments</dt><dd><dl><dt>using in GoSub() subroutines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060548">Using Arguments in Subroutines</a></dt><dt>using in macros, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt></dl></dd><dt>ARRAY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>astagidir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astctl (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></dt><dt>astctlgroup (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></dt><dt>astctlowner (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></dt><dt>astctlpermissions (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260138">The [files] Section</a></dt><dt>astdatadir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>AstDB (Asterisk Database), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dd><dl><dt>deleting data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></dt><dt>retrieving data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.2">Retrieving Data from the AstDB</a></dt><dt>storing data in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.1">Storing Data in the AstDB</a></dt><dt>using in the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt></dl></dd><dt>astdbdir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>Asterisk</dt><dd><dl><dt>AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA">The Automated Attendant</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id36001995">Conclusion</a></dt><dt>ACD queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289208">Conclusion</a></dt><dt>AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI">Asterisk Gateway Interface (AGI)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id263225">Conclusion</a></dt><dt>AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AMI">Asterisk Manager Interface (AMI)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283482">Conclusion</a></dt><dt>architecture, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294832">Conclusion</a></dt><dt>clustering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering">Clustering</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060610">Conclusion</a></dt><dt>connectivity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn">Outside Connectivity</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291322">Conclusion</a></dt><dt>device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates">Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289498">Conclusion</a></dt><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics">Dialplan Basics</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-4">Conclusion</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper">Deeper into the Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-8">Conclusion</a></dt><dt>DUNDi, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5">Distributed Universal Number Discovery (DUNDi)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36002807">Conclusion</a></dt><dt>external services, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices">External Services</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291644">Conclusion</a></dt><dt>fax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax">Fax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id245657">Conclusion</a></dt><dt>initial configuration tasks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Initial">Initial Configuration Tasks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260414">Conclusion</a></dt><dt>installing Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install">Installing Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295025">Conclusion</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization">Internationalization</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>Internet call routing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR">Internet Call Routing</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248492">Conclusion</a></dt><dt>IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR">Interactive Voice Response</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247197">Conclusion</a></dt><dt>parking and paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin">Parking and Paging</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247965">Conclusion</a></dt><dt>protocols for VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP">Protocols for VoIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-7">Conclusion</a></dt><dt>relational database integration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB">Relational Database Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1610">Conclusion</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning">Preparing a System for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-6">Conclusion</a></dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security">Security</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id260063">Conclusion—A Better Idiot</a></dt><dt>system monitoring and logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring">System Monitoring and Logging</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id252037">Conclusion</a></dt><dt>telephony future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11">Asterisk: A Future for Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></dt><dt>telephony revolution, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution">A Telephony Revolution</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-7">Conclusion</a></dt><dt>understanding telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony">Understanding Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-5">Conclusion</a></dt><dt>user device configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig">User Device Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292192">Conclusion</a></dt><dt>voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail">Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293431">Conclusion</a></dt><dt>web interfaces, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface">Web Interfaces</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id247202">Conclusion</a></dt></dl></dd><dt>asterisk (*), Asterisk character separator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></dt><dt>Asterisk CLI, loading new channel configurations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291920">The Asterisk CLI</a></dt><dt>Asterisk Documentation Project, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></dt><dt>Asterisk Gateway Interface (see AGI)</dt><dt>Asterisk Manager Interface (see AMI)</dt><dt>Asterisk Realtime Architecture (see ARA)</dt><dt>Asterisk server, devices external to the Asterisk
        server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>asterisk shell command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></dt><dt>Asterisk Test Suite, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt><dt>Asterisk wiki, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>Asterisk-Biz mailing list, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>Asterisk-Dev mailing list, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>Asterisk-Java, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>Asterisk-perl, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>Asterisk-Users mailing list, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>asterisk.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file">asterisk.conf</a></dt><dt>AsteriskGUI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283341">AsteriskGUI</a></dt><dt>astetcdir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astkeydir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>AstLinux, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.1">Small systems</a></dt><dt>astlogdir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astmoddir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astrundir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astspooldir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>astvarlibdir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>ast_hotdesk table, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>ast_tls_cert script, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>async AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id273035">Async AGI—AMI-Controlled AGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id268960">Async AGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></dt><dt>ASYNCAGI BREAK AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>ATAs (Analog Terminal Adaptors)</dt><dd><dl><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></dt><dt>IP phone configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt></dl></dd><dt>attach option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>attachfmt option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>attemptcallerid option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>attempts argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>ATTENDEDTRANSFER CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>atxfer (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>atxfercallbackretries (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>atxferdropcall (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>atxferloopdelay (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>atxfernoanswertimeout (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>audio</dt><dd><dl><dt>conference bridge, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></dt><dt>encrypting with Secure RTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a></dt><dt>formats: translation cost, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>stream formats: codec translators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt></dl></dd><dt>authentication</dt><dd><dl><dt>AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248633">Authentication and session handling</a></dt><dt>security weakness, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1">Users and Peers and Friends—Oh My!</a></dt></dl></dd><dt>authpassword option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>authuser option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>auth_policy option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>auto attendants, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>autocontext option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>autofill option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>autokill option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>autokill option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>autoload (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>autologoff option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>autologoffunavail option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>automixmon (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>automon (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>autopause option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>autoprune option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>autoregister option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>autosystemname (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt>b (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>B-channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>B2BUA (Back to Back User Agent), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292132">Under the Hood: Your First Call</a></dt><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263137">Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt><dd><dl><dt>CDRs</dt><dd><dl><dt>cdr_adaptive_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></dt><dt>cdr_csv, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></dt><dt>cdr_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></dt><dt>cdr_manager, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249846">cdr_manager</a></dt><dt>cdr_mysql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249944">cdr_mysql</a></dt><dt>cdr_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249958">cdr_odbc</a></dt><dt>cdr_pgsql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249972">cdr_pgsql</a></dt><dt>cdr_radius, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>cdr_sqlite, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250127">cdr_sqlite</a></dt><dt>cdr_sqlite3_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250164">cdr_sqlite3_custom</a></dt><dt>cdr_syslog, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250217">cdr_syslog</a></dt><dt>cdr_tds, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt></dl></dd><dt>CEL</dt><dd><dl><dt>cel_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>cel_manager, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291820">cel_manager</a></dt><dt>cel_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>cel_pgsql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291890">cel_pgsql</a></dt><dt>cel_radius, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt><dt>cel_sqlite3_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292007">cel_sqlite3_custom</a></dt><dt>cel_tds, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt></dl></dd></dl></dd><dt>Background() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>backupdeleted option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>barge option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>barriers to entry, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.2">Low barrier to entry</a></dt><dt>Basic Rate Interfaces (BRIs), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></dt><dt>batch option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>best effort, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.4">Best Effort</a></dt><dt>billing applications, call detail records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></dt><dt>billsec CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>binary data</dt><dd><dl><dt>verifying binary data stored in MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dt>verifying binary data stored in PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></dt></dl></dd><dt>bindaddr option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>bindaddr option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>bindaddr option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>bindport option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>BLA (Bridged Line Appearances), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></dt><dt>BLACKLIST() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dt>BLF (Busy Lamp Field), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></dt><dt>blind transfer, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt><dt>BLINDTRANSFER CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>blindxfer (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>Bogen UTI1, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></dt><dt>Boolean operators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>bottleneck engineering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.4">Bottleneck engineering</a></dt><dt>branching</dt><dd><dl><dt>conditional branching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3">Conditional Branching</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dd><dl><dt>GotoIf() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>time-based conditional branching with
          GotoIfTime(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt></dl></dd></dl></dd><dt>BRI ISDN</dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291072">BRI ISDN</a></dt></dl></dd><dt>bridge_builtin_features bridging module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>BRIDGE_END CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>bridge_multiplexed bridging module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>bridge_simple bridging module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>bridge_softmix bridging module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>BRIDGE_START CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>BRIDGE_UPDATE CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>bridging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>BRIs (Basic Rate Interfaces), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></dt><dt>brokeneventsaction option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>buddy option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>Busy Lamp Field (BLF), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></dt><dt>busylevel option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>CA (certificate authority), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>cachetime option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>cache_record_files (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>calendar show calendar &lt;myGoogleCal&gt;
          function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></dt><dt>calendar.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt><dt>Calendar:&lt;calendar name&gt; virtual
                device, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>calendars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices-SECT-1">Calendar Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dd><dl><dt>compiling support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id266014">Compiling Calendaring Support into Asterisk</a></dt><dt>configuring support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></dt><dt>controlling calls based on calendar
          information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a></dt><dt>triggering calendar reminders, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></dt><dt>writing call information to a calendar, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt></dl></dd><dt>CALENDAR_BUSY() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>CALENDAR_EVENT() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a></dt><dt>CALENDAR_QUERY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>CALENDAR_QUERY_RESULT() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>call centers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering-SECT-1">Traditional Call Centers</a></dt><dt>call centers, inbound and outbound, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a></dt><dt>call detail records (see CDRs)</dt><dt>call information, writing to a calendar, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt><dt>call monitoring for law enforcement
                  agencies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></dt><dt>call option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>call parking, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a></dt><dt>call progress tones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>call token support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt><dt>call-limit option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>callback option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>callcounter option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>caller ID</dt><dd><dl><dt>analog circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305757">Caller ID</a></dt><dt>SLA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></dt></dl></dd><dt>CALLERID() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>calling</dt><dd><dl><dt>GoSub() subroutines from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060490">Calling Subroutines from the Dialplan</a></dt><dt>macros from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></dt></dl></dd><dt>calls</dt><dd><dl><dt>accepting calls to your system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></dt><dt>receiving on your ITAD, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579341">Receiving calls to your ITAD</a></dt></dl></dd><dt>CAS (Channel Associated Signaling), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.1">Channel Associated Signaling (CAS)</a></dt><dt>cc option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>CCITT (Comité consultatif international téléphonique et
          télégraphique), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>CDR modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></dt><dt>cdr option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>CDR() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt><dt>CDR-Stats, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36036769">Call Detail Records</a></dt><dt>cdr.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>CDRs (call detail records), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin-SECT-1">Call Detail Records</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></dt><dd><dl><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263137">Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt><dd><dl><dt>cdr_adaptive_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></dt><dt>cdr_csv, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></dt><dt>cdr_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></dt><dt>cdr_manager, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249846">cdr_manager</a></dt><dt>cdr_mysql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249944">cdr_mysql</a></dt><dt>cdr_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249958">cdr_odbc</a></dt><dt>cdr_pgsql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249972">cdr_pgsql</a></dt><dt>cdr_radius, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>cdr_sqlite, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250127">cdr_sqlite</a></dt><dt>cdr_sqlite3_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250164">cdr_sqlite3_custom</a></dt><dt>cdr_syslog, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250217">cdr_syslog</a></dt><dt>cdr_tds, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt></dl></dd><dt>caveats, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></dt><dt>cdr.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>contents, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a></dt><dt>example call detail records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_examples">Example Call Detail Records</a></dt><dt>relational databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt><dt>web interfaces, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36036769">Call Detail Records</a></dt></dl></dd><dt>cdr_adaptive_odbc module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></dt><dt>cdr_adaptive_odbc.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></dt><dt>cdr_csv module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a></dt><dt>cdr_custom module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></dt><dt>cdr_manager module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249846">cdr_manager</a></dt><dt>cdr_mysql addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>cdr_mysql module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249944">cdr_mysql</a></dt><dt>cdr_odbc module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249958">cdr_odbc</a></dt><dt>cdr_pgsql module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249972">cdr_pgsql</a></dt><dt>cdr_radius module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>cdr_sqlite module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250127">cdr_sqlite</a></dt><dt>cdr_sqlite3_custom module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250164">cdr_sqlite3_custom</a></dt><dt>cdr_syslog module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250217">cdr_syslog</a></dt><dt>cdr_tds module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt><dt>CEL (Channel event logging), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246945">CEL (Channel Event Logging)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt><dd><dl><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255966">Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt><dd><dl><dt>cel_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>cel_manager, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291820">cel_manager</a></dt><dt>cel_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>cel_pgsql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291890">cel_pgsql</a></dt><dt>cel_radius, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt><dt>cel_sqlite3_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292007">cel_sqlite3_custom</a></dt><dt>cel_tds, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt></dl></dd><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>channel event contents, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>channel event types, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></dt><dt>example channel events, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292095">Example Channel Events</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt><dd><dl><dt>blind transfer, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt><dt>single-party call, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292126">Single-party call</a></dt><dt>two-party call, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292161">Two-party call</a></dt></dl></dd></dl></dd><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>cel_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring-cel_custom">cel_custom</a></dt><dt>cel_custom module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_manager, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291820">cel_manager</a></dt><dt>cel_manager module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>cel_odbc module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_pgsql, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291890">cel_pgsql</a></dt><dt>cel_pgsql module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_radius, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt><dt>cel_radius module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_sqlite3_custom, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292007">cel_sqlite3_custom</a></dt><dt>cel_sqlite3_custom module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>cel_tds, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt><dt>cel_tds module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>CentOS Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291082">CentOS Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dd><dl><dt>adding a system user, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dt>base system installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291135">Base system installation</a></dt><dt>base system update, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291582">Base system update</a></dt><dt>calendars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id259378">CentOS dependencies</a></dt><dt>compiling LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040950">CentOS dependencies</a></dt><dt>compiling support for XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286815">CentOS dependencies</a></dt><dt>compiling voicemail support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247003">CentOS dependencies</a></dt><dt>converting music format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></dt><dt>cURL module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></dt><dt>enabling NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></dt><dt>installing Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a></dt><dt>installing Festival, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055967">Installing Festival on CentOS</a></dt><dt>installing MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id262627">Installing MySQL for CentOS</a></dt><dt>installing PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database">Installing PostgreSQL for CentOS</a></dt><dt>installing SNMP module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241674">CentOS dependency</a></dt></dl></dd><dt>central option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt><dt>central24 option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt><dt>Cepstral, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></dt><dt>certificate authority (CA), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>certificates, obtaining, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>CHANGES, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt><dt>channame CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>Channel Associated Signaling (CAS), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.1">Channel Associated Signaling (CAS)</a></dt><dt>channel banks, hardware requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.3">Channel banks</a></dt><dt>channel CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>channel configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id216341">Configuring Asterisk</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a></dt><dt>loading new configurations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291909">Loading Your New Channel Configurations</a></dt><dt>modifying for your environment, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></dt></dl></dd><dt>channel drivers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>Channel event logging (see CEL)</dt><dt>channel event logging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>CHANNEL STATUS AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>channel variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.2">Channel variables</a></dt><dt>channel variables, ${EXTEN} channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></dt><dt>CHANNEL() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>CHANNEL() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id291715">indications.conf</a></dt><dt>channels</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a></dt><dt>contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>local channels with dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></dt></dl></dd><dt>channelvars option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>chan_agent driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_alsa driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_bridge driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_console driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_dahdi driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>CHAN_END CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>chan_gtalk driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dd><dl><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></dt><dt>Google Talk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#accepting_calls_from_google_talk">Accepting calls from Google Talk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285398">Outgoing calls via Google Talk</a></dt><dt>Google Voice, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285352">Accepting calls from Google Voice</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt></dl></dd><dt>chan_h323 driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_iax2 driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_jingle channel module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a></dt><dt>chan_jingle driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_local driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_mgcp driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_misdn driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_mobile addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>chan_multicast_rtp channel, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>chan_multicast_rtp driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_nbs driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_ooh323 addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>chan_oss driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_phone driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_sip driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_skinny driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_skype.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></dt><dt>CHAN_START CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>chan_unistim driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_usbradio driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>chan_vpb driver, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>charset option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>CheckPublicExtensionResult channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>children and security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>ciddnid CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>cidinternalcontexts option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>cidname, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>cidnum CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>cidrdnis CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>circuit types, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1">Circuit Types</a></dt><dt>Cisco SPA</dt><dd><dl><dt>phones: multicast paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt></dl></dd><dt>Class (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>CLI (command-line interface), controlling queue
          members, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>clid CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>closetimeout option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>clustering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering">Clustering</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060610">Conclusion</a></dt><dd><dl><dt>call centers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering-SECT-1">Traditional Call Centers</a></dt><dt>databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282554">Asterisk and Database Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></dt><dd><dl><dt>replicated databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></dt><dt>single database, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061021">Single Database</a></dt></dl></dd><dt>distributed device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060921">Asterisk and Distributed Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dd><dl><dt>over a LAN, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></dt><dt>over a WAN, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt></dl></dd><dt>hybrid systems, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282177">Hybrid Systems</a></dt><dt>multiple queues, multiple sites, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></dt><dt>pure Asterisk, nondistributed, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id258940">Pure Asterisk, Nondistributed</a></dt></dl></dd><dt>codecs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.8">MP3</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>configuration for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>G.711, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>G.722, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id318733">G.722</a></dt><dt>G.722 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>G.726, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.2">G.726</a></dt><dt>G.726 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>G.729A, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.4">G.729A</a></dt><dt>G.729A codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>GSM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.5">GSM</a></dt><dt>GSM codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>iLBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.6">iLBC</a></dt><dt>MP3, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.8">MP3</a></dt><dt>Speex, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.7">Speex</a></dt><dt>translators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt></dl></dd><dt>codec_adpcm translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_alaw translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_a_mu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_dahdi translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_g722 translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_g726 translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_gsm translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_ilbc translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_lpc10 translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_resample translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_speex translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>codec_ulaw translator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>combination paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></dt><dt>comebacktoorigin (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>Comedian Mail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id263499">Comedian Mail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></dt><dd><dl><dt>contexts section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>[general] section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>sample voicemail.conf file, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></dt><dt>[zonemessages]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt></dl></dd><dt>Comité consultatif international téléphonique et
          télégraphique (CCITT), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>comma (,), voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>command option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>command, moh show classes command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt><dt>command-line interface (CLI), controlling queue
          members, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>commands</dt><dd><dl><dt>AGI commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>agi set debug off command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></dt><dt>agi set debug on command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></dt><dt>agi show commands topic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>agi show commands topic ANSWER, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>asterisk shell commend, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></dt><dt>core set debug 0 command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>core set verbose 0 command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>core show application festival command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></dt><dt>core show hints command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>dahdi_cfg command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dahdi_genconf command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dahdi_genconf modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>dahdi_genconf modules application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></dt><dt>dahdi_genconf modules command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291072">BRI ISDN</a></dt><dt>dahdi_hardware command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>dahdi_tool command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dialplan reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt><dt>dialplan set global CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>dundi lookup command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>dundi show peer command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>features show CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt><dt>gi show commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>jabber purge nodes command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>jabber show buddies command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>jabber show connected command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>ldapadd command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>lsdahdi application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></dt><dt>lsdahdi command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>make menuselect command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id424034">Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></dt><dt>manager show command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></dt><dt>manager show command AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></dt><dt>manager show commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></dt><dt>md5sum command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>menuselect command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></dt><dt>module reload app_queue.so command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>ntpd command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></dt><dt>odbc show CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>Page() command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>queue add command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue add member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue pause member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue remove member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue unpause member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt><dt>sip reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dt>sip show peers command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059941">Connecting two Asterisk systems together with SIP</a></dt><dt>sip show settings CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289964">Modifying sip.conf</a></dt></dl></dd><dt>commercial option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>communications terminals, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.4">Communications Terminals</a></dt><dt>community, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5">The Asterisk Community</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></dt><dd><dl><dt>Asterisk Documentation Project, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></dt><dt>IRC channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.3">The IRC Channels</a></dt><dt>mailing lists, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>user groups, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.4">Asterisk User Groups</a></dt><dt>wiki sites, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.2">Asterisk Wiki Sites</a></dt></dl></dd><dt>companding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.4">Logarithmic companding</a></dt><dt>[compat] section
          (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></dt><dt>compiling</dt><dd><dl><dt>calendar support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id266014">Compiling Calendaring Support into Asterisk</a></dt><dt>res_calendar_ews module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id259378">CentOS dependencies</a></dt><dt>res_snmp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#recompile-ast-with-snmp">Recompiling Asterisk with the res_snmp module</a></dt><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id323352">Compiling and Installing spandsp</a></dt><dt>spandsp support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id345391">Recompiling Asterisk with spandsp Support</a></dt><dt>voicemail support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246986">Compiling IMAP VoiceMail Support into Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt></dl></dd><dt>COMPLETEAGENT event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>COMPLETECALLER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>Computer-Supported Telecommunications Applications
          (CSTA), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283296">CSTA</a></dt><dt>concatenating text, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>concurrent connections, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>conditional branching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3">Conditional Branching</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dd><dl><dt>GotoIf() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>time-based conditional branching with
          GotoIfTime(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt></dl></dd><dt>conference rooms, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.3">Conference rooms</a></dt><dt>conferencing</dt><dd><dl><dt>activity level, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>calling meeting participants and placing them into a
            conference, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></dt><dt>MeetMe() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></dt></dl></dd><dt>config option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>CONFIGRELOAD event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_base_configuration">Base Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Initial">Initial Configuration Tasks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260414">Conclusion</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig">User Device Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292192">Conclusion</a></dt><dd><dl><dt>agents.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-configuration">Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dd><dl><dt>http.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt></dl></dd><dt>analog circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>analog phones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></dt><dt>Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id216341">Configuring Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></dt><dd><dl><dt>channel configuration files and dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a></dt><dt>iax.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>modifying channel configuration files for your
          environment, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></dt><dt>sip.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt></dl></dd><dt>asterisk.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file">asterisk.conf</a></dt><dt>calendar support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></dt><dt>calendar.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt><dt>cdr_adaptive_odbc.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263146">cdr_adaptive_odbc</a></dt><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></dt><dt>chan_skype.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></dt><dt>configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294638">Configuration Files</a></dt><dt>dialplan for testing your devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></dt><dt>digital circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></dt><dt>disabling SELinux, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293578">Disable SELinux</a></dt><dt>DUNDi and Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id417246">Configuring Asterisk for Use with DUNDi</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dd><dl><dt>controlling responses, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses">Controlling Responses</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>general, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id378872">General Configuration</a></dt><dt>initial DUNDi peer definition, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id399131">Initial DUNDi Peer Definition</a></dt><dt>lookups from Dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>mapping contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>remote connections, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt></dl></dd><dt>dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>extconfig.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040635">Configuring extconfig.conf</a></dt><dt>extensions.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></dt><dt>Fail2ban, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>features.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt><dt>FX and FXO ports, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></dt><dt>hardphones, softphones, and ATAs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></dt><dt>http.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>IAX trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291291">Configuring IAX trunks between Asterisk systems</a></dt><dt>iax.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt><dt>indications.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id291715">indications.conf</a></dt><dt>initial configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293688">Initial Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a></dt><dt>IP phones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>jail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189907">Configuring Asterisk for LDAP Support</a></dt><dt>loading new channel configurations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291909">Loading Your New Channel Configurations</a></dt><dt>make menuselect, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994">make menuselect</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293020">Uses for menuselect</a></dt><dt>interfaces, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></dt><dt>scripting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>using, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293213">Using menuselect</a></dt></dl></dd><dt>manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>modules.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294211">modules.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></dt><dt>musiconhold.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></dt><dt>MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></dt><dt>ODBC for Microsoft SQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></dt><dt>ODBC for MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246760">Configuring ODBC for MySQL</a></dt><dt>ODBC for PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#test">Configuring ODBC for PostgreSQL</a></dt><dt>OpenAIS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025485">OpenAIS configuration</a></dt><dt>OpenLDAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>OpenNMS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql">Configuring PostgreSQL</a></dt><dt>PRI circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>queuerules.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>res_ldap.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040839">Configuring res_ldap.conf</a></dt><dt>res_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>res_odbc.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>res_snmp.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241885">Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS
        server</a></dt><dt>sample configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a></dt><dt>SIP presence, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>SIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291281">Configuring SIP trunks between Asterisk systems</a></dt><dt>sip.conf for realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dt>SLA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289480">Configuration Overview</a></dt><dt>SLA key system example with analog trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></dt><dt>sla.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061103">sla.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061311">sla.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></dt><dt>system.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>telephone naming concepts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>testing device registration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></dt><dt>users.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>voicemail support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286256">Configuring Asterisk</a></dt><dt>voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>VoIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291268">Configuring VoIP Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060384">Asterisk configuration</a></dt><dt>your first call, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292132">Under the Hood: Your First Call</a></dt></dl></dd><dt>configuration matching, SIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>configure script, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>CONF_END event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>CONF_ENTER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>CONF_EXIT event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>CONF_START event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>CONNECT event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>connection option (cel_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>connectivity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn">Outside Connectivity</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291322">Conclusion</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>emergency dialing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></dt><dt>PSTN circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271202">PSTN Circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>trunking, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn-SECT-1">The Basics of Trunking</a></dt><dt>VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291235">VoIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dd><dl><dt>configuring VoIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291268">Configuring VoIP Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dt>PSTN origination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>PSTN termination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></dt><dt>VoIP to VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291257">VoIP to VoIP</a></dt></dl></dd></dl></dd><dt>console (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>Console/DSP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></dt><dt>context</dt><dd><dl><dt>access to external lines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>default, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt></dl></dd><dt>context (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>context (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>context CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>context option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>contexts</dt><dd><dl><dt>dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>LocalSets context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>mapping contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>naming, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>number-mapping context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></dt><dt>subFreenum context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt></dl></dd><dt>contexts section, Comedian Mail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>CONTROL STREAM FILE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>converting music formats, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></dt><dt>core set debug 0 command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>core set verbose 0 command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>core show application festival command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></dt><dt>core show hints command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>country option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>courtesytone (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>CPU, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>CSTA (Computer-Supported Telecommunications
          Applications), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283296">CSTA</a></dt><dt>CSV_QUOTE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></dt><dt>cURL module, installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></dt><dt>CURL() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246881">CURL</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247025">The Dialplan</a></dt><dt>Custom:&lt;custom name&gt; virtual device, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>custom_beep option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>d (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>d([c]) (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>D-channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>DAHDI (Digium Asterisk Hardware Device Interface)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294803">Hardware</a></dt><dt>downloading and installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870">DAHDI</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt></dl></dd><dt>DAHDI-linux, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870">DAHDI</a></dt><dt>DAHDI-tools, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423870">DAHDI</a></dt><dt>dahdi_cfg command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dahdi_dummy, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>dahdi_genconf application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>dahdi_genconf command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dahdi_genconf modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>dahdi_genconf modules command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291072">BRI ISDN</a></dt><dt>dahdi_hardware command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>dahdi_tool command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>dastAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242030">Process-based AGI/FastAGI</a></dt><dt>DATABASE DEL AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>DATABASE DELTREE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>DATABASE GET AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>database lookup, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></dt><dt>DATABASE PUT AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>databases</dt><dd><dl><dt>replicated databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></dt><dt>single database, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36061021">Single Database</a></dt></dl></dd><dt>dateformat option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>days_of_month (GotoIfTime() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>days_of_week (GotoIfTime() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>dbsecret, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt><dt>DB_EXISTS() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>dcontext CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>DeadAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id265035">DeadAGI Is Dead</a></dt><dt>debug (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>debug logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>debug option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>debug option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>defaultrule option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>defaults</dt><dd><dl><dt>asterisk.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-asterisk-conf-file">asterisk.conf</a></dt><dt>blindxfer and disconnect codes
              (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>CDR fields, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>DAHDI modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization">Internationalization</a></dt><dt>sound prompt files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293020">Uses for menuselect</a></dt><dt>starting Asterisk with no modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5-SECT-1">Modules</a></dt><dt>timeouts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>traditional PBXs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>voicemail context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt></dl></dd><dt>delayed dialing using Local channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></dt><dt>delete option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>deleting data from AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></dt><dt>demilitarized zone (DMZ), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252412">DMZ</a></dt><dt>denial of service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt><dt>deny option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>departme option (dundi.conf)nt, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>dependencies</dt><dd><dl><dt>dependency information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></dt><dt>module dependencies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293213">Using menuselect</a></dt><dt>software dependencies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt></dl></dd><dt>destemail option (jail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>destination argument, Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292362">Argument 1: Destination</a></dt><dt>device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates">Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289498">Conclusion</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>custom device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#usingCustomDeviceStates">Using Custom Device States</a></dt><dt>device state information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>distributed device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265044">Distributed Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dd><dl><dt>OpenAIS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052">Using OpenAIS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt></dl></dd><dt>extension states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265377">Extension States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></dt><dt>replicated database, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060921">Asterisk and Distributed Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dt>SLA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#SLA">Shared Line Appearances</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></dt><dd><dl><dt>additional configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289480">Configuration Overview</a></dt><dt>installing SLA applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>key system example with analog trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></dt><dt>key system example with SIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></dt><dt>limitations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></dt><dt>presence, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></dt><dt>shared extension example, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></dt></dl></dd></dl></dd><dt>devices</dt><dd><dl><dt>dialplan for testing your devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></dt><dt>external to the Asterisk server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>state information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>testing device registration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></dt></dl></dd><dt>DEVICE_STATE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id262632">Checking Device States</a></dt><dt>dial by extension, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287946">Dial by Extension</a></dt><dt>Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.3">Using the Dial() Application</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292773">Blank arguments</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>dial-by-name directories, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></dt><dt>dialing SIP URIs from Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></dt><dt>dialout option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>dialpad, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.2">Dialpad</a></dt><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics">Dialplan Basics</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-4">Conclusion</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Deeper">Deeper into the Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-8">Conclusion</a></dt><dd><dl><dt>AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288137">The Dialplan</a></dt><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294754">The Dialplan</a></dt><dt>accepting calls to your system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></dt><dt>AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dd><dl><dt>deleting data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></dt><dt>retrieving data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.2">Retrieving Data from the AstDB</a></dt><dt>storing data in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.1">Storing Data in the AstDB</a></dt><dt>using in the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt></dl></dd><dt>Asterisk as a standalone voicemail server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>call parking, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a></dt><dt>channel configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a></dt><dt>channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a></dt><dt>conditional branching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3">Conditional Branching</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dd><dl><dt>GotoIf() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>time-based conditional branching with
          GotoIfTime(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt></dl></dd><dt>conferencing with MeetMe() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></dt><dt>contexts and security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></dt><dt>controlling queue members, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></dt><dt>CURL() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247025">The Dialplan</a></dt><dt>expressions and variable manipulation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1">Expressions and Variable Manipulation</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dd><dl><dt>basic expressions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></dt><dt>operators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt></dl></dd><dt>functions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2">Dialplan Functions</a></dt><dt>functions in mappings, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>GoSub() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub">GoSub()</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dd><dl><dt>calling subroutines from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060490">Calling Subroutines from the Dialplan</a></dt><dt>defining subroutines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060368">Defining Subroutines</a></dt><dt>returning from a subroutine, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dt>using arguments in subroutines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060548">Using Arguments in Subroutines</a></dt></dl></dd><dt>Hello World example, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2">A Simple Dialplan</a></dt><dt>interactive dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3">Building an Interactive Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8">Includes</a></dt><dd><dl><dt>Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.3">Using the Dial() Application</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292773">Blank arguments</a></dt><dt>Goto(), Background(), and WaitExten()
          applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>includes, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8">Includes</a></dt><dt>invalid entries and timeouts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2">Handling Invalid Entries and Timeouts</a></dt><dt>pattern matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6">Pattern Matching</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></dt><dt>variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.4">Adding variables to our dialplan</a></dt></dl></dd><dt>Jabber dialplan commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dd><dl><dt>connecting to an XMPP server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>receiving messages with JABBER_RECEIVE(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt></dl></dd><dt>Local channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></dt><dt>lookups, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>macros, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5">Macros</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt><dd><dl><dt>calling macros from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></dt><dt>defining, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.1">Defining Macros</a></dt><dt>using arguments in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt></dl></dd><dt>outside connectivity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>security vulnerabilities, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></dt><dt>sending messages with JabberSend(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></dt><dt>Skype, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057688">Using Skype for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dd><dl><dt>calling without assigning extension numbers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>configuring chan_skype.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></dt><dt>placing and receiving calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#placing_and_receiving_calls_via_skype">Placing and receiving calls via Skype</a></dt><dt>sending and receiving messages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt></dl></dd><dt>syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dd><dl><dt>Answer(), Playback(), and Hangup() applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></dt><dt>contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>extensions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2">Extensions</a></dt><dt>priorities, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.3">Priorities</a></dt></dl></dd><dt>for testing your
        devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></dt><dt>voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292544">Dialplan Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></dt><dd><dl><dt>dial-by-name directories, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></dt><dt>jitterbuffers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></dt><dt>VoiceMail() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>VoiceMailMain() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt></dl></dd><dt>Zapateller() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></dt></dl></dd><dt>dialplan applications</dt><dd><dl><dt>CDRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a></dt><dt>CEL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></dt></dl></dd><dt>dialplan option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>dialplan reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt><dt>dialplan scripting logic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>dialplan set global CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>DIALPLAN_EXISTS() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>DIALSTATUS variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292362">Argument 1: Destination</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt><dt>DIDs (direct inward dialing numbers), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>differentiated service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.2">Differentiated Service</a></dt><dt>digit 9, accessing external lines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>digital circuit-switched telephone network, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3">The Digital Circuit-Switched Telephone Network</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></dt><dt>digital circuits, configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a></dt><dt>digital interface cards, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1.2">Digital interface cards</a></dt><dt>digital signaling protocols, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2">Digital Signaling Protocols</a></dt><dt>digital telephones, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.2">Proprietary digital telephones</a></dt><dt>digital telephony</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2">Digital Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.5">Aliasing</a></dt><dt>PSTN circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240837">Digital telephony</a></dt></dl></dd><dt>digitally encoding an analog waveform, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.1">Digitally encoding an analog waveform</a></dt><dt>Digium</dt><dd><dl><dt>cards, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240851">Installing PSTN Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>FAA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id260129">Digium Fax For Asterisk</a></dt><dt>packages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></dt></dl></dd><dt>Digium Asterisk Hardware Device Interface (see DAHDI)</dt><dt>direct inward dialing numbers (DIDs), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>[directories]
          section (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259095">The [directories] Section</a></dt><dt>Directory() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></dt><dt>directoryintro option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>DISA() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></dt><dt>disabling</dt><dd><dl><dt>Digium FAA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id319736">Disabling Digium FFA (Should You Want to Test spandsp)</a></dt><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337600">Disabling spandsp (Should You Want to Test Digium Fax)</a></dt></dl></dd><dt>disallow (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>disconnect (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>displayconnects option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>disposition CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>distributed denial of service attacks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></dt><dt>distributed device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265044">Distributed Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060921">Asterisk and Distributed Device States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dd><dl><dt>OpenAIS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052">Using OpenAIS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dd><dl><dt>Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025387">Asterisk configuration</a></dt><dt>installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025793">Installation</a></dt><dt>OpenAIS configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025485">OpenAIS configuration</a></dt><dt>testing device state changes, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt></dl></dd><dt>over a LAN, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></dt><dt>over a WAN, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dd><dl><dt>Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060384">Asterisk configuration</a></dt><dt>installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>XMPP accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060344">Creating XMPP accounts</a></dt></dl></dd></dl></dd><dt>distributed IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>Distributed Universal Number Discovery (see DUNDi)</dt><dt>distribution installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291070">Distribution Installation</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dd><dl><dt>CentOS Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291082">CentOS Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dd><dl><dt>adding a system user, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dt>base system installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291135">Base system installation</a></dt><dt>base system update, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291582">Base system update</a></dt><dt>enabling NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></dt></dl></dd><dt>Ubuntu Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291827">Ubuntu Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dd><dl><dt>base system installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291868">Base system installation</a></dt><dt>base system update, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292090">Base system update</a></dt><dt>enabling NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt></dl></dd></dl></dd><dt>DMZ (demilitarized zone), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252412">DMZ</a></dt><dt>DNIS number, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>DNS and SIP URIs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR-SECT-1">DNS and SIP URIs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></dt><dd><dl><dt>accepting calls to your system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></dt><dt>dialing SIP URIs from Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></dt><dt>SIP URI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id268880">The SIP URI</a></dt><dt>SRV records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt></dl></dd><dt>documentation_language (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>dollar sign square brackets ($[]), Asterisk
          expressions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></dt><dt>dontwarn (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>downloading</dt><dd><dl><dt>DAHDI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>software, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></dt></dl></dd><dt>drivers</dt><dd><dl><dt>channel drivers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>DAHDI drivers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt></dl></dd><dt>DS-0, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.1">The humble DS-0―The foundation of it all</a></dt><dt>dst CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>dstchannel CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>DTMF digits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.2">Dialpad</a></dt><dt>dtmf logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>dtmf option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>DTMF-based features, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a></dt><dt>dtmfmode (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>dumpcore (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>DUNDi (Distributed Universal Number Discovery), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5">Distributed Universal Number Discovery (DUNDi)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36002807">Conclusion</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-14-SECT-6">How Does DUNDi Work?</a></dt><dt>Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id417246">Configuring Asterisk for Use with DUNDi</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dd><dl><dt>controlling responses, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#controlling-responses">Controlling Responses</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>general, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id378872">General Configuration</a></dt><dt>initial DUNDi peer definition, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id399131">Initial DUNDi Peer Definition</a></dt><dt>lookups from dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>mapping contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>remote connections, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt></dl></dd><dt>dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>echo on DAHDi channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.2">Managing Echo on DAHDI Channels</a></dt></dl></dd><dt>dundi lookup command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>dundi show peer command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>DUNDILOOKUP() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>DUNDIQUERY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>DUNDIRESULT() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>duration CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>dust requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.3">Dust</a></dt><dt>dynamic realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      Voicemail Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>dynamically adding extension numbers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></dt><dt>DYNAMIC_FEATURES variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt>E.164, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.1">E.164</a></dt><dt>e164.org, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.3">e164.org</a></dt><dt>EAGI (Enhanced AGI), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262406">EAGI</a></dt><dt>eastern option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt><dt>echo, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5">Echo</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></dt><dd><dl><dt>DAHDi channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.2">Managing Echo on DAHDI Channels</a></dt><dt>echo cancellation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.3">Echo Cancellation</a></dt><dt>hardware echo cancellation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></dt><dt>why echo occurs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-5.1">Why Echo Occurs</a></dt></dl></dd><dt>electric circuits requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.3">Electrical Circuits</a></dt><dt>email</dt><dd><dl><dt>email to fax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dt>fax to email, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></dt><dt>sending, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001330">Sending email</a></dt></dl></dd><dt>email option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>emailbody option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>emaildateformat option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>emailsubject option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>emergency dialing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></dt><dt>enable option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>enable option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>enabled option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>enabled option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>enabling</dt><dd><dl><dt>NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dt>SNMPv3, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt></dl></dd><dt>encryption</dt><dd><dl><dt>audio with Secure RTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a></dt><dt>IAX protocol, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dt>media, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001503">Encrypted Media</a></dt><dt>SIP calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252454">Encryption</a></dt></dl></dd><dt>end CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>endbeforehexten option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>endcall option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>enddtmf option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>Enhanced AGI (EAGI), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262406">EAGI</a></dt><dt>ENTERQUEUE event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>entityid option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6.2">ENUM</a></dt><dt>ENUM and E.164, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288915">ENUM and E.164</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></dt><dd><dl><dt>Asterisk and ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></dt><dt>E.164 and the ITU, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289026">ENUM</a></dt></dl></dd><dt>ENUMLOOKUP() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt><dt>envelope option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>environment</dt><dd><dl><dt>modifying channel configuration files for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2">Environment</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></dt></dl></dd><dt>environment variables</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.3">Environment variables</a></dt><dt>AGI environment variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a></dt></dl></dd><dt>equipment room requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4">The Equipment Room</a></dt><dt>error logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>european option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt><dt>event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>eventfilter option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>eventmemberstatus option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>events</dt><dd><dl><dt>AMI message encoding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248511">Events</a></dt><dt>channel events, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>manager events: AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt></dl></dd><dt>events option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>eventtime CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>eventtype CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>eventwhencalled option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>exclamation mark (!), in section name, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>EXEC AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>execincludes (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>exitcontext option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>EXITEMPTY event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>EXITWITHKEY event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>EXITWITHTIMEOUT event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>expressions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1">Expressions and Variable Manipulation</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dd><dl><dt>basic expressions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.1">Basic Expressions</a></dt><dt>operators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt></dl></dd><dt>expungeonhangup option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>extconfig.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040635">Configuring extconfig.conf</a></dt><dt>exten CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>Extensible Messaging and Presence Protocol (see XMPP)</dt><dt>extension numbers, DUNDi and Asterisk
            configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></dt><dt>extension states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265377">Extension States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></dt><dt>extensions</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>adding special extensions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2">Handling Invalid Entries and Timeouts</a></dt><dt>dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2">Extensions</a></dt><dt>traditional phone systems, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt></dl></dd><dt>extensions.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061345">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></dt><dt>EXTENSION_STATE() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></dt><dt>external dialing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>external lines</dt><dd><dl><dt>access to, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>accessing with digit 9, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt></dl></dd><dt>external paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></dt><dt>external scripts, databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>[external] section,
        dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>external services, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices">External Services</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291644">Conclusion</a></dt><dd><dl><dt>calendars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices-SECT-1">Calendar Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dd><dl><dt>compiling support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id266014">Compiling Calendaring Support into Asterisk</a></dt><dt>configuring support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></dt><dt>controlling calls based on calendar information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a></dt><dt>triggering calendar reminders, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></dt><dt>writing call information to a calendar, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt></dl></dd><dt>LDAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291590">LDAP Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dd><dl><dt>compiling LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189890">Compiling LDAP Support into Asterisk</a></dt><dt>configuring Asterisk for LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189907">Configuring Asterisk for LDAP Support</a></dt><dt>OpenLDAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt></dl></dd><dt>Skype, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291565">Skype Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057688">Using Skype for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057654">Installation of Skype for Asterisk</a></dt></dl></dd><dt>text-to-speech utilities, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291618">Text-to-Speech Utilities</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></dt><dd><dl><dt>Cepstral, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></dt><dt>Festival, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></dt></dl></dd><dt>voicemail IMAP integration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration">VoiceMail IMAP Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286789">Using XMPP (Jabber) with Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dd><dl><dt>chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dt>compiling support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286804">Compiling Jabber Support into Asterisk</a></dt><dt>Jabber dialplan commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt></dl></dd></dl></dd><dt>external validation of voicemail passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>externnotify option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      Voicemail Server</a></dt><dt>externpass option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>externpasscheck option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>externpassnotify option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>Extra Sound Package, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>Fail2ban, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001183">Fail2ban</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001218">Installation</a></dt></dl></dd><dt>fail2ban daemon, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>failover, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></dt><dt>false conditional path, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>families, AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a></dt><dt>FASST (Freenum Automated Self-Service Tool), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></dt><dt>FastAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI">FastAGI—AGI over TCP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a></dt><dt>fax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax">Fax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id245657">Conclusion</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Fax-SECT-1">What Is a Fax?</a></dt><dt>in Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id290275">Ways to Handle Faxes in Asterisk</a></dt><dt>Digium FAA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id260129">Digium Fax For Asterisk</a></dt><dt>fax pass-through, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36043799">Fax Pass-Through</a></dt><dt>fax to PDF, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></dt><dt>incoming fax handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id263810">Incoming Fax Handling</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dd><dl><dt>fax detection, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dt>fax to email, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></dt><dt>fax to TIFF, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259374">Fax to TIFF</a></dt></dl></dd><dt>outgoing fax handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id265396">Outgoing Fax Handling</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dd><dl><dt>email to fax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dt>file format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></dt><dt>transmitting a fax from Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></dt></dl></dd><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id253868">spandsp</a></dt></dl></dd><dt>fax logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>fax.py, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dt>faxdetect option (chan_dahdi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dt>faxdetect option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dt>featuredigittimeout (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>[featuremap] section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>features show CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt><dt>features.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt><dd><dl><dt>application map grouping, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></dt><dt>[applicationmap]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt><dt>[featuremap]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>[general] section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parking lots, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt></dl></dd><dt>Festival application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></dt><dt>Festival server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.1">Festival</a></dt><dt>files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#file_structure">File Structure</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></dt><dd><dl><dt>configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294638">Configuration Files</a></dt><dt>log files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294732">Logging</a></dt><dt>modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294666">Modules</a></dt><dt>parsing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288167">File parsing</a></dt><dt>permissions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292785">Setting File Permissions</a></dt><dt>resource library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></dt><dt>spool, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></dt></dl></dd><dt>FILTER() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>FilteredExtension channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>findslot (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>findslot directive, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt><dt>Flash Operator Panel
          (FOP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283424">Flash Operator Panel</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id285574">Flash Operator Panel</a></dt><dt>floating point unit, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>FOP (Flash Operator Panel), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id283424">Flash Operator Panel</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id285574">Flash Operator Panel</a></dt><dt>forcegreetings option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>forcename option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>format</dt><dd><dl><dt>interpreters, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>music, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></dt><dt>outgoing fax handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></dt></dl></dd><dt>format option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>format_g723 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_g726 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_g729 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_gsm interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_h263 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_h264 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_ilbc interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_jpeg interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_mp3 addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>format_ogg_vorbis interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_pcm interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_siren14 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_siren7 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_sln interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_sln16 interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_vox interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_wav interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>format_wav_gsm interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>forward_urgent_auto option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>fraud, toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>Freenum Automated Self-Service Tool (FASST), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></dt><dt>freenum.org, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR">Internet Call Routing</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></dt><dt>FreePBX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface">Web Interfaces</a></dt><dt>French prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>friends, authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.3">Friends</a></dt><dt>fromstring option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>func dialplan functions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a></dt><dt>functions</dt><dd><dl><dt>ARRAY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>BLACKLIST() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dt>calendar show calendar &lt;myGoogleCal&gt;
          command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262442">Configuring Calendar Support for Asterisk</a></dt><dt>CALENDAR_BUSY() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246818">Controlling Calls Based on Calendar Information</a></dt><dt>CALENDAR_BUSY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>CALENDAR_EVENT() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a></dt><dt>CALENDAR_QUERY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>CALENDAR_QUERY_RESULT() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id246890">Conclusion</a></dt><dt>CALLERID() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>CDR() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36060342">Writing Call Information to a Calendar</a></dt><dt>CHANNEL() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>CHANNEL() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id291715">indications.conf</a></dt><dt>CSV_QUOTE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_custom">cdr_custom</a></dt><dt>CURL() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246881">CURL</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247025">The Dialplan</a></dt><dt>DB_EXISTS() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>DEVICE_STATE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id262632">Checking Device States</a></dt><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2">Dialplan Functions</a></dt><dt>dialplan functions in mappings, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>DIALPLAN_EXISTS() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>DUNDILOOKUP() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>DUNDIQUERY() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>DUNDIRESULT() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>ENUMLOOKUP() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt><dt>EXTENSION_STATE() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></dt><dt>FILTER() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>IF() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt><dt>ISNULL() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dt>JABBER_RECEIVE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dt>module reload cdr_adaptive_odbc.so function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>ODBC_FETCH() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>SkypeChatSend() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>SKYPE_BUDDIES() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>SKYPE_BUDDY_FETCH() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>SKYPE_CHAT_RECEIVE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>SMDI_MSG() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt></dl></dd><dt>func_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287624">A Gentle Introduction to func_odbc</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246897">func_odbc</a></dt><dt>func_odbc.conf.sample, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>future (see telephony future)</dt><dt>FX ports, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></dt><dt>FXO ports, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id262143">Analog telephony</a></dt></dl></div><div class="indexdiv"><h3>G</h3><dl><dt>g(#) (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>g(#) (VoiceMailMain() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt><dt>G.711 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>G.722 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id318733">G.722</a></dt><dt>G.726 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.2">G.726</a></dt><dt>G.729A codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.4">G.729A</a></dt><dt>[general] section</dt><dd><dl><dt>agents.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>cdr.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>Comedian Mail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>features.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>http.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>jabber.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>queues.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>sip.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>sla.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt></dl></dd><dt>GET DATA AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>GET OPTION AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>ghostscript PDF interpreter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></dt><dt>gi show commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>global variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.1">Global variables</a></dt><dt>Globally Unique IDs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>[globals] section,
          context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>Gmail accounts, IMAPs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#enabling-gmail-imap">Enabling IMAP on your Gmail account</a></dt><dt>goodbye option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>Google Talk, chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#accepting_calls_from_google_talk">Accepting calls from Google Talk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285398">Outgoing calls via Google Talk</a></dt><dt>Google Voice, chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285352">Accepting calls from Google Voice</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dt>GOSUB AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>GoSub() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#GoSub">GoSub()</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dd><dl><dt>calling subroutines from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060490">Calling Subroutines from the Dialplan</a></dt><dt>defining subroutines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060368">Defining Subroutines</a></dt><dt>returning from a subroutine, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dt>using arguments in subroutines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060548">Using Arguments in Subroutines</a></dt></dl></dd><dt>GOSUB_RETVAL channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id287950">Standard dialplan</a></dt><dt>Goto() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>GotoIf() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>GotoIfTime() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>greeting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id289543">The Greeting</a></dt><dt>greetingfolder option
                      (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>greetingsfolder option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>grounding requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.2">Grounding</a></dt><dt>group option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>grouping, application map grouping, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></dt><dt>GSM codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.5">GSM</a></dt><dt>guaranteed service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3">Guaranteed Service</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>H.323, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3">H.323</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.4">H.323 and NAT</a></dt><dt>handset, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3.2">Handset</a></dt><dt>HANGUP AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>HANGUP CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>Hangup() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.1">The GotoIf() Application</a></dt><dt>hardphones, configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></dt><dt>hardware echo cancellation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></dt><dt>hash symbol (#)</dt><dd><dl><dt>comment, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>delimiter between map names, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt></dl></dd><dt>Hello World example, dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2">A Simple Dialplan</a></dt><dt>hideconnect (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>hidefromdir option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>high-fidelity voice, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.2">High-Fidelity Voice</a></dt><dt>highpriority (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>hints, extension states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265385">Hints</a></dt><dt>hold option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>home automation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>hook switch, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3.1">Hook switch (or switch hook)</a></dt><dt>HOOKFLASH event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>host (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>host option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>host option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059941">Connecting two Asterisk systems together with SIP</a></dt><dt>hostname, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></dt><dt>hot-desking</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>func_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt></dl></dd><dt>HTTP, AMI over HTTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-HTTP">AMI over HTTP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-HTTP">AMI over HTTP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt><dt>http.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>httptimeout option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>humidity requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.1">Humidity</a></dt><dt>hybrid (transformer), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3">Hybrid (or network)</a></dt><dt>hybrid systems, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id282177">Hybrid Systems</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>i (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>i18n, defined, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization">Internationalization</a></dt><dt>IAX protocol</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1">IAX (The “Inter-Asterisk eXchange” Protocol)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.4">IAX and NAT</a></dt><dt>encryption, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dt>trunks: configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291291">Configuring IAX trunks between Asterisk systems</a></dt></dl></dd><dt>IAX softphone, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534809">Modifying Your Channel Configuration Files for Your
      Environment</a></dt><dt>iax.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt><dt>IAX2 protocol</dt><dd><dl><dt>authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>denial of service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt></dl></dd><dt>IF() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt><dt>ignoreip option (jail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>ignoreregexpire option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>iLBC (Internet Low Bitrate Codec)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.6">iLBC</a></dt><dt>quick reference, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt></dl></dd><dt>IMAP (Internet Message Access Protocol)</dt><dd><dl><dt>enabling on your Gmail account, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#enabling-gmail-imap">Enabling IMAP on your Gmail account</a></dt><dt>library: compiling voicemail support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247065">Compiling the IMAP library</a></dt><dt>voicemail integration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration">VoiceMail IMAP Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt></dl></dd><dt>IMAP (Internet message application protocol)</dt><dd><dl><dt>voicemail storage backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></dt></dl></dd><dt>imapflags option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>imapfolder option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>imapgreetings option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>imapparentfolder option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>include option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>includes, dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.8">Includes</a></dt><dt>incoming calls, AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288192">Delivering Incoming Calls to the Auto Attendant</a></dt><dt>incoming fax handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id263810">Incoming Fax Handling</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dd><dl><dt>fax detection, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id314159">Fax Detection</a></dt><dt>fax to email, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></dt><dt>fax to TIFF, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259374">Fax to TIFF</a></dt></dl></dd><dt>indications.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></dt><dt>initcrypto (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>initiatedseconds option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>inkey option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>installation</dt><dd><dl><dt>OpenAIS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025793">Installation</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></dt></dl></dd><dt>installing</dt><dd><dl><dt>cURL module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></dt><dt>DAHDI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>Fail2ban, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001218">Installation</a></dt><dt>Festival application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055967">Installing Festival on CentOS</a></dt><dt>MySQL for CentOS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id262627">Installing MySQL for CentOS</a></dt><dt>MySQL for Ubuntu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id253003">Installing MySQL for Ubuntu</a></dt><dt>OpenNMS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241824">Installing OpenNMS</a></dt><dt>PostgreSQL for CentOS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database">Installing PostgreSQL for CentOS</a></dt><dt>PostgreSQL for Ubuntu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id254247">Installing PostgreSQL for Ubuntu</a></dt><dt>PSTN trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240851">Installing PSTN Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>Skype, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057654">Installation of Skype for Asterisk</a></dt><dt>SLA applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>SNMP module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241664">Installing the SNMP Module for Asterisk</a></dt><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id323352">Compiling and Installing spandsp</a></dt><dt>telephony hardware, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt></dl></dd><dt>installing Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install">Installing Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295025">Conclusion</a></dt><dd><dl><dt>base configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_base_configuration">Base Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dd><dl><dt>disabling SELinux, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293578">Disable SELinux</a></dt><dt>initial configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293688">Initial Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a></dt><dt>make menuselect, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994">make menuselect</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt></dl></dd><dt>common issues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294543">Common Issues</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id295010">E: Unable to lock the administration directory (/var/lib/dpkg/),
      are you root?</a></dt><dt>distribution installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291070">Distribution Installation</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dd><dl><dt>CentOS Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291082">CentOS Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dt>Ubuntu Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291827">Ubuntu Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt></dl></dd><dt>downloading software, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></dt><dt>installing software, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_how_to_install_it">How to Install It</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292785">Setting File Permissions</a></dt><dt>software dependencies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt><dt>summary “cheat”
        sheet, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a></dt><dt>updating Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></dt><dt>upgrading Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt></dl></dd><dt>Integrated Services Digital Network (see ISDN)</dt><dt>Interactive Voice Response (see IVR)</dt><dt>interfaces (see web interfaces)</dt><dt>internal_timing (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>International Telecommunication Union (ITU),
          E.164, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Internationalization">Internationalization</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dd><dl><dt>Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id373863">Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt><dd><dl><dt>caller ID, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305757">Caller ID</a></dt><dt>language and/or accent of prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>time/date stamps and pronunciation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt></dl></dd><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></dt><dt>devices external to the Asterisk server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>PSTN connectivity, DAHDI, Digium cards, and analog
        phones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>summary “cheat” sheet, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt></dl></dd><dt>Internet call routing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR">Internet Call Routing</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248492">Conclusion</a></dt><dd><dl><dt>DNS and SIP URIs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ICR-SECT-1">DNS and SIP URIs</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></dt><dd><dl><dt>accepting calls to your system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289934">Accepting Calls to Your System</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></dt><dt>dialing SIP URIs from Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288838">Dialing SIP URIs from Asterisk</a></dt><dt>SIP URI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id268880">The SIP URI</a></dt><dt>SRV records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt></dl></dd><dt>ENUM and E.164, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288915">ENUM and E.164</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></dt><dd><dl><dt>Asterisk and ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></dt><dt>E.164 and the ITU, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289026">ENUM</a></dt></dl></dd><dt>ISN, ITAD, and freenum.org, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289190">ISN, ITAD, and freenum.org</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579341">Receiving calls to your ITAD</a></dt><dd><dl><dt>create a DNS entry for your ITAD, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></dt><dt>ISNs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></dt><dt>ITADs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247800">IP Telephony Administrative Domains (ITADs)</a></dt><dt>management of Internet numbering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></dt><dt>testing your ITAD, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248004">Testing Your ITAD</a></dt></dl></dd><dt>ISN, ITAD, and freenum.org</dt><dd><dl><dt>ISNs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt></dl></dd><dt>security and identity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248274">Security and Identity</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a></dt><dd><dl><dt>distributed denial of service attacks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></dt><dt>phishing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248457">Phishing</a></dt><dt>security as an ongoing process, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a></dt><dt>SPIT, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248402">Spam over Internet Telephony (SPIT)</a></dt><dt>toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt></dl></dd></dl></dd><dt>Internet Low Bitrate Codec (see iLBC)</dt><dt>Internet message application protocol (see IMAP)</dt><dt>interpreters, format interpreters, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>invalid handler, AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287934">Invalid</a></dt><dt>IP multicast</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt></dl></dd><dt>IP telephones</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.4">IP telephones</a></dt></dl></dd><dt>iptables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001274">iptables</a></dt><dt>IPv6 localhost, PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql">Configuring PostgreSQL</a></dt><dt>IPv6, sip.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>IRC channels, Asterisk community, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.3">The IRC Channels</a></dt><dt>IRQ latency, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>ISDN (Integrated Services Digital Network), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.2">ISDN</a></dt><dt>ISDN telephones, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.1.3">ISDN telephones</a></dt><dt>ISNs (ITAD Subscriber Numbers)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289215">Got ISN?</a></dt><dt>using in your Asterisk system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt></dl></dd><dt>ISNULL() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dt>ITADs (IP Telephony Administrative Domains)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247800">IP Telephony Administrative Domains (ITADs)</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248004">Testing Your ITAD</a></dt></dl></dd><dt>ITU (International Telecommunication Union),
          E.164, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>IVR (Interactive Voice Response), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR">Interactive Voice Response</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247197">Conclusion</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR-SECT-1">What Is IVR?</a></dt><dt>Asterisk modules for building IVRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246875">Asterisk Modules for Building IVRs</a></dt><dt>compared to an AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-AA-SECT-1">An Auto Attendant Is Not an IVR</a></dt><dt>components, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>design considerations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id289181">IVR Design Considerations</a></dt><dt>prompt-recording application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247054">A Prompt-Recording Application</a></dt><dt>simple IVR using CURL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246940">A Simple IVR Using CURL</a></dt><dt>speech recognition and text-to-speech, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247100">Speech Recognition and Text-to-Speech</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>Jabber, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a></dt><dt>Jabber dialplan commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dd><dl><dt>connecting to an XMPP server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>receiving messages with JABBER_RECEIVE(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dt>sending message with JabberSend(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></dt></dl></dd><dt>jabber purge nodes command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>jabber show buddies command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>jabber show connected command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>JabberSend() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></dt><dt>JABBER_RECEIVE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dt>jail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>jitterbuffers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></dt><dt>joinempty option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></dt><dt>joining queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></dt></dl></div><div class="indexdiv"><h3>K</h3><dl><dt>kernel optimizations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>kernel version, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>keys, AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>label (GotoIfTime() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>labels, priority labels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262089">Priority labels</a></dt><dt>LAN (local area network), distributed device
          states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></dt><dt>language, internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id305831">Language and/or Accent of Prompts</a></dt><dt>languageprefix (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>lastapp CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>lastdata CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>latency, IRQ latency, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>LDAP (Lightweight Directory Access Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291590">LDAP Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dd><dl><dt>compiling LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189890">Compiling LDAP Support into Asterisk</a></dt><dt>configuring Asterisk for LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id189907">Configuring Asterisk for LDAP Support</a></dt><dt>OpenLDAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt></dl></dd><dt>ldapadd command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>leavewhenempty option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></dt><dt>leaving queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005370">Controlling when to join and leave a queue</a></dt><dt>legacy PBX migration gateway, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.1">Legacy PBX migration gateway</a></dt><dt>libopenr2 library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36060731">MFC/R2</a></dt><dt>libpath, spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id337783">Adding the spandsp Library to Your libpath</a></dt><dt>LibPRI library, installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423812">LibPRI</a></dt><dt>libraries</dt><dd><dl><dt>IMAP library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247065">Compiling the IMAP library</a></dt><dt>libopenr2 library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36060731">MFC/R2</a></dt><dt>LibPRI library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id423812">LibPRI</a></dt><dt>resource library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></dt><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id253868">spandsp</a></dt></dl></dd><dt>LibSRTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>licensing, music on hold, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></dt><dt>lightbackground (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>Lightweight Directory Access Protocol (see LDAP)</dt><dt>limit option (res_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>linkedid CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>LINKEDID_END CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>Linksys Key System Parameters (SPA phones), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>Linksys phones, SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>Linux</dt><dd><dl><dt>distributions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>filesystem: storage backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc">Installing and Configuring ODBC</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-5">Linux Considerations</a></dt><dt>syslog daemon, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262478">Logging to the Linux syslog Daemon</a></dt></dl></dd><dt>listen-control-forward-key option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>listen-control-pause-key option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>listen-control-restart-key option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>listen-control-reverse-key option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>listen-control-stop-key option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>load (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>loading</dt><dd><dl><dt>DAHDI modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240859">Downloading and installing DAHDI</a></dt><dt>new channel configurations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291909">Loading Your New Channel Configurations</a></dt></dl></dd><dt>loadzone, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>local area network (LAN), distributed device
          states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></dt><dt>local channels</dt><dd><dl><dt>ACD queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id324598">Local Channels</a></dt></dl></dd><dt>locale option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>locality option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>LocalSets context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>lockconfdir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>log files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294732">Logging</a></dt><dt>log option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>logarithmic companding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.4">Logarithmic companding</a></dt><dt>logger.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id265067">Verifying Logging</a></dt><dt>logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring">System Monitoring and Logging</a></dt><dd><dl><dt>(see also system monitoring and logging)</dt><dt>into and out of multiple queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288626">Automatically Logging Into and Out of Multiple Queues</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288626">Automatically Logging Into and Out of Multiple Queues</a></dt><dt>verbose Logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt></dl></dd><dt>loguniqueid option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>loguserfield option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>lookups, dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id301073">Performing Lookups from the Dialplan</a></dt><dt>low-barrier IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>lsdahdi command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291054">Configuring digital circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>macros, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5">Macros</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt><dd><dl><dt>calling macros from the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.2">Calling Macros from the Dialplan</a></dt><dt>defining, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.1">Defining Macros</a></dt><dt>using arguments in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.3">Using Arguments in Macros</a></dt></dl></dd><dt>mailboxes, definitions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>mailcmd option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>mailing lists, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>main menu, AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287786">The Main Menu</a></dt><dt>make menuselect command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id424034">Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></dt><dt>manager actions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248378">Protocol Overview</a></dt><dt>manager encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248704">/manager encoding</a></dt><dt>manager events, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248782">Manager events</a></dt><dt>manager show command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></dt><dt>manager show command AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241958">Async AGI</a></dt><dt>manager show commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248542">Actions</a></dt><dt>manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>mapping contexts, DUNDi, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id405996">Creating Mapping Contexts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#using-mapping-contexts">Using Mapping Contexts with Peers</a></dt><dt>[mappings section],
        dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>mappings, dialplan functions in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id307312">Using dialplan functions in mappings</a></dt><dt>math programs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>mathematical operators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>maxcalls (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>maxdigits argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>maxfiles (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>maxgreet option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>maxlen option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>maxload (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>maxloginretries option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>maxlogins option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>maxmsg option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>maxsecs option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>maxsilence option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>md5sum command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>Media Gateway Control Protocol (MGCP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.4">MGCP</a></dt><dt>media, encryption, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001503">Encrypted Media</a></dt><dt>MeetMe() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>MeetMeCount() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#meetmeConferencing">Conferencing with MeetMe()</a></dt><dt>MeetMequeue_log, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>member option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>memberdelay option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>membermacro option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>members</dt><dd><dl><dt>penalizing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></dt></dl></dd><dt>menuselect, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292994">make menuselect</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293020">Uses for menuselect</a></dt><dt>interfaces, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></dt><dt>scripting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>using, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293213">Using menuselect</a></dt></dl></dd><dt>menuselect command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></dt><dt>menuselect system, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a></dt><dt>menuselect.makeopts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>message encoding, AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248495">Message Encoding</a></dt><dt>messages, voice messages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>messagewrap option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>messaging, unified messaging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.5">Unified Messaging</a></dt><dt>metrics, static realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt><dt>MFC/R2 protocol, configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36060731">MFC/R2</a></dt><dt>MG2, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id164614">Analog Phones</a></dt><dt>MGCP (Media Gateway Control Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.4">MGCP</a></dt><dt>Microsoft SQL, configuring ODBC for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></dt><dt>military option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt><dt>min-announce-frequency option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>minmemfree (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>minpassword option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>minsecs option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>mobile option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>model option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>module reload app_queue.so command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>module reload cdr_adaptive_odbc.so function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-5-SECT-1">Modules</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt><dd><dl><dt>addon modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>bridging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291787">Bridging Modules</a></dt><dt>CDR modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id291894">Call Detail Recording Modules</a></dt><dt>channel drivers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292243">Channel Drivers</a></dt><dt>channel event logging modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292103">Channel Event Logging Modules</a></dt><dt>codec translators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id241422">Applications</a></dt><dt>dialplan functions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293084">Dialplan Functions</a></dt><dt>file structure, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294666">Modules</a></dt><dt>format interpreters, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292796">Format Interpreters</a></dt><dt>PBX modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>resource modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293876">Resource Modules</a></dt><dt>test modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt></dl></dd><dt>[modules] section
          (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>modules.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294211">modules.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></dt><dt>moh show classes command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt><dt>monitor-format option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>monitor-type option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>months (GotoIfTime() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>motherboards, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.3">Choosing a Motherboard</a></dt><dt>moveheard option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>MP3 codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.8">MP3</a></dt><dt>MP3 format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></dt><dt>MPLS (Multiprotocol Label Switching ), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.1">MPLS</a></dt><dt>multicast paging</dt><dd><dl><dt>Cisco SPA Telephones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>MulticastRTP channel, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt></dl></dd><dt>multiplelogin option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>Multiprotocol Label Switching (MPLS), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.1">MPLS</a></dt><dt>multirow Functionality with func_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>music on hold, licensing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></dt><dt>music, format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id266259">Converting Music to a Format That Works Best with
      Asterisk</a></dt><dt>musicclass option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>musiconhold option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>musiconhold.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294479">musiconhold.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-musiconhold-conf-file">musiconhold.conf</a></dt><dt>mxml encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248743">/mxml encoding</a></dt><dt>MySQL</dt><dd><dl><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></dt><dt>configuring ODBC for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246760">Configuring ODBC for MySQL</a></dt><dt>installing CentOS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id262627">Installing MySQL for CentOS</a></dt><dt>installing for Ubuntu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id253003">Installing MySQL for Ubuntu</a></dt><dt>verifying binary data, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>N</h3><dl><dt>n (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>name-to-extension mapping, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288593">Database lookup</a></dt><dt>naming</dt><dd><dl><dt>contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>extensions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.2">Extensions</a></dt><dt>macros, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-5.1">Defining Macros</a></dt><dt>phones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a></dt></dl></dd><dt>NANP (North American Number Plan)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288933">E.164 and the ITU</a></dt><dt>ENUM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289086">Asterisk and ENUM</a></dt><dt>toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></dt></dl></dd><dt>NAPTR records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289190">ISN, ITAD, and freenum.org</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id247934">Create a DNS Entry for Your ITAD</a></dt><dt>NAT (Network Address Translation)</dt><dd><dl><dt>H.323, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.4">H.323 and NAT</a></dt><dt>IAX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.4">IAX and NAT</a></dt><dt>SIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.4">SIP and NAT</a></dt></dl></dd><dt>nat (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>network APIs, security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001664">Securing Asterisk Network APIs</a></dt><dt>Network Time Protocol (see NTP)</dt><dt>networks</dt><dd><dl><dt>digital circuit-switched telephone network, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3">The Digital Circuit-Switched Telephone Network</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></dt><dt>packet-switched networks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-4">Packet-Switched Networks</a></dt></dl></dd><dt>nextaftercmd option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>nocallerid (Zapateller() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></dt><dt>nocolor (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>nocomunsolicit option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>nofork (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>noinclude option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>noload (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>noload directive, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#additional_configuration_tasks-modules-conf-file">modules.conf</a></dt><dt>NOOP AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>NoOp() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id323331">Manually adding responses</a></dt><dt>nopartial option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>Nortel’s DMS switch, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>North American Number Plan (see NANP)</dt><dt>notice logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>notifycid option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>notifyhold option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>notifyringing option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>nounsolicited option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>NTP (Network Time Protocol)</dt><dd><dl><dt>enabling for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></dt><dt>NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt></dl></dd><dt>ntpd command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a></dt><dt>number-mapping context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>Nyquist’s Theorem, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.3">Nyquist’s Theorem</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>OC circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.3">SONET and OC circuits</a></dt><dt>ODBC (Open Database Connectivity)</dt><dd><dl><dt>configuring for Microsoft SQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></dt><dt>configuring for MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246760">Configuring ODBC for MySQL</a></dt><dt>configuring for PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#test">Configuring ODBC for PostgreSQL</a></dt><dt>configuring res_odbc to allow Asterisk to connect through
          ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>validating the ODBC connector, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></dt><dt>voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578">ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dd><dl><dt>configuring voicemail.conf for ODBC storage, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>creating the large object type for PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#psql_large_object_support">Creating the Large Object Type for PostgreSQL</a></dt><dt>storage table layout, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276920">ODBC Voicemail Storage Table Layout</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt></dl></dd><dt>voicemail storage backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292932">ODBC</a></dt></dl></dd><dt>ODBC connector, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB">Relational Database Integration</a></dt><dt>odbc show CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>odbcstorage option (res_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>odbcstorage option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>odbctable option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>ODBC_FETCH() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>office-phone (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>onboard hardware echo cancellation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id246002">Hardware Echo Cancellation</a></dt><dt>open architecture, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.2">Open Architecture</a></dt><dt>open source telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3">The Promise of Open Source Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dd><dl><dt>community, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.5">Passionate Community</a></dt><dt>conference rooms, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.3">Conference rooms</a></dt><dt>consumers needs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.1">The Itch That Asterisk Scratches</a></dt><dt>home automation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>legacy PBX migration gateway, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.1">Legacy PBX migration gateway</a></dt><dt>low-barrier IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>open architecture, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.2">Open Architecture</a></dt><dt>response to new technologies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.4">Lightning-Fast Response to New Technologies</a></dt><dt>standards compliance, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.3">Standards Compliance</a></dt></dl></dd><dt>OpenAIS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265052">Using OpenAIS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060930">Distributing Device States over a LAN</a></dt><dd><dl><dt>Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025387">Asterisk configuration</a></dt><dt>installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025793">Installation</a></dt><dt>OpenAIS configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025485">OpenAIS configuration</a></dt><dt>testing device state changes, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt></dl></dd><dt>OpenLDAP, configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id200106">Configuring OpenLDAP</a></dt><dt>OpenNMS</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241628">SNMP</a></dt><dt>configuring SNMP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>monitoring Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></dt></dl></dd><dt>OpenR2 project, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36060731">MFC/R2</a></dt><dt>OpenSSL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>opentimeout option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>OpenWRT, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2.1">Small systems</a></dt><dt>operator option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>operators</dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>same (=&gt;) operator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262049">The 'same =&gt;' operator</a></dt></dl></dd><dt>option argument, Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292662">Argument 3: Option</a></dt><dt>options argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>[options] section
          (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>order option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>organization option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>originate option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>outgoing fax handling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id265396">Outgoing Fax Handling</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dd><dl><dt>email to fax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id329361">An Experiment in Email to Fax</a></dt><dt>file format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id418840">File Format for Faxing</a></dt><dt>transmitting a fax from Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></dt></dl></dd><dt>outkey option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>overflow, ACD queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288963">Overflow</a></dt><dt>overhead and “underchin” paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt><dt>overhead paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>P (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>p (VoiceMailMain() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt><dt>packages, Asterisk packages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install">Installing Asterisk</a></dt><dt>packet-switched networks</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-4">Packet-Switched Networks</a></dt><dt>hardware requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.2">Connecting Exclusively to a Packet-Based Telephone
      Network</a></dt></dl></dd><dt>Page() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></dt><dt>Page() command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>PAGELIST variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257873">Bringing it all together</a></dt><dt>pagerbody option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>pagerdateformat option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>pagerfromstring option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>pagersubject option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt><dd><dl><dt>places to send your pages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265355">Places to Send Your Pages</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257873">Bringing it all together</a></dt><dd><dl><dt>combination paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257848">Combination paging</a></dt><dt>external paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id265366">External paging</a></dt><dt>multicast paging via the MulticastRTP channel, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>set-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>VoIP paging adaptors, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257823">VoIP paging adaptors</a></dt></dl></dd><dt>zone paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt></dl></dd><dt>paradigm shift, telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-2">Paradigm Shift</a></dt><dt>parameters, configuring Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id216341">Configuring Asterisk</a></dt><dt>Park:&lt;exten@context&gt; virtual device, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>parkcall (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>parked calls, timed-out parked calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedcallhangup (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedcallrecording (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedcallreparking (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedcalltransfers (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkeddynamic (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedmusicclass (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkedplay (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkext (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parking</dt><dd><dl><dt>call parking with dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a></dt><dt>features.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt><dd><dl><dt>application map grouping, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256980">Application Map Grouping</a></dt><dt>[applicationmap]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243954">The [applicationmap] Section</a></dt><dt>[featuremap]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id243770">The [featuremap] Section</a></dt><dt>[general] section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parking lots, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#parkingLots">Parking Lots</a></dt></dl></dd></dl></dd><dt>parkinghints (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkingtime (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>parkpos (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.2">Call Parking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>PARK_END CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>PARK_START CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>parsing files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id288167">File parsing</a></dt><dt>passwordlocation option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>passwords</dt><dd><dl><dt>generating, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>secure passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>setting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>strong passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>validating, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt></dl></dd><dt>pattern matching</dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6">Pattern Matching</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></dt><dd><dl><dt>${EXTEN} channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.3">Using the ${EXTEN} channel variable</a></dt><dt>examples, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></dt><dt>syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></dt></dl></dd><dt>DUNDi and Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id337604">Using pattern matches</a></dt></dl></dd><dt>PAUSE event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>PAUSEALL event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>PauseQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></dt><dt>PBX modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>PBXs, and IVR systems, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-IVR-SECT-1">What Is IVR?</a></dt><dt>pbxskip option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>pbx_ael module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_config module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_dundi module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_loopback module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_lua module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_realtime (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></dt><dt>pbx_realtime module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>pbx_spool module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293711">PBX Modules</a></dt><dt>PDFs, fax to PDF, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259365">Fax to Email</a></dt><dt>peer CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>peer definitions, dundi.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>peering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6">Peering</a></dt><dt>peers, authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.2">Peers</a></dt><dt>penalizing queue members, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></dt><dt>penalties, changing dynamically, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>PENALTY event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>penaltymemberslimit option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>performance</dt><dd><dl><dt>paging multiple sets, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>server requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>transcoding, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt></dl></dd><dt>periodic-announce option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>periodic-announce-frequency option
                (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>permit option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>permit option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>persistentmembers option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>phishing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248457">Phishing</a></dt><dt>phone option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>phones</dt><dd><dl><dt>naming, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4">Types of Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.4">Communications Terminals</a></dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt></dl></dd><dt>PHPAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>physical security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></dt><dt>pickupexten (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>pickupfailsound (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>pickupsound (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>pipe character (|)</dt><dd><dl><dt>delimiter, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.4">Applications</a></dt><dt>voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt></dl></dd><dt>Playback() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></dt><dt>playback, prompts within a queue, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>pollfreq option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>pollmailboxes option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>Polycom, SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>pooling option (res_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>Port (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>port option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>port option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>PostgreSQL</dt><dd><dl><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-postgresql">Configuring PostgreSQL</a></dt><dt>configuring ODBC for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#test">Configuring ODBC for PostgreSQL</a></dt><dt>installing for CentOS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_the_database">Installing PostgreSQL for CentOS</a></dt><dt>installing for Ubuntu, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id254247">Installing PostgreSQL for Ubuntu</a></dt><dt>verifying binary data, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></dt></dl></dd><dt>power conditioning requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1">Power Conditioning and Uninterruptible Power Supplies</a></dt><dt>power supplies, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4">Power Supply Requirements</a></dt><dt>power-condition UPSs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1.1">Power-conditioned UPSs</a></dt><dt>precache option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>preload (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>preload-require (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>presence information for emergency
                  services, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></dt><dt>PRI connections, terminating, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></dt><dt>PRI ISDN, configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>PRI/BRI, changing type of, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>priorities</dt><dd><dl><dt>dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.3">Priorities</a></dt><dt>s extension, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt></dl></dd><dt>Priority (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>priority labels, dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262089">Priority labels</a></dt><dt>priority option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>priority queue, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>process-based AGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id262615">Process-Based AGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id254339">Process-based AGI/FastAGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id241920">Process-based AGI/FastAGI</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242030">Process-based AGI/FastAGI</a></dt><dt>processors, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.2">Choosing a Processor</a></dt><dt>Progress() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>projects, Asterisk-based projects, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Install">Installing Asterisk</a></dt><dt>prompt argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>prompt-recording application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247054">A Prompt-Recording Application</a></dt><dt>prompts</dt><dd><dl><dt>language: changing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>playback with a queue, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>recording prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt><dt>studio prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt></dl></dd><dt>pronunciation</dt><dd><dl><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt><dt>voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt></dl></dd><dt>Proto (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>protocols, digital signaling protocols, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2">Digital Signaling Protocols</a></dt><dt>PSTN (Public Switched Telephone Network)</dt><dd><dl><dt>circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271202">PSTN Circuits</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id271212">Traditional PSTN Trunks</a></dt><dt>installing PSTN trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id240851">Installing PSTN Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt></dl></dd><dt>connections: changing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>connectivity: internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id336705">DAHDI Drivers</a></dt><dt>hardware requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.1">Connecting to the PSTN</a></dt><dt>origination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>termination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></dt><dt>trunks: emergency dialing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></dt></dl></dd><dt>public address, “underchin” paging and overhead, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt><dt>pulse-code Modulation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1">Pulse-Code Modulation</a></dt></dl></div><div class="indexdiv"><h3>Q</h3><dl><dt>q (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>QoS (Quality of Service), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4">Quality of Service</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.4">Best Effort</a></dt><dd><dl><dt>best effort, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.4">Best Effort</a></dt><dt>differentiated service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.2">Differentiated Service</a></dt><dt>future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.6">Quality of service</a></dt><dt>guaranteed service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3">Guaranteed Service</a></dt><dt>SCTP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.3">Stream Control Transmission Protocol</a></dt><dt>TCP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.1">Transmission Control Protocol</a></dt><dt>UDP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.2">User Datagram Protocol</a></dt></dl></dd><dt>queue add command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue add member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue member priority, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288954">Queue Member Priority</a></dt><dt>queue members, defined, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a></dt><dt>queue pause member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue remove member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue unpause member command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289522">Controlling Queue Members via the CLI</a></dt><dt>queue weighting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>Queue() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></dt><dt>queue-callswaiting option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-holdtime option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-minutes option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-reporthold option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-seconds option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-thankyou option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-thereare option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queue-youarenext option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>queuerules.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a></dt><dd><dl><dt>(see also ACD queues)</dt><dt>call centers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-ACD">Automatic Call Distribution (ACD) Queues</a></dt><dt>clustering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060570">Multiple Queues, Multiple Sites</a></dt><dt>contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>reporting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36041966">Queue Reporting</a></dt><dt>status, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36038569">Queue Status Display</a></dt></dl></dd><dt>queues.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>queue_log file, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>QUEUE_MAX_PENALTY channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>QUEUE_MIN_PENALTY channel variable, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004485">Changing Penalties Dynamically (queuerules.conf)</a></dt><dt>quiet (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>r (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>[radius] section</dt><dd><dl><dt>cdr.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt></dl></dd><dt>radiuscfg option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>radiuscfg option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt><dt>random-periodic-announce option
                (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>rawman encoding type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248689">/rawman encoding</a></dt><dt>read option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>Read() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>read/write options, AMI user accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>readtimeout option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>realtime, sip.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dt>RECEIVE CHAR AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>RECEIVE TEXT AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>receiving calls to your ITAD, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id579341">Receiving calls to your ITAD</a></dt><dt>RECORD FILE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>Record() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288074">Using the dialplan to create recordings</a></dt><dt>recordagentcalls option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>recordformat option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>recording prompts, AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt><dt>record_cache_dir (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>redundant power supplies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.2">Redundant power supplies</a></dt><dt>referencing variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a></dt><dt>regcontext option (iax.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></dt><dt>regexten option option (iax.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id329464">Dynamically adding extension numbers</a></dt><dt>register statements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.2">register Statements</a></dt><dt>registration</dt><dd><dl><dt>handling for defined devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291920">The Asterisk CLI</a></dt><dt>SIP registrations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>testing device registration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></dt></dl></dd><dt>regular expression operators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>regulatory wars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></dt><dt>relational databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DB">Relational Database Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1610">Conclusion</a></dt><dd><dl><dt>ARA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dd><dl><dt>dynamic realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>static realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt></dl></dd><dt>CDRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>compared to AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a></dt><dt>func_odbc, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287624">A Gentle Introduction to func_odbc</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>installing and configuring ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#installing_configuring_odbc">Installing and Configuring ODBC</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt><dt>installing and configuring PostgreSQL and MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#managing_databases">Installing and Configuring PostgreSQL and MySQL</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></dt><dt>managing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247345">Managing Databases</a></dt><dt>ODBC voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578">ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dd><dl><dt>configuring voicemail.conf for ODBC storage, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>creating the large object type for PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#psql_large_object_support">Creating the Large Object Type for PostgreSQL</a></dt><dt>storage table layout, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276920">ODBC Voicemail Storage Table Layout</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt></dl></dd></dl></dd><dt>relative-periodic-announce option
                (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36004667">Announcement Control</a></dt><dt>release cycles, telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.3">Slow Release Cycles</a></dt><dt>releases, versioning, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning">Asterisk Versioning</a></dt><dt>reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#static_realtime">Static Realtime</a></dt><dt>reminders, calendar reminders, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></dt><dt>remote connections, DUNDi, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id418721">Allowing Remote Connections</a></dt><dt>REMOVEMEMBER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>RemoveQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>replicated databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060859">Replicated Databases</a></dt><dt>reportholdtime option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>reporting option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>reporting, queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36041966">Queue Reporting</a></dt><dt>repositories, third-party, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt><dt>require (modules.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id216438">The [modules] Section</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning">Preparing a System for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-6">Conclusion</a></dt><dd><dl><dt>environment, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2">Environment</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></dt><dt>hardware, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294803">Hardware</a></dt><dt>Linux, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-5">Linux Considerations</a></dt><dt>phones, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4">Types of Phones</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.4">Communications Terminals</a></dt><dt>servers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1">Server Hardware Selection</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.2">Redundant power supplies</a></dt><dt>telephony hardware, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3">Telephony Hardware</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.3">Echo Cancellation</a></dt></dl></dd><dt>residential option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>resource library, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294686">The Resource Library</a></dt><dt>resource modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id293876">Resource Modules</a></dt><dt>res_agi (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id260261">The [compat] Section</a></dt><dt>res_calendar_ews module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id259378">CentOS dependencies</a></dt><dt>res_config_mysql addon module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294456">Addon Modules</a></dt><dt>res_ldap.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040839">Configuring res_ldap.conf</a></dt><dt>res_odbc</dt><dd><dl><dt>configuring to allow Asterisk to connect through
          ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id247224">Configuring res_odbc to Allow Asterisk to Connect Through
      ODBC</a></dt></dl></dd><dt>res_odbc.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>res_snmp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#recompile-ast-with-snmp">Recompiling Asterisk with the res_snmp module</a></dt><dt>res_snmp.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241885">Editing /etc/asterisk/res_snmp.conf to work with your OpenNMS
        server</a></dt><dt>retry option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>returning from a GoSub() subroutine, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dt>review option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>ringdelay option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>ringer, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.1">Ringer</a></dt><dt>ringinuse option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>RINGNOANSWER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>ringtimeout option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>RJ45 connection, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id397307">PSTN Connectivity, DAHDI, Digium Cards, and Analog Phones</a></dt><dt>robbed-bit signaling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.1">Channel Associated Signaling (CAS)</a></dt><dt>RSVP (Reservation Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.3.2">RSVP</a></dt><dt>rtautoclear option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>rtcachefriends option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>RTP multicast, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257664">Multicast paging via the MulticastRTP channel</a></dt><dt>rtsavesysname option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>rtupdate option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a></dt><dt>rungroup (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>runuser (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>s (Page() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a></dt><dt>s (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>s extension, configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291091">The s extension</a></dt><dt>safeshutdown option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>safe_asterisk script, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></dt><dt>same (=&gt;) operator, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id262049">The 'same =&gt;' operator</a></dt><dt>sample configuration files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a></dt><dt>sampling resolution and rate, digital telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.2">Increasing the sampling resolution and rate</a></dt><dt>savecallsin option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>SAY ALPHA AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SAY DATE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SAY DIGITS AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SAY NUMBER AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SAY TIME AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>saycid option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>sayduration option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>saydurationm option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>scalability, distributed device states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265044">Distributed Device States</a></dt><dt>scams, NANP and toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></dt><dt>scanning for valid accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security-SECT-1">Scanning for Valid Accounts</a></dt><dt>SCCP (Skinny Client Control Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.1">Skinny/SCCP</a></dt><dt>scheduleronly option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>scheduling calls between two participants, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sched_calls_two_parts">Scheduling calls between two participants</a></dt><dt>screen size, curses interface, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293069">menuselect interfaces</a></dt><dt>scripts</dt><dd><dl><dt>ast_tls_cert command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>configure script, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>external scripts and databases, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a></dt><dt>make menuselect, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293439">Scripting menuselect</a></dt><dt>safe_asterisk script, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293806">indications.conf and asterisk.conf</a></dt></dl></dd><dt>SCTP (Stream Control Transmission Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.3">Stream Control Transmission Protocol</a></dt><dt>searchcontexts option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>secret (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>secret option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>secret option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>secretpath option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>secure passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>Secure RTP (see SRTP)</dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248274">Security and Identity</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security">Security</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id260063">Conclusion—A Better Idiot</a></dt><dd><dl><dt>Asterisk network APIs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001664">Securing Asterisk Network APIs</a></dt><dt>authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id245121">Dialplan Vulnerabilities</a></dt><dt>distributed denial of service attacks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></dt><dt>encrypted media, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001503">Encrypted Media</a></dt><dt>Fail2ban, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001183">Fail2ban</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001391">Configuration</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001218">Installation</a></dt></dl></dd><dt>H.323, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.3">Security considerations</a></dt><dt>IAX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.3">Security considerations</a></dt><dt>IAX2 denial of service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001692">IAX2 Denial of Service</a></dt><dt>information on Asterisk wiki, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>as an ongoing
          process, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248469">Security Is an Ongoing Process</a></dt><dt>other risk mitigation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001703">Other Risk Mitigation</a></dt><dt>phishing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248457">Phishing</a></dt><dt>PSTN circuits and VoIP connections, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></dt><dt>scanning for valid accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Security-SECT-1">Scanning for Valid Accounts</a></dt><dt>servers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></dt><dt>SIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.3">Security considerations</a></dt><dt>SPIT, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248402">Spam over Internet Telephony (SPIT)</a></dt><dt>test users, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a></dt><dt>toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect18_tt1164">VoIP Security</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></dt><dd><dl><dt>DMZ, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252412">DMZ</a></dt><dt>encryption, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252454">Encryption</a></dt><dt>physical security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></dt><dt>segregating voice and data traffic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252398">Segregating voice and data traffic</a></dt><dt>server hardening, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252426">Server hardening</a></dt><dt>SPIT, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241778">Spam over Internet Telephony (SPIT)</a></dt><dt>spoofing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241852">Spoofing</a></dt></dl></dd></dl></dd><dt>segregating voice and data traffic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252398">Segregating voice and data traffic</a></dt><dt>SELinux (Security-Enhanced Linux), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id293578">Disable SELinux</a></dt><dt>SEND IMAGE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SEND TEXT AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SendFAX() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id36060960">Transmitting a Fax from Asterisk</a></dt><dt>sending email, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id36001330">Sending email</a></dt><dt>sendvoicemail option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>server certificates, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>serveremail option (voicemail.confl), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>serverhost option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>servers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1">Server Hardware Selection</a></dt><dd><dl><dt>(see also CentOS Server; Ubuntu Server)</dt><dt>Asterisk as a standalone voicemail server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293070">Using Asterisk As a Standalone Voicemail Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt><dt>Asterisk server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id412919">Devices External to the Asterisk Server</a></dt><dt>Festival server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.1">Festival</a></dt><dt>hardening: VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252426">Server hardening</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1">Server Hardware Selection</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.4.2">Redundant power supplies</a></dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.4">Security</a></dt><dt>server hardening, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252426">Server hardening</a></dt></dl></dd><dt>Service (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>servicelevel option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>session handling, AMI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id248633">Authentication and session handling</a></dt><dt>Session Initiation Protocol (see SIP)</dt><dt>SET AUTOHANGUP AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET CALLERID AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET CONTEXT AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET EXTENSION AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET MUSIC AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET PRIORITY AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SET VARIABLE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>Set() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.2">Examples of Dialplan Functions</a></dt><dt>set-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>setinterfacevar option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>setqueueentryvar option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>setqueuevar option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>shared extensions, example, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></dt><dt>Shared Line Appearances (see SLA)</dt><dt>shared_lastcall option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>Signaling System 7 (SS7), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></dt><dt>silencethreshold option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>Simple Network Management Protocol (see SNMP)</dt><dt>Simplified Message Desk Interface (SMDI),
          voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt><dt>single-party call, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292126">Single-party call</a></dt><dt>single-party call CDR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246856">Single-party call</a></dt><dt>single-port firewall penetration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>SIP (Session Initiation Protocol)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceConfig">User Device Configuration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291257">VoIP to VoIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2">SIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.4">SIP and NAT</a></dt><dt>Asterisk as a standalone voicemail server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      Voicemail Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293304">sip.conf requirements</a></dt><dt>authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>calls: encryption, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>channels</dt><dd><dl><dt>device state information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288989">Using Local Channels</a></dt><dt>transfers on, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id256654">features.conf</a></dt></dl></dd><dt>configuration matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>denial of service attacks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248436">Distributed Denial of Service Attacks</a></dt><dt>headers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>providers: connecting Asterisk systems to, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059950">Connecting an Asterisk system to a SIP provider</a></dt><dt>registrations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>trunks</dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291281">Configuring SIP trunks between Asterisk systems</a></dt><dt>SLA key system example with SIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></dt></dl></dd><dt>URI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id268880">The SIP URI</a></dt></dl></dd><dt>sip reload command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dt>sip show peers command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059941">Connecting two Asterisk systems together with SIP</a></dt><dt>sip show settings CLI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289964">Modifying sip.conf</a></dt><dt>SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>sip.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id532453">How Channel Configuration Files Work with the Dialplan</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293109">Integrating Asterisk into a SIP Environment As a Standalone
      Voicemail Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289964">Modifying sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#getting_funky">Getting Funky with func_odbc: Hot-Desking</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#dynamic_realtime">Dynamic Realtime</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040514">Configuring sip.conf for realtime</a></dt><dt>SIPAddHeader() voicemail application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>sippeers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36040635">Configuring extconfig.conf</a></dt><dt>size option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>Skinny Client Control Protocol (SCCP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.1">Skinny/SCCP</a></dt><dt>skipms option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>Skype, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291565">Skype Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057688">Using Skype for Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dd><dl><dt>calling without assigning extension numbers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>configuring chan_skype.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></dt><dt>placing and receiving calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#placing_and_receiving_calls_via_skype">Placing and receiving calls via Skype</a></dt><dt>sending and receiving messages, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt></dl></dd><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057654">Installation of Skype for Asterisk</a></dt></dl></dd><dt>SkypeChatSend() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>SKYPE_BUDDIES() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>SKYPE_BUDDY_FETCH() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#calling_skype_buddies_without_extens">Calling your Skype buddies without assigning extension
        numbers</a></dt><dt>SKYPE_CHAT_RECEIVE() dialplan function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36057295">Sending and receiving messages via Skype</a></dt><dt>SLA (Shared Line Appearances), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#SLA">Shared Line Appearances</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></dt><dd><dl><dt>additional configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289480">Configuration Overview</a></dt><dt>installing SLA applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289471">Installing the SLA Applications</a></dt><dt>key system example with analog trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></dt><dt>key system example with SIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></dt><dt>limitations, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#sla-limitations">Limitations</a></dt><dt>presence, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DeviceStates-SECT-1">SIP Presence</a></dt><dt>shared extension example, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061419">Shared Extension Example</a></dt></dl></dd><dt>sla.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061103">sla.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061311">sla.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061439">sla.conf</a></dt><dt>SLA:&lt;shared line&gt; virtual device, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>SLATrunk() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061147">extensions.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061463">extensions.conf</a></dt><dt>SMDI (Simplified Message Desk Interface),
          voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt><dt>smdienable option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>smdiport option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>SMDI_MSG() function, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt><dt>SNMP (Simple Network Management Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241628">SNMP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241664">Installing the SNMP Module for Asterisk</a></dt><dt>monitoring Asterisk with OpenNMS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></dt></dl></dd><dt>snmpusm, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>SNMPv3, enabling, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>snmpwalk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241703">Ubuntu dependency</a></dt><dt>Snom, SIP-based paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257536">Set paging</a></dt><dt>softphones</dt><dd><dl><dt>configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id246359">Hardphones, Softphones, and ATAs</a></dt><dt>requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.2">Softphones</a></dt></dl></dd><dt>software dependencies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt><dt>SONET circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.3">SONET and OC circuits</a></dt><dt>sound files, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>spam, VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.2">VoIP spam</a></dt><dt>spandsp, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id253868">spandsp</a></dt><dt>SPEECH ACTIVATE GRAMMAR AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH CREATE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH DEACTIVATE GRAMMAR AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH DESTROY AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH LOAD GRAMMAR AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>speech processing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1">Speech Processing</a></dt><dt>speech recognition</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1.2">Speech recognition</a></dt><dt>IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247100">Speech Recognition and Text-to-Speech</a></dt></dl></dd><dt>SPEECH RECOGNIZE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH SET AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>SPEECH UNLOAD GRAMMAR AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>Speex, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3">Codecs</a></dt><dt>Speex codec, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-3.1.7">Speex</a></dt><dt>SPIT (Spam over Internet Telephony), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248402">Spam over Internet Telephony (SPIT)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241778">Spam over Internet Telephony (SPIT)</a></dt><dt>spoofing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241852">Spoofing</a></dt><dt>spool, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294702">The Spool</a></dt><dt>spool folder, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>SQL (see Microsoft SQL; MySQL)</dt><dt>square brackets ([]) contexts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1.1">Contexts</a></dt><dt>src CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>SRTP (Secure RTP)</dt><dd><dl><dt>encrypting audio, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a></dt><dt>encrypting SIP calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt></dl></dd><dt>SRV records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>srvlookup (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#id534066">iax.conf</a></dt><dt>SS7 (Signaling System 7), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></dt><dt>standards</dt><dd><dl><dt>Asterisk future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.1">Too much change, too few standards</a></dt><dt>compliance, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1.2">Limited Standards Compliancy</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.3">Standards Compliance</a></dt></dl></dd><dt>StarPy, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id242068">Development Frameworks</a></dt><dt>start CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>stateprov option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288726">An Introduction to Device State</a></dt><dd><dl><dt>(see also device states)</dt><dt>extension states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265377">Extension States</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265394">Checking Extension States</a></dt></dl></dd><dt>static realtime, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1465">Using Realtime</a></dt><dt>stations, in Asterisk compared to other PBXs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a></dt><dt>statistics, queue_log file, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>status option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>status, queues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36038569">Queue Status Display</a></dt><dt>statusmessage option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>storage</dt><dd><dl><dt>AstDB, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6">Using the Asterisk Database (AstDB)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt><dd><dl><dt>deleting data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.3">Deleting Data from the AstDB</a></dt><dt>retrieving data from, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.2">Retrieving Data from the AstDB</a></dt><dt>storing data in, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.1">Storing Data in the AstDB</a></dt><dt>using in the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-6.4">Using the AstDB in the Dialplan</a></dt></dl></dd><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292842">Storage Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></dt><dd><dl><dt>IMAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></dt><dt>Linux filesystem, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292932">ODBC</a></dt></dl></dd></dl></dd><dt>storehistory option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>strategy option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id285928">Creating a Simple ACD Queue</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>STREAM FILE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>strong passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Security_id276435">Authentication Weaknesses</a></dt><dt>studio prompts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt><dt>stunaddr option (gtalk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></dt><dt>subFreenum context, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248039">Using ISNs in Your Asterisk System</a></dt><dt>subroutines, GoSub() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060368">Defining Subroutines</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeeperDialplan_id36060676">Returning from a Subroutine</a></dt><dt>subscribecontext option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265023">Asterisk Configuration</a></dt><dt>Subversion, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_subversion">Getting the Source via Subversion</a></dt><dt>switch hook, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.1.3.1">Hook switch (or switch hook)</a></dt><dt>switchtype, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>syntax</dt><dd><dl><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-1">Dialplan Syntax</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>dialplan functions, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-2.1">Syntax</a></dt><dt>dialplan pattern matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></dt></dl></dd><dt>SYSCOMPAT event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>syslog daemon, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262478">Logging to the Linux syslog Daemon</a></dt><dt>system monitoring and logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Monitoring">System Monitoring and Logging</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id252037">Conclusion</a></dt><dd><dl><dt>CDRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-SysAdmin-SECT-1">Call Detail Records</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></dt><dd><dl><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263137">Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246794">cdr_tds</a></dt><dt>caveats, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246923">Caveats</a></dt><dt>cdr.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>contents, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250686">Dialplan Applications</a></dt><dt>example call detail records, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cdr_examples">Example Call Detail Records</a></dt></dl></dd><dt>CEL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246945">CEL (Channel Event Logging)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt><dd><dl><dt>backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255966">Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt><dt>cel.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_conf">cel.conf</a></dt><dt>channel event contents, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>channel event types, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>dialplan applications, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255758">Dialplan Applications</a></dt><dt>example channel events, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292095">Example Channel Events</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241510">Blind transfer</a></dt></dl></dd><dt>logger.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id265067">Verifying Logging</a></dt><dt>SNMP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241628">SNMP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241807">Configuring SNMP for Asterisk Using OpenNMS</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id242129">Enabling SNMPv3</a></dt><dt>installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241664">Installing the SNMP Module for Asterisk</a></dt><dt>monitoring Asterisk with OpenNMS, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id251917">Monitoring Asterisk with OpenNMS</a></dt></dl></dd></dl></dd><dt>system option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>system time, enabling NTP for accurate system
            time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dt>system users, adding in CentOS Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dt>system.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291083">Configuring analog circuits</a></dt><dt>systemname, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_storing-cdr">Storing Call Detail Records (CDRs)</a></dt><dt>systemname (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>T-carrier circuits, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.1.2">T-carrier circuits</a></dt><dt>T1 lines, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>table option (cel_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>tailor-made private telecommunications networks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.1">Tailor-made private telecommunications networks</a></dt><dt>Target (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>TCP (Transmission Control Protocol)</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.1">Transmission Control Protocol</a></dt><dt>AGI over TCP: FastAGI, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FastAGI">FastAGI—AGI over TCP</a></dt><dt>AMI over TCP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-TCP">AMI over TCP</a></dt></dl></dd><dt>tcpbindaddr (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>tcpenable (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>TDD MODE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>teenagers and security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>telemarketing calls, Zapateller() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></dt><dt>telephone naming concepts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony">Understanding Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-5">Conclusion</a></dt><dd><dl><dt>analog telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1">Analog Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></dt><dt>digital circuit-switched telephone network, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3">The Digital Circuit-Switched Telephone Network</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-3.2.3">Signaling System 7</a></dt><dt>digital telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2">Digital Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-2.1.5">Aliasing</a></dt><dt>hardware requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3">Telephony Hardware</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-3.3">Echo Cancellation</a></dt><dt>packet-switched networks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-4">Packet-Switched Networks</a></dt></dl></dd><dt>telephony adaptors, requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-4.3">Telephony Adaptors</a></dt><dt>telephony future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution">A Telephony Revolution</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-7">Conclusion</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11">Asterisk: A Future for Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></dt><dd><dl><dt>Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4">The Future of Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></dt><dd><dl><dt>barriers to entry, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.2">Low barrier to entry</a></dt><dt>bottleneck engineering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.4">Bottleneck engineering</a></dt><dt>complexity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.7">Complexity</a></dt><dt>fear, uncertainty and doubt, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.3">Fear, uncertainty, and doubt</a></dt><dt>high-fidelity voice, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.2">High-Fidelity Voice</a></dt><dt>hosted solutions of similar complexity to corporate
            websites, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.3">Hosted solutions of similar complexity to corporate
        websites</a></dt><dt>integration of communications technologies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.4">Proper integration of communications technologies</a></dt><dt>peering, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.6">Peering</a></dt><dt>quality of service, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.6">Quality of service</a></dt><dt>regulatory wars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.5">Regulatory wars</a></dt><dt>speech processing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.1">Speech Processing</a></dt><dt>standards, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.1">Too much change, too few standards</a></dt><dt>tailor-made private telecommunications
            networks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.8.1">Tailor-made private telecommunications networks</a></dt><dt>toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FutureTelephony_id337974">Toll fraud</a></dt><dt>unified messaging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.5">Unified Messaging</a></dt><dt>video, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3">Video</a></dt><dt>VoIP spam, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.2">VoIP spam</a></dt><dt>wireless, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4">Wireless</a></dt></dl></dd><dt>Asterisk community, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5">The Asterisk Community</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></dt><dd><dl><dt>Asterisk Documentation Project, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.5">The Asterisk Documentation Project</a></dt><dt>IRC channels, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.3">The IRC Channels</a></dt><dt>mailing lists, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.1">The Asterisk Mailing Lists</a></dt><dt>user groups, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.4">Asterisk User Groups</a></dt><dt>wiki sites, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.2">Asterisk Wiki Sites</a></dt></dl></dd><dt>Asterisk: the hacker’s PBX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-3">Asterisk: The Hacker’s PBX</a></dt><dt>Asterisk: the professional’s PBX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-4">Asterisk: The Professional’s PBX</a></dt><dt>business case, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-6">The Business Case</a></dt><dt>change and flexibility, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-2">Massive Change Requires Flexible Technology</a></dt><dt>open source telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3">The Promise of Open Source Telephony</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dd><dl><dt>community, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.5">Passionate Community</a></dt><dt>conference rooms, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.3">Conference rooms</a></dt><dt>consumers needs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.1">The Itch That Asterisk Scratches</a></dt><dt>home automation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.4">Home automation</a></dt><dt>legacy PBX migration gateway, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.1">Legacy PBX migration gateway</a></dt><dt>low-barrier IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>open architecture, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.2">Open Architecture</a></dt><dt>response to new technologies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.4">Lightning-Fast Response to New Technologies</a></dt><dt>standards compliance, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.3">Standards Compliance</a></dt></dl></dd><dt>paradigm shift, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-2">Paradigm Shift</a></dt><dt>problems with traditional telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-1">The Problems with Traditional Telephony</a></dt><dt>VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1">Asterisk and VoIP: Bridging the Gap Between Traditional and Network
    Telephony</a></dt></dl></dd><dt>telephony hardware, installing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291062">PRI ISDN</a></dt><dt>Telephony Routing over IP (TRIP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></dt><dt>telnet, AMI connectivity, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI-quickstart-TCP">AMI over TCP</a></dt><dt>temperature requirements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.4.2">Temperature</a></dt><dt>tempgreetwarn option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>test modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id294611">Test Modules</a></dt><dt>test users, security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a></dt><dt>testing</dt><dd><dl><dt>CDRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt><dt>device registration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291973">Testing to Ensure Your Devices Have Registered</a></dt><dt>device state changes, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025342">Testing device state changes</a></dt><dt>dialplan for testing your devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id292056">A Basic Dialplan to Test Your Devices</a></dt><dt>ITADs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248004">Testing Your ITAD</a></dt><dt>ODBC voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dd><dl><dt>verifying binary data stored in MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dt>verifying binary data stored in PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></dt></dl></dd><dt>when upgrading Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt><dt>XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt></dl></dd><dt>text</dt><dd><dl><dt>concatenating, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-1.2">Operators</a></dt><dt>text-to-speech, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291618">Text-to-Speech Utilities</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></dt><dd><dl><dt>Cepstral, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291634">Cepstral</a></dt><dt>Festival, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id291626">Festival</a></dt><dt>IVR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id247100">Speech Recognition and Text-to-Speech</a></dt></dl></dd></dl></dd><dt>text2wave application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36056008">Using Festival with Asterisk</a></dt><dt>third-party repositories, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#software-dependencies">Software Dependencies</a></dt><dt>TIFF, fax to TIFF, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Fax_id259374">Fax to TIFF</a></dt><dt>Tigase, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></dt><dt>Tigase XMPP server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dt>time option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>time, enabling NTP for accurate system time, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291661">Enabling NTP for accurate system time</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dt>time-based conditional branching with
          GotoIfTime(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>time/date stamps</dt><dd><dl><dt>internationalization, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt><dt>what to change, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt></dl></dd><dt>timed-out parked calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>timeout argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>timeout argument, Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292588">Argument 2: Timeout</a></dt><dt>timeout option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>timeout option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>timeoutpriority option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></dt><dt>timeoutrestart option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>timeouts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dd><dl><dt>AA, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id287920">Timeout</a></dt><dt>invalid, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.2">Handling Invalid Entries and Timeouts</a></dt><dt>Queue() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></dt><dt>specifying, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></dt></dl></dd><dt>times (GotoIfTime() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-3.2">Time-Based Conditional Branching with GotoIfTime()</a></dt><dt>timestamp (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>timestampevents option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>Tip and Ring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingTelephony-SECT-1.2">Tip and Ring</a></dt><dt>tlsbindaddr (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>tlsbindaddr option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlsbindaddr option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>tlsbindport option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlsbindport option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>tlscertfile option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlscertfile option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>tlscipher option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlscipher option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>tlsenable option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlsenable option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>tlsprivatekey option (http.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id273588">http.conf</a></dt><dt>tlsprivatekey option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>toll fraud</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id248308">Toll Fraud</a></dt><dt>future of telephony, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#FutureTelephony_id337974">Toll fraud</a></dt><dt>NANP and toll fraud, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.2">Pattern-matching examples</a></dt></dl></dd><dt>toll lines, accessing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id242479">Fundamental Dialplan for Outside Connectivity</a></dt><dt>tones, changing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id384018">Conclusion—Easy Reference Cheat Sheet</a></dt><dt>tos option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>transcode_via_sln (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>transcoding</dt><dd><dl><dt>codecs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-1.1">Performance Issues</a></dt><dt>performance, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt></dl></dd><dt>TRANSFER event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>transferdigittimeout (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>translation cost, audio formats, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-2.2">The Answer(), Playback(), and Hangup() Applications</a></dt><dt>translators, codec translators, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Architecture_id292581">Codec Translators</a></dt><dt>Transmission Control Protocol (see TCP)</dt><dt>transmit_silence (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>triggering calendar reminders, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254178">Triggering Calendar Reminders to Your Phone</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id281985">Calling meeting participants and placing them into a
        conference</a></dt><dt>TRIP (Telephony Routing over IP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id289300">Management of Internet Numbering</a></dt><dt>troubleshooting database issues, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id287575">Troubleshooting Database Issues</a></dt><dt>trunk option (sla.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061530">Additional Configuration</a></dt><dt>trunking</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-OutsideConn-SECT-1">The Basics of Trunking</a></dt><dt>IAX trunking, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291299">IAX trunking</a></dt></dl></dd><dt>trunks</dt><dd><dl><dt>in Asterisk compared
      to other PBXs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Arch">Asterisk Architecture</a></dt><dt>SLA key system example with analog trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id289488">Key System Example with Analog Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061217">Additional phone configuration tasks</a></dt><dt>SLA key system example with SIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36061292">Key System Example with SIP Trunks</a></dt></dl></dd><dt>TTL (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>ttl option (dundi.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DUNDi_id36001157">The dundi.conf File</a></dt><dt>two-party call, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292161">Two-party call</a></dt><dt>two-party call CDR, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id246891">Two-party call</a></dt><dt>type option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>type option (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>types, logger.conf types, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>tz option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>u (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>U (VoiceMail() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>Ubuntu Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291827">Ubuntu Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292150">Enable NTP for accurate system time</a></dt><dd><dl><dt>base system installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291868">Base system installation</a></dt><dt>base system update, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292090">Base system update</a></dt><dt>calendars, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id262604">Ubuntu dependencies</a></dt><dt>compiling LDAP support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36041022">Ubuntu dependencies</a></dt><dt>compiling support for XMPP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286850">Ubuntu dependencies</a></dt><dt>compiling voicemail support, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id247032">Ubuntu dependencies</a></dt><dt>converting music format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id241193">Ubuntu</a></dt><dt>cURL module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id246984">Installing the cURL Module</a></dt><dt>installing Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id240883">Installation Cheat Sheet</a></dt><dt>installing Festival, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id36055989">Installing Festival on Ubuntu</a></dt><dt>installing PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id254247">Installing PostgreSQL for Ubuntu</a></dt><dt>installing SNMP module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id241703">Ubuntu dependency</a></dt><dt>MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id253003">Installing MySQL for Ubuntu</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_configuring-mysql">Configuring MySQL</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id246915">Configuring ODBC for Microsoft SQL</a></dt></dl></dd><dt>UDP (User Datagram Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.2">User Datagram Protocol</a></dt><dt>udpbindaddr (sip.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>unanswered option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id250722">cdr.conf</a></dt><dt>unauthenticated calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>“underchin” paging and
        overhead, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257169">Overhead and “Underchin” Paging (a.k.a. Public Address)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt><dt>underscore (_), pattern matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></dt><dt>unified messaging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.5">Unified Messaging</a></dt><dt>uniform resource identifiers (see URIs)</dt><dt>uninterruptible power supplies, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-InstallationPlanning-SECT-2.1">Power Conditioning and Uninterruptible Power Supplies</a></dt><dt>uniqueid CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>uniqueid CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>UNISTIM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.2">UNISTIM</a></dt><dt>unixODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id292060">cel_tds</a></dt><dt>unnumbered priorities, dialplan syntax, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id261938">Unnumbered priorities</a></dt><dt>UNPAUSE event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>UNPAUSEALL event, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id289009">Queue Statistics: The queue_log File</a></dt><dt>UnpauseQueueMember() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id253000">Controlling Queue Members with Dialplan Logic</a></dt><dt>updatecdr option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>updatecdr option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>updating</dt><dd><dl><dt>Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></dt><dt>the dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292738">Updating the dialplan</a></dt></dl></dd><dt>UPGRADE.txt, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id36058887">Upgrading Asterisk</a></dt><dt>upgrading versus updating, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></dt><dt>URI argument, Dial() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292716">Argument 4: URI</a></dt><dt>URIs (uniform resource identifiers)</dt><dd><dl><dt>dialing with, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id291081">sip.conf</a></dt><dt>passing URI information, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DialplanBasics_id292716">Argument 4: URI</a></dt></dl></dd><dt>urlprefix option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>usedirectory option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>usegmtime option (cdr.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id263499">cdr_csv</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id249986">cdr_radius</a></dt><dt>usegmtime option (cel.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id291904">cel_radius</a></dt><dt>usegmtime option (cel_odbc.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255986">cel_odbc</a></dt><dt>User Datagram Protocol (UDP), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-4.1.2">User Datagram Protocol</a></dt><dt>user groups, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.4">Asterisk User Groups</a></dt><dt>user option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>userfield CDR field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id262533">CDR Contents</a></dt><dt>userfield CEL event field, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id255401">Channel Event Contents</a></dt><dt>username option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>[username] section,
          manager.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>users</dt><dd><dl><dt>adding a system user in CentOS Server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id291699">Adding a system user</a></dt><dt>authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1.1">Users</a></dt><dt>chan_skype.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#configuring_chan_skype">Configuring chan_skype.conf</a></dt></dl></dd><dt>users.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceConfig_id283201">Telephone Naming Concepts</a></dt><dt>userscontext option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>USER_DEFINED CEL event type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#cel_event_types">Channel Event Types</a></dt><dt>usesasl option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>usetls option (jabber.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt></dl></div><div class="indexdiv"><h3>V</h3><dl><dt>validating</dt><dd><dl><dt>ODBC connector, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></dt><dt>passwords, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt></dl></dd><dt>variable argument (Read() application), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#IVR_id290151">Components of an IVR</a></dt><dt>variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5">Using Variables</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.4">Adding variables to our dialplan</a></dt><dd><dl><dt>adding to dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.4">Adding variables to our dialplan</a></dt><dt>channel variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.2">Channel variables</a></dt><dt>environment variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.3">Environment variables</a></dt><dt>global variables, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.5.1">Global variables</a></dt></dl></dd><dt>verbose (asterisk.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InitialConfig_id259425">The [options] Section</a></dt><dt>VERBOSE AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>verbose logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>verbose Logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>verbose option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>verifying</dt><dd><dl><dt>binary data stored in MySQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dt>binary data stored in PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277496">Verifying binary data stored in
        PostgreSQL</a></dt><dt>encryption status, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36002938">Encrypting SIP calls</a></dt><dt>logging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id265067">Verifying Logging</a></dt><dt>ODBC-related modules, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#database_validating-odbc">Validating the ODBC Connector</a></dt></dl></dd><dt>versioning</dt><dd><dl><dt>about, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292446">Downloading What You Need</a></dt><dt>Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-versioning">Asterisk Versioning</a></dt></dl></dd><dt>video, Asterisk future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3">Video</a></dt><dt>videoconferencing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.3.1">The challenge of videoconferencing</a></dt><dt>virtual devices, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id267818">Device States</a></dt><dt>vm-invalid-password option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-mismatch option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-newpassword option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-passchanged option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-password option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-pls-try-again option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>vm-reenterpassword option
                  (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>voice menus, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>voice messages, storing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>voicemail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Voicemail">Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293431">Conclusion</a></dt><dd><dl><dt>Asterisk as a standalone voicemail server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293070">Using Asterisk As a Standalone Voicemail Server</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293336">SMDI (Simplified Message Desk Interface)</a></dt><dt>Comedian Mail, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id263499">Comedian Mail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></dt><dd><dl><dt>contexts section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292396">The Contexts Section</a></dt><dt>[general] section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt><dt>sample voicemail.conf file, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></dt><dt>[zonemessages]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a></dt></dl></dd><dt>dialplan, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292544">Dialplan Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></dt><dd><dl><dt>dial-by-name directories, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-4.4">Creating a Dial-by-Name Directory</a></dt><dt>jitterbuffers, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id36004128">Using a Jitterbuffer</a></dt><dt>VoiceMail() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292564">The VoiceMail() Dialplan Application</a></dt><dt>VoiceMailMain() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt></dl></dd><dt>IMAP integration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#voicemail_IMAP_integration">VoiceMail IMAP Integration</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_section12_tt1578">ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt><dd><dl><dt>configuring voicemail.conf for ODBC storage, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>creating the large object type for PostgreSQL, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#psql_large_object_support">Creating the Large Object Type for PostgreSQL</a></dt><dt>storage table layout, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id276920">ODBC Voicemail Storage Table Layout</a></dt><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277300">Testing ODBC Voicemail</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277640">Verifying binary data stored in
        MySQL</a></dt></dl></dd><dt>storage backends, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292842">Storage Backends</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></dt><dd><dl><dt>IMAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293050">IMAP</a></dt><dt>Linux filesystem, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292862">Linux Filesystem</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292932">ODBC</a></dt></dl></dd></dl></dd><dt>VoiceMail() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id36005269">Controlling timeouts</a></dt><dt>voicemail.conf</dt><dd><dl><dt>IMAP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt><dt>ODBC, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Database_id277131">Configuring voicemail.conf for ODBC Storage</a></dt><dt>sample, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292496">An Initial voicemail.conf File</a></dt><dt>[zonemessages]
          section, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt></dl></dd><dt>VoiceMailMain() dialplan application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292721">The VoiceMailMain() Dialplan Application</a></dt><dt>VoIP (Voice over Internet Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291235">VoIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2">VoIP Protocols</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.2">UNISTIM</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6">Asterisk and VoIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.2">register Statements</a></dt><dd><dl><dt>authentication, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.1">Users and Peers and Friends—Oh My!</a></dt><dt>configuring VoIP trunks, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291268">Configuring VoIP Trunks</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059999">IAX encryption</a></dt><dt>emergency dialing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291313">Emergency Dialing</a></dt><dt>H.323, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3">H.323</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.3.4">H.323 and NAT</a></dt><dt>IAX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1">IAX (The “Inter-Asterisk eXchange” Protocol)</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.1.4">IAX and NAT</a></dt><dt>MGCP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.4">MGCP</a></dt><dt>paging adaptors, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id257823">VoIP paging adaptors</a></dt><dt>PSTN origination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id36059788">PSTN Origination</a></dt><dt>PSTN termination, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291246">PSTN Termination</a></dt><dt>register statements, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-6.2">register Statements</a></dt><dt>SCCP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.1">Skinny/SCCP</a></dt><dt>security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#I_sect18_tt1164">VoIP Security</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></dt><dd><dl><dt>DMZ, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252412">DMZ</a></dt><dt>encryption, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241818">Encrypting Audio with Secure RTP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252454">Encryption</a></dt><dt>physical security, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252476">Physical security</a></dt><dt>segregating voice and data traffic, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252398">Segregating voice and data traffic</a></dt><dt>server hardening, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id252426">Server hardening</a></dt><dt>SPIT, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241778">Spam over Internet Telephony (SPIT)</a></dt><dt>spoofing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Understanding_VoIP_id241852">Spoofing</a></dt></dl></dd><dt>SIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2">SIP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.2.4">SIP and NAT</a></dt><dt>spam, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.7.2">VoIP spam</a></dt><dt>telephony future, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1">Asterisk and VoIP: Bridging the Gap Between Traditional and Network
    Telephony</a></dt><dt>UNISTIM, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-UnderstandingVoIP-SECT-2.5.2">UNISTIM</a></dt><dt>VoIP to VoIP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#OutsideConnectivity_id291257">VoIP to VoIP</a></dt></dl></dd><dt>volgain option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id272814">The [general] Section</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt>WAIT FOR DIGIT AGI command, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AGI_id269002">Commands and Responses</a></dt><dt>WaitExten() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.1">The Goto(), Background(), and WaitExten() Applications</a></dt><dt>wakeup calls, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id254192">Triggering a wakeup call</a></dt><dt>WAN (wide area network), distributed device
          states, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dt>warning logger.conf type, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Monitoring_id264504">logger.conf</a></dt><dt>warning messages, when updating Asterisk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id292827">Updating Asterisk</a></dt><dt>WAV file format, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Autoattendant_id288013">Recording Prompts</a></dt><dt>weather reporting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-3.6.2">Low-barrier IVR</a></dt><dt>web interfaces, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface">Web Interfaces</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id247202">Conclusion</a></dt><dd><dl><dt>A2Billing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36042327">A2Billing</a></dt><dt>CDRs, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36036769">Call Detail Records</a></dt><dt>FOP, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id285574">Flash Operator Panel</a></dt><dt>queue reporting, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36041966">Queue Reporting</a></dt><dt>queue status, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#WebInterface_id36038569">Queue Status Display</a></dt></dl></dd><dt>webenabled option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>Weight (SIP SRV record), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#InternetCallRouting_id266470">SRV Records</a></dt><dt>weight option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>weight option option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288946">Priority Queue (Queue Weighting)</a></dt><dt>wget, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#get_source_via_wget">Getting the Source via wget</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Installing_id294571">-bash: wget: command not found</a></dt><dt>WiFi, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.1">WiFi</a></dt><dt>wiki sites, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-5.2">Asterisk Wiki Sites</a></dt><dt>wildcard pattern matching, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-DP-Basics-SECT-3.6.1">Pattern-matching syntax</a></dt><dt>WiMAX, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4.2">WiMAX</a></dt><dt>wireless, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-11-SECT-4.4">Wireless</a></dt><dt>wrapuptime option (agents.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288918">The agents.conf File</a></dt><dt>wrapuptime option (queues.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ACD_id288901">The queues.conf File</a></dt><dt>write option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>writetimeout option (manager.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AMI_id265383">manager.conf</a></dt><dt>writetimeout option (voicemail.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286355">Configuring voicemail.conf for IMAP</a></dt></dl></div><div class="indexdiv"><h3>X</h3><dl><dt>X-Voicemail-Context header, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>X-Voicemail-Mailbox header, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id293218">Dialplan requirements</a></dt><dt>xferfailsound (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>xfersound (features.conf), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id268510">The [general] section</a></dt><dt>XMPP (Extensible Messaging and Presence Protocol), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id265061">Using XMPP</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286789">Using XMPP (Jabber) with Asterisk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dd><dl><dt>Asterisk configuration, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060384">Asterisk configuration</a></dt><dt>chan_gtalk module, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285030">chan_gtalk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285082">Configuring gtalk.conf</a></dt><dt>Google Talk, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#accepting_calls_from_google_talk">Accepting calls from Google Talk</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285398">Outgoing calls via Google Talk</a></dt><dt>Google Voice, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285352">Accepting calls from Google Voice</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id285441">Outgoing calls via Google Voice</a></dt></dl></dd><dt>compiling support for, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286804">Compiling Jabber Support into Asterisk</a></dt><dt>device state distribution, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Clustering_id36060805">Distributing Device States over a WAN</a></dt><dt>installation, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060186">Installation</a></dt><dt>Jabber dialplan commands, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id286869">Jabber Dialplan Commands</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dd><dl><dt>connecting to an XMPP server, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#connecting_to_an_xmpp_server">Connecting to an XMPP server</a></dt><dt>receiving messages with JABBER_RECEIVE(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255908">Receiving messages with JABBER_RECEIVE()</a></dt><dt>sending message with JabberSend(), <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#ExternalServices_id255805">Sending messages with JabberSend()</a></dt></dl></dd><dt>testing, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36025143">Testing</a></dt><dt>XMPP accounts, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#DeviceStates_id36060344">Creating XMPP accounts</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>Z</h3><dl><dt>Zapata Telephony Project, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-Revolution-SECT-1.1">The Zapata Telephony Project</a></dt><dt>Zapateller() application, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#asterisk-CHP-6-SECT-7.1">Zapateller()</a></dt><dt>zone paging, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#AdditionalConfig_id247793">Zone Paging</a></dt><dt>[zonemessages] section,
          voicemail.conf, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Voicemail_id292254">The [zonemessages] Section</a>, <a class="indexterm" href="http://www.asteriskdocs.org/en/3rd_Edition/asterisk-book-html/asterisk-book.html#Internationalization_id332249">Time/Date Stamps and Pronunciation</a></dt></dl></div></div></div><div class="colophon" title="Colophon"><h2 class="title"><a id="asterisk-COLOPHON"></a>Colophon</h2><p><a id="colo1_id243141"></a>The animals on the cover of <span class="emphasis"><em>Asterisk:
  The Definitive Guide</em></span> are starfish
  (<span class="emphasis"><em>Asteroidea</em></span>), a group of echinoderms (spiny-skinned
  invertebrates found only in the sea). Most starfish have fivefold radial
  symmetry (arms or rays branching from a central body disc in multiples of
  five), though some species have four or nine arms. There are over 1,500
  species of starfish.</p><p><a id="colo1_id287388"></a>Starfish live on the floor of the sea and in tidal
  pools, clinging to rocks and moving (slowly) using a water-based vascular
  system to manipulate hundreds of tiny, tube-like legs, called
  <span class="emphasis"><em>podia</em></span>. A small bulb or <span class="emphasis"><em>ampulla</em></span> at
  the top of the tube contracts, expelling water and expanding the starfish’s
  leg. The ampulla relaxes, and the leg retracts. At the tip of each leg is a
  suction cup that allows the starfish to pry open clam, oyster, or mussel
  shells. Starfish are carnivores; they eat coral, fish, and snails, as well
  as bivalves.</p><p><a id="colo1_id259254"></a>Starfish can flex and manipulate their arms to fit
  into small places. At the end of each arm is an eyespot, a primitive sensor
  that detects light and helps the starfish determine direction. Starfish also
  have the ability to regenerate a missing limb. Some species can even regrow
  a complete, new starfish from a severed arm.</p><p><a id="colo1_id273217"></a>The cover image is from the Dover Pictorial
  Archive. The cover font is Adobe ITC Garamond. The text font is Linotype
  Birka; the heading font is Adobe Myriad Condensed; and the code font is
  LucasFont’s TheSans Mono Condensed.</p></div></div><iframe id="google_osd_static_frame_1596551020726" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;" src="./Asterisk™_ The Definitive Guide_files/saved_resource(2).html"></iframe>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2732771-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body><iframe id="google_shimpl" style="display: none;" src="./Asterisk™_ The Definitive Guide_files/saved_resource(3).html"></iframe><iframe id="google_esf" name="google_esf" src="./Asterisk™_ The Definitive Guide_files/zrt_lookup.html" data-ad-client="ca-pub-8316482144448761" style="display: none;"></iframe></html>